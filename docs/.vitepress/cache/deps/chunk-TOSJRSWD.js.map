{
  "version": 3,
  "sources": ["../../../dev/core/src/Misc/deepCopier.ts", "../../../dev/core/src/Misc/webRequest.ts", "../../../dev/core/src/Misc/filesInputStore.ts", "../../../dev/core/src/Misc/retryStrategy.ts", "../../../dev/core/src/Misc/error.ts", "../../../dev/core/src/Misc/stringTools.ts", "../../../dev/core/src/Misc/timingTools.ts", "../../../dev/core/src/Misc/fileTools.ts", "../../../dev/core/src/Misc/guid.ts", "../../../dev/core/src/Misc/instantiationTools.ts", "../../../dev/core/src/Misc/tools.functions.ts", "../../../dev/core/src/Misc/tools.ts"],
  "sourcesContent": ["import { Logger } from \"./logger\";\r\n\r\nconst CloneValue = (source: any, destinationObject: any, shallowCopyValues: boolean) => {\r\n    if (!source) {\r\n        return null;\r\n    }\r\n\r\n    if (source.getClassName && source.getClassName() === \"Mesh\") {\r\n        return null;\r\n    }\r\n\r\n    if (source.getClassName && (source.getClassName() === \"SubMesh\" || source.getClassName() === \"PhysicsBody\")) {\r\n        return source.clone(destinationObject);\r\n    } else if (source.clone) {\r\n        return source.clone();\r\n    } else if (Array.isArray(source)) {\r\n        return source.slice();\r\n    } else if (shallowCopyValues && typeof source === \"object\") {\r\n        return { ...source };\r\n    }\r\n    return null;\r\n};\r\n\r\nfunction GetAllPropertyNames(obj: any): string[] {\r\n    const props: string[] = [];\r\n\r\n    do {\r\n        Object.getOwnPropertyNames(obj).forEach(function (prop) {\r\n            if (props.indexOf(prop) === -1) {\r\n                props.push(prop);\r\n            }\r\n        });\r\n    } while ((obj = Object.getPrototypeOf(obj)));\r\n\r\n    return props;\r\n}\r\n\r\n/**\r\n * Class containing a set of static utilities functions for deep copy.\r\n */\r\nexport class DeepCopier {\r\n    /**\r\n     * Tries to copy an object by duplicating every property\r\n     * @param source defines the source object\r\n     * @param destination defines the target object\r\n     * @param doNotCopyList defines a list of properties to avoid\r\n     * @param mustCopyList defines a list of properties to copy (even if they start with _)\r\n     * @param shallowCopyValues defines wether properties referencing objects (none cloneable) must be shallow copied (false by default)\r\n     * @remarks shallowCopyValues will not instantite the copied values which makes it only usable for \"JSON objects\"\r\n     */\r\n    public static DeepCopy(source: any, destination: any, doNotCopyList?: string[], mustCopyList?: string[], shallowCopyValues = false): void {\r\n        const properties = GetAllPropertyNames(source);\r\n        for (const prop of properties) {\r\n            if (prop[0] === \"_\" && (!mustCopyList || mustCopyList.indexOf(prop) === -1)) {\r\n                continue;\r\n            }\r\n\r\n            if (prop.endsWith(\"Observable\")) {\r\n                continue;\r\n            }\r\n\r\n            if (doNotCopyList && doNotCopyList.indexOf(prop) !== -1) {\r\n                continue;\r\n            }\r\n\r\n            const sourceValue = source[prop];\r\n            const typeOfSourceValue = typeof sourceValue;\r\n\r\n            if (typeOfSourceValue === \"function\") {\r\n                continue;\r\n            }\r\n\r\n            try {\r\n                if (typeOfSourceValue === \"object\") {\r\n                    if (sourceValue instanceof Uint8Array) {\r\n                        destination[prop] = Uint8Array.from(sourceValue);\r\n                    } else if (sourceValue instanceof Array) {\r\n                        destination[prop] = [];\r\n\r\n                        if (sourceValue.length > 0) {\r\n                            if (typeof sourceValue[0] == \"object\") {\r\n                                for (let index = 0; index < sourceValue.length; index++) {\r\n                                    const clonedValue = CloneValue(sourceValue[index], destination, shallowCopyValues);\r\n\r\n                                    if (destination[prop].indexOf(clonedValue) === -1) {\r\n                                        // Test if auto inject was not done\r\n                                        destination[prop].push(clonedValue);\r\n                                    }\r\n                                }\r\n                            } else {\r\n                                destination[prop] = sourceValue.slice(0);\r\n                            }\r\n                        }\r\n                    } else {\r\n                        destination[prop] = CloneValue(sourceValue, destination, shallowCopyValues);\r\n                    }\r\n                } else {\r\n                    destination[prop] = sourceValue;\r\n                }\r\n            } catch (e) {\r\n                // Log a warning (it could be because of a read-only property)\r\n                Logger.Warn(e.message);\r\n            }\r\n        }\r\n    }\r\n}\r\n", "import type { IWebRequest } from \"./interfaces/iWebRequest\";\r\nimport type { Nullable } from \"../types\";\r\nimport type { INative } from \"../Engines/Native/nativeInterfaces\";\r\n\r\n// eslint-disable-next-line @typescript-eslint/naming-convention\r\ndeclare const _native: INative;\r\n\r\n/** @internal */\r\n// eslint-disable-next-line @typescript-eslint/naming-convention\r\nfunction createXMLHttpRequest(): XMLHttpRequest {\r\n    // If running in Babylon Native, then defer to the native XMLHttpRequest, which has the same public contract\r\n    if (typeof _native !== \"undefined\" && _native.XMLHttpRequest) {\r\n        return new _native.XMLHttpRequest();\r\n    } else {\r\n        return new XMLHttpRequest();\r\n    }\r\n}\r\n\r\n/**\r\n * Extended version of XMLHttpRequest with support for customizations (headers, ...)\r\n */\r\nexport class WebRequest implements IWebRequest {\r\n    private readonly _xhr = createXMLHttpRequest();\r\n\r\n    /**\r\n     * Custom HTTP Request Headers to be sent with XMLHttpRequests\r\n     * i.e. when loading files, where the server/service expects an Authorization header\r\n     */\r\n    public static CustomRequestHeaders: { [key: string]: string } = {};\r\n\r\n    /**\r\n     * Add callback functions in this array to update all the requests before they get sent to the network\r\n     */\r\n    public static CustomRequestModifiers = new Array<(request: XMLHttpRequest, url: string) => void>();\r\n\r\n    /**\r\n     * If set to true, requests to Babylon.js CDN requests will not be modified\r\n     */\r\n    public static SkipRequestModificationForBabylonCDN = true;\r\n\r\n    /**\r\n     * This function can be called to check if there are request modifiers for network requests\r\n     * @returns true if there are any custom requests available\r\n     */\r\n    public static get IsCustomRequestAvailable(): boolean {\r\n        return Object.keys(WebRequest.CustomRequestHeaders).length > 0 || WebRequest.CustomRequestModifiers.length > 0;\r\n    }\r\n\r\n    private _requestURL: string = \"\";\r\n\r\n    private _injectCustomRequestHeaders(): void {\r\n        if (this._shouldSkipRequestModifications(this._requestURL)) {\r\n            return;\r\n        }\r\n        for (const key in WebRequest.CustomRequestHeaders) {\r\n            const val = WebRequest.CustomRequestHeaders[key];\r\n            if (val) {\r\n                this._xhr.setRequestHeader(key, val);\r\n            }\r\n        }\r\n    }\r\n\r\n    private _shouldSkipRequestModifications(url: string): boolean {\r\n        return WebRequest.SkipRequestModificationForBabylonCDN && (url.includes(\"preview.babylonjs.com\") || url.includes(\"cdn.babylonjs.com\"));\r\n    }\r\n\r\n    /**\r\n     * Gets or sets a function to be called when loading progress changes\r\n     */\r\n    public get onprogress(): ((this: XMLHttpRequest, ev: ProgressEvent) => any) | null {\r\n        return this._xhr.onprogress;\r\n    }\r\n\r\n    public set onprogress(value: ((this: XMLHttpRequest, ev: ProgressEvent) => any) | null) {\r\n        this._xhr.onprogress = value;\r\n    }\r\n\r\n    /**\r\n     * Returns client's state\r\n     */\r\n    public get readyState(): number {\r\n        return this._xhr.readyState;\r\n    }\r\n\r\n    /**\r\n     * Returns client's status\r\n     */\r\n    public get status(): number {\r\n        return this._xhr.status;\r\n    }\r\n\r\n    /**\r\n     * Returns client's status as a text\r\n     */\r\n    public get statusText(): string {\r\n        return this._xhr.statusText;\r\n    }\r\n\r\n    /**\r\n     * Returns client's response\r\n     */\r\n    public get response(): any {\r\n        return this._xhr.response;\r\n    }\r\n\r\n    /**\r\n     * Returns client's response url\r\n     */\r\n    public get responseURL(): string {\r\n        return this._xhr.responseURL;\r\n    }\r\n\r\n    /**\r\n     * Returns client's response as text\r\n     */\r\n    public get responseText(): string {\r\n        return this._xhr.responseText;\r\n    }\r\n\r\n    /**\r\n     * Gets or sets the expected response type\r\n     */\r\n    public get responseType(): XMLHttpRequestResponseType {\r\n        return this._xhr.responseType;\r\n    }\r\n\r\n    public set responseType(value: XMLHttpRequestResponseType) {\r\n        this._xhr.responseType = value;\r\n    }\r\n\r\n    /**\r\n     * Gets or sets the timeout value in milliseconds\r\n     */\r\n    public get timeout(): number {\r\n        return this._xhr.timeout;\r\n    }\r\n\r\n    public set timeout(value: number) {\r\n        this._xhr.timeout = value;\r\n    }\r\n\r\n    /** @internal */\r\n    public addEventListener<K extends keyof XMLHttpRequestEventMap>(\r\n        type: K,\r\n        listener: (this: XMLHttpRequest, ev: XMLHttpRequestEventMap[K]) => any,\r\n        options?: boolean | AddEventListenerOptions\r\n    ): void;\r\n    public addEventListener(type: string, listener: EventListenerOrEventListenerObject, options?: boolean | AddEventListenerOptions): void {\r\n        this._xhr.addEventListener(type, listener, options);\r\n    }\r\n\r\n    /** @internal */\r\n    public removeEventListener<K extends keyof XMLHttpRequestEventMap>(\r\n        type: K,\r\n        listener: (this: XMLHttpRequest, ev: XMLHttpRequestEventMap[K]) => any,\r\n        options?: boolean | EventListenerOptions\r\n    ): void;\r\n    public removeEventListener(type: string, listener: EventListenerOrEventListenerObject, options?: boolean | EventListenerOptions): void {\r\n        this._xhr.removeEventListener(type, listener, options);\r\n    }\r\n\r\n    /**\r\n     * Cancels any network activity\r\n     */\r\n    public abort() {\r\n        this._xhr.abort();\r\n    }\r\n\r\n    /**\r\n     * Initiates the request. The optional argument provides the request body. The argument is ignored if request method is GET or HEAD\r\n     * @param body defines an optional request body\r\n     */\r\n    public send(body?: Document | XMLHttpRequestBodyInit | null): void {\r\n        if (WebRequest.CustomRequestHeaders) {\r\n            this._injectCustomRequestHeaders();\r\n        }\r\n\r\n        this._xhr.send(body);\r\n    }\r\n\r\n    /**\r\n     * Sets the request method, request URL\r\n     * @param method defines the method to use (GET, POST, etc..)\r\n     * @param url defines the url to connect with\r\n     */\r\n    public open(method: string, url: string): void {\r\n        for (const update of WebRequest.CustomRequestModifiers) {\r\n            if (this._shouldSkipRequestModifications(url)) {\r\n                return;\r\n            }\r\n            update(this._xhr, url);\r\n        }\r\n\r\n        // Clean url\r\n        url = url.replace(\"file:http:\", \"http:\");\r\n        url = url.replace(\"file:https:\", \"https:\");\r\n\r\n        this._requestURL = url;\r\n\r\n        this._xhr.open(method, url, true);\r\n    }\r\n\r\n    /**\r\n     * Sets the value of a request header.\r\n     * @param name The name of the header whose value is to be set\r\n     * @param value The value to set as the body of the header\r\n     */\r\n    setRequestHeader(name: string, value: string): void {\r\n        this._xhr.setRequestHeader(name, value);\r\n    }\r\n\r\n    /**\r\n     * Get the string containing the text of a particular header's value.\r\n     * @param name The name of the header\r\n     * @returns The string containing the text of the given header name\r\n     */\r\n    getResponseHeader(name: string): Nullable<string> {\r\n        return this._xhr.getResponseHeader(name);\r\n    }\r\n}\r\n", "/**\r\n * Class used to help managing file picking and drag'n'drop\r\n * File Storage\r\n */\r\nexport class FilesInputStore {\r\n    /**\r\n     * List of files ready to be loaded\r\n     */\r\n    public static FilesToLoad: { [key: string]: File } = {};\r\n}\r\n", "import type { WebRequest } from \"./webRequest\";\r\n\r\n/**\r\n * Class used to define a retry strategy when error happens while loading assets\r\n */\r\nexport class RetryStrategy {\r\n    /**\r\n     * Function used to defines an exponential back off strategy\r\n     * @param maxRetries defines the maximum number of retries (3 by default)\r\n     * @param baseInterval defines the interval between retries\r\n     * @returns the strategy function to use\r\n     */\r\n    public static ExponentialBackoff(maxRetries = 3, baseInterval = 500) {\r\n        return (url: string, request: WebRequest, retryIndex: number): number => {\r\n            if (request.status !== 0 || retryIndex >= maxRetries || url.indexOf(\"file:\") !== -1) {\r\n                return -1;\r\n            }\r\n\r\n            return Math.pow(2, retryIndex) * baseInterval;\r\n        };\r\n    }\r\n}\r\n", "/* eslint-disable @typescript-eslint/naming-convention */\r\n/**\r\n * Base error. Due to limitations of typedoc-check and missing documentation\r\n * in lib.es5.d.ts, cannot extend Error directly for RuntimeError.\r\n * @ignore\r\n */\r\nexport abstract class BaseError extends Error {\r\n    // See https://stackoverflow.com/questions/12915412/how-do-i-extend-a-host-object-e-g-error-in-typescript\r\n    // and https://github.com/Microsoft/TypeScript/wiki/Breaking-Changes#extending-built-ins-like-error-array-and-map-may-no-longer-work\r\n\r\n    // Polyfill for Object.setPrototypeOf if necessary.\r\n    protected static _setPrototypeOf: (o: any, proto: object | null) => any =\r\n        (Object as any).setPrototypeOf ||\r\n        ((o, proto) => {\r\n            o.__proto__ = proto;\r\n            return o;\r\n        });\r\n}\r\n\r\n/* IMP! DO NOT CHANGE THE NUMBERING OF EXISTING ERROR CODES */\r\n/**\r\n * Error codes for BaseError\r\n */\r\nexport const ErrorCodes = {\r\n    // Mesh errors 0-999\r\n    /** Invalid or empty mesh vertex positions. */\r\n    MeshInvalidPositionsError: 0,\r\n\r\n    // Texture errors 1000-1999\r\n    /** Unsupported texture found. */\r\n    UnsupportedTextureError: 1000,\r\n\r\n    // GLTFLoader errors 2000-2999\r\n    /** Unexpected magic number found in GLTF file header. */\r\n    GLTFLoaderUnexpectedMagicError: 2000,\r\n\r\n    // SceneLoader errors 3000-3999\r\n    /** SceneLoader generic error code. Ideally wraps the inner exception. */\r\n    SceneLoaderError: 3000,\r\n\r\n    // File related errors 4000-4999\r\n    /** Load file error */\r\n    LoadFileError: 4000,\r\n    /** Request file error */\r\n    RequestFileError: 4001,\r\n    /** Read file error */\r\n    ReadFileError: 4002,\r\n} as const;\r\n\r\n/**\r\n * Error code type\r\n */\r\nexport type ErrorCodesType = (typeof ErrorCodes)[keyof typeof ErrorCodes];\r\n\r\n/**\r\n * Application runtime error\r\n */\r\nexport class RuntimeError extends BaseError {\r\n    /**\r\n     * The error code\r\n     */\r\n    public errorCode: ErrorCodesType;\r\n\r\n    /**\r\n     * The error that caused this outer error\r\n     */\r\n    public innerError?: Error;\r\n\r\n    /**\r\n     * Creates a new RuntimeError\r\n     * @param message defines the message of the error\r\n     * @param errorCode the error code\r\n     * @param innerError the error that caused the outer error\r\n     */\r\n    public constructor(message: string, errorCode: ErrorCodesType, innerError?: Error) {\r\n        super(message);\r\n\r\n        this.errorCode = errorCode;\r\n        this.innerError = innerError;\r\n\r\n        this.name = \"RuntimeError\";\r\n        BaseError._setPrototypeOf(this, RuntimeError.prototype);\r\n    }\r\n}\r\n", "/* eslint-disable @typescript-eslint/naming-convention */\r\n\r\n/**\r\n * Checks for a matching suffix at the end of a string (for ES5 and lower)\r\n * @param str Source string\r\n * @param suffix Suffix to search for in the source string\r\n * @returns Boolean indicating whether the suffix was found (true) or not (false)\r\n * @deprecated Please use native string function instead\r\n */\r\nexport const EndsWith = (str: string, suffix: string): boolean => {\r\n    return str.endsWith(suffix);\r\n};\r\n\r\n/**\r\n * Checks for a matching suffix at the beginning of a string (for ES5 and lower)\r\n * @param str Source string\r\n * @param suffix Suffix to search for in the source string\r\n * @returns Boolean indicating whether the suffix was found (true) or not (false)\r\n * @deprecated Please use native string function instead\r\n */\r\nexport const StartsWith = (str: string, suffix: string): boolean => {\r\n    if (!str) {\r\n        return false;\r\n    }\r\n    return str.startsWith(suffix);\r\n};\r\n\r\n/**\r\n * Decodes a buffer into a string\r\n * @param buffer The buffer to decode\r\n * @returns The decoded string\r\n */\r\nexport const Decode = (buffer: Uint8Array | Uint16Array): string => {\r\n    if (typeof TextDecoder !== \"undefined\") {\r\n        return new TextDecoder().decode(buffer);\r\n    }\r\n\r\n    let result = \"\";\r\n    for (let i = 0; i < buffer.byteLength; i++) {\r\n        result += String.fromCharCode(buffer[i]);\r\n    }\r\n\r\n    return result;\r\n};\r\n\r\n/**\r\n * Encode a buffer to a base64 string\r\n * @param buffer defines the buffer to encode\r\n * @returns the encoded string\r\n */\r\nexport const EncodeArrayBufferToBase64 = (buffer: ArrayBuffer | ArrayBufferView): string => {\r\n    const keyStr = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\";\r\n    let output = \"\";\r\n    let chr1, chr2, chr3, enc1, enc2, enc3, enc4;\r\n    let i = 0;\r\n    const bytes = ArrayBuffer.isView(buffer) ? new Uint8Array(buffer.buffer, buffer.byteOffset, buffer.byteLength) : new Uint8Array(buffer);\r\n\r\n    while (i < bytes.length) {\r\n        chr1 = bytes[i++];\r\n        chr2 = i < bytes.length ? bytes[i++] : Number.NaN;\r\n        chr3 = i < bytes.length ? bytes[i++] : Number.NaN;\r\n\r\n        enc1 = chr1 >> 2;\r\n        enc2 = ((chr1 & 3) << 4) | (chr2 >> 4);\r\n        enc3 = ((chr2 & 15) << 2) | (chr3 >> 6);\r\n        enc4 = chr3 & 63;\r\n\r\n        if (isNaN(chr2)) {\r\n            enc3 = enc4 = 64;\r\n        } else if (isNaN(chr3)) {\r\n            enc4 = 64;\r\n        }\r\n        output += keyStr.charAt(enc1) + keyStr.charAt(enc2) + keyStr.charAt(enc3) + keyStr.charAt(enc4);\r\n    }\r\n\r\n    return output;\r\n};\r\n\r\n/**\r\n * Converts a given base64 string as an ASCII encoded stream of data\r\n * @param base64Data The base64 encoded string to decode\r\n * @returns Decoded ASCII string\r\n */\r\nexport const DecodeBase64ToString = (base64Data: string): string => {\r\n    return atob(base64Data);\r\n};\r\n\r\n/**\r\n * Converts a given base64 string into an ArrayBuffer of raw byte data\r\n * @param base64Data The base64 encoded string to decode\r\n * @returns ArrayBuffer of byte data\r\n */\r\nexport const DecodeBase64ToBinary = (base64Data: string): ArrayBuffer => {\r\n    const decodedString = DecodeBase64ToString(base64Data);\r\n    const bufferLength = decodedString.length;\r\n    const bufferView = new Uint8Array(new ArrayBuffer(bufferLength));\r\n\r\n    for (let i = 0; i < bufferLength; i++) {\r\n        bufferView[i] = decodedString.charCodeAt(i);\r\n    }\r\n\r\n    return bufferView.buffer;\r\n};\r\n\r\n/**\r\n * Converts a number to string and pads with preceding zeroes until it is of specified length.\r\n * @param num the number to convert and pad\r\n * @param length the expected length of the string\r\n * @returns the padded string\r\n */\r\nexport const PadNumber = (num: number, length: number): string => {\r\n    let str = String(num);\r\n    while (str.length < length) {\r\n        str = \"0\" + str;\r\n    }\r\n    return str;\r\n};\r\n/**\r\n * Helper to manipulate strings\r\n */\r\nexport const StringTools = {\r\n    EndsWith,\r\n    StartsWith,\r\n    Decode,\r\n    EncodeArrayBufferToBase64,\r\n    DecodeBase64ToString,\r\n    DecodeBase64ToBinary,\r\n    PadNumber,\r\n};\r\n", "import { IsWindowObjectExist } from \"./domManagement\";\r\n\r\n/**\r\n * Class used to provide helper for timing\r\n */\r\nexport class TimingTools {\r\n    /**\r\n     * Polyfill for setImmediate\r\n     * @param action defines the action to execute after the current execution block\r\n     */\r\n    public static SetImmediate(action: () => void) {\r\n        if (IsWindowObjectExist() && window.setImmediate) {\r\n            window.setImmediate(action);\r\n        } else {\r\n            setTimeout(action, 1);\r\n        }\r\n    }\r\n}\r\n", "/* eslint-disable @typescript-eslint/naming-convention */\r\nimport { WebRequest } from \"./webRequest\";\r\nimport { IsWindowObjectExist } from \"./domManagement\";\r\nimport type { Nullable } from \"../types\";\r\nimport type { IOfflineProvider } from \"../Offline/IOfflineProvider\";\r\nimport type { IFileRequest } from \"./fileRequest\";\r\nimport { Observable } from \"./observable\";\r\nimport { FilesInputStore } from \"./filesInputStore\";\r\nimport { RetryStrategy } from \"./retryStrategy\";\r\nimport { BaseError, ErrorCodes, RuntimeError } from \"./error\";\r\nimport { DecodeBase64ToBinary, DecodeBase64ToString, EncodeArrayBufferToBase64 } from \"./stringTools\";\r\nimport { ShaderProcessor } from \"../Engines/Processors/shaderProcessor\";\r\nimport { ThinEngine } from \"../Engines/thinEngine\";\r\nimport { EngineStore } from \"../Engines/engineStore\";\r\nimport { Logger } from \"./logger\";\r\nimport { TimingTools } from \"./timingTools\";\r\nimport type { INative } from \"../Engines/Native/nativeInterfaces\";\r\n\r\nconst Base64DataUrlRegEx = new RegExp(/^data:([^,]+\\/[^,]+)?;base64,/i);\r\ndeclare const _native: INative;\r\n\r\n/** @ignore */\r\nexport class LoadFileError extends RuntimeError {\r\n    public request?: WebRequest;\r\n    public file?: File;\r\n\r\n    /**\r\n     * Creates a new LoadFileError\r\n     * @param message defines the message of the error\r\n     * @param object defines the optional web request\r\n     */\r\n    constructor(message: string, object?: WebRequest | File) {\r\n        super(message, ErrorCodes.LoadFileError);\r\n\r\n        this.name = \"LoadFileError\";\r\n        BaseError._setPrototypeOf(this, LoadFileError.prototype);\r\n\r\n        if (object instanceof WebRequest) {\r\n            this.request = object;\r\n        } else {\r\n            this.file = object;\r\n        }\r\n    }\r\n}\r\n\r\n/** @ignore */\r\nexport class RequestFileError extends RuntimeError {\r\n    /**\r\n     * Creates a new LoadFileError\r\n     * @param message defines the message of the error\r\n     * @param request defines the optional web request\r\n     */\r\n    constructor(\r\n        message: string,\r\n        public request: WebRequest\r\n    ) {\r\n        super(message, ErrorCodes.RequestFileError);\r\n        this.name = \"RequestFileError\";\r\n        BaseError._setPrototypeOf(this, RequestFileError.prototype);\r\n    }\r\n}\r\n\r\n/** @ignore */\r\nexport class ReadFileError extends RuntimeError {\r\n    /**\r\n     * Creates a new ReadFileError\r\n     * @param message defines the message of the error\r\n     * @param file defines the optional file\r\n     */\r\n    constructor(\r\n        message: string,\r\n        public file: File\r\n    ) {\r\n        super(message, ErrorCodes.ReadFileError);\r\n        this.name = \"ReadFileError\";\r\n        BaseError._setPrototypeOf(this, ReadFileError.prototype);\r\n    }\r\n}\r\n/**\r\n * @internal\r\n */\r\nexport const FileToolsOptions: {\r\n    DefaultRetryStrategy: (url: string, request: WebRequest, retryIndex: number) => number;\r\n    BaseUrl: string;\r\n    CorsBehavior: string | ((url: string | string[]) => string);\r\n    PreprocessUrl: (url: string) => string;\r\n    ScriptBaseUrl: string;\r\n    ScriptPreprocessUrl: (url: string) => string;\r\n} = {\r\n    /**\r\n     * Gets or sets the retry strategy to apply when an error happens while loading an asset.\r\n     * When defining this function, return the wait time before trying again or return -1 to\r\n     * stop retrying and error out.\r\n     */\r\n    DefaultRetryStrategy: RetryStrategy.ExponentialBackoff(),\r\n\r\n    /**\r\n     * Gets or sets the base URL to use to load assets\r\n     */\r\n    BaseUrl: \"\",\r\n\r\n    /**\r\n     * Default behaviour for cors in the application.\r\n     * It can be a string if the expected behavior is identical in the entire app.\r\n     * Or a callback to be able to set it per url or on a group of them (in case of Video source for instance)\r\n     */\r\n    CorsBehavior: \"anonymous\",\r\n\r\n    /**\r\n     * Gets or sets a function used to pre-process url before using them to load assets\r\n     * @param url\r\n     * @returns the processed url\r\n     */\r\n    PreprocessUrl: (url: string) => url,\r\n\r\n    /**\r\n     * Gets or sets the base URL to use to load scripts\r\n     * Used for both JS and WASM\r\n     */\r\n    ScriptBaseUrl: \"\",\r\n    /**\r\n     * Gets or sets a function used to pre-process script url before using them to load.\r\n     * Used for both JS and WASM\r\n     * @param url defines the url to process\r\n     * @returns the processed url\r\n     */\r\n    ScriptPreprocessUrl: (url: string) => url,\r\n};\r\n\r\n/**\r\n * Removes unwanted characters from an url\r\n * @param url defines the url to clean\r\n * @returns the cleaned url\r\n */\r\nconst _CleanUrl = (url: string): string => {\r\n    url = url.replace(/#/gm, \"%23\");\r\n    return url;\r\n};\r\n\r\n/**\r\n * Sets the cors behavior on a dom element. This will add the required Tools.CorsBehavior to the element.\r\n * @param url define the url we are trying\r\n * @param element define the dom element where to configure the cors policy\r\n * @internal\r\n */\r\nexport const SetCorsBehavior = (url: string | string[], element: { crossOrigin: string | null }): void => {\r\n    if (url && url.indexOf(\"data:\") === 0) {\r\n        return;\r\n    }\r\n\r\n    if (FileToolsOptions.CorsBehavior) {\r\n        if (typeof FileToolsOptions.CorsBehavior === \"string\" || FileToolsOptions.CorsBehavior instanceof String) {\r\n            element.crossOrigin = <string>FileToolsOptions.CorsBehavior;\r\n        } else {\r\n            const result = FileToolsOptions.CorsBehavior(url);\r\n            if (result) {\r\n                element.crossOrigin = result;\r\n            }\r\n        }\r\n    }\r\n};\r\n\r\n/**\r\n * Loads an image as an HTMLImageElement.\r\n * @param input url string, ArrayBuffer, or Blob to load\r\n * @param onLoad callback called when the image successfully loads\r\n * @param onError callback called when the image fails to load\r\n * @param offlineProvider offline provider for caching\r\n * @param mimeType optional mime type\r\n * @param imageBitmapOptions\r\n * @returns the HTMLImageElement of the loaded image\r\n * @internal\r\n */\r\nexport const LoadImage = (\r\n    input: string | ArrayBuffer | ArrayBufferView | Blob,\r\n    onLoad: (img: HTMLImageElement | ImageBitmap) => void,\r\n    onError: (message?: string, exception?: any) => void,\r\n    offlineProvider: Nullable<IOfflineProvider>,\r\n    mimeType: string = \"\",\r\n    imageBitmapOptions?: ImageBitmapOptions\r\n): Nullable<HTMLImageElement> => {\r\n    const engine = EngineStore.LastCreatedEngine;\r\n    if (typeof HTMLImageElement === \"undefined\" && !engine?._features.forceBitmapOverHTMLImageElement) {\r\n        onError(\"LoadImage is only supported in web or BabylonNative environments.\");\r\n        return null;\r\n    }\r\n\r\n    let url: string;\r\n    let usingObjectURL = false;\r\n\r\n    if (input instanceof ArrayBuffer || ArrayBuffer.isView(input)) {\r\n        if (typeof Blob !== \"undefined\" && typeof URL !== \"undefined\") {\r\n            url = URL.createObjectURL(new Blob([input], { type: mimeType }));\r\n            usingObjectURL = true;\r\n        } else {\r\n            url = `data:${mimeType};base64,` + EncodeArrayBufferToBase64(input);\r\n        }\r\n    } else if (input instanceof Blob) {\r\n        url = URL.createObjectURL(input);\r\n        usingObjectURL = true;\r\n    } else {\r\n        url = _CleanUrl(input);\r\n        url = FileToolsOptions.PreprocessUrl(input);\r\n    }\r\n\r\n    const onErrorHandler = (exception: any) => {\r\n        if (onError) {\r\n            const inputText = url || input.toString();\r\n            onError(`Error while trying to load image: ${inputText.indexOf(\"http\") === 0 || inputText.length <= 128 ? inputText : inputText.slice(0, 128) + \"...\"}`, exception);\r\n        }\r\n    };\r\n\r\n    if (engine?._features.forceBitmapOverHTMLImageElement) {\r\n        LoadFile(\r\n            url,\r\n            (data) => {\r\n                engine!\r\n                    .createImageBitmap(new Blob([data], { type: mimeType }), { premultiplyAlpha: \"none\", ...imageBitmapOptions })\r\n                    .then((imgBmp) => {\r\n                        onLoad(imgBmp);\r\n                        if (usingObjectURL) {\r\n                            URL.revokeObjectURL(url);\r\n                        }\r\n                    })\r\n                    .catch((reason) => {\r\n                        if (onError) {\r\n                            onError(\"Error while trying to load image: \" + input, reason);\r\n                        }\r\n                    });\r\n            },\r\n            undefined,\r\n            offlineProvider || undefined,\r\n            true,\r\n            (request, exception) => {\r\n                onErrorHandler(exception);\r\n            }\r\n        );\r\n\r\n        return null;\r\n    }\r\n\r\n    const img = new Image();\r\n    SetCorsBehavior(url, img);\r\n\r\n    const handlersList: { target: any; name: string; handler: any }[] = [];\r\n\r\n    const loadHandlersList = () => {\r\n        handlersList.forEach((handler) => {\r\n            handler.target.addEventListener(handler.name, handler.handler);\r\n        });\r\n    };\r\n\r\n    const unloadHandlersList = () => {\r\n        handlersList.forEach((handler) => {\r\n            handler.target.removeEventListener(handler.name, handler.handler);\r\n        });\r\n        handlersList.length = 0;\r\n    };\r\n\r\n    const loadHandler = () => {\r\n        unloadHandlersList();\r\n\r\n        onLoad(img);\r\n\r\n        // Must revoke the URL after calling onLoad to avoid security exceptions in\r\n        // certain scenarios (e.g. when hosted in vscode).\r\n        if (usingObjectURL && img.src) {\r\n            URL.revokeObjectURL(img.src);\r\n        }\r\n    };\r\n\r\n    const errorHandler = (err: any) => {\r\n        unloadHandlersList();\r\n\r\n        onErrorHandler(err);\r\n\r\n        if (usingObjectURL && img.src) {\r\n            URL.revokeObjectURL(img.src);\r\n        }\r\n    };\r\n\r\n    const cspHandler = (err: any) => {\r\n        if (err.blockedURI !== img.src) {\r\n            return;\r\n        }\r\n\r\n        unloadHandlersList();\r\n        const cspException = new Error(`CSP violation of policy ${err.effectiveDirective} ${err.blockedURI}. Current policy is ${err.originalPolicy}`);\r\n\r\n        EngineStore.UseFallbackTexture = false;\r\n        onErrorHandler(cspException);\r\n        if (usingObjectURL && img.src) {\r\n            URL.revokeObjectURL(img.src);\r\n        }\r\n        img.src = \"\";\r\n    };\r\n\r\n    handlersList.push({ target: img, name: \"load\", handler: loadHandler });\r\n    handlersList.push({ target: img, name: \"error\", handler: errorHandler });\r\n    handlersList.push({ target: document, name: \"securitypolicyviolation\", handler: cspHandler });\r\n\r\n    loadHandlersList();\r\n\r\n    const fromBlob = url.substring(0, 5) === \"blob:\";\r\n    const fromData = url.substring(0, 5) === \"data:\";\r\n    const noOfflineSupport = () => {\r\n        if (fromBlob || fromData || !WebRequest.IsCustomRequestAvailable) {\r\n            img.src = url;\r\n        } else {\r\n            LoadFile(\r\n                url,\r\n                (data, _, contentType) => {\r\n                    const type = !mimeType && contentType ? contentType : mimeType;\r\n                    const blob = new Blob([data], { type });\r\n                    const url = URL.createObjectURL(blob);\r\n                    usingObjectURL = true;\r\n                    img.src = url;\r\n                },\r\n                undefined,\r\n                offlineProvider || undefined,\r\n                true,\r\n                (_request, exception) => {\r\n                    onErrorHandler(exception);\r\n                }\r\n            );\r\n        }\r\n    };\r\n\r\n    const loadFromOfflineSupport = () => {\r\n        if (offlineProvider) {\r\n            offlineProvider.loadImage(url, img);\r\n        }\r\n    };\r\n\r\n    if (!fromBlob && !fromData && offlineProvider && offlineProvider.enableTexturesOffline) {\r\n        offlineProvider.open(loadFromOfflineSupport, noOfflineSupport);\r\n    } else {\r\n        if (url.indexOf(\"file:\") !== -1) {\r\n            const textureName = decodeURIComponent(url.substring(5).toLowerCase());\r\n            if (FilesInputStore.FilesToLoad[textureName] && typeof URL !== \"undefined\") {\r\n                try {\r\n                    let blobURL;\r\n                    try {\r\n                        blobURL = URL.createObjectURL(FilesInputStore.FilesToLoad[textureName]);\r\n                    } catch (ex) {\r\n                        // Chrome doesn't support oneTimeOnly parameter\r\n                        blobURL = URL.createObjectURL(FilesInputStore.FilesToLoad[textureName]);\r\n                    }\r\n                    img.src = blobURL;\r\n                    usingObjectURL = true;\r\n                } catch (e) {\r\n                    img.src = \"\";\r\n                }\r\n                return img;\r\n            }\r\n        }\r\n\r\n        noOfflineSupport();\r\n    }\r\n\r\n    return img;\r\n};\r\n\r\n/**\r\n * Reads a file from a File object\r\n * @param file defines the file to load\r\n * @param onSuccess defines the callback to call when data is loaded\r\n * @param onProgress defines the callback to call during loading process\r\n * @param useArrayBuffer defines a boolean indicating that data must be returned as an ArrayBuffer\r\n * @param onError defines the callback to call when an error occurs\r\n * @returns a file request object\r\n * @internal\r\n */\r\nexport const ReadFile = (\r\n    file: File,\r\n    onSuccess: (data: any) => void,\r\n    onProgress?: (ev: ProgressEvent) => any,\r\n    useArrayBuffer?: boolean,\r\n    onError?: (error: ReadFileError) => void\r\n): IFileRequest => {\r\n    const reader = new FileReader();\r\n    const fileRequest: IFileRequest = {\r\n        onCompleteObservable: new Observable<IFileRequest>(),\r\n        abort: () => reader.abort(),\r\n    };\r\n\r\n    reader.onloadend = () => fileRequest.onCompleteObservable.notifyObservers(fileRequest);\r\n    if (onError) {\r\n        reader.onerror = () => {\r\n            onError(new ReadFileError(`Unable to read ${file.name}`, file));\r\n        };\r\n    }\r\n    reader.onload = (e) => {\r\n        //target doesn't have result from ts 1.3\r\n        onSuccess((<any>e.target)[\"result\"]);\r\n    };\r\n    if (onProgress) {\r\n        reader.onprogress = onProgress;\r\n    }\r\n    if (!useArrayBuffer) {\r\n        // Asynchronous read\r\n        reader.readAsText(file);\r\n    } else {\r\n        reader.readAsArrayBuffer(file);\r\n    }\r\n\r\n    return fileRequest;\r\n};\r\n\r\n/**\r\n * Loads a file from a url, a data url, or a file url\r\n * @param fileOrUrl file, url, data url, or file url to load\r\n * @param onSuccess callback called when the file successfully loads\r\n * @param onProgress callback called while file is loading (if the server supports this mode)\r\n * @param offlineProvider defines the offline provider for caching\r\n * @param useArrayBuffer defines a boolean indicating that date must be returned as ArrayBuffer\r\n * @param onError callback called when the file fails to load\r\n * @param onOpened\r\n * @returns a file request object\r\n * @internal\r\n */\r\n// eslint-disable-next-line @typescript-eslint/naming-convention\r\nexport const LoadFile = (\r\n    fileOrUrl: File | string,\r\n    onSuccess: (data: string | ArrayBuffer, responseURL?: string, contentType?: Nullable<string>) => void,\r\n    onProgress?: (ev: ProgressEvent) => void,\r\n    offlineProvider?: IOfflineProvider,\r\n    useArrayBuffer?: boolean,\r\n    onError?: (request?: WebRequest, exception?: LoadFileError) => void,\r\n    onOpened?: (request: WebRequest) => void\r\n): IFileRequest => {\r\n    if ((fileOrUrl as File).name) {\r\n        return ReadFile(\r\n            fileOrUrl as File,\r\n            onSuccess,\r\n            onProgress,\r\n            useArrayBuffer,\r\n            onError\r\n                ? (error: ReadFileError) => {\r\n                      onError(undefined, error);\r\n                  }\r\n                : undefined\r\n        );\r\n    }\r\n\r\n    const url = fileOrUrl as string;\r\n\r\n    // If file and file input are set\r\n    if (url.indexOf(\"file:\") !== -1) {\r\n        let fileName = decodeURIComponent(url.substring(5).toLowerCase());\r\n        if (fileName.indexOf(\"./\") === 0) {\r\n            fileName = fileName.substring(2);\r\n        }\r\n        const file = FilesInputStore.FilesToLoad[fileName];\r\n        if (file) {\r\n            return ReadFile(file, onSuccess, onProgress, useArrayBuffer, onError ? (error) => onError(undefined, new LoadFileError(error.message, error.file)) : undefined);\r\n        }\r\n    }\r\n\r\n    // For a Base64 Data URL\r\n    const { match, type } = TestBase64DataUrl(url);\r\n    if (match) {\r\n        const fileRequest: IFileRequest = {\r\n            onCompleteObservable: new Observable<IFileRequest>(),\r\n            abort: () => () => {},\r\n        };\r\n\r\n        try {\r\n            const data = useArrayBuffer ? DecodeBase64UrlToBinary(url) : DecodeBase64UrlToString(url);\r\n            onSuccess(data, undefined, type);\r\n        } catch (error) {\r\n            if (onError) {\r\n                onError(undefined, error);\r\n            } else {\r\n                Logger.Error(error.message || \"Failed to parse the Data URL\");\r\n            }\r\n        }\r\n\r\n        TimingTools.SetImmediate(() => {\r\n            fileRequest.onCompleteObservable.notifyObservers(fileRequest);\r\n        });\r\n\r\n        return fileRequest;\r\n    }\r\n\r\n    return RequestFile(\r\n        url,\r\n        (data, request) => {\r\n            onSuccess(data, request?.responseURL, request?.getResponseHeader(\"content-type\"));\r\n        },\r\n        onProgress,\r\n        offlineProvider,\r\n        useArrayBuffer,\r\n        onError\r\n            ? (error) => {\r\n                  onError(error.request, new LoadFileError(error.message, error.request));\r\n              }\r\n            : undefined,\r\n        onOpened\r\n    );\r\n};\r\n\r\n/**\r\n * Loads a file from a url\r\n * @param url url to load\r\n * @param onSuccess callback called when the file successfully loads\r\n * @param onProgress callback called while file is loading (if the server supports this mode)\r\n * @param offlineProvider defines the offline provider for caching\r\n * @param useArrayBuffer defines a boolean indicating that date must be returned as ArrayBuffer\r\n * @param onError callback called when the file fails to load\r\n * @param onOpened callback called when the web request is opened\r\n * @returns a file request object\r\n * @internal\r\n */\r\nexport const RequestFile = (\r\n    url: string,\r\n    onSuccess?: (data: string | ArrayBuffer, request?: WebRequest) => void,\r\n    onProgress?: (event: ProgressEvent) => void,\r\n    offlineProvider?: IOfflineProvider,\r\n    useArrayBuffer?: boolean,\r\n    onError?: (error: RequestFileError) => void,\r\n    onOpened?: (request: WebRequest) => void\r\n): IFileRequest => {\r\n    url = _CleanUrl(url);\r\n    url = FileToolsOptions.PreprocessUrl(url);\r\n\r\n    const loadUrl = FileToolsOptions.BaseUrl + url;\r\n\r\n    let aborted = false;\r\n    const fileRequest: IFileRequest = {\r\n        onCompleteObservable: new Observable<IFileRequest>(),\r\n        abort: () => (aborted = true),\r\n    };\r\n\r\n    const requestFile = () => {\r\n        let request: Nullable<WebRequest> = new WebRequest();\r\n        let retryHandle: Nullable<ReturnType<typeof setTimeout>> = null;\r\n        let onReadyStateChange: Nullable<() => void>;\r\n\r\n        const unbindEvents = () => {\r\n            if (!request) {\r\n                return;\r\n            }\r\n\r\n            if (onProgress) {\r\n                request.removeEventListener(\"progress\", onProgress);\r\n            }\r\n            if (onReadyStateChange) {\r\n                request.removeEventListener(\"readystatechange\", onReadyStateChange);\r\n            }\r\n            request.removeEventListener(\"loadend\", onLoadEnd!);\r\n        };\r\n\r\n        let onLoadEnd: Nullable<() => void> = () => {\r\n            unbindEvents();\r\n\r\n            fileRequest.onCompleteObservable.notifyObservers(fileRequest);\r\n            fileRequest.onCompleteObservable.clear();\r\n\r\n            onProgress = undefined;\r\n            onReadyStateChange = null;\r\n            onLoadEnd = null;\r\n            onError = undefined;\r\n            onOpened = undefined;\r\n            onSuccess = undefined;\r\n        };\r\n\r\n        fileRequest.abort = () => {\r\n            aborted = true;\r\n\r\n            if (onLoadEnd) {\r\n                onLoadEnd();\r\n            }\r\n\r\n            if (request && request.readyState !== (XMLHttpRequest.DONE || 4)) {\r\n                request.abort();\r\n            }\r\n\r\n            if (retryHandle !== null) {\r\n                clearTimeout(retryHandle);\r\n                retryHandle = null;\r\n            }\r\n\r\n            request = null;\r\n        };\r\n\r\n        const handleError = (error: any) => {\r\n            const message = error.message || \"Unknown error\";\r\n            if (onError && request) {\r\n                onError(new RequestFileError(message, request));\r\n            } else {\r\n                Logger.Error(message);\r\n            }\r\n        };\r\n\r\n        const retryLoop = (retryIndex: number) => {\r\n            if (!request) {\r\n                return;\r\n            }\r\n            request.open(\"GET\", loadUrl);\r\n\r\n            if (onOpened) {\r\n                try {\r\n                    onOpened(request);\r\n                } catch (e) {\r\n                    handleError(e);\r\n                    return;\r\n                }\r\n            }\r\n\r\n            if (useArrayBuffer) {\r\n                request.responseType = \"arraybuffer\";\r\n            }\r\n\r\n            if (onProgress) {\r\n                request.addEventListener(\"progress\", onProgress);\r\n            }\r\n\r\n            if (onLoadEnd) {\r\n                request.addEventListener(\"loadend\", onLoadEnd);\r\n            }\r\n\r\n            onReadyStateChange = () => {\r\n                if (aborted || !request) {\r\n                    return;\r\n                }\r\n\r\n                // In case of undefined state in some browsers.\r\n                if (request.readyState === (XMLHttpRequest.DONE || 4)) {\r\n                    // Some browsers have issues where onreadystatechange can be called multiple times with the same value.\r\n                    if (onReadyStateChange) {\r\n                        request.removeEventListener(\"readystatechange\", onReadyStateChange);\r\n                    }\r\n\r\n                    if ((request.status >= 200 && request.status < 300) || (request.status === 0 && (!IsWindowObjectExist() || IsFileURL()))) {\r\n                        try {\r\n                            if (onSuccess) {\r\n                                onSuccess(useArrayBuffer ? request.response : request.responseText, request);\r\n                            }\r\n                        } catch (e) {\r\n                            handleError(e);\r\n                        }\r\n                        return;\r\n                    }\r\n\r\n                    const retryStrategy = FileToolsOptions.DefaultRetryStrategy;\r\n                    if (retryStrategy) {\r\n                        const waitTime = retryStrategy(loadUrl, request, retryIndex);\r\n                        if (waitTime !== -1) {\r\n                            // Prevent the request from completing for retry.\r\n                            unbindEvents();\r\n\r\n                            request = new WebRequest();\r\n                            retryHandle = setTimeout(() => retryLoop(retryIndex + 1), waitTime);\r\n                            return;\r\n                        }\r\n                    }\r\n\r\n                    const error = new RequestFileError(\"Error status: \" + request.status + \" \" + request.statusText + \" - Unable to load \" + loadUrl, request);\r\n                    if (onError) {\r\n                        onError(error);\r\n                    }\r\n                }\r\n            };\r\n\r\n            request.addEventListener(\"readystatechange\", onReadyStateChange);\r\n\r\n            request.send();\r\n        };\r\n\r\n        retryLoop(0);\r\n    };\r\n\r\n    // Caching all files\r\n    if (offlineProvider && offlineProvider.enableSceneOffline) {\r\n        const noOfflineSupport = (request?: any) => {\r\n            if (request && request.status > 400) {\r\n                if (onError) {\r\n                    onError(request);\r\n                }\r\n            } else {\r\n                requestFile();\r\n            }\r\n        };\r\n\r\n        const loadFromOfflineSupport = () => {\r\n            // TODO: database needs to support aborting and should return a IFileRequest\r\n\r\n            if (offlineProvider) {\r\n                offlineProvider.loadFile(\r\n                    FileToolsOptions.BaseUrl + url,\r\n                    (data) => {\r\n                        if (!aborted && onSuccess) {\r\n                            onSuccess(data);\r\n                        }\r\n\r\n                        fileRequest.onCompleteObservable.notifyObservers(fileRequest);\r\n                    },\r\n                    onProgress\r\n                        ? (event) => {\r\n                              if (!aborted && onProgress) {\r\n                                  onProgress(event);\r\n                              }\r\n                          }\r\n                        : undefined,\r\n                    noOfflineSupport,\r\n                    useArrayBuffer\r\n                );\r\n            }\r\n        };\r\n\r\n        offlineProvider.open(loadFromOfflineSupport, noOfflineSupport);\r\n    } else {\r\n        requestFile();\r\n    }\r\n\r\n    return fileRequest;\r\n};\r\n\r\n/**\r\n * Checks if the loaded document was accessed via `file:`-Protocol.\r\n * @returns boolean\r\n * @internal\r\n */\r\nexport const IsFileURL = (): boolean => {\r\n    return typeof location !== \"undefined\" && location.protocol === \"file:\";\r\n};\r\n\r\n/**\r\n * Test if the given uri is a valid base64 data url\r\n * @param uri The uri to test\r\n * @returns True if the uri is a base64 data url or false otherwise\r\n * @internal\r\n */\r\nexport const IsBase64DataUrl = (uri: string): boolean => {\r\n    return Base64DataUrlRegEx.test(uri);\r\n};\r\n\r\nexport const TestBase64DataUrl = (uri: string): { match: boolean; type: string } => {\r\n    const results = Base64DataUrlRegEx.exec(uri);\r\n    if (results === null || results.length === 0) {\r\n        return { match: false, type: \"\" };\r\n    } else {\r\n        const type = results[0].replace(\"data:\", \"\").replace(\"base64,\", \"\");\r\n        return { match: true, type };\r\n    }\r\n};\r\n\r\n/**\r\n * Decode the given base64 uri.\r\n * @param uri The uri to decode\r\n * @returns The decoded base64 data.\r\n * @internal\r\n */\r\nexport function DecodeBase64UrlToBinary(uri: string): ArrayBuffer {\r\n    return DecodeBase64ToBinary(uri.split(\",\")[1]);\r\n}\r\n\r\n/**\r\n * Decode the given base64 uri into a UTF-8 encoded string.\r\n * @param uri The uri to decode\r\n * @returns The decoded base64 data.\r\n * @internal\r\n */\r\nexport const DecodeBase64UrlToString = (uri: string): string => {\r\n    return DecodeBase64ToString(uri.split(\",\")[1]);\r\n};\r\n\r\n/**\r\n * This will be executed automatically for UMD and es5.\r\n * If esm dev wants the side effects to execute they will have to run it manually\r\n * Once we build native modules those need to be exported.\r\n * @internal\r\n */\r\nconst initSideEffects = () => {\r\n    ThinEngine._FileToolsLoadImage = LoadImage;\r\n    ThinEngine._FileToolsLoadFile = LoadFile;\r\n    ShaderProcessor._FileToolsLoadFile = LoadFile;\r\n};\r\n\r\ninitSideEffects();\r\n\r\n// deprecated\r\n\r\n/**\r\n * FileTools defined as any.\r\n * This should not be imported or used in future releases or in any module in the framework\r\n * @internal\r\n * @deprecated import the needed function from fileTools.ts\r\n */\r\nexport let FileTools: {\r\n    DecodeBase64UrlToBinary: (uri: string) => ArrayBuffer;\r\n    DecodeBase64UrlToString: (uri: string) => string;\r\n    DefaultRetryStrategy: any;\r\n    BaseUrl: any;\r\n    CorsBehavior: any;\r\n    PreprocessUrl: any;\r\n    IsBase64DataUrl: (uri: string) => boolean;\r\n    IsFileURL: () => boolean;\r\n    LoadFile: (\r\n        fileOrUrl: string | File,\r\n        onSuccess: (data: string | ArrayBuffer, responseURL?: string | undefined) => void,\r\n        onProgress?: ((ev: ProgressEvent<EventTarget>) => void) | undefined,\r\n        offlineProvider?: IOfflineProvider | undefined,\r\n        useArrayBuffer?: boolean | undefined,\r\n        onError?: ((request?: WebRequest | undefined, exception?: LoadFileError | undefined) => void) | undefined,\r\n        onOpened?: ((request: WebRequest) => void) | undefined\r\n    ) => IFileRequest;\r\n    LoadImage: (\r\n        input: string | ArrayBuffer | Blob | ArrayBufferView,\r\n        onLoad: (img: HTMLImageElement | ImageBitmap) => void,\r\n        onError: (message?: string | undefined, exception?: any) => void,\r\n        offlineProvider: Nullable<IOfflineProvider>,\r\n        mimeType?: string | undefined,\r\n        imageBitmapOptions?: ImageBitmapOptions | undefined\r\n    ) => Nullable<HTMLImageElement>;\r\n    ReadFile: (\r\n        file: File,\r\n        onSuccess: (data: any) => void,\r\n        onProgress?: ((ev: ProgressEvent<EventTarget>) => any) | undefined,\r\n        useArrayBuffer?: boolean | undefined,\r\n        onError?: ((error: ReadFileError) => void) | undefined\r\n    ) => IFileRequest;\r\n    RequestFile: (\r\n        url: string,\r\n        onSuccess: (data: string | ArrayBuffer, request?: WebRequest | undefined) => void,\r\n        onProgress?: ((event: ProgressEvent<EventTarget>) => void) | undefined,\r\n        offlineProvider?: IOfflineProvider | undefined,\r\n        useArrayBuffer?: boolean | undefined,\r\n        onError?: ((error: RequestFileError) => void) | undefined,\r\n        onOpened?: ((request: WebRequest) => void) | undefined\r\n    ) => IFileRequest;\r\n    SetCorsBehavior: (url: string | string[], element: { crossOrigin: string | null }) => void;\r\n};\r\n/**\r\n * @param DecodeBase64UrlToBinary\r\n * @param DecodeBase64UrlToString\r\n * @param FileToolsOptions\r\n * @internal\r\n */\r\nexport const _injectLTSFileTools = (\r\n    DecodeBase64UrlToBinary: (uri: string) => ArrayBuffer,\r\n    DecodeBase64UrlToString: (uri: string) => string,\r\n    FileToolsOptions: { DefaultRetryStrategy: any; BaseUrl: any; CorsBehavior: any; PreprocessUrl: any },\r\n    IsBase64DataUrl: (uri: string) => boolean,\r\n    IsFileURL: () => boolean,\r\n    LoadFile: (\r\n        fileOrUrl: string | File,\r\n        onSuccess: (data: string | ArrayBuffer, responseURL?: string | undefined) => void,\r\n        onProgress?: ((ev: ProgressEvent<EventTarget>) => void) | undefined,\r\n        offlineProvider?: IOfflineProvider | undefined,\r\n        useArrayBuffer?: boolean | undefined,\r\n        onError?: ((request?: WebRequest | undefined, exception?: LoadFileError | undefined) => void) | undefined,\r\n        onOpened?: ((request: WebRequest) => void) | undefined\r\n    ) => IFileRequest,\r\n    LoadImage: (\r\n        input: string | ArrayBuffer | ArrayBufferView | Blob,\r\n        onLoad: (img: HTMLImageElement | ImageBitmap) => void,\r\n        onError: (message?: string | undefined, exception?: any) => void,\r\n        offlineProvider: Nullable<IOfflineProvider>,\r\n        mimeType?: string,\r\n        imageBitmapOptions?: ImageBitmapOptions | undefined\r\n    ) => Nullable<HTMLImageElement>,\r\n    ReadFile: (\r\n        file: File,\r\n        onSuccess: (data: any) => void,\r\n        onProgress?: ((ev: ProgressEvent<EventTarget>) => any) | undefined,\r\n        useArrayBuffer?: boolean | undefined,\r\n        onError?: ((error: ReadFileError) => void) | undefined\r\n    ) => IFileRequest,\r\n    RequestFile: (\r\n        url: string,\r\n        onSuccess: (data: string | ArrayBuffer, request?: WebRequest | undefined) => void,\r\n        onProgress?: ((event: ProgressEvent<EventTarget>) => void) | undefined,\r\n        offlineProvider?: IOfflineProvider | undefined,\r\n        useArrayBuffer?: boolean | undefined,\r\n        onError?: ((error: RequestFileError) => void) | undefined,\r\n        onOpened?: ((request: WebRequest) => void) | undefined\r\n    ) => IFileRequest,\r\n    SetCorsBehavior: (url: string | string[], element: { crossOrigin: string | null }) => void\r\n) => {\r\n    /**\r\n     * Backwards compatibility.\r\n     * @internal\r\n     * @deprecated\r\n     */\r\n    FileTools = {\r\n        DecodeBase64UrlToBinary,\r\n        DecodeBase64UrlToString,\r\n        DefaultRetryStrategy: FileToolsOptions.DefaultRetryStrategy,\r\n        BaseUrl: FileToolsOptions.BaseUrl,\r\n        CorsBehavior: FileToolsOptions.CorsBehavior,\r\n        PreprocessUrl: FileToolsOptions.PreprocessUrl,\r\n        IsBase64DataUrl,\r\n        IsFileURL,\r\n        LoadFile,\r\n        LoadImage,\r\n        ReadFile,\r\n        RequestFile,\r\n        SetCorsBehavior,\r\n    };\r\n\r\n    Object.defineProperty(FileTools, \"DefaultRetryStrategy\", {\r\n        get: function (this: null) {\r\n            return FileToolsOptions.DefaultRetryStrategy;\r\n        },\r\n        set: function (this: null, value: (url: string, request: WebRequest, retryIndex: number) => number) {\r\n            FileToolsOptions.DefaultRetryStrategy = value;\r\n        },\r\n    });\r\n\r\n    Object.defineProperty(FileTools, \"BaseUrl\", {\r\n        get: function (this: null) {\r\n            return FileToolsOptions.BaseUrl;\r\n        },\r\n        set: function (this: null, value: string) {\r\n            FileToolsOptions.BaseUrl = value;\r\n        },\r\n    });\r\n\r\n    Object.defineProperty(FileTools, \"PreprocessUrl\", {\r\n        get: function (this: null) {\r\n            return FileToolsOptions.PreprocessUrl;\r\n        },\r\n        set: function (this: null, value: (url: string) => string) {\r\n            FileToolsOptions.PreprocessUrl = value;\r\n        },\r\n    });\r\n\r\n    Object.defineProperty(FileTools, \"CorsBehavior\", {\r\n        get: function (this: null) {\r\n            return FileToolsOptions.CorsBehavior;\r\n        },\r\n        set: function (this: null, value: string | ((url: string | string[]) => string)) {\r\n            FileToolsOptions.CorsBehavior = value;\r\n        },\r\n    });\r\n};\r\n\r\n_injectLTSFileTools(DecodeBase64UrlToBinary, DecodeBase64UrlToString, FileToolsOptions, IsBase64DataUrl, IsFileURL, LoadFile, LoadImage, ReadFile, RequestFile, SetCorsBehavior);\r\n", "/**\r\n * Implementation from http://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid-in-javascript/2117523#answer-2117523\r\n * Be aware Math.random() could cause collisions, but:\r\n * \"All but 6 of the 128 bits of the ID are randomly generated, which means that for any two ids, there's a 1 in 2^^122 (or 5.3x10^^36) chance they'll collide\"\r\n * @returns a pseudo random id\r\n */\r\nexport function RandomGUID(): string {\r\n    return \"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g, (c) => {\r\n        const r = (Math.random() * 16) | 0,\r\n            v = c === \"x\" ? r : (r & 0x3) | 0x8;\r\n        return v.toString(16);\r\n    });\r\n}\r\n/**\r\n * Class used to manipulate GUIDs\r\n */\r\nexport const GUID = {\r\n    /**\r\n     * Implementation from http://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid-in-javascript/2117523#answer-2117523\r\n     * Be aware Math.random() could cause collisions, but:\r\n     * \"All but 6 of the 128 bits of the ID are randomly generated, which means that for any two ids, there's a 1 in 2^^122 (or 5.3x10^^36) chance they'll collide\"\r\n     * @returns a pseudo random id\r\n     */\r\n    // eslint-disable-next-line @typescript-eslint/naming-convention\r\n    RandomId: RandomGUID,\r\n};\r\n", "import { Logger } from \"./logger\";\r\nimport { GetClass } from \"./typeStore\";\r\n\r\n/**\r\n * Class used to enable instantiation of objects by class name\r\n */\r\nexport class InstantiationTools {\r\n    /**\r\n     * Use this object to register external classes like custom textures or material\r\n     * to allow the loaders to instantiate them\r\n     */\r\n    public static RegisteredExternalClasses: { [key: string]: Object } = {};\r\n\r\n    /**\r\n     * Tries to instantiate a new object from a given class name\r\n     * @param className defines the class name to instantiate\r\n     * @returns the new object or null if the system was not able to do the instantiation\r\n     */\r\n    public static Instantiate(className: string): any {\r\n        if (this.RegisteredExternalClasses && this.RegisteredExternalClasses[className]) {\r\n            return this.RegisteredExternalClasses[className];\r\n        }\r\n\r\n        const internalClass = GetClass(className);\r\n        if (internalClass) {\r\n            return internalClass;\r\n        }\r\n\r\n        Logger.Warn(className + \" not found, you may have missed an import.\");\r\n\r\n        const arr = className.split(\".\");\r\n\r\n        let fn: any = window || this;\r\n        for (let i = 0, len = arr.length; i < len; i++) {\r\n            fn = fn[arr[i]];\r\n        }\r\n\r\n        if (typeof fn !== \"function\") {\r\n            return null;\r\n        }\r\n\r\n        return fn;\r\n    }\r\n}\r\n", "/**\r\n * Function indicating if a number is an exponent of 2\r\n * @param value defines the value to test\r\n * @returns true if the value is an exponent of 2\r\n */\r\nexport function IsExponentOfTwo(value: number): boolean {\r\n    let count = 1;\r\n\r\n    do {\r\n        count *= 2;\r\n    } while (count < value);\r\n\r\n    return count === value;\r\n}\r\n\r\n/**\r\n * Interpolates between a and b via alpha\r\n * @param a The lower value (returned when alpha = 0)\r\n * @param b The upper value (returned when alpha = 1)\r\n * @param alpha The interpolation-factor\r\n * @returns The mixed value\r\n */\r\nexport function Mix(a: number, b: number, alpha: number): number {\r\n    return a * (1 - alpha) + b * alpha;\r\n}\r\n", "/* eslint-disable @typescript-eslint/no-unused-vars */\r\nimport type { Nullable } from \"../types\";\r\nimport { Observable } from \"./observable\";\r\nimport { GetDOMTextContent, IsNavigatorAvailable, IsWindowObjectExist } from \"./domManagement\";\r\nimport { Logger } from \"./logger\";\r\nimport { DeepCopier } from \"./deepCopier\";\r\nimport { PrecisionDate } from \"./precisionDate\";\r\nimport { _WarnImport } from \"./devTools\";\r\nimport { WebRequest } from \"./webRequest\";\r\nimport type { IFileRequest } from \"./fileRequest\";\r\nimport { EngineStore } from \"../Engines/engineStore\";\r\nimport type { ReadFileError } from \"./fileTools\";\r\nimport {\r\n    FileToolsOptions,\r\n    DecodeBase64UrlToBinary,\r\n    IsBase64DataUrl,\r\n    LoadFile as FileToolsLoadFile,\r\n    LoadImage as FileToolLoadImage,\r\n    ReadFile as FileToolsReadFile,\r\n    SetCorsBehavior,\r\n} from \"./fileTools\";\r\nimport type { IOfflineProvider } from \"../Offline/IOfflineProvider\";\r\nimport { TimingTools } from \"./timingTools\";\r\nimport { InstantiationTools } from \"./instantiationTools\";\r\nimport { RandomGUID } from \"./guid\";\r\nimport type { IScreenshotSize } from \"./interfaces/screenshotSize\";\r\nimport type { Engine } from \"../Engines/engine\";\r\nimport type { Camera } from \"../Cameras/camera\";\r\nimport type { IColor4Like } from \"../Maths/math.like\";\r\nimport { IsExponentOfTwo, Mix } from \"./tools.functions\";\r\n\r\ndeclare function importScripts(...urls: string[]): void;\r\n\r\n/**\r\n * Class containing a set of static utilities functions\r\n */\r\nexport class Tools {\r\n    /**\r\n     * Gets or sets the base URL to use to load assets\r\n     */\r\n    public static get BaseUrl() {\r\n        return FileToolsOptions.BaseUrl;\r\n    }\r\n\r\n    public static set BaseUrl(value: string) {\r\n        FileToolsOptions.BaseUrl = value;\r\n    }\r\n\r\n    /**\r\n     * This function checks whether a URL is absolute or not.\r\n     * It will also detect data and blob URLs\r\n     * @param url the url to check\r\n     * @returns is the url absolute or relative\r\n     */\r\n    public static IsAbsoluteUrl(url: string): boolean {\r\n        // See https://stackoverflow.com/a/38979205.\r\n\r\n        // URL is protocol-relative (= absolute)\r\n        if (url.indexOf(\"//\") === 0) {\r\n            return true;\r\n        }\r\n\r\n        // URL has no protocol (= relative)\r\n        if (url.indexOf(\"://\") === -1) {\r\n            return false;\r\n        }\r\n\r\n        // URL does not contain a dot, i.e. no TLD (= relative, possibly REST)\r\n        if (url.indexOf(\".\") === -1) {\r\n            return false;\r\n        }\r\n\r\n        // URL does not contain a single slash (= relative)\r\n        if (url.indexOf(\"/\") === -1) {\r\n            return false;\r\n        }\r\n\r\n        // The first colon comes after the first slash (= relative)\r\n        if (url.indexOf(\":\") > url.indexOf(\"/\")) {\r\n            return false;\r\n        }\r\n\r\n        // Protocol is defined before first dot (= absolute)\r\n        if (url.indexOf(\"://\") < url.indexOf(\".\")) {\r\n            return true;\r\n        }\r\n        if (url.indexOf(\"data:\") === 0 || url.indexOf(\"blob:\") === 0) {\r\n            return true;\r\n        }\r\n\r\n        // Anything else must be relative\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * Sets the base URL to use to load scripts\r\n     */\r\n    public static set ScriptBaseUrl(value: string) {\r\n        FileToolsOptions.ScriptBaseUrl = value;\r\n    }\r\n\r\n    public static get ScriptBaseUrl(): string {\r\n        return FileToolsOptions.ScriptBaseUrl;\r\n    }\r\n\r\n    /**\r\n     * Sets a preprocessing function to run on a source URL before importing it\r\n     * Note that this function will execute AFTER the base URL is appended to the URL\r\n     */\r\n    public static set ScriptPreprocessUrl(func: (source: string) => string) {\r\n        FileToolsOptions.ScriptPreprocessUrl = func;\r\n    }\r\n\r\n    public static get ScriptPreprocessUrl(): (source: string) => string {\r\n        return FileToolsOptions.ScriptPreprocessUrl;\r\n    }\r\n\r\n    /**\r\n     * Enable/Disable Custom HTTP Request Headers globally.\r\n     * default = false\r\n     * @see CustomRequestHeaders\r\n     */\r\n    public static UseCustomRequestHeaders = false;\r\n\r\n    /**\r\n     * Custom HTTP Request Headers to be sent with XMLHttpRequests\r\n     * i.e. when loading files, where the server/service expects an Authorization header\r\n     */\r\n    public static CustomRequestHeaders = WebRequest.CustomRequestHeaders;\r\n\r\n    /**\r\n     * Gets or sets the retry strategy to apply when an error happens while loading an asset\r\n     */\r\n    public static get DefaultRetryStrategy() {\r\n        return FileToolsOptions.DefaultRetryStrategy;\r\n    }\r\n\r\n    public static set DefaultRetryStrategy(strategy: (url: string, request: WebRequest, retryIndex: number) => number) {\r\n        FileToolsOptions.DefaultRetryStrategy = strategy;\r\n    }\r\n\r\n    /**\r\n     * Default behavior for cors in the application.\r\n     * It can be a string if the expected behavior is identical in the entire app.\r\n     * Or a callback to be able to set it per url or on a group of them (in case of Video source for instance)\r\n     */\r\n    public static get CorsBehavior(): string | ((url: string | string[]) => string) {\r\n        return FileToolsOptions.CorsBehavior;\r\n    }\r\n\r\n    public static set CorsBehavior(value: string | ((url: string | string[]) => string)) {\r\n        FileToolsOptions.CorsBehavior = value;\r\n    }\r\n\r\n    /**\r\n     * Gets or sets a global variable indicating if fallback texture must be used when a texture cannot be loaded\r\n     * @ignorenaming\r\n     */\r\n    public static get UseFallbackTexture() {\r\n        return EngineStore.UseFallbackTexture;\r\n    }\r\n\r\n    public static set UseFallbackTexture(value: boolean) {\r\n        EngineStore.UseFallbackTexture = value;\r\n    }\r\n\r\n    /**\r\n     * Use this object to register external classes like custom textures or material\r\n     * to allow the loaders to instantiate them\r\n     */\r\n    public static get RegisteredExternalClasses() {\r\n        return InstantiationTools.RegisteredExternalClasses;\r\n    }\r\n\r\n    public static set RegisteredExternalClasses(classes: { [key: string]: Object }) {\r\n        InstantiationTools.RegisteredExternalClasses = classes;\r\n    }\r\n\r\n    /**\r\n     * Texture content used if a texture cannot loaded\r\n     * @ignorenaming\r\n     */\r\n    // eslint-disable-next-line @typescript-eslint/naming-convention\r\n    public static get fallbackTexture() {\r\n        return EngineStore.FallbackTexture;\r\n    }\r\n\r\n    // eslint-disable-next-line @typescript-eslint/naming-convention\r\n    public static set fallbackTexture(value: string) {\r\n        EngineStore.FallbackTexture = value;\r\n    }\r\n\r\n    /**\r\n     * Read the content of a byte array at a specified coordinates (taking in account wrapping)\r\n     * @param u defines the coordinate on X axis\r\n     * @param v defines the coordinate on Y axis\r\n     * @param width defines the width of the source data\r\n     * @param height defines the height of the source data\r\n     * @param pixels defines the source byte array\r\n     * @param color defines the output color\r\n     */\r\n    public static FetchToRef(u: number, v: number, width: number, height: number, pixels: Uint8Array, color: IColor4Like): void {\r\n        const wrappedU = (Math.abs(u) * width) % width | 0;\r\n        const wrappedV = (Math.abs(v) * height) % height | 0;\r\n\r\n        const position = (wrappedU + wrappedV * width) * 4;\r\n        color.r = pixels[position] / 255;\r\n        color.g = pixels[position + 1] / 255;\r\n        color.b = pixels[position + 2] / 255;\r\n        color.a = pixels[position + 3] / 255;\r\n    }\r\n\r\n    /**\r\n     * Interpolates between a and b via alpha\r\n     * @param a The lower value (returned when alpha = 0)\r\n     * @param b The upper value (returned when alpha = 1)\r\n     * @param alpha The interpolation-factor\r\n     * @returns The mixed value\r\n     */\r\n    public static Mix(a: number, b: number, alpha: number): number {\r\n        return 0;\r\n    }\r\n\r\n    /**\r\n     * Tries to instantiate a new object from a given class name\r\n     * @param className defines the class name to instantiate\r\n     * @returns the new object or null if the system was not able to do the instantiation\r\n     */\r\n    public static Instantiate(className: string): any {\r\n        return InstantiationTools.Instantiate(className);\r\n    }\r\n\r\n    /**\r\n     * Polyfill for setImmediate\r\n     * @param action defines the action to execute after the current execution block\r\n     */\r\n    public static SetImmediate(action: () => void) {\r\n        TimingTools.SetImmediate(action);\r\n    }\r\n\r\n    /**\r\n     * Function indicating if a number is an exponent of 2\r\n     * @param value defines the value to test\r\n     * @returns true if the value is an exponent of 2\r\n     */\r\n    public static IsExponentOfTwo(value: number): boolean {\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Returns the nearest 32-bit single precision float representation of a Number\r\n     * @param value A Number.  If the parameter is of a different type, it will get converted\r\n     * to a number or to NaN if it cannot be converted\r\n     * @returns number\r\n     */\r\n    public static FloatRound(value: number): number {\r\n        return Math.fround(value);\r\n    }\r\n\r\n    /**\r\n     * Extracts the filename from a path\r\n     * @param path defines the path to use\r\n     * @returns the filename\r\n     */\r\n    public static GetFilename(path: string): string {\r\n        const index = path.lastIndexOf(\"/\");\r\n        if (index < 0) {\r\n            return path;\r\n        }\r\n\r\n        return path.substring(index + 1);\r\n    }\r\n\r\n    /**\r\n     * Extracts the \"folder\" part of a path (everything before the filename).\r\n     * @param uri The URI to extract the info from\r\n     * @param returnUnchangedIfNoSlash Do not touch the URI if no slashes are present\r\n     * @returns The \"folder\" part of the path\r\n     */\r\n    public static GetFolderPath(uri: string, returnUnchangedIfNoSlash = false): string {\r\n        const index = uri.lastIndexOf(\"/\");\r\n        if (index < 0) {\r\n            if (returnUnchangedIfNoSlash) {\r\n                return uri;\r\n            }\r\n            return \"\";\r\n        }\r\n\r\n        return uri.substring(0, index + 1);\r\n    }\r\n\r\n    /**\r\n     * Extracts text content from a DOM element hierarchy\r\n     * Back Compat only, please use GetDOMTextContent instead.\r\n     */\r\n    public static GetDOMTextContent = GetDOMTextContent;\r\n\r\n    /**\r\n     * Convert an angle in radians to degrees\r\n     * @param angle defines the angle to convert\r\n     * @returns the angle in degrees\r\n     */\r\n    public static ToDegrees(angle: number): number {\r\n        return (angle * 180) / Math.PI;\r\n    }\r\n\r\n    /**\r\n     * Convert an angle in degrees to radians\r\n     * @param angle defines the angle to convert\r\n     * @returns the angle in radians\r\n     */\r\n    public static ToRadians(angle: number): number {\r\n        return (angle * Math.PI) / 180;\r\n    }\r\n\r\n    /**\r\n     * Smooth angle changes (kind of low-pass filter), in particular for device orientation \"shaking\"\r\n     * Use trigonometric functions to avoid discontinuity (0/360, -180/180)\r\n     * @param previousAngle defines last angle value, in degrees\r\n     * @param newAngle defines new angle value, in degrees\r\n     * @param smoothFactor defines smoothing sensitivity; min 0: no smoothing, max 1: new data ignored\r\n     * @returns the angle in degrees\r\n     */\r\n    public static SmoothAngleChange(previousAngle: number, newAngle: number, smoothFactor = 0.9): number {\r\n        const previousAngleRad = this.ToRadians(previousAngle);\r\n        const newAngleRad = this.ToRadians(newAngle);\r\n        return this.ToDegrees(\r\n            Math.atan2(\r\n                (1 - smoothFactor) * Math.sin(newAngleRad) + smoothFactor * Math.sin(previousAngleRad),\r\n                (1 - smoothFactor) * Math.cos(newAngleRad) + smoothFactor * Math.cos(previousAngleRad)\r\n            )\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Returns an array if obj is not an array\r\n     * @param obj defines the object to evaluate as an array\r\n     * @param allowsNullUndefined defines a boolean indicating if obj is allowed to be null or undefined\r\n     * @returns either obj directly if obj is an array or a new array containing obj\r\n     */\r\n    public static MakeArray(obj: any, allowsNullUndefined?: boolean): Nullable<Array<any>> {\r\n        if (allowsNullUndefined !== true && (obj === undefined || obj == null)) {\r\n            return null;\r\n        }\r\n\r\n        return Array.isArray(obj) ? obj : [obj];\r\n    }\r\n\r\n    /**\r\n     * Gets the pointer prefix to use\r\n     * @param engine defines the engine we are finding the prefix for\r\n     * @returns \"pointer\" if touch is enabled. Else returns \"mouse\"\r\n     */\r\n    public static GetPointerPrefix(engine: Engine): string {\r\n        let eventPrefix = \"pointer\";\r\n\r\n        // Check if pointer events are supported\r\n        if (IsWindowObjectExist() && !window.PointerEvent) {\r\n            eventPrefix = \"mouse\";\r\n        }\r\n\r\n        // Special Fallback MacOS Safari...\r\n        if (\r\n            engine._badDesktopOS &&\r\n            !engine._badOS &&\r\n            // And not ipad pros who claim to be macs...\r\n            !(document && \"ontouchend\" in document)\r\n        ) {\r\n            eventPrefix = \"mouse\";\r\n        }\r\n\r\n        return eventPrefix;\r\n    }\r\n\r\n    /**\r\n     * Sets the cors behavior on a dom element. This will add the required Tools.CorsBehavior to the element.\r\n     * @param url define the url we are trying\r\n     * @param element define the dom element where to configure the cors policy\r\n     * @param element.crossOrigin\r\n     */\r\n    public static SetCorsBehavior(url: string | string[], element: { crossOrigin: string | null }): void {\r\n        SetCorsBehavior(url, element);\r\n    }\r\n\r\n    /**\r\n     * Sets the referrerPolicy behavior on a dom element.\r\n     * @param referrerPolicy define the referrer policy to use\r\n     * @param element define the dom element where to configure the referrer policy\r\n     * @param element.referrerPolicy\r\n     */\r\n    public static SetReferrerPolicyBehavior(referrerPolicy: Nullable<ReferrerPolicy>, element: { referrerPolicy: string | null }): void {\r\n        element.referrerPolicy = referrerPolicy;\r\n    }\r\n\r\n    // External files\r\n\r\n    /**\r\n     * Removes unwanted characters from an url\r\n     * @param url defines the url to clean\r\n     * @returns the cleaned url\r\n     */\r\n    public static CleanUrl(url: string): string {\r\n        url = url.replace(/#/gm, \"%23\");\r\n        return url;\r\n    }\r\n\r\n    /**\r\n     * Gets or sets a function used to pre-process url before using them to load assets\r\n     */\r\n    public static get PreprocessUrl() {\r\n        return FileToolsOptions.PreprocessUrl;\r\n    }\r\n\r\n    public static set PreprocessUrl(processor: (url: string) => string) {\r\n        FileToolsOptions.PreprocessUrl = processor;\r\n    }\r\n\r\n    /**\r\n     * Loads an image as an HTMLImageElement.\r\n     * @param input url string, ArrayBuffer, or Blob to load\r\n     * @param onLoad callback called when the image successfully loads\r\n     * @param onError callback called when the image fails to load\r\n     * @param offlineProvider offline provider for caching\r\n     * @param mimeType optional mime type\r\n     * @param imageBitmapOptions optional the options to use when creating an ImageBitmap\r\n     * @returns the HTMLImageElement of the loaded image\r\n     */\r\n    public static LoadImage(\r\n        input: string | ArrayBuffer | Blob,\r\n        onLoad: (img: HTMLImageElement | ImageBitmap) => void,\r\n        onError: (message?: string, exception?: any) => void,\r\n        offlineProvider: Nullable<IOfflineProvider>,\r\n        mimeType?: string,\r\n        imageBitmapOptions?: ImageBitmapOptions\r\n    ): Nullable<HTMLImageElement> {\r\n        return FileToolLoadImage(input, onLoad, onError, offlineProvider, mimeType, imageBitmapOptions);\r\n    }\r\n\r\n    /**\r\n     * Loads a file from a url\r\n     * @param url url string, ArrayBuffer, or Blob to load\r\n     * @param onSuccess callback called when the file successfully loads\r\n     * @param onProgress callback called while file is loading (if the server supports this mode)\r\n     * @param offlineProvider defines the offline provider for caching\r\n     * @param useArrayBuffer defines a boolean indicating that date must be returned as ArrayBuffer\r\n     * @param onError callback called when the file fails to load\r\n     * @returns a file request object\r\n     */\r\n    public static LoadFile(\r\n        url: string,\r\n        onSuccess: (data: string | ArrayBuffer, responseURL?: string) => void,\r\n        onProgress?: (data: any) => void,\r\n        offlineProvider?: IOfflineProvider,\r\n        useArrayBuffer?: boolean,\r\n        onError?: (request?: WebRequest, exception?: any) => void\r\n    ): IFileRequest {\r\n        return FileToolsLoadFile(url, onSuccess, onProgress, offlineProvider, useArrayBuffer, onError);\r\n    }\r\n\r\n    // Note that this must come first since useArrayBuffer defaults to true below.\r\n    public static LoadFileAsync(url: string, useArrayBuffer?: true): Promise<ArrayBuffer>;\r\n    public static LoadFileAsync(url: string, useArrayBuffer?: false): Promise<string>;\r\n\r\n    /**\r\n     * Loads a file from a url\r\n     * @param url the file url to load\r\n     * @param useArrayBuffer defines a boolean indicating that date must be returned as ArrayBuffer\r\n     * @returns a promise containing an ArrayBuffer corresponding to the loaded file\r\n     */\r\n    public static LoadFileAsync(url: string, useArrayBuffer = true): Promise<ArrayBuffer | string> {\r\n        return new Promise((resolve, reject) => {\r\n            FileToolsLoadFile(\r\n                url,\r\n                (data) => {\r\n                    resolve(data);\r\n                },\r\n                undefined,\r\n                undefined,\r\n                useArrayBuffer,\r\n                (request, exception) => {\r\n                    reject(exception);\r\n                }\r\n            );\r\n        });\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public static _DefaultCdnUrl = \"https://cdn.babylonjs.com\";\r\n\r\n    /**\r\n     * Get a script URL including preprocessing\r\n     * @param scriptUrl the script Url to process\r\n     * @param forceAbsoluteUrl force the script to be an absolute url (adding the current base url if necessary)\r\n     * @returns a modified URL to use\r\n     */\r\n    public static GetBabylonScriptURL(scriptUrl: Nullable<string>, forceAbsoluteUrl?: boolean): string {\r\n        if (!scriptUrl) {\r\n            return \"\";\r\n        }\r\n        // if the base URL was set, and the script Url is an absolute path change the default path\r\n        if (Tools.ScriptBaseUrl && scriptUrl.startsWith(Tools._DefaultCdnUrl)) {\r\n            // change the default host, which is https://cdn.babylonjs.com with the one defined\r\n            // make sure no trailing slash is present\r\n\r\n            const baseUrl = Tools.ScriptBaseUrl[Tools.ScriptBaseUrl.length - 1] === \"/\" ? Tools.ScriptBaseUrl.substring(0, Tools.ScriptBaseUrl.length - 1) : Tools.ScriptBaseUrl;\r\n            scriptUrl = scriptUrl.replace(Tools._DefaultCdnUrl, baseUrl);\r\n        }\r\n\r\n        // run the preprocessor\r\n        scriptUrl = Tools.ScriptPreprocessUrl(scriptUrl);\r\n\r\n        if (forceAbsoluteUrl) {\r\n            scriptUrl = Tools.GetAbsoluteUrl(scriptUrl);\r\n        }\r\n\r\n        return scriptUrl;\r\n    }\r\n\r\n    /**\r\n     * This function is used internally by babylon components to load a script (identified by an url). When the url returns, the\r\n     * content of this file is added into a new script element, attached to the DOM (body element)\r\n     * @param scriptUrl defines the url of the script to load\r\n     * @param onSuccess defines the callback called when the script is loaded\r\n     * @param onError defines the callback to call if an error occurs\r\n     * @param scriptId defines the id of the script element\r\n     */\r\n    public static LoadBabylonScript(scriptUrl: string, onSuccess: () => void, onError?: (message?: string, exception?: any) => void, scriptId?: string) {\r\n        scriptUrl = Tools.GetBabylonScriptURL(scriptUrl);\r\n        Tools.LoadScript(scriptUrl, onSuccess, onError);\r\n    }\r\n\r\n    /**\r\n     * Load an asynchronous script (identified by an url). When the url returns, the\r\n     * content of this file is added into a new script element, attached to the DOM (body element)\r\n     * @param scriptUrl defines the url of the script to laod\r\n     * @returns a promise request object\r\n     */\r\n    public static LoadBabylonScriptAsync(scriptUrl: string): Promise<void> {\r\n        scriptUrl = Tools.GetBabylonScriptURL(scriptUrl);\r\n        return Tools.LoadScriptAsync(scriptUrl);\r\n    }\r\n\r\n    /**\r\n     * This function is used internally by babylon components to load a script (identified by an url). When the url returns, the\r\n     * content of this file is added into a new script element, attached to the DOM (body element)\r\n     * @param scriptUrl defines the url of the script to load\r\n     * @param onSuccess defines the callback called when the script is loaded\r\n     * @param onError defines the callback to call if an error occurs\r\n     * @param scriptId defines the id of the script element\r\n     */\r\n    public static LoadScript(scriptUrl: string, onSuccess: () => void, onError?: (message?: string, exception?: any) => void, scriptId?: string) {\r\n        if (typeof importScripts === \"function\") {\r\n            try {\r\n                importScripts(scriptUrl);\r\n                onSuccess();\r\n            } catch (e) {\r\n                onError?.(`Unable to load script '${scriptUrl}' in worker`, e);\r\n            }\r\n            return;\r\n        } else if (!IsWindowObjectExist()) {\r\n            onError?.(`Cannot load script '${scriptUrl}' outside of a window or a worker`);\r\n            return;\r\n        }\r\n        const head = document.getElementsByTagName(\"head\")[0];\r\n        const script = document.createElement(\"script\");\r\n        script.setAttribute(\"type\", \"text/javascript\");\r\n        script.setAttribute(\"src\", scriptUrl);\r\n        if (scriptId) {\r\n            script.id = scriptId;\r\n        }\r\n\r\n        script.onload = () => {\r\n            if (onSuccess) {\r\n                onSuccess();\r\n            }\r\n        };\r\n\r\n        script.onerror = (e) => {\r\n            if (onError) {\r\n                onError(`Unable to load script '${scriptUrl}'`, e);\r\n            }\r\n        };\r\n\r\n        head.appendChild(script);\r\n    }\r\n\r\n    /**\r\n     * Load an asynchronous script (identified by an url). When the url returns, the\r\n     * content of this file is added into a new script element, attached to the DOM (body element)\r\n     * @param scriptUrl defines the url of the script to load\r\n     * @param scriptId defines the id of the script element\r\n     * @returns a promise request object\r\n     */\r\n    public static LoadScriptAsync(scriptUrl: string, scriptId?: string): Promise<void> {\r\n        return new Promise((resolve, reject) => {\r\n            this.LoadScript(\r\n                scriptUrl,\r\n                () => {\r\n                    resolve();\r\n                },\r\n                (message, exception) => {\r\n                    reject(exception || new Error(message));\r\n                },\r\n                scriptId\r\n            );\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Loads a file from a blob\r\n     * @param fileToLoad defines the blob to use\r\n     * @param callback defines the callback to call when data is loaded\r\n     * @param progressCallback defines the callback to call during loading process\r\n     * @returns a file request object\r\n     */\r\n    public static ReadFileAsDataURL(fileToLoad: Blob, callback: (data: any) => void, progressCallback: (ev: ProgressEvent) => any): IFileRequest {\r\n        const reader = new FileReader();\r\n\r\n        const request: IFileRequest = {\r\n            onCompleteObservable: new Observable<IFileRequest>(),\r\n            abort: () => reader.abort(),\r\n        };\r\n\r\n        reader.onloadend = () => {\r\n            request.onCompleteObservable.notifyObservers(request);\r\n        };\r\n\r\n        reader.onload = (e) => {\r\n            //target doesn't have result from ts 1.3\r\n            callback((<any>e.target)[\"result\"]);\r\n        };\r\n\r\n        reader.onprogress = progressCallback;\r\n\r\n        reader.readAsDataURL(fileToLoad);\r\n\r\n        return request;\r\n    }\r\n\r\n    /**\r\n     * Reads a file from a File object\r\n     * @param file defines the file to load\r\n     * @param onSuccess defines the callback to call when data is loaded\r\n     * @param onProgress defines the callback to call during loading process\r\n     * @param useArrayBuffer defines a boolean indicating that data must be returned as an ArrayBuffer\r\n     * @param onError defines the callback to call when an error occurs\r\n     * @returns a file request object\r\n     */\r\n    public static ReadFile(\r\n        file: File,\r\n        onSuccess: (data: any) => void,\r\n        onProgress?: (ev: ProgressEvent) => any,\r\n        useArrayBuffer?: boolean,\r\n        onError?: (error: ReadFileError) => void\r\n    ): IFileRequest {\r\n        return FileToolsReadFile(file, onSuccess, onProgress, useArrayBuffer, onError);\r\n    }\r\n\r\n    /**\r\n     * Creates a data url from a given string content\r\n     * @param content defines the content to convert\r\n     * @returns the new data url link\r\n     */\r\n    public static FileAsURL(content: string): string {\r\n        const fileBlob = new Blob([content]);\r\n        const url = window.URL;\r\n        const link: string = url.createObjectURL(fileBlob);\r\n        return link;\r\n    }\r\n\r\n    /**\r\n     * Format the given number to a specific decimal format\r\n     * @param value defines the number to format\r\n     * @param decimals defines the number of decimals to use\r\n     * @returns the formatted string\r\n     */\r\n    public static Format(value: number, decimals = 2): string {\r\n        return value.toFixed(decimals);\r\n    }\r\n\r\n    /**\r\n     * Tries to copy an object by duplicating every property\r\n     * @param source defines the source object\r\n     * @param destination defines the target object\r\n     * @param doNotCopyList defines a list of properties to avoid\r\n     * @param mustCopyList defines a list of properties to copy (even if they start with _)\r\n     */\r\n    public static DeepCopy(source: any, destination: any, doNotCopyList?: string[], mustCopyList?: string[]): void {\r\n        DeepCopier.DeepCopy(source, destination, doNotCopyList, mustCopyList);\r\n    }\r\n\r\n    /**\r\n     * Gets a boolean indicating if the given object has no own property\r\n     * @param obj defines the object to test\r\n     * @returns true if object has no own property\r\n     */\r\n    public static IsEmpty(obj: any): boolean {\r\n        for (const i in obj) {\r\n            if (Object.prototype.hasOwnProperty.call(obj, i)) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Function used to register events at window level\r\n     * @param windowElement defines the Window object to use\r\n     * @param events defines the events to register\r\n     */\r\n    public static RegisterTopRootEvents(windowElement: Window, events: { name: string; handler: Nullable<(e: FocusEvent) => any> }[]): void {\r\n        for (let index = 0; index < events.length; index++) {\r\n            const event = events[index];\r\n            windowElement.addEventListener(event.name, <any>event.handler, false);\r\n\r\n            try {\r\n                if (window.parent) {\r\n                    window.parent.addEventListener(event.name, <any>event.handler, false);\r\n                }\r\n            } catch (e) {\r\n                // Silently fails...\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Function used to unregister events from window level\r\n     * @param windowElement defines the Window object to use\r\n     * @param events defines the events to unregister\r\n     */\r\n    public static UnregisterTopRootEvents(windowElement: Window, events: { name: string; handler: Nullable<(e: FocusEvent) => any> }[]): void {\r\n        for (let index = 0; index < events.length; index++) {\r\n            const event = events[index];\r\n            windowElement.removeEventListener(event.name, <any>event.handler);\r\n\r\n            try {\r\n                if (windowElement.parent) {\r\n                    windowElement.parent.removeEventListener(event.name, <any>event.handler);\r\n                }\r\n            } catch (e) {\r\n                // Silently fails...\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Dumps the current bound framebuffer\r\n     * @param width defines the rendering width\r\n     * @param height defines the rendering height\r\n     * @param engine defines the hosting engine\r\n     * @param successCallback defines the callback triggered once the data are available\r\n     * @param mimeType defines the mime type of the result\r\n     * @param fileName defines the filename to download. If present, the result will automatically be downloaded\r\n     * @param quality The quality of the image if lossy mimeType is used (e.g. image/jpeg, image/webp). See {@link https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/toBlob | HTMLCanvasElement.toBlob()}'s `quality` parameter.\r\n     * @returns a void promise\r\n     */\r\n    public static async DumpFramebuffer(\r\n        width: number,\r\n        height: number,\r\n        engine: Engine,\r\n        successCallback?: (data: string) => void,\r\n        mimeType = \"image/png\",\r\n        fileName?: string,\r\n        quality?: number\r\n    ) {\r\n        throw _WarnImport(\"DumpTools\");\r\n    }\r\n\r\n    /**\r\n     * Dumps an array buffer\r\n     * @param width defines the rendering width\r\n     * @param height defines the rendering height\r\n     * @param data the data array\r\n     * @param successCallback defines the callback triggered once the data are available\r\n     * @param mimeType defines the mime type of the result\r\n     * @param fileName defines the filename to download. If present, the result will automatically be downloaded\r\n     * @param invertY true to invert the picture in the Y dimension\r\n     * @param toArrayBuffer true to convert the data to an ArrayBuffer (encoded as `mimeType`) instead of a base64 string\r\n     * @param quality The quality of the image if lossy mimeType is used (e.g. image/jpeg, image/webp). See {@link https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/toBlob | HTMLCanvasElement.toBlob()}'s `quality` parameter.\r\n     */\r\n    public static DumpData(\r\n        width: number,\r\n        height: number,\r\n        data: ArrayBufferView,\r\n        successCallback?: (data: string | ArrayBuffer) => void,\r\n        mimeType = \"image/png\",\r\n        fileName?: string,\r\n        invertY = false,\r\n        toArrayBuffer = false,\r\n        quality?: number\r\n    ) {\r\n        throw _WarnImport(\"DumpTools\");\r\n    }\r\n\r\n    // eslint-disable-next-line jsdoc/require-returns-check\r\n    /**\r\n     * Dumps an array buffer\r\n     * @param width defines the rendering width\r\n     * @param height defines the rendering height\r\n     * @param data the data array\r\n     * @param mimeType defines the mime type of the result\r\n     * @param fileName defines the filename to download. If present, the result will automatically be downloaded\r\n     * @param invertY true to invert the picture in the Y dimension\r\n     * @param toArrayBuffer true to convert the data to an ArrayBuffer (encoded as `mimeType`) instead of a base64 string\r\n     * @param quality The quality of the image if lossy mimeType is used (e.g. image/jpeg, image/webp). See {@link https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/toBlob | HTMLCanvasElement.toBlob()}'s `quality` parameter.\r\n     * @returns a promise that resolve to the final data\r\n     */\r\n    public static DumpDataAsync(\r\n        width: number,\r\n        height: number,\r\n        data: ArrayBufferView,\r\n        mimeType = \"image/png\",\r\n        fileName?: string,\r\n        invertY = false,\r\n        toArrayBuffer = false,\r\n        quality?: number\r\n    ): Promise<string | ArrayBuffer> {\r\n        throw _WarnImport(\"DumpTools\");\r\n    }\r\n\r\n    private static _IsOffScreenCanvas(canvas: HTMLCanvasElement | OffscreenCanvas): canvas is OffscreenCanvas {\r\n        return (canvas as OffscreenCanvas).convertToBlob !== undefined;\r\n    }\r\n\r\n    /**\r\n     * Converts the canvas data to blob.\r\n     * This acts as a polyfill for browsers not supporting the to blob function.\r\n     * @param canvas Defines the canvas to extract the data from (can be an offscreen canvas)\r\n     * @param successCallback Defines the callback triggered once the data are available\r\n     * @param mimeType Defines the mime type of the result\r\n     * @param quality The quality of the image if lossy mimeType is used (e.g. image/jpeg, image/webp). See {@link https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/toBlob | HTMLCanvasElement.toBlob()}'s `quality` parameter.\r\n     */\r\n    static ToBlob(canvas: HTMLCanvasElement | OffscreenCanvas, successCallback: (blob: Nullable<Blob>) => void, mimeType = \"image/png\", quality?: number): void {\r\n        // We need HTMLCanvasElement.toBlob for HD screenshots\r\n        if (!Tools._IsOffScreenCanvas(canvas) && !canvas.toBlob) {\r\n            //  low performance polyfill based on toDataURL (https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/toBlob)\r\n            canvas.toBlob = function (callback, type, quality) {\r\n                setTimeout(() => {\r\n                    const binStr = atob(this.toDataURL(type, quality).split(\",\")[1]),\r\n                        len = binStr.length,\r\n                        arr = new Uint8Array(len);\r\n\r\n                    for (let i = 0; i < len; i++) {\r\n                        arr[i] = binStr.charCodeAt(i);\r\n                    }\r\n                    callback(new Blob([arr]));\r\n                });\r\n            };\r\n        }\r\n        if (Tools._IsOffScreenCanvas(canvas)) {\r\n            canvas\r\n                .convertToBlob({\r\n                    type: mimeType,\r\n                    quality,\r\n                })\r\n                .then((blob) => successCallback(blob));\r\n        } else {\r\n            canvas.toBlob(\r\n                function (blob) {\r\n                    successCallback(blob);\r\n                },\r\n                mimeType,\r\n                quality\r\n            );\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Download a Blob object\r\n     * @param blob the Blob object\r\n     * @param fileName the file name to download\r\n     */\r\n    static DownloadBlob(blob: Blob, fileName?: string) {\r\n        //Creating a link if the browser have the download attribute on the a tag, to automatically start download generated image.\r\n        if (\"download\" in document.createElement(\"a\")) {\r\n            if (!fileName) {\r\n                const date = new Date();\r\n                const stringDate =\r\n                    (date.getFullYear() + \"-\" + (date.getMonth() + 1)).slice(2) + \"-\" + date.getDate() + \"_\" + date.getHours() + \"-\" + (\"0\" + date.getMinutes()).slice(-2);\r\n                fileName = \"screenshot_\" + stringDate + \".png\";\r\n            }\r\n            Tools.Download(blob, fileName);\r\n        } else {\r\n            if (blob && typeof URL !== \"undefined\") {\r\n                const url = URL.createObjectURL(blob);\r\n\r\n                const newWindow = window.open(\"\");\r\n                if (!newWindow) {\r\n                    return;\r\n                }\r\n                const img = newWindow.document.createElement(\"img\");\r\n                img.onload = function () {\r\n                    // no longer need to read the blob so it's revoked\r\n                    URL.revokeObjectURL(url);\r\n                };\r\n                img.src = url;\r\n                newWindow.document.body.appendChild(img);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Encodes the canvas data to base 64, or automatically downloads the result if `fileName` is defined.\r\n     * @param canvas The canvas to get the data from, which can be an offscreen canvas.\r\n     * @param successCallback The callback which is triggered once the data is available. If `fileName` is defined, the callback will be invoked after the download occurs, and the `data` argument will be an empty string.\r\n     * @param mimeType The mime type of the result.\r\n     * @param fileName The name of the file to download. If defined, the result will automatically be downloaded. If not defined, and `successCallback` is also not defined, the result will automatically be downloaded with an auto-generated file name.\r\n     * @param quality The quality of the image if lossy mimeType is used (e.g. image/jpeg, image/webp). See {@link https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/toBlob | HTMLCanvasElement.toBlob()}'s `quality` parameter.\r\n     */\r\n    static EncodeScreenshotCanvasData(\r\n        canvas: HTMLCanvasElement | OffscreenCanvas,\r\n        successCallback?: (data: string) => void,\r\n        mimeType = \"image/png\",\r\n        fileName?: string,\r\n        quality?: number\r\n    ): void {\r\n        if (typeof fileName === \"string\" || !successCallback) {\r\n            this.ToBlob(\r\n                canvas,\r\n                function (blob) {\r\n                    if (blob) {\r\n                        Tools.DownloadBlob(blob, fileName);\r\n                    }\r\n                    if (successCallback) {\r\n                        successCallback(\"\");\r\n                    }\r\n                },\r\n                mimeType,\r\n                quality\r\n            );\r\n        } else if (successCallback) {\r\n            if (Tools._IsOffScreenCanvas(canvas)) {\r\n                canvas\r\n                    .convertToBlob({\r\n                        type: mimeType,\r\n                        quality,\r\n                    })\r\n                    .then((blob) => {\r\n                        const reader = new FileReader();\r\n                        reader.readAsDataURL(blob);\r\n                        reader.onloadend = () => {\r\n                            const base64data = reader.result;\r\n                            successCallback(base64data as string);\r\n                        };\r\n                    });\r\n                return;\r\n            }\r\n            const base64Image = canvas.toDataURL(mimeType, quality);\r\n            successCallback(base64Image);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Downloads a blob in the browser\r\n     * @param blob defines the blob to download\r\n     * @param fileName defines the name of the downloaded file\r\n     */\r\n    public static Download(blob: Blob, fileName: string): void {\r\n        if (typeof URL === \"undefined\") {\r\n            return;\r\n        }\r\n\r\n        const url = window.URL.createObjectURL(blob);\r\n        const a = document.createElement(\"a\");\r\n        document.body.appendChild(a);\r\n        a.style.display = \"none\";\r\n        a.href = url;\r\n        a.download = fileName;\r\n        a.addEventListener(\"click\", () => {\r\n            if (a.parentElement) {\r\n                a.parentElement.removeChild(a);\r\n            }\r\n        });\r\n        a.click();\r\n        window.URL.revokeObjectURL(url);\r\n    }\r\n\r\n    /**\r\n     * Will return the right value of the noPreventDefault variable\r\n     * Needed to keep backwards compatibility to the old API.\r\n     *\r\n     * @param args arguments passed to the attachControl function\r\n     * @returns the correct value for noPreventDefault\r\n     */\r\n    public static BackCompatCameraNoPreventDefault(args: IArguments): boolean {\r\n        // is it used correctly?\r\n        if (typeof args[0] === \"boolean\") {\r\n            return args[0];\r\n        } else if (typeof args[1] === \"boolean\") {\r\n            return args[1];\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * Captures a screenshot of the current rendering\r\n     * @see https://doc.babylonjs.com/features/featuresDeepDive/scene/renderToPNG\r\n     * @param engine defines the rendering engine\r\n     * @param camera defines the source camera\r\n     * @param size This parameter can be set to a single number or to an object with the\r\n     * following (optional) properties: precision, width, height. If a single number is passed,\r\n     * it will be used for both width and height. If an object is passed, the screenshot size\r\n     * will be derived from the parameters. The precision property is a multiplier allowing\r\n     * rendering at a higher or lower resolution\r\n     * @param successCallback defines the callback receives a single parameter which contains the\r\n     * screenshot as a string of base64-encoded characters. This string can be assigned to the\r\n     * src parameter of an <img> to display it\r\n     * @param mimeType defines the MIME type of the screenshot image (default: image/png).\r\n     * Check your browser for supported MIME types\r\n     * @param forceDownload force the system to download the image even if a successCallback is provided\r\n     * @param quality The quality of the image if lossy mimeType is used (e.g. image/jpeg, image/webp). See {@link https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/toBlob | HTMLCanvasElement.toBlob()}'s `quality` parameter.\r\n     */\r\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n    public static CreateScreenshot(\r\n        engine: Engine,\r\n        camera: Camera,\r\n        size: IScreenshotSize | number,\r\n        successCallback?: (data: string) => void,\r\n        mimeType = \"image/png\",\r\n        forceDownload = false,\r\n        quality?: number\r\n    ): void {\r\n        throw _WarnImport(\"ScreenshotTools\");\r\n    }\r\n\r\n    // eslint-disable-next-line jsdoc/require-returns-check\r\n    /**\r\n     * Captures a screenshot of the current rendering\r\n     * @see https://doc.babylonjs.com/features/featuresDeepDive/scene/renderToPNG\r\n     * @param engine defines the rendering engine\r\n     * @param camera defines the source camera\r\n     * @param size This parameter can be set to a single number or to an object with the\r\n     * following (optional) properties: precision, width, height. If a single number is passed,\r\n     * it will be used for both width and height. If an object is passed, the screenshot size\r\n     * will be derived from the parameters. The precision property is a multiplier allowing\r\n     * rendering at a higher or lower resolution\r\n     * @param mimeType defines the MIME type of the screenshot image (default: image/png).\r\n     * Check your browser for supported MIME types\r\n     * @param quality The quality of the image if lossy mimeType is used (e.g. image/jpeg, image/webp). See {@link https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/toBlob | HTMLCanvasElement.toBlob()}'s `quality` parameter.\r\n     * @returns screenshot as a string of base64-encoded characters. This string can be assigned\r\n     * to the src parameter of an <img> to display it\r\n     */\r\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n    public static CreateScreenshotAsync(engine: Engine, camera: Camera, size: IScreenshotSize | number, mimeType = \"image/png\", quality?: number): Promise<string> {\r\n        throw _WarnImport(\"ScreenshotTools\");\r\n    }\r\n\r\n    /**\r\n     * Generates an image screenshot from the specified camera.\r\n     * @see https://doc.babylonjs.com/features/featuresDeepDive/scene/renderToPNG\r\n     * @param engine The engine to use for rendering\r\n     * @param camera The camera to use for rendering\r\n     * @param size This parameter can be set to a single number or to an object with the\r\n     * following (optional) properties: precision, width, height. If a single number is passed,\r\n     * it will be used for both width and height. If an object is passed, the screenshot size\r\n     * will be derived from the parameters. The precision property is a multiplier allowing\r\n     * rendering at a higher or lower resolution\r\n     * @param successCallback The callback receives a single parameter which contains the\r\n     * screenshot as a string of base64-encoded characters. This string can be assigned to the\r\n     * src parameter of an <img> to display it\r\n     * @param mimeType The MIME type of the screenshot image (default: image/png).\r\n     * Check your browser for supported MIME types\r\n     * @param samples Texture samples (default: 1)\r\n     * @param antialiasing Whether antialiasing should be turned on or not (default: false)\r\n     * @param fileName A name for for the downloaded file.\r\n     * @param renderSprites Whether the sprites should be rendered or not (default: false)\r\n     * @param enableStencilBuffer Whether the stencil buffer should be enabled or not (default: false)\r\n     * @param useLayerMask if the camera's layer mask should be used to filter what should be rendered (default: true)\r\n     * @param quality The quality of the image if lossy mimeType is used (e.g. image/jpeg, image/webp). See {@link https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/toBlob | HTMLCanvasElement.toBlob()}'s `quality` parameter.\r\n     */\r\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n    public static CreateScreenshotUsingRenderTarget(\r\n        engine: Engine,\r\n        camera: Camera,\r\n        size: IScreenshotSize | number,\r\n        successCallback?: (data: string) => void,\r\n        mimeType = \"image/png\",\r\n        samples = 1,\r\n        antialiasing = false,\r\n        fileName?: string,\r\n        renderSprites = false,\r\n        enableStencilBuffer = false,\r\n        useLayerMask = true,\r\n        quality?: number\r\n    ): void {\r\n        throw _WarnImport(\"ScreenshotTools\");\r\n    }\r\n\r\n    // eslint-disable-next-line jsdoc/require-returns-check\r\n    /**\r\n     * Generates an image screenshot from the specified camera.\r\n     * @see https://doc.babylonjs.com/features/featuresDeepDive/scene/renderToPNG\r\n     * @param engine The engine to use for rendering\r\n     * @param camera The camera to use for rendering\r\n     * @param size This parameter can be set to a single number or to an object with the\r\n     * following (optional) properties: precision, width, height. If a single number is passed,\r\n     * it will be used for both width and height. If an object is passed, the screenshot size\r\n     * will be derived from the parameters. The precision property is a multiplier allowing\r\n     * rendering at a higher or lower resolution\r\n     * @param mimeType The MIME type of the screenshot image (default: image/png).\r\n     * Check your browser for supported MIME types\r\n     * @param samples Texture samples (default: 1)\r\n     * @param antialiasing Whether antialiasing should be turned on or not (default: false)\r\n     * @param fileName A name for for the downloaded file.\r\n     * @returns screenshot as a string of base64-encoded characters. This string can be assigned\r\n     * @param renderSprites Whether the sprites should be rendered or not (default: false)\r\n     * @param enableStencilBuffer Whether the stencil buffer should be enabled or not (default: false)\r\n     * @param useLayerMask if the camera's layer mask should be used to filter what should be rendered (default: true)\r\n     * @param quality The quality of the image if lossy mimeType is used (e.g. image/jpeg, image/webp). See {@link https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/toBlob | HTMLCanvasElement.toBlob()}'s `quality` parameter.\r\n     * to the src parameter of an <img> to display it\r\n     */\r\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n    public static CreateScreenshotUsingRenderTargetAsync(\r\n        engine: Engine,\r\n        camera: Camera,\r\n        size: IScreenshotSize | number,\r\n        mimeType = \"image/png\",\r\n        samples = 1,\r\n        antialiasing = false,\r\n        fileName?: string,\r\n        renderSprites = false,\r\n        enableStencilBuffer = false,\r\n        useLayerMask = true,\r\n        quality?: number\r\n    ): Promise<string> {\r\n        throw _WarnImport(\"ScreenshotTools\");\r\n    }\r\n\r\n    /**\r\n     * Implementation from http://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid-in-javascript/2117523#answer-2117523\r\n     * Be aware Math.random() could cause collisions, but:\r\n     * \"All but 6 of the 128 bits of the ID are randomly generated, which means that for any two ids, there's a 1 in 2^^122 (or 5.3x10^^36) chance they'll collide\"\r\n     * @returns a pseudo random id\r\n     */\r\n    public static RandomId(): string {\r\n        return RandomGUID();\r\n    }\r\n\r\n    /**\r\n     * Test if the given uri is a base64 string\r\n     * @deprecated Please use FileTools.IsBase64DataUrl instead.\r\n     * @param uri The uri to test\r\n     * @returns True if the uri is a base64 string or false otherwise\r\n     */\r\n    public static IsBase64(uri: string): boolean {\r\n        return IsBase64DataUrl(uri);\r\n    }\r\n\r\n    /**\r\n     * Decode the given base64 uri.\r\n     * @deprecated Please use FileTools.DecodeBase64UrlToBinary instead.\r\n     * @param uri The uri to decode\r\n     * @returns The decoded base64 data.\r\n     */\r\n    public static DecodeBase64(uri: string): ArrayBuffer {\r\n        return DecodeBase64UrlToBinary(uri);\r\n    }\r\n\r\n    // eslint-disable-next-line jsdoc/require-returns-check, jsdoc/require-param\r\n    /**\r\n     * @returns the absolute URL of a given (relative) url\r\n     */\r\n    public static GetAbsoluteUrl: (url: string) => string =\r\n        typeof document === \"object\"\r\n            ? (url) => {\r\n                  const a = document.createElement(\"a\");\r\n                  a.href = url;\r\n                  return a.href;\r\n              }\r\n            : typeof URL === \"function\" && typeof location === \"object\"\r\n              ? (url) => new URL(url, location.origin).href\r\n              : () => {\r\n                    throw new Error(\"Unable to get absolute URL. Override BABYLON.Tools.GetAbsoluteUrl to a custom implementation for the current context.\");\r\n                };\r\n\r\n    // Logs\r\n    /**\r\n     * No log\r\n     */\r\n    public static readonly NoneLogLevel = Logger.NoneLogLevel;\r\n    /**\r\n     * Only message logs\r\n     */\r\n    public static readonly MessageLogLevel = Logger.MessageLogLevel;\r\n    /**\r\n     * Only warning logs\r\n     */\r\n    public static readonly WarningLogLevel = Logger.WarningLogLevel;\r\n    /**\r\n     * Only error logs\r\n     */\r\n    public static readonly ErrorLogLevel = Logger.ErrorLogLevel;\r\n    /**\r\n     * All logs\r\n     */\r\n    public static readonly AllLogLevel = Logger.AllLogLevel;\r\n\r\n    /**\r\n     * Gets a value indicating the number of loading errors\r\n     * @ignorenaming\r\n     */\r\n    // eslint-disable-next-line @typescript-eslint/naming-convention\r\n    public static get errorsCount(): number {\r\n        return Logger.errorsCount;\r\n    }\r\n\r\n    /**\r\n     * Callback called when a new log is added\r\n     */\r\n    public static OnNewCacheEntry: (entry: string) => void;\r\n\r\n    /**\r\n     * Log a message to the console\r\n     * @param message defines the message to log\r\n     */\r\n    public static Log(message: string): void {\r\n        Logger.Log(message);\r\n    }\r\n\r\n    /**\r\n     * Write a warning message to the console\r\n     * @param message defines the message to log\r\n     */\r\n    public static Warn(message: string): void {\r\n        Logger.Warn(message);\r\n    }\r\n\r\n    /**\r\n     * Write an error message to the console\r\n     * @param message defines the message to log\r\n     */\r\n    public static Error(message: string): void {\r\n        Logger.Error(message);\r\n    }\r\n\r\n    /**\r\n     * Gets current log cache (list of logs)\r\n     */\r\n    public static get LogCache(): string {\r\n        return Logger.LogCache;\r\n    }\r\n\r\n    /**\r\n     * Clears the log cache\r\n     */\r\n    public static ClearLogCache(): void {\r\n        Logger.ClearLogCache();\r\n    }\r\n\r\n    /**\r\n     * Sets the current log level (MessageLogLevel / WarningLogLevel / ErrorLogLevel)\r\n     */\r\n    public static set LogLevels(level: number) {\r\n        Logger.LogLevels = level;\r\n    }\r\n\r\n    /**\r\n     * Checks if the window object exists\r\n     * Back Compat only, please use IsWindowObjectExist instead.\r\n     */\r\n    public static IsWindowObjectExist = IsWindowObjectExist;\r\n\r\n    // Performances\r\n\r\n    /**\r\n     * No performance log\r\n     */\r\n    public static readonly PerformanceNoneLogLevel = 0;\r\n    /**\r\n     * Use user marks to log performance\r\n     */\r\n    public static readonly PerformanceUserMarkLogLevel = 1;\r\n    /**\r\n     * Log performance to the console\r\n     */\r\n    public static readonly PerformanceConsoleLogLevel = 2;\r\n\r\n    private static _Performance: Performance;\r\n\r\n    /**\r\n     * Sets the current performance log level\r\n     */\r\n    public static set PerformanceLogLevel(level: number) {\r\n        if ((level & Tools.PerformanceUserMarkLogLevel) === Tools.PerformanceUserMarkLogLevel) {\r\n            Tools.StartPerformanceCounter = Tools._StartUserMark;\r\n            Tools.EndPerformanceCounter = Tools._EndUserMark;\r\n            return;\r\n        }\r\n\r\n        if ((level & Tools.PerformanceConsoleLogLevel) === Tools.PerformanceConsoleLogLevel) {\r\n            Tools.StartPerformanceCounter = Tools._StartPerformanceConsole;\r\n            Tools.EndPerformanceCounter = Tools._EndPerformanceConsole;\r\n            return;\r\n        }\r\n\r\n        Tools.StartPerformanceCounter = Tools._StartPerformanceCounterDisabled;\r\n        Tools.EndPerformanceCounter = Tools._EndPerformanceCounterDisabled;\r\n    }\r\n\r\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n    private static _StartPerformanceCounterDisabled(counterName: string, condition?: boolean): void {}\r\n\r\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n    private static _EndPerformanceCounterDisabled(counterName: string, condition?: boolean): void {}\r\n\r\n    private static _StartUserMark(counterName: string, condition = true): void {\r\n        if (!Tools._Performance) {\r\n            if (!IsWindowObjectExist()) {\r\n                return;\r\n            }\r\n            Tools._Performance = window.performance;\r\n        }\r\n\r\n        if (!condition || !Tools._Performance.mark) {\r\n            return;\r\n        }\r\n        Tools._Performance.mark(counterName + \"-Begin\");\r\n    }\r\n\r\n    private static _EndUserMark(counterName: string, condition = true): void {\r\n        if (!condition || !Tools._Performance.mark) {\r\n            return;\r\n        }\r\n        Tools._Performance.mark(counterName + \"-End\");\r\n        Tools._Performance.measure(counterName, counterName + \"-Begin\", counterName + \"-End\");\r\n    }\r\n\r\n    private static _StartPerformanceConsole(counterName: string, condition = true): void {\r\n        if (!condition) {\r\n            return;\r\n        }\r\n\r\n        Tools._StartUserMark(counterName, condition);\r\n\r\n        if (console.time) {\r\n            console.time(counterName);\r\n        }\r\n    }\r\n\r\n    private static _EndPerformanceConsole(counterName: string, condition = true): void {\r\n        if (!condition) {\r\n            return;\r\n        }\r\n\r\n        Tools._EndUserMark(counterName, condition);\r\n\r\n        console.timeEnd(counterName);\r\n    }\r\n\r\n    /**\r\n     * Starts a performance counter\r\n     */\r\n    public static StartPerformanceCounter: (counterName: string, condition?: boolean) => void = Tools._StartPerformanceCounterDisabled;\r\n\r\n    /**\r\n     * Ends a specific performance counter\r\n     */\r\n    public static EndPerformanceCounter: (counterName: string, condition?: boolean) => void = Tools._EndPerformanceCounterDisabled;\r\n\r\n    /**\r\n     * Gets either window.performance.now() if supported or Date.now() else\r\n     */\r\n    public static get Now(): number {\r\n        return PrecisionDate.Now;\r\n    }\r\n\r\n    /**\r\n     * This method will return the name of the class used to create the instance of the given object.\r\n     * It will works only on Javascript basic data types (number, string, ...) and instance of class declared with the @className decorator.\r\n     * @param object the object to get the class name from\r\n     * @param isType defines if the object is actually a type\r\n     * @returns the name of the class, will be \"object\" for a custom data type not using the @className decorator\r\n     */\r\n    public static GetClassName(object: any, isType = false): string {\r\n        let name = null;\r\n\r\n        if (!isType && object.getClassName) {\r\n            name = object.getClassName();\r\n        } else {\r\n            if (object instanceof Object) {\r\n                const classObj = isType ? object : Object.getPrototypeOf(object);\r\n                name = classObj.constructor[\"__bjsclassName__\"];\r\n            }\r\n            if (!name) {\r\n                name = typeof object;\r\n            }\r\n        }\r\n        return name;\r\n    }\r\n\r\n    /**\r\n     * Gets the first element of an array satisfying a given predicate\r\n     * @param array defines the array to browse\r\n     * @param predicate defines the predicate to use\r\n     * @returns null if not found or the element\r\n     */\r\n    public static First<T>(array: Array<T>, predicate: (item: T) => boolean): Nullable<T> {\r\n        for (const el of array) {\r\n            if (predicate(el)) {\r\n                return el;\r\n            }\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * This method will return the name of the full name of the class, including its owning module (if any).\r\n     * It will works only on Javascript basic data types (number, string, ...) and instance of class declared with the @className decorator or implementing a method getClassName():string (in which case the module won't be specified).\r\n     * @param object the object to get the class name from\r\n     * @param isType defines if the object is actually a type\r\n     * @returns a string that can have two forms: \"moduleName.className\" if module was specified when the class' Name was registered or \"className\" if there was not module specified.\r\n     * @ignorenaming\r\n     */\r\n    // eslint-disable-next-line @typescript-eslint/naming-convention\r\n    public static getFullClassName(object: any, isType = false): Nullable<string> {\r\n        let className = null;\r\n        let moduleName = null;\r\n\r\n        if (!isType && object.getClassName) {\r\n            className = object.getClassName();\r\n        } else {\r\n            if (object instanceof Object) {\r\n                const classObj = isType ? object : Object.getPrototypeOf(object);\r\n                className = classObj.constructor[\"__bjsclassName__\"];\r\n                moduleName = classObj.constructor[\"__bjsmoduleName__\"];\r\n            }\r\n            if (!className) {\r\n                className = typeof object;\r\n            }\r\n        }\r\n\r\n        if (!className) {\r\n            return null;\r\n        }\r\n\r\n        return (moduleName != null ? moduleName + \".\" : \"\") + className;\r\n    }\r\n\r\n    /**\r\n     * Returns a promise that resolves after the given amount of time.\r\n     * @param delay Number of milliseconds to delay\r\n     * @returns Promise that resolves after the given amount of time\r\n     */\r\n    public static DelayAsync(delay: number): Promise<void> {\r\n        return new Promise((resolve) => {\r\n            setTimeout(() => {\r\n                resolve();\r\n            }, delay);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Utility function to detect if the current user agent is Safari\r\n     * @returns whether or not the current user agent is safari\r\n     */\r\n    public static IsSafari(): boolean {\r\n        if (!IsNavigatorAvailable()) {\r\n            return false;\r\n        }\r\n\r\n        return /^((?!chrome|android).)*safari/i.test(navigator.userAgent);\r\n    }\r\n}\r\n\r\n/**\r\n * Use this className as a decorator on a given class definition to add it a name and optionally its module.\r\n * You can then use the Tools.getClassName(obj) on an instance to retrieve its class name.\r\n * This method is the only way to get it done in all cases, even if the .js file declaring the class is minified\r\n * @param name The name of the class, case should be preserved\r\n * @param module The name of the Module hosting the class, optional, but strongly recommended to specify if possible. Case should be preserved.\r\n * @returns a decorator function to apply on the class definition.\r\n */\r\nexport function className(name: string, module?: string): (target: Object) => void {\r\n    return (target: Object) => {\r\n        (<any>target)[\"__bjsclassName__\"] = name;\r\n        (<any>target)[\"__bjsmoduleName__\"] = module != null ? module : null;\r\n    };\r\n}\r\n\r\n/**\r\n * An implementation of a loop for asynchronous functions.\r\n */\r\nexport class AsyncLoop {\r\n    /**\r\n     * Defines the current index of the loop.\r\n     */\r\n    public index: number;\r\n    private _done: boolean;\r\n    private _fn: (asyncLoop: AsyncLoop) => void;\r\n    private _successCallback: () => void;\r\n\r\n    /**\r\n     * Constructor.\r\n     * @param iterations the number of iterations.\r\n     * @param func the function to run each iteration\r\n     * @param successCallback the callback that will be called upon successful execution\r\n     * @param offset starting offset.\r\n     */\r\n    constructor(\r\n        /**\r\n         * Defines the number of iterations for the loop\r\n         */\r\n        public iterations: number,\r\n        func: (asyncLoop: AsyncLoop) => void,\r\n        successCallback: () => void,\r\n        offset = 0\r\n    ) {\r\n        this.index = offset - 1;\r\n        this._done = false;\r\n        this._fn = func;\r\n        this._successCallback = successCallback;\r\n    }\r\n\r\n    /**\r\n     * Execute the next iteration. Must be called after the last iteration was finished.\r\n     */\r\n    public executeNext(): void {\r\n        if (!this._done) {\r\n            if (this.index + 1 < this.iterations) {\r\n                ++this.index;\r\n                this._fn(this);\r\n            } else {\r\n                this.breakLoop();\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Break the loop and run the success callback.\r\n     */\r\n    public breakLoop(): void {\r\n        this._done = true;\r\n        this._successCallback();\r\n    }\r\n\r\n    /**\r\n     * Create and run an async loop.\r\n     * @param iterations the number of iterations.\r\n     * @param fn the function to run each iteration\r\n     * @param successCallback the callback that will be called upon successful execution\r\n     * @param offset starting offset.\r\n     * @returns the created async loop object\r\n     */\r\n    public static Run(iterations: number, fn: (asyncLoop: AsyncLoop) => void, successCallback: () => void, offset = 0): AsyncLoop {\r\n        const loop = new AsyncLoop(iterations, fn, successCallback, offset);\r\n\r\n        loop.executeNext();\r\n\r\n        return loop;\r\n    }\r\n\r\n    /**\r\n     * A for-loop that will run a given number of iterations synchronous and the rest async.\r\n     * @param iterations total number of iterations\r\n     * @param syncedIterations number of synchronous iterations in each async iteration.\r\n     * @param fn the function to call each iteration.\r\n     * @param callback a success call back that will be called when iterating stops.\r\n     * @param breakFunction a break condition (optional)\r\n     * @param timeout timeout settings for the setTimeout function. default - 0.\r\n     * @returns the created async loop object\r\n     */\r\n    public static SyncAsyncForLoop(\r\n        iterations: number,\r\n        syncedIterations: number,\r\n        fn: (iteration: number) => void,\r\n        callback: () => void,\r\n        breakFunction?: () => boolean,\r\n        timeout = 0\r\n    ): AsyncLoop {\r\n        return AsyncLoop.Run(\r\n            Math.ceil(iterations / syncedIterations),\r\n            (loop: AsyncLoop) => {\r\n                if (breakFunction && breakFunction()) {\r\n                    loop.breakLoop();\r\n                } else {\r\n                    setTimeout(() => {\r\n                        for (let i = 0; i < syncedIterations; ++i) {\r\n                            const iteration = loop.index * syncedIterations + i;\r\n                            if (iteration >= iterations) {\r\n                                break;\r\n                            }\r\n                            fn(iteration);\r\n                            if (breakFunction && breakFunction()) {\r\n                                loop.breakLoop();\r\n                                break;\r\n                            }\r\n                        }\r\n                        loop.executeNext();\r\n                    }, timeout);\r\n                }\r\n            },\r\n            callback\r\n        );\r\n    }\r\n}\r\n\r\nTools.Mix = Mix;\r\nTools.IsExponentOfTwo = IsExponentOfTwo;\r\n\r\n// Will only be define if Tools is imported freeing up some space when only engine is required\r\nEngineStore.FallbackTexture =\r\n    \"data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z\";\r\n"],
  "mappings": "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",
  "names": ["url", "DecodeBase64UrlToBinary", "DecodeBase64UrlToString", "FileToolsOptions", "IsBase64DataUrl", "IsFileURL", "LoadFile", "LoadImage", "ReadFile", "RequestFile", "SetCorsBehavior", "className", "className", "quality"]
}
