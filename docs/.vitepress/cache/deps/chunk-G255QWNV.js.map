{
  "version": 3,
  "sources": ["../../../dev/core/src/Misc/logger.ts", "../../../dev/core/src/Misc/devTools.ts", "../../../dev/core/src/Misc/domManagement.ts", "../../../dev/core/src/Misc/precisionDate.ts", "../../../dev/core/src/Materials/shaderLanguage.ts", "../../../dev/core/src/Engines/shaderStore.ts", "../../../dev/core/src/Engines/Processors/shaderCodeNode.ts", "../../../dev/core/src/Engines/Processors/shaderCodeCursor.ts", "../../../dev/core/src/Engines/Processors/shaderCodeConditionNode.ts", "../../../dev/core/src/Engines/Processors/shaderCodeTestNode.ts", "../../../dev/core/src/Engines/Processors/Expressions/shaderDefineExpression.ts", "../../../dev/core/src/Engines/Processors/Expressions/Operators/shaderDefineIsDefinedOperator.ts", "../../../dev/core/src/Engines/Processors/Expressions/Operators/shaderDefineOrOperator.ts", "../../../dev/core/src/Engines/Processors/Expressions/Operators/shaderDefineAndOperator.ts", "../../../dev/core/src/Engines/Processors/Expressions/Operators/shaderDefineArithmeticOperator.ts", "../../../dev/core/src/Engines/Processors/shaderProcessor.ts", "../../../dev/core/src/Materials/effect.ts", "../../../dev/core/src/States/depthCullingState.ts", "../../../dev/core/src/States/stencilState.ts", "../../../dev/core/src/States/alphaCullingState.ts", "../../../dev/core/src/Materials/Textures/textureSampler.ts", "../../../dev/core/src/Materials/Textures/internalTexture.ts", "../../../dev/core/src/Engines/WebGL/webGL2ShaderProcessors.ts", "../../../dev/core/src/Buffers/dataBuffer.ts", "../../../dev/core/src/Meshes/WebGL/webGLDataBuffer.ts", "../../../dev/core/src/Engines/WebGL/webGLPipelineContext.ts", "../../../dev/core/src/Engines/WebGL/webGLHardwareTexture.ts", "../../../dev/core/src/Materials/drawWrapper.ts", "../../../dev/core/src/States/stencilStateComposer.ts", "../../../dev/core/src/Engines/WebGL/webGLShaderProcessors.ts", "../../../dev/core/src/Engines/thinEngine.ts"],
  "sourcesContent": ["/* eslint-disable no-console */\r\n/**\r\n * Logger used throughout the application to allow configuration of\r\n * the log level required for the messages.\r\n */\r\nexport class Logger {\r\n    /**\r\n     * No log\r\n     */\r\n    public static readonly NoneLogLevel = 0;\r\n    /**\r\n     * Only message logs\r\n     */\r\n    public static readonly MessageLogLevel = 1;\r\n    /**\r\n     * Only warning logs\r\n     */\r\n    public static readonly WarningLogLevel = 2;\r\n    /**\r\n     * Only error logs\r\n     */\r\n    public static readonly ErrorLogLevel = 4;\r\n    /**\r\n     * All logs\r\n     */\r\n    public static readonly AllLogLevel = 7;\r\n\r\n    /**\r\n     * Message to display when a message has been logged too many times\r\n     */\r\n    public static MessageLimitReached = \"Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.\";\r\n\r\n    private static _LogCache = \"\";\r\n    private static _LogLimitOutputs: { [message: string]: { limit: number; current: number } } = {};\r\n    // levels according to the (binary) numbering.\r\n    private static _Levels = [\r\n        {},\r\n        { color: \"white\", logFunc: console.log, name: \"Log\" },\r\n        { color: \"orange\", logFunc: console.warn, name: \"Warn\" },\r\n        {},\r\n        { color: \"red\", logFunc: console.error, name: \"Error\" },\r\n    ];\r\n\r\n    /**\r\n     * Gets a value indicating the number of loading errors\r\n     * @ignorenaming\r\n     */\r\n    // eslint-disable-next-line @typescript-eslint/naming-convention\r\n    public static errorsCount = 0;\r\n\r\n    /**\r\n     * Callback called when a new log is added\r\n     */\r\n    public static OnNewCacheEntry: (entry: string) => void;\r\n\r\n    private static _CheckLimit(message: string, limit: number): boolean {\r\n        let entry = Logger._LogLimitOutputs[message];\r\n        if (!entry) {\r\n            entry = { limit, current: 1 };\r\n            Logger._LogLimitOutputs[message] = entry;\r\n        } else {\r\n            entry.current++;\r\n        }\r\n        return entry.current <= entry.limit;\r\n    }\r\n\r\n    private static _GenerateLimitMessage(message: string, level: number = 1): void {\r\n        const entry = Logger._LogLimitOutputs[message];\r\n        if (!entry || !Logger.MessageLimitReached) {\r\n            return;\r\n        }\r\n        const type = this._Levels[level];\r\n        if (entry.current === entry.limit) {\r\n            Logger[type.name as \"Log\" | \"Warn\" | \"Error\"](Logger.MessageLimitReached.replace(/%LIMIT%/g, \"\" + entry.limit).replace(/%TYPE%/g, type.name ?? \"\"));\r\n        }\r\n    }\r\n\r\n    private static _AddLogEntry(entry: string) {\r\n        Logger._LogCache = entry + Logger._LogCache;\r\n\r\n        if (Logger.OnNewCacheEntry) {\r\n            Logger.OnNewCacheEntry(entry);\r\n        }\r\n    }\r\n\r\n    private static _FormatMessage(message: string): string {\r\n        const padStr = (i: number) => (i < 10 ? \"0\" + i : \"\" + i);\r\n\r\n        const date = new Date();\r\n        return \"[\" + padStr(date.getHours()) + \":\" + padStr(date.getMinutes()) + \":\" + padStr(date.getSeconds()) + \"]: \" + message;\r\n    }\r\n\r\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n    private static _LogDisabled(message: string | any[], limit?: number): void {\r\n        // nothing to do\r\n    }\r\n    private static _LogEnabled(level: number = 1, message: string | any[], limit?: number): void {\r\n        // take first message if array\r\n        const msg = Array.isArray(message) ? message[0] : message;\r\n        if (limit !== undefined && !Logger._CheckLimit(msg, limit)) {\r\n            return;\r\n        }\r\n\r\n        const formattedMessage = Logger._FormatMessage(msg);\r\n        const type = this._Levels[level];\r\n        const optionals = Array.isArray(message) ? message.slice(1) : [];\r\n        type.logFunc && type.logFunc(\"BJS - \" + formattedMessage, ...optionals);\r\n\r\n        const entry = `<div style='color:${type.color}'>${formattedMessage}</div><br>`;\r\n        Logger._AddLogEntry(entry);\r\n        Logger._GenerateLimitMessage(msg, level);\r\n    }\r\n\r\n    /**\r\n     * Log a message to the console\r\n     */\r\n    public static Log: (message: string | any[], limit?: number) => void = Logger._LogEnabled.bind(Logger, Logger.MessageLogLevel);\r\n\r\n    /**\r\n     * Write a warning message to the console\r\n     */\r\n    public static Warn: (message: string | any[], limit?: number) => void = Logger._LogEnabled.bind(Logger, Logger.WarningLogLevel);\r\n\r\n    /**\r\n     * Write an error message to the console\r\n     */\r\n    public static Error: (message: string | any[], limit?: number) => void = Logger._LogEnabled.bind(Logger, Logger.ErrorLogLevel);\r\n\r\n    /**\r\n     * Gets current log cache (list of logs)\r\n     */\r\n    public static get LogCache(): string {\r\n        return Logger._LogCache;\r\n    }\r\n\r\n    /**\r\n     * Clears the log cache\r\n     */\r\n    public static ClearLogCache(): void {\r\n        Logger._LogCache = \"\";\r\n        Logger._LogLimitOutputs = {};\r\n        Logger.errorsCount = 0;\r\n    }\r\n\r\n    /**\r\n     * Sets the current log level (MessageLogLevel / WarningLogLevel / ErrorLogLevel)\r\n     */\r\n    public static set LogLevels(level: number) {\r\n        Logger.Log = Logger._LogDisabled;\r\n        Logger.Warn = Logger._LogDisabled;\r\n        Logger.Error = Logger._LogDisabled;\r\n        [Logger.MessageLogLevel, Logger.WarningLogLevel, Logger.ErrorLogLevel].forEach((l) => {\r\n            if ((level & l) === l) {\r\n                const type = this._Levels[l];\r\n                Logger[type.name as \"Log\" | \"Warn\" | \"Error\"] = Logger._LogEnabled.bind(Logger, l);\r\n            }\r\n        });\r\n    }\r\n}\r\n", "const warnedMap: { [key: string]: boolean } = {};\r\n/**\r\n * @internal\r\n */\r\nexport function _WarnImport(name: string, warnOnce = false) {\r\n    if (warnOnce && warnedMap[name]) {\r\n        return;\r\n    }\r\n    warnedMap[name] = true;\r\n    return `${name} needs to be imported before as it contains a side-effect required by your code.`;\r\n}\r\n", "/* eslint-disable @typescript-eslint/naming-convention */\r\n/**\r\n * Checks if the window object exists\r\n * @returns true if the window object exists\r\n */\r\nexport function IsWindowObjectExist(): boolean {\r\n    return typeof window !== \"undefined\";\r\n}\r\n\r\n/**\r\n * Checks if the navigator object exists\r\n * @returns true if the navigator object exists\r\n */\r\nexport function IsNavigatorAvailable(): boolean {\r\n    return typeof navigator !== \"undefined\";\r\n}\r\n\r\n/**\r\n * Check if the document object exists\r\n * @returns true if the document object exists\r\n */\r\nexport function IsDocumentAvailable(): boolean {\r\n    return typeof document !== \"undefined\";\r\n}\r\n\r\n/**\r\n * Extracts text content from a DOM element hierarchy\r\n * @param element defines the root element\r\n * @returns a string\r\n */\r\nexport function GetDOMTextContent(element: HTMLElement): string {\r\n    let result = \"\";\r\n    let child = element.firstChild;\r\n\r\n    while (child) {\r\n        if (child.nodeType === 3) {\r\n            result += child.textContent;\r\n        }\r\n        child = <any>child.nextSibling;\r\n    }\r\n\r\n    return result;\r\n}\r\n\r\n/**\r\n * Sets of helpers dealing with the DOM and some of the recurrent functions needed in\r\n * Babylon.js\r\n */\r\nexport const DomManagement = {\r\n    /**\r\n     * Checks if the window object exists\r\n     * @returns true if the window object exists\r\n     */\r\n    IsWindowObjectExist,\r\n\r\n    /**\r\n     * Checks if the navigator object exists\r\n     * @returns true if the navigator object exists\r\n     */\r\n    IsNavigatorAvailable,\r\n\r\n    /**\r\n     * Check if the document object exists\r\n     * @returns true if the document object exists\r\n     */\r\n    IsDocumentAvailable,\r\n    /**\r\n     * Extracts text content from a DOM element hierarchy\r\n     * @param element defines the root element\r\n     * @returns a string\r\n     */\r\n    GetDOMTextContent,\r\n};\r\n", "import { IsWindowObjectExist } from \"./domManagement\";\r\n\r\n/**\r\n * Class containing a set of static utilities functions for precision date\r\n */\r\nexport class PrecisionDate {\r\n    /**\r\n     * Gets either window.performance.now() if supported or Date.now() else\r\n     */\r\n    public static get Now(): number {\r\n        if (IsWindowObjectExist() && window.performance && window.performance.now) {\r\n            return window.performance.now();\r\n        }\r\n\r\n        return Date.now();\r\n    }\r\n}\r\n", "/**\r\n * Language of the shader code\r\n */\r\nexport enum ShaderLanguage {\r\n    /** language is GLSL (used by WebGL) */\r\n    GLSL,\r\n    /** language is WGSL (used by WebGPU) */\r\n    WGSL,\r\n}\r\n", "import { ShaderLanguage } from \"../Materials/shaderLanguage\";\r\n\r\n/**\r\n * Defines the shader related stores and directory\r\n */\r\nexport class ShaderStore {\r\n    /**\r\n     * Gets or sets the relative url used to load shaders if using the engine in non-minified mode\r\n     */\r\n    public static ShadersRepository = \"src/Shaders/\";\r\n    /**\r\n     * Store of each shader (The can be looked up using effect.key)\r\n     */\r\n    public static ShadersStore: { [key: string]: string } = {};\r\n    /**\r\n     * Store of each included file for a shader (The can be looked up using effect.key)\r\n     */\r\n    public static IncludesShadersStore: { [key: string]: string } = {};\r\n\r\n    /**\r\n     * Gets or sets the relative url used to load shaders (WGSL) if using the engine in non-minified mode\r\n     */\r\n    public static ShadersRepositoryWGSL = \"src/ShadersWGSL/\";\r\n    /**\r\n     * Store of each shader  (WGSL)\r\n     */\r\n    public static ShadersStoreWGSL: { [key: string]: string } = {};\r\n    /**\r\n     * Store of each included file for a shader (WGSL)\r\n     */\r\n    public static IncludesShadersStoreWGSL: { [key: string]: string } = {};\r\n\r\n    /**\r\n     * Gets the shaders repository path for a given shader language\r\n     * @param shaderLanguage the shader language\r\n     * @returns the path to the shaders repository\r\n     */\r\n    public static GetShadersRepository(shaderLanguage = ShaderLanguage.GLSL): string {\r\n        return shaderLanguage === ShaderLanguage.GLSL ? ShaderStore.ShadersRepository : ShaderStore.ShadersRepositoryWGSL;\r\n    }\r\n\r\n    /**\r\n     * Gets the shaders store of a given shader language\r\n     * @param shaderLanguage the shader language\r\n     * @returns the shaders store\r\n     */\r\n    public static GetShadersStore(shaderLanguage = ShaderLanguage.GLSL): { [key: string]: string } {\r\n        return shaderLanguage === ShaderLanguage.GLSL ? ShaderStore.ShadersStore : ShaderStore.ShadersStoreWGSL;\r\n    }\r\n\r\n    /**\r\n     * Gets the include shaders store of a given shader language\r\n     * @param shaderLanguage the shader language\r\n     * @returns the include shaders store\r\n     */\r\n    public static GetIncludesShadersStore(shaderLanguage = ShaderLanguage.GLSL): { [key: string]: string } {\r\n        return shaderLanguage === ShaderLanguage.GLSL ? ShaderStore.IncludesShadersStore : ShaderStore.IncludesShadersStoreWGSL;\r\n    }\r\n}\r\n", "import type { ProcessingOptions } from \"./shaderProcessingOptions\";\r\n\r\nconst defaultAttributeKeywordName = \"attribute\";\r\nconst defaultVaryingKeywordName = \"varying\";\r\n\r\n/** @internal */\r\nexport class ShaderCodeNode {\r\n    line: string;\r\n    children: ShaderCodeNode[] = [];\r\n    additionalDefineKey?: string;\r\n    additionalDefineValue?: string;\r\n\r\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n    isValid(preprocessors: { [key: string]: string }): boolean {\r\n        return true;\r\n    }\r\n\r\n    process(preprocessors: { [key: string]: string }, options: ProcessingOptions): string {\r\n        let result = \"\";\r\n        if (this.line) {\r\n            let value: string = this.line;\r\n            const processor = options.processor;\r\n            if (processor) {\r\n                // This must be done before other replacements to avoid mistakenly changing something that was already changed.\r\n                if (processor.lineProcessor) {\r\n                    value = processor.lineProcessor(value, options.isFragment, options.processingContext);\r\n                }\r\n\r\n                const attributeKeyword = options.processor?.attributeKeywordName ?? defaultAttributeKeywordName;\r\n                const varyingKeyword =\r\n                    options.isFragment && options.processor?.varyingFragmentKeywordName\r\n                        ? options.processor?.varyingFragmentKeywordName\r\n                        : !options.isFragment && options.processor?.varyingVertexKeywordName\r\n                          ? options.processor?.varyingVertexKeywordName\r\n                          : defaultVaryingKeywordName;\r\n\r\n                if (!options.isFragment && processor.attributeProcessor && this.line.startsWith(attributeKeyword)) {\r\n                    value = processor.attributeProcessor(this.line, preprocessors, options.processingContext);\r\n                } else if (\r\n                    processor.varyingProcessor &&\r\n                    (processor.varyingCheck?.(this.line, options.isFragment) || (!processor.varyingCheck && this.line.startsWith(varyingKeyword)))\r\n                ) {\r\n                    value = processor.varyingProcessor(this.line, options.isFragment, preprocessors, options.processingContext);\r\n                } else if (processor.uniformProcessor && processor.uniformRegexp && processor.uniformRegexp.test(this.line)) {\r\n                    if (!options.lookForClosingBracketForUniformBuffer) {\r\n                        value = processor.uniformProcessor(this.line, options.isFragment, preprocessors, options.processingContext);\r\n                    }\r\n                } else if (processor.uniformBufferProcessor && processor.uniformBufferRegexp && processor.uniformBufferRegexp.test(this.line)) {\r\n                    if (!options.lookForClosingBracketForUniformBuffer) {\r\n                        value = processor.uniformBufferProcessor(this.line, options.isFragment, options.processingContext);\r\n                        options.lookForClosingBracketForUniformBuffer = true;\r\n                    }\r\n                } else if (processor.textureProcessor && processor.textureRegexp && processor.textureRegexp.test(this.line)) {\r\n                    value = processor.textureProcessor(this.line, options.isFragment, preprocessors, options.processingContext);\r\n                } else if ((processor.uniformProcessor || processor.uniformBufferProcessor) && this.line.startsWith(\"uniform\") && !options.lookForClosingBracketForUniformBuffer) {\r\n                    const regex = /uniform\\s+(?:(?:highp)?|(?:lowp)?)\\s*(\\S+)\\s+(\\S+)\\s*;/;\r\n\r\n                    if (regex.test(this.line)) {\r\n                        // uniform\r\n                        if (processor.uniformProcessor) {\r\n                            value = processor.uniformProcessor(this.line, options.isFragment, preprocessors, options.processingContext);\r\n                        }\r\n                    } else {\r\n                        // Uniform buffer\r\n                        if (processor.uniformBufferProcessor) {\r\n                            value = processor.uniformBufferProcessor(this.line, options.isFragment, options.processingContext);\r\n                            options.lookForClosingBracketForUniformBuffer = true;\r\n                        }\r\n                    }\r\n                }\r\n\r\n                if (options.lookForClosingBracketForUniformBuffer && this.line.indexOf(\"}\") !== -1) {\r\n                    options.lookForClosingBracketForUniformBuffer = false;\r\n                    if (processor.endOfUniformBufferProcessor) {\r\n                        value = processor.endOfUniformBufferProcessor(this.line, options.isFragment, options.processingContext);\r\n                    }\r\n                }\r\n            }\r\n\r\n            result += value + \"\\n\";\r\n        }\r\n\r\n        this.children.forEach((child) => {\r\n            result += child.process(preprocessors, options);\r\n        });\r\n\r\n        if (this.additionalDefineKey) {\r\n            preprocessors[this.additionalDefineKey] = this.additionalDefineValue || \"true\";\r\n        }\r\n\r\n        return result;\r\n    }\r\n}\r\n", "/** @internal */\r\nexport class ShaderCodeCursor {\r\n    private _lines: string[] = [];\r\n    lineIndex: number;\r\n\r\n    get currentLine(): string {\r\n        return this._lines[this.lineIndex];\r\n    }\r\n\r\n    get canRead(): boolean {\r\n        return this.lineIndex < this._lines.length - 1;\r\n    }\r\n\r\n    set lines(value: string[]) {\r\n        this._lines.length = 0;\r\n\r\n        for (const line of value) {\r\n            // Skip empty lines\r\n            if (!line || line === \"\\r\") {\r\n                continue;\r\n            }\r\n\r\n            // Prevent removing line break in macros.\r\n            if (line[0] === \"#\") {\r\n                this._lines.push(line);\r\n                continue;\r\n            }\r\n\r\n            // Do not split single line comments\r\n            const trimmedLine = line.trim();\r\n\r\n            if (!trimmedLine) {\r\n                continue;\r\n            }\r\n\r\n            if (trimmedLine.startsWith(\"//\")) {\r\n                this._lines.push(line);\r\n                continue;\r\n            }\r\n\r\n            // Work with semicolon in the line\r\n            const semicolonIndex = trimmedLine.indexOf(\";\");\r\n\r\n            if (semicolonIndex === -1) {\r\n                // No semicolon in the line\r\n                this._lines.push(trimmedLine);\r\n            } else if (semicolonIndex === trimmedLine.length - 1) {\r\n                // Single semicolon at the end of the line\r\n                // If trimmedLine == \";\", we must not push, to be backward compatible with the old code!\r\n                if (trimmedLine.length > 1) {\r\n                    this._lines.push(trimmedLine);\r\n                }\r\n            } else {\r\n                // Semicolon in the middle of the line\r\n                const split = line.split(\";\");\r\n\r\n                for (let index = 0; index < split.length; index++) {\r\n                    let subLine = split[index];\r\n\r\n                    if (!subLine) {\r\n                        continue;\r\n                    }\r\n\r\n                    subLine = subLine.trim();\r\n\r\n                    if (!subLine) {\r\n                        continue;\r\n                    }\r\n\r\n                    this._lines.push(subLine + (index !== split.length - 1 ? \";\" : \"\"));\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n", "import { ShaderCodeNode } from \"./shaderCodeNode\";\r\nimport type { ProcessingOptions } from \"./shaderProcessingOptions\";\r\n\r\n/** @internal */\r\nexport class ShaderCodeConditionNode extends ShaderCodeNode {\r\n    process(preprocessors: { [key: string]: string }, options: ProcessingOptions) {\r\n        for (let index = 0; index < this.children.length; index++) {\r\n            const node = this.children[index];\r\n\r\n            if (node.isValid(preprocessors)) {\r\n                return node.process(preprocessors, options);\r\n            }\r\n        }\r\n\r\n        return \"\";\r\n    }\r\n}\r\n", "import { ShaderCodeNode } from \"./shaderCodeNode\";\r\nimport type { ShaderDefineExpression } from \"./Expressions/shaderDefineExpression\";\r\n\r\n/** @internal */\r\nexport class ShaderCodeTestNode extends ShaderCodeNode {\r\n    public testExpression: ShaderDefineExpression;\r\n\r\n    public isValid(preprocessors: { [key: string]: string }) {\r\n        return this.testExpression.isTrue(preprocessors);\r\n    }\r\n}\r\n", "/* eslint-disable @typescript-eslint/naming-convention */\r\n/** @internal */\r\nexport class ShaderDefineExpression {\r\n    /**\r\n     * Cache items count limit for the InfixToPostfix cache.\r\n     * It uses to improve the performance of the shader compilation.\r\n     * For details see PR: https://github.com/BabylonJS/Babylon.js/pull/13936\r\n     */\r\n    static InfixToPostfixCacheLimitSize = 50000;\r\n\r\n    /**\r\n     * When the cache size is exceeded, a cache cleanup will be triggered\r\n     * and the cache will be reduced by the size specified\r\n     * in the InfixToPostfixCacheCleanupSize variable, removing entries\r\n     * that have not been accessed the longest.\r\n     */\r\n    static InfixToPostfixCacheCleanupSize = 25000;\r\n\r\n    protected static _InfixToPostfixCache: Map<\r\n        string,\r\n        {\r\n            accessTime: number;\r\n            result: string[];\r\n        }\r\n    > = new Map();\r\n\r\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n    public isTrue(preprocessors: { [key: string]: string }): boolean {\r\n        return true;\r\n    }\r\n\r\n    private static _OperatorPriority: { [name: string]: number } = {\r\n        \")\": 0,\r\n        \"(\": 1,\r\n        \"||\": 2,\r\n        \"&&\": 3,\r\n    };\r\n\r\n    private static _Stack = [\"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\"];\r\n\r\n    public static postfixToInfix(postfix: string[]): string {\r\n        const stack: string[] = [];\r\n\r\n        for (const c of postfix) {\r\n            if (ShaderDefineExpression._OperatorPriority[c] === undefined) {\r\n                stack.push(c);\r\n            } else {\r\n                const v1 = stack[stack.length - 1],\r\n                    v2 = stack[stack.length - 2];\r\n\r\n                stack.length -= 2;\r\n                stack.push(`(${v2}${c}${v1})`);\r\n            }\r\n        }\r\n\r\n        return stack[stack.length - 1];\r\n    }\r\n\r\n    /**\r\n     * Converts an infix expression to a postfix expression.\r\n     *\r\n     * This method is used to transform infix expressions, which are more human-readable,\r\n     * into postfix expressions, also known as Reverse Polish Notation (RPN), that can be\r\n     * evaluated more efficiently by a computer. The conversion is based on the operator\r\n     * priority defined in _OperatorPriority.\r\n     *\r\n     * The function employs a stack-based algorithm for the conversion and caches the result\r\n     * to improve performance. The cache keeps track of each converted expression's access time\r\n     * to manage the cache size and optimize memory usage. When the cache size exceeds a specified\r\n     * limit, the least recently accessed items in the cache are deleted.\r\n     *\r\n     * The cache mechanism is particularly helpful for shader compilation, where the same infix\r\n     * expressions might be encountered repeatedly, hence the caching can speed up the process.\r\n     *\r\n     * @param infix - The infix expression to be converted.\r\n     * @returns The postfix expression as an array of strings.\r\n     */\r\n    public static infixToPostfix(infix: string): string[] {\r\n        // Is infix already in cache\r\n        const cacheItem = ShaderDefineExpression._InfixToPostfixCache.get(infix);\r\n        if (cacheItem) {\r\n            cacheItem.accessTime = Date.now();\r\n            return cacheItem.result;\r\n        }\r\n\r\n        // Is infix contain any operator\r\n        if (!infix.includes(\"&&\") && !infix.includes(\"||\") && !infix.includes(\")\") && !infix.includes(\"(\")) {\r\n            return [infix];\r\n        }\r\n\r\n        const result: string[] = [];\r\n\r\n        let stackIdx = -1;\r\n\r\n        const pushOperand = () => {\r\n            operand = operand.trim();\r\n            if (operand !== \"\") {\r\n                result.push(operand);\r\n                operand = \"\";\r\n            }\r\n        };\r\n\r\n        const push = (s: string) => {\r\n            if (stackIdx < ShaderDefineExpression._Stack.length - 1) {\r\n                ShaderDefineExpression._Stack[++stackIdx] = s;\r\n            }\r\n        };\r\n\r\n        const peek = () => ShaderDefineExpression._Stack[stackIdx];\r\n\r\n        const pop = () => (stackIdx === -1 ? \"!!INVALID EXPRESSION!!\" : ShaderDefineExpression._Stack[stackIdx--]);\r\n\r\n        let idx = 0,\r\n            operand = \"\";\r\n\r\n        while (idx < infix.length) {\r\n            const c = infix.charAt(idx),\r\n                token = idx < infix.length - 1 ? infix.substr(idx, 2) : \"\";\r\n\r\n            if (c === \"(\") {\r\n                operand = \"\";\r\n                push(c);\r\n            } else if (c === \")\") {\r\n                pushOperand();\r\n                while (stackIdx !== -1 && peek() !== \"(\") {\r\n                    result.push(pop());\r\n                }\r\n                pop();\r\n            } else if (ShaderDefineExpression._OperatorPriority[token] > 1) {\r\n                pushOperand();\r\n                while (stackIdx !== -1 && ShaderDefineExpression._OperatorPriority[peek()] >= ShaderDefineExpression._OperatorPriority[token]) {\r\n                    result.push(pop());\r\n                }\r\n                push(token);\r\n                idx++;\r\n            } else {\r\n                operand += c;\r\n            }\r\n            idx++;\r\n        }\r\n\r\n        pushOperand();\r\n\r\n        while (stackIdx !== -1) {\r\n            if (peek() === \"(\") {\r\n                pop();\r\n            } else {\r\n                result.push(pop());\r\n            }\r\n        }\r\n\r\n        // If the cache is at capacity, clear it before adding a new item\r\n        if (ShaderDefineExpression._InfixToPostfixCache.size >= ShaderDefineExpression.InfixToPostfixCacheLimitSize) {\r\n            ShaderDefineExpression.ClearCache();\r\n        }\r\n\r\n        // Add the new item to the cache, including the current time as the last access time\r\n        ShaderDefineExpression._InfixToPostfixCache.set(infix, { result, accessTime: Date.now() });\r\n\r\n        return result;\r\n    }\r\n\r\n    private static ClearCache(): void {\r\n        // Convert the cache to an array and sort by last access time\r\n        const sortedCache = Array.from(ShaderDefineExpression._InfixToPostfixCache.entries()).sort((a, b) => a[1].accessTime - b[1].accessTime);\r\n\r\n        // Remove the least recently accessed half of the cache\r\n        for (let i = 0; i < ShaderDefineExpression.InfixToPostfixCacheCleanupSize; i++) {\r\n            ShaderDefineExpression._InfixToPostfixCache.delete(sortedCache[i][0]);\r\n        }\r\n    }\r\n}\r\n", "import { ShaderDefineExpression } from \"../shaderDefineExpression\";\r\n\r\n/** @internal */\r\nexport class ShaderDefineIsDefinedOperator extends ShaderDefineExpression {\r\n    public constructor(\r\n        public define: string,\r\n        public not: boolean = false\r\n    ) {\r\n        super();\r\n    }\r\n\r\n    public isTrue(preprocessors: { [key: string]: string }) {\r\n        let condition = preprocessors[this.define] !== undefined;\r\n\r\n        if (this.not) {\r\n            condition = !condition;\r\n        }\r\n\r\n        return condition;\r\n    }\r\n}\r\n", "import { ShaderDefineExpression } from \"../shaderDefineExpression\";\r\n\r\n/** @internal */\r\nexport class ShaderDefineOrOperator extends ShaderDefineExpression {\r\n    public leftOperand: ShaderDefineExpression;\r\n    public rightOperand: ShaderDefineExpression;\r\n\r\n    public isTrue(preprocessors: { [key: string]: string }): boolean {\r\n        return this.leftOperand.isTrue(preprocessors) || this.rightOperand.isTrue(preprocessors);\r\n    }\r\n}\r\n", "import { ShaderDefineExpression } from \"../shaderDefineExpression\";\r\n\r\n/** @internal */\r\nexport class ShaderDefineAndOperator extends ShaderDefineExpression {\r\n    public leftOperand: ShaderDefineExpression;\r\n    public rightOperand: ShaderDefineExpression;\r\n\r\n    public isTrue(preprocessors: { [key: string]: string }): boolean {\r\n        return this.leftOperand.isTrue(preprocessors) && this.rightOperand.isTrue(preprocessors);\r\n    }\r\n}\r\n", "import { ShaderDefineExpression } from \"../shaderDefineExpression\";\r\n\r\n/** @internal */\r\nexport class ShaderDefineArithmeticOperator extends ShaderDefineExpression {\r\n    public constructor(\r\n        public define: string,\r\n        public operand: string,\r\n        public testValue: string\r\n    ) {\r\n        super();\r\n    }\r\n\r\n    public isTrue(preprocessors: { [key: string]: string }) {\r\n        let value = preprocessors[this.define];\r\n\r\n        if (value === undefined) {\r\n            value = this.define;\r\n        }\r\n\r\n        let condition = false;\r\n        const left = parseInt(value);\r\n        const right = parseInt(this.testValue);\r\n\r\n        switch (this.operand) {\r\n            case \">\":\r\n                condition = left > right;\r\n                break;\r\n            case \"<\":\r\n                condition = left < right;\r\n                break;\r\n            case \"<=\":\r\n                condition = left <= right;\r\n                break;\r\n            case \">=\":\r\n                condition = left >= right;\r\n                break;\r\n            case \"==\":\r\n                condition = left === right;\r\n                break;\r\n            case \"!=\":\r\n                condition = left !== right;\r\n                break;\r\n        }\r\n\r\n        return condition;\r\n    }\r\n}\r\n", "/* eslint-disable @typescript-eslint/no-unused-vars */\r\nimport { ShaderCodeNode } from \"./shaderCodeNode\";\r\nimport { ShaderCodeCursor } from \"./shaderCodeCursor\";\r\nimport { ShaderCodeConditionNode } from \"./shaderCodeConditionNode\";\r\nimport { ShaderCodeTestNode } from \"./shaderCodeTestNode\";\r\nimport { ShaderDefineIsDefinedOperator } from \"./Expressions/Operators/shaderDefineIsDefinedOperator\";\r\nimport { ShaderDefineOrOperator } from \"./Expressions/Operators/shaderDefineOrOperator\";\r\nimport { ShaderDefineAndOperator } from \"./Expressions/Operators/shaderDefineAndOperator\";\r\nimport { ShaderDefineExpression } from \"./Expressions/shaderDefineExpression\";\r\nimport { ShaderDefineArithmeticOperator } from \"./Expressions/Operators/shaderDefineArithmeticOperator\";\r\nimport type { ProcessingOptions } from \"./shaderProcessingOptions\";\r\nimport { _WarnImport } from \"../../Misc/devTools\";\r\nimport { ShaderLanguage } from \"../../Materials/shaderLanguage\";\r\n\r\nimport type { WebRequest } from \"../../Misc/webRequest\";\r\nimport type { LoadFileError } from \"../../Misc/fileTools\";\r\nimport type { IOfflineProvider } from \"../../Offline/IOfflineProvider\";\r\nimport type { IFileRequest } from \"../../Misc/fileRequest\";\r\nimport type { ThinEngine } from \"../thinEngine\";\r\n\r\nconst regexSE = /defined\\s*?\\((.+?)\\)/g;\r\nconst regexSERevert = /defined\\s*?\\[(.+?)\\]/g;\r\nconst regexShaderInclude = /#include\\s?<(.+)>(\\((.*)\\))*(\\[(.*)\\])*/g;\r\nconst regexShaderDecl = /__decl__/;\r\nconst regexLightX = /light\\{X\\}.(\\w*)/g;\r\nconst regexX = /\\{X\\}/g;\r\nconst reusableMatches: RegExpMatchArray[] = [];\r\n\r\n/** @internal */\r\nexport class ShaderProcessor {\r\n    private static _MoveCursorRegex = /(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;\r\n\r\n    public static Initialize(options: ProcessingOptions): void {\r\n        if (options.processor && options.processor.initializeShaders) {\r\n            options.processor.initializeShaders(options.processingContext);\r\n        }\r\n    }\r\n\r\n    public static Process(sourceCode: string, options: ProcessingOptions, callback: (migratedCode: string, codeBeforeMigration: string) => void, engine: ThinEngine) {\r\n        if (options.processor?.preProcessShaderCode) {\r\n            sourceCode = options.processor.preProcessShaderCode(sourceCode, options.isFragment);\r\n        }\r\n        this._ProcessIncludes(sourceCode, options, (codeWithIncludes) => {\r\n            if (options.processCodeAfterIncludes) {\r\n                codeWithIncludes = options.processCodeAfterIncludes(options.isFragment ? \"fragment\" : \"vertex\", codeWithIncludes);\r\n            }\r\n            const migratedCode = this._ProcessShaderConversion(codeWithIncludes, options, engine);\r\n            callback(migratedCode, codeWithIncludes);\r\n        });\r\n    }\r\n\r\n    public static PreProcess(sourceCode: string, options: ProcessingOptions, callback: (migratedCode: string, codeBeforeMigration: string) => void, engine: ThinEngine) {\r\n        if (options.processor?.preProcessShaderCode) {\r\n            sourceCode = options.processor.preProcessShaderCode(sourceCode, options.isFragment);\r\n        }\r\n        this._ProcessIncludes(sourceCode, options, (codeWithIncludes) => {\r\n            if (options.processCodeAfterIncludes) {\r\n                codeWithIncludes = options.processCodeAfterIncludes(options.isFragment ? \"fragment\" : \"vertex\", codeWithIncludes);\r\n            }\r\n            const migratedCode = this._ApplyPreProcessing(codeWithIncludes, options, engine);\r\n            callback(migratedCode, codeWithIncludes);\r\n        });\r\n    }\r\n\r\n    public static Finalize(vertexCode: string, fragmentCode: string, options: ProcessingOptions): { vertexCode: string; fragmentCode: string } {\r\n        if (!options.processor || !options.processor.finalizeShaders) {\r\n            return { vertexCode, fragmentCode };\r\n        }\r\n\r\n        return options.processor.finalizeShaders(vertexCode, fragmentCode, options.processingContext);\r\n    }\r\n\r\n    private static _ProcessPrecision(source: string, options: ProcessingOptions): string {\r\n        if (options.processor?.noPrecision) {\r\n            return source;\r\n        }\r\n\r\n        const shouldUseHighPrecisionShader = options.shouldUseHighPrecisionShader;\r\n\r\n        if (source.indexOf(\"precision highp float\") === -1) {\r\n            if (!shouldUseHighPrecisionShader) {\r\n                source = \"precision mediump float;\\n\" + source;\r\n            } else {\r\n                source = \"precision highp float;\\n\" + source;\r\n            }\r\n        } else {\r\n            if (!shouldUseHighPrecisionShader) {\r\n                // Moving highp to mediump\r\n                source = source.replace(\"precision highp float\", \"precision mediump float\");\r\n            }\r\n        }\r\n\r\n        return source;\r\n    }\r\n\r\n    private static _ExtractOperation(expression: string) {\r\n        const regex = /defined\\((.+)\\)/;\r\n\r\n        const match = regex.exec(expression);\r\n\r\n        if (match && match.length) {\r\n            return new ShaderDefineIsDefinedOperator(match[1].trim(), expression[0] === \"!\");\r\n        }\r\n\r\n        const operators = [\"==\", \"!=\", \">=\", \"<=\", \"<\", \">\"];\r\n        let operator = \"\";\r\n        let indexOperator = 0;\r\n\r\n        for (operator of operators) {\r\n            indexOperator = expression.indexOf(operator);\r\n\r\n            if (indexOperator > -1) {\r\n                break;\r\n            }\r\n        }\r\n\r\n        if (indexOperator === -1) {\r\n            return new ShaderDefineIsDefinedOperator(expression);\r\n        }\r\n\r\n        const define = expression.substring(0, indexOperator).trim();\r\n        const value = expression.substring(indexOperator + operator.length).trim();\r\n\r\n        return new ShaderDefineArithmeticOperator(define, operator, value);\r\n    }\r\n\r\n    private static _BuildSubExpression(expression: string): ShaderDefineExpression {\r\n        expression = expression.replace(regexSE, \"defined[$1]\");\r\n\r\n        const postfix = ShaderDefineExpression.infixToPostfix(expression);\r\n\r\n        const stack: (string | ShaderDefineExpression)[] = [];\r\n\r\n        for (const c of postfix) {\r\n            if (c !== \"||\" && c !== \"&&\") {\r\n                stack.push(c);\r\n            } else if (stack.length >= 2) {\r\n                let v1 = stack[stack.length - 1],\r\n                    v2 = stack[stack.length - 2];\r\n\r\n                stack.length -= 2;\r\n\r\n                const operator = c == \"&&\" ? new ShaderDefineAndOperator() : new ShaderDefineOrOperator();\r\n\r\n                if (typeof v1 === \"string\") {\r\n                    v1 = v1.replace(regexSERevert, \"defined($1)\");\r\n                }\r\n\r\n                if (typeof v2 === \"string\") {\r\n                    v2 = v2.replace(regexSERevert, \"defined($1)\");\r\n                }\r\n\r\n                operator.leftOperand = typeof v2 === \"string\" ? this._ExtractOperation(v2) : v2;\r\n                operator.rightOperand = typeof v1 === \"string\" ? this._ExtractOperation(v1) : v1;\r\n\r\n                stack.push(operator);\r\n            }\r\n        }\r\n\r\n        let result = stack[stack.length - 1];\r\n\r\n        if (typeof result === \"string\") {\r\n            result = result.replace(regexSERevert, \"defined($1)\");\r\n        }\r\n\r\n        // note: stack.length !== 1 if there was an error in the parsing\r\n\r\n        return typeof result === \"string\" ? this._ExtractOperation(result) : result;\r\n    }\r\n\r\n    private static _BuildExpression(line: string, start: number): ShaderCodeTestNode {\r\n        const node = new ShaderCodeTestNode();\r\n        const command = line.substring(0, start);\r\n        let expression = line.substring(start);\r\n\r\n        expression = expression.substring(0, (expression.indexOf(\"//\") + 1 || expression.length + 1) - 1).trim();\r\n\r\n        if (command === \"#ifdef\") {\r\n            node.testExpression = new ShaderDefineIsDefinedOperator(expression);\r\n        } else if (command === \"#ifndef\") {\r\n            node.testExpression = new ShaderDefineIsDefinedOperator(expression, true);\r\n        } else {\r\n            node.testExpression = this._BuildSubExpression(expression);\r\n        }\r\n\r\n        return node;\r\n    }\r\n\r\n    private static _MoveCursorWithinIf(cursor: ShaderCodeCursor, rootNode: ShaderCodeConditionNode, ifNode: ShaderCodeNode) {\r\n        let line = cursor.currentLine;\r\n        while (this._MoveCursor(cursor, ifNode)) {\r\n            line = cursor.currentLine;\r\n            const first5 = line.substring(0, 5).toLowerCase();\r\n\r\n            if (first5 === \"#else\") {\r\n                const elseNode = new ShaderCodeNode();\r\n                rootNode.children.push(elseNode);\r\n                this._MoveCursor(cursor, elseNode);\r\n                return;\r\n            } else if (first5 === \"#elif\") {\r\n                const elifNode = this._BuildExpression(line, 5);\r\n\r\n                rootNode.children.push(elifNode);\r\n                ifNode = elifNode;\r\n            }\r\n        }\r\n    }\r\n\r\n    private static _MoveCursor(cursor: ShaderCodeCursor, rootNode: ShaderCodeNode): boolean {\r\n        while (cursor.canRead) {\r\n            cursor.lineIndex++;\r\n            const line = cursor.currentLine;\r\n\r\n            if (line.indexOf(\"#\") >= 0) {\r\n                const matches = ShaderProcessor._MoveCursorRegex.exec(line);\r\n\r\n                if (matches && matches.length) {\r\n                    const keyword = matches[0];\r\n\r\n                    switch (keyword) {\r\n                        case \"#ifdef\": {\r\n                            const newRootNode = new ShaderCodeConditionNode();\r\n                            rootNode.children.push(newRootNode);\r\n\r\n                            const ifNode = this._BuildExpression(line, 6);\r\n                            newRootNode.children.push(ifNode);\r\n                            this._MoveCursorWithinIf(cursor, newRootNode, ifNode);\r\n                            break;\r\n                        }\r\n                        case \"#else\":\r\n                        case \"#elif\":\r\n                            return true;\r\n                        case \"#endif\":\r\n                            return false;\r\n                        case \"#ifndef\": {\r\n                            const newRootNode = new ShaderCodeConditionNode();\r\n                            rootNode.children.push(newRootNode);\r\n\r\n                            const ifNode = this._BuildExpression(line, 7);\r\n                            newRootNode.children.push(ifNode);\r\n                            this._MoveCursorWithinIf(cursor, newRootNode, ifNode);\r\n                            break;\r\n                        }\r\n                        case \"#if\": {\r\n                            const newRootNode = new ShaderCodeConditionNode();\r\n                            const ifNode = this._BuildExpression(line, 3);\r\n                            rootNode.children.push(newRootNode);\r\n\r\n                            newRootNode.children.push(ifNode);\r\n                            this._MoveCursorWithinIf(cursor, newRootNode, ifNode);\r\n                            break;\r\n                        }\r\n                    }\r\n                    continue;\r\n                }\r\n            }\r\n\r\n            const newNode = new ShaderCodeNode();\r\n            newNode.line = line;\r\n            rootNode.children.push(newNode);\r\n\r\n            // Detect additional defines\r\n            if (line[0] === \"#\" && line[1] === \"d\") {\r\n                const split = line.replace(\";\", \"\").split(\" \");\r\n                newNode.additionalDefineKey = split[1];\r\n\r\n                if (split.length === 3) {\r\n                    newNode.additionalDefineValue = split[2];\r\n                }\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    private static _EvaluatePreProcessors(sourceCode: string, preprocessors: { [key: string]: string }, options: ProcessingOptions): string {\r\n        const rootNode = new ShaderCodeNode();\r\n        const cursor = new ShaderCodeCursor();\r\n\r\n        cursor.lineIndex = -1;\r\n        cursor.lines = sourceCode.split(\"\\n\");\r\n\r\n        // Decompose (We keep it in 2 steps so it is easier to maintain and perf hit is insignificant)\r\n        this._MoveCursor(cursor, rootNode);\r\n\r\n        // Recompose\r\n        return rootNode.process(preprocessors, options);\r\n    }\r\n\r\n    private static _PreparePreProcessors(options: ProcessingOptions, engine: ThinEngine): { [key: string]: string } {\r\n        const defines = options.defines;\r\n        const preprocessors: { [key: string]: string } = {};\r\n\r\n        for (const define of defines) {\r\n            const keyValue = define.replace(\"#define\", \"\").replace(\";\", \"\").trim();\r\n            const split = keyValue.split(\" \");\r\n            preprocessors[split[0]] = split.length > 1 ? split[1] : \"\";\r\n        }\r\n\r\n        if (options.processor?.shaderLanguage === ShaderLanguage.GLSL) {\r\n            preprocessors[\"GL_ES\"] = \"true\";\r\n        }\r\n        preprocessors[\"__VERSION__\"] = options.version;\r\n        preprocessors[options.platformName] = \"true\";\r\n\r\n        engine._getGlobalDefines(preprocessors);\r\n\r\n        return preprocessors;\r\n    }\r\n\r\n    private static _ProcessShaderConversion(sourceCode: string, options: ProcessingOptions, engine: ThinEngine): string {\r\n        let preparedSourceCode = this._ProcessPrecision(sourceCode, options);\r\n\r\n        if (!options.processor) {\r\n            return preparedSourceCode;\r\n        }\r\n\r\n        // Already converted\r\n        if (options.processor.shaderLanguage === ShaderLanguage.GLSL && preparedSourceCode.indexOf(\"#version 3\") !== -1) {\r\n            preparedSourceCode = preparedSourceCode.replace(\"#version 300 es\", \"\");\r\n            if (!options.processor.parseGLES3) {\r\n                return preparedSourceCode;\r\n            }\r\n        }\r\n\r\n        const defines = options.defines;\r\n\r\n        const preprocessors = this._PreparePreProcessors(options, engine);\r\n\r\n        // General pre processing\r\n        if (options.processor.preProcessor) {\r\n            preparedSourceCode = options.processor.preProcessor(preparedSourceCode, defines, options.isFragment, options.processingContext);\r\n        }\r\n\r\n        preparedSourceCode = this._EvaluatePreProcessors(preparedSourceCode, preprocessors, options);\r\n\r\n        // Post processing\r\n        if (options.processor.postProcessor) {\r\n            preparedSourceCode = options.processor.postProcessor(preparedSourceCode, defines, options.isFragment, options.processingContext, engine);\r\n        }\r\n\r\n        // Inline functions tagged with #define inline\r\n        if (engine._features.needShaderCodeInlining) {\r\n            preparedSourceCode = engine.inlineShaderCode(preparedSourceCode);\r\n        }\r\n\r\n        return preparedSourceCode;\r\n    }\r\n\r\n    private static _ApplyPreProcessing(sourceCode: string, options: ProcessingOptions, engine: ThinEngine): string {\r\n        let preparedSourceCode = sourceCode;\r\n\r\n        const defines = options.defines;\r\n\r\n        const preprocessors = this._PreparePreProcessors(options, engine);\r\n\r\n        // General pre processing\r\n        if (options.processor?.preProcessor) {\r\n            preparedSourceCode = options.processor.preProcessor(preparedSourceCode, defines, options.isFragment, options.processingContext);\r\n        }\r\n\r\n        preparedSourceCode = this._EvaluatePreProcessors(preparedSourceCode, preprocessors, options);\r\n\r\n        // Post processing\r\n        if (options.processor?.postProcessor) {\r\n            preparedSourceCode = options.processor.postProcessor(preparedSourceCode, defines, options.isFragment, options.processingContext, engine);\r\n        }\r\n\r\n        // Inline functions tagged with #define inline\r\n        if (engine._features.needShaderCodeInlining) {\r\n            preparedSourceCode = engine.inlineShaderCode(preparedSourceCode);\r\n        }\r\n\r\n        return preparedSourceCode;\r\n    }\r\n\r\n    /** @internal */\r\n    public static _ProcessIncludes(sourceCode: string, options: ProcessingOptions, callback: (data: any) => void): void {\r\n        reusableMatches.length = 0;\r\n        let match: RegExpMatchArray | null;\r\n        // stay back-compat to the old matchAll syntax\r\n        while ((match = regexShaderInclude.exec(sourceCode)) !== null) {\r\n            reusableMatches.push(match);\r\n        }\r\n\r\n        let returnValue = String(sourceCode);\r\n        let parts = [sourceCode];\r\n\r\n        let keepProcessing = false;\r\n\r\n        for (const match of reusableMatches) {\r\n            let includeFile = match[1];\r\n\r\n            // Uniform declaration\r\n            if (includeFile.indexOf(\"__decl__\") !== -1) {\r\n                includeFile = includeFile.replace(regexShaderDecl, \"\");\r\n                if (options.supportsUniformBuffers) {\r\n                    includeFile = includeFile.replace(\"Vertex\", \"Ubo\").replace(\"Fragment\", \"Ubo\");\r\n                }\r\n                includeFile = includeFile + \"Declaration\";\r\n            }\r\n\r\n            if (options.includesShadersStore[includeFile]) {\r\n                // Substitution\r\n                let includeContent = options.includesShadersStore[includeFile];\r\n                if (match[2]) {\r\n                    const splits = match[3].split(\",\");\r\n\r\n                    for (let index = 0; index < splits.length; index += 2) {\r\n                        const source = new RegExp(splits[index], \"g\");\r\n                        const dest = splits[index + 1];\r\n\r\n                        includeContent = includeContent.replace(source, dest);\r\n                    }\r\n                }\r\n\r\n                if (match[4]) {\r\n                    const indexString = match[5];\r\n\r\n                    if (indexString.indexOf(\"..\") !== -1) {\r\n                        const indexSplits = indexString.split(\"..\");\r\n                        const minIndex = parseInt(indexSplits[0]);\r\n                        let maxIndex = parseInt(indexSplits[1]);\r\n                        let sourceIncludeContent = includeContent.slice(0);\r\n                        includeContent = \"\";\r\n\r\n                        if (isNaN(maxIndex)) {\r\n                            maxIndex = options.indexParameters[indexSplits[1]];\r\n                        }\r\n\r\n                        for (let i = minIndex; i < maxIndex; i++) {\r\n                            if (!options.supportsUniformBuffers) {\r\n                                // Ubo replacement\r\n                                sourceIncludeContent = sourceIncludeContent.replace(regexLightX, (str: string, p1: string) => {\r\n                                    return p1 + \"{X}\";\r\n                                });\r\n                            }\r\n                            includeContent += sourceIncludeContent.replace(regexX, i.toString()) + \"\\n\";\r\n                        }\r\n                    } else {\r\n                        if (!options.supportsUniformBuffers) {\r\n                            // Ubo replacement\r\n                            includeContent = includeContent.replace(regexLightX, (str: string, p1: string) => {\r\n                                return p1 + \"{X}\";\r\n                            });\r\n                        }\r\n                        includeContent = includeContent.replace(regexX, indexString);\r\n                    }\r\n                }\r\n\r\n                // Replace\r\n                // Split all parts on match[0] and intersperse the parts with the include content\r\n                const newParts = [];\r\n                for (const part of parts) {\r\n                    const splitPart = part.split(match[0]);\r\n                    for (let i = 0; i < splitPart.length - 1; i++) {\r\n                        newParts.push(splitPart[i]);\r\n                        newParts.push(includeContent);\r\n                    }\r\n                    newParts.push(splitPart[splitPart.length - 1]);\r\n                }\r\n                parts = newParts;\r\n\r\n                keepProcessing = keepProcessing || includeContent.indexOf(\"#include<\") >= 0 || includeContent.indexOf(\"#include <\") >= 0;\r\n            } else {\r\n                const includeShaderUrl = options.shadersRepository + \"ShadersInclude/\" + includeFile + \".fx\";\r\n\r\n                ShaderProcessor._FileToolsLoadFile(includeShaderUrl, (fileContent) => {\r\n                    options.includesShadersStore[includeFile] = fileContent as string;\r\n                    this._ProcessIncludes(parts.join(\"\"), options, callback);\r\n                });\r\n                return;\r\n            }\r\n        }\r\n        reusableMatches.length = 0;\r\n\r\n        returnValue = parts.join(\"\");\r\n\r\n        if (keepProcessing) {\r\n            this._ProcessIncludes(returnValue.toString(), options, callback);\r\n        } else {\r\n            callback(returnValue);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Loads a file from a url\r\n     * @param url url to load\r\n     * @param onSuccess callback called when the file successfully loads\r\n     * @param onProgress callback called while file is loading (if the server supports this mode)\r\n     * @param offlineProvider defines the offline provider for caching\r\n     * @param useArrayBuffer defines a boolean indicating that date must be returned as ArrayBuffer\r\n     * @param onError callback called when the file fails to load\r\n     * @returns a file request object\r\n     * @internal\r\n     */\r\n    public static _FileToolsLoadFile(\r\n        url: string,\r\n        onSuccess: (data: string | ArrayBuffer, responseURL?: string) => void,\r\n        onProgress?: (ev: ProgressEvent) => void,\r\n        offlineProvider?: IOfflineProvider,\r\n        useArrayBuffer?: boolean,\r\n        onError?: (request?: WebRequest, exception?: LoadFileError) => void\r\n    ): IFileRequest {\r\n        throw _WarnImport(\"FileTools\");\r\n    }\r\n}\r\n", "import { Observable } from \"../Misc/observable\";\r\nimport type { FloatArray, Nullable } from \"../types\";\r\nimport { Constants } from \"../Engines/constants\";\r\nimport { GetDOMTextContent, IsWindowObjectExist } from \"../Misc/domManagement\";\r\nimport { Logger } from \"../Misc/logger\";\r\nimport type { IDisposable } from \"../scene\";\r\nimport type { IPipelineContext } from \"../Engines/IPipelineContext\";\r\nimport type { DataBuffer } from \"../Buffers/dataBuffer\";\r\nimport { ShaderProcessor } from \"../Engines/Processors/shaderProcessor\";\r\nimport type { IShaderProcessor } from \"../Engines/Processors/iShaderProcessor\";\r\nimport type { ProcessingOptions, ShaderCustomProcessingFunction, ShaderProcessingContext } from \"../Engines/Processors/shaderProcessingOptions\";\r\nimport type { IMatrixLike, IVector2Like, IVector3Like, IVector4Like, IColor3Like, IColor4Like, IQuaternionLike } from \"../Maths/math.like\";\r\nimport type { ThinEngine } from \"../Engines/thinEngine\";\r\nimport type { IEffectFallbacks } from \"./iEffectFallbacks\";\r\nimport { ShaderStore as EngineShaderStore } from \"../Engines/shaderStore\";\r\nimport { ShaderLanguage } from \"./shaderLanguage\";\r\n\r\nimport type { Engine } from \"../Engines/engine\";\r\nimport type { InternalTexture } from \"../Materials/Textures/internalTexture\";\r\nimport type { ThinTexture } from \"../Materials/Textures/thinTexture\";\r\nimport type { RenderTargetTexture } from \"../Materials/Textures/renderTargetTexture\";\r\nimport type { PostProcess } from \"../PostProcesses/postProcess\";\r\n\r\n/**\r\n * Options to be used when creating an effect.\r\n */\r\nexport interface IEffectCreationOptions {\r\n    /**\r\n     * Attributes that will be used in the shader.\r\n     */\r\n    attributes: string[];\r\n    /**\r\n     * Uniform variable names that will be set in the shader.\r\n     */\r\n    uniformsNames: string[];\r\n    /**\r\n     * Uniform buffer variable names that will be set in the shader.\r\n     */\r\n    uniformBuffersNames: string[];\r\n    /**\r\n     * Sampler texture variable names that will be set in the shader.\r\n     */\r\n    samplers: string[];\r\n    /**\r\n     * Define statements that will be set in the shader.\r\n     */\r\n    defines: any;\r\n    /**\r\n     * Possible fallbacks for this effect to improve performance when needed.\r\n     */\r\n    fallbacks: Nullable<IEffectFallbacks>;\r\n    /**\r\n     * Callback that will be called when the shader is compiled.\r\n     */\r\n    onCompiled: Nullable<(effect: Effect) => void>;\r\n    /**\r\n     * Callback that will be called if an error occurs during shader compilation.\r\n     */\r\n    onError: Nullable<(effect: Effect, errors: string) => void>;\r\n    /**\r\n     * Parameters to be used with Babylons include syntax to iterate over an array (eg. \\{lights: 10\\})\r\n     */\r\n    indexParameters?: any;\r\n    /**\r\n     * Max number of lights that can be used in the shader.\r\n     */\r\n    maxSimultaneousLights?: number;\r\n    /**\r\n     * See https://developer.mozilla.org/en-US/docs/Web/API/WebGL2RenderingContext/transformFeedbackVaryings\r\n     */\r\n    transformFeedbackVaryings?: Nullable<string[]>;\r\n    /**\r\n     * If provided, will be called two times with the vertex and fragment code so that this code can be updated before it is compiled by the GPU\r\n     */\r\n    processFinalCode?: Nullable<ShaderCustomProcessingFunction>;\r\n    /**\r\n     * If provided, will be called two times with the vertex and fragment code so that this code can be updated after the #include have been processed\r\n     */\r\n    processCodeAfterIncludes?: Nullable<ShaderCustomProcessingFunction>;\r\n    /**\r\n     * Is this effect rendering to several color attachments ?\r\n     */\r\n    multiTarget?: boolean;\r\n    /**\r\n     * The language the shader is written in (default: GLSL)\r\n     */\r\n    shaderLanguage?: ShaderLanguage;\r\n}\r\n\r\n/**\r\n * Effect containing vertex and fragment shader that can be executed on an object.\r\n */\r\nexport class Effect implements IDisposable {\r\n    /**\r\n     * Gets or sets the relative url used to load shaders if using the engine in non-minified mode\r\n     */\r\n    public static get ShadersRepository(): string {\r\n        return EngineShaderStore.ShadersRepository;\r\n    }\r\n    public static set ShadersRepository(repo: string) {\r\n        EngineShaderStore.ShadersRepository = repo;\r\n    }\r\n    /**\r\n     * Enable logging of the shader code when a compilation error occurs\r\n     */\r\n    public static LogShaderCodeOnCompilationError = true;\r\n    /**\r\n     * Name of the effect.\r\n     */\r\n    public name: any = null;\r\n    /**\r\n     * String container all the define statements that should be set on the shader.\r\n     */\r\n    public defines: string = \"\";\r\n    /**\r\n     * Callback that will be called when the shader is compiled.\r\n     */\r\n    public onCompiled: Nullable<(effect: Effect) => void> = null;\r\n    /**\r\n     * Callback that will be called if an error occurs during shader compilation.\r\n     */\r\n    public onError: Nullable<(effect: Effect, errors: string) => void> = null;\r\n    /**\r\n     * Callback that will be called when effect is bound.\r\n     */\r\n    public onBind: Nullable<(effect: Effect) => void> = null;\r\n    /**\r\n     * Unique ID of the effect.\r\n     */\r\n    public uniqueId = 0;\r\n    /**\r\n     * Observable that will be called when the shader is compiled.\r\n     * It is recommended to use executeWhenCompile() or to make sure that scene.isReady() is called to get this observable raised.\r\n     */\r\n    public onCompileObservable = new Observable<Effect>();\r\n    /**\r\n     * Observable that will be called if an error occurs during shader compilation.\r\n     */\r\n    public onErrorObservable = new Observable<Effect>();\r\n\r\n    /** @internal */\r\n    public _onBindObservable: Nullable<Observable<Effect>> = null;\r\n\r\n    private _isDisposed = false;\r\n\r\n    /**\r\n     * Observable that will be called when effect is bound.\r\n     */\r\n    public get onBindObservable(): Observable<Effect> {\r\n        if (!this._onBindObservable) {\r\n            this._onBindObservable = new Observable<Effect>();\r\n        }\r\n\r\n        return this._onBindObservable;\r\n    }\r\n\r\n    /** @internal */\r\n    public _bonesComputationForcedToCPU = false;\r\n    /** @internal */\r\n    public _uniformBuffersNames: { [key: string]: number } = {};\r\n    /** @internal */\r\n    public _samplerList: string[];\r\n    /** @internal */\r\n    public _multiTarget: boolean = false;\r\n\r\n    private static _UniqueIdSeed = 0;\r\n    /** @internal */\r\n    public _engine: Engine;\r\n    private _uniformBuffersNamesList: string[];\r\n    private _uniformsNames: string[];\r\n    private _samplers: { [key: string]: number } = {};\r\n    private _isReady = false;\r\n    private _compilationError = \"\";\r\n    private _allFallbacksProcessed = false;\r\n    private _attributesNames: string[];\r\n    private _attributes: number[];\r\n    private _attributeLocationByName: { [name: string]: number };\r\n    private _uniforms: { [key: string]: Nullable<WebGLUniformLocation> } = {};\r\n    /**\r\n     * Key for the effect.\r\n     * @internal\r\n     */\r\n    public _key: string = \"\";\r\n    private _indexParameters: any;\r\n    private _fallbacks: Nullable<IEffectFallbacks> = null;\r\n    private _vertexSourceCodeOverride: string = \"\";\r\n    private _fragmentSourceCodeOverride: string = \"\";\r\n    private _transformFeedbackVaryings: Nullable<string[]> = null;\r\n    private _shaderLanguage: ShaderLanguage;\r\n    /**\r\n     * Compiled shader to webGL program.\r\n     * @internal\r\n     */\r\n    public _pipelineContext: Nullable<IPipelineContext> = null;\r\n    /** @internal */\r\n    public _vertexSourceCode: string = \"\";\r\n    /** @internal */\r\n    public _fragmentSourceCode: string = \"\";\r\n\r\n    /** @internal */\r\n    private _vertexSourceCodeBeforeMigration: string = \"\";\r\n    /** @internal */\r\n    private _fragmentSourceCodeBeforeMigration: string = \"\";\r\n\r\n    /** @internal */\r\n    private _rawVertexSourceCode: string = \"\";\r\n    /** @internal */\r\n    private _rawFragmentSourceCode: string = \"\";\r\n\r\n    private static _BaseCache: { [key: number]: DataBuffer } = {};\r\n    private _processingContext: Nullable<ShaderProcessingContext>;\r\n\r\n    private _processCodeAfterIncludes: ShaderCustomProcessingFunction | undefined = undefined;\r\n    private _processFinalCode: Nullable<ShaderCustomProcessingFunction> = null;\r\n\r\n    /**\r\n     * Gets the shader language type used to write vertex and fragment source code.\r\n     */\r\n    public get shaderLanguage(): ShaderLanguage {\r\n        return this._shaderLanguage;\r\n    }\r\n\r\n    /**\r\n     * Instantiates an effect.\r\n     * An effect can be used to create/manage/execute vertex and fragment shaders.\r\n     * @param baseName Name of the effect.\r\n     * @param attributesNamesOrOptions List of attribute names that will be passed to the shader or set of all options to create the effect.\r\n     * @param uniformsNamesOrEngine List of uniform variable names that will be passed to the shader or the engine that will be used to render effect.\r\n     * @param samplers List of sampler variables that will be passed to the shader.\r\n     * @param engine Engine to be used to render the effect\r\n     * @param defines Define statements to be added to the shader.\r\n     * @param fallbacks Possible fallbacks for this effect to improve performance when needed.\r\n     * @param onCompiled Callback that will be called when the shader is compiled.\r\n     * @param onError Callback that will be called if an error occurs during shader compilation.\r\n     * @param indexParameters Parameters to be used with Babylons include syntax to iterate over an array (eg. \\{lights: 10\\})\r\n     * @param key Effect Key identifying uniquely compiled shader variants\r\n     * @param shaderLanguage the language the shader is written in (default: GLSL)\r\n     */\r\n    constructor(\r\n        baseName: any,\r\n        attributesNamesOrOptions: string[] | IEffectCreationOptions,\r\n        uniformsNamesOrEngine: string[] | ThinEngine,\r\n        samplers: Nullable<string[]> = null,\r\n        engine?: ThinEngine,\r\n        defines: Nullable<string> = null,\r\n        fallbacks: Nullable<IEffectFallbacks> = null,\r\n        onCompiled: Nullable<(effect: Effect) => void> = null,\r\n        onError: Nullable<(effect: Effect, errors: string) => void> = null,\r\n        indexParameters?: any,\r\n        key: string = \"\",\r\n        shaderLanguage = ShaderLanguage.GLSL\r\n    ) {\r\n        this.name = baseName;\r\n        this._key = key;\r\n\r\n        if ((<IEffectCreationOptions>attributesNamesOrOptions).attributes) {\r\n            const options = <IEffectCreationOptions>attributesNamesOrOptions;\r\n            this._engine = <Engine>uniformsNamesOrEngine;\r\n\r\n            this._attributesNames = options.attributes;\r\n            this._uniformsNames = options.uniformsNames.concat(options.samplers);\r\n            this._samplerList = options.samplers.slice();\r\n            this.defines = options.defines;\r\n            this.onError = options.onError;\r\n            this.onCompiled = options.onCompiled;\r\n            this._fallbacks = options.fallbacks;\r\n            this._indexParameters = options.indexParameters;\r\n            this._transformFeedbackVaryings = options.transformFeedbackVaryings || null;\r\n            this._multiTarget = !!options.multiTarget;\r\n            this._shaderLanguage = options.shaderLanguage ?? ShaderLanguage.GLSL;\r\n\r\n            if (options.uniformBuffersNames) {\r\n                this._uniformBuffersNamesList = options.uniformBuffersNames.slice();\r\n                for (let i = 0; i < options.uniformBuffersNames.length; i++) {\r\n                    this._uniformBuffersNames[options.uniformBuffersNames[i]] = i;\r\n                }\r\n            }\r\n\r\n            this._processFinalCode = options.processFinalCode ?? null;\r\n            this._processCodeAfterIncludes = options.processCodeAfterIncludes ?? undefined;\r\n        } else {\r\n            this._engine = <Engine>engine;\r\n            this.defines = defines == null ? \"\" : defines;\r\n            this._uniformsNames = (<string[]>uniformsNamesOrEngine).concat(<string[]>samplers);\r\n            this._samplerList = samplers ? <string[]>samplers.slice() : [];\r\n            this._attributesNames = <string[]>attributesNamesOrOptions;\r\n            this._uniformBuffersNamesList = [];\r\n            this._shaderLanguage = shaderLanguage;\r\n\r\n            this.onError = onError;\r\n            this.onCompiled = onCompiled;\r\n\r\n            this._indexParameters = indexParameters;\r\n            this._fallbacks = fallbacks;\r\n        }\r\n\r\n        this._attributeLocationByName = {};\r\n\r\n        this.uniqueId = Effect._UniqueIdSeed++;\r\n\r\n        this._processShaderCode();\r\n    }\r\n\r\n    /** @internal */\r\n    public _processShaderCode(shaderProcessor: Nullable<IShaderProcessor> = null, keepExistingPipelineContext = false) {\r\n        let vertexSource: any;\r\n        let fragmentSource: any;\r\n\r\n        const baseName = this.name;\r\n        const hostDocument = IsWindowObjectExist() ? this._engine.getHostDocument() : null;\r\n\r\n        if (baseName.vertexSource) {\r\n            vertexSource = \"source:\" + baseName.vertexSource;\r\n        } else if (baseName.vertexElement) {\r\n            vertexSource = hostDocument ? hostDocument.getElementById(baseName.vertexElement) : null;\r\n\r\n            if (!vertexSource) {\r\n                vertexSource = baseName.vertexElement;\r\n            }\r\n        } else {\r\n            vertexSource = baseName.vertex || baseName;\r\n        }\r\n\r\n        if (baseName.fragmentSource) {\r\n            fragmentSource = \"source:\" + baseName.fragmentSource;\r\n        } else if (baseName.fragmentElement) {\r\n            fragmentSource = hostDocument ? hostDocument.getElementById(baseName.fragmentElement) : null;\r\n\r\n            if (!fragmentSource) {\r\n                fragmentSource = baseName.fragmentElement;\r\n            }\r\n        } else {\r\n            fragmentSource = baseName.fragment || baseName;\r\n        }\r\n\r\n        this._processingContext = this._engine._getShaderProcessingContext(this._shaderLanguage);\r\n\r\n        let processorOptions: ProcessingOptions = {\r\n            defines: this.defines.split(\"\\n\"),\r\n            indexParameters: this._indexParameters,\r\n            isFragment: false,\r\n            shouldUseHighPrecisionShader: this._engine._shouldUseHighPrecisionShader,\r\n            processor: shaderProcessor ?? this._engine._getShaderProcessor(this._shaderLanguage),\r\n            supportsUniformBuffers: this._engine.supportsUniformBuffers,\r\n            shadersRepository: EngineShaderStore.GetShadersRepository(this._shaderLanguage),\r\n            includesShadersStore: EngineShaderStore.GetIncludesShadersStore(this._shaderLanguage),\r\n            version: (this._engine.version * 100).toString(),\r\n            platformName: this._engine.shaderPlatformName,\r\n            processingContext: this._processingContext,\r\n            isNDCHalfZRange: this._engine.isNDCHalfZRange,\r\n            useReverseDepthBuffer: this._engine.useReverseDepthBuffer,\r\n            processCodeAfterIncludes: this._processCodeAfterIncludes,\r\n        };\r\n\r\n        const shaderCodes: [string | undefined, string | undefined] = [undefined, undefined];\r\n        const shadersLoaded = () => {\r\n            if (shaderCodes[0] && shaderCodes[1]) {\r\n                processorOptions.isFragment = true;\r\n                const [migratedVertexCode, fragmentCode] = shaderCodes;\r\n                ShaderProcessor.Process(\r\n                    fragmentCode,\r\n                    processorOptions,\r\n                    (migratedFragmentCode, codeBeforeMigration) => {\r\n                        this._fragmentSourceCodeBeforeMigration = codeBeforeMigration;\r\n                        if (this._processFinalCode) {\r\n                            migratedFragmentCode = this._processFinalCode(\"fragment\", migratedFragmentCode);\r\n                        }\r\n                        const finalShaders = ShaderProcessor.Finalize(migratedVertexCode, migratedFragmentCode, processorOptions);\r\n                        processorOptions = null as any;\r\n                        this._useFinalCode(finalShaders.vertexCode, finalShaders.fragmentCode, baseName, keepExistingPipelineContext);\r\n                    },\r\n                    this._engine\r\n                );\r\n            }\r\n        };\r\n        this._loadShader(vertexSource, \"Vertex\", \"\", (vertexCode) => {\r\n            ShaderProcessor.Initialize(processorOptions);\r\n            ShaderProcessor.Process(\r\n                vertexCode,\r\n                processorOptions,\r\n                (migratedVertexCode, codeBeforeMigration) => {\r\n                    this._rawVertexSourceCode = vertexCode;\r\n                    this._vertexSourceCodeBeforeMigration = codeBeforeMigration;\r\n                    if (this._processFinalCode) {\r\n                        migratedVertexCode = this._processFinalCode(\"vertex\", migratedVertexCode);\r\n                    }\r\n                    shaderCodes[0] = migratedVertexCode;\r\n                    shadersLoaded();\r\n                },\r\n                this._engine\r\n            );\r\n        });\r\n        this._loadShader(fragmentSource, \"Fragment\", \"Pixel\", (fragmentCode) => {\r\n            this._rawFragmentSourceCode = fragmentCode;\r\n            shaderCodes[1] = fragmentCode;\r\n            shadersLoaded();\r\n        });\r\n    }\r\n\r\n    private _useFinalCode(migratedVertexCode: string, migratedFragmentCode: string, baseName: any, keepExistingPipelineContext = false) {\r\n        if (baseName) {\r\n            const vertex = baseName.vertexElement || baseName.vertex || baseName.spectorName || baseName;\r\n            const fragment = baseName.fragmentElement || baseName.fragment || baseName.spectorName || baseName;\r\n\r\n            this._vertexSourceCode = (this._shaderLanguage === ShaderLanguage.WGSL ? \"//\" : \"\") + \"#define SHADER_NAME vertex:\" + vertex + \"\\n\" + migratedVertexCode;\r\n            this._fragmentSourceCode = (this._shaderLanguage === ShaderLanguage.WGSL ? \"//\" : \"\") + \"#define SHADER_NAME fragment:\" + fragment + \"\\n\" + migratedFragmentCode;\r\n        } else {\r\n            this._vertexSourceCode = migratedVertexCode;\r\n            this._fragmentSourceCode = migratedFragmentCode;\r\n        }\r\n        this._prepareEffect(keepExistingPipelineContext);\r\n    }\r\n\r\n    /**\r\n     * Unique key for this effect\r\n     */\r\n    public get key(): string {\r\n        return this._key;\r\n    }\r\n\r\n    /**\r\n     * If the effect has been compiled and prepared.\r\n     * @returns if the effect is compiled and prepared.\r\n     */\r\n    public isReady(): boolean {\r\n        try {\r\n            return this._isReadyInternal();\r\n        } catch {\r\n            return false;\r\n        }\r\n    }\r\n\r\n    private _isReadyInternal(): boolean {\r\n        if (this._isReady) {\r\n            return true;\r\n        }\r\n        if (this._pipelineContext) {\r\n            return this._pipelineContext.isReady;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * The engine the effect was initialized with.\r\n     * @returns the engine.\r\n     */\r\n    public getEngine(): Engine {\r\n        return this._engine;\r\n    }\r\n\r\n    /**\r\n     * The pipeline context for this effect\r\n     * @returns the associated pipeline context\r\n     */\r\n    public getPipelineContext(): Nullable<IPipelineContext> {\r\n        return this._pipelineContext;\r\n    }\r\n\r\n    /**\r\n     * The set of names of attribute variables for the shader.\r\n     * @returns An array of attribute names.\r\n     */\r\n    public getAttributesNames(): string[] {\r\n        return this._attributesNames;\r\n    }\r\n\r\n    /**\r\n     * Returns the attribute at the given index.\r\n     * @param index The index of the attribute.\r\n     * @returns The location of the attribute.\r\n     */\r\n    public getAttributeLocation(index: number): number {\r\n        return this._attributes[index];\r\n    }\r\n\r\n    /**\r\n     * Returns the attribute based on the name of the variable.\r\n     * @param name of the attribute to look up.\r\n     * @returns the attribute location.\r\n     */\r\n    public getAttributeLocationByName(name: string): number {\r\n        return this._attributeLocationByName[name];\r\n    }\r\n\r\n    /**\r\n     * The number of attributes.\r\n     * @returns the number of attributes.\r\n     */\r\n    public getAttributesCount(): number {\r\n        return this._attributes.length;\r\n    }\r\n\r\n    /**\r\n     * Gets the index of a uniform variable.\r\n     * @param uniformName of the uniform to look up.\r\n     * @returns the index.\r\n     */\r\n    public getUniformIndex(uniformName: string): number {\r\n        return this._uniformsNames.indexOf(uniformName);\r\n    }\r\n\r\n    /**\r\n     * Returns the attribute based on the name of the variable.\r\n     * @param uniformName of the uniform to look up.\r\n     * @returns the location of the uniform.\r\n     */\r\n    public getUniform(uniformName: string): Nullable<WebGLUniformLocation> {\r\n        return this._uniforms[uniformName];\r\n    }\r\n\r\n    /**\r\n     * Returns an array of sampler variable names\r\n     * @returns The array of sampler variable names.\r\n     */\r\n    public getSamplers(): string[] {\r\n        return this._samplerList;\r\n    }\r\n\r\n    /**\r\n     * Returns an array of uniform variable names\r\n     * @returns The array of uniform variable names.\r\n     */\r\n    public getUniformNames(): string[] {\r\n        return this._uniformsNames;\r\n    }\r\n\r\n    /**\r\n     * Returns an array of uniform buffer variable names\r\n     * @returns The array of uniform buffer variable names.\r\n     */\r\n    public getUniformBuffersNames(): string[] {\r\n        return this._uniformBuffersNamesList;\r\n    }\r\n\r\n    /**\r\n     * Returns the index parameters used to create the effect\r\n     * @returns The index parameters object\r\n     */\r\n    public getIndexParameters(): any {\r\n        return this._indexParameters;\r\n    }\r\n\r\n    /**\r\n     * The error from the last compilation.\r\n     * @returns the error string.\r\n     */\r\n    public getCompilationError(): string {\r\n        return this._compilationError;\r\n    }\r\n\r\n    /**\r\n     * Gets a boolean indicating that all fallbacks were used during compilation\r\n     * @returns true if all fallbacks were used\r\n     */\r\n    public allFallbacksProcessed(): boolean {\r\n        return this._allFallbacksProcessed;\r\n    }\r\n\r\n    /**\r\n     * Adds a callback to the onCompiled observable and call the callback immediately if already ready.\r\n     * @param func The callback to be used.\r\n     */\r\n    public executeWhenCompiled(func: (effect: Effect) => void): void {\r\n        if (this.isReady()) {\r\n            func(this);\r\n            return;\r\n        }\r\n\r\n        this.onCompileObservable.add((effect) => {\r\n            func(effect);\r\n        });\r\n\r\n        if (!this._pipelineContext || this._pipelineContext.isAsync) {\r\n            setTimeout(() => {\r\n                this._checkIsReady(null);\r\n            }, 16);\r\n        }\r\n    }\r\n\r\n    private _checkIsReady(previousPipelineContext: Nullable<IPipelineContext>) {\r\n        try {\r\n            if (this._isReadyInternal()) {\r\n                return;\r\n            }\r\n        } catch (e) {\r\n            this._processCompilationErrors(e, previousPipelineContext);\r\n            return;\r\n        }\r\n\r\n        if (this._isDisposed) {\r\n            return;\r\n        }\r\n\r\n        setTimeout(() => {\r\n            this._checkIsReady(previousPipelineContext);\r\n        }, 16);\r\n    }\r\n\r\n    private _loadShader(shader: any, key: string, optionalKey: string, callback: (data: any) => void): void {\r\n        if (typeof HTMLElement !== \"undefined\") {\r\n            // DOM element ?\r\n            if (shader instanceof HTMLElement) {\r\n                const shaderCode = GetDOMTextContent(shader);\r\n                callback(shaderCode);\r\n                return;\r\n            }\r\n        }\r\n\r\n        // Direct source ?\r\n        if (shader.substr(0, 7) === \"source:\") {\r\n            callback(shader.substr(7));\r\n            return;\r\n        }\r\n\r\n        // Base64 encoded ?\r\n        if (shader.substr(0, 7) === \"base64:\") {\r\n            const shaderBinary = window.atob(shader.substr(7));\r\n            callback(shaderBinary);\r\n            return;\r\n        }\r\n\r\n        const shaderStore = EngineShaderStore.GetShadersStore(this._shaderLanguage);\r\n\r\n        // Is in local store ?\r\n        if (shaderStore[shader + key + \"Shader\"]) {\r\n            callback(shaderStore[shader + key + \"Shader\"]);\r\n            return;\r\n        }\r\n\r\n        if (optionalKey && shaderStore[shader + optionalKey + \"Shader\"]) {\r\n            callback(shaderStore[shader + optionalKey + \"Shader\"]);\r\n            return;\r\n        }\r\n\r\n        let shaderUrl;\r\n\r\n        if (shader[0] === \".\" || shader[0] === \"/\" || shader.indexOf(\"http\") > -1) {\r\n            shaderUrl = shader;\r\n        } else {\r\n            shaderUrl = EngineShaderStore.GetShadersRepository(this._shaderLanguage) + shader;\r\n        }\r\n\r\n        // Vertex shader\r\n        this._engine._loadFile(shaderUrl + \".\" + key.toLowerCase() + \".fx\", callback);\r\n    }\r\n\r\n    /**\r\n     * Gets the vertex shader source code of this effect\r\n     * This is the final source code that will be compiled, after all the processing has been done (pre-processing applied, code injection/replacement, etc)\r\n     */\r\n    public get vertexSourceCode(): string {\r\n        return this._vertexSourceCodeOverride && this._fragmentSourceCodeOverride\r\n            ? this._vertexSourceCodeOverride\r\n            : this._pipelineContext?._getVertexShaderCode() ?? this._vertexSourceCode;\r\n    }\r\n\r\n    /**\r\n     * Gets the fragment shader source code of this effect\r\n     * This is the final source code that will be compiled, after all the processing has been done (pre-processing applied, code injection/replacement, etc)\r\n     */\r\n    public get fragmentSourceCode(): string {\r\n        return this._vertexSourceCodeOverride && this._fragmentSourceCodeOverride\r\n            ? this._fragmentSourceCodeOverride\r\n            : this._pipelineContext?._getFragmentShaderCode() ?? this._fragmentSourceCode;\r\n    }\r\n\r\n    /**\r\n     * Gets the vertex shader source code before migration.\r\n     * This is the source code after the include directives have been replaced by their contents but before the code is migrated, i.e. before ShaderProcess._ProcessShaderConversion is executed.\r\n     * This method is, among other things, responsible for parsing #if/#define directives as well as converting GLES2 syntax to GLES3 (in the case of WebGL).\r\n     */\r\n    public get vertexSourceCodeBeforeMigration(): string {\r\n        return this._vertexSourceCodeBeforeMigration;\r\n    }\r\n\r\n    /**\r\n     * Gets the fragment shader source code before migration.\r\n     * This is the source code after the include directives have been replaced by their contents but before the code is migrated, i.e. before ShaderProcess._ProcessShaderConversion is executed.\r\n     * This method is, among other things, responsible for parsing #if/#define directives as well as converting GLES2 syntax to GLES3 (in the case of WebGL).\r\n     */\r\n    public get fragmentSourceCodeBeforeMigration(): string {\r\n        return this._fragmentSourceCodeBeforeMigration;\r\n    }\r\n\r\n    /**\r\n     * Gets the vertex shader source code before it has been modified by any processing\r\n     */\r\n    public get rawVertexSourceCode(): string {\r\n        return this._rawVertexSourceCode;\r\n    }\r\n\r\n    /**\r\n     * Gets the fragment shader source code before it has been modified by any processing\r\n     */\r\n    public get rawFragmentSourceCode(): string {\r\n        return this._rawFragmentSourceCode;\r\n    }\r\n\r\n    /**\r\n     * Recompiles the webGL program\r\n     * @param vertexSourceCode The source code for the vertex shader.\r\n     * @param fragmentSourceCode The source code for the fragment shader.\r\n     * @param onCompiled Callback called when completed.\r\n     * @param onError Callback called on error.\r\n     * @internal\r\n     */\r\n    public _rebuildProgram(vertexSourceCode: string, fragmentSourceCode: string, onCompiled: (pipelineContext: IPipelineContext) => void, onError: (message: string) => void) {\r\n        this._isReady = false;\r\n\r\n        this._vertexSourceCodeOverride = vertexSourceCode;\r\n        this._fragmentSourceCodeOverride = fragmentSourceCode;\r\n        this.onError = (effect, error) => {\r\n            if (onError) {\r\n                onError(error);\r\n            }\r\n        };\r\n        this.onCompiled = () => {\r\n            const scenes = this.getEngine().scenes;\r\n            if (scenes) {\r\n                for (let i = 0; i < scenes.length; i++) {\r\n                    scenes[i].markAllMaterialsAsDirty(Constants.MATERIAL_AllDirtyFlag);\r\n                }\r\n            }\r\n\r\n            this._pipelineContext!._handlesSpectorRebuildCallback?.(onCompiled);\r\n        };\r\n        this._fallbacks = null;\r\n        this._prepareEffect();\r\n    }\r\n\r\n    /**\r\n     * Prepares the effect\r\n     * @internal\r\n     */\r\n    public _prepareEffect(keepExistingPipelineContext = false) {\r\n        const attributesNames = this._attributesNames;\r\n        const defines = this.defines;\r\n\r\n        const previousPipelineContext = this._pipelineContext;\r\n\r\n        this._isReady = false;\r\n\r\n        try {\r\n            const engine = this._engine;\r\n\r\n            this._pipelineContext = (keepExistingPipelineContext ? previousPipelineContext : undefined) ?? engine.createPipelineContext(this._processingContext);\r\n            this._pipelineContext._name = this._key.replace(/\\r/g, \"\").replace(/\\n/g, \"|\");\r\n\r\n            const rebuildRebind = (\r\n                vertexSourceCode: string,\r\n                fragmentSourceCode: string,\r\n                onCompiled: (pipelineContext: IPipelineContext) => void,\r\n                onError: (message: string) => void\r\n            ) => this._rebuildProgram(vertexSourceCode, fragmentSourceCode, onCompiled, onError);\r\n            if (this._vertexSourceCodeOverride && this._fragmentSourceCodeOverride) {\r\n                engine._preparePipelineContext(\r\n                    this._pipelineContext,\r\n                    this._vertexSourceCodeOverride,\r\n                    this._fragmentSourceCodeOverride,\r\n                    true,\r\n                    this._rawVertexSourceCode,\r\n                    this._rawFragmentSourceCode,\r\n                    rebuildRebind,\r\n                    null,\r\n                    this._transformFeedbackVaryings,\r\n                    this._key\r\n                );\r\n            } else {\r\n                engine._preparePipelineContext(\r\n                    this._pipelineContext,\r\n                    this._vertexSourceCode,\r\n                    this._fragmentSourceCode,\r\n                    false,\r\n                    this._rawVertexSourceCode,\r\n                    this._rawFragmentSourceCode,\r\n                    rebuildRebind,\r\n                    defines,\r\n                    this._transformFeedbackVaryings,\r\n                    this._key\r\n                );\r\n            }\r\n\r\n            engine._executeWhenRenderingStateIsCompiled(this._pipelineContext, () => {\r\n                this._attributes = [];\r\n                this._pipelineContext!._fillEffectInformation(\r\n                    this,\r\n                    this._uniformBuffersNames,\r\n                    this._uniformsNames,\r\n                    this._uniforms,\r\n                    this._samplerList,\r\n                    this._samplers,\r\n                    attributesNames,\r\n                    this._attributes\r\n                );\r\n\r\n                // Caches attribute locations.\r\n                if (attributesNames) {\r\n                    for (let i = 0; i < attributesNames.length; i++) {\r\n                        const name = attributesNames[i];\r\n                        this._attributeLocationByName[name] = this._attributes[i];\r\n                    }\r\n                }\r\n\r\n                engine.bindSamplers(this);\r\n\r\n                this._compilationError = \"\";\r\n                this._isReady = true;\r\n                if (this.onCompiled) {\r\n                    this.onCompiled(this);\r\n                }\r\n                this.onCompileObservable.notifyObservers(this);\r\n                this.onCompileObservable.clear();\r\n\r\n                // Unbind mesh reference in fallbacks\r\n                if (this._fallbacks) {\r\n                    this._fallbacks.unBindMesh();\r\n                }\r\n\r\n                if (previousPipelineContext && !keepExistingPipelineContext) {\r\n                    this.getEngine()._deletePipelineContext(previousPipelineContext);\r\n                }\r\n            });\r\n\r\n            if (this._pipelineContext.isAsync) {\r\n                this._checkIsReady(previousPipelineContext);\r\n            }\r\n        } catch (e) {\r\n            this._processCompilationErrors(e, previousPipelineContext);\r\n        }\r\n    }\r\n\r\n    private _getShaderCodeAndErrorLine(code: Nullable<string>, error: Nullable<string>, isFragment: boolean): [Nullable<string>, Nullable<string>] {\r\n        const regexp = isFragment ? /FRAGMENT SHADER ERROR: 0:(\\d+?):/ : /VERTEX SHADER ERROR: 0:(\\d+?):/;\r\n\r\n        let errorLine = null;\r\n\r\n        if (error && code) {\r\n            const res = error.match(regexp);\r\n            if (res && res.length === 2) {\r\n                const lineNumber = parseInt(res[1]);\r\n                const lines = code.split(\"\\n\", -1);\r\n                if (lines.length >= lineNumber) {\r\n                    errorLine = `Offending line [${lineNumber}] in ${isFragment ? \"fragment\" : \"vertex\"} code: ${lines[lineNumber - 1]}`;\r\n                }\r\n            }\r\n        }\r\n\r\n        return [code, errorLine];\r\n    }\r\n\r\n    private _processCompilationErrors(e: any, previousPipelineContext: Nullable<IPipelineContext> = null) {\r\n        this._compilationError = e.message;\r\n        const attributesNames = this._attributesNames;\r\n        const fallbacks = this._fallbacks;\r\n\r\n        // Let's go through fallbacks then\r\n        Logger.Error(\"Unable to compile effect:\");\r\n        Logger.Error(\r\n            \"Uniforms: \" +\r\n                this._uniformsNames.map(function (uniform) {\r\n                    return \" \" + uniform;\r\n                })\r\n        );\r\n        Logger.Error(\r\n            \"Attributes: \" +\r\n                attributesNames.map(function (attribute) {\r\n                    return \" \" + attribute;\r\n                })\r\n        );\r\n        Logger.Error(\"Defines:\\n\" + this.defines);\r\n        if (Effect.LogShaderCodeOnCompilationError) {\r\n            let lineErrorVertex = null,\r\n                lineErrorFragment = null,\r\n                code = null;\r\n            if (this._pipelineContext?._getVertexShaderCode()) {\r\n                [code, lineErrorVertex] = this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(), this._compilationError, false);\r\n                if (code) {\r\n                    Logger.Error(\"Vertex code:\");\r\n                    Logger.Error(code);\r\n                }\r\n            }\r\n            if (this._pipelineContext?._getFragmentShaderCode()) {\r\n                [code, lineErrorFragment] = this._getShaderCodeAndErrorLine(this._pipelineContext?._getFragmentShaderCode(), this._compilationError, true);\r\n                if (code) {\r\n                    Logger.Error(\"Fragment code:\");\r\n                    Logger.Error(code);\r\n                }\r\n            }\r\n            if (lineErrorVertex) {\r\n                Logger.Error(lineErrorVertex);\r\n            }\r\n            if (lineErrorFragment) {\r\n                Logger.Error(lineErrorFragment);\r\n            }\r\n        }\r\n        Logger.Error(\"Error: \" + this._compilationError);\r\n\r\n        const notifyErrors = () => {\r\n            if (this.onError) {\r\n                this.onError(this, this._compilationError);\r\n            }\r\n            this.onErrorObservable.notifyObservers(this);\r\n        };\r\n\r\n        // In case a previous compilation was successful, we need to restore the previous pipeline context\r\n        if (previousPipelineContext) {\r\n            this._pipelineContext = previousPipelineContext;\r\n            this._isReady = true;\r\n            notifyErrors();\r\n        }\r\n\r\n        // Lets try to compile fallbacks as long as we have some.\r\n        if (fallbacks) {\r\n            this._pipelineContext = null;\r\n            if (fallbacks.hasMoreFallbacks) {\r\n                this._allFallbacksProcessed = false;\r\n                Logger.Error(\"Trying next fallback.\");\r\n                this.defines = fallbacks.reduce(this.defines, this);\r\n                this._prepareEffect();\r\n            } else {\r\n                // Sorry we did everything we can\r\n                this._allFallbacksProcessed = true;\r\n                notifyErrors();\r\n                this.onErrorObservable.clear();\r\n\r\n                // Unbind mesh reference in fallbacks\r\n                if (this._fallbacks) {\r\n                    this._fallbacks.unBindMesh();\r\n                }\r\n            }\r\n        } else {\r\n            this._allFallbacksProcessed = true;\r\n\r\n            // In case of error, without any prior successful compilation, let s notify observers\r\n            if (!previousPipelineContext) {\r\n                notifyErrors();\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Checks if the effect is supported. (Must be called after compilation)\r\n     */\r\n    public get isSupported(): boolean {\r\n        return this._compilationError === \"\";\r\n    }\r\n\r\n    /**\r\n     * Binds a texture to the engine to be used as output of the shader.\r\n     * @param channel Name of the output variable.\r\n     * @param texture Texture to bind.\r\n     * @internal\r\n     */\r\n    public _bindTexture(channel: string, texture: Nullable<InternalTexture>): void {\r\n        this._engine._bindTexture(this._samplers[channel], texture, channel);\r\n    }\r\n\r\n    /**\r\n     * Sets a texture on the engine to be used in the shader.\r\n     * @param channel Name of the sampler variable.\r\n     * @param texture Texture to set.\r\n     */\r\n    public setTexture(channel: string, texture: Nullable<ThinTexture>): void {\r\n        this._engine.setTexture(this._samplers[channel], this._uniforms[channel], texture, channel);\r\n    }\r\n\r\n    /**\r\n     * Sets a depth stencil texture from a render target on the engine to be used in the shader.\r\n     * @param channel Name of the sampler variable.\r\n     * @param texture Texture to set.\r\n     */\r\n    public setDepthStencilTexture(channel: string, texture: Nullable<RenderTargetTexture>): void {\r\n        this._engine.setDepthStencilTexture(this._samplers[channel], this._uniforms[channel], texture, channel);\r\n    }\r\n\r\n    /**\r\n     * Sets an array of textures on the engine to be used in the shader.\r\n     * @param channel Name of the variable.\r\n     * @param textures Textures to set.\r\n     */\r\n    public setTextureArray(channel: string, textures: ThinTexture[]): void {\r\n        const exName = channel + \"Ex\";\r\n        if (this._samplerList.indexOf(exName + \"0\") === -1) {\r\n            const initialPos = this._samplerList.indexOf(channel);\r\n            for (let index = 1; index < textures.length; index++) {\r\n                const currentExName = exName + (index - 1).toString();\r\n                this._samplerList.splice(initialPos + index, 0, currentExName);\r\n            }\r\n\r\n            // Reset every channels\r\n            let channelIndex = 0;\r\n            for (const key of this._samplerList) {\r\n                this._samplers[key] = channelIndex;\r\n                channelIndex += 1;\r\n            }\r\n        }\r\n\r\n        this._engine.setTextureArray(this._samplers[channel], this._uniforms[channel], textures, channel);\r\n    }\r\n\r\n    /**\r\n     * Sets a texture to be the input of the specified post process. (To use the output, pass in the next post process in the pipeline)\r\n     * @param channel Name of the sampler variable.\r\n     * @param postProcess Post process to get the input texture from.\r\n     */\r\n    public setTextureFromPostProcess(channel: string, postProcess: Nullable<PostProcess>): void {\r\n        this._engine.setTextureFromPostProcess(this._samplers[channel], postProcess, channel);\r\n    }\r\n\r\n    /**\r\n     * (Warning! setTextureFromPostProcessOutput may be desired instead)\r\n     * Sets the input texture of the passed in post process to be input of this effect. (To use the output of the passed in post process use setTextureFromPostProcessOutput)\r\n     * @param channel Name of the sampler variable.\r\n     * @param postProcess Post process to get the output texture from.\r\n     */\r\n    public setTextureFromPostProcessOutput(channel: string, postProcess: Nullable<PostProcess>): void {\r\n        this._engine.setTextureFromPostProcessOutput(this._samplers[channel], postProcess, channel);\r\n    }\r\n\r\n    /**\r\n     * Binds a buffer to a uniform.\r\n     * @param buffer Buffer to bind.\r\n     * @param name Name of the uniform variable to bind to.\r\n     */\r\n    public bindUniformBuffer(buffer: DataBuffer, name: string): void {\r\n        const bufferName = this._uniformBuffersNames[name];\r\n        if (bufferName === undefined || (Effect._BaseCache[bufferName] === buffer && this._engine._features.useUBOBindingCache)) {\r\n            return;\r\n        }\r\n        Effect._BaseCache[bufferName] = buffer;\r\n        this._engine.bindUniformBufferBase(buffer, bufferName, name);\r\n    }\r\n\r\n    /**\r\n     * Binds block to a uniform.\r\n     * @param blockName Name of the block to bind.\r\n     * @param index Index to bind.\r\n     */\r\n    public bindUniformBlock(blockName: string, index: number): void {\r\n        this._engine.bindUniformBlock(this._pipelineContext!, blockName, index);\r\n    }\r\n\r\n    /**\r\n     * Sets an integer value on a uniform variable.\r\n     * @param uniformName Name of the variable.\r\n     * @param value Value to be set.\r\n     * @returns this effect.\r\n     */\r\n    public setInt(uniformName: string, value: number): Effect {\r\n        this._pipelineContext!.setInt(uniformName, value);\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Sets an int2 value on a uniform variable.\r\n     * @param uniformName Name of the variable.\r\n     * @param x First int in int2.\r\n     * @param y Second int in int2.\r\n     * @returns this effect.\r\n     */\r\n    public setInt2(uniformName: string, x: number, y: number): Effect {\r\n        this._pipelineContext!.setInt2(uniformName, x, y);\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Sets an int3 value on a uniform variable.\r\n     * @param uniformName Name of the variable.\r\n     * @param x First int in int3.\r\n     * @param y Second int in int3.\r\n     * @param z Third int in int3.\r\n     * @returns this effect.\r\n     */\r\n    public setInt3(uniformName: string, x: number, y: number, z: number): Effect {\r\n        this._pipelineContext!.setInt3(uniformName, x, y, z);\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Sets an int4 value on a uniform variable.\r\n     * @param uniformName Name of the variable.\r\n     * @param x First int in int4.\r\n     * @param y Second int in int4.\r\n     * @param z Third int in int4.\r\n     * @param w Fourth int in int4.\r\n     * @returns this effect.\r\n     */\r\n    public setInt4(uniformName: string, x: number, y: number, z: number, w: number): Effect {\r\n        this._pipelineContext!.setInt4(uniformName, x, y, z, w);\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Sets an int array on a uniform variable.\r\n     * @param uniformName Name of the variable.\r\n     * @param array array to be set.\r\n     * @returns this effect.\r\n     */\r\n    public setIntArray(uniformName: string, array: Int32Array): Effect {\r\n        this._pipelineContext!.setIntArray(uniformName, array);\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Sets an int array 2 on a uniform variable. (Array is specified as single array eg. [1,2,3,4] will result in [[1,2],[3,4]] in the shader)\r\n     * @param uniformName Name of the variable.\r\n     * @param array array to be set.\r\n     * @returns this effect.\r\n     */\r\n    public setIntArray2(uniformName: string, array: Int32Array): Effect {\r\n        this._pipelineContext!.setIntArray2(uniformName, array);\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Sets an int array 3 on a uniform variable. (Array is specified as single array eg. [1,2,3,4,5,6] will result in [[1,2,3],[4,5,6]] in the shader)\r\n     * @param uniformName Name of the variable.\r\n     * @param array array to be set.\r\n     * @returns this effect.\r\n     */\r\n    public setIntArray3(uniformName: string, array: Int32Array): Effect {\r\n        this._pipelineContext!.setIntArray3(uniformName, array);\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Sets an int array 4 on a uniform variable. (Array is specified as single array eg. [1,2,3,4,5,6,7,8] will result in [[1,2,3,4],[5,6,7,8]] in the shader)\r\n     * @param uniformName Name of the variable.\r\n     * @param array array to be set.\r\n     * @returns this effect.\r\n     */\r\n    public setIntArray4(uniformName: string, array: Int32Array): Effect {\r\n        this._pipelineContext!.setIntArray4(uniformName, array);\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Sets an unsigned integer value on a uniform variable.\r\n     * @param uniformName Name of the variable.\r\n     * @param value Value to be set.\r\n     * @returns this effect.\r\n     */\r\n    public setUInt(uniformName: string, value: number): Effect {\r\n        this._pipelineContext!.setUInt(uniformName, value);\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Sets an unsigned int2 value on a uniform variable.\r\n     * @param uniformName Name of the variable.\r\n     * @param x First unsigned int in uint2.\r\n     * @param y Second unsigned int in uint2.\r\n     * @returns this effect.\r\n     */\r\n    public setUInt2(uniformName: string, x: number, y: number): Effect {\r\n        this._pipelineContext!.setUInt2(uniformName, x, y);\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Sets an unsigned int3 value on a uniform variable.\r\n     * @param uniformName Name of the variable.\r\n     * @param x First unsigned int in uint3.\r\n     * @param y Second unsigned int in uint3.\r\n     * @param z Third unsigned int in uint3.\r\n     * @returns this effect.\r\n     */\r\n    public setUInt3(uniformName: string, x: number, y: number, z: number): Effect {\r\n        this._pipelineContext!.setUInt3(uniformName, x, y, z);\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Sets an unsigned int4 value on a uniform variable.\r\n     * @param uniformName Name of the variable.\r\n     * @param x First unsigned int in uint4.\r\n     * @param y Second unsigned int in uint4.\r\n     * @param z Third unsigned int in uint4.\r\n     * @param w Fourth unsigned int in uint4.\r\n     * @returns this effect.\r\n     */\r\n    public setUInt4(uniformName: string, x: number, y: number, z: number, w: number): Effect {\r\n        this._pipelineContext!.setUInt4(uniformName, x, y, z, w);\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Sets an unsigned int array on a uniform variable.\r\n     * @param uniformName Name of the variable.\r\n     * @param array array to be set.\r\n     * @returns this effect.\r\n     */\r\n    public setUIntArray(uniformName: string, array: Uint32Array): Effect {\r\n        this._pipelineContext!.setUIntArray(uniformName, array);\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Sets an unsigned int array 2 on a uniform variable. (Array is specified as single array eg. [1,2,3,4] will result in [[1,2],[3,4]] in the shader)\r\n     * @param uniformName Name of the variable.\r\n     * @param array array to be set.\r\n     * @returns this effect.\r\n     */\r\n    public setUIntArray2(uniformName: string, array: Uint32Array): Effect {\r\n        this._pipelineContext!.setUIntArray2(uniformName, array);\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Sets an unsigned int array 3 on a uniform variable. (Array is specified as single array eg. [1,2,3,4,5,6] will result in [[1,2,3],[4,5,6]] in the shader)\r\n     * @param uniformName Name of the variable.\r\n     * @param array array to be set.\r\n     * @returns this effect.\r\n     */\r\n    public setUIntArray3(uniformName: string, array: Uint32Array): Effect {\r\n        this._pipelineContext!.setUIntArray3(uniformName, array);\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Sets an unsigned int array 4 on a uniform variable. (Array is specified as single array eg. [1,2,3,4,5,6,7,8] will result in [[1,2,3,4],[5,6,7,8]] in the shader)\r\n     * @param uniformName Name of the variable.\r\n     * @param array array to be set.\r\n     * @returns this effect.\r\n     */\r\n    public setUIntArray4(uniformName: string, array: Uint32Array): Effect {\r\n        this._pipelineContext!.setUIntArray4(uniformName, array);\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Sets an float array on a uniform variable.\r\n     * @param uniformName Name of the variable.\r\n     * @param array array to be set.\r\n     * @returns this effect.\r\n     */\r\n    public setFloatArray(uniformName: string, array: FloatArray): Effect {\r\n        this._pipelineContext!.setArray(uniformName, array);\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Sets an float array 2 on a uniform variable. (Array is specified as single array eg. [1,2,3,4] will result in [[1,2],[3,4]] in the shader)\r\n     * @param uniformName Name of the variable.\r\n     * @param array array to be set.\r\n     * @returns this effect.\r\n     */\r\n    public setFloatArray2(uniformName: string, array: FloatArray): Effect {\r\n        this._pipelineContext!.setArray2(uniformName, array);\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Sets an float array 3 on a uniform variable. (Array is specified as single array eg. [1,2,3,4,5,6] will result in [[1,2,3],[4,5,6]] in the shader)\r\n     * @param uniformName Name of the variable.\r\n     * @param array array to be set.\r\n     * @returns this effect.\r\n     */\r\n    public setFloatArray3(uniformName: string, array: FloatArray): Effect {\r\n        this._pipelineContext!.setArray3(uniformName, array);\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Sets an float array 4 on a uniform variable. (Array is specified as single array eg. [1,2,3,4,5,6,7,8] will result in [[1,2,3,4],[5,6,7,8]] in the shader)\r\n     * @param uniformName Name of the variable.\r\n     * @param array array to be set.\r\n     * @returns this effect.\r\n     */\r\n    public setFloatArray4(uniformName: string, array: FloatArray): Effect {\r\n        this._pipelineContext!.setArray4(uniformName, array);\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Sets an array on a uniform variable.\r\n     * @param uniformName Name of the variable.\r\n     * @param array array to be set.\r\n     * @returns this effect.\r\n     */\r\n    public setArray(uniformName: string, array: number[]): Effect {\r\n        this._pipelineContext!.setArray(uniformName, array);\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Sets an array 2 on a uniform variable. (Array is specified as single array eg. [1,2,3,4] will result in [[1,2],[3,4]] in the shader)\r\n     * @param uniformName Name of the variable.\r\n     * @param array array to be set.\r\n     * @returns this effect.\r\n     */\r\n    public setArray2(uniformName: string, array: number[]): Effect {\r\n        this._pipelineContext!.setArray2(uniformName, array);\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Sets an array 3 on a uniform variable. (Array is specified as single array eg. [1,2,3,4,5,6] will result in [[1,2,3],[4,5,6]] in the shader)\r\n     * @param uniformName Name of the variable.\r\n     * @param array array to be set.\r\n     * @returns this effect.\r\n     */\r\n    public setArray3(uniformName: string, array: number[]): Effect {\r\n        this._pipelineContext!.setArray3(uniformName, array);\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Sets an array 4 on a uniform variable. (Array is specified as single array eg. [1,2,3,4,5,6,7,8] will result in [[1,2,3,4],[5,6,7,8]] in the shader)\r\n     * @param uniformName Name of the variable.\r\n     * @param array array to be set.\r\n     * @returns this effect.\r\n     */\r\n    public setArray4(uniformName: string, array: number[]): Effect {\r\n        this._pipelineContext!.setArray4(uniformName, array);\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Sets matrices on a uniform variable.\r\n     * @param uniformName Name of the variable.\r\n     * @param matrices matrices to be set.\r\n     * @returns this effect.\r\n     */\r\n    public setMatrices(uniformName: string, matrices: Float32Array | Array<number>): Effect {\r\n        this._pipelineContext!.setMatrices(uniformName, matrices as Float32Array);\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Sets matrix on a uniform variable.\r\n     * @param uniformName Name of the variable.\r\n     * @param matrix matrix to be set.\r\n     * @returns this effect.\r\n     */\r\n    public setMatrix(uniformName: string, matrix: IMatrixLike): Effect {\r\n        this._pipelineContext!.setMatrix(uniformName, matrix);\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Sets a 3x3 matrix on a uniform variable. (Specified as [1,2,3,4,5,6,7,8,9] will result in [1,2,3][4,5,6][7,8,9] matrix)\r\n     * @param uniformName Name of the variable.\r\n     * @param matrix matrix to be set.\r\n     * @returns this effect.\r\n     */\r\n    public setMatrix3x3(uniformName: string, matrix: Float32Array | Array<number>): Effect {\r\n        // the cast is ok because it is gl.uniformMatrix3fv() which is called at the end, and this function accepts Float32Array and Array<number>\r\n        this._pipelineContext!.setMatrix3x3(uniformName, matrix as Float32Array);\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Sets a 2x2 matrix on a uniform variable. (Specified as [1,2,3,4] will result in [1,2][3,4] matrix)\r\n     * @param uniformName Name of the variable.\r\n     * @param matrix matrix to be set.\r\n     * @returns this effect.\r\n     */\r\n    public setMatrix2x2(uniformName: string, matrix: Float32Array | Array<number>): Effect {\r\n        // the cast is ok because it is gl.uniformMatrix3fv() which is called at the end, and this function accepts Float32Array and Array<number>\r\n        this._pipelineContext!.setMatrix2x2(uniformName, matrix as Float32Array);\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Sets a float on a uniform variable.\r\n     * @param uniformName Name of the variable.\r\n     * @param value value to be set.\r\n     * @returns this effect.\r\n     */\r\n    public setFloat(uniformName: string, value: number): Effect {\r\n        this._pipelineContext!.setFloat(uniformName, value);\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Sets a boolean on a uniform variable.\r\n     * @param uniformName Name of the variable.\r\n     * @param bool value to be set.\r\n     * @returns this effect.\r\n     */\r\n    public setBool(uniformName: string, bool: boolean): Effect {\r\n        this._pipelineContext!.setInt(uniformName, bool ? 1 : 0);\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Sets a Vector2 on a uniform variable.\r\n     * @param uniformName Name of the variable.\r\n     * @param vector2 vector2 to be set.\r\n     * @returns this effect.\r\n     */\r\n    public setVector2(uniformName: string, vector2: IVector2Like): Effect {\r\n        this._pipelineContext!.setVector2(uniformName, vector2);\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Sets a float2 on a uniform variable.\r\n     * @param uniformName Name of the variable.\r\n     * @param x First float in float2.\r\n     * @param y Second float in float2.\r\n     * @returns this effect.\r\n     */\r\n    public setFloat2(uniformName: string, x: number, y: number): Effect {\r\n        this._pipelineContext!.setFloat2(uniformName, x, y);\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Sets a Vector3 on a uniform variable.\r\n     * @param uniformName Name of the variable.\r\n     * @param vector3 Value to be set.\r\n     * @returns this effect.\r\n     */\r\n    public setVector3(uniformName: string, vector3: IVector3Like): Effect {\r\n        this._pipelineContext!.setVector3(uniformName, vector3);\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Sets a float3 on a uniform variable.\r\n     * @param uniformName Name of the variable.\r\n     * @param x First float in float3.\r\n     * @param y Second float in float3.\r\n     * @param z Third float in float3.\r\n     * @returns this effect.\r\n     */\r\n    public setFloat3(uniformName: string, x: number, y: number, z: number): Effect {\r\n        this._pipelineContext!.setFloat3(uniformName, x, y, z);\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Sets a Vector4 on a uniform variable.\r\n     * @param uniformName Name of the variable.\r\n     * @param vector4 Value to be set.\r\n     * @returns this effect.\r\n     */\r\n    public setVector4(uniformName: string, vector4: IVector4Like): Effect {\r\n        this._pipelineContext!.setVector4(uniformName, vector4);\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Sets a Quaternion on a uniform variable.\r\n     * @param uniformName Name of the variable.\r\n     * @param quaternion Value to be set.\r\n     * @returns this effect.\r\n     */\r\n    public setQuaternion(uniformName: string, quaternion: IQuaternionLike): Effect {\r\n        this._pipelineContext!.setQuaternion(uniformName, quaternion);\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Sets a float4 on a uniform variable.\r\n     * @param uniformName Name of the variable.\r\n     * @param x First float in float4.\r\n     * @param y Second float in float4.\r\n     * @param z Third float in float4.\r\n     * @param w Fourth float in float4.\r\n     * @returns this effect.\r\n     */\r\n    public setFloat4(uniformName: string, x: number, y: number, z: number, w: number): Effect {\r\n        this._pipelineContext!.setFloat4(uniformName, x, y, z, w);\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Sets a Color3 on a uniform variable.\r\n     * @param uniformName Name of the variable.\r\n     * @param color3 Value to be set.\r\n     * @returns this effect.\r\n     */\r\n    public setColor3(uniformName: string, color3: IColor3Like): Effect {\r\n        this._pipelineContext!.setColor3(uniformName, color3);\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Sets a Color4 on a uniform variable.\r\n     * @param uniformName Name of the variable.\r\n     * @param color3 Value to be set.\r\n     * @param alpha Alpha value to be set.\r\n     * @returns this effect.\r\n     */\r\n    public setColor4(uniformName: string, color3: IColor3Like, alpha: number): Effect {\r\n        this._pipelineContext!.setColor4(uniformName, color3, alpha);\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Sets a Color4 on a uniform variable\r\n     * @param uniformName defines the name of the variable\r\n     * @param color4 defines the value to be set\r\n     * @returns this effect.\r\n     */\r\n    public setDirectColor4(uniformName: string, color4: IColor4Like): Effect {\r\n        this._pipelineContext!.setDirectColor4(uniformName, color4);\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Release all associated resources.\r\n     **/\r\n    public dispose() {\r\n        if (this._pipelineContext) {\r\n            this._pipelineContext.dispose();\r\n        }\r\n        this._engine._releaseEffect(this);\r\n\r\n        this._isDisposed = true;\r\n    }\r\n\r\n    /**\r\n     * This function will add a new shader to the shader store\r\n     * @param name the name of the shader\r\n     * @param pixelShader optional pixel shader content\r\n     * @param vertexShader optional vertex shader content\r\n     * @param shaderLanguage the language the shader is written in (default: GLSL)\r\n     */\r\n    public static RegisterShader(name: string, pixelShader?: string, vertexShader?: string, shaderLanguage = ShaderLanguage.GLSL) {\r\n        if (pixelShader) {\r\n            EngineShaderStore.GetShadersStore(shaderLanguage)[`${name}PixelShader`] = pixelShader;\r\n        }\r\n\r\n        if (vertexShader) {\r\n            EngineShaderStore.GetShadersStore(shaderLanguage)[`${name}VertexShader`] = vertexShader;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Store of each shader (The can be looked up using effect.key)\r\n     */\r\n    public static ShadersStore: { [key: string]: string } = EngineShaderStore.ShadersStore;\r\n    /**\r\n     * Store of each included file for a shader (The can be looked up using effect.key)\r\n     */\r\n    public static IncludesShadersStore: { [key: string]: string } = EngineShaderStore.IncludesShadersStore;\r\n\r\n    /**\r\n     * Resets the cache of effects.\r\n     */\r\n    public static ResetCache() {\r\n        Effect._BaseCache = {};\r\n    }\r\n}\r\n", "import type { Nullable } from \"../types\";\r\n\r\n/**\r\n * @internal\r\n **/\r\nexport class DepthCullingState {\r\n    protected _isDepthTestDirty = false;\r\n    protected _isDepthMaskDirty = false;\r\n    protected _isDepthFuncDirty = false;\r\n    protected _isCullFaceDirty = false;\r\n    protected _isCullDirty = false;\r\n    protected _isZOffsetDirty = false;\r\n    protected _isFrontFaceDirty = false;\r\n\r\n    protected _depthTest: boolean;\r\n    protected _depthMask: boolean;\r\n    protected _depthFunc: Nullable<number>;\r\n    protected _cull: Nullable<boolean>;\r\n    protected _cullFace: Nullable<number>;\r\n    protected _zOffset: number;\r\n    protected _zOffsetUnits: number;\r\n    protected _frontFace: Nullable<number>;\r\n\r\n    /**\r\n     * Initializes the state.\r\n     * @param reset\r\n     */\r\n    public constructor(reset = true) {\r\n        if (reset) {\r\n            this.reset();\r\n        }\r\n    }\r\n\r\n    public get isDirty(): boolean {\r\n        return (\r\n            this._isDepthFuncDirty ||\r\n            this._isDepthTestDirty ||\r\n            this._isDepthMaskDirty ||\r\n            this._isCullFaceDirty ||\r\n            this._isCullDirty ||\r\n            this._isZOffsetDirty ||\r\n            this._isFrontFaceDirty\r\n        );\r\n    }\r\n\r\n    public get zOffset(): number {\r\n        return this._zOffset;\r\n    }\r\n\r\n    public set zOffset(value: number) {\r\n        if (this._zOffset === value) {\r\n            return;\r\n        }\r\n\r\n        this._zOffset = value;\r\n        this._isZOffsetDirty = true;\r\n    }\r\n\r\n    public get zOffsetUnits(): number {\r\n        return this._zOffsetUnits;\r\n    }\r\n\r\n    public set zOffsetUnits(value: number) {\r\n        if (this._zOffsetUnits === value) {\r\n            return;\r\n        }\r\n\r\n        this._zOffsetUnits = value;\r\n        this._isZOffsetDirty = true;\r\n    }\r\n\r\n    public get cullFace(): Nullable<number> {\r\n        return this._cullFace;\r\n    }\r\n\r\n    public set cullFace(value: Nullable<number>) {\r\n        if (this._cullFace === value) {\r\n            return;\r\n        }\r\n\r\n        this._cullFace = value;\r\n        this._isCullFaceDirty = true;\r\n    }\r\n\r\n    public get cull(): Nullable<boolean> {\r\n        return this._cull;\r\n    }\r\n\r\n    public set cull(value: Nullable<boolean>) {\r\n        if (this._cull === value) {\r\n            return;\r\n        }\r\n\r\n        this._cull = value;\r\n        this._isCullDirty = true;\r\n    }\r\n\r\n    public get depthFunc(): Nullable<number> {\r\n        return this._depthFunc;\r\n    }\r\n\r\n    public set depthFunc(value: Nullable<number>) {\r\n        if (this._depthFunc === value) {\r\n            return;\r\n        }\r\n\r\n        this._depthFunc = value;\r\n        this._isDepthFuncDirty = true;\r\n    }\r\n\r\n    public get depthMask(): boolean {\r\n        return this._depthMask;\r\n    }\r\n\r\n    public set depthMask(value: boolean) {\r\n        if (this._depthMask === value) {\r\n            return;\r\n        }\r\n\r\n        this._depthMask = value;\r\n        this._isDepthMaskDirty = true;\r\n    }\r\n\r\n    public get depthTest(): boolean {\r\n        return this._depthTest;\r\n    }\r\n\r\n    public set depthTest(value: boolean) {\r\n        if (this._depthTest === value) {\r\n            return;\r\n        }\r\n\r\n        this._depthTest = value;\r\n        this._isDepthTestDirty = true;\r\n    }\r\n\r\n    public get frontFace(): Nullable<number> {\r\n        return this._frontFace;\r\n    }\r\n\r\n    public set frontFace(value: Nullable<number>) {\r\n        if (this._frontFace === value) {\r\n            return;\r\n        }\r\n\r\n        this._frontFace = value;\r\n        this._isFrontFaceDirty = true;\r\n    }\r\n\r\n    public reset() {\r\n        this._depthMask = true;\r\n        this._depthTest = true;\r\n        this._depthFunc = null;\r\n        this._cullFace = null;\r\n        this._cull = null;\r\n        this._zOffset = 0;\r\n        this._zOffsetUnits = 0;\r\n        this._frontFace = null;\r\n\r\n        this._isDepthTestDirty = true;\r\n        this._isDepthMaskDirty = true;\r\n        this._isDepthFuncDirty = false;\r\n        this._isCullFaceDirty = false;\r\n        this._isCullDirty = false;\r\n        this._isZOffsetDirty = true;\r\n        this._isFrontFaceDirty = false;\r\n    }\r\n\r\n    public apply(gl: WebGLRenderingContext) {\r\n        if (!this.isDirty) {\r\n            return;\r\n        }\r\n\r\n        // Cull\r\n        if (this._isCullDirty) {\r\n            if (this.cull) {\r\n                gl.enable(gl.CULL_FACE);\r\n            } else {\r\n                gl.disable(gl.CULL_FACE);\r\n            }\r\n\r\n            this._isCullDirty = false;\r\n        }\r\n\r\n        // Cull face\r\n        if (this._isCullFaceDirty) {\r\n            gl.cullFace(<number>this.cullFace);\r\n            this._isCullFaceDirty = false;\r\n        }\r\n\r\n        // Depth mask\r\n        if (this._isDepthMaskDirty) {\r\n            gl.depthMask(this.depthMask);\r\n            this._isDepthMaskDirty = false;\r\n        }\r\n\r\n        // Depth test\r\n        if (this._isDepthTestDirty) {\r\n            if (this.depthTest) {\r\n                gl.enable(gl.DEPTH_TEST);\r\n            } else {\r\n                gl.disable(gl.DEPTH_TEST);\r\n            }\r\n            this._isDepthTestDirty = false;\r\n        }\r\n\r\n        // Depth func\r\n        if (this._isDepthFuncDirty) {\r\n            gl.depthFunc(<number>this.depthFunc);\r\n            this._isDepthFuncDirty = false;\r\n        }\r\n\r\n        // zOffset\r\n        if (this._isZOffsetDirty) {\r\n            if (this.zOffset || this.zOffsetUnits) {\r\n                gl.enable(gl.POLYGON_OFFSET_FILL);\r\n                gl.polygonOffset(this.zOffset, this.zOffsetUnits);\r\n            } else {\r\n                gl.disable(gl.POLYGON_OFFSET_FILL);\r\n            }\r\n\r\n            this._isZOffsetDirty = false;\r\n        }\r\n\r\n        // Front face\r\n        if (this._isFrontFaceDirty) {\r\n            gl.frontFace(<number>this.frontFace);\r\n            this._isFrontFaceDirty = false;\r\n        }\r\n    }\r\n}\r\n", "import { Constants } from \"../Engines/constants\";\r\nimport type { IStencilState } from \"./IStencilState\";\r\n\r\n/**\r\n * @internal\r\n **/\r\nexport class StencilState implements IStencilState {\r\n    /** Passed to depthFunction or stencilFunction to specify depth or stencil tests will always pass. i.e. Pixels will be drawn in the order they are drawn */\r\n    public static readonly ALWAYS = Constants.ALWAYS;\r\n    /** Passed to stencilOperation to specify that stencil value must be kept */\r\n    public static readonly KEEP = Constants.KEEP;\r\n    /** Passed to stencilOperation to specify that stencil value must be replaced */\r\n    public static readonly REPLACE = Constants.REPLACE;\r\n\r\n    public constructor() {\r\n        this.reset();\r\n    }\r\n\r\n    public reset() {\r\n        this.enabled = false;\r\n        this.mask = 0xff;\r\n\r\n        this.func = StencilState.ALWAYS;\r\n        this.funcRef = 1;\r\n        this.funcMask = 0xff;\r\n\r\n        this.opStencilFail = StencilState.KEEP;\r\n        this.opDepthFail = StencilState.KEEP;\r\n        this.opStencilDepthPass = StencilState.REPLACE;\r\n    }\r\n\r\n    public func: number;\r\n    public get stencilFunc(): number {\r\n        return this.func;\r\n    }\r\n\r\n    public set stencilFunc(value: number) {\r\n        this.func = value;\r\n    }\r\n\r\n    public funcRef: number;\r\n    public get stencilFuncRef(): number {\r\n        return this.funcRef;\r\n    }\r\n\r\n    public set stencilFuncRef(value: number) {\r\n        this.funcRef = value;\r\n    }\r\n\r\n    public funcMask: number;\r\n    public get stencilFuncMask(): number {\r\n        return this.funcMask;\r\n    }\r\n\r\n    public set stencilFuncMask(value: number) {\r\n        this.funcMask = value;\r\n    }\r\n\r\n    public opStencilFail: number;\r\n    public get stencilOpStencilFail(): number {\r\n        return this.opStencilFail;\r\n    }\r\n\r\n    public set stencilOpStencilFail(value: number) {\r\n        this.opStencilFail = value;\r\n    }\r\n\r\n    public opDepthFail: number;\r\n    public get stencilOpDepthFail(): number {\r\n        return this.opDepthFail;\r\n    }\r\n\r\n    public set stencilOpDepthFail(value: number) {\r\n        this.opDepthFail = value;\r\n    }\r\n\r\n    public opStencilDepthPass: number;\r\n    public get stencilOpStencilDepthPass(): number {\r\n        return this.opStencilDepthPass;\r\n    }\r\n\r\n    public set stencilOpStencilDepthPass(value: number) {\r\n        this.opStencilDepthPass = value;\r\n    }\r\n\r\n    public mask: number;\r\n    public get stencilMask(): number {\r\n        return this.mask;\r\n    }\r\n\r\n    public set stencilMask(value: number) {\r\n        this.mask = value;\r\n    }\r\n\r\n    public enabled: boolean;\r\n    public get stencilTest(): boolean {\r\n        return this.enabled;\r\n    }\r\n\r\n    public set stencilTest(value: boolean) {\r\n        this.enabled = value;\r\n    }\r\n}\r\n", "import type { Nullable } from \"../types\";\r\n\r\n/**\r\n * @internal\r\n **/\r\nexport class AlphaState {\r\n    public _blendFunctionParameters = new Array<Nullable<number>>(4);\r\n    public _blendEquationParameters = new Array<Nullable<number>>(2);\r\n    public _blendConstants = new Array<Nullable<number>>(4);\r\n    public _isBlendConstantsDirty = false;\r\n\r\n    private _alphaBlend = false;\r\n    private _isAlphaBlendDirty = false;\r\n    private _isBlendFunctionParametersDirty = false;\r\n    private _isBlendEquationParametersDirty = false;\r\n\r\n    /**\r\n     * Initializes the state.\r\n     */\r\n    public constructor() {\r\n        this.reset();\r\n    }\r\n\r\n    public get isDirty(): boolean {\r\n        return this._isAlphaBlendDirty || this._isBlendFunctionParametersDirty || this._isBlendEquationParametersDirty;\r\n    }\r\n\r\n    public get alphaBlend(): boolean {\r\n        return this._alphaBlend;\r\n    }\r\n\r\n    public set alphaBlend(value: boolean) {\r\n        if (this._alphaBlend === value) {\r\n            return;\r\n        }\r\n\r\n        this._alphaBlend = value;\r\n        this._isAlphaBlendDirty = true;\r\n    }\r\n\r\n    public setAlphaBlendConstants(r: number, g: number, b: number, a: number): void {\r\n        if (this._blendConstants[0] === r && this._blendConstants[1] === g && this._blendConstants[2] === b && this._blendConstants[3] === a) {\r\n            return;\r\n        }\r\n\r\n        this._blendConstants[0] = r;\r\n        this._blendConstants[1] = g;\r\n        this._blendConstants[2] = b;\r\n        this._blendConstants[3] = a;\r\n\r\n        this._isBlendConstantsDirty = true;\r\n    }\r\n\r\n    public setAlphaBlendFunctionParameters(value0: number, value1: number, value2: number, value3: number): void {\r\n        if (\r\n            this._blendFunctionParameters[0] === value0 &&\r\n            this._blendFunctionParameters[1] === value1 &&\r\n            this._blendFunctionParameters[2] === value2 &&\r\n            this._blendFunctionParameters[3] === value3\r\n        ) {\r\n            return;\r\n        }\r\n\r\n        this._blendFunctionParameters[0] = value0;\r\n        this._blendFunctionParameters[1] = value1;\r\n        this._blendFunctionParameters[2] = value2;\r\n        this._blendFunctionParameters[3] = value3;\r\n\r\n        this._isBlendFunctionParametersDirty = true;\r\n    }\r\n\r\n    public setAlphaEquationParameters(rgb: number, alpha: number): void {\r\n        if (this._blendEquationParameters[0] === rgb && this._blendEquationParameters[1] === alpha) {\r\n            return;\r\n        }\r\n\r\n        this._blendEquationParameters[0] = rgb;\r\n        this._blendEquationParameters[1] = alpha;\r\n\r\n        this._isBlendEquationParametersDirty = true;\r\n    }\r\n\r\n    public reset() {\r\n        this._alphaBlend = false;\r\n        this._blendFunctionParameters[0] = null;\r\n        this._blendFunctionParameters[1] = null;\r\n        this._blendFunctionParameters[2] = null;\r\n        this._blendFunctionParameters[3] = null;\r\n\r\n        this._blendEquationParameters[0] = null;\r\n        this._blendEquationParameters[1] = null;\r\n\r\n        this._blendConstants[0] = null;\r\n        this._blendConstants[1] = null;\r\n        this._blendConstants[2] = null;\r\n        this._blendConstants[3] = null;\r\n\r\n        this._isAlphaBlendDirty = true;\r\n        this._isBlendFunctionParametersDirty = false;\r\n        this._isBlendEquationParametersDirty = false;\r\n        this._isBlendConstantsDirty = false;\r\n    }\r\n\r\n    public apply(gl: WebGLRenderingContext) {\r\n        if (!this.isDirty) {\r\n            return;\r\n        }\r\n\r\n        // Alpha blend\r\n        if (this._isAlphaBlendDirty) {\r\n            if (this._alphaBlend) {\r\n                gl.enable(gl.BLEND);\r\n            } else {\r\n                gl.disable(gl.BLEND);\r\n            }\r\n\r\n            this._isAlphaBlendDirty = false;\r\n        }\r\n\r\n        // Alpha function\r\n        if (this._isBlendFunctionParametersDirty) {\r\n            gl.blendFuncSeparate(\r\n                <number>this._blendFunctionParameters[0],\r\n                <number>this._blendFunctionParameters[1],\r\n                <number>this._blendFunctionParameters[2],\r\n                <number>this._blendFunctionParameters[3]\r\n            );\r\n            this._isBlendFunctionParametersDirty = false;\r\n        }\r\n\r\n        // Alpha equation\r\n        if (this._isBlendEquationParametersDirty) {\r\n            gl.blendEquationSeparate(this._blendEquationParameters[0]!, this._blendEquationParameters[1]!);\r\n            this._isBlendEquationParametersDirty = false;\r\n        }\r\n\r\n        // Constants\r\n        if (this._isBlendConstantsDirty) {\r\n            gl.blendColor(<number>this._blendConstants[0], <number>this._blendConstants[1], <number>this._blendConstants[2], <number>this._blendConstants[3]);\r\n            this._isBlendConstantsDirty = false;\r\n        }\r\n    }\r\n}\r\n", "import { Constants } from \"../../Engines/constants\";\r\nimport type { Nullable } from \"../../types\";\r\n\r\n/**\r\n * Class used to store a texture sampler data\r\n */\r\nexport class TextureSampler {\r\n    /**\r\n     * Gets the sampling mode of the texture\r\n     */\r\n    public samplingMode: number = -1;\r\n\r\n    /**\r\n     * | Value | Type               | Description |\r\n     * | ----- | ------------------ | ----------- |\r\n     * | 0     | CLAMP_ADDRESSMODE  |             |\r\n     * | 1     | WRAP_ADDRESSMODE   |             |\r\n     * | 2     | MIRROR_ADDRESSMODE |             |\r\n     */\r\n    public get wrapU() {\r\n        return this._cachedWrapU;\r\n    }\r\n\r\n    public set wrapU(value: Nullable<number>) {\r\n        this._cachedWrapU = value;\r\n    }\r\n\r\n    /**\r\n     * | Value | Type               | Description |\r\n     * | ----- | ------------------ | ----------- |\r\n     * | 0     | CLAMP_ADDRESSMODE  |             |\r\n     * | 1     | WRAP_ADDRESSMODE   |             |\r\n     * | 2     | MIRROR_ADDRESSMODE |             |\r\n     */\r\n    public get wrapV() {\r\n        return this._cachedWrapV;\r\n    }\r\n\r\n    public set wrapV(value: Nullable<number>) {\r\n        this._cachedWrapV = value;\r\n    }\r\n\r\n    /**\r\n     * | Value | Type               | Description |\r\n     * | ----- | ------------------ | ----------- |\r\n     * | 0     | CLAMP_ADDRESSMODE  |             |\r\n     * | 1     | WRAP_ADDRESSMODE   |             |\r\n     * | 2     | MIRROR_ADDRESSMODE |             |\r\n     */\r\n    public get wrapR() {\r\n        return this._cachedWrapR;\r\n    }\r\n\r\n    public set wrapR(value: Nullable<number>) {\r\n        this._cachedWrapR = value;\r\n    }\r\n\r\n    /**\r\n     * With compliant hardware and browser (supporting anisotropic filtering)\r\n     * this defines the level of anisotropic filtering in the texture.\r\n     * The higher the better but the slower.\r\n     */\r\n    public get anisotropicFilteringLevel() {\r\n        return this._cachedAnisotropicFilteringLevel;\r\n    }\r\n\r\n    public set anisotropicFilteringLevel(value: Nullable<number>) {\r\n        this._cachedAnisotropicFilteringLevel = value;\r\n    }\r\n\r\n    /**\r\n     * Gets or sets the comparison function (Constants.LESS, Constants.EQUAL, etc). Set 0 to not use a comparison function\r\n     */\r\n    public get comparisonFunction() {\r\n        return this._comparisonFunction;\r\n    }\r\n\r\n    public set comparisonFunction(value: number) {\r\n        this._comparisonFunction = value;\r\n    }\r\n\r\n    private _useMipMaps = true;\r\n    /**\r\n     * Indicates to use the mip maps (if available on the texture).\r\n     * Thanks to this flag, you can instruct the sampler to not sample the mipmaps even if they exist (and if the sampling mode is set to a value that normally samples the mipmaps!)\r\n     */\r\n    public get useMipMaps() {\r\n        return this._useMipMaps;\r\n    }\r\n\r\n    public set useMipMaps(value: boolean) {\r\n        this._useMipMaps = value;\r\n    }\r\n\r\n    /** @internal */\r\n    public _cachedWrapU: Nullable<number> = null;\r\n\r\n    /** @internal */\r\n    public _cachedWrapV: Nullable<number> = null;\r\n\r\n    /** @internal */\r\n    public _cachedWrapR: Nullable<number> = null;\r\n\r\n    /** @internal */\r\n    public _cachedAnisotropicFilteringLevel: Nullable<number> = null;\r\n\r\n    /** @internal */\r\n    public _comparisonFunction: number = 0;\r\n\r\n    /**\r\n     * Used for debugging purpose only\r\n     */\r\n    public label?: string;\r\n\r\n    /**\r\n     * Creates a Sampler instance\r\n     */\r\n    constructor() {}\r\n\r\n    /**\r\n     * Sets all the parameters of the sampler\r\n     * @param wrapU u address mode (default: TEXTURE_WRAP_ADDRESSMODE)\r\n     * @param wrapV v address mode (default: TEXTURE_WRAP_ADDRESSMODE)\r\n     * @param wrapR r address mode (default: TEXTURE_WRAP_ADDRESSMODE)\r\n     * @param anisotropicFilteringLevel anisotropic level (default: 1)\r\n     * @param samplingMode sampling mode (default: Constants.TEXTURE_BILINEAR_SAMPLINGMODE)\r\n     * @param comparisonFunction comparison function (default: 0 - no comparison function)\r\n     * @returns the current sampler instance\r\n     */\r\n    public setParameters(\r\n        wrapU = Constants.TEXTURE_WRAP_ADDRESSMODE,\r\n        wrapV = Constants.TEXTURE_WRAP_ADDRESSMODE,\r\n        wrapR = Constants.TEXTURE_WRAP_ADDRESSMODE,\r\n        anisotropicFilteringLevel = 1,\r\n        samplingMode = Constants.TEXTURE_BILINEAR_SAMPLINGMODE,\r\n        comparisonFunction = 0\r\n    ): TextureSampler {\r\n        this._cachedWrapU = wrapU;\r\n        this._cachedWrapV = wrapV;\r\n        this._cachedWrapR = wrapR;\r\n        this._cachedAnisotropicFilteringLevel = anisotropicFilteringLevel;\r\n        this.samplingMode = samplingMode;\r\n        this._comparisonFunction = comparisonFunction;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Compares this sampler with another one\r\n     * @param other sampler to compare with\r\n     * @returns true if the samplers have the same parametres, else false\r\n     */\r\n    public compareSampler(other: TextureSampler): boolean {\r\n        return (\r\n            this._cachedWrapU === other._cachedWrapU &&\r\n            this._cachedWrapV === other._cachedWrapV &&\r\n            this._cachedWrapR === other._cachedWrapR &&\r\n            this._cachedAnisotropicFilteringLevel === other._cachedAnisotropicFilteringLevel &&\r\n            this.samplingMode === other.samplingMode &&\r\n            this._comparisonFunction === other._comparisonFunction &&\r\n            this._useMipMaps === other._useMipMaps\r\n        );\r\n    }\r\n}\r\n", "import { Observable } from \"../../Misc/observable\";\r\nimport type { ImageSource, Nullable, int } from \"../../types\";\r\nimport type { ICanvas, ICanvasRenderingContext } from \"../../Engines/ICanvas\";\r\nimport type { HardwareTextureWrapper } from \"./hardwareTextureWrapper\";\r\nimport { TextureSampler } from \"./textureSampler\";\r\n\r\nimport type { ThinEngine } from \"../../Engines/thinEngine\";\r\nimport type { BaseTexture } from \"../../Materials/Textures/baseTexture\";\r\nimport type { SphericalPolynomial } from \"../../Maths/sphericalPolynomial\";\r\n\r\n/**\r\n * Defines the source of the internal texture\r\n */\r\nexport enum InternalTextureSource {\r\n    /**\r\n     * The source of the texture data is unknown\r\n     */\r\n    Unknown,\r\n    /**\r\n     * Texture data comes from an URL\r\n     */\r\n    Url,\r\n    /**\r\n     * Texture data is only used for temporary storage\r\n     */\r\n    Temp,\r\n    /**\r\n     * Texture data comes from raw data (ArrayBuffer)\r\n     */\r\n    Raw,\r\n    /**\r\n     * Texture content is dynamic (video or dynamic texture)\r\n     */\r\n    Dynamic,\r\n    /**\r\n     * Texture content is generated by rendering to it\r\n     */\r\n    RenderTarget,\r\n    /**\r\n     * Texture content is part of a multi render target process\r\n     */\r\n    MultiRenderTarget,\r\n    /**\r\n     * Texture data comes from a cube data file\r\n     */\r\n    Cube,\r\n    /**\r\n     * Texture data comes from a raw cube data\r\n     */\r\n    CubeRaw,\r\n    /**\r\n     * Texture data come from a prefiltered cube data file\r\n     */\r\n    CubePrefiltered,\r\n    /**\r\n     * Texture content is raw 3D data\r\n     */\r\n    Raw3D,\r\n    /**\r\n     * Texture content is raw 2D array data\r\n     */\r\n    Raw2DArray,\r\n    /**\r\n     * Texture content is a depth/stencil texture\r\n     */\r\n    DepthStencil,\r\n    /**\r\n     * Texture data comes from a raw cube data encoded with RGBD\r\n     */\r\n    CubeRawRGBD,\r\n    /**\r\n     * Texture content is a depth texture\r\n     */\r\n    Depth,\r\n}\r\n\r\n/**\r\n * Class used to store data associated with WebGL texture data for the engine\r\n * This class should not be used directly\r\n */\r\nexport class InternalTexture extends TextureSampler {\r\n    /**\r\n     * Defines if the texture is ready\r\n     */\r\n    public isReady: boolean = false;\r\n    /**\r\n     * Defines if the texture is a cube texture\r\n     */\r\n    public isCube: boolean = false;\r\n    /**\r\n     * Defines if the texture contains 3D data\r\n     */\r\n    public is3D: boolean = false;\r\n    /**\r\n     * Defines if the texture contains 2D array data\r\n     */\r\n    public is2DArray: boolean = false;\r\n    /**\r\n     * Defines if the texture contains multiview data\r\n     */\r\n    public isMultiview: boolean = false;\r\n    /**\r\n     * Gets the URL used to load this texture\r\n     */\r\n    public url: string = \"\";\r\n    /** @internal */\r\n    public _originalUrl: string; // not empty only if different from url\r\n    /**\r\n     * Gets a boolean indicating if the texture needs mipmaps generation\r\n     */\r\n    public generateMipMaps: boolean = false;\r\n    /**\r\n     * Gets a boolean indicating if the texture uses mipmaps\r\n     * TODO implements useMipMaps as a separate setting from generateMipMaps\r\n     */\r\n    public get useMipMaps() {\r\n        return this.generateMipMaps;\r\n    }\r\n    public set useMipMaps(value: boolean) {\r\n        this.generateMipMaps = value;\r\n    }\r\n    /**\r\n     * Gets the number of samples used by the texture (WebGL2+ only)\r\n     */\r\n    public samples: number = 0;\r\n    /**\r\n     * Gets the type of the texture (int, float...)\r\n     */\r\n    public type: number = -1;\r\n    /**\r\n     * Gets the format of the texture (RGB, RGBA...)\r\n     */\r\n    public format: number = -1;\r\n    /**\r\n     * Observable called when the texture is loaded\r\n     */\r\n    public onLoadedObservable = new Observable<InternalTexture>();\r\n    /**\r\n     * Observable called when the texture load is raising an error\r\n     */\r\n    public onErrorObservable = new Observable<Partial<{ message: string; exception: any }>>();\r\n    /**\r\n     * If this callback is defined it will be called instead of the default _rebuild function\r\n     */\r\n    public onRebuildCallback: Nullable<\r\n        (internalTexture: InternalTexture) => {\r\n            proxy: Nullable<InternalTexture | Promise<InternalTexture>>;\r\n            isReady: boolean;\r\n            isAsync: boolean;\r\n        }\r\n    > = null;\r\n    /**\r\n     * Gets the width of the texture\r\n     */\r\n    public width: number = 0;\r\n    /**\r\n     * Gets the height of the texture\r\n     */\r\n    public height: number = 0;\r\n    /**\r\n     * Gets the depth of the texture\r\n     */\r\n    public depth: number = 0;\r\n    /**\r\n     * Gets the initial width of the texture (It could be rescaled if the current system does not support non power of two textures)\r\n     */\r\n    public baseWidth: number = 0;\r\n    /**\r\n     * Gets the initial height of the texture (It could be rescaled if the current system does not support non power of two textures)\r\n     */\r\n    public baseHeight: number = 0;\r\n    /**\r\n     * Gets the initial depth of the texture (It could be rescaled if the current system does not support non power of two textures)\r\n     */\r\n    public baseDepth: number = 0;\r\n    /**\r\n     * Gets a boolean indicating if the texture is inverted on Y axis\r\n     */\r\n    public invertY: boolean = false;\r\n\r\n    // Private\r\n    /** @internal */\r\n    public _invertVScale = false;\r\n    /** @internal */\r\n    public _associatedChannel = -1;\r\n    /** @internal */\r\n    public _source = InternalTextureSource.Unknown;\r\n    /** @internal */\r\n    public _buffer: Nullable<string | ArrayBuffer | ArrayBufferView | HTMLImageElement | Blob | ImageBitmap> = null;\r\n    /** @internal */\r\n    public _bufferView: Nullable<ArrayBufferView> = null;\r\n    /** @internal */\r\n    public _bufferViewArray: Nullable<ArrayBufferView[]> = null;\r\n    /** @internal */\r\n    public _bufferViewArrayArray: Nullable<ArrayBufferView[][]> = null;\r\n    /** @internal */\r\n    public _size: number = 0;\r\n    /** @internal */\r\n    public _extension: string = \"\";\r\n    /** @internal */\r\n    public _files: Nullable<string[]> = null;\r\n    /** @internal */\r\n    public _workingCanvas: Nullable<ICanvas> = null;\r\n    /** @internal */\r\n    public _workingContext: Nullable<ICanvasRenderingContext> = null;\r\n    /** @internal */\r\n    public _cachedCoordinatesMode: Nullable<number> = null;\r\n    /** @internal */\r\n    public _isDisabled: boolean = false;\r\n    /** @internal */\r\n    public _compression: Nullable<string> = null;\r\n    /** @internal */\r\n    public _sphericalPolynomial: Nullable<SphericalPolynomial> = null;\r\n    /** @internal */\r\n    public _sphericalPolynomialPromise: Nullable<Promise<SphericalPolynomial>> = null;\r\n    /** @internal */\r\n    public _sphericalPolynomialComputed = false;\r\n    /** @internal */\r\n    public _lodGenerationScale: number = 0;\r\n    /** @internal */\r\n    public _lodGenerationOffset: number = 0;\r\n    /** @internal */\r\n    public _useSRGBBuffer: boolean = false;\r\n    /** @internal */\r\n    public _creationFlags: number = 0;\r\n    /** @internal */\r\n    public _originalFormat?: number;\r\n\r\n    // The following three fields helps sharing generated fixed LODs for texture filtering\r\n    // In environment not supporting the textureLOD extension like EDGE. They are for internal use only.\r\n    // They are at the level of the gl texture to benefit from the cache.\r\n    /** @internal */\r\n    public _lodTextureHigh: Nullable<BaseTexture> = null;\r\n    /** @internal */\r\n    public _lodTextureMid: Nullable<BaseTexture> = null;\r\n    /** @internal */\r\n    public _lodTextureLow: Nullable<BaseTexture> = null;\r\n    /** @internal */\r\n    public _isRGBD: boolean = false;\r\n\r\n    /** @internal */\r\n    public _linearSpecularLOD: boolean = false;\r\n    /** @internal */\r\n    public _irradianceTexture: Nullable<BaseTexture> = null;\r\n\r\n    /** @internal */\r\n    public _hardwareTexture: Nullable<HardwareTextureWrapper> = null;\r\n\r\n    /** @internal */\r\n    public _maxLodLevel: Nullable<number> = null;\r\n\r\n    /** @internal */\r\n    public _references: number = 1;\r\n\r\n    /** @internal */\r\n    public _gammaSpace: Nullable<boolean> = null;\r\n\r\n    /** @internal */\r\n    public _premulAlpha = false;\r\n\r\n    /** @internal */\r\n    public _dynamicTextureSource: Nullable<ImageSource> = null;\r\n\r\n    private _engine: ThinEngine;\r\n    private _uniqueId: number;\r\n\r\n    /** @internal */\r\n    public static _Counter = 0;\r\n\r\n    /** Gets the unique id of the internal texture */\r\n    public get uniqueId() {\r\n        return this._uniqueId;\r\n    }\r\n\r\n    /** @internal */\r\n    public _setUniqueId(id: number) {\r\n        this._uniqueId = id;\r\n    }\r\n\r\n    /**\r\n     * Gets the Engine the texture belongs to.\r\n     * @returns The babylon engine\r\n     */\r\n    public getEngine(): ThinEngine {\r\n        return this._engine;\r\n    }\r\n\r\n    /**\r\n     * Gets the data source type of the texture\r\n     */\r\n    public get source(): InternalTextureSource {\r\n        return this._source;\r\n    }\r\n\r\n    /**\r\n     * Creates a new InternalTexture\r\n     * @param engine defines the engine to use\r\n     * @param source defines the type of data that will be used\r\n     * @param delayAllocation if the texture allocation should be delayed (default: false)\r\n     */\r\n    constructor(engine: ThinEngine, source: InternalTextureSource, delayAllocation = false) {\r\n        super();\r\n\r\n        this._engine = engine;\r\n        this._source = source;\r\n        this._uniqueId = InternalTexture._Counter++;\r\n\r\n        if (!delayAllocation) {\r\n            this._hardwareTexture = engine._createHardwareTexture();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Increments the number of references (ie. the number of Texture that point to it)\r\n     */\r\n    public incrementReferences(): void {\r\n        this._references++;\r\n    }\r\n\r\n    /**\r\n     * Change the size of the texture (not the size of the content)\r\n     * @param width defines the new width\r\n     * @param height defines the new height\r\n     * @param depth defines the new depth (1 by default)\r\n     */\r\n    public updateSize(width: int, height: int, depth: int = 1): void {\r\n        this._engine.updateTextureDimensions(this, width, height, depth);\r\n\r\n        this.width = width;\r\n        this.height = height;\r\n        this.depth = depth;\r\n\r\n        this.baseWidth = width;\r\n        this.baseHeight = height;\r\n        this.baseDepth = depth;\r\n\r\n        this._size = width * height * depth;\r\n    }\r\n\r\n    /** @internal */\r\n    public _rebuild(): void {\r\n        this.isReady = false;\r\n        this._cachedCoordinatesMode = null;\r\n        this._cachedWrapU = null;\r\n        this._cachedWrapV = null;\r\n        this._cachedWrapR = null;\r\n        this._cachedAnisotropicFilteringLevel = null;\r\n        if (this.onRebuildCallback) {\r\n            const data = this.onRebuildCallback(this);\r\n            const swapAndSetIsReady = (proxyInternalTexture: InternalTexture) => {\r\n                proxyInternalTexture._swapAndDie(this, false);\r\n                this.isReady = data.isReady;\r\n            };\r\n            if (data.isAsync) {\r\n                (data.proxy as Promise<InternalTexture>).then(swapAndSetIsReady);\r\n            } else {\r\n                swapAndSetIsReady(data.proxy as InternalTexture);\r\n            }\r\n            return;\r\n        }\r\n\r\n        let proxy: InternalTexture;\r\n        switch (this.source) {\r\n            case InternalTextureSource.Temp:\r\n                break;\r\n\r\n            case InternalTextureSource.Url:\r\n                proxy = this._engine.createTexture(\r\n                    this._originalUrl ?? this.url,\r\n                    !this.generateMipMaps,\r\n                    this.invertY,\r\n                    null,\r\n                    this.samplingMode,\r\n                    // Do not use Proxy here as it could be fully synchronous\r\n                    // and proxy would be undefined.\r\n                    (temp) => {\r\n                        temp._swapAndDie(this, false);\r\n                        this.isReady = true;\r\n                    },\r\n                    null,\r\n                    this._buffer,\r\n                    undefined,\r\n                    this.format,\r\n                    this._extension,\r\n                    undefined,\r\n                    undefined,\r\n                    undefined,\r\n                    this._useSRGBBuffer\r\n                );\r\n                return;\r\n\r\n            case InternalTextureSource.Raw:\r\n                proxy = this._engine.createRawTexture(\r\n                    this._bufferView,\r\n                    this.baseWidth,\r\n                    this.baseHeight,\r\n                    this.format,\r\n                    this.generateMipMaps,\r\n                    this.invertY,\r\n                    this.samplingMode,\r\n                    this._compression,\r\n                    this.type,\r\n                    this._creationFlags,\r\n                    this._useSRGBBuffer\r\n                );\r\n                proxy._swapAndDie(this, false);\r\n\r\n                this.isReady = true;\r\n                break;\r\n\r\n            case InternalTextureSource.Raw3D:\r\n                proxy = this._engine.createRawTexture3D(\r\n                    this._bufferView,\r\n                    this.baseWidth,\r\n                    this.baseHeight,\r\n                    this.baseDepth,\r\n                    this.format,\r\n                    this.generateMipMaps,\r\n                    this.invertY,\r\n                    this.samplingMode,\r\n                    this._compression,\r\n                    this.type\r\n                );\r\n                proxy._swapAndDie(this, false);\r\n\r\n                this.isReady = true;\r\n                break;\r\n\r\n            case InternalTextureSource.Raw2DArray:\r\n                proxy = this._engine.createRawTexture2DArray(\r\n                    this._bufferView,\r\n                    this.baseWidth,\r\n                    this.baseHeight,\r\n                    this.baseDepth,\r\n                    this.format,\r\n                    this.generateMipMaps,\r\n                    this.invertY,\r\n                    this.samplingMode,\r\n                    this._compression,\r\n                    this.type\r\n                );\r\n                proxy._swapAndDie(this, false);\r\n\r\n                this.isReady = true;\r\n                break;\r\n\r\n            case InternalTextureSource.Dynamic:\r\n                proxy = this._engine.createDynamicTexture(this.baseWidth, this.baseHeight, this.generateMipMaps, this.samplingMode);\r\n                proxy._swapAndDie(this, false);\r\n                if (this._dynamicTextureSource) {\r\n                    this._engine.updateDynamicTexture(this, this._dynamicTextureSource, this.invertY, this._premulAlpha, this.format, true);\r\n                }\r\n\r\n                // The engine will make sure to update content so no need to flag it as isReady = true\r\n                break;\r\n\r\n            case InternalTextureSource.Cube:\r\n                proxy = this._engine.createCubeTexture(\r\n                    this.url,\r\n                    null,\r\n                    this._files,\r\n                    !this.generateMipMaps,\r\n                    () => {\r\n                        proxy._swapAndDie(this, false);\r\n                        this.isReady = true;\r\n                    },\r\n                    null,\r\n                    this.format,\r\n                    this._extension,\r\n                    false,\r\n                    0,\r\n                    0,\r\n                    null,\r\n                    undefined,\r\n                    this._useSRGBBuffer\r\n                );\r\n                return;\r\n\r\n            case InternalTextureSource.CubeRaw:\r\n                proxy = this._engine.createRawCubeTexture(\r\n                    this._bufferViewArray!,\r\n                    this.width,\r\n                    this._originalFormat ?? this.format,\r\n                    this.type,\r\n                    this.generateMipMaps,\r\n                    this.invertY,\r\n                    this.samplingMode,\r\n                    this._compression\r\n                );\r\n                proxy._swapAndDie(this, false);\r\n                this.isReady = true;\r\n                break;\r\n\r\n            case InternalTextureSource.CubeRawRGBD:\r\n                // This case is being handeled by the environment texture tools and is not a part of the rebuild process.\r\n                // To use CubeRawRGBD use updateRGBDAsync on the cube texture.\r\n                return;\r\n\r\n            case InternalTextureSource.CubePrefiltered:\r\n                proxy = this._engine.createPrefilteredCubeTexture(\r\n                    this.url,\r\n                    null,\r\n                    this._lodGenerationScale,\r\n                    this._lodGenerationOffset,\r\n                    (proxy) => {\r\n                        if (proxy) {\r\n                            proxy._swapAndDie(this, false);\r\n                        }\r\n                        this.isReady = true;\r\n                    },\r\n                    null,\r\n                    this.format,\r\n                    this._extension\r\n                );\r\n                proxy._sphericalPolynomial = this._sphericalPolynomial;\r\n                return;\r\n\r\n            case InternalTextureSource.DepthStencil:\r\n            case InternalTextureSource.Depth: {\r\n                // Will be handled at the RenderTargetWrapper level\r\n                break;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _swapAndDie(target: InternalTexture, swapAll = true): void {\r\n        // TODO what about refcount on target?\r\n\r\n        this._hardwareTexture?.setUsage(target._source, this.generateMipMaps, this.is2DArray, this.isCube, this.is3D, this.width, this.height, this.depth);\r\n\r\n        target._hardwareTexture = this._hardwareTexture;\r\n        if (swapAll) {\r\n            target._isRGBD = this._isRGBD;\r\n        }\r\n\r\n        if (this._lodTextureHigh) {\r\n            if (target._lodTextureHigh) {\r\n                target._lodTextureHigh.dispose();\r\n            }\r\n            target._lodTextureHigh = this._lodTextureHigh;\r\n        }\r\n\r\n        if (this._lodTextureMid) {\r\n            if (target._lodTextureMid) {\r\n                target._lodTextureMid.dispose();\r\n            }\r\n            target._lodTextureMid = this._lodTextureMid;\r\n        }\r\n\r\n        if (this._lodTextureLow) {\r\n            if (target._lodTextureLow) {\r\n                target._lodTextureLow.dispose();\r\n            }\r\n            target._lodTextureLow = this._lodTextureLow;\r\n        }\r\n\r\n        if (this._irradianceTexture) {\r\n            if (target._irradianceTexture) {\r\n                target._irradianceTexture.dispose();\r\n            }\r\n            target._irradianceTexture = this._irradianceTexture;\r\n        }\r\n\r\n        const cache = this._engine.getLoadedTexturesCache();\r\n        let index = cache.indexOf(this);\r\n        if (index !== -1) {\r\n            cache.splice(index, 1);\r\n        }\r\n\r\n        index = cache.indexOf(target);\r\n        if (index === -1) {\r\n            cache.push(target);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Dispose the current allocated resources\r\n     */\r\n    public dispose(): void {\r\n        this._references--;\r\n        this.onLoadedObservable.clear();\r\n        this.onErrorObservable.clear();\r\n        if (this._references === 0) {\r\n            this._engine._releaseTexture(this);\r\n            this._hardwareTexture = null;\r\n            this._dynamicTextureSource = null;\r\n        }\r\n    }\r\n}\r\n", "import { ShaderLanguage } from \"../../Materials/shaderLanguage\";\r\nimport type { IShaderProcessor } from \"../Processors/iShaderProcessor\";\r\n\r\nconst varyingRegex = /(flat\\s)?\\s*varying\\s*.*/;\r\n\r\n/** @internal */\r\nexport class WebGL2ShaderProcessor implements IShaderProcessor {\r\n    public shaderLanguage = ShaderLanguage.GLSL;\r\n\r\n    public attributeProcessor(attribute: string) {\r\n        return attribute.replace(\"attribute\", \"in\");\r\n    }\r\n\r\n    public varyingCheck(varying: string, _isFragment: boolean) {\r\n        return varyingRegex.test(varying);\r\n    }\r\n\r\n    public varyingProcessor(varying: string, isFragment: boolean) {\r\n        return varying.replace(\"varying\", isFragment ? \"in\" : \"out\");\r\n    }\r\n\r\n    public postProcessor(code: string, defines: string[], isFragment: boolean) {\r\n        const hasDrawBuffersExtension = code.search(/#extension.+GL_EXT_draw_buffers.+require/) !== -1;\r\n\r\n        // Remove extensions\r\n        const regex = /#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g;\r\n        code = code.replace(regex, \"\");\r\n\r\n        // Replace instructions\r\n        code = code.replace(/texture2D\\s*\\(/g, \"texture(\");\r\n        if (isFragment) {\r\n            const hasOutput = code.search(/layout *\\(location *= *0\\) *out/g) !== -1;\r\n\r\n            code = code.replace(/texture2DLodEXT\\s*\\(/g, \"textureLod(\");\r\n            code = code.replace(/textureCubeLodEXT\\s*\\(/g, \"textureLod(\");\r\n            code = code.replace(/textureCube\\s*\\(/g, \"texture(\");\r\n            code = code.replace(/gl_FragDepthEXT/g, \"gl_FragDepth\");\r\n            code = code.replace(/gl_FragColor/g, \"glFragColor\");\r\n            code = code.replace(/gl_FragData/g, \"glFragData\");\r\n            code = code.replace(/void\\s+?main\\s*\\(/g, (hasDrawBuffersExtension || hasOutput ? \"\" : \"layout(location = 0) out vec4 glFragColor;\\n\") + \"void main(\");\r\n        } else {\r\n            const hasMultiviewExtension = defines.indexOf(\"#define MULTIVIEW\") !== -1;\r\n            if (hasMultiviewExtension) {\r\n                return \"#extension GL_OVR_multiview2 : require\\nlayout (num_views = 2) in;\\n\" + code;\r\n            }\r\n        }\r\n\r\n        return code;\r\n    }\r\n}\r\n", "/**\r\n * Class used to store gfx data (like WebGLBuffer)\r\n */\r\nexport class DataBuffer {\r\n    private static _Counter = 0;\r\n\r\n    /**\r\n     * Gets or sets the number of objects referencing this buffer\r\n     */\r\n    public references: number = 0;\r\n    /** Gets or sets the size of the underlying buffer */\r\n    public capacity: number = 0;\r\n    /**\r\n     * Gets or sets a boolean indicating if the buffer contains 32bits indices\r\n     */\r\n    public is32Bits: boolean = false;\r\n\r\n    /**\r\n     * Gets the underlying buffer\r\n     */\r\n    public get underlyingResource(): any {\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * Gets the unique id of this buffer\r\n     */\r\n    public readonly uniqueId: number;\r\n\r\n    /**\r\n     * Constructs the buffer\r\n     */\r\n    constructor() {\r\n        this.uniqueId = DataBuffer._Counter++;\r\n    }\r\n}\r\n", "import { DataBuffer } from \"../../Buffers/dataBuffer\";\r\nimport type { Nullable } from \"../../types\";\r\n\r\n/** @internal */\r\nexport class WebGLDataBuffer extends DataBuffer {\r\n    private _buffer: Nullable<WebGLBuffer>;\r\n\r\n    public constructor(resource: WebGLBuffer) {\r\n        super();\r\n        this._buffer = resource;\r\n    }\r\n\r\n    public get underlyingResource(): any {\r\n        return this._buffer;\r\n    }\r\n}\r\n", "import type { IPipelineContext } from \"../IPipelineContext\";\r\nimport type { Nullable } from \"../../types\";\r\nimport type { Effect } from \"../../Materials/effect\";\r\nimport type { IMatrixLike, IVector2Like, IVector3Like, IVector4Like, IColor3Like, IColor4Like, IQuaternionLike } from \"../../Maths/math.like\";\r\nimport type { ThinEngine } from \"../thinEngine\";\r\n\r\n/** @internal */\r\nexport class WebGLPipelineContext implements IPipelineContext {\r\n    private _valueCache: { [key: string]: any } = {};\r\n    private _uniforms: { [key: string]: Nullable<WebGLUniformLocation> };\r\n\r\n    public engine: ThinEngine;\r\n    public program: Nullable<WebGLProgram>;\r\n    public context?: WebGLRenderingContext;\r\n    public vertexShader?: WebGLShader;\r\n    public fragmentShader?: WebGLShader;\r\n    public isParallelCompiled: boolean;\r\n    public onCompiled?: () => void;\r\n    public transformFeedback?: WebGLTransformFeedback | null;\r\n\r\n    public vertexCompilationError: Nullable<string> = null;\r\n    public fragmentCompilationError: Nullable<string> = null;\r\n    public programLinkError: Nullable<string> = null;\r\n    public programValidationError: Nullable<string> = null;\r\n\r\n    /** @internal */\r\n    public _isDisposed = false;\r\n\r\n    public get isAsync() {\r\n        return this.isParallelCompiled;\r\n    }\r\n\r\n    public get isReady(): boolean {\r\n        if (this.program) {\r\n            if (this.isParallelCompiled) {\r\n                return this.engine._isRenderingStateCompiled(this);\r\n            }\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    public _handlesSpectorRebuildCallback(onCompiled: (program: WebGLProgram) => void): void {\r\n        if (onCompiled && this.program) {\r\n            onCompiled(this.program);\r\n        }\r\n    }\r\n\r\n    public _fillEffectInformation(\r\n        effect: Effect,\r\n        uniformBuffersNames: { [key: string]: number },\r\n        uniformsNames: string[],\r\n        uniforms: { [key: string]: Nullable<WebGLUniformLocation> },\r\n        samplerList: string[],\r\n        samplers: { [key: string]: number },\r\n        attributesNames: string[],\r\n        attributes: number[]\r\n    ) {\r\n        const engine = this.engine;\r\n        if (engine.supportsUniformBuffers) {\r\n            for (const name in uniformBuffersNames) {\r\n                effect.bindUniformBlock(name, uniformBuffersNames[name]);\r\n            }\r\n        }\r\n\r\n        const effectAvailableUniforms = this.engine.getUniforms(this, uniformsNames);\r\n        effectAvailableUniforms.forEach((uniform, index) => {\r\n            uniforms[uniformsNames[index]] = uniform;\r\n        });\r\n        this._uniforms = uniforms;\r\n\r\n        let index: number;\r\n        for (index = 0; index < samplerList.length; index++) {\r\n            const sampler = effect.getUniform(samplerList[index]);\r\n            if (sampler == null) {\r\n                samplerList.splice(index, 1);\r\n                index--;\r\n            }\r\n        }\r\n\r\n        samplerList.forEach((name, index) => {\r\n            samplers[name] = index;\r\n        });\r\n\r\n        for (const attr of engine.getAttributes(this, attributesNames)) {\r\n            attributes.push(attr);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Release all associated resources.\r\n     **/\r\n    public dispose() {\r\n        this._uniforms = {};\r\n        this._isDisposed = true;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _cacheMatrix(uniformName: string, matrix: IMatrixLike): boolean {\r\n        const cache = this._valueCache[uniformName];\r\n        const flag = matrix.updateFlag;\r\n        if (cache !== undefined && cache === flag) {\r\n            return false;\r\n        }\r\n\r\n        this._valueCache[uniformName] = flag;\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _cacheFloat2(uniformName: string, x: number, y: number): boolean {\r\n        let cache = this._valueCache[uniformName];\r\n        if (!cache || cache.length !== 2) {\r\n            cache = [x, y];\r\n            this._valueCache[uniformName] = cache;\r\n            return true;\r\n        }\r\n\r\n        let changed = false;\r\n        if (cache[0] !== x) {\r\n            cache[0] = x;\r\n            changed = true;\r\n        }\r\n        if (cache[1] !== y) {\r\n            cache[1] = y;\r\n            changed = true;\r\n        }\r\n\r\n        return changed;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _cacheFloat3(uniformName: string, x: number, y: number, z: number): boolean {\r\n        let cache = this._valueCache[uniformName];\r\n        if (!cache || cache.length !== 3) {\r\n            cache = [x, y, z];\r\n            this._valueCache[uniformName] = cache;\r\n            return true;\r\n        }\r\n\r\n        let changed = false;\r\n        if (cache[0] !== x) {\r\n            cache[0] = x;\r\n            changed = true;\r\n        }\r\n        if (cache[1] !== y) {\r\n            cache[1] = y;\r\n            changed = true;\r\n        }\r\n        if (cache[2] !== z) {\r\n            cache[2] = z;\r\n            changed = true;\r\n        }\r\n\r\n        return changed;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _cacheFloat4(uniformName: string, x: number, y: number, z: number, w: number): boolean {\r\n        let cache = this._valueCache[uniformName];\r\n        if (!cache || cache.length !== 4) {\r\n            cache = [x, y, z, w];\r\n            this._valueCache[uniformName] = cache;\r\n            return true;\r\n        }\r\n\r\n        let changed = false;\r\n        if (cache[0] !== x) {\r\n            cache[0] = x;\r\n            changed = true;\r\n        }\r\n        if (cache[1] !== y) {\r\n            cache[1] = y;\r\n            changed = true;\r\n        }\r\n        if (cache[2] !== z) {\r\n            cache[2] = z;\r\n            changed = true;\r\n        }\r\n        if (cache[3] !== w) {\r\n            cache[3] = w;\r\n            changed = true;\r\n        }\r\n\r\n        return changed;\r\n    }\r\n\r\n    /**\r\n     * Sets an integer value on a uniform variable.\r\n     * @param uniformName Name of the variable.\r\n     * @param value Value to be set.\r\n     */\r\n    public setInt(uniformName: string, value: number): void {\r\n        const cache = this._valueCache[uniformName];\r\n        if (cache !== undefined && cache === value) {\r\n            return;\r\n        }\r\n\r\n        if (this.engine.setInt(this._uniforms[uniformName], value)) {\r\n            this._valueCache[uniformName] = value;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets a int2 on a uniform variable.\r\n     * @param uniformName Name of the variable.\r\n     * @param x First int in int2.\r\n     * @param y Second int in int2.\r\n     */\r\n    public setInt2(uniformName: string, x: number, y: number): void {\r\n        if (this._cacheFloat2(uniformName, x, y)) {\r\n            if (!this.engine.setInt2(this._uniforms[uniformName], x, y)) {\r\n                this._valueCache[uniformName] = null;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets a int3 on a uniform variable.\r\n     * @param uniformName Name of the variable.\r\n     * @param x First int in int3.\r\n     * @param y Second int in int3.\r\n     * @param z Third int in int3.\r\n     */\r\n    public setInt3(uniformName: string, x: number, y: number, z: number): void {\r\n        if (this._cacheFloat3(uniformName, x, y, z)) {\r\n            if (!this.engine.setInt3(this._uniforms[uniformName], x, y, z)) {\r\n                this._valueCache[uniformName] = null;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets a int4 on a uniform variable.\r\n     * @param uniformName Name of the variable.\r\n     * @param x First int in int4.\r\n     * @param y Second int in int4.\r\n     * @param z Third int in int4.\r\n     * @param w Fourth int in int4.\r\n     */\r\n    public setInt4(uniformName: string, x: number, y: number, z: number, w: number): void {\r\n        if (this._cacheFloat4(uniformName, x, y, z, w)) {\r\n            if (!this.engine.setInt4(this._uniforms[uniformName], x, y, z, w)) {\r\n                this._valueCache[uniformName] = null;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets an int array on a uniform variable.\r\n     * @param uniformName Name of the variable.\r\n     * @param array array to be set.\r\n     */\r\n    public setIntArray(uniformName: string, array: Int32Array): void {\r\n        this._valueCache[uniformName] = null;\r\n        this.engine.setIntArray(this._uniforms[uniformName], array);\r\n    }\r\n\r\n    /**\r\n     * Sets an int array 2 on a uniform variable. (Array is specified as single array eg. [1,2,3,4] will result in [[1,2],[3,4]] in the shader)\r\n     * @param uniformName Name of the variable.\r\n     * @param array array to be set.\r\n     */\r\n    public setIntArray2(uniformName: string, array: Int32Array): void {\r\n        this._valueCache[uniformName] = null;\r\n        this.engine.setIntArray2(this._uniforms[uniformName], array);\r\n    }\r\n\r\n    /**\r\n     * Sets an int array 3 on a uniform variable. (Array is specified as single array eg. [1,2,3,4,5,6] will result in [[1,2,3],[4,5,6]] in the shader)\r\n     * @param uniformName Name of the variable.\r\n     * @param array array to be set.\r\n     */\r\n    public setIntArray3(uniformName: string, array: Int32Array): void {\r\n        this._valueCache[uniformName] = null;\r\n        this.engine.setIntArray3(this._uniforms[uniformName], array);\r\n    }\r\n\r\n    /**\r\n     * Sets an int array 4 on a uniform variable. (Array is specified as single array eg. [1,2,3,4,5,6,7,8] will result in [[1,2,3,4],[5,6,7,8]] in the shader)\r\n     * @param uniformName Name of the variable.\r\n     * @param array array to be set.\r\n     */\r\n    public setIntArray4(uniformName: string, array: Int32Array): void {\r\n        this._valueCache[uniformName] = null;\r\n        this.engine.setIntArray4(this._uniforms[uniformName], array);\r\n    }\r\n\r\n    /**\r\n     * Sets an unsigned integer value on a uniform variable.\r\n     * @param uniformName Name of the variable.\r\n     * @param value Value to be set.\r\n     */\r\n    public setUInt(uniformName: string, value: number): void {\r\n        const cache = this._valueCache[uniformName];\r\n        if (cache !== undefined && cache === value) {\r\n            return;\r\n        }\r\n\r\n        if (this.engine.setUInt(this._uniforms[uniformName], value)) {\r\n            this._valueCache[uniformName] = value;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets an unsigned int2 value on a uniform variable.\r\n     * @param uniformName Name of the variable.\r\n     * @param x First unsigned int in uint2.\r\n     * @param y Second unsigned int in uint2.\r\n     */\r\n    public setUInt2(uniformName: string, x: number, y: number): void {\r\n        if (this._cacheFloat2(uniformName, x, y)) {\r\n            if (!this.engine.setUInt2(this._uniforms[uniformName], x, y)) {\r\n                this._valueCache[uniformName] = null;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets an unsigned int3 value on a uniform variable.\r\n     * @param uniformName Name of the variable.\r\n     * @param x First unsigned int in uint3.\r\n     * @param y Second unsigned int in uint3.\r\n     * @param z Third unsigned int in uint3.\r\n     */\r\n    public setUInt3(uniformName: string, x: number, y: number, z: number): void {\r\n        if (this._cacheFloat3(uniformName, x, y, z)) {\r\n            if (!this.engine.setUInt3(this._uniforms[uniformName], x, y, z)) {\r\n                this._valueCache[uniformName] = null;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets an unsigned int4 value on a uniform variable.\r\n     * @param uniformName Name of the variable.\r\n     * @param x First unsigned int in uint4.\r\n     * @param y Second unsigned int in uint4.\r\n     * @param z Third unsigned int in uint4.\r\n     * @param w Fourth unsigned int in uint4.\r\n     */\r\n    public setUInt4(uniformName: string, x: number, y: number, z: number, w: number): void {\r\n        if (this._cacheFloat4(uniformName, x, y, z, w)) {\r\n            if (!this.engine.setUInt4(this._uniforms[uniformName], x, y, z, w)) {\r\n                this._valueCache[uniformName] = null;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets an unsigned int array on a uniform variable.\r\n     * @param uniformName Name of the variable.\r\n     * @param array array to be set.\r\n     */\r\n    public setUIntArray(uniformName: string, array: Uint32Array): void {\r\n        this._valueCache[uniformName] = null;\r\n        this.engine.setUIntArray(this._uniforms[uniformName], array);\r\n    }\r\n\r\n    /**\r\n     * Sets an unsigned int array 2 on a uniform variable. (Array is specified as single array eg. [1,2,3,4] will result in [[1,2],[3,4]] in the shader)\r\n     * @param uniformName Name of the variable.\r\n     * @param array array to be set.\r\n     */\r\n    public setUIntArray2(uniformName: string, array: Uint32Array): void {\r\n        this._valueCache[uniformName] = null;\r\n        this.engine.setUIntArray2(this._uniforms[uniformName], array);\r\n    }\r\n\r\n    /**\r\n     * Sets an unsigned int array 3 on a uniform variable. (Array is specified as single array eg. [1,2,3,4,5,6] will result in [[1,2,3],[4,5,6]] in the shader)\r\n     * @param uniformName Name of the variable.\r\n     * @param array array to be set.\r\n     */\r\n    public setUIntArray3(uniformName: string, array: Uint32Array): void {\r\n        this._valueCache[uniformName] = null;\r\n        this.engine.setUIntArray3(this._uniforms[uniformName], array);\r\n    }\r\n\r\n    /**\r\n     * Sets an unsigned int array 4 on a uniform variable. (Array is specified as single array eg. [1,2,3,4,5,6,7,8] will result in [[1,2,3,4],[5,6,7,8]] in the shader)\r\n     * @param uniformName Name of the variable.\r\n     * @param array array to be set.\r\n     */\r\n    public setUIntArray4(uniformName: string, array: Uint32Array): void {\r\n        this._valueCache[uniformName] = null;\r\n        this.engine.setUIntArray4(this._uniforms[uniformName], array);\r\n    }\r\n\r\n    /**\r\n     * Sets an array on a uniform variable.\r\n     * @param uniformName Name of the variable.\r\n     * @param array array to be set.\r\n     */\r\n    public setArray(uniformName: string, array: number[]): void {\r\n        this._valueCache[uniformName] = null;\r\n        this.engine.setArray(this._uniforms[uniformName], array);\r\n    }\r\n\r\n    /**\r\n     * Sets an array 2 on a uniform variable. (Array is specified as single array eg. [1,2,3,4] will result in [[1,2],[3,4]] in the shader)\r\n     * @param uniformName Name of the variable.\r\n     * @param array array to be set.\r\n     */\r\n    public setArray2(uniformName: string, array: number[]): void {\r\n        this._valueCache[uniformName] = null;\r\n        this.engine.setArray2(this._uniforms[uniformName], array);\r\n    }\r\n\r\n    /**\r\n     * Sets an array 3 on a uniform variable. (Array is specified as single array eg. [1,2,3,4,5,6] will result in [[1,2,3],[4,5,6]] in the shader)\r\n     * @param uniformName Name of the variable.\r\n     * @param array array to be set.\r\n     */\r\n    public setArray3(uniformName: string, array: number[]): void {\r\n        this._valueCache[uniformName] = null;\r\n        this.engine.setArray3(this._uniforms[uniformName], array);\r\n    }\r\n\r\n    /**\r\n     * Sets an array 4 on a uniform variable. (Array is specified as single array eg. [1,2,3,4,5,6,7,8] will result in [[1,2,3,4],[5,6,7,8]] in the shader)\r\n     * @param uniformName Name of the variable.\r\n     * @param array array to be set.\r\n     */\r\n    public setArray4(uniformName: string, array: number[]): void {\r\n        this._valueCache[uniformName] = null;\r\n        this.engine.setArray4(this._uniforms[uniformName], array);\r\n    }\r\n\r\n    /**\r\n     * Sets matrices on a uniform variable.\r\n     * @param uniformName Name of the variable.\r\n     * @param matrices matrices to be set.\r\n     */\r\n    public setMatrices(uniformName: string, matrices: Float32Array): void {\r\n        if (!matrices) {\r\n            return;\r\n        }\r\n\r\n        this._valueCache[uniformName] = null;\r\n        this.engine.setMatrices(this._uniforms[uniformName], matrices);\r\n    }\r\n\r\n    /**\r\n     * Sets matrix on a uniform variable.\r\n     * @param uniformName Name of the variable.\r\n     * @param matrix matrix to be set.\r\n     */\r\n    public setMatrix(uniformName: string, matrix: IMatrixLike): void {\r\n        if (this._cacheMatrix(uniformName, matrix)) {\r\n            if (!this.engine.setMatrices(this._uniforms[uniformName], matrix.asArray())) {\r\n                this._valueCache[uniformName] = null;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets a 3x3 matrix on a uniform variable. (Specified as [1,2,3,4,5,6,7,8,9] will result in [1,2,3][4,5,6][7,8,9] matrix)\r\n     * @param uniformName Name of the variable.\r\n     * @param matrix matrix to be set.\r\n     */\r\n    public setMatrix3x3(uniformName: string, matrix: Float32Array): void {\r\n        this._valueCache[uniformName] = null;\r\n        this.engine.setMatrix3x3(this._uniforms[uniformName], matrix);\r\n    }\r\n\r\n    /**\r\n     * Sets a 2x2 matrix on a uniform variable. (Specified as [1,2,3,4] will result in [1,2][3,4] matrix)\r\n     * @param uniformName Name of the variable.\r\n     * @param matrix matrix to be set.\r\n     */\r\n    public setMatrix2x2(uniformName: string, matrix: Float32Array): void {\r\n        this._valueCache[uniformName] = null;\r\n        this.engine.setMatrix2x2(this._uniforms[uniformName], matrix);\r\n    }\r\n\r\n    /**\r\n     * Sets a float on a uniform variable.\r\n     * @param uniformName Name of the variable.\r\n     * @param value value to be set.\r\n     */\r\n    public setFloat(uniformName: string, value: number): void {\r\n        const cache = this._valueCache[uniformName];\r\n        if (cache !== undefined && cache === value) {\r\n            return;\r\n        }\r\n\r\n        if (this.engine.setFloat(this._uniforms[uniformName], value)) {\r\n            this._valueCache[uniformName] = value;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets a Vector2 on a uniform variable.\r\n     * @param uniformName Name of the variable.\r\n     * @param vector2 vector2 to be set.\r\n     */\r\n    public setVector2(uniformName: string, vector2: IVector2Like): void {\r\n        if (this._cacheFloat2(uniformName, vector2.x, vector2.y)) {\r\n            if (!this.engine.setFloat2(this._uniforms[uniformName], vector2.x, vector2.y)) {\r\n                this._valueCache[uniformName] = null;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets a float2 on a uniform variable.\r\n     * @param uniformName Name of the variable.\r\n     * @param x First float in float2.\r\n     * @param y Second float in float2.\r\n     */\r\n    public setFloat2(uniformName: string, x: number, y: number): void {\r\n        if (this._cacheFloat2(uniformName, x, y)) {\r\n            if (!this.engine.setFloat2(this._uniforms[uniformName], x, y)) {\r\n                this._valueCache[uniformName] = null;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets a Vector3 on a uniform variable.\r\n     * @param uniformName Name of the variable.\r\n     * @param vector3 Value to be set.\r\n     */\r\n    public setVector3(uniformName: string, vector3: IVector3Like): void {\r\n        if (this._cacheFloat3(uniformName, vector3.x, vector3.y, vector3.z)) {\r\n            if (!this.engine.setFloat3(this._uniforms[uniformName], vector3.x, vector3.y, vector3.z)) {\r\n                this._valueCache[uniformName] = null;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets a float3 on a uniform variable.\r\n     * @param uniformName Name of the variable.\r\n     * @param x First float in float3.\r\n     * @param y Second float in float3.\r\n     * @param z Third float in float3.\r\n     */\r\n    public setFloat3(uniformName: string, x: number, y: number, z: number): void {\r\n        if (this._cacheFloat3(uniformName, x, y, z)) {\r\n            if (!this.engine.setFloat3(this._uniforms[uniformName], x, y, z)) {\r\n                this._valueCache[uniformName] = null;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets a Vector4 on a uniform variable.\r\n     * @param uniformName Name of the variable.\r\n     * @param vector4 Value to be set.\r\n     */\r\n    public setVector4(uniformName: string, vector4: IVector4Like): void {\r\n        if (this._cacheFloat4(uniformName, vector4.x, vector4.y, vector4.z, vector4.w)) {\r\n            if (!this.engine.setFloat4(this._uniforms[uniformName], vector4.x, vector4.y, vector4.z, vector4.w)) {\r\n                this._valueCache[uniformName] = null;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets a Quaternion on a uniform variable.\r\n     * @param uniformName Name of the variable.\r\n     * @param quaternion Value to be set.\r\n     */\r\n    public setQuaternion(uniformName: string, quaternion: IQuaternionLike): void {\r\n        if (this._cacheFloat4(uniformName, quaternion.x, quaternion.y, quaternion.z, quaternion.w)) {\r\n            if (!this.engine.setFloat4(this._uniforms[uniformName], quaternion.x, quaternion.y, quaternion.z, quaternion.w)) {\r\n                this._valueCache[uniformName] = null;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets a float4 on a uniform variable.\r\n     * @param uniformName Name of the variable.\r\n     * @param x First float in float4.\r\n     * @param y Second float in float4.\r\n     * @param z Third float in float4.\r\n     * @param w Fourth float in float4.\r\n     */\r\n    public setFloat4(uniformName: string, x: number, y: number, z: number, w: number): void {\r\n        if (this._cacheFloat4(uniformName, x, y, z, w)) {\r\n            if (!this.engine.setFloat4(this._uniforms[uniformName], x, y, z, w)) {\r\n                this._valueCache[uniformName] = null;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets a Color3 on a uniform variable.\r\n     * @param uniformName Name of the variable.\r\n     * @param color3 Value to be set.\r\n     */\r\n    public setColor3(uniformName: string, color3: IColor3Like): void {\r\n        if (this._cacheFloat3(uniformName, color3.r, color3.g, color3.b)) {\r\n            if (!this.engine.setFloat3(this._uniforms[uniformName], color3.r, color3.g, color3.b)) {\r\n                this._valueCache[uniformName] = null;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets a Color4 on a uniform variable.\r\n     * @param uniformName Name of the variable.\r\n     * @param color3 Value to be set.\r\n     * @param alpha Alpha value to be set.\r\n     */\r\n    public setColor4(uniformName: string, color3: IColor3Like, alpha: number): void {\r\n        if (this._cacheFloat4(uniformName, color3.r, color3.g, color3.b, alpha)) {\r\n            if (!this.engine.setFloat4(this._uniforms[uniformName], color3.r, color3.g, color3.b, alpha)) {\r\n                this._valueCache[uniformName] = null;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets a Color4 on a uniform variable\r\n     * @param uniformName defines the name of the variable\r\n     * @param color4 defines the value to be set\r\n     */\r\n    public setDirectColor4(uniformName: string, color4: IColor4Like): void {\r\n        if (this._cacheFloat4(uniformName, color4.r, color4.g, color4.b, color4.a)) {\r\n            if (!this.engine.setFloat4(this._uniforms[uniformName], color4.r, color4.g, color4.b, color4.a)) {\r\n                this._valueCache[uniformName] = null;\r\n            }\r\n        }\r\n    }\r\n\r\n    public _getVertexShaderCode(): string | null {\r\n        return this.vertexShader ? this.engine._getShaderSource(this.vertexShader) : null;\r\n    }\r\n\r\n    public _getFragmentShaderCode(): string | null {\r\n        return this.fragmentShader ? this.engine._getShaderSource(this.fragmentShader) : null;\r\n    }\r\n}\r\n", "import type { HardwareTextureWrapper } from \"../../Materials/Textures/hardwareTextureWrapper\";\r\nimport type { Nullable } from \"../../types\";\r\n\r\n/** @internal */\r\nexport class WebGLHardwareTexture implements HardwareTextureWrapper {\r\n    private _webGLTexture: WebGLTexture;\r\n    private _context: WebGLRenderingContext;\r\n\r\n    // There can be multiple buffers for a single WebGL texture because different layers of a 2DArrayTexture / 3DTexture\r\n    // or different faces of a cube texture can be bound to different render targets at the same time.\r\n    // eslint-disable-next-line @typescript-eslint/naming-convention\r\n    private _MSAARenderBuffers: Nullable<WebGLRenderbuffer[]> = null;\r\n\r\n    public get underlyingResource(): Nullable<WebGLTexture> {\r\n        return this._webGLTexture;\r\n    }\r\n\r\n    constructor(existingTexture: Nullable<WebGLTexture> = null, context: WebGLRenderingContext) {\r\n        this._context = context as WebGLRenderingContext;\r\n        if (!existingTexture) {\r\n            existingTexture = context.createTexture();\r\n            if (!existingTexture) {\r\n                throw new Error(\"Unable to create webGL texture\");\r\n            }\r\n        }\r\n        this.set(existingTexture);\r\n    }\r\n\r\n    public setUsage(): void {}\r\n\r\n    public set(hardwareTexture: WebGLTexture) {\r\n        this._webGLTexture = hardwareTexture;\r\n    }\r\n\r\n    public reset() {\r\n        this._webGLTexture = null as any;\r\n        this._MSAARenderBuffers = null;\r\n    }\r\n\r\n    public addMSAARenderBuffer(buffer: WebGLRenderbuffer) {\r\n        if (!this._MSAARenderBuffers) {\r\n            this._MSAARenderBuffers = [];\r\n        }\r\n        this._MSAARenderBuffers.push(buffer);\r\n    }\r\n\r\n    public releaseMSAARenderBuffers() {\r\n        if (this._MSAARenderBuffers) {\r\n            for (const buffer of this._MSAARenderBuffers) {\r\n                this._context.deleteRenderbuffer(buffer);\r\n            }\r\n            this._MSAARenderBuffers = null;\r\n        }\r\n    }\r\n\r\n    public getMSAARenderBuffer(index = 0) {\r\n        return this._MSAARenderBuffers?.[index] ?? null;\r\n    }\r\n\r\n    public release() {\r\n        this.releaseMSAARenderBuffers();\r\n\r\n        if (this._webGLTexture) {\r\n            this._context.deleteTexture(this._webGLTexture);\r\n        }\r\n        this.reset();\r\n    }\r\n}\r\n", "import type { IDrawContext } from \"../Engines/IDrawContext\";\r\nimport type { IMaterialContext } from \"../Engines/IMaterialContext\";\r\nimport type { Nullable } from \"../types\";\r\n\r\nimport type { ThinEngine } from \"../Engines/thinEngine\";\r\nimport type { Effect } from \"./effect\";\r\nimport type { MaterialDefines } from \"./materialDefines\";\r\n\r\n/** @internal */\r\nexport class DrawWrapper {\r\n    public effect: Nullable<Effect>;\r\n    public defines: Nullable<string | MaterialDefines>;\r\n    public materialContext?: IMaterialContext;\r\n    public drawContext?: IDrawContext;\r\n\r\n    /**\r\n     * @internal\r\n     * Specifies if the effect was previously ready\r\n     */\r\n    public _wasPreviouslyReady = false;\r\n\r\n    /**\r\n     * @internal\r\n     * Forces the code from bindForSubMesh to be fully run the next time it is called\r\n     */\r\n    public _forceRebindOnNextCall = true;\r\n\r\n    /**\r\n     * @internal\r\n     * Specifies if the effect was previously using instances\r\n     */\r\n    public _wasPreviouslyUsingInstances: Nullable<boolean> = null;\r\n\r\n    public static IsWrapper(effect: Effect | DrawWrapper): effect is DrawWrapper {\r\n        return (effect as Effect).getPipelineContext === undefined;\r\n    }\r\n\r\n    public static GetEffect(effect: Effect | DrawWrapper): Nullable<Effect> {\r\n        return (effect as Effect).getPipelineContext === undefined ? (effect as DrawWrapper).effect : (effect as Effect);\r\n    }\r\n\r\n    constructor(engine: ThinEngine, createMaterialContext = true) {\r\n        this.effect = null;\r\n        this.defines = null;\r\n        this.drawContext = engine.createDrawContext();\r\n        if (createMaterialContext) {\r\n            this.materialContext = engine.createMaterialContext();\r\n        }\r\n    }\r\n\r\n    public setEffect(effect: Nullable<Effect>, defines?: Nullable<string | MaterialDefines>, resetContext = true): void {\r\n        this.effect = effect;\r\n        if (defines !== undefined) {\r\n            this.defines = defines;\r\n        }\r\n        if (resetContext) {\r\n            this.drawContext?.reset();\r\n        }\r\n    }\r\n\r\n    public dispose(): void {\r\n        this.drawContext?.dispose();\r\n    }\r\n}\r\n", "import type { IStencilState } from \"./IStencilState\";\r\n\r\n/**\r\n * @internal\r\n **/\r\nexport class StencilStateComposer {\r\n    protected _isStencilTestDirty = false;\r\n    protected _isStencilMaskDirty = false;\r\n    protected _isStencilFuncDirty = false;\r\n    protected _isStencilOpDirty = false;\r\n\r\n    protected _enabled: boolean;\r\n\r\n    protected _mask: number;\r\n\r\n    protected _func: number;\r\n    protected _funcRef: number;\r\n    protected _funcMask: number;\r\n\r\n    protected _opStencilFail: number;\r\n    protected _opDepthFail: number;\r\n    protected _opStencilDepthPass: number;\r\n\r\n    public stencilGlobal: IStencilState;\r\n    public stencilMaterial: IStencilState | undefined;\r\n\r\n    public useStencilGlobalOnly = false;\r\n\r\n    public get isDirty(): boolean {\r\n        return this._isStencilTestDirty || this._isStencilMaskDirty || this._isStencilFuncDirty || this._isStencilOpDirty;\r\n    }\r\n\r\n    public get func(): number {\r\n        return this._func;\r\n    }\r\n\r\n    public set func(value: number) {\r\n        if (this._func === value) {\r\n            return;\r\n        }\r\n\r\n        this._func = value;\r\n        this._isStencilFuncDirty = true;\r\n    }\r\n\r\n    public get funcRef(): number {\r\n        return this._funcRef;\r\n    }\r\n\r\n    public set funcRef(value: number) {\r\n        if (this._funcRef === value) {\r\n            return;\r\n        }\r\n\r\n        this._funcRef = value;\r\n        this._isStencilFuncDirty = true;\r\n    }\r\n\r\n    public get funcMask(): number {\r\n        return this._funcMask;\r\n    }\r\n\r\n    public set funcMask(value: number) {\r\n        if (this._funcMask === value) {\r\n            return;\r\n        }\r\n\r\n        this._funcMask = value;\r\n        this._isStencilFuncDirty = true;\r\n    }\r\n\r\n    public get opStencilFail(): number {\r\n        return this._opStencilFail;\r\n    }\r\n\r\n    public set opStencilFail(value: number) {\r\n        if (this._opStencilFail === value) {\r\n            return;\r\n        }\r\n\r\n        this._opStencilFail = value;\r\n        this._isStencilOpDirty = true;\r\n    }\r\n\r\n    public get opDepthFail(): number {\r\n        return this._opDepthFail;\r\n    }\r\n\r\n    public set opDepthFail(value: number) {\r\n        if (this._opDepthFail === value) {\r\n            return;\r\n        }\r\n\r\n        this._opDepthFail = value;\r\n        this._isStencilOpDirty = true;\r\n    }\r\n\r\n    public get opStencilDepthPass(): number {\r\n        return this._opStencilDepthPass;\r\n    }\r\n\r\n    public set opStencilDepthPass(value: number) {\r\n        if (this._opStencilDepthPass === value) {\r\n            return;\r\n        }\r\n\r\n        this._opStencilDepthPass = value;\r\n        this._isStencilOpDirty = true;\r\n    }\r\n\r\n    public get mask(): number {\r\n        return this._mask;\r\n    }\r\n\r\n    public set mask(value: number) {\r\n        if (this._mask === value) {\r\n            return;\r\n        }\r\n\r\n        this._mask = value;\r\n        this._isStencilMaskDirty = true;\r\n    }\r\n\r\n    public get enabled(): boolean {\r\n        return this._enabled;\r\n    }\r\n\r\n    public set enabled(value: boolean) {\r\n        if (this._enabled === value) {\r\n            return;\r\n        }\r\n\r\n        this._enabled = value;\r\n        this._isStencilTestDirty = true;\r\n    }\r\n\r\n    public constructor(reset = true) {\r\n        if (reset) {\r\n            this.reset();\r\n        }\r\n    }\r\n\r\n    public reset() {\r\n        this.stencilMaterial = undefined;\r\n\r\n        this.stencilGlobal?.reset();\r\n\r\n        this._isStencilTestDirty = true;\r\n        this._isStencilMaskDirty = true;\r\n        this._isStencilFuncDirty = true;\r\n        this._isStencilOpDirty = true;\r\n    }\r\n\r\n    public apply(gl?: WebGLRenderingContext) {\r\n        if (!gl) {\r\n            return;\r\n        }\r\n\r\n        const stencilMaterialEnabled = !this.useStencilGlobalOnly && !!this.stencilMaterial?.enabled;\r\n\r\n        this.enabled = stencilMaterialEnabled ? this.stencilMaterial!.enabled : this.stencilGlobal.enabled;\r\n        this.func = stencilMaterialEnabled ? this.stencilMaterial!.func : this.stencilGlobal.func;\r\n        this.funcRef = stencilMaterialEnabled ? this.stencilMaterial!.funcRef : this.stencilGlobal.funcRef;\r\n        this.funcMask = stencilMaterialEnabled ? this.stencilMaterial!.funcMask : this.stencilGlobal.funcMask;\r\n        this.opStencilFail = stencilMaterialEnabled ? this.stencilMaterial!.opStencilFail : this.stencilGlobal.opStencilFail;\r\n        this.opDepthFail = stencilMaterialEnabled ? this.stencilMaterial!.opDepthFail : this.stencilGlobal.opDepthFail;\r\n        this.opStencilDepthPass = stencilMaterialEnabled ? this.stencilMaterial!.opStencilDepthPass : this.stencilGlobal.opStencilDepthPass;\r\n        this.mask = stencilMaterialEnabled ? this.stencilMaterial!.mask : this.stencilGlobal.mask;\r\n\r\n        if (!this.isDirty) {\r\n            return;\r\n        }\r\n\r\n        // Stencil test\r\n        if (this._isStencilTestDirty) {\r\n            if (this.enabled) {\r\n                gl.enable(gl.STENCIL_TEST);\r\n            } else {\r\n                gl.disable(gl.STENCIL_TEST);\r\n            }\r\n            this._isStencilTestDirty = false;\r\n        }\r\n\r\n        // Stencil mask\r\n        if (this._isStencilMaskDirty) {\r\n            gl.stencilMask(this.mask);\r\n            this._isStencilMaskDirty = false;\r\n        }\r\n\r\n        // Stencil func\r\n        if (this._isStencilFuncDirty) {\r\n            gl.stencilFunc(this.func, this.funcRef, this.funcMask);\r\n            this._isStencilFuncDirty = false;\r\n        }\r\n\r\n        // Stencil op\r\n        if (this._isStencilOpDirty) {\r\n            gl.stencilOp(this.opStencilFail, this.opDepthFail, this.opStencilDepthPass);\r\n            this._isStencilOpDirty = false;\r\n        }\r\n    }\r\n}\r\n", "import { ShaderLanguage } from \"../../Materials/shaderLanguage\";\r\nimport type { Nullable } from \"../../types\";\r\nimport type { IShaderProcessor } from \"../Processors/iShaderProcessor\";\r\nimport type { ShaderProcessingContext } from \"../Processors/shaderProcessingOptions\";\r\n\r\nimport type { ThinEngine } from \"../thinEngine\";\r\n\r\n/** @internal */\r\nexport class WebGLShaderProcessor implements IShaderProcessor {\r\n    public shaderLanguage = ShaderLanguage.GLSL;\r\n\r\n    public postProcessor(code: string, defines: string[], isFragment: boolean, processingContext: Nullable<ShaderProcessingContext>, engine: ThinEngine) {\r\n        // Remove extensions\r\n        if (!engine.getCaps().drawBuffersExtension) {\r\n            // even if enclosed in #if/#endif, IE11 does parse the #extension declaration, so we need to remove it altogether\r\n            const regex = /#extension.+GL_EXT_draw_buffers.+(enable|require)/g;\r\n            code = code.replace(regex, \"\");\r\n        }\r\n\r\n        return code;\r\n    }\r\n}\r\n", "/* eslint-disable @typescript-eslint/no-unused-vars */\r\nimport { EngineStore } from \"./engineStore\";\r\nimport type { IInternalTextureLoader } from \"../Materials/Textures/internalTextureLoader\";\r\nimport type { IEffectCreationOptions } from \"../Materials/effect\";\r\nimport { Effect } from \"../Materials/effect\";\r\nimport { _WarnImport } from \"../Misc/devTools\";\r\nimport type { IShaderProcessor } from \"./Processors/iShaderProcessor\";\r\nimport type { ShaderProcessingContext } from \"./Processors/shaderProcessingOptions\";\r\nimport type { UniformBuffer } from \"../Materials/uniformBuffer\";\r\nimport type { Nullable, DataArray, IndicesArray, FloatArray, DeepImmutable } from \"../types\";\r\nimport type { EngineCapabilities } from \"./engineCapabilities\";\r\nimport type { Observer } from \"../Misc/observable\";\r\nimport { Observable } from \"../Misc/observable\";\r\nimport { DepthCullingState } from \"../States/depthCullingState\";\r\nimport { StencilState } from \"../States/stencilState\";\r\nimport { AlphaState } from \"../States/alphaCullingState\";\r\nimport { Constants } from \"./constants\";\r\nimport { InternalTexture, InternalTextureSource } from \"../Materials/Textures/internalTexture\";\r\nimport type { IViewportLike, IColor4Like } from \"../Maths/math.like\";\r\nimport type { DataBuffer } from \"../Buffers/dataBuffer\";\r\nimport type { IFileRequest } from \"../Misc/fileRequest\";\r\nimport { Logger } from \"../Misc/logger\";\r\nimport { IsDocumentAvailable, IsWindowObjectExist } from \"../Misc/domManagement\";\r\nimport { WebGLShaderProcessor } from \"./WebGL/webGLShaderProcessors\";\r\nimport { WebGL2ShaderProcessor } from \"./WebGL/webGL2ShaderProcessors\";\r\nimport { WebGLDataBuffer } from \"../Meshes/WebGL/webGLDataBuffer\";\r\nimport type { IPipelineContext } from \"./IPipelineContext\";\r\nimport { WebGLPipelineContext } from \"./WebGL/webGLPipelineContext\";\r\nimport type { VertexBuffer } from \"../Buffers/buffer\";\r\nimport type { InstancingAttributeInfo } from \"./instancingAttributeInfo\";\r\nimport type { ThinTexture } from \"../Materials/Textures/thinTexture\";\r\nimport type { IOfflineProvider } from \"../Offline/IOfflineProvider\";\r\nimport type { IEffectFallbacks } from \"../Materials/iEffectFallbacks\";\r\nimport type { IWebRequest } from \"../Misc/interfaces/iWebRequest\";\r\nimport { PerformanceConfigurator } from \"./performanceConfigurator\";\r\nimport type { EngineFeatures } from \"./engineFeatures\";\r\nimport type { HardwareTextureWrapper } from \"../Materials/Textures/hardwareTextureWrapper\";\r\nimport { WebGLHardwareTexture } from \"./WebGL/webGLHardwareTexture\";\r\nimport { DrawWrapper } from \"../Materials/drawWrapper\";\r\nimport type { IMaterialContext } from \"./IMaterialContext\";\r\nimport type { IDrawContext } from \"./IDrawContext\";\r\nimport type { ICanvas, ICanvasRenderingContext, IImage } from \"./ICanvas\";\r\nimport { StencilStateComposer } from \"../States/stencilStateComposer\";\r\nimport type { StorageBuffer } from \"../Buffers/storageBuffer\";\r\nimport type { IAudioEngineOptions } from \"../Audio/Interfaces/IAudioEngineOptions\";\r\nimport type { IStencilState } from \"../States/IStencilState\";\r\nimport type { InternalTextureCreationOptions, TextureSize } from \"../Materials/Textures/textureCreationOptions\";\r\nimport { ShaderLanguage } from \"../Materials/shaderLanguage\";\r\nimport type { RenderTargetWrapper } from \"./renderTargetWrapper\";\r\nimport type { WebGLRenderTargetWrapper } from \"./WebGL/webGLRenderTargetWrapper\";\r\nimport type { VideoTexture } from \"../Materials/Textures/videoTexture\";\r\nimport type { RenderTargetTexture } from \"../Materials/Textures/renderTargetTexture\";\r\nimport type { WebRequest } from \"../Misc/webRequest\";\r\nimport type { LoadFileError } from \"../Misc/fileTools\";\r\nimport type { Texture } from \"../Materials/Textures/texture\";\r\nimport { PrecisionDate } from \"../Misc/precisionDate\";\r\n\r\n/**\r\n * Defines the interface used by objects working like Scene\r\n * @internal\r\n */\r\nexport interface ISceneLike {\r\n    addPendingData(data: any): void;\r\n    removePendingData(data: any): void;\r\n    offlineProvider: IOfflineProvider;\r\n}\r\n\r\n/**\r\n * Keeps track of all the buffer info used in engine.\r\n */\r\nclass BufferPointer {\r\n    public active: boolean;\r\n    public index: number;\r\n    public size: number;\r\n    public type: number;\r\n    public normalized: boolean;\r\n    public stride: number;\r\n    public offset: number;\r\n    public buffer: WebGLBuffer;\r\n}\r\n\r\n/**\r\n * Information about the current host\r\n */\r\nexport interface HostInformation {\r\n    /**\r\n     * Defines if the current host is a mobile\r\n     */\r\n    isMobile: boolean;\r\n}\r\n\r\n/** Interface defining initialization parameters for ThinEngine class */\r\nexport interface ThinEngineOptions {\r\n    /**\r\n     * Defines if the engine should no exceed a specified device ratio\r\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/Window/devicePixelRatio\r\n     */\r\n    limitDeviceRatio?: number;\r\n    /**\r\n     * Defines if webaudio should be initialized as well\r\n     * @see https://doc.babylonjs.com/features/featuresDeepDive/audio/playingSoundsMusic\r\n     */\r\n    audioEngine?: boolean;\r\n    /**\r\n     * Specifies options for the audio engine\r\n     */\r\n    audioEngineOptions?: IAudioEngineOptions;\r\n\r\n    /**\r\n     * Defines if animations should run using a deterministic lock step\r\n     * @see https://doc.babylonjs.com/features/featuresDeepDive/animation/advanced_animations#deterministic-lockstep\r\n     */\r\n    deterministicLockstep?: boolean;\r\n    /** Defines the maximum steps to use with deterministic lock step mode */\r\n    lockstepMaxSteps?: number;\r\n    /** Defines the seconds between each deterministic lock step */\r\n    timeStep?: number;\r\n    /**\r\n     * Defines that engine should ignore context lost events\r\n     * If this event happens when this parameter is true, you will have to reload the page to restore rendering\r\n     */\r\n    doNotHandleContextLost?: boolean;\r\n    /**\r\n     * Defines that engine should ignore modifying touch action attribute and style\r\n     * If not handle, you might need to set it up on your side for expected touch devices behavior.\r\n     */\r\n    doNotHandleTouchAction?: boolean;\r\n\r\n    /**\r\n     * Make the matrix computations to be performed in 64 bits instead of 32 bits. False by default\r\n     */\r\n    useHighPrecisionMatrix?: boolean;\r\n\r\n    /**\r\n     * Defines whether to adapt to the device's viewport characteristics (default: false)\r\n     */\r\n    adaptToDeviceRatio?: boolean;\r\n\r\n    /**\r\n     * True if the more expensive but exact conversions should be used for transforming colors to and from linear space within shaders.\r\n     * Otherwise, the default is to use a cheaper approximation.\r\n     */\r\n    useExactSrgbConversions?: boolean;\r\n\r\n    /**\r\n     * Defines whether MSAA is enabled on the canvas.\r\n     */\r\n    antialias?: boolean;\r\n\r\n    /**\r\n     * Defines whether the stencil buffer should be enabled.\r\n     */\r\n    stencil?: boolean;\r\n\r\n    /**\r\n     * Defines whether the canvas should be created in \"premultiplied\" mode (if false, the canvas is created in the \"opaque\" mode) (true by default)\r\n     */\r\n    premultipliedAlpha?: boolean;\r\n}\r\n\r\n/** Interface defining initialization parameters for Engine class */\r\nexport interface EngineOptions extends ThinEngineOptions, WebGLContextAttributes {\r\n    /**\r\n     * Defines if webgl2 should be turned off even if supported\r\n     * @see https://doc.babylonjs.com/setup/support/webGL2\r\n     */\r\n    disableWebGL2Support?: boolean;\r\n\r\n    /**\r\n     * Defines that engine should compile shaders with high precision floats (if supported). True by default\r\n     */\r\n    useHighPrecisionFloats?: boolean;\r\n    /**\r\n     * Make the canvas XR Compatible for XR sessions\r\n     */\r\n    xrCompatible?: boolean;\r\n\r\n    /**\r\n     * Will prevent the system from falling back to software implementation if a hardware device cannot be created\r\n     */\r\n    failIfMajorPerformanceCaveat?: boolean;\r\n\r\n    /**\r\n     * If sRGB Buffer support is not set during construction, use this value to force a specific state\r\n     * This is added due to an issue when processing textures in chrome/edge/firefox\r\n     * This will not influence NativeEngine and WebGPUEngine which set the behavior to true during construction.\r\n     */\r\n    forceSRGBBufferSupportState?: boolean;\r\n\r\n    /**\r\n     * Defines if the gl context should be released.\r\n     * It's false by default for backward compatibility, but you should probably pass true (see https://registry.khronos.org/webgl/extensions/WEBGL_lose_context/)\r\n     */\r\n    loseContextOnDispose?: boolean;\r\n}\r\n\r\n/**\r\n * The base engine class (root of all engines)\r\n */\r\nexport class ThinEngine {\r\n    private static _TempClearColorUint32 = new Uint32Array(4);\r\n    private static _TempClearColorInt32 = new Int32Array(4);\r\n\r\n    /** Use this array to turn off some WebGL2 features on known buggy browsers version */\r\n    public static ExceptionList = [\r\n        { key: \"Chrome/63.0\", capture: \"63\\\\.0\\\\.3239\\\\.(\\\\d+)\", captureConstraint: 108, targets: [\"uniformBuffer\"] },\r\n        { key: \"Firefox/58\", capture: null, captureConstraint: null, targets: [\"uniformBuffer\"] },\r\n        { key: \"Firefox/59\", capture: null, captureConstraint: null, targets: [\"uniformBuffer\"] },\r\n        { key: \"Chrome/72.+?Mobile\", capture: null, captureConstraint: null, targets: [\"vao\"] },\r\n        { key: \"Chrome/73.+?Mobile\", capture: null, captureConstraint: null, targets: [\"vao\"] },\r\n        { key: \"Chrome/74.+?Mobile\", capture: null, captureConstraint: null, targets: [\"vao\"] },\r\n        { key: \"Mac OS.+Chrome/71\", capture: null, captureConstraint: null, targets: [\"vao\"] },\r\n        { key: \"Mac OS.+Chrome/72\", capture: null, captureConstraint: null, targets: [\"vao\"] },\r\n        { key: \"Mac OS.+Chrome\", capture: null, captureConstraint: null, targets: [\"uniformBuffer\"] },\r\n        { key: \"Chrome/12\\\\d\\\\..+?Mobile\", capture: null, captureConstraint: null, targets: [\"uniformBuffer\"] },\r\n        // desktop osx safari 15.4\r\n        { key: \".*AppleWebKit.*(15.4).*Safari\", capture: null, captureConstraint: null, targets: [\"antialias\", \"maxMSAASamples\"] },\r\n        // mobile browsers using safari 15.4 on ios\r\n        { key: \".*(15.4).*AppleWebKit.*Safari\", capture: null, captureConstraint: null, targets: [\"antialias\", \"maxMSAASamples\"] },\r\n    ];\r\n\r\n    /** @internal */\r\n    public static _TextureLoaders: IInternalTextureLoader[] = [];\r\n\r\n    /**\r\n     * Returns the current npm package of the sdk\r\n     */\r\n    // Not mixed with Version for tooling purpose.\r\n    public static get NpmPackage(): string {\r\n        return \"babylonjs@6.49.0\";\r\n    }\r\n\r\n    /**\r\n     * Returns the current version of the framework\r\n     */\r\n    public static get Version(): string {\r\n        return \"6.49.0\";\r\n    }\r\n\r\n    /**\r\n     * Returns a string describing the current engine\r\n     */\r\n    public get description(): string {\r\n        let description = this.name + this.webGLVersion;\r\n\r\n        if (this._caps.parallelShaderCompile) {\r\n            description += \" - Parallel shader compilation\";\r\n        }\r\n\r\n        return description;\r\n    }\r\n\r\n    /** @internal */\r\n    protected _name = \"WebGL\";\r\n\r\n    /**\r\n     * Gets or sets the name of the engine\r\n     */\r\n    public get name(): string {\r\n        return this._name;\r\n    }\r\n\r\n    public set name(value: string) {\r\n        this._name = value;\r\n    }\r\n\r\n    /**\r\n     * Returns the version of the engine\r\n     */\r\n    public get version(): number {\r\n        return this._webGLVersion;\r\n    }\r\n\r\n    protected _isDisposed = false;\r\n\r\n    public get isDisposed(): boolean {\r\n        return this._isDisposed;\r\n    }\r\n\r\n    // Updatable statics so stick with vars here\r\n\r\n    /**\r\n     * Gets or sets the epsilon value used by collision engine\r\n     */\r\n    public static CollisionsEpsilon = 0.001;\r\n\r\n    /**\r\n     * Gets or sets the relative url used to load shaders if using the engine in non-minified mode\r\n     */\r\n    public static get ShadersRepository(): string {\r\n        return Effect.ShadersRepository;\r\n    }\r\n    public static set ShadersRepository(value: string) {\r\n        Effect.ShadersRepository = value;\r\n    }\r\n\r\n    protected _shaderProcessor: Nullable<IShaderProcessor>;\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _getShaderProcessor(shaderLanguage: ShaderLanguage): Nullable<IShaderProcessor> {\r\n        return this._shaderProcessor;\r\n    }\r\n\r\n    /**\r\n     * Gets or sets a boolean that indicates if textures must be forced to power of 2 size even if not required\r\n     */\r\n    public forcePOTTextures = false;\r\n\r\n    /**\r\n     * Gets a boolean indicating if the engine is currently rendering in fullscreen mode\r\n     */\r\n    public isFullscreen = false;\r\n\r\n    /**\r\n     * Gets or sets a boolean indicating if back faces must be culled. If false, front faces are culled instead (true by default)\r\n     * If non null, this takes precedence over the value from the material\r\n     */\r\n    public cullBackFaces: Nullable<boolean> = null;\r\n\r\n    /**\r\n     * Gets or sets a boolean indicating if the engine must keep rendering even if the window is not in foreground\r\n     */\r\n    public renderEvenInBackground = true;\r\n\r\n    /**\r\n     * Gets or sets a boolean indicating that cache can be kept between frames\r\n     */\r\n    public preventCacheWipeBetweenFrames = false;\r\n\r\n    /** Gets or sets a boolean indicating if the engine should validate programs after compilation */\r\n    public validateShaderPrograms = false;\r\n\r\n    private _useReverseDepthBuffer = false;\r\n    /**\r\n     * Gets or sets a boolean indicating if depth buffer should be reverse, going from far to near.\r\n     * This can provide greater z depth for distant objects.\r\n     */\r\n    public get useReverseDepthBuffer(): boolean {\r\n        return this._useReverseDepthBuffer;\r\n    }\r\n\r\n    public set useReverseDepthBuffer(useReverse) {\r\n        if (useReverse === this._useReverseDepthBuffer) {\r\n            return;\r\n        }\r\n\r\n        this._useReverseDepthBuffer = useReverse;\r\n\r\n        if (useReverse) {\r\n            this._depthCullingState.depthFunc = Constants.GEQUAL;\r\n        } else {\r\n            this._depthCullingState.depthFunc = Constants.LEQUAL;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Indicates if the z range in NDC space is 0..1 (value: true) or -1..1 (value: false)\r\n     */\r\n    public readonly isNDCHalfZRange: boolean = false;\r\n\r\n    /**\r\n     * Indicates that the origin of the texture/framebuffer space is the bottom left corner. If false, the origin is top left\r\n     */\r\n    public readonly hasOriginBottomLeft: boolean = true;\r\n\r\n    /**\r\n     * Gets or sets a boolean indicating that uniform buffers must be disabled even if they are supported\r\n     */\r\n    public disableUniformBuffers = false;\r\n\r\n    /**\r\n     * An event triggered when the engine is disposed.\r\n     */\r\n    public readonly onDisposeObservable = new Observable<ThinEngine>();\r\n\r\n    private _frameId = 0;\r\n    /**\r\n     * Gets the current frame id\r\n     */\r\n    public get frameId(): number {\r\n        return this._frameId;\r\n    }\r\n\r\n    /**\r\n     * The time (in milliseconds elapsed since the current page has been loaded) when the engine was initialized\r\n     */\r\n    public readonly startTime: number;\r\n\r\n    /** @internal */\r\n    public _uniformBuffers = new Array<UniformBuffer>();\r\n    /** @internal */\r\n    public _storageBuffers = new Array<StorageBuffer>();\r\n\r\n    /**\r\n     * Gets a boolean indicating that the engine supports uniform buffers\r\n     * @see https://doc.babylonjs.com/setup/support/webGL2#uniform-buffer-objets\r\n     */\r\n    public get supportsUniformBuffers(): boolean {\r\n        return this.webGLVersion > 1 && !this.disableUniformBuffers;\r\n    }\r\n\r\n    // Private Members\r\n\r\n    /** @internal */\r\n    public _gl: WebGL2RenderingContext;\r\n    /** @internal */\r\n    public _webGLVersion = 1.0;\r\n    protected _renderingCanvas: Nullable<HTMLCanvasElement>;\r\n    protected _windowIsBackground = false;\r\n    protected _creationOptions: EngineOptions;\r\n    protected _audioContext: Nullable<AudioContext>;\r\n    protected _audioDestination: Nullable<AudioDestinationNode | MediaStreamAudioDestinationNode>;\r\n    /** @internal */\r\n    public _glSRGBExtensionValues: {\r\n        SRGB: typeof WebGL2RenderingContext.SRGB;\r\n        SRGB8: typeof WebGL2RenderingContext.SRGB8 | EXT_sRGB[\"SRGB_ALPHA_EXT\"];\r\n        SRGB8_ALPHA8: typeof WebGL2RenderingContext.SRGB8_ALPHA8 | EXT_sRGB[\"SRGB_ALPHA_EXT\"];\r\n    };\r\n    /**\r\n     * Gets the options used for engine creation\r\n     * @returns EngineOptions object\r\n     */\r\n    public getCreationOptions() {\r\n        return this._creationOptions;\r\n    }\r\n\r\n    protected _highPrecisionShadersAllowed = true;\r\n    /** @internal */\r\n    public get _shouldUseHighPrecisionShader(): boolean {\r\n        return !!(this._caps.highPrecisionShaderSupported && this._highPrecisionShadersAllowed);\r\n    }\r\n\r\n    /**\r\n     * Gets a boolean indicating that only power of 2 textures are supported\r\n     * Please note that you can still use non power of 2 textures but in this case the engine will forcefully convert them\r\n     */\r\n    public get needPOTTextures(): boolean {\r\n        return this._webGLVersion < 2 || this.forcePOTTextures;\r\n    }\r\n\r\n    /** @internal */\r\n    public _badOS = false;\r\n\r\n    /** @internal */\r\n    public _badDesktopOS = false;\r\n\r\n    /** @internal */\r\n    public _hardwareScalingLevel: number;\r\n    /** @internal */\r\n    public _caps: EngineCapabilities;\r\n    /** @internal */\r\n    public _features: EngineFeatures;\r\n    protected _isStencilEnable: boolean;\r\n\r\n    private _glVersion: string;\r\n    private _glRenderer: string;\r\n    private _glVendor: string;\r\n\r\n    /** @internal */\r\n    public _videoTextureSupported: boolean;\r\n\r\n    protected _activeRenderLoops = new Array<() => void>();\r\n\r\n    /**\r\n     * Gets the list of current active render loop functions\r\n     * @returns a read only array with the current render loop functions\r\n     */\r\n    public get activeRenderLoops(): ReadonlyArray<() => void> {\r\n        return this._activeRenderLoops;\r\n    }\r\n\r\n    // Lost context\r\n    /**\r\n     * Observable signaled when a context lost event is raised\r\n     */\r\n    public onContextLostObservable = new Observable<ThinEngine>();\r\n    /**\r\n     * Observable signaled when a context restored event is raised\r\n     */\r\n    public onContextRestoredObservable = new Observable<ThinEngine>();\r\n    private _onContextLost: (evt: Event) => void;\r\n    private _onContextRestored: (evt: Event) => void;\r\n    protected _contextWasLost = false;\r\n\r\n    /** @internal */\r\n    public _doNotHandleContextLost = false;\r\n\r\n    /**\r\n     * Gets or sets a boolean indicating if resources should be retained to be able to handle context lost events\r\n     * @see https://doc.babylonjs.com/features/featuresDeepDive/scene/optimize_your_scene#handling-webgl-context-lost\r\n     */\r\n    public get doNotHandleContextLost(): boolean {\r\n        return this._doNotHandleContextLost;\r\n    }\r\n\r\n    public set doNotHandleContextLost(value: boolean) {\r\n        this._doNotHandleContextLost = value;\r\n    }\r\n\r\n    /**\r\n     * Gets or sets a boolean indicating that vertex array object must be disabled even if they are supported\r\n     */\r\n    public disableVertexArrayObjects = false;\r\n\r\n    // States\r\n    /** @internal */\r\n    protected _colorWrite = true;\r\n    /** @internal */\r\n    protected _colorWriteChanged = true;\r\n    /** @internal */\r\n    protected _depthCullingState = new DepthCullingState();\r\n    /** @internal */\r\n    protected _stencilStateComposer = new StencilStateComposer();\r\n    /** @internal */\r\n    protected _stencilState = new StencilState();\r\n    /** @internal */\r\n    public _alphaState = new AlphaState();\r\n    /** @internal */\r\n    public _alphaMode = Constants.ALPHA_ADD;\r\n    /** @internal */\r\n    public _alphaEquation = Constants.ALPHA_DISABLE;\r\n\r\n    // Cache\r\n    /** @internal */\r\n    public _internalTexturesCache = new Array<InternalTexture>();\r\n    /** @internal */\r\n    public _renderTargetWrapperCache = new Array<RenderTargetWrapper>();\r\n    /** @internal */\r\n    protected _activeChannel = 0;\r\n    private _currentTextureChannel = -1;\r\n    /** @internal */\r\n    protected _boundTexturesCache: { [key: string]: Nullable<InternalTexture> } = {};\r\n    protected _currentEffect: Nullable<Effect>;\r\n    /** @internal */\r\n    public _currentDrawContext: IDrawContext;\r\n    /** @internal */\r\n    public _currentMaterialContext: IMaterialContext;\r\n    /** @internal */\r\n    protected _currentProgram: Nullable<WebGLProgram>;\r\n    protected _compiledEffects: { [key: string]: Effect } = {};\r\n    private _vertexAttribArraysEnabled: boolean[] = [];\r\n    /** @internal */\r\n    protected _cachedViewport: Nullable<IViewportLike>;\r\n    private _cachedVertexArrayObject: Nullable<WebGLVertexArrayObject>;\r\n    /** @internal */\r\n    protected _cachedVertexBuffers: any;\r\n    /** @internal */\r\n    protected _cachedIndexBuffer: Nullable<DataBuffer>;\r\n    /** @internal */\r\n    protected _cachedEffectForVertexBuffers: Nullable<Effect>;\r\n\r\n    /** @internal */\r\n    public _currentRenderTarget: Nullable<RenderTargetWrapper> = null;\r\n    private _uintIndicesCurrentlySet = false;\r\n    protected _currentBoundBuffer = new Array<Nullable<DataBuffer>>();\r\n    /** @internal */\r\n    public _currentFramebuffer: Nullable<WebGLFramebuffer> = null;\r\n    /** @internal */\r\n    public _dummyFramebuffer: Nullable<WebGLFramebuffer> = null;\r\n    private _currentBufferPointers = new Array<BufferPointer>();\r\n    private _currentInstanceLocations = new Array<number>();\r\n    private _currentInstanceBuffers = new Array<DataBuffer>();\r\n    private _textureUnits: Int32Array;\r\n\r\n    /** @internal */\r\n    public _workingCanvas: Nullable<ICanvas>;\r\n    /** @internal */\r\n    public _workingContext: Nullable<ICanvasRenderingContext>;\r\n\r\n    /** @internal */\r\n    public _boundRenderFunction: any = () => this._renderLoop();\r\n\r\n    private _vaoRecordInProgress = false;\r\n    private _mustWipeVertexAttributes = false;\r\n\r\n    private _emptyTexture: Nullable<InternalTexture>;\r\n    private _emptyCubeTexture: Nullable<InternalTexture>;\r\n    private _emptyTexture3D: Nullable<InternalTexture>;\r\n    private _emptyTexture2DArray: Nullable<InternalTexture>;\r\n\r\n    /** @internal */\r\n    public _frameHandler: number = 0;\r\n\r\n    private _nextFreeTextureSlots = new Array<number>();\r\n    private _maxSimultaneousTextures = 0;\r\n    private _maxMSAASamplesOverride: Nullable<number> = null;\r\n\r\n    private _activeRequests = new Array<IFileRequest>();\r\n\r\n    /**\r\n     * If set to true zooming in and out in the browser will rescale the hardware-scaling correctly.\r\n     */\r\n    public adaptToDeviceRatio: boolean = false;\r\n    /** @internal */\r\n    protected _lastDevicePixelRatio: number = 1.0;\r\n\r\n    /** @internal */\r\n    public _transformTextureUrl: Nullable<(url: string) => string> = null;\r\n\r\n    /**\r\n     * Gets information about the current host\r\n     */\r\n    public hostInformation: HostInformation = {\r\n        isMobile: false,\r\n    };\r\n\r\n    protected get _supportsHardwareTextureRescaling() {\r\n        return false;\r\n    }\r\n\r\n    protected _framebufferDimensionsObject: Nullable<{ framebufferWidth: number; framebufferHeight: number }>;\r\n\r\n    /**\r\n     * sets the object from which width and height will be taken from when getting render width and height\r\n     * Will fallback to the gl object\r\n     * @param dimensions the framebuffer width and height that will be used.\r\n     */\r\n    public set framebufferDimensionsObject(dimensions: Nullable<{ framebufferWidth: number; framebufferHeight: number }>) {\r\n        this._framebufferDimensionsObject = dimensions;\r\n    }\r\n\r\n    /**\r\n     * Gets the current viewport\r\n     */\r\n    public get currentViewport(): Nullable<IViewportLike> {\r\n        return this._cachedViewport;\r\n    }\r\n\r\n    /**\r\n     * Gets the default empty texture\r\n     */\r\n    public get emptyTexture(): InternalTexture {\r\n        if (!this._emptyTexture) {\r\n            this._emptyTexture = this.createRawTexture(new Uint8Array(4), 1, 1, Constants.TEXTUREFORMAT_RGBA, false, false, Constants.TEXTURE_NEAREST_SAMPLINGMODE);\r\n        }\r\n\r\n        return this._emptyTexture;\r\n    }\r\n\r\n    /**\r\n     * Gets the default empty 3D texture\r\n     */\r\n    public get emptyTexture3D(): InternalTexture {\r\n        if (!this._emptyTexture3D) {\r\n            this._emptyTexture3D = this.createRawTexture3D(new Uint8Array(4), 1, 1, 1, Constants.TEXTUREFORMAT_RGBA, false, false, Constants.TEXTURE_NEAREST_SAMPLINGMODE);\r\n        }\r\n\r\n        return this._emptyTexture3D;\r\n    }\r\n\r\n    /**\r\n     * Gets the default empty 2D array texture\r\n     */\r\n    public get emptyTexture2DArray(): InternalTexture {\r\n        if (!this._emptyTexture2DArray) {\r\n            this._emptyTexture2DArray = this.createRawTexture2DArray(\r\n                new Uint8Array(4),\r\n                1,\r\n                1,\r\n                1,\r\n                Constants.TEXTUREFORMAT_RGBA,\r\n                false,\r\n                false,\r\n                Constants.TEXTURE_NEAREST_SAMPLINGMODE\r\n            );\r\n        }\r\n\r\n        return this._emptyTexture2DArray;\r\n    }\r\n\r\n    /**\r\n     * Gets the default empty cube texture\r\n     */\r\n    public get emptyCubeTexture(): InternalTexture {\r\n        if (!this._emptyCubeTexture) {\r\n            const faceData = new Uint8Array(4);\r\n            const cubeData = [faceData, faceData, faceData, faceData, faceData, faceData];\r\n            this._emptyCubeTexture = this.createRawCubeTexture(\r\n                cubeData,\r\n                1,\r\n                Constants.TEXTUREFORMAT_RGBA,\r\n                Constants.TEXTURETYPE_UNSIGNED_INT,\r\n                false,\r\n                false,\r\n                Constants.TEXTURE_NEAREST_SAMPLINGMODE\r\n            );\r\n        }\r\n\r\n        return this._emptyCubeTexture;\r\n    }\r\n\r\n    /**\r\n     * Defines whether the engine has been created with the premultipliedAlpha option on or not.\r\n     */\r\n    public premultipliedAlpha: boolean = true;\r\n\r\n    /**\r\n     * Observable event triggered before each texture is initialized\r\n     */\r\n    public onBeforeTextureInitObservable = new Observable<Texture>();\r\n\r\n    /** @internal */\r\n    protected _isWebGPU: boolean = false;\r\n    /**\r\n     * Gets a boolean indicating if the engine runs in WebGPU or not.\r\n     */\r\n    public get isWebGPU(): boolean {\r\n        return this._isWebGPU;\r\n    }\r\n\r\n    /** @internal */\r\n    protected _shaderPlatformName: string;\r\n    /**\r\n     * Gets the shader platform name used by the effects.\r\n     */\r\n    public get shaderPlatformName(): string {\r\n        return this._shaderPlatformName;\r\n    }\r\n\r\n    /**\r\n     * Enables or disables the snapshot rendering mode\r\n     * Note that the WebGL engine does not support snapshot rendering so setting the value won't have any effect for this engine\r\n     */\r\n    public get snapshotRendering(): boolean {\r\n        return false;\r\n    }\r\n\r\n    public set snapshotRendering(activate) {\r\n        // WebGL engine does not support snapshot rendering\r\n    }\r\n\r\n    protected _snapshotRenderingMode = Constants.SNAPSHOTRENDERING_STANDARD;\r\n    /**\r\n     * Gets or sets the snapshot rendering mode\r\n     */\r\n    public get snapshotRenderingMode(): number {\r\n        return this._snapshotRenderingMode;\r\n    }\r\n\r\n    public set snapshotRenderingMode(mode: number) {\r\n        this._snapshotRenderingMode = mode;\r\n    }\r\n\r\n    /**\r\n     * Gets a boolean indicating if the exact sRGB conversions or faster approximations are used for converting to and from linear space.\r\n     */\r\n    public readonly useExactSrgbConversions: boolean;\r\n\r\n    /**\r\n     * Creates a new snapshot at the next frame using the current snapshotRenderingMode\r\n     */\r\n    public snapshotRenderingReset(): void {\r\n        this.snapshotRendering = false;\r\n    }\r\n\r\n    private _checkForMobile: () => void;\r\n\r\n    private static _CreateCanvas(width: number, height: number): ICanvas {\r\n        if (typeof document === \"undefined\") {\r\n            return <ICanvas>(<any>new OffscreenCanvas(width, height));\r\n        }\r\n        const canvas = <ICanvas>(<any>document.createElement(\"canvas\"));\r\n        canvas.width = width;\r\n        canvas.height = height;\r\n        return canvas;\r\n    }\r\n\r\n    /**\r\n     * Create a canvas. This method is overridden by other engines\r\n     * @param width width\r\n     * @param height height\r\n     * @returns ICanvas interface\r\n     */\r\n    public createCanvas(width: number, height: number): ICanvas {\r\n        return ThinEngine._CreateCanvas(width, height);\r\n    }\r\n\r\n    /**\r\n     * Create an image to use with canvas\r\n     * @returns IImage interface\r\n     */\r\n    public createCanvasImage(): IImage {\r\n        return document.createElement(\"img\");\r\n    }\r\n\r\n    /**\r\n     * Creates a new engine\r\n     * @param canvasOrContext defines the canvas or WebGL context to use for rendering. If you provide a WebGL context, Babylon.js will not hook events on the canvas (like pointers, keyboards, etc...) so no event observables will be available. This is mostly used when Babylon.js is used as a plugin on a system which already used the WebGL context\r\n     * @param antialias defines enable antialiasing (default: false)\r\n     * @param options defines further options to be sent to the getContext() function\r\n     * @param adaptToDeviceRatio defines whether to adapt to the device's viewport characteristics (default: false)\r\n     */\r\n    constructor(\r\n        canvasOrContext: Nullable<HTMLCanvasElement | OffscreenCanvas | WebGLRenderingContext | WebGL2RenderingContext>,\r\n        antialias?: boolean,\r\n        options?: EngineOptions,\r\n        adaptToDeviceRatio?: boolean\r\n    ) {\r\n        this.startTime = PrecisionDate.Now;\r\n\r\n        let canvas: Nullable<HTMLCanvasElement> = null;\r\n\r\n        options = options || {};\r\n\r\n        this._creationOptions = options;\r\n\r\n        // Save this off for use in resize().\r\n        this.adaptToDeviceRatio = adaptToDeviceRatio ?? false;\r\n\r\n        this._stencilStateComposer.stencilGlobal = this._stencilState;\r\n\r\n        PerformanceConfigurator.SetMatrixPrecision(!!options.useHighPrecisionMatrix);\r\n\r\n        options.antialias = antialias ?? options.antialias;\r\n        options.deterministicLockstep = options.deterministicLockstep ?? false;\r\n        options.lockstepMaxSteps = options.lockstepMaxSteps ?? 4;\r\n        options.timeStep = options.timeStep ?? 1 / 60;\r\n        options.audioEngine = options.audioEngine ?? true;\r\n        options.stencil = options.stencil ?? true;\r\n\r\n        this._audioContext = options.audioEngineOptions?.audioContext ?? null;\r\n        this._audioDestination = options.audioEngineOptions?.audioDestination ?? null;\r\n        this.premultipliedAlpha = options.premultipliedAlpha ?? true;\r\n        this.useExactSrgbConversions = options.useExactSrgbConversions ?? false;\r\n        this._doNotHandleContextLost = !!options.doNotHandleContextLost;\r\n        this._isStencilEnable = options.stencil ? true : false;\r\n\r\n        // Viewport\r\n        adaptToDeviceRatio = adaptToDeviceRatio || options.adaptToDeviceRatio || false;\r\n\r\n        const devicePixelRatio = IsWindowObjectExist() ? window.devicePixelRatio || 1.0 : 1.0;\r\n\r\n        const limitDeviceRatio = options.limitDeviceRatio || devicePixelRatio;\r\n        this._hardwareScalingLevel = adaptToDeviceRatio ? 1.0 / Math.min(limitDeviceRatio, devicePixelRatio) : 1.0;\r\n        this._lastDevicePixelRatio = devicePixelRatio;\r\n\r\n        if (!canvasOrContext) {\r\n            return;\r\n        }\r\n\r\n        if ((canvasOrContext as any).getContext) {\r\n            canvas = <HTMLCanvasElement>canvasOrContext;\r\n            this._renderingCanvas = canvas;\r\n\r\n            if (options.preserveDrawingBuffer === undefined) {\r\n                options.preserveDrawingBuffer = false;\r\n            }\r\n\r\n            if (options.xrCompatible === undefined) {\r\n                options.xrCompatible = true;\r\n            }\r\n\r\n            // Exceptions\r\n            if (navigator && navigator.userAgent) {\r\n                this._setupMobileChecks();\r\n\r\n                const ua = navigator.userAgent;\r\n                for (const exception of ThinEngine.ExceptionList) {\r\n                    const key = exception.key;\r\n                    const targets = exception.targets;\r\n                    const check = new RegExp(key);\r\n\r\n                    if (check.test(ua)) {\r\n                        if (exception.capture && exception.captureConstraint) {\r\n                            const capture = exception.capture;\r\n                            const constraint = exception.captureConstraint;\r\n\r\n                            const regex = new RegExp(capture);\r\n                            const matches = regex.exec(ua);\r\n\r\n                            if (matches && matches.length > 0) {\r\n                                const capturedValue = parseInt(matches[matches.length - 1]);\r\n                                if (capturedValue >= constraint) {\r\n                                    continue;\r\n                                }\r\n                            }\r\n                        }\r\n\r\n                        for (const target of targets) {\r\n                            switch (target) {\r\n                                case \"uniformBuffer\":\r\n                                    this.disableUniformBuffers = true;\r\n                                    break;\r\n                                case \"vao\":\r\n                                    this.disableVertexArrayObjects = true;\r\n                                    break;\r\n                                case \"antialias\":\r\n                                    options.antialias = false;\r\n                                    break;\r\n                                case \"maxMSAASamples\":\r\n                                    this._maxMSAASamplesOverride = 1;\r\n                                    break;\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            // Context lost\r\n            if (!this._doNotHandleContextLost) {\r\n                this._onContextLost = (evt: Event) => {\r\n                    evt.preventDefault();\r\n                    this._contextWasLost = true;\r\n                    Logger.Warn(\"WebGL context lost.\");\r\n\r\n                    this.onContextLostObservable.notifyObservers(this);\r\n                };\r\n\r\n                this._onContextRestored = () => {\r\n                    this._restoreEngineAfterContextLost(() => this._initGLContext());\r\n                };\r\n\r\n                canvas.addEventListener(\"webglcontextlost\", this._onContextLost, false);\r\n                canvas.addEventListener(\"webglcontextrestored\", this._onContextRestored, false);\r\n\r\n                options.powerPreference = options.powerPreference || \"high-performance\";\r\n            }\r\n\r\n            // Detect if we are running on a faulty buggy desktop OS.\r\n            this._badDesktopOS = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);\r\n            if (this._badDesktopOS) {\r\n                options.xrCompatible = false;\r\n            }\r\n\r\n            // GL\r\n            if (!options.disableWebGL2Support) {\r\n                try {\r\n                    this._gl = <any>(canvas.getContext(\"webgl2\", options) || canvas.getContext(\"experimental-webgl2\", options));\r\n                    if (this._gl) {\r\n                        this._webGLVersion = 2.0;\r\n                        this._shaderPlatformName = \"WEBGL2\";\r\n\r\n                        // Prevent weird browsers to lie (yeah that happens!)\r\n                        if (!this._gl.deleteQuery) {\r\n                            this._webGLVersion = 1.0;\r\n                            this._shaderPlatformName = \"WEBGL1\";\r\n                        }\r\n                    }\r\n                } catch (e) {\r\n                    // Do nothing\r\n                }\r\n            }\r\n\r\n            if (!this._gl) {\r\n                if (!canvas) {\r\n                    throw new Error(\"The provided canvas is null or undefined.\");\r\n                }\r\n                try {\r\n                    this._gl = <WebGL2RenderingContext>(canvas.getContext(\"webgl\", options) || canvas.getContext(\"experimental-webgl\", options));\r\n                } catch (e) {\r\n                    throw new Error(\"WebGL not supported\");\r\n                }\r\n            }\r\n\r\n            if (!this._gl) {\r\n                throw new Error(\"WebGL not supported\");\r\n            }\r\n        } else {\r\n            this._gl = <WebGL2RenderingContext>canvasOrContext;\r\n            this._renderingCanvas = this._gl.canvas as HTMLCanvasElement;\r\n\r\n            if ((this._gl as any).renderbufferStorageMultisample) {\r\n                this._webGLVersion = 2.0;\r\n                this._shaderPlatformName = \"WEBGL2\";\r\n            } else {\r\n                this._shaderPlatformName = \"WEBGL1\";\r\n            }\r\n\r\n            const attributes = this._gl.getContextAttributes();\r\n            if (attributes) {\r\n                options.stencil = attributes.stencil;\r\n            }\r\n        }\r\n\r\n        // Ensures a consistent color space unpacking of textures cross browser.\r\n        this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL, this._gl.NONE);\r\n\r\n        if (options.useHighPrecisionFloats !== undefined) {\r\n            this._highPrecisionShadersAllowed = options.useHighPrecisionFloats;\r\n        }\r\n\r\n        this.resize();\r\n\r\n        this._initGLContext();\r\n        this._initFeatures();\r\n\r\n        // Prepare buffer pointers\r\n        for (let i = 0; i < this._caps.maxVertexAttribs; i++) {\r\n            this._currentBufferPointers[i] = new BufferPointer();\r\n        }\r\n\r\n        // Shader processor\r\n        this._shaderProcessor = this.webGLVersion > 1 ? new WebGL2ShaderProcessor() : new WebGLShaderProcessor();\r\n\r\n        // Detect if we are running on a faulty buggy OS.\r\n        this._badOS = /iPad/i.test(navigator.userAgent) || /iPhone/i.test(navigator.userAgent);\r\n\r\n        // Starting with iOS 14, we can trust the browser\r\n        // let matches = navigator.userAgent.match(/Version\\/(\\d+)/);\r\n\r\n        // if (matches && matches.length === 2) {\r\n        //     if (parseInt(matches[1]) >= 14) {\r\n        //         this._badOS = false;\r\n        //     }\r\n        // }\r\n\r\n        const versionToLog = `Babylon.js v${ThinEngine.Version}`;\r\n        Logger.Log(versionToLog + ` - ${this.description}`);\r\n\r\n        // Check setAttribute in case of workers\r\n        if (this._renderingCanvas && this._renderingCanvas.setAttribute) {\r\n            this._renderingCanvas.setAttribute(\"data-engine\", versionToLog);\r\n        }\r\n    }\r\n\r\n    protected _setupMobileChecks(): void {\r\n        if (!(navigator && navigator.userAgent)) {\r\n            return;\r\n        }\r\n\r\n        // Function to check if running on mobile device\r\n        this._checkForMobile = () => {\r\n            const currentUA = navigator.userAgent;\r\n            this.hostInformation.isMobile =\r\n                currentUA.indexOf(\"Mobile\") !== -1 ||\r\n                // Needed for iOS 13+ detection on iPad (inspired by solution from https://stackoverflow.com/questions/9038625/detect-if-device-is-ios)\r\n                (currentUA.indexOf(\"Mac\") !== -1 && IsDocumentAvailable() && \"ontouchend\" in document);\r\n        };\r\n\r\n        // Set initial isMobile value\r\n        this._checkForMobile();\r\n\r\n        // Set up event listener to check when window is resized (used to get emulator activation to work properly)\r\n        if (IsWindowObjectExist()) {\r\n            window.addEventListener(\"resize\", this._checkForMobile);\r\n        }\r\n    }\r\n\r\n    protected _clearEmptyResources(): void {\r\n        this._dummyFramebuffer = null;\r\n        this._emptyTexture = null;\r\n        this._emptyCubeTexture = null;\r\n        this._emptyTexture3D = null;\r\n        this._emptyTexture2DArray = null;\r\n    }\r\n\r\n    protected _rebuildGraphicsResources(): void {\r\n        // Ensure webgl and engine states are matching\r\n        this.wipeCaches(true);\r\n\r\n        // Rebuild effects\r\n        this._rebuildEffects();\r\n        this._rebuildComputeEffects?.();\r\n\r\n        // Note:\r\n        //  The call to _rebuildBuffers must be made before the call to _rebuildInternalTextures because in the process of _rebuildBuffers the buffers used by the post process managers will be rebuilt\r\n        //  and we may need to use the post process manager of the scene during _rebuildInternalTextures (in WebGL1, non-POT textures are rescaled using a post process + post process manager of the scene)\r\n\r\n        // Rebuild buffers\r\n        this._rebuildBuffers();\r\n        // Rebuild textures\r\n        this._rebuildInternalTextures();\r\n        // Rebuild textures\r\n        this._rebuildTextures();\r\n        // Rebuild textures\r\n        this._rebuildRenderTargetWrappers();\r\n\r\n        // Reset engine states after all the buffer/textures/... have been rebuilt\r\n        this.wipeCaches(true);\r\n    }\r\n\r\n    protected _flagContextRestored(): void {\r\n        Logger.Warn(this.name + \" context successfully restored.\");\r\n        this.onContextRestoredObservable.notifyObservers(this);\r\n        this._contextWasLost = false;\r\n    }\r\n\r\n    protected _restoreEngineAfterContextLost(initEngine: () => void): void {\r\n        // Adding a timeout to avoid race condition at browser level\r\n        setTimeout(async () => {\r\n            this._clearEmptyResources();\r\n\r\n            const depthTest = this._depthCullingState.depthTest; // backup those values because the call to initEngine / wipeCaches will reset them\r\n            const depthFunc = this._depthCullingState.depthFunc;\r\n            const depthMask = this._depthCullingState.depthMask;\r\n            const stencilTest = this._stencilState.stencilTest;\r\n\r\n            // Rebuild context\r\n            await initEngine();\r\n            this._rebuildGraphicsResources();\r\n\r\n            this._depthCullingState.depthTest = depthTest;\r\n            this._depthCullingState.depthFunc = depthFunc;\r\n            this._depthCullingState.depthMask = depthMask;\r\n            this._stencilState.stencilTest = stencilTest;\r\n\r\n            this._flagContextRestored();\r\n        }, 0);\r\n    }\r\n\r\n    /**\r\n     * Shared initialization across engines types.\r\n     * @param canvas The canvas associated with this instance of the engine.\r\n     */\r\n    protected _sharedInit(canvas: HTMLCanvasElement) {\r\n        this._renderingCanvas = canvas;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _getShaderProcessingContext(shaderLanguage: ShaderLanguage): Nullable<ShaderProcessingContext> {\r\n        return null;\r\n    }\r\n\r\n    private _rebuildInternalTextures(): void {\r\n        const currentState = this._internalTexturesCache.slice(); // Do a copy because the rebuild will add proxies\r\n\r\n        for (const internalTexture of currentState) {\r\n            internalTexture._rebuild();\r\n        }\r\n    }\r\n\r\n    private _rebuildRenderTargetWrappers(): void {\r\n        const currentState = this._renderTargetWrapperCache.slice(); // Do a copy because the rebuild will add proxies\r\n\r\n        for (const renderTargetWrapper of currentState) {\r\n            renderTargetWrapper._rebuild();\r\n        }\r\n    }\r\n\r\n    private _rebuildEffects(): void {\r\n        for (const key in this._compiledEffects) {\r\n            const effect = <Effect>this._compiledEffects[key];\r\n\r\n            effect._pipelineContext = null; // because _prepareEffect will try to dispose this pipeline before recreating it and that would lead to webgl errors\r\n            effect._prepareEffect();\r\n        }\r\n\r\n        Effect.ResetCache();\r\n    }\r\n\r\n    /**\r\n     * Gets a boolean indicating if all created effects are ready\r\n     * @returns true if all effects are ready\r\n     */\r\n    public areAllEffectsReady(): boolean {\r\n        for (const key in this._compiledEffects) {\r\n            const effect = <Effect>this._compiledEffects[key];\r\n\r\n            if (!effect.isReady()) {\r\n                return false;\r\n            }\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    protected _rebuildBuffers(): void {\r\n        // Uniforms\r\n        for (const uniformBuffer of this._uniformBuffers) {\r\n            uniformBuffer._rebuildAfterContextLost();\r\n        }\r\n    }\r\n\r\n    protected _rebuildTextures(): void {}\r\n\r\n    protected _initGLContext(): void {\r\n        // Caps\r\n        this._caps = {\r\n            maxTexturesImageUnits: this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),\r\n            maxCombinedTexturesImageUnits: this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),\r\n            maxVertexTextureImageUnits: this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),\r\n            maxTextureSize: this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),\r\n            maxSamples: this._webGLVersion > 1 ? this._gl.getParameter(this._gl.MAX_SAMPLES) : 1,\r\n            maxCubemapTextureSize: this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),\r\n            maxRenderTextureSize: this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),\r\n            maxVertexAttribs: this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),\r\n            maxVaryingVectors: this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),\r\n            maxFragmentUniformVectors: this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),\r\n            maxVertexUniformVectors: this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),\r\n            parallelShaderCompile: this._gl.getExtension(\"KHR_parallel_shader_compile\") || undefined,\r\n            standardDerivatives: this._webGLVersion > 1 || this._gl.getExtension(\"OES_standard_derivatives\") !== null,\r\n            maxAnisotropy: 1,\r\n            astc: this._gl.getExtension(\"WEBGL_compressed_texture_astc\") || this._gl.getExtension(\"WEBKIT_WEBGL_compressed_texture_astc\"),\r\n            bptc: this._gl.getExtension(\"EXT_texture_compression_bptc\") || this._gl.getExtension(\"WEBKIT_EXT_texture_compression_bptc\"),\r\n            s3tc: this._gl.getExtension(\"WEBGL_compressed_texture_s3tc\") || this._gl.getExtension(\"WEBKIT_WEBGL_compressed_texture_s3tc\"),\r\n            // eslint-disable-next-line @typescript-eslint/naming-convention\r\n            s3tc_srgb: this._gl.getExtension(\"WEBGL_compressed_texture_s3tc_srgb\") || this._gl.getExtension(\"WEBKIT_WEBGL_compressed_texture_s3tc_srgb\"),\r\n            pvrtc: this._gl.getExtension(\"WEBGL_compressed_texture_pvrtc\") || this._gl.getExtension(\"WEBKIT_WEBGL_compressed_texture_pvrtc\"),\r\n            etc1: this._gl.getExtension(\"WEBGL_compressed_texture_etc1\") || this._gl.getExtension(\"WEBKIT_WEBGL_compressed_texture_etc1\"),\r\n            etc2:\r\n                this._gl.getExtension(\"WEBGL_compressed_texture_etc\") ||\r\n                this._gl.getExtension(\"WEBKIT_WEBGL_compressed_texture_etc\") ||\r\n                this._gl.getExtension(\"WEBGL_compressed_texture_es3_0\"), // also a requirement of OpenGL ES 3\r\n            textureAnisotropicFilterExtension:\r\n                this._gl.getExtension(\"EXT_texture_filter_anisotropic\") ||\r\n                this._gl.getExtension(\"WEBKIT_EXT_texture_filter_anisotropic\") ||\r\n                this._gl.getExtension(\"MOZ_EXT_texture_filter_anisotropic\"),\r\n            uintIndices: this._webGLVersion > 1 || this._gl.getExtension(\"OES_element_index_uint\") !== null,\r\n            fragmentDepthSupported: this._webGLVersion > 1 || this._gl.getExtension(\"EXT_frag_depth\") !== null,\r\n            highPrecisionShaderSupported: false,\r\n            timerQuery: this._gl.getExtension(\"EXT_disjoint_timer_query_webgl2\") || this._gl.getExtension(\"EXT_disjoint_timer_query\"),\r\n            supportOcclusionQuery: this._webGLVersion > 1,\r\n            canUseTimestampForTimerQuery: false,\r\n            drawBuffersExtension: false,\r\n            maxMSAASamples: 1,\r\n            colorBufferFloat: !!(this._webGLVersion > 1 && this._gl.getExtension(\"EXT_color_buffer_float\")),\r\n            supportFloatTexturesResolve: false,\r\n            rg11b10ufColorRenderable: false,\r\n            colorBufferHalfFloat: !!(this._webGLVersion > 1 && this._gl.getExtension(\"EXT_color_buffer_half_float\")),\r\n            textureFloat: this._webGLVersion > 1 || this._gl.getExtension(\"OES_texture_float\") ? true : false,\r\n            textureHalfFloat: this._webGLVersion > 1 || this._gl.getExtension(\"OES_texture_half_float\") ? true : false,\r\n            textureHalfFloatRender: false,\r\n            textureFloatLinearFiltering: false,\r\n            textureFloatRender: false,\r\n            textureHalfFloatLinearFiltering: false,\r\n            vertexArrayObject: false,\r\n            instancedArrays: false,\r\n            textureLOD: this._webGLVersion > 1 || this._gl.getExtension(\"EXT_shader_texture_lod\") ? true : false,\r\n            texelFetch: this._webGLVersion !== 1,\r\n            blendMinMax: false,\r\n            multiview: this._gl.getExtension(\"OVR_multiview2\"),\r\n            oculusMultiview: this._gl.getExtension(\"OCULUS_multiview\"),\r\n            depthTextureExtension: false,\r\n            canUseGLInstanceID: this._webGLVersion > 1,\r\n            canUseGLVertexID: this._webGLVersion > 1,\r\n            supportComputeShaders: false,\r\n            supportSRGBBuffers: false,\r\n            supportTransformFeedbacks: this._webGLVersion > 1,\r\n            textureMaxLevel: this._webGLVersion > 1,\r\n            texture2DArrayMaxLayerCount: this._webGLVersion > 1 ? this._gl.getParameter(this._gl.MAX_ARRAY_TEXTURE_LAYERS) : 128,\r\n            disableMorphTargetTexture: false,\r\n        };\r\n\r\n        this._caps.supportFloatTexturesResolve = this._caps.colorBufferFloat;\r\n        this._caps.rg11b10ufColorRenderable = this._caps.colorBufferFloat;\r\n\r\n        // Infos\r\n        this._glVersion = this._gl.getParameter(this._gl.VERSION);\r\n\r\n        const rendererInfo: any = this._gl.getExtension(\"WEBGL_debug_renderer_info\");\r\n        if (rendererInfo != null) {\r\n            this._glRenderer = this._gl.getParameter(rendererInfo.UNMASKED_RENDERER_WEBGL);\r\n            this._glVendor = this._gl.getParameter(rendererInfo.UNMASKED_VENDOR_WEBGL);\r\n        }\r\n\r\n        if (!this._glVendor) {\r\n            this._glVendor = this._gl.getParameter(this._gl.VENDOR) || \"Unknown vendor\";\r\n        }\r\n\r\n        if (!this._glRenderer) {\r\n            this._glRenderer = this._gl.getParameter(this._gl.RENDERER) || \"Unknown renderer\";\r\n        }\r\n\r\n        // Constants\r\n        if (this._gl.HALF_FLOAT_OES !== 0x8d61) {\r\n            this._gl.HALF_FLOAT_OES = 0x8d61; // Half floating-point type (16-bit).\r\n        }\r\n        if (this._gl.RGBA16F !== 0x881a) {\r\n            this._gl.RGBA16F = 0x881a; // RGBA 16-bit floating-point color-renderable internal sized format.\r\n        }\r\n        if (this._gl.RGBA32F !== 0x8814) {\r\n            this._gl.RGBA32F = 0x8814; // RGBA 32-bit floating-point color-renderable internal sized format.\r\n        }\r\n        if (this._gl.DEPTH24_STENCIL8 !== 35056) {\r\n            this._gl.DEPTH24_STENCIL8 = 35056;\r\n        }\r\n\r\n        // Extensions\r\n        if (this._caps.timerQuery) {\r\n            if (this._webGLVersion === 1) {\r\n                this._gl.getQuery = (<any>this._caps.timerQuery).getQueryEXT.bind(this._caps.timerQuery);\r\n            }\r\n            // WebGLQuery casted to number to avoid TS error\r\n            this._caps.canUseTimestampForTimerQuery = ((this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT, this._caps.timerQuery.QUERY_COUNTER_BITS_EXT) as number) ?? 0) > 0;\r\n        }\r\n\r\n        this._caps.maxAnisotropy = this._caps.textureAnisotropicFilterExtension\r\n            ? this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT)\r\n            : 0;\r\n        this._caps.textureFloatLinearFiltering = this._caps.textureFloat && this._gl.getExtension(\"OES_texture_float_linear\") ? true : false;\r\n        this._caps.textureFloatRender = this._caps.textureFloat && this._canRenderToFloatFramebuffer() ? true : false;\r\n        this._caps.textureHalfFloatLinearFiltering =\r\n            this._webGLVersion > 1 || (this._caps.textureHalfFloat && this._gl.getExtension(\"OES_texture_half_float_linear\")) ? true : false;\r\n\r\n        // Compressed formats\r\n        if (this._caps.astc) {\r\n            this._gl.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR = this._caps.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;\r\n        }\r\n        if (this._caps.bptc) {\r\n            this._gl.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT = this._caps.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT;\r\n        }\r\n        if (this._caps.s3tc_srgb) {\r\n            this._gl.COMPRESSED_SRGB_S3TC_DXT1_EXT = this._caps.s3tc_srgb.COMPRESSED_SRGB_S3TC_DXT1_EXT;\r\n            this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT = this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;\r\n            this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT = this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;\r\n        }\r\n        if (this._caps.etc2) {\r\n            this._gl.COMPRESSED_SRGB8_ETC2 = this._caps.etc2.COMPRESSED_SRGB8_ETC2;\r\n            this._gl.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC = this._caps.etc2.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC;\r\n        }\r\n\r\n        // Checks if some of the format renders first to allow the use of webgl inspector.\r\n        if (this._webGLVersion > 1) {\r\n            if (this._gl.HALF_FLOAT_OES !== 0x140b) {\r\n                this._gl.HALF_FLOAT_OES = 0x140b;\r\n            }\r\n        }\r\n        this._caps.textureHalfFloatRender = this._caps.textureHalfFloat && this._canRenderToHalfFloatFramebuffer();\r\n        // Draw buffers\r\n        if (this._webGLVersion > 1) {\r\n            this._caps.drawBuffersExtension = true;\r\n            this._caps.maxMSAASamples = this._maxMSAASamplesOverride !== null ? this._maxMSAASamplesOverride : this._gl.getParameter(this._gl.MAX_SAMPLES);\r\n        } else {\r\n            const drawBuffersExtension = this._gl.getExtension(\"WEBGL_draw_buffers\");\r\n\r\n            if (drawBuffersExtension !== null) {\r\n                this._caps.drawBuffersExtension = true;\r\n                this._gl.drawBuffers = drawBuffersExtension.drawBuffersWEBGL.bind(drawBuffersExtension);\r\n                (this._gl.DRAW_FRAMEBUFFER as any) = this._gl.FRAMEBUFFER;\r\n\r\n                for (let i = 0; i < 16; i++) {\r\n                    (<any>this._gl)[\"COLOR_ATTACHMENT\" + i + \"_WEBGL\"] = (<any>drawBuffersExtension)[\"COLOR_ATTACHMENT\" + i + \"_WEBGL\"];\r\n                }\r\n            }\r\n        }\r\n\r\n        // Depth Texture\r\n        if (this._webGLVersion > 1) {\r\n            this._caps.depthTextureExtension = true;\r\n        } else {\r\n            const depthTextureExtension = this._gl.getExtension(\"WEBGL_depth_texture\");\r\n\r\n            if (depthTextureExtension != null) {\r\n                this._caps.depthTextureExtension = true;\r\n                this._gl.UNSIGNED_INT_24_8 = depthTextureExtension.UNSIGNED_INT_24_8_WEBGL;\r\n            }\r\n        }\r\n\r\n        // Vertex array object\r\n        if (this.disableVertexArrayObjects) {\r\n            this._caps.vertexArrayObject = false;\r\n        } else if (this._webGLVersion > 1) {\r\n            this._caps.vertexArrayObject = true;\r\n        } else {\r\n            const vertexArrayObjectExtension = this._gl.getExtension(\"OES_vertex_array_object\");\r\n\r\n            if (vertexArrayObjectExtension != null) {\r\n                this._caps.vertexArrayObject = true;\r\n                this._gl.createVertexArray = vertexArrayObjectExtension.createVertexArrayOES.bind(vertexArrayObjectExtension);\r\n                this._gl.bindVertexArray = vertexArrayObjectExtension.bindVertexArrayOES.bind(vertexArrayObjectExtension);\r\n                this._gl.deleteVertexArray = vertexArrayObjectExtension.deleteVertexArrayOES.bind(vertexArrayObjectExtension);\r\n            }\r\n        }\r\n\r\n        // Instances count\r\n        if (this._webGLVersion > 1) {\r\n            this._caps.instancedArrays = true;\r\n        } else {\r\n            const instanceExtension = <ANGLE_instanced_arrays>this._gl.getExtension(\"ANGLE_instanced_arrays\");\r\n\r\n            if (instanceExtension != null) {\r\n                this._caps.instancedArrays = true;\r\n                this._gl.drawArraysInstanced = instanceExtension.drawArraysInstancedANGLE.bind(instanceExtension);\r\n                this._gl.drawElementsInstanced = instanceExtension.drawElementsInstancedANGLE.bind(instanceExtension);\r\n                this._gl.vertexAttribDivisor = instanceExtension.vertexAttribDivisorANGLE.bind(instanceExtension);\r\n            } else {\r\n                this._caps.instancedArrays = false;\r\n            }\r\n        }\r\n\r\n        if (this._gl.getShaderPrecisionFormat) {\r\n            const vertexhighp = this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER, this._gl.HIGH_FLOAT);\r\n            const fragmenthighp = this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER, this._gl.HIGH_FLOAT);\r\n\r\n            if (vertexhighp && fragmenthighp) {\r\n                this._caps.highPrecisionShaderSupported = vertexhighp.precision !== 0 && fragmenthighp.precision !== 0;\r\n            }\r\n        }\r\n\r\n        if (this._webGLVersion > 1) {\r\n            this._caps.blendMinMax = true;\r\n        } else {\r\n            const blendMinMaxExtension = this._gl.getExtension(\"EXT_blend_minmax\");\r\n            if (blendMinMaxExtension != null) {\r\n                this._caps.blendMinMax = true;\r\n                this._gl.MAX = blendMinMaxExtension.MAX_EXT as typeof WebGL2RenderingContext.MAX;\r\n                this._gl.MIN = blendMinMaxExtension.MIN_EXT as typeof WebGL2RenderingContext.MIN;\r\n            }\r\n        }\r\n\r\n        // sRGB buffers\r\n        // only run this if not already set to true (in the constructor, for example)\r\n        if (!this._caps.supportSRGBBuffers) {\r\n            if (this._webGLVersion > 1) {\r\n                this._caps.supportSRGBBuffers = true;\r\n                this._glSRGBExtensionValues = {\r\n                    SRGB: WebGL2RenderingContext.SRGB,\r\n                    SRGB8: WebGL2RenderingContext.SRGB8,\r\n                    SRGB8_ALPHA8: WebGL2RenderingContext.SRGB8_ALPHA8,\r\n                };\r\n            } else {\r\n                const sRGBExtension = this._gl.getExtension(\"EXT_sRGB\");\r\n\r\n                if (sRGBExtension != null) {\r\n                    this._caps.supportSRGBBuffers = true;\r\n                    this._glSRGBExtensionValues = {\r\n                        SRGB: sRGBExtension.SRGB_EXT as typeof WebGL2RenderingContext.SRGB | EXT_sRGB[\"SRGB_EXT\"],\r\n                        SRGB8: sRGBExtension.SRGB_ALPHA_EXT as typeof WebGL2RenderingContext.SRGB8 | EXT_sRGB[\"SRGB_ALPHA_EXT\"],\r\n                        SRGB8_ALPHA8: sRGBExtension.SRGB_ALPHA_EXT as typeof WebGL2RenderingContext.SRGB8_ALPHA8 | EXT_sRGB[\"SRGB8_ALPHA8_EXT\"],\r\n                    };\r\n                }\r\n            }\r\n            // take into account the forced state that was provided in options\r\n            // When the issue in angle/chrome is fixed the flag should be taken into account only when it is explicitly defined\r\n            this._caps.supportSRGBBuffers = this._caps.supportSRGBBuffers && !!(this._creationOptions && this._creationOptions.forceSRGBBufferSupportState);\r\n        }\r\n\r\n        // Depth buffer\r\n        this._depthCullingState.depthTest = true;\r\n        this._depthCullingState.depthFunc = this._gl.LEQUAL;\r\n        this._depthCullingState.depthMask = true;\r\n\r\n        // Texture maps\r\n        this._maxSimultaneousTextures = this._caps.maxCombinedTexturesImageUnits;\r\n        for (let slot = 0; slot < this._maxSimultaneousTextures; slot++) {\r\n            this._nextFreeTextureSlots.push(slot);\r\n        }\r\n\r\n        if (this._glRenderer === \"Mali-G72\") {\r\n            // Overcome a bug when using a texture to store morph targets on Mali-G72\r\n            this._caps.disableMorphTargetTexture = true;\r\n        }\r\n    }\r\n\r\n    protected _initFeatures(): void {\r\n        this._features = {\r\n            forceBitmapOverHTMLImageElement: typeof HTMLImageElement === \"undefined\",\r\n            supportRenderAndCopyToLodForFloatTextures: this._webGLVersion !== 1,\r\n            supportDepthStencilTexture: this._webGLVersion !== 1,\r\n            supportShadowSamplers: this._webGLVersion !== 1,\r\n            uniformBufferHardCheckMatrix: false,\r\n            allowTexturePrefiltering: this._webGLVersion !== 1,\r\n            trackUbosInFrame: false,\r\n            checkUbosContentBeforeUpload: false,\r\n            supportCSM: this._webGLVersion !== 1,\r\n            basisNeedsPOT: this._webGLVersion === 1,\r\n            support3DTextures: this._webGLVersion !== 1,\r\n            needTypeSuffixInShaderConstants: this._webGLVersion !== 1,\r\n            supportMSAA: this._webGLVersion !== 1,\r\n            supportSSAO2: this._webGLVersion !== 1,\r\n            supportExtendedTextureFormats: this._webGLVersion !== 1,\r\n            supportSwitchCaseInShader: this._webGLVersion !== 1,\r\n            supportSyncTextureRead: true,\r\n            needsInvertingBitmap: true,\r\n            useUBOBindingCache: true,\r\n            needShaderCodeInlining: false,\r\n            needToAlwaysBindUniformBuffers: false,\r\n            supportRenderPasses: false,\r\n            supportSpriteInstancing: true,\r\n            forceVertexBufferStrideAndOffsetMultiple4Bytes: false,\r\n            _collectUbosUpdatedInFrame: false,\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Gets version of the current webGL context\r\n     * Keep it for back compat - use version instead\r\n     */\r\n    public get webGLVersion(): number {\r\n        return this._webGLVersion;\r\n    }\r\n\r\n    /**\r\n     * Gets a string identifying the name of the class\r\n     * @returns \"Engine\" string\r\n     */\r\n    public getClassName(): string {\r\n        return \"ThinEngine\";\r\n    }\r\n\r\n    /**\r\n     * Returns true if the stencil buffer has been enabled through the creation option of the context.\r\n     */\r\n    public get isStencilEnable(): boolean {\r\n        return this._isStencilEnable;\r\n    }\r\n\r\n    /** @internal */\r\n    public _prepareWorkingCanvas(): void {\r\n        if (this._workingCanvas) {\r\n            return;\r\n        }\r\n\r\n        this._workingCanvas = this.createCanvas(1, 1);\r\n        const context = this._workingCanvas.getContext(\"2d\");\r\n\r\n        if (context) {\r\n            this._workingContext = context;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Reset the texture cache to empty state\r\n     */\r\n    public resetTextureCache() {\r\n        for (const key in this._boundTexturesCache) {\r\n            if (!Object.prototype.hasOwnProperty.call(this._boundTexturesCache, key)) {\r\n                continue;\r\n            }\r\n            this._boundTexturesCache[key] = null;\r\n        }\r\n\r\n        this._currentTextureChannel = -1;\r\n    }\r\n\r\n    /**\r\n     * Gets an object containing information about the current engine context\r\n     * @returns an object containing the vendor, the renderer and the version of the current engine context\r\n     */\r\n    public getInfo() {\r\n        return this.getGlInfo();\r\n    }\r\n\r\n    /**\r\n     * Gets an object containing information about the current webGL context\r\n     * @returns an object containing the vendor, the renderer and the version of the current webGL context\r\n     */\r\n    public getGlInfo() {\r\n        return {\r\n            vendor: this._glVendor,\r\n            renderer: this._glRenderer,\r\n            version: this._glVersion,\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Defines the hardware scaling level.\r\n     * By default the hardware scaling level is computed from the window device ratio.\r\n     * if level = 1 then the engine will render at the exact resolution of the canvas. If level = 0.5 then the engine will render at twice the size of the canvas.\r\n     * @param level defines the level to use\r\n     */\r\n    public setHardwareScalingLevel(level: number): void {\r\n        this._hardwareScalingLevel = level;\r\n        this.resize();\r\n    }\r\n\r\n    /**\r\n     * Gets the current hardware scaling level.\r\n     * By default the hardware scaling level is computed from the window device ratio.\r\n     * if level = 1 then the engine will render at the exact resolution of the canvas. If level = 0.5 then the engine will render at twice the size of the canvas.\r\n     * @returns a number indicating the current hardware scaling level\r\n     */\r\n    public getHardwareScalingLevel(): number {\r\n        return this._hardwareScalingLevel;\r\n    }\r\n\r\n    /**\r\n     * Gets the list of loaded textures\r\n     * @returns an array containing all loaded textures\r\n     */\r\n    public getLoadedTexturesCache(): InternalTexture[] {\r\n        return this._internalTexturesCache;\r\n    }\r\n\r\n    /**\r\n     * Gets the object containing all engine capabilities\r\n     * @returns the EngineCapabilities object\r\n     */\r\n    public getCaps(): EngineCapabilities {\r\n        return this._caps;\r\n    }\r\n\r\n    /**\r\n     * stop executing a render loop function and remove it from the execution array\r\n     * @param renderFunction defines the function to be removed. If not provided all functions will be removed.\r\n     */\r\n    public stopRenderLoop(renderFunction?: () => void): void {\r\n        if (!renderFunction) {\r\n            this._activeRenderLoops.length = 0;\r\n            this._cancelFrame();\r\n            return;\r\n        }\r\n\r\n        const index = this._activeRenderLoops.indexOf(renderFunction);\r\n\r\n        if (index >= 0) {\r\n            this._activeRenderLoops.splice(index, 1);\r\n            if (this._activeRenderLoops.length == 0) {\r\n                this._cancelFrame();\r\n            }\r\n        }\r\n    }\r\n\r\n    protected _cancelFrame() {\r\n        if (this._frameHandler !== 0) {\r\n            const handlerToCancel = this._frameHandler;\r\n            this._frameHandler = 0;\r\n\r\n            if (!IsWindowObjectExist()) {\r\n                if (typeof cancelAnimationFrame === \"function\") {\r\n                    return cancelAnimationFrame(handlerToCancel);\r\n                }\r\n            } else {\r\n                const { cancelAnimationFrame } = this.getHostWindow() || window;\r\n                if (typeof cancelAnimationFrame === \"function\") {\r\n                    return cancelAnimationFrame(handlerToCancel);\r\n                }\r\n            }\r\n            return clearTimeout(handlerToCancel);\r\n        }\r\n    }\r\n\r\n    /** @internal */\r\n    public _renderLoop(): void {\r\n        this._frameHandler = 0;\r\n\r\n        if (!this._contextWasLost) {\r\n            let shouldRender = true;\r\n            if (this._isDisposed || (!this.renderEvenInBackground && this._windowIsBackground)) {\r\n                shouldRender = false;\r\n            }\r\n\r\n            if (shouldRender) {\r\n                // Start new frame\r\n                this.beginFrame();\r\n\r\n                for (let index = 0; index < this._activeRenderLoops.length; index++) {\r\n                    const renderFunction = this._activeRenderLoops[index];\r\n\r\n                    renderFunction();\r\n                }\r\n\r\n                // Present\r\n                this.endFrame();\r\n            }\r\n        }\r\n\r\n        if (this._frameHandler === 0) {\r\n            this._frameHandler = this._queueNewFrame(this._boundRenderFunction, this.getHostWindow());\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Gets the HTML canvas attached with the current webGL context\r\n     * @returns a HTML canvas\r\n     */\r\n    public getRenderingCanvas(): Nullable<HTMLCanvasElement> {\r\n        return this._renderingCanvas;\r\n    }\r\n\r\n    /**\r\n     * Gets the audio context specified in engine initialization options\r\n     * @returns an Audio Context\r\n     */\r\n    public getAudioContext(): Nullable<AudioContext> {\r\n        return this._audioContext;\r\n    }\r\n\r\n    /**\r\n     * Gets the audio destination specified in engine initialization options\r\n     * @returns an audio destination node\r\n     */\r\n    public getAudioDestination(): Nullable<AudioDestinationNode | MediaStreamAudioDestinationNode> {\r\n        return this._audioDestination;\r\n    }\r\n\r\n    /**\r\n     * Gets host window\r\n     * @returns the host window object\r\n     */\r\n    public getHostWindow(): Nullable<Window> {\r\n        if (!IsWindowObjectExist()) {\r\n            return null;\r\n        }\r\n\r\n        if (this._renderingCanvas && this._renderingCanvas.ownerDocument && this._renderingCanvas.ownerDocument.defaultView) {\r\n            return this._renderingCanvas.ownerDocument.defaultView;\r\n        }\r\n\r\n        return window;\r\n    }\r\n\r\n    /**\r\n     * Gets the current render width\r\n     * @param useScreen defines if screen size must be used (or the current render target if any)\r\n     * @returns a number defining the current render width\r\n     */\r\n    public getRenderWidth(useScreen = false): number {\r\n        if (!useScreen && this._currentRenderTarget) {\r\n            return this._currentRenderTarget.width;\r\n        }\r\n\r\n        return this._framebufferDimensionsObject ? this._framebufferDimensionsObject.framebufferWidth : this._gl.drawingBufferWidth;\r\n    }\r\n\r\n    /**\r\n     * Gets the current render height\r\n     * @param useScreen defines if screen size must be used (or the current render target if any)\r\n     * @returns a number defining the current render height\r\n     */\r\n    public getRenderHeight(useScreen = false): number {\r\n        if (!useScreen && this._currentRenderTarget) {\r\n            return this._currentRenderTarget.height;\r\n        }\r\n\r\n        return this._framebufferDimensionsObject ? this._framebufferDimensionsObject.framebufferHeight : this._gl.drawingBufferHeight;\r\n    }\r\n\r\n    /**\r\n     * Can be used to override the current requestAnimationFrame requester.\r\n     * @internal\r\n     */\r\n    protected _queueNewFrame(bindedRenderFunction: any, requester?: any): number {\r\n        return ThinEngine.QueueNewFrame(bindedRenderFunction, requester);\r\n    }\r\n\r\n    /**\r\n     * Register and execute a render loop. The engine can have more than one render function\r\n     * @param renderFunction defines the function to continuously execute\r\n     */\r\n    public runRenderLoop(renderFunction: () => void): void {\r\n        if (this._activeRenderLoops.indexOf(renderFunction) !== -1) {\r\n            return;\r\n        }\r\n\r\n        this._activeRenderLoops.push(renderFunction);\r\n\r\n        // On the first added function, start the render loop.\r\n        if (this._activeRenderLoops.length === 1 && this._frameHandler === 0) {\r\n            this._frameHandler = this._queueNewFrame(this._boundRenderFunction, this.getHostWindow());\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Clear the current render buffer or the current render target (if any is set up)\r\n     * @param color defines the color to use\r\n     * @param backBuffer defines if the back buffer must be cleared\r\n     * @param depth defines if the depth buffer must be cleared\r\n     * @param stencil defines if the stencil buffer must be cleared\r\n     */\r\n    public clear(color: Nullable<IColor4Like>, backBuffer: boolean, depth: boolean, stencil: boolean = false): void {\r\n        const useStencilGlobalOnly = this.stencilStateComposer.useStencilGlobalOnly;\r\n        this.stencilStateComposer.useStencilGlobalOnly = true; // make sure the stencil mask is coming from the global stencil and not from a material (effect) which would currently be in effect\r\n\r\n        this.applyStates();\r\n\r\n        this.stencilStateComposer.useStencilGlobalOnly = useStencilGlobalOnly;\r\n\r\n        let mode = 0;\r\n        if (backBuffer && color) {\r\n            let setBackBufferColor = true;\r\n            if (this._currentRenderTarget) {\r\n                const textureFormat = this._currentRenderTarget.texture?.format;\r\n                if (\r\n                    textureFormat === Constants.TEXTUREFORMAT_RED_INTEGER ||\r\n                    textureFormat === Constants.TEXTUREFORMAT_RG_INTEGER ||\r\n                    textureFormat === Constants.TEXTUREFORMAT_RGB_INTEGER ||\r\n                    textureFormat === Constants.TEXTUREFORMAT_RGBA_INTEGER\r\n                ) {\r\n                    const textureType = this._currentRenderTarget.texture?.type;\r\n                    if (textureType === Constants.TEXTURETYPE_UNSIGNED_INTEGER || textureType === Constants.TEXTURETYPE_UNSIGNED_SHORT) {\r\n                        ThinEngine._TempClearColorUint32[0] = color.r * 255;\r\n                        ThinEngine._TempClearColorUint32[1] = color.g * 255;\r\n                        ThinEngine._TempClearColorUint32[2] = color.b * 255;\r\n                        ThinEngine._TempClearColorUint32[3] = color.a * 255;\r\n                        this._gl.clearBufferuiv(this._gl.COLOR, 0, ThinEngine._TempClearColorUint32);\r\n                        setBackBufferColor = false;\r\n                    } else {\r\n                        ThinEngine._TempClearColorInt32[0] = color.r * 255;\r\n                        ThinEngine._TempClearColorInt32[1] = color.g * 255;\r\n                        ThinEngine._TempClearColorInt32[2] = color.b * 255;\r\n                        ThinEngine._TempClearColorInt32[3] = color.a * 255;\r\n                        this._gl.clearBufferiv(this._gl.COLOR, 0, ThinEngine._TempClearColorInt32);\r\n                        setBackBufferColor = false;\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (setBackBufferColor) {\r\n                this._gl.clearColor(color.r, color.g, color.b, color.a !== undefined ? color.a : 1.0);\r\n                mode |= this._gl.COLOR_BUFFER_BIT;\r\n            }\r\n        }\r\n\r\n        if (depth) {\r\n            if (this.useReverseDepthBuffer) {\r\n                this._depthCullingState.depthFunc = this._gl.GEQUAL;\r\n                this._gl.clearDepth(0.0);\r\n            } else {\r\n                this._gl.clearDepth(1.0);\r\n            }\r\n            mode |= this._gl.DEPTH_BUFFER_BIT;\r\n        }\r\n        if (stencil) {\r\n            this._gl.clearStencil(0);\r\n            mode |= this._gl.STENCIL_BUFFER_BIT;\r\n        }\r\n        this._gl.clear(mode);\r\n    }\r\n\r\n    protected _viewportCached = { x: 0, y: 0, z: 0, w: 0 };\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _viewport(x: number, y: number, width: number, height: number): void {\r\n        if (x !== this._viewportCached.x || y !== this._viewportCached.y || width !== this._viewportCached.z || height !== this._viewportCached.w) {\r\n            this._viewportCached.x = x;\r\n            this._viewportCached.y = y;\r\n            this._viewportCached.z = width;\r\n            this._viewportCached.w = height;\r\n\r\n            this._gl.viewport(x, y, width, height);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Set the WebGL's viewport\r\n     * @param viewport defines the viewport element to be used\r\n     * @param requiredWidth defines the width required for rendering. If not provided the rendering canvas' width is used\r\n     * @param requiredHeight defines the height required for rendering. If not provided the rendering canvas' height is used\r\n     */\r\n    public setViewport(viewport: IViewportLike, requiredWidth?: number, requiredHeight?: number): void {\r\n        const width = requiredWidth || this.getRenderWidth();\r\n        const height = requiredHeight || this.getRenderHeight();\r\n        const x = viewport.x || 0;\r\n        const y = viewport.y || 0;\r\n\r\n        this._cachedViewport = viewport;\r\n\r\n        this._viewport(x * width, y * height, width * viewport.width, height * viewport.height);\r\n    }\r\n\r\n    /**\r\n     * Begin a new frame\r\n     */\r\n    public beginFrame(): void {}\r\n\r\n    /**\r\n     * Enf the current frame\r\n     */\r\n    public endFrame(): void {\r\n        // Force a flush in case we are using a bad OS.\r\n        if (this._badOS) {\r\n            this.flushFramebuffer();\r\n        }\r\n        this._frameId++;\r\n    }\r\n\r\n    /**\r\n     * Resize the view according to the canvas' size\r\n     * @param forceSetSize true to force setting the sizes of the underlying canvas\r\n     */\r\n    public resize(forceSetSize = false): void {\r\n        let width: number;\r\n        let height: number;\r\n\r\n        // Re-query hardware scaling level to handle zoomed-in resizing.\r\n        if (this.adaptToDeviceRatio) {\r\n            const devicePixelRatio = IsWindowObjectExist() ? window.devicePixelRatio || 1.0 : 1.0;\r\n            const changeRatio = this._lastDevicePixelRatio / devicePixelRatio;\r\n            this._lastDevicePixelRatio = devicePixelRatio;\r\n            this._hardwareScalingLevel *= changeRatio;\r\n        }\r\n\r\n        if (IsWindowObjectExist() && IsDocumentAvailable()) {\r\n            // make sure it is a Node object, and is a part of the document.\r\n            if (this._renderingCanvas) {\r\n                const boundingRect = this._renderingCanvas.getBoundingClientRect\r\n                    ? this._renderingCanvas.getBoundingClientRect()\r\n                    : {\r\n                          // fallback to last solution in case the function doesn't exist\r\n                          width: this._renderingCanvas.width * this._hardwareScalingLevel,\r\n                          height: this._renderingCanvas.height * this._hardwareScalingLevel,\r\n                      };\r\n                width = this._renderingCanvas.clientWidth || boundingRect.width || this._renderingCanvas.width || 100;\r\n                height = this._renderingCanvas.clientHeight || boundingRect.height || this._renderingCanvas.height || 100;\r\n            } else {\r\n                width = window.innerWidth;\r\n                height = window.innerHeight;\r\n            }\r\n        } else {\r\n            width = this._renderingCanvas ? this._renderingCanvas.width : 100;\r\n            height = this._renderingCanvas ? this._renderingCanvas.height : 100;\r\n        }\r\n\r\n        this.setSize(width / this._hardwareScalingLevel, height / this._hardwareScalingLevel, forceSetSize);\r\n    }\r\n\r\n    /**\r\n     * Force a specific size of the canvas\r\n     * @param width defines the new canvas' width\r\n     * @param height defines the new canvas' height\r\n     * @param forceSetSize true to force setting the sizes of the underlying canvas\r\n     * @returns true if the size was changed\r\n     */\r\n    public setSize(width: number, height: number, forceSetSize = false): boolean {\r\n        if (!this._renderingCanvas) {\r\n            return false;\r\n        }\r\n\r\n        width = width | 0;\r\n        height = height | 0;\r\n\r\n        if (!forceSetSize && this._renderingCanvas.width === width && this._renderingCanvas.height === height) {\r\n            return false;\r\n        }\r\n\r\n        this._renderingCanvas.width = width;\r\n        this._renderingCanvas.height = height;\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Binds the frame buffer to the specified texture.\r\n     * @param rtWrapper The render target wrapper to render to\r\n     * @param faceIndex The face of the texture to render to in case of cube texture and if the render target wrapper is not a multi render target\r\n     * @param requiredWidth The width of the target to render to\r\n     * @param requiredHeight The height of the target to render to\r\n     * @param forceFullscreenViewport Forces the viewport to be the entire texture/screen if true\r\n     * @param lodLevel Defines the lod level to bind to the frame buffer\r\n     * @param layer Defines the 2d array index to bind to the frame buffer if the render target wrapper is not a multi render target\r\n     */\r\n    public bindFramebuffer(\r\n        rtWrapper: RenderTargetWrapper,\r\n        faceIndex: number = 0,\r\n        requiredWidth?: number,\r\n        requiredHeight?: number,\r\n        forceFullscreenViewport?: boolean,\r\n        lodLevel = 0,\r\n        layer = 0\r\n    ): void {\r\n        const webglRTWrapper = rtWrapper as WebGLRenderTargetWrapper;\r\n\r\n        if (this._currentRenderTarget) {\r\n            this.unBindFramebuffer(this._currentRenderTarget);\r\n        }\r\n        this._currentRenderTarget = rtWrapper;\r\n        this._bindUnboundFramebuffer(webglRTWrapper._MSAAFramebuffer ? webglRTWrapper._MSAAFramebuffer : webglRTWrapper._framebuffer);\r\n\r\n        const gl = this._gl;\r\n        if (!rtWrapper.isMulti) {\r\n            if (rtWrapper.is2DArray) {\r\n                gl.framebufferTextureLayer(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, rtWrapper.texture!._hardwareTexture?.underlyingResource, lodLevel, layer);\r\n            } else if (rtWrapper.isCube) {\r\n                gl.framebufferTexture2D(\r\n                    gl.FRAMEBUFFER,\r\n                    gl.COLOR_ATTACHMENT0,\r\n                    gl.TEXTURE_CUBE_MAP_POSITIVE_X + faceIndex,\r\n                    rtWrapper.texture!._hardwareTexture?.underlyingResource,\r\n                    lodLevel\r\n                );\r\n            } else if (webglRTWrapper._currentLOD !== lodLevel) {\r\n                gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, rtWrapper.texture!._hardwareTexture?.underlyingResource, lodLevel);\r\n                webglRTWrapper._currentLOD = lodLevel;\r\n            }\r\n        }\r\n\r\n        const depthStencilTexture = rtWrapper._depthStencilTexture;\r\n        if (depthStencilTexture) {\r\n            const attachment = rtWrapper._depthStencilTextureWithStencil ? gl.DEPTH_STENCIL_ATTACHMENT : gl.DEPTH_ATTACHMENT;\r\n            if (rtWrapper.is2DArray) {\r\n                gl.framebufferTextureLayer(gl.FRAMEBUFFER, attachment, depthStencilTexture._hardwareTexture?.underlyingResource, lodLevel, layer);\r\n            } else if (rtWrapper.isCube) {\r\n                gl.framebufferTexture2D(gl.FRAMEBUFFER, attachment, gl.TEXTURE_CUBE_MAP_POSITIVE_X + faceIndex, depthStencilTexture._hardwareTexture?.underlyingResource, lodLevel);\r\n            } else {\r\n                gl.framebufferTexture2D(gl.FRAMEBUFFER, attachment, gl.TEXTURE_2D, depthStencilTexture._hardwareTexture?.underlyingResource, lodLevel);\r\n            }\r\n        }\r\n\r\n        if (this._cachedViewport && !forceFullscreenViewport) {\r\n            this.setViewport(this._cachedViewport, requiredWidth, requiredHeight);\r\n        } else {\r\n            if (!requiredWidth) {\r\n                requiredWidth = rtWrapper.width;\r\n                if (lodLevel) {\r\n                    requiredWidth = requiredWidth / Math.pow(2, lodLevel);\r\n                }\r\n            }\r\n            if (!requiredHeight) {\r\n                requiredHeight = rtWrapper.height;\r\n                if (lodLevel) {\r\n                    requiredHeight = requiredHeight / Math.pow(2, lodLevel);\r\n                }\r\n            }\r\n\r\n            this._viewport(0, 0, requiredWidth, requiredHeight);\r\n        }\r\n\r\n        this.wipeCaches();\r\n    }\r\n\r\n    /**\r\n     * Set various states to the webGL context\r\n     * @param culling defines culling state: true to enable culling, false to disable it\r\n     * @param zOffset defines the value to apply to zOffset (0 by default)\r\n     * @param force defines if states must be applied even if cache is up to date\r\n     * @param reverseSide defines if culling must be reversed (CCW if false, CW if true)\r\n     * @param cullBackFaces true to cull back faces, false to cull front faces (if culling is enabled)\r\n     * @param stencil stencil states to set\r\n     * @param zOffsetUnits defines the value to apply to zOffsetUnits (0 by default)\r\n     */\r\n    public setState(culling: boolean, zOffset: number = 0, force?: boolean, reverseSide = false, cullBackFaces?: boolean, stencil?: IStencilState, zOffsetUnits: number = 0): void {\r\n        // Culling\r\n        if (this._depthCullingState.cull !== culling || force) {\r\n            this._depthCullingState.cull = culling;\r\n        }\r\n\r\n        // Cull face\r\n        const cullFace = this.cullBackFaces ?? cullBackFaces ?? true ? this._gl.BACK : this._gl.FRONT;\r\n        if (this._depthCullingState.cullFace !== cullFace || force) {\r\n            this._depthCullingState.cullFace = cullFace;\r\n        }\r\n\r\n        // Z offset\r\n        this.setZOffset(zOffset);\r\n        this.setZOffsetUnits(zOffsetUnits);\r\n\r\n        // Front face\r\n        const frontFace = reverseSide ? this._gl.CW : this._gl.CCW;\r\n        if (this._depthCullingState.frontFace !== frontFace || force) {\r\n            this._depthCullingState.frontFace = frontFace;\r\n        }\r\n\r\n        this._stencilStateComposer.stencilMaterial = stencil;\r\n    }\r\n\r\n    /**\r\n     * Gets a boolean indicating if depth testing is enabled\r\n     * @returns the current state\r\n     */\r\n    public getDepthBuffer(): boolean {\r\n        return this._depthCullingState.depthTest;\r\n    }\r\n\r\n    /**\r\n     * Enable or disable depth buffering\r\n     * @param enable defines the state to set\r\n     */\r\n    public setDepthBuffer(enable: boolean): void {\r\n        this._depthCullingState.depthTest = enable;\r\n    }\r\n\r\n    /**\r\n     * Set the z offset Factor to apply to current rendering\r\n     * @param value defines the offset to apply\r\n     */\r\n    public setZOffset(value: number): void {\r\n        this._depthCullingState.zOffset = this.useReverseDepthBuffer ? -value : value;\r\n    }\r\n\r\n    /**\r\n     * Gets the current value of the zOffset Factor\r\n     * @returns the current zOffset Factor state\r\n     */\r\n    public getZOffset(): number {\r\n        const zOffset = this._depthCullingState.zOffset;\r\n        return this.useReverseDepthBuffer ? -zOffset : zOffset;\r\n    }\r\n\r\n    /**\r\n     * Set the z offset Units to apply to current rendering\r\n     * @param value defines the offset to apply\r\n     */\r\n    public setZOffsetUnits(value: number): void {\r\n        this._depthCullingState.zOffsetUnits = this.useReverseDepthBuffer ? -value : value;\r\n    }\r\n\r\n    /**\r\n     * Gets the current value of the zOffset Units\r\n     * @returns the current zOffset Units state\r\n     */\r\n    public getZOffsetUnits(): number {\r\n        const zOffsetUnits = this._depthCullingState.zOffsetUnits;\r\n        return this.useReverseDepthBuffer ? -zOffsetUnits : zOffsetUnits;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _bindUnboundFramebuffer(framebuffer: Nullable<WebGLFramebuffer>) {\r\n        if (this._currentFramebuffer !== framebuffer) {\r\n            this._gl.bindFramebuffer(this._gl.FRAMEBUFFER, framebuffer);\r\n            this._currentFramebuffer = framebuffer;\r\n        }\r\n    }\r\n\r\n    /** @internal */\r\n    public _currentFrameBufferIsDefaultFrameBuffer() {\r\n        return this._currentFramebuffer === null;\r\n    }\r\n\r\n    /**\r\n     * Generates the mipmaps for a texture\r\n     * @param texture texture to generate the mipmaps for\r\n     */\r\n    public generateMipmaps(texture: InternalTexture): void {\r\n        this._bindTextureDirectly(this._gl.TEXTURE_2D, texture, true);\r\n        this._gl.generateMipmap(this._gl.TEXTURE_2D);\r\n        this._bindTextureDirectly(this._gl.TEXTURE_2D, null);\r\n    }\r\n\r\n    /**\r\n     * Unbind the current render target texture from the webGL context\r\n     * @param texture defines the render target wrapper to unbind\r\n     * @param disableGenerateMipMaps defines a boolean indicating that mipmaps must not be generated\r\n     * @param onBeforeUnbind defines a function which will be called before the effective unbind\r\n     */\r\n    public unBindFramebuffer(texture: RenderTargetWrapper, disableGenerateMipMaps = false, onBeforeUnbind?: () => void): void {\r\n        const webglRTWrapper = texture as WebGLRenderTargetWrapper;\r\n\r\n        this._currentRenderTarget = null;\r\n\r\n        // If MSAA, we need to bitblt back to main texture\r\n        const gl = this._gl;\r\n        if (webglRTWrapper._MSAAFramebuffer) {\r\n            if (texture.isMulti) {\r\n                // This texture is part of a MRT texture, we need to treat all attachments\r\n                this.unBindMultiColorAttachmentFramebuffer(texture, disableGenerateMipMaps, onBeforeUnbind);\r\n                return;\r\n            }\r\n            gl.bindFramebuffer(gl.READ_FRAMEBUFFER, webglRTWrapper._MSAAFramebuffer);\r\n            gl.bindFramebuffer(gl.DRAW_FRAMEBUFFER, webglRTWrapper._framebuffer);\r\n            gl.blitFramebuffer(0, 0, texture.width, texture.height, 0, 0, texture.width, texture.height, gl.COLOR_BUFFER_BIT, gl.NEAREST);\r\n        }\r\n\r\n        if (texture.texture?.generateMipMaps && !disableGenerateMipMaps && !texture.isCube) {\r\n            this.generateMipmaps(texture.texture);\r\n        }\r\n\r\n        if (onBeforeUnbind) {\r\n            if (webglRTWrapper._MSAAFramebuffer) {\r\n                // Bind the correct framebuffer\r\n                this._bindUnboundFramebuffer(webglRTWrapper._framebuffer);\r\n            }\r\n            onBeforeUnbind();\r\n        }\r\n\r\n        this._bindUnboundFramebuffer(null);\r\n    }\r\n\r\n    /**\r\n     * Force a webGL flush (ie. a flush of all waiting webGL commands)\r\n     */\r\n    public flushFramebuffer(): void {\r\n        this._gl.flush();\r\n    }\r\n\r\n    /**\r\n     * Unbind the current render target and bind the default framebuffer\r\n     */\r\n    public restoreDefaultFramebuffer(): void {\r\n        if (this._currentRenderTarget) {\r\n            this.unBindFramebuffer(this._currentRenderTarget);\r\n        } else {\r\n            this._bindUnboundFramebuffer(null);\r\n        }\r\n        if (this._cachedViewport) {\r\n            this.setViewport(this._cachedViewport);\r\n        }\r\n\r\n        this.wipeCaches();\r\n    }\r\n\r\n    // VBOs\r\n\r\n    /** @internal */\r\n    protected _resetVertexBufferBinding(): void {\r\n        this.bindArrayBuffer(null);\r\n        this._cachedVertexBuffers = null;\r\n    }\r\n\r\n    /**\r\n     * Creates a vertex buffer\r\n     * @param data the data or size for the vertex buffer\r\n     * @param _updatable whether the buffer should be created as updatable\r\n     * @param _label defines the label of the buffer (for debug purpose)\r\n     * @returns the new WebGL static buffer\r\n     */\r\n    public createVertexBuffer(data: DataArray | number, _updatable?: boolean, _label?: string): DataBuffer {\r\n        return this._createVertexBuffer(data, this._gl.STATIC_DRAW);\r\n    }\r\n\r\n    private _createVertexBuffer(data: DataArray | number, usage: number): DataBuffer {\r\n        const vbo = this._gl.createBuffer();\r\n\r\n        if (!vbo) {\r\n            throw new Error(\"Unable to create vertex buffer\");\r\n        }\r\n\r\n        const dataBuffer = new WebGLDataBuffer(vbo);\r\n        this.bindArrayBuffer(dataBuffer);\r\n\r\n        if (typeof data !== \"number\") {\r\n            if (data instanceof Array) {\r\n                this._gl.bufferData(this._gl.ARRAY_BUFFER, new Float32Array(data), usage);\r\n                dataBuffer.capacity = data.length * 4;\r\n            } else {\r\n                this._gl.bufferData(this._gl.ARRAY_BUFFER, <ArrayBuffer>data, usage);\r\n                dataBuffer.capacity = data.byteLength;\r\n            }\r\n        } else {\r\n            this._gl.bufferData(this._gl.ARRAY_BUFFER, new Uint8Array(data), usage);\r\n            dataBuffer.capacity = data;\r\n        }\r\n\r\n        this._resetVertexBufferBinding();\r\n\r\n        dataBuffer.references = 1;\r\n        return dataBuffer;\r\n    }\r\n\r\n    /**\r\n     * Creates a dynamic vertex buffer\r\n     * @param data the data for the dynamic vertex buffer\r\n     * @param _label defines the label of the buffer (for debug purpose)\r\n     * @returns the new WebGL dynamic buffer\r\n     */\r\n    public createDynamicVertexBuffer(data: DataArray | number, _label?: string): DataBuffer {\r\n        return this._createVertexBuffer(data, this._gl.DYNAMIC_DRAW);\r\n    }\r\n\r\n    protected _resetIndexBufferBinding(): void {\r\n        this.bindIndexBuffer(null);\r\n        this._cachedIndexBuffer = null;\r\n    }\r\n\r\n    /**\r\n     * Creates a new index buffer\r\n     * @param indices defines the content of the index buffer\r\n     * @param updatable defines if the index buffer must be updatable\r\n     * @param _label defines the label of the buffer (for debug purpose)\r\n     * @returns a new webGL buffer\r\n     */\r\n    public createIndexBuffer(indices: IndicesArray, updatable?: boolean, _label?: string): DataBuffer {\r\n        const vbo = this._gl.createBuffer();\r\n        const dataBuffer = new WebGLDataBuffer(vbo!);\r\n\r\n        if (!vbo) {\r\n            throw new Error(\"Unable to create index buffer\");\r\n        }\r\n\r\n        this.bindIndexBuffer(dataBuffer);\r\n\r\n        const data = this._normalizeIndexData(indices);\r\n        this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER, data, updatable ? this._gl.DYNAMIC_DRAW : this._gl.STATIC_DRAW);\r\n        this._resetIndexBufferBinding();\r\n        dataBuffer.references = 1;\r\n        dataBuffer.is32Bits = data.BYTES_PER_ELEMENT === 4;\r\n        return dataBuffer;\r\n    }\r\n\r\n    protected _normalizeIndexData(indices: IndicesArray): Uint16Array | Uint32Array {\r\n        const bytesPerElement = (indices as Exclude<IndicesArray, number[]>).BYTES_PER_ELEMENT;\r\n        if (bytesPerElement === 2) {\r\n            return indices as Uint16Array;\r\n        }\r\n\r\n        // Check 32 bit support\r\n        if (this._caps.uintIndices) {\r\n            if (indices instanceof Uint32Array) {\r\n                return indices;\r\n            } else {\r\n                // number[] or Int32Array, check if 32 bit is necessary\r\n                for (let index = 0; index < indices.length; index++) {\r\n                    if (indices[index] >= 65535) {\r\n                        return new Uint32Array(indices);\r\n                    }\r\n                }\r\n\r\n                return new Uint16Array(indices);\r\n            }\r\n        }\r\n\r\n        // No 32 bit support, force conversion to 16 bit (values greater 16 bit are lost)\r\n        return new Uint16Array(indices);\r\n    }\r\n\r\n    /**\r\n     * Bind a webGL buffer to the webGL context\r\n     * @param buffer defines the buffer to bind\r\n     */\r\n    public bindArrayBuffer(buffer: Nullable<DataBuffer>): void {\r\n        if (!this._vaoRecordInProgress) {\r\n            this._unbindVertexArrayObject();\r\n        }\r\n        this._bindBuffer(buffer, this._gl.ARRAY_BUFFER);\r\n    }\r\n\r\n    /**\r\n     * Bind a specific block at a given index in a specific shader program\r\n     * @param pipelineContext defines the pipeline context to use\r\n     * @param blockName defines the block name\r\n     * @param index defines the index where to bind the block\r\n     */\r\n    public bindUniformBlock(pipelineContext: IPipelineContext, blockName: string, index: number): void {\r\n        const program = (pipelineContext as WebGLPipelineContext).program!;\r\n\r\n        const uniformLocation = this._gl.getUniformBlockIndex(program, blockName);\r\n\r\n        this._gl.uniformBlockBinding(program, uniformLocation, index);\r\n    }\r\n\r\n    // eslint-disable-next-line @typescript-eslint/naming-convention\r\n    protected bindIndexBuffer(buffer: Nullable<DataBuffer>): void {\r\n        if (!this._vaoRecordInProgress) {\r\n            this._unbindVertexArrayObject();\r\n        }\r\n        this._bindBuffer(buffer, this._gl.ELEMENT_ARRAY_BUFFER);\r\n    }\r\n\r\n    private _bindBuffer(buffer: Nullable<DataBuffer>, target: number): void {\r\n        if (this._vaoRecordInProgress || this._currentBoundBuffer[target] !== buffer) {\r\n            this._gl.bindBuffer(target, buffer ? buffer.underlyingResource : null);\r\n            this._currentBoundBuffer[target] = buffer;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * update the bound buffer with the given data\r\n     * @param data defines the data to update\r\n     */\r\n    public updateArrayBuffer(data: Float32Array): void {\r\n        this._gl.bufferSubData(this._gl.ARRAY_BUFFER, 0, data);\r\n    }\r\n\r\n    private _vertexAttribPointer(buffer: DataBuffer, indx: number, size: number, type: number, normalized: boolean, stride: number, offset: number): void {\r\n        const pointer = this._currentBufferPointers[indx];\r\n        if (!pointer) {\r\n            return;\r\n        }\r\n\r\n        let changed = false;\r\n        if (!pointer.active) {\r\n            changed = true;\r\n            pointer.active = true;\r\n            pointer.index = indx;\r\n            pointer.size = size;\r\n            pointer.type = type;\r\n            pointer.normalized = normalized;\r\n            pointer.stride = stride;\r\n            pointer.offset = offset;\r\n            pointer.buffer = buffer;\r\n        } else {\r\n            if (pointer.buffer !== buffer) {\r\n                pointer.buffer = buffer;\r\n                changed = true;\r\n            }\r\n            if (pointer.size !== size) {\r\n                pointer.size = size;\r\n                changed = true;\r\n            }\r\n            if (pointer.type !== type) {\r\n                pointer.type = type;\r\n                changed = true;\r\n            }\r\n            if (pointer.normalized !== normalized) {\r\n                pointer.normalized = normalized;\r\n                changed = true;\r\n            }\r\n            if (pointer.stride !== stride) {\r\n                pointer.stride = stride;\r\n                changed = true;\r\n            }\r\n            if (pointer.offset !== offset) {\r\n                pointer.offset = offset;\r\n                changed = true;\r\n            }\r\n        }\r\n\r\n        if (changed || this._vaoRecordInProgress) {\r\n            this.bindArrayBuffer(buffer);\r\n            if (type === this._gl.UNSIGNED_INT || type === this._gl.INT) {\r\n                this._gl.vertexAttribIPointer(indx, size, type, stride, offset);\r\n            } else {\r\n                this._gl.vertexAttribPointer(indx, size, type, normalized, stride, offset);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _bindIndexBufferWithCache(indexBuffer: Nullable<DataBuffer>): void {\r\n        if (indexBuffer == null) {\r\n            return;\r\n        }\r\n        if (this._cachedIndexBuffer !== indexBuffer) {\r\n            this._cachedIndexBuffer = indexBuffer;\r\n            this.bindIndexBuffer(indexBuffer);\r\n            this._uintIndicesCurrentlySet = indexBuffer.is32Bits;\r\n        }\r\n    }\r\n\r\n    private _bindVertexBuffersAttributes(\r\n        vertexBuffers: { [key: string]: Nullable<VertexBuffer> },\r\n        effect: Effect,\r\n        overrideVertexBuffers?: { [kind: string]: Nullable<VertexBuffer> }\r\n    ): void {\r\n        const attributes = effect.getAttributesNames();\r\n\r\n        if (!this._vaoRecordInProgress) {\r\n            this._unbindVertexArrayObject();\r\n        }\r\n\r\n        this.unbindAllAttributes();\r\n\r\n        for (let index = 0; index < attributes.length; index++) {\r\n            const order = effect.getAttributeLocation(index);\r\n\r\n            if (order >= 0) {\r\n                const ai = attributes[index];\r\n                let vertexBuffer: Nullable<VertexBuffer> = null;\r\n\r\n                if (overrideVertexBuffers) {\r\n                    vertexBuffer = overrideVertexBuffers[ai];\r\n                }\r\n\r\n                if (!vertexBuffer) {\r\n                    vertexBuffer = vertexBuffers[ai];\r\n                }\r\n\r\n                if (!vertexBuffer) {\r\n                    continue;\r\n                }\r\n\r\n                this._gl.enableVertexAttribArray(order);\r\n                if (!this._vaoRecordInProgress) {\r\n                    this._vertexAttribArraysEnabled[order] = true;\r\n                }\r\n\r\n                const buffer = vertexBuffer.getBuffer();\r\n                if (buffer) {\r\n                    this._vertexAttribPointer(buffer, order, vertexBuffer.getSize(), vertexBuffer.type, vertexBuffer.normalized, vertexBuffer.byteStride, vertexBuffer.byteOffset);\r\n\r\n                    if (vertexBuffer.getIsInstanced()) {\r\n                        this._gl.vertexAttribDivisor(order, vertexBuffer.getInstanceDivisor());\r\n                        if (!this._vaoRecordInProgress) {\r\n                            this._currentInstanceLocations.push(order);\r\n                            this._currentInstanceBuffers.push(buffer);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Records a vertex array object\r\n     * @see https://doc.babylonjs.com/setup/support/webGL2#vertex-array-objects\r\n     * @param vertexBuffers defines the list of vertex buffers to store\r\n     * @param indexBuffer defines the index buffer to store\r\n     * @param effect defines the effect to store\r\n     * @param overrideVertexBuffers defines optional list of avertex buffers that overrides the entries in vertexBuffers\r\n     * @returns the new vertex array object\r\n     */\r\n    public recordVertexArrayObject(\r\n        vertexBuffers: { [key: string]: VertexBuffer },\r\n        indexBuffer: Nullable<DataBuffer>,\r\n        effect: Effect,\r\n        overrideVertexBuffers?: { [kind: string]: Nullable<VertexBuffer> }\r\n    ): WebGLVertexArrayObject {\r\n        const vao = this._gl.createVertexArray();\r\n\r\n        if (!vao) {\r\n            throw new Error(\"Unable to create VAO\");\r\n        }\r\n\r\n        this._vaoRecordInProgress = true;\r\n\r\n        this._gl.bindVertexArray(vao);\r\n\r\n        this._mustWipeVertexAttributes = true;\r\n        this._bindVertexBuffersAttributes(vertexBuffers, effect, overrideVertexBuffers);\r\n\r\n        this.bindIndexBuffer(indexBuffer);\r\n\r\n        this._vaoRecordInProgress = false;\r\n        this._gl.bindVertexArray(null);\r\n\r\n        return vao;\r\n    }\r\n\r\n    /**\r\n     * Bind a specific vertex array object\r\n     * @see https://doc.babylonjs.com/setup/support/webGL2#vertex-array-objects\r\n     * @param vertexArrayObject defines the vertex array object to bind\r\n     * @param indexBuffer defines the index buffer to bind\r\n     */\r\n    public bindVertexArrayObject(vertexArrayObject: WebGLVertexArrayObject, indexBuffer: Nullable<DataBuffer>): void {\r\n        if (this._cachedVertexArrayObject !== vertexArrayObject) {\r\n            this._cachedVertexArrayObject = vertexArrayObject;\r\n\r\n            this._gl.bindVertexArray(vertexArrayObject);\r\n            this._cachedVertexBuffers = null;\r\n            this._cachedIndexBuffer = null;\r\n\r\n            this._uintIndicesCurrentlySet = indexBuffer != null && indexBuffer.is32Bits;\r\n            this._mustWipeVertexAttributes = true;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Bind webGl buffers directly to the webGL context\r\n     * @param vertexBuffer defines the vertex buffer to bind\r\n     * @param indexBuffer defines the index buffer to bind\r\n     * @param vertexDeclaration defines the vertex declaration to use with the vertex buffer\r\n     * @param vertexStrideSize defines the vertex stride of the vertex buffer\r\n     * @param effect defines the effect associated with the vertex buffer\r\n     */\r\n    public bindBuffersDirectly(vertexBuffer: DataBuffer, indexBuffer: DataBuffer, vertexDeclaration: number[], vertexStrideSize: number, effect: Effect): void {\r\n        if (this._cachedVertexBuffers !== vertexBuffer || this._cachedEffectForVertexBuffers !== effect) {\r\n            this._cachedVertexBuffers = vertexBuffer;\r\n            this._cachedEffectForVertexBuffers = effect;\r\n\r\n            const attributesCount = effect.getAttributesCount();\r\n\r\n            this._unbindVertexArrayObject();\r\n            this.unbindAllAttributes();\r\n\r\n            let offset = 0;\r\n            for (let index = 0; index < attributesCount; index++) {\r\n                if (index < vertexDeclaration.length) {\r\n                    const order = effect.getAttributeLocation(index);\r\n\r\n                    if (order >= 0) {\r\n                        this._gl.enableVertexAttribArray(order);\r\n                        this._vertexAttribArraysEnabled[order] = true;\r\n                        this._vertexAttribPointer(vertexBuffer, order, vertexDeclaration[index], this._gl.FLOAT, false, vertexStrideSize, offset);\r\n                    }\r\n\r\n                    offset += vertexDeclaration[index] * 4;\r\n                }\r\n            }\r\n        }\r\n\r\n        this._bindIndexBufferWithCache(indexBuffer);\r\n    }\r\n\r\n    private _unbindVertexArrayObject(): void {\r\n        if (!this._cachedVertexArrayObject) {\r\n            return;\r\n        }\r\n\r\n        this._cachedVertexArrayObject = null;\r\n        this._gl.bindVertexArray(null);\r\n    }\r\n\r\n    /**\r\n     * Bind a list of vertex buffers to the webGL context\r\n     * @param vertexBuffers defines the list of vertex buffers to bind\r\n     * @param indexBuffer defines the index buffer to bind\r\n     * @param effect defines the effect associated with the vertex buffers\r\n     * @param overrideVertexBuffers defines optional list of avertex buffers that overrides the entries in vertexBuffers\r\n     */\r\n    public bindBuffers(\r\n        vertexBuffers: { [key: string]: Nullable<VertexBuffer> },\r\n        indexBuffer: Nullable<DataBuffer>,\r\n        effect: Effect,\r\n        overrideVertexBuffers?: { [kind: string]: Nullable<VertexBuffer> }\r\n    ): void {\r\n        if (this._cachedVertexBuffers !== vertexBuffers || this._cachedEffectForVertexBuffers !== effect) {\r\n            this._cachedVertexBuffers = vertexBuffers;\r\n            this._cachedEffectForVertexBuffers = effect;\r\n\r\n            this._bindVertexBuffersAttributes(vertexBuffers, effect, overrideVertexBuffers);\r\n        }\r\n\r\n        this._bindIndexBufferWithCache(indexBuffer);\r\n    }\r\n\r\n    /**\r\n     * Unbind all instance attributes\r\n     */\r\n    public unbindInstanceAttributes() {\r\n        let boundBuffer;\r\n        for (let i = 0, ul = this._currentInstanceLocations.length; i < ul; i++) {\r\n            const instancesBuffer = this._currentInstanceBuffers[i];\r\n            if (boundBuffer != instancesBuffer && instancesBuffer.references) {\r\n                boundBuffer = instancesBuffer;\r\n                this.bindArrayBuffer(instancesBuffer);\r\n            }\r\n            const offsetLocation = this._currentInstanceLocations[i];\r\n            this._gl.vertexAttribDivisor(offsetLocation, 0);\r\n        }\r\n        this._currentInstanceBuffers.length = 0;\r\n        this._currentInstanceLocations.length = 0;\r\n    }\r\n\r\n    /**\r\n     * Release and free the memory of a vertex array object\r\n     * @param vao defines the vertex array object to delete\r\n     */\r\n    public releaseVertexArrayObject(vao: WebGLVertexArrayObject) {\r\n        this._gl.deleteVertexArray(vao);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _releaseBuffer(buffer: DataBuffer): boolean {\r\n        buffer.references--;\r\n\r\n        if (buffer.references === 0) {\r\n            this._deleteBuffer(buffer);\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    protected _deleteBuffer(buffer: DataBuffer): void {\r\n        this._gl.deleteBuffer(buffer.underlyingResource);\r\n    }\r\n\r\n    /**\r\n     * Update the content of a webGL buffer used with instantiation and bind it to the webGL context\r\n     * @param instancesBuffer defines the webGL buffer to update and bind\r\n     * @param data defines the data to store in the buffer\r\n     * @param offsetLocations defines the offsets or attributes information used to determine where data must be stored in the buffer\r\n     */\r\n    public updateAndBindInstancesBuffer(instancesBuffer: DataBuffer, data: Float32Array, offsetLocations: number[] | InstancingAttributeInfo[]): void {\r\n        this.bindArrayBuffer(instancesBuffer);\r\n        if (data) {\r\n            this._gl.bufferSubData(this._gl.ARRAY_BUFFER, 0, data);\r\n        }\r\n\r\n        if ((<any>offsetLocations[0]).index !== undefined) {\r\n            this.bindInstancesBuffer(instancesBuffer, offsetLocations as any, true);\r\n        } else {\r\n            for (let index = 0; index < 4; index++) {\r\n                const offsetLocation = <number>offsetLocations[index];\r\n\r\n                if (!this._vertexAttribArraysEnabled[offsetLocation]) {\r\n                    this._gl.enableVertexAttribArray(offsetLocation);\r\n                    this._vertexAttribArraysEnabled[offsetLocation] = true;\r\n                }\r\n\r\n                this._vertexAttribPointer(instancesBuffer, offsetLocation, 4, this._gl.FLOAT, false, 64, index * 16);\r\n                this._gl.vertexAttribDivisor(offsetLocation, 1);\r\n                this._currentInstanceLocations.push(offsetLocation);\r\n                this._currentInstanceBuffers.push(instancesBuffer);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Bind the content of a webGL buffer used with instantiation\r\n     * @param instancesBuffer defines the webGL buffer to bind\r\n     * @param attributesInfo defines the offsets or attributes information used to determine where data must be stored in the buffer\r\n     * @param computeStride defines Whether to compute the strides from the info or use the default 0\r\n     */\r\n    public bindInstancesBuffer(instancesBuffer: DataBuffer, attributesInfo: InstancingAttributeInfo[], computeStride = true): void {\r\n        this.bindArrayBuffer(instancesBuffer);\r\n\r\n        let stride = 0;\r\n        if (computeStride) {\r\n            for (let i = 0; i < attributesInfo.length; i++) {\r\n                const ai = attributesInfo[i];\r\n                stride += ai.attributeSize * 4;\r\n            }\r\n        }\r\n\r\n        for (let i = 0; i < attributesInfo.length; i++) {\r\n            const ai = attributesInfo[i];\r\n            if (ai.index === undefined) {\r\n                ai.index = this._currentEffect!.getAttributeLocationByName(ai.attributeName);\r\n            }\r\n\r\n            if (ai.index < 0) {\r\n                continue;\r\n            }\r\n\r\n            if (!this._vertexAttribArraysEnabled[ai.index]) {\r\n                this._gl.enableVertexAttribArray(ai.index);\r\n                this._vertexAttribArraysEnabled[ai.index] = true;\r\n            }\r\n\r\n            this._vertexAttribPointer(instancesBuffer, ai.index, ai.attributeSize, ai.attributeType || this._gl.FLOAT, ai.normalized || false, stride, ai.offset);\r\n            this._gl.vertexAttribDivisor(ai.index, ai.divisor === undefined ? 1 : ai.divisor);\r\n            this._currentInstanceLocations.push(ai.index);\r\n            this._currentInstanceBuffers.push(instancesBuffer);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Disable the instance attribute corresponding to the name in parameter\r\n     * @param name defines the name of the attribute to disable\r\n     */\r\n    public disableInstanceAttributeByName(name: string) {\r\n        if (!this._currentEffect) {\r\n            return;\r\n        }\r\n\r\n        const attributeLocation = this._currentEffect.getAttributeLocationByName(name);\r\n        this.disableInstanceAttribute(attributeLocation);\r\n    }\r\n\r\n    /**\r\n     * Disable the instance attribute corresponding to the location in parameter\r\n     * @param attributeLocation defines the attribute location of the attribute to disable\r\n     */\r\n    public disableInstanceAttribute(attributeLocation: number) {\r\n        let shouldClean = false;\r\n        let index: number;\r\n        while ((index = this._currentInstanceLocations.indexOf(attributeLocation)) !== -1) {\r\n            this._currentInstanceLocations.splice(index, 1);\r\n            this._currentInstanceBuffers.splice(index, 1);\r\n\r\n            shouldClean = true;\r\n            index = this._currentInstanceLocations.indexOf(attributeLocation);\r\n        }\r\n\r\n        if (shouldClean) {\r\n            this._gl.vertexAttribDivisor(attributeLocation, 0);\r\n            this.disableAttributeByIndex(attributeLocation);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Disable the attribute corresponding to the location in parameter\r\n     * @param attributeLocation defines the attribute location of the attribute to disable\r\n     */\r\n    public disableAttributeByIndex(attributeLocation: number) {\r\n        this._gl.disableVertexAttribArray(attributeLocation);\r\n        this._vertexAttribArraysEnabled[attributeLocation] = false;\r\n        this._currentBufferPointers[attributeLocation].active = false;\r\n    }\r\n\r\n    /**\r\n     * Send a draw order\r\n     * @param useTriangles defines if triangles must be used to draw (else wireframe will be used)\r\n     * @param indexStart defines the starting index\r\n     * @param indexCount defines the number of index to draw\r\n     * @param instancesCount defines the number of instances to draw (if instantiation is enabled)\r\n     */\r\n    public draw(useTriangles: boolean, indexStart: number, indexCount: number, instancesCount?: number): void {\r\n        this.drawElementsType(useTriangles ? Constants.MATERIAL_TriangleFillMode : Constants.MATERIAL_WireFrameFillMode, indexStart, indexCount, instancesCount);\r\n    }\r\n\r\n    /**\r\n     * Draw a list of points\r\n     * @param verticesStart defines the index of first vertex to draw\r\n     * @param verticesCount defines the count of vertices to draw\r\n     * @param instancesCount defines the number of instances to draw (if instantiation is enabled)\r\n     */\r\n    public drawPointClouds(verticesStart: number, verticesCount: number, instancesCount?: number): void {\r\n        this.drawArraysType(Constants.MATERIAL_PointFillMode, verticesStart, verticesCount, instancesCount);\r\n    }\r\n\r\n    /**\r\n     * Draw a list of unindexed primitives\r\n     * @param useTriangles defines if triangles must be used to draw (else wireframe will be used)\r\n     * @param verticesStart defines the index of first vertex to draw\r\n     * @param verticesCount defines the count of vertices to draw\r\n     * @param instancesCount defines the number of instances to draw (if instantiation is enabled)\r\n     */\r\n    public drawUnIndexed(useTriangles: boolean, verticesStart: number, verticesCount: number, instancesCount?: number): void {\r\n        this.drawArraysType(useTriangles ? Constants.MATERIAL_TriangleFillMode : Constants.MATERIAL_WireFrameFillMode, verticesStart, verticesCount, instancesCount);\r\n    }\r\n\r\n    /**\r\n     * Draw a list of indexed primitives\r\n     * @param fillMode defines the primitive to use\r\n     * @param indexStart defines the starting index\r\n     * @param indexCount defines the number of index to draw\r\n     * @param instancesCount defines the number of instances to draw (if instantiation is enabled)\r\n     */\r\n    public drawElementsType(fillMode: number, indexStart: number, indexCount: number, instancesCount?: number): void {\r\n        // Apply states\r\n        this.applyStates();\r\n\r\n        this._reportDrawCall();\r\n\r\n        // Render\r\n\r\n        const drawMode = this._drawMode(fillMode);\r\n        const indexFormat = this._uintIndicesCurrentlySet ? this._gl.UNSIGNED_INT : this._gl.UNSIGNED_SHORT;\r\n        const mult = this._uintIndicesCurrentlySet ? 4 : 2;\r\n        if (instancesCount) {\r\n            this._gl.drawElementsInstanced(drawMode, indexCount, indexFormat, indexStart * mult, instancesCount);\r\n        } else {\r\n            this._gl.drawElements(drawMode, indexCount, indexFormat, indexStart * mult);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Draw a list of unindexed primitives\r\n     * @param fillMode defines the primitive to use\r\n     * @param verticesStart defines the index of first vertex to draw\r\n     * @param verticesCount defines the count of vertices to draw\r\n     * @param instancesCount defines the number of instances to draw (if instantiation is enabled)\r\n     */\r\n    public drawArraysType(fillMode: number, verticesStart: number, verticesCount: number, instancesCount?: number): void {\r\n        // Apply states\r\n        this.applyStates();\r\n\r\n        this._reportDrawCall();\r\n\r\n        const drawMode = this._drawMode(fillMode);\r\n        if (instancesCount) {\r\n            this._gl.drawArraysInstanced(drawMode, verticesStart, verticesCount, instancesCount);\r\n        } else {\r\n            this._gl.drawArrays(drawMode, verticesStart, verticesCount);\r\n        }\r\n    }\r\n\r\n    private _drawMode(fillMode: number): number {\r\n        switch (fillMode) {\r\n            // Triangle views\r\n            case Constants.MATERIAL_TriangleFillMode:\r\n                return this._gl.TRIANGLES;\r\n            case Constants.MATERIAL_PointFillMode:\r\n                return this._gl.POINTS;\r\n            case Constants.MATERIAL_WireFrameFillMode:\r\n                return this._gl.LINES;\r\n            // Draw modes\r\n            case Constants.MATERIAL_PointListDrawMode:\r\n                return this._gl.POINTS;\r\n            case Constants.MATERIAL_LineListDrawMode:\r\n                return this._gl.LINES;\r\n            case Constants.MATERIAL_LineLoopDrawMode:\r\n                return this._gl.LINE_LOOP;\r\n            case Constants.MATERIAL_LineStripDrawMode:\r\n                return this._gl.LINE_STRIP;\r\n            case Constants.MATERIAL_TriangleStripDrawMode:\r\n                return this._gl.TRIANGLE_STRIP;\r\n            case Constants.MATERIAL_TriangleFanDrawMode:\r\n                return this._gl.TRIANGLE_FAN;\r\n            default:\r\n                return this._gl.TRIANGLES;\r\n        }\r\n    }\r\n\r\n    /** @internal */\r\n    protected _reportDrawCall() {\r\n        // Will be implemented by children\r\n    }\r\n\r\n    // Shaders\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _releaseEffect(effect: Effect): void {\r\n        if (this._compiledEffects[effect._key]) {\r\n            delete this._compiledEffects[effect._key];\r\n        }\r\n        const pipelineContext = effect.getPipelineContext();\r\n        if (pipelineContext) {\r\n            this._deletePipelineContext(pipelineContext);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _deletePipelineContext(pipelineContext: IPipelineContext): void {\r\n        const webGLPipelineContext = pipelineContext as WebGLPipelineContext;\r\n        if (webGLPipelineContext && webGLPipelineContext.program) {\r\n            webGLPipelineContext.program.__SPECTOR_rebuildProgram = null;\r\n\r\n            this._gl.deleteProgram(webGLPipelineContext.program);\r\n        }\r\n    }\r\n\r\n    /** @internal */\r\n    public _getGlobalDefines(defines?: { [key: string]: string }): string | undefined {\r\n        if (defines) {\r\n            if (this.isNDCHalfZRange) {\r\n                defines[\"IS_NDC_HALF_ZRANGE\"] = \"\";\r\n            } else {\r\n                delete defines[\"IS_NDC_HALF_ZRANGE\"];\r\n            }\r\n            if (this.useReverseDepthBuffer) {\r\n                defines[\"USE_REVERSE_DEPTHBUFFER\"] = \"\";\r\n            } else {\r\n                delete defines[\"USE_REVERSE_DEPTHBUFFER\"];\r\n            }\r\n            if (this.useExactSrgbConversions) {\r\n                defines[\"USE_EXACT_SRGB_CONVERSIONS\"] = \"\";\r\n            } else {\r\n                delete defines[\"USE_EXACT_SRGB_CONVERSIONS\"];\r\n            }\r\n            return;\r\n        } else {\r\n            let s = \"\";\r\n            if (this.isNDCHalfZRange) {\r\n                s += \"#define IS_NDC_HALF_ZRANGE\";\r\n            }\r\n            if (this.useReverseDepthBuffer) {\r\n                if (s) {\r\n                    s += \"\\n\";\r\n                }\r\n                s += \"#define USE_REVERSE_DEPTHBUFFER\";\r\n            }\r\n            if (this.useExactSrgbConversions) {\r\n                if (s) {\r\n                    s += \"\\n\";\r\n                }\r\n                s += \"#define USE_EXACT_SRGB_CONVERSIONS\";\r\n            }\r\n            return s;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Create a new effect (used to store vertex/fragment shaders)\r\n     * @param baseName defines the base name of the effect (The name of file without .fragment.fx or .vertex.fx)\r\n     * @param attributesNamesOrOptions defines either a list of attribute names or an IEffectCreationOptions object\r\n     * @param uniformsNamesOrEngine defines either a list of uniform names or the engine to use\r\n     * @param samplers defines an array of string used to represent textures\r\n     * @param defines defines the string containing the defines to use to compile the shaders\r\n     * @param fallbacks defines the list of potential fallbacks to use if shader compilation fails\r\n     * @param onCompiled defines a function to call when the effect creation is successful\r\n     * @param onError defines a function to call when the effect creation has failed\r\n     * @param indexParameters defines an object containing the index values to use to compile shaders (like the maximum number of simultaneous lights)\r\n     * @param shaderLanguage the language the shader is written in (default: GLSL)\r\n     * @returns the new Effect\r\n     */\r\n    public createEffect(\r\n        baseName: any,\r\n        attributesNamesOrOptions: string[] | IEffectCreationOptions,\r\n        uniformsNamesOrEngine: string[] | ThinEngine,\r\n        samplers?: string[],\r\n        defines?: string,\r\n        fallbacks?: IEffectFallbacks,\r\n        onCompiled?: Nullable<(effect: Effect) => void>,\r\n        onError?: Nullable<(effect: Effect, errors: string) => void>,\r\n        indexParameters?: any,\r\n        shaderLanguage = ShaderLanguage.GLSL\r\n    ): Effect {\r\n        const vertex = baseName.vertexElement || baseName.vertex || baseName.vertexToken || baseName.vertexSource || baseName;\r\n        const fragment = baseName.fragmentElement || baseName.fragment || baseName.fragmentToken || baseName.fragmentSource || baseName;\r\n        const globalDefines = this._getGlobalDefines()!;\r\n\r\n        let fullDefines = defines ?? (<IEffectCreationOptions>attributesNamesOrOptions).defines ?? \"\";\r\n\r\n        if (globalDefines) {\r\n            fullDefines += globalDefines;\r\n        }\r\n\r\n        const name = vertex + \"+\" + fragment + \"@\" + fullDefines;\r\n        if (this._compiledEffects[name]) {\r\n            const compiledEffect = <Effect>this._compiledEffects[name];\r\n            if (onCompiled && compiledEffect.isReady()) {\r\n                onCompiled(compiledEffect);\r\n            }\r\n\r\n            return compiledEffect;\r\n        }\r\n        const effect = new Effect(\r\n            baseName,\r\n            attributesNamesOrOptions,\r\n            uniformsNamesOrEngine,\r\n            samplers,\r\n            this,\r\n            defines,\r\n            fallbacks,\r\n            onCompiled,\r\n            onError,\r\n            indexParameters,\r\n            name,\r\n            shaderLanguage\r\n        );\r\n        this._compiledEffects[name] = effect;\r\n\r\n        return effect;\r\n    }\r\n\r\n    // eslint-disable-next-line @typescript-eslint/naming-convention\r\n    protected static _ConcatenateShader(source: string, defines: Nullable<string>, shaderVersion: string = \"\"): string {\r\n        return shaderVersion + (defines ? defines + \"\\n\" : \"\") + source;\r\n    }\r\n\r\n    private _compileShader(source: string, type: string, defines: Nullable<string>, shaderVersion: string): WebGLShader {\r\n        return this._compileRawShader(ThinEngine._ConcatenateShader(source, defines, shaderVersion), type);\r\n    }\r\n\r\n    private _compileRawShader(source: string, type: string): WebGLShader {\r\n        const gl = this._gl;\r\n\r\n        const shader = gl.createShader(type === \"vertex\" ? gl.VERTEX_SHADER : gl.FRAGMENT_SHADER);\r\n\r\n        if (!shader) {\r\n            let error: GLenum = gl.NO_ERROR;\r\n            let tempError: GLenum = gl.NO_ERROR;\r\n            while ((tempError = gl.getError()) !== gl.NO_ERROR) {\r\n                error = tempError;\r\n            }\r\n\r\n            throw new Error(\r\n                `Something went wrong while creating a gl ${type} shader object. gl error=${error}, gl isContextLost=${gl.isContextLost()}, _contextWasLost=${this._contextWasLost}`\r\n            );\r\n        }\r\n\r\n        gl.shaderSource(shader, source);\r\n        gl.compileShader(shader);\r\n\r\n        return shader;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _getShaderSource(shader: WebGLShader): Nullable<string> {\r\n        return this._gl.getShaderSource(shader);\r\n    }\r\n\r\n    /**\r\n     * Directly creates a webGL program\r\n     * @param pipelineContext  defines the pipeline context to attach to\r\n     * @param vertexCode defines the vertex shader code to use\r\n     * @param fragmentCode defines the fragment shader code to use\r\n     * @param context defines the webGL context to use (if not set, the current one will be used)\r\n     * @param transformFeedbackVaryings defines the list of transform feedback varyings to use\r\n     * @returns the new webGL program\r\n     */\r\n    public createRawShaderProgram(\r\n        pipelineContext: IPipelineContext,\r\n        vertexCode: string,\r\n        fragmentCode: string,\r\n        context?: WebGLRenderingContext,\r\n        transformFeedbackVaryings: Nullable<string[]> = null\r\n    ): WebGLProgram {\r\n        context = context || this._gl;\r\n\r\n        const vertexShader = this._compileRawShader(vertexCode, \"vertex\");\r\n        const fragmentShader = this._compileRawShader(fragmentCode, \"fragment\");\r\n\r\n        return this._createShaderProgram(pipelineContext as WebGLPipelineContext, vertexShader, fragmentShader, context, transformFeedbackVaryings);\r\n    }\r\n\r\n    /**\r\n     * Creates a webGL program\r\n     * @param pipelineContext  defines the pipeline context to attach to\r\n     * @param vertexCode  defines the vertex shader code to use\r\n     * @param fragmentCode defines the fragment shader code to use\r\n     * @param defines defines the string containing the defines to use to compile the shaders\r\n     * @param context defines the webGL context to use (if not set, the current one will be used)\r\n     * @param transformFeedbackVaryings defines the list of transform feedback varyings to use\r\n     * @returns the new webGL program\r\n     */\r\n    public createShaderProgram(\r\n        pipelineContext: IPipelineContext,\r\n        vertexCode: string,\r\n        fragmentCode: string,\r\n        defines: Nullable<string>,\r\n        context?: WebGLRenderingContext,\r\n        transformFeedbackVaryings: Nullable<string[]> = null\r\n    ): WebGLProgram {\r\n        context = context || this._gl;\r\n\r\n        const shaderVersion = this._webGLVersion > 1 ? \"#version 300 es\\n#define WEBGL2 \\n\" : \"\";\r\n        const vertexShader = this._compileShader(vertexCode, \"vertex\", defines, shaderVersion);\r\n        const fragmentShader = this._compileShader(fragmentCode, \"fragment\", defines, shaderVersion);\r\n\r\n        return this._createShaderProgram(pipelineContext as WebGLPipelineContext, vertexShader, fragmentShader, context, transformFeedbackVaryings);\r\n    }\r\n\r\n    /**\r\n     * Inline functions in shader code that are marked to be inlined\r\n     * @param code code to inline\r\n     * @returns inlined code\r\n     */\r\n    public inlineShaderCode(code: string): string {\r\n        // no inlining needed in the WebGL engine\r\n        return code;\r\n    }\r\n\r\n    /**\r\n     * Creates a new pipeline context\r\n     * @param shaderProcessingContext defines the shader processing context used during the processing if available\r\n     * @returns the new pipeline\r\n     */\r\n    public createPipelineContext(shaderProcessingContext: Nullable<ShaderProcessingContext>): IPipelineContext {\r\n        const pipelineContext = new WebGLPipelineContext();\r\n        pipelineContext.engine = this;\r\n\r\n        if (this._caps.parallelShaderCompile) {\r\n            pipelineContext.isParallelCompiled = true;\r\n        }\r\n\r\n        return pipelineContext;\r\n    }\r\n\r\n    /**\r\n     * Creates a new material context\r\n     * @returns the new context\r\n     */\r\n    public createMaterialContext(): IMaterialContext | undefined {\r\n        return undefined;\r\n    }\r\n\r\n    /**\r\n     * Creates a new draw context\r\n     * @returns the new context\r\n     */\r\n    public createDrawContext(): IDrawContext | undefined {\r\n        return undefined;\r\n    }\r\n\r\n    protected _createShaderProgram(\r\n        pipelineContext: WebGLPipelineContext,\r\n        vertexShader: WebGLShader,\r\n        fragmentShader: WebGLShader,\r\n        context: WebGLRenderingContext,\r\n        transformFeedbackVaryings: Nullable<string[]> = null\r\n    ): WebGLProgram {\r\n        const shaderProgram = context.createProgram();\r\n        pipelineContext.program = shaderProgram;\r\n\r\n        if (!shaderProgram) {\r\n            throw new Error(\"Unable to create program\");\r\n        }\r\n\r\n        context.attachShader(shaderProgram, vertexShader);\r\n        context.attachShader(shaderProgram, fragmentShader);\r\n\r\n        context.linkProgram(shaderProgram);\r\n\r\n        pipelineContext.context = context;\r\n        pipelineContext.vertexShader = vertexShader;\r\n        pipelineContext.fragmentShader = fragmentShader;\r\n\r\n        if (!pipelineContext.isParallelCompiled) {\r\n            this._finalizePipelineContext(pipelineContext);\r\n        }\r\n\r\n        return shaderProgram;\r\n    }\r\n\r\n    protected _finalizePipelineContext(pipelineContext: WebGLPipelineContext) {\r\n        const context = pipelineContext.context!;\r\n        const vertexShader = pipelineContext.vertexShader!;\r\n        const fragmentShader = pipelineContext.fragmentShader!;\r\n        const program = pipelineContext.program!;\r\n\r\n        const linked = context.getProgramParameter(program, context.LINK_STATUS);\r\n        if (!linked) {\r\n            // Get more info\r\n            // Vertex\r\n            if (!this._gl.getShaderParameter(vertexShader, this._gl.COMPILE_STATUS)) {\r\n                const log = this._gl.getShaderInfoLog(vertexShader);\r\n                if (log) {\r\n                    pipelineContext.vertexCompilationError = log;\r\n                    throw new Error(\"VERTEX SHADER \" + log);\r\n                }\r\n            }\r\n\r\n            // Fragment\r\n            if (!this._gl.getShaderParameter(fragmentShader, this._gl.COMPILE_STATUS)) {\r\n                const log = this._gl.getShaderInfoLog(fragmentShader);\r\n                if (log) {\r\n                    pipelineContext.fragmentCompilationError = log;\r\n                    throw new Error(\"FRAGMENT SHADER \" + log);\r\n                }\r\n            }\r\n\r\n            const error = context.getProgramInfoLog(program);\r\n            if (error) {\r\n                pipelineContext.programLinkError = error;\r\n                throw new Error(error);\r\n            }\r\n        }\r\n\r\n        if (this.validateShaderPrograms) {\r\n            context.validateProgram(program);\r\n            const validated = context.getProgramParameter(program, context.VALIDATE_STATUS);\r\n\r\n            if (!validated) {\r\n                const error = context.getProgramInfoLog(program);\r\n                if (error) {\r\n                    pipelineContext.programValidationError = error;\r\n                    throw new Error(error);\r\n                }\r\n            }\r\n        }\r\n\r\n        context.deleteShader(vertexShader);\r\n        context.deleteShader(fragmentShader);\r\n\r\n        pipelineContext.vertexShader = undefined;\r\n        pipelineContext.fragmentShader = undefined;\r\n\r\n        if (pipelineContext.onCompiled) {\r\n            pipelineContext.onCompiled();\r\n            pipelineContext.onCompiled = undefined;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _preparePipelineContext(\r\n        pipelineContext: IPipelineContext,\r\n        vertexSourceCode: string,\r\n        fragmentSourceCode: string,\r\n        createAsRaw: boolean,\r\n        rawVertexSourceCode: string,\r\n        rawFragmentSourceCode: string,\r\n        rebuildRebind: any,\r\n        defines: Nullable<string>,\r\n        transformFeedbackVaryings: Nullable<string[]>,\r\n        key: string\r\n    ) {\r\n        const webGLRenderingState = pipelineContext as WebGLPipelineContext;\r\n\r\n        if (createAsRaw) {\r\n            webGLRenderingState.program = this.createRawShaderProgram(webGLRenderingState, vertexSourceCode, fragmentSourceCode, undefined, transformFeedbackVaryings);\r\n        } else {\r\n            webGLRenderingState.program = this.createShaderProgram(webGLRenderingState, vertexSourceCode, fragmentSourceCode, defines, undefined, transformFeedbackVaryings);\r\n        }\r\n        webGLRenderingState.program.__SPECTOR_rebuildProgram = rebuildRebind;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _isRenderingStateCompiled(pipelineContext: IPipelineContext): boolean {\r\n        const webGLPipelineContext = pipelineContext as WebGLPipelineContext;\r\n        if (this._isDisposed || webGLPipelineContext._isDisposed) {\r\n            return false;\r\n        }\r\n        if (this._gl.getProgramParameter(webGLPipelineContext.program!, this._caps.parallelShaderCompile!.COMPLETION_STATUS_KHR)) {\r\n            this._finalizePipelineContext(webGLPipelineContext);\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _executeWhenRenderingStateIsCompiled(pipelineContext: IPipelineContext, action: () => void) {\r\n        const webGLPipelineContext = pipelineContext as WebGLPipelineContext;\r\n\r\n        if (!webGLPipelineContext.isParallelCompiled) {\r\n            action();\r\n            return;\r\n        }\r\n\r\n        const oldHandler = webGLPipelineContext.onCompiled;\r\n\r\n        if (oldHandler) {\r\n            webGLPipelineContext.onCompiled = () => {\r\n                oldHandler!();\r\n                action();\r\n            };\r\n        } else {\r\n            webGLPipelineContext.onCompiled = action;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Gets the list of webGL uniform locations associated with a specific program based on a list of uniform names\r\n     * @param pipelineContext defines the pipeline context to use\r\n     * @param uniformsNames defines the list of uniform names\r\n     * @returns an array of webGL uniform locations\r\n     */\r\n    public getUniforms(pipelineContext: IPipelineContext, uniformsNames: string[]): Nullable<WebGLUniformLocation>[] {\r\n        const results = new Array<Nullable<WebGLUniformLocation>>();\r\n        const webGLPipelineContext = pipelineContext as WebGLPipelineContext;\r\n\r\n        for (let index = 0; index < uniformsNames.length; index++) {\r\n            results.push(this._gl.getUniformLocation(webGLPipelineContext.program!, uniformsNames[index]));\r\n        }\r\n\r\n        return results;\r\n    }\r\n\r\n    /**\r\n     * Gets the list of active attributes for a given webGL program\r\n     * @param pipelineContext defines the pipeline context to use\r\n     * @param attributesNames defines the list of attribute names to get\r\n     * @returns an array of indices indicating the offset of each attribute\r\n     */\r\n    public getAttributes(pipelineContext: IPipelineContext, attributesNames: string[]): number[] {\r\n        const results = [];\r\n        const webGLPipelineContext = pipelineContext as WebGLPipelineContext;\r\n\r\n        for (let index = 0; index < attributesNames.length; index++) {\r\n            try {\r\n                results.push(this._gl.getAttribLocation(webGLPipelineContext.program!, attributesNames[index]));\r\n            } catch (e) {\r\n                results.push(-1);\r\n            }\r\n        }\r\n\r\n        return results;\r\n    }\r\n\r\n    /**\r\n     * Activates an effect, making it the current one (ie. the one used for rendering)\r\n     * @param effect defines the effect to activate\r\n     */\r\n    public enableEffect(effect: Nullable<Effect | DrawWrapper>): void {\r\n        effect = effect !== null && DrawWrapper.IsWrapper(effect) ? effect.effect : effect; // get only the effect, we don't need a Wrapper in the WebGL engine\r\n\r\n        if (!effect || effect === this._currentEffect) {\r\n            return;\r\n        }\r\n\r\n        this._stencilStateComposer.stencilMaterial = undefined;\r\n\r\n        effect = effect as Effect;\r\n\r\n        // Use program\r\n        this.bindSamplers(effect);\r\n\r\n        this._currentEffect = effect;\r\n\r\n        if (effect.onBind) {\r\n            effect.onBind(effect);\r\n        }\r\n        if (effect._onBindObservable) {\r\n            effect._onBindObservable.notifyObservers(effect);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to a number (int)\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param value defines the int number to store\r\n     * @returns true if the value was set\r\n     */\r\n    public setInt(uniform: Nullable<WebGLUniformLocation>, value: number): boolean {\r\n        if (!uniform) {\r\n            return false;\r\n        }\r\n\r\n        this._gl.uniform1i(uniform, value);\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to a int2\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param x defines the 1st component of the value\r\n     * @param y defines the 2nd component of the value\r\n     * @returns true if the value was set\r\n     */\r\n    public setInt2(uniform: Nullable<WebGLUniformLocation>, x: number, y: number): boolean {\r\n        if (!uniform) {\r\n            return false;\r\n        }\r\n\r\n        this._gl.uniform2i(uniform, x, y);\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to a int3\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param x defines the 1st component of the value\r\n     * @param y defines the 2nd component of the value\r\n     * @param z defines the 3rd component of the value\r\n     * @returns true if the value was set\r\n     */\r\n    public setInt3(uniform: Nullable<WebGLUniformLocation>, x: number, y: number, z: number): boolean {\r\n        if (!uniform) {\r\n            return false;\r\n        }\r\n\r\n        this._gl.uniform3i(uniform, x, y, z);\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to a int4\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param x defines the 1st component of the value\r\n     * @param y defines the 2nd component of the value\r\n     * @param z defines the 3rd component of the value\r\n     * @param w defines the 4th component of the value\r\n     * @returns true if the value was set\r\n     */\r\n    public setInt4(uniform: Nullable<WebGLUniformLocation>, x: number, y: number, z: number, w: number): boolean {\r\n        if (!uniform) {\r\n            return false;\r\n        }\r\n\r\n        this._gl.uniform4i(uniform, x, y, z, w);\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to an array of int32\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param array defines the array of int32 to store\r\n     * @returns true if the value was set\r\n     */\r\n    public setIntArray(uniform: Nullable<WebGLUniformLocation>, array: Int32Array): boolean {\r\n        if (!uniform) {\r\n            return false;\r\n        }\r\n\r\n        this._gl.uniform1iv(uniform, array);\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to an array of int32 (stored as vec2)\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param array defines the array of int32 to store\r\n     * @returns true if the value was set\r\n     */\r\n    public setIntArray2(uniform: Nullable<WebGLUniformLocation>, array: Int32Array): boolean {\r\n        if (!uniform || array.length % 2 !== 0) {\r\n            return false;\r\n        }\r\n\r\n        this._gl.uniform2iv(uniform, array);\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to an array of int32 (stored as vec3)\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param array defines the array of int32 to store\r\n     * @returns true if the value was set\r\n     */\r\n    public setIntArray3(uniform: Nullable<WebGLUniformLocation>, array: Int32Array): boolean {\r\n        if (!uniform || array.length % 3 !== 0) {\r\n            return false;\r\n        }\r\n\r\n        this._gl.uniform3iv(uniform, array);\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to an array of int32 (stored as vec4)\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param array defines the array of int32 to store\r\n     * @returns true if the value was set\r\n     */\r\n    public setIntArray4(uniform: Nullable<WebGLUniformLocation>, array: Int32Array): boolean {\r\n        if (!uniform || array.length % 4 !== 0) {\r\n            return false;\r\n        }\r\n\r\n        this._gl.uniform4iv(uniform, array);\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to a number (unsigned int)\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param value defines the unsigned int number to store\r\n     * @returns true if the value was set\r\n     */\r\n    public setUInt(uniform: Nullable<WebGLUniformLocation>, value: number): boolean {\r\n        if (!uniform) {\r\n            return false;\r\n        }\r\n\r\n        this._gl.uniform1ui(uniform, value);\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to a unsigned int2\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param x defines the 1st component of the value\r\n     * @param y defines the 2nd component of the value\r\n     * @returns true if the value was set\r\n     */\r\n    public setUInt2(uniform: Nullable<WebGLUniformLocation>, x: number, y: number): boolean {\r\n        if (!uniform) {\r\n            return false;\r\n        }\r\n\r\n        this._gl.uniform2ui(uniform, x, y);\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to a unsigned int3\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param x defines the 1st component of the value\r\n     * @param y defines the 2nd component of the value\r\n     * @param z defines the 3rd component of the value\r\n     * @returns true if the value was set\r\n     */\r\n    public setUInt3(uniform: Nullable<WebGLUniformLocation>, x: number, y: number, z: number): boolean {\r\n        if (!uniform) {\r\n            return false;\r\n        }\r\n\r\n        this._gl.uniform3ui(uniform, x, y, z);\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to a unsigned int4\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param x defines the 1st component of the value\r\n     * @param y defines the 2nd component of the value\r\n     * @param z defines the 3rd component of the value\r\n     * @param w defines the 4th component of the value\r\n     * @returns true if the value was set\r\n     */\r\n    public setUInt4(uniform: Nullable<WebGLUniformLocation>, x: number, y: number, z: number, w: number): boolean {\r\n        if (!uniform) {\r\n            return false;\r\n        }\r\n\r\n        this._gl.uniform4ui(uniform, x, y, z, w);\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to an array of unsigned int32\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param array defines the array of unsigned int32 to store\r\n     * @returns true if the value was set\r\n     */\r\n    public setUIntArray(uniform: Nullable<WebGLUniformLocation>, array: Uint32Array): boolean {\r\n        if (!uniform) {\r\n            return false;\r\n        }\r\n\r\n        this._gl.uniform1uiv(uniform, array);\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to an array of unsigned int32 (stored as vec2)\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param array defines the array of unsigned int32 to store\r\n     * @returns true if the value was set\r\n     */\r\n    public setUIntArray2(uniform: Nullable<WebGLUniformLocation>, array: Uint32Array): boolean {\r\n        if (!uniform || array.length % 2 !== 0) {\r\n            return false;\r\n        }\r\n\r\n        this._gl.uniform2uiv(uniform, array);\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to an array of unsigned int32 (stored as vec3)\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param array defines the array of unsigned int32 to store\r\n     * @returns true if the value was set\r\n     */\r\n    public setUIntArray3(uniform: Nullable<WebGLUniformLocation>, array: Uint32Array): boolean {\r\n        if (!uniform || array.length % 3 !== 0) {\r\n            return false;\r\n        }\r\n\r\n        this._gl.uniform3uiv(uniform, array);\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to an array of unsigned int32 (stored as vec4)\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param array defines the array of unsigned int32 to store\r\n     * @returns true if the value was set\r\n     */\r\n    public setUIntArray4(uniform: Nullable<WebGLUniformLocation>, array: Uint32Array): boolean {\r\n        if (!uniform || array.length % 4 !== 0) {\r\n            return false;\r\n        }\r\n\r\n        this._gl.uniform4uiv(uniform, array);\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to an array of number\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param array defines the array of number to store\r\n     * @returns true if the value was set\r\n     */\r\n    public setArray(uniform: Nullable<WebGLUniformLocation>, array: number[] | Float32Array): boolean {\r\n        if (!uniform) {\r\n            return false;\r\n        }\r\n\r\n        if (array.length < 1) {\r\n            return false;\r\n        }\r\n        this._gl.uniform1fv(uniform, array);\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to an array of number (stored as vec2)\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param array defines the array of number to store\r\n     * @returns true if the value was set\r\n     */\r\n    public setArray2(uniform: Nullable<WebGLUniformLocation>, array: number[] | Float32Array): boolean {\r\n        if (!uniform || array.length % 2 !== 0) {\r\n            return false;\r\n        }\r\n\r\n        this._gl.uniform2fv(uniform, <any>array);\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to an array of number (stored as vec3)\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param array defines the array of number to store\r\n     * @returns true if the value was set\r\n     */\r\n    public setArray3(uniform: Nullable<WebGLUniformLocation>, array: number[] | Float32Array): boolean {\r\n        if (!uniform || array.length % 3 !== 0) {\r\n            return false;\r\n        }\r\n\r\n        this._gl.uniform3fv(uniform, <any>array);\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to an array of number (stored as vec4)\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param array defines the array of number to store\r\n     * @returns true if the value was set\r\n     */\r\n    public setArray4(uniform: Nullable<WebGLUniformLocation>, array: number[] | Float32Array): boolean {\r\n        if (!uniform || array.length % 4 !== 0) {\r\n            return false;\r\n        }\r\n\r\n        this._gl.uniform4fv(uniform, <any>array);\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to an array of float32 (stored as matrices)\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param matrices defines the array of float32 to store\r\n     * @returns true if the value was set\r\n     */\r\n    public setMatrices(uniform: Nullable<WebGLUniformLocation>, matrices: DeepImmutable<FloatArray>): boolean {\r\n        if (!uniform) {\r\n            return false;\r\n        }\r\n\r\n        this._gl.uniformMatrix4fv(uniform, false, matrices);\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to a matrix (3x3)\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param matrix defines the Float32Array representing the 3x3 matrix to store\r\n     * @returns true if the value was set\r\n     */\r\n    public setMatrix3x3(uniform: Nullable<WebGLUniformLocation>, matrix: Float32Array): boolean {\r\n        if (!uniform) {\r\n            return false;\r\n        }\r\n\r\n        this._gl.uniformMatrix3fv(uniform, false, matrix);\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to a matrix (2x2)\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param matrix defines the Float32Array representing the 2x2 matrix to store\r\n     * @returns true if the value was set\r\n     */\r\n    public setMatrix2x2(uniform: Nullable<WebGLUniformLocation>, matrix: Float32Array): boolean {\r\n        if (!uniform) {\r\n            return false;\r\n        }\r\n\r\n        this._gl.uniformMatrix2fv(uniform, false, matrix);\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to a number (float)\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param value defines the float number to store\r\n     * @returns true if the value was transferred\r\n     */\r\n    public setFloat(uniform: Nullable<WebGLUniformLocation>, value: number): boolean {\r\n        if (!uniform) {\r\n            return false;\r\n        }\r\n\r\n        this._gl.uniform1f(uniform, value);\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to a vec2\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param x defines the 1st component of the value\r\n     * @param y defines the 2nd component of the value\r\n     * @returns true if the value was set\r\n     */\r\n    public setFloat2(uniform: Nullable<WebGLUniformLocation>, x: number, y: number): boolean {\r\n        if (!uniform) {\r\n            return false;\r\n        }\r\n\r\n        this._gl.uniform2f(uniform, x, y);\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to a vec3\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param x defines the 1st component of the value\r\n     * @param y defines the 2nd component of the value\r\n     * @param z defines the 3rd component of the value\r\n     * @returns true if the value was set\r\n     */\r\n    public setFloat3(uniform: Nullable<WebGLUniformLocation>, x: number, y: number, z: number): boolean {\r\n        if (!uniform) {\r\n            return false;\r\n        }\r\n\r\n        this._gl.uniform3f(uniform, x, y, z);\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to a vec4\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param x defines the 1st component of the value\r\n     * @param y defines the 2nd component of the value\r\n     * @param z defines the 3rd component of the value\r\n     * @param w defines the 4th component of the value\r\n     * @returns true if the value was set\r\n     */\r\n    public setFloat4(uniform: Nullable<WebGLUniformLocation>, x: number, y: number, z: number, w: number): boolean {\r\n        if (!uniform) {\r\n            return false;\r\n        }\r\n\r\n        this._gl.uniform4f(uniform, x, y, z, w);\r\n\r\n        return true;\r\n    }\r\n\r\n    // States\r\n\r\n    /**\r\n     * Apply all cached states (depth, culling, stencil and alpha)\r\n     */\r\n    public applyStates() {\r\n        this._depthCullingState.apply(this._gl);\r\n        this._stencilStateComposer.apply(this._gl);\r\n        this._alphaState.apply(this._gl);\r\n\r\n        if (this._colorWriteChanged) {\r\n            this._colorWriteChanged = false;\r\n            const enable = this._colorWrite;\r\n            this._gl.colorMask(enable, enable, enable, enable);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Enable or disable color writing\r\n     * @param enable defines the state to set\r\n     */\r\n    public setColorWrite(enable: boolean): void {\r\n        if (enable !== this._colorWrite) {\r\n            this._colorWriteChanged = true;\r\n            this._colorWrite = enable;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Gets a boolean indicating if color writing is enabled\r\n     * @returns the current color writing state\r\n     */\r\n    public getColorWrite(): boolean {\r\n        return this._colorWrite;\r\n    }\r\n\r\n    /**\r\n     * Gets the depth culling state manager\r\n     */\r\n    public get depthCullingState(): DepthCullingState {\r\n        return this._depthCullingState;\r\n    }\r\n\r\n    /**\r\n     * Gets the alpha state manager\r\n     */\r\n    public get alphaState(): AlphaState {\r\n        return this._alphaState;\r\n    }\r\n\r\n    /**\r\n     * Gets the stencil state manager\r\n     */\r\n    public get stencilState(): StencilState {\r\n        return this._stencilState;\r\n    }\r\n\r\n    /**\r\n     * Gets the stencil state composer\r\n     */\r\n    public get stencilStateComposer(): StencilStateComposer {\r\n        return this._stencilStateComposer;\r\n    }\r\n\r\n    // Textures\r\n\r\n    /**\r\n     * Clears the list of texture accessible through engine.\r\n     * This can help preventing texture load conflict due to name collision.\r\n     */\r\n    public clearInternalTexturesCache() {\r\n        this._internalTexturesCache.length = 0;\r\n    }\r\n\r\n    /**\r\n     * Force the entire cache to be cleared\r\n     * You should not have to use this function unless your engine needs to share the webGL context with another engine\r\n     * @param bruteForce defines a boolean to force clearing ALL caches (including stencil, detoh and alpha states)\r\n     */\r\n    public wipeCaches(bruteForce?: boolean): void {\r\n        if (this.preventCacheWipeBetweenFrames && !bruteForce) {\r\n            return;\r\n        }\r\n        this._currentEffect = null;\r\n        this._viewportCached.x = 0;\r\n        this._viewportCached.y = 0;\r\n        this._viewportCached.z = 0;\r\n        this._viewportCached.w = 0;\r\n\r\n        // Done before in case we clean the attributes\r\n        this._unbindVertexArrayObject();\r\n\r\n        if (bruteForce) {\r\n            this._currentProgram = null;\r\n            this.resetTextureCache();\r\n\r\n            this._stencilStateComposer.reset();\r\n\r\n            this._depthCullingState.reset();\r\n            this._depthCullingState.depthFunc = this._gl.LEQUAL;\r\n\r\n            this._alphaState.reset();\r\n            this._alphaMode = Constants.ALPHA_ADD;\r\n            this._alphaEquation = Constants.ALPHA_DISABLE;\r\n\r\n            this._colorWrite = true;\r\n            this._colorWriteChanged = true;\r\n\r\n            this._unpackFlipYCached = null;\r\n\r\n            this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL, this._gl.NONE);\r\n            this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, 0);\r\n\r\n            this._mustWipeVertexAttributes = true;\r\n            this.unbindAllAttributes();\r\n        }\r\n\r\n        this._resetVertexBufferBinding();\r\n        this._cachedIndexBuffer = null;\r\n        this._cachedEffectForVertexBuffers = null;\r\n        this.bindIndexBuffer(null);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _getSamplingParameters(samplingMode: number, generateMipMaps: boolean): { min: number; mag: number } {\r\n        const gl = this._gl;\r\n        let magFilter: GLenum = gl.NEAREST;\r\n        let minFilter: GLenum = gl.NEAREST;\r\n\r\n        switch (samplingMode) {\r\n            case Constants.TEXTURE_LINEAR_LINEAR_MIPNEAREST:\r\n                magFilter = gl.LINEAR;\r\n                if (generateMipMaps) {\r\n                    minFilter = gl.LINEAR_MIPMAP_NEAREST;\r\n                } else {\r\n                    minFilter = gl.LINEAR;\r\n                }\r\n                break;\r\n            case Constants.TEXTURE_LINEAR_LINEAR_MIPLINEAR:\r\n                magFilter = gl.LINEAR;\r\n                if (generateMipMaps) {\r\n                    minFilter = gl.LINEAR_MIPMAP_LINEAR;\r\n                } else {\r\n                    minFilter = gl.LINEAR;\r\n                }\r\n                break;\r\n            case Constants.TEXTURE_NEAREST_NEAREST_MIPLINEAR:\r\n                magFilter = gl.NEAREST;\r\n                if (generateMipMaps) {\r\n                    minFilter = gl.NEAREST_MIPMAP_LINEAR;\r\n                } else {\r\n                    minFilter = gl.NEAREST;\r\n                }\r\n                break;\r\n            case Constants.TEXTURE_NEAREST_NEAREST_MIPNEAREST:\r\n                magFilter = gl.NEAREST;\r\n                if (generateMipMaps) {\r\n                    minFilter = gl.NEAREST_MIPMAP_NEAREST;\r\n                } else {\r\n                    minFilter = gl.NEAREST;\r\n                }\r\n                break;\r\n            case Constants.TEXTURE_NEAREST_LINEAR_MIPNEAREST:\r\n                magFilter = gl.NEAREST;\r\n                if (generateMipMaps) {\r\n                    minFilter = gl.LINEAR_MIPMAP_NEAREST;\r\n                } else {\r\n                    minFilter = gl.LINEAR;\r\n                }\r\n                break;\r\n            case Constants.TEXTURE_NEAREST_LINEAR_MIPLINEAR:\r\n                magFilter = gl.NEAREST;\r\n                if (generateMipMaps) {\r\n                    minFilter = gl.LINEAR_MIPMAP_LINEAR;\r\n                } else {\r\n                    minFilter = gl.LINEAR;\r\n                }\r\n                break;\r\n            case Constants.TEXTURE_NEAREST_LINEAR:\r\n                magFilter = gl.NEAREST;\r\n                minFilter = gl.LINEAR;\r\n                break;\r\n            case Constants.TEXTURE_NEAREST_NEAREST:\r\n                magFilter = gl.NEAREST;\r\n                minFilter = gl.NEAREST;\r\n                break;\r\n            case Constants.TEXTURE_LINEAR_NEAREST_MIPNEAREST:\r\n                magFilter = gl.LINEAR;\r\n                if (generateMipMaps) {\r\n                    minFilter = gl.NEAREST_MIPMAP_NEAREST;\r\n                } else {\r\n                    minFilter = gl.NEAREST;\r\n                }\r\n                break;\r\n            case Constants.TEXTURE_LINEAR_NEAREST_MIPLINEAR:\r\n                magFilter = gl.LINEAR;\r\n                if (generateMipMaps) {\r\n                    minFilter = gl.NEAREST_MIPMAP_LINEAR;\r\n                } else {\r\n                    minFilter = gl.NEAREST;\r\n                }\r\n                break;\r\n            case Constants.TEXTURE_LINEAR_LINEAR:\r\n                magFilter = gl.LINEAR;\r\n                minFilter = gl.LINEAR;\r\n                break;\r\n            case Constants.TEXTURE_LINEAR_NEAREST:\r\n                magFilter = gl.LINEAR;\r\n                minFilter = gl.NEAREST;\r\n                break;\r\n        }\r\n\r\n        return {\r\n            min: minFilter,\r\n            mag: magFilter,\r\n        };\r\n    }\r\n\r\n    /** @internal */\r\n    protected _createTexture(): WebGLTexture {\r\n        const texture = this._gl.createTexture();\r\n\r\n        if (!texture) {\r\n            throw new Error(\"Unable to create texture\");\r\n        }\r\n\r\n        return texture;\r\n    }\r\n\r\n    /** @internal */\r\n    public _createHardwareTexture(): HardwareTextureWrapper {\r\n        return new WebGLHardwareTexture(this._createTexture(), this._gl);\r\n    }\r\n\r\n    /**\r\n     * Creates an internal texture without binding it to a framebuffer\r\n     * @internal\r\n     * @param size defines the size of the texture\r\n     * @param options defines the options used to create the texture\r\n     * @param delayGPUTextureCreation true to delay the texture creation the first time it is really needed. false to create it right away\r\n     * @param source source type of the texture\r\n     * @returns a new internal texture\r\n     */\r\n    public _createInternalTexture(\r\n        size: TextureSize,\r\n        options: boolean | InternalTextureCreationOptions,\r\n        delayGPUTextureCreation = true,\r\n        source = InternalTextureSource.Unknown\r\n    ): InternalTexture {\r\n        let generateMipMaps = false;\r\n        let type = Constants.TEXTURETYPE_UNSIGNED_INT;\r\n        let samplingMode = Constants.TEXTURE_TRILINEAR_SAMPLINGMODE;\r\n        let format = Constants.TEXTUREFORMAT_RGBA;\r\n        let useSRGBBuffer = false;\r\n        let samples = 1;\r\n        let label: string | undefined;\r\n        if (options !== undefined && typeof options === \"object\") {\r\n            generateMipMaps = !!options.generateMipMaps;\r\n            type = options.type === undefined ? Constants.TEXTURETYPE_UNSIGNED_INT : options.type;\r\n            samplingMode = options.samplingMode === undefined ? Constants.TEXTURE_TRILINEAR_SAMPLINGMODE : options.samplingMode;\r\n            format = options.format === undefined ? Constants.TEXTUREFORMAT_RGBA : options.format;\r\n            useSRGBBuffer = options.useSRGBBuffer === undefined ? false : options.useSRGBBuffer;\r\n            samples = options.samples ?? 1;\r\n            label = options.label;\r\n        } else {\r\n            generateMipMaps = !!options;\r\n        }\r\n\r\n        useSRGBBuffer &&= this._caps.supportSRGBBuffers && (this.webGLVersion > 1 || this.isWebGPU);\r\n\r\n        if (type === Constants.TEXTURETYPE_FLOAT && !this._caps.textureFloatLinearFiltering) {\r\n            // if floating point linear (gl.FLOAT) then force to NEAREST_SAMPLINGMODE\r\n            samplingMode = Constants.TEXTURE_NEAREST_SAMPLINGMODE;\r\n        } else if (type === Constants.TEXTURETYPE_HALF_FLOAT && !this._caps.textureHalfFloatLinearFiltering) {\r\n            // if floating point linear (HALF_FLOAT) then force to NEAREST_SAMPLINGMODE\r\n            samplingMode = Constants.TEXTURE_NEAREST_SAMPLINGMODE;\r\n        }\r\n        if (type === Constants.TEXTURETYPE_FLOAT && !this._caps.textureFloat) {\r\n            type = Constants.TEXTURETYPE_UNSIGNED_INT;\r\n            Logger.Warn(\"Float textures are not supported. Type forced to TEXTURETYPE_UNSIGNED_BYTE\");\r\n        }\r\n\r\n        const gl = this._gl;\r\n        const texture = new InternalTexture(this, source);\r\n        const width = (<{ width: number; height: number; layers?: number }>size).width || <number>size;\r\n        const height = (<{ width: number; height: number; layers?: number }>size).height || <number>size;\r\n        const layers = (<{ width: number; height: number; layers?: number }>size).layers || 0;\r\n        const filters = this._getSamplingParameters(samplingMode, generateMipMaps);\r\n        const target = layers !== 0 ? gl.TEXTURE_2D_ARRAY : gl.TEXTURE_2D;\r\n        const sizedFormat = this._getRGBABufferInternalSizedFormat(type, format, useSRGBBuffer);\r\n        const internalFormat = this._getInternalFormat(format);\r\n        const textureType = this._getWebGLTextureType(type);\r\n\r\n        // Bind\r\n        this._bindTextureDirectly(target, texture);\r\n\r\n        if (layers !== 0) {\r\n            texture.is2DArray = true;\r\n            gl.texImage3D(target, 0, sizedFormat, width, height, layers, 0, internalFormat, textureType, null);\r\n        } else {\r\n            gl.texImage2D(target, 0, sizedFormat, width, height, 0, internalFormat, textureType, null);\r\n        }\r\n\r\n        gl.texParameteri(target, gl.TEXTURE_MAG_FILTER, filters.mag);\r\n        gl.texParameteri(target, gl.TEXTURE_MIN_FILTER, filters.min);\r\n        gl.texParameteri(target, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n        gl.texParameteri(target, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n\r\n        // MipMaps\r\n        if (generateMipMaps) {\r\n            this._gl.generateMipmap(target);\r\n        }\r\n\r\n        this._bindTextureDirectly(target, null);\r\n\r\n        texture._useSRGBBuffer = useSRGBBuffer;\r\n        texture.baseWidth = width;\r\n        texture.baseHeight = height;\r\n        texture.width = width;\r\n        texture.height = height;\r\n        texture.depth = layers;\r\n        texture.isReady = true;\r\n        texture.samples = samples;\r\n        texture.generateMipMaps = generateMipMaps;\r\n        texture.samplingMode = samplingMode;\r\n        texture.type = type;\r\n        texture.format = format;\r\n        texture.label = label;\r\n\r\n        this._internalTexturesCache.push(texture);\r\n\r\n        return texture;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _getUseSRGBBuffer(useSRGBBuffer: boolean, noMipmap: boolean): boolean {\r\n        // Generating mipmaps for sRGB textures is not supported in WebGL1 so we must disable the support if mipmaps is enabled\r\n        return useSRGBBuffer && this._caps.supportSRGBBuffers && (this.webGLVersion > 1 || this.isWebGPU || noMipmap);\r\n    }\r\n\r\n    protected _createTextureBase(\r\n        url: Nullable<string>,\r\n        noMipmap: boolean,\r\n        invertY: boolean,\r\n        scene: Nullable<ISceneLike>,\r\n        samplingMode: number = Constants.TEXTURE_TRILINEAR_SAMPLINGMODE,\r\n        onLoad: Nullable<(texture: InternalTexture) => void> = null,\r\n        onError: Nullable<(message: string, exception: any) => void> = null,\r\n        prepareTexture: (\r\n            texture: InternalTexture,\r\n            extension: string,\r\n            scene: Nullable<ISceneLike>,\r\n            img: HTMLImageElement | ImageBitmap | { width: number; height: number },\r\n            invertY: boolean,\r\n            noMipmap: boolean,\r\n            isCompressed: boolean,\r\n            processFunction: (\r\n                width: number,\r\n                height: number,\r\n                img: HTMLImageElement | ImageBitmap | { width: number; height: number },\r\n                extension: string,\r\n                texture: InternalTexture,\r\n                continuationCallback: () => void\r\n            ) => boolean,\r\n            samplingMode: number\r\n        ) => void,\r\n        prepareTextureProcessFunction: (\r\n            width: number,\r\n            height: number,\r\n            img: HTMLImageElement | ImageBitmap | { width: number; height: number },\r\n            extension: string,\r\n            texture: InternalTexture,\r\n            continuationCallback: () => void\r\n        ) => boolean,\r\n        buffer: Nullable<string | ArrayBuffer | ArrayBufferView | HTMLImageElement | Blob | ImageBitmap> = null,\r\n        fallback: Nullable<InternalTexture> = null,\r\n        format: Nullable<number> = null,\r\n        forcedExtension: Nullable<string> = null,\r\n        mimeType?: string,\r\n        loaderOptions?: any,\r\n        useSRGBBuffer?: boolean\r\n    ): InternalTexture {\r\n        url = url || \"\";\r\n        const fromData = url.substr(0, 5) === \"data:\";\r\n        const fromBlob = url.substr(0, 5) === \"blob:\";\r\n        const isBase64 = fromData && url.indexOf(\";base64,\") !== -1;\r\n\r\n        const texture = fallback ? fallback : new InternalTexture(this, InternalTextureSource.Url);\r\n\r\n        if (texture !== fallback) {\r\n            texture.label = url.substring(0, 60); // default label, can be overriden by the caller\r\n        }\r\n\r\n        const originalUrl = url;\r\n        if (this._transformTextureUrl && !isBase64 && !fallback && !buffer) {\r\n            url = this._transformTextureUrl(url);\r\n        }\r\n\r\n        if (originalUrl !== url) {\r\n            texture._originalUrl = originalUrl;\r\n        }\r\n\r\n        // establish the file extension, if possible\r\n        const lastDot = url.lastIndexOf(\".\");\r\n        let extension = forcedExtension ? forcedExtension : lastDot > -1 ? url.substring(lastDot).toLowerCase() : \"\";\r\n        let loader: Nullable<IInternalTextureLoader> = null;\r\n\r\n        // Remove query string\r\n        const queryStringIndex = extension.indexOf(\"?\");\r\n\r\n        if (queryStringIndex > -1) {\r\n            extension = extension.split(\"?\")[0];\r\n        }\r\n\r\n        for (const availableLoader of ThinEngine._TextureLoaders) {\r\n            if (availableLoader.canLoad(extension, mimeType)) {\r\n                loader = availableLoader;\r\n                break;\r\n            }\r\n        }\r\n\r\n        if (scene) {\r\n            scene.addPendingData(texture);\r\n        }\r\n        texture.url = url;\r\n        texture.generateMipMaps = !noMipmap;\r\n        texture.samplingMode = samplingMode;\r\n        texture.invertY = invertY;\r\n        texture._useSRGBBuffer = this._getUseSRGBBuffer(!!useSRGBBuffer, noMipmap);\r\n\r\n        if (!this._doNotHandleContextLost) {\r\n            // Keep a link to the buffer only if we plan to handle context lost\r\n            texture._buffer = buffer;\r\n        }\r\n\r\n        let onLoadObserver: Nullable<Observer<InternalTexture>> = null;\r\n        if (onLoad && !fallback) {\r\n            onLoadObserver = texture.onLoadedObservable.add(onLoad);\r\n        }\r\n\r\n        if (!fallback) {\r\n            this._internalTexturesCache.push(texture);\r\n        }\r\n\r\n        const onInternalError = (message?: string, exception?: any) => {\r\n            if (scene) {\r\n                scene.removePendingData(texture);\r\n            }\r\n\r\n            if (url === originalUrl) {\r\n                if (onLoadObserver) {\r\n                    texture.onLoadedObservable.remove(onLoadObserver);\r\n                }\r\n\r\n                if (EngineStore.UseFallbackTexture && url !== EngineStore.FallbackTexture) {\r\n                    this._createTextureBase(\r\n                        EngineStore.FallbackTexture,\r\n                        noMipmap,\r\n                        texture.invertY,\r\n                        scene,\r\n                        samplingMode,\r\n                        null,\r\n                        onError,\r\n                        prepareTexture,\r\n                        prepareTextureProcessFunction,\r\n                        buffer,\r\n                        texture\r\n                    );\r\n                }\r\n\r\n                message = (message || \"Unknown error\") + (EngineStore.UseFallbackTexture ? \" - Fallback texture was used\" : \"\");\r\n                texture.onErrorObservable.notifyObservers({ message, exception });\r\n                if (onError) {\r\n                    onError(message, exception);\r\n                }\r\n            } else {\r\n                // fall back to the original url if the transformed url fails to load\r\n                Logger.Warn(`Failed to load ${url}, falling back to ${originalUrl}`);\r\n                this._createTextureBase(\r\n                    originalUrl,\r\n                    noMipmap,\r\n                    texture.invertY,\r\n                    scene,\r\n                    samplingMode,\r\n                    onLoad,\r\n                    onError,\r\n                    prepareTexture,\r\n                    prepareTextureProcessFunction,\r\n                    buffer,\r\n                    texture,\r\n                    format,\r\n                    forcedExtension,\r\n                    mimeType,\r\n                    loaderOptions,\r\n                    useSRGBBuffer\r\n                );\r\n            }\r\n        };\r\n\r\n        // processing for non-image formats\r\n        if (loader) {\r\n            const callback = (data: ArrayBufferView) => {\r\n                loader!.loadData(\r\n                    data,\r\n                    texture,\r\n                    (width: number, height: number, loadMipmap: boolean, isCompressed: boolean, done: () => void, loadFailed) => {\r\n                        if (loadFailed) {\r\n                            onInternalError(\"TextureLoader failed to load data\");\r\n                        } else {\r\n                            prepareTexture(\r\n                                texture,\r\n                                extension,\r\n                                scene,\r\n                                { width, height },\r\n                                texture.invertY,\r\n                                !loadMipmap,\r\n                                isCompressed,\r\n                                () => {\r\n                                    done();\r\n                                    return false;\r\n                                },\r\n                                samplingMode\r\n                            );\r\n                        }\r\n                    },\r\n                    loaderOptions\r\n                );\r\n            };\r\n\r\n            if (!buffer) {\r\n                this._loadFile(\r\n                    url,\r\n                    (data) => callback(new Uint8Array(data as ArrayBuffer)),\r\n                    undefined,\r\n                    scene ? scene.offlineProvider : undefined,\r\n                    true,\r\n                    (request?: IWebRequest, exception?: any) => {\r\n                        onInternalError(\"Unable to load \" + (request ? request.responseURL : url, exception));\r\n                    }\r\n                );\r\n            } else {\r\n                if (buffer instanceof ArrayBuffer) {\r\n                    callback(new Uint8Array(buffer));\r\n                } else if (ArrayBuffer.isView(buffer)) {\r\n                    callback(buffer);\r\n                } else {\r\n                    if (onError) {\r\n                        onError(\"Unable to load: only ArrayBuffer or ArrayBufferView is supported\", null);\r\n                    }\r\n                }\r\n            }\r\n        } else {\r\n            const onload = (img: HTMLImageElement | ImageBitmap) => {\r\n                if (fromBlob && !this._doNotHandleContextLost) {\r\n                    // We need to store the image if we need to rebuild the texture\r\n                    // in case of a webgl context lost\r\n                    texture._buffer = img;\r\n                }\r\n\r\n                prepareTexture(texture, extension, scene, img, texture.invertY, noMipmap, false, prepareTextureProcessFunction, samplingMode);\r\n            };\r\n            // According to the WebGL spec section 6.10, ImageBitmaps must be inverted on creation.\r\n            // So, we pass imageOrientation to _FileToolsLoadImage() as it may create an ImageBitmap.\r\n\r\n            if (!fromData || isBase64) {\r\n                if (buffer && (typeof (<HTMLImageElement>buffer).decoding === \"string\" || (<ImageBitmap>buffer).close)) {\r\n                    onload(<HTMLImageElement>buffer);\r\n                } else {\r\n                    ThinEngine._FileToolsLoadImage(\r\n                        url,\r\n                        onload,\r\n                        onInternalError,\r\n                        scene ? scene.offlineProvider : null,\r\n                        mimeType,\r\n                        texture.invertY && this._features.needsInvertingBitmap ? { imageOrientation: \"flipY\" } : undefined\r\n                    );\r\n                }\r\n            } else if (typeof buffer === \"string\" || buffer instanceof ArrayBuffer || ArrayBuffer.isView(buffer) || buffer instanceof Blob) {\r\n                ThinEngine._FileToolsLoadImage(\r\n                    buffer,\r\n                    onload,\r\n                    onInternalError,\r\n                    scene ? scene.offlineProvider : null,\r\n                    mimeType,\r\n                    texture.invertY && this._features.needsInvertingBitmap ? { imageOrientation: \"flipY\" } : undefined\r\n                );\r\n            } else if (buffer) {\r\n                onload(buffer);\r\n            }\r\n        }\r\n\r\n        return texture;\r\n    }\r\n\r\n    /**\r\n     * Usually called from Texture.ts.\r\n     * Passed information to create a WebGLTexture\r\n     * @param url defines a value which contains one of the following:\r\n     * * A conventional http URL, e.g. 'http://...' or 'file://...'\r\n     * * A base64 string of in-line texture data, e.g. 'data:image/jpg;base64,/...'\r\n     * * An indicator that data being passed using the buffer parameter, e.g. 'data:mytexture.jpg'\r\n     * @param noMipmap defines a boolean indicating that no mipmaps shall be generated.  Ignored for compressed textures.  They must be in the file\r\n     * @param invertY when true, image is flipped when loaded.  You probably want true. Certain compressed textures may invert this if their default is inverted (eg. ktx)\r\n     * @param scene needed for loading to the correct scene\r\n     * @param samplingMode mode with should be used sample / access the texture (Default: Texture.TRILINEAR_SAMPLINGMODE)\r\n     * @param onLoad optional callback to be called upon successful completion\r\n     * @param onError optional callback to be called upon failure\r\n     * @param buffer a source of a file previously fetched as either a base64 string, an ArrayBuffer (compressed or image format), HTMLImageElement (image format), or a Blob\r\n     * @param fallback an internal argument in case the function must be called again, due to etc1 not having alpha capabilities\r\n     * @param format internal format.  Default: RGB when extension is '.jpg' else RGBA.  Ignored for compressed textures\r\n     * @param forcedExtension defines the extension to use to pick the right loader\r\n     * @param mimeType defines an optional mime type\r\n     * @param loaderOptions options to be passed to the loader\r\n     * @param creationFlags specific flags to use when creating the texture (Constants.TEXTURE_CREATIONFLAG_STORAGE for storage textures, for eg)\r\n     * @param useSRGBBuffer defines if the texture must be loaded in a sRGB GPU buffer (if supported by the GPU).\r\n     * @returns a InternalTexture for assignment back into BABYLON.Texture\r\n     */\r\n    public createTexture(\r\n        url: Nullable<string>,\r\n        noMipmap: boolean,\r\n        invertY: boolean,\r\n        scene: Nullable<ISceneLike>,\r\n        samplingMode: number = Constants.TEXTURE_TRILINEAR_SAMPLINGMODE,\r\n        onLoad: Nullable<(texture: InternalTexture) => void> = null,\r\n        onError: Nullable<(message: string, exception: any) => void> = null,\r\n        buffer: Nullable<string | ArrayBuffer | ArrayBufferView | HTMLImageElement | Blob | ImageBitmap> = null,\r\n        fallback: Nullable<InternalTexture> = null,\r\n        format: Nullable<number> = null,\r\n        forcedExtension: Nullable<string> = null,\r\n        mimeType?: string,\r\n        loaderOptions?: any,\r\n        creationFlags?: number,\r\n        useSRGBBuffer?: boolean\r\n    ): InternalTexture {\r\n        return this._createTextureBase(\r\n            url,\r\n            noMipmap,\r\n            invertY,\r\n            scene,\r\n            samplingMode,\r\n            onLoad,\r\n            onError,\r\n            this._prepareWebGLTexture.bind(this),\r\n            (potWidth, potHeight, img, extension, texture, continuationCallback) => {\r\n                const gl = this._gl;\r\n                const isPot = img.width === potWidth && img.height === potHeight;\r\n\r\n                texture._creationFlags = creationFlags ?? 0;\r\n\r\n                const tip = this._getTexImageParametersForCreateTexture(format, extension, texture._useSRGBBuffer);\r\n                if (isPot) {\r\n                    gl.texImage2D(gl.TEXTURE_2D, 0, tip.internalFormat, tip.format, tip.type, img as any);\r\n                    return false;\r\n                }\r\n\r\n                const maxTextureSize = this._caps.maxTextureSize;\r\n\r\n                if (img.width > maxTextureSize || img.height > maxTextureSize || !this._supportsHardwareTextureRescaling) {\r\n                    this._prepareWorkingCanvas();\r\n                    if (!this._workingCanvas || !this._workingContext) {\r\n                        return false;\r\n                    }\r\n\r\n                    this._workingCanvas.width = potWidth;\r\n                    this._workingCanvas.height = potHeight;\r\n\r\n                    this._workingContext.drawImage(img as any, 0, 0, img.width, img.height, 0, 0, potWidth, potHeight);\r\n                    gl.texImage2D(gl.TEXTURE_2D, 0, tip.internalFormat, tip.format, tip.type, this._workingCanvas as TexImageSource);\r\n\r\n                    texture.width = potWidth;\r\n                    texture.height = potHeight;\r\n\r\n                    return false;\r\n                } else {\r\n                    // Using shaders when possible to rescale because canvas.drawImage is lossy\r\n                    const source = new InternalTexture(this, InternalTextureSource.Temp);\r\n                    this._bindTextureDirectly(gl.TEXTURE_2D, source, true);\r\n                    gl.texImage2D(gl.TEXTURE_2D, 0, tip.internalFormat, tip.format, tip.type, img as any);\r\n\r\n                    this._rescaleTexture(source, texture, scene, tip.format, () => {\r\n                        this._releaseTexture(source);\r\n                        this._bindTextureDirectly(gl.TEXTURE_2D, texture, true);\r\n\r\n                        continuationCallback();\r\n                    });\r\n                }\r\n\r\n                return true;\r\n            },\r\n            buffer,\r\n            fallback,\r\n            format,\r\n            forcedExtension,\r\n            mimeType,\r\n            loaderOptions,\r\n            useSRGBBuffer\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Calls to the GL texImage2D and texImage3D functions require three arguments describing the pixel format of the texture.\r\n     * createTexture derives these from the babylonFormat and useSRGBBuffer arguments and also the file extension of the URL it's working with.\r\n     * This function encapsulates that derivation for easy unit testing.\r\n     * @param babylonFormat Babylon's format enum, as specified in ITextureCreationOptions.\r\n     * @param fileExtension The file extension including the dot, e.g. .jpg.\r\n     * @param useSRGBBuffer Use SRGB not linear.\r\n     * @returns The options to pass to texImage2D or texImage3D calls.\r\n     * @internal\r\n     */\r\n    public _getTexImageParametersForCreateTexture(babylonFormat: Nullable<number>, fileExtension: string, useSRGBBuffer: boolean): TexImageParameters {\r\n        if (babylonFormat === undefined || babylonFormat === null) {\r\n            babylonFormat = fileExtension === \".jpg\" && !useSRGBBuffer ? Constants.TEXTUREFORMAT_RGB : Constants.TEXTUREFORMAT_RGBA;\r\n        }\r\n\r\n        let format: number, internalFormat: number;\r\n        if (this.webGLVersion === 1) {\r\n            // In WebGL 1, format and internalFormat must be the same and taken from a limited set of values, see https://docs.gl/es2/glTexImage2D.\r\n            // The SRGB extension (https://developer.mozilla.org/en-US/docs/Web/API/EXT_sRGB) adds some extra values, hence passing useSRGBBuffer\r\n            // to getInternalFormat.\r\n            format = this._getInternalFormat(babylonFormat, useSRGBBuffer);\r\n            internalFormat = format;\r\n        } else {\r\n            // In WebGL 2, format has a wider range of values and internal format can be one of the sized formats, see\r\n            // https://registry.khronos.org/OpenGL-Refpages/es3.0/html/glTexImage2D.xhtml.\r\n            // SRGB is included in the sized format and should not be passed in \"format\", hence always passing useSRGBBuffer as false.\r\n            format = this._getInternalFormat(babylonFormat, false);\r\n            internalFormat = this._getRGBABufferInternalSizedFormat(Constants.TEXTURETYPE_UNSIGNED_BYTE, babylonFormat, useSRGBBuffer);\r\n        }\r\n\r\n        return {\r\n            internalFormat,\r\n            format,\r\n            type: this._gl.UNSIGNED_BYTE,\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Loads an image as an HTMLImageElement.\r\n     * @param input url string, ArrayBuffer, or Blob to load\r\n     * @param onLoad callback called when the image successfully loads\r\n     * @param onError callback called when the image fails to load\r\n     * @param offlineProvider offline provider for caching\r\n     * @param mimeType optional mime type\r\n     * @param imageBitmapOptions optional the options to use when creating an ImageBitmap\r\n     * @returns the HTMLImageElement of the loaded image\r\n     * @internal\r\n     */\r\n    public static _FileToolsLoadImage(\r\n        input: string | ArrayBuffer | ArrayBufferView | Blob,\r\n        onLoad: (img: HTMLImageElement | ImageBitmap) => void,\r\n        onError: (message?: string, exception?: any) => void,\r\n        offlineProvider: Nullable<IOfflineProvider>,\r\n        mimeType?: string,\r\n        imageBitmapOptions?: ImageBitmapOptions\r\n    ): Nullable<HTMLImageElement> {\r\n        throw _WarnImport(\"FileTools\");\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _rescaleTexture(source: InternalTexture, destination: InternalTexture, scene: Nullable<any>, internalFormat: number, onComplete: () => void): void {}\r\n\r\n    // eslint-disable-next-line jsdoc/require-returns-check\r\n    /**\r\n     * Creates a raw texture\r\n     * @param data defines the data to store in the texture\r\n     * @param width defines the width of the texture\r\n     * @param height defines the height of the texture\r\n     * @param format defines the format of the data\r\n     * @param generateMipMaps defines if the engine should generate the mip levels\r\n     * @param invertY defines if data must be stored with Y axis inverted\r\n     * @param samplingMode defines the required sampling mode (Texture.NEAREST_SAMPLINGMODE by default)\r\n     * @param compression defines the compression used (null by default)\r\n     * @param type defines the type fo the data (Engine.TEXTURETYPE_UNSIGNED_INT by default)\r\n     * @param creationFlags specific flags to use when creating the texture (Constants.TEXTURE_CREATIONFLAG_STORAGE for storage textures, for eg)\r\n     * @param useSRGBBuffer defines if the texture must be loaded in a sRGB GPU buffer (if supported by the GPU).\r\n     * @returns the raw texture inside an InternalTexture\r\n     */\r\n    public createRawTexture(\r\n        data: Nullable<ArrayBufferView>,\r\n        width: number,\r\n        height: number,\r\n        format: number,\r\n        generateMipMaps: boolean,\r\n        invertY: boolean,\r\n        samplingMode: number,\r\n        compression: Nullable<string> = null,\r\n        type: number = Constants.TEXTURETYPE_UNSIGNED_INT,\r\n        creationFlags = 0,\r\n        useSRGBBuffer: boolean = false\r\n    ): InternalTexture {\r\n        throw _WarnImport(\"Engine.RawTexture\");\r\n    }\r\n\r\n    // eslint-disable-next-line jsdoc/require-returns-check\r\n    /**\r\n     * Creates a new raw cube texture\r\n     * @param data defines the array of data to use to create each face\r\n     * @param size defines the size of the textures\r\n     * @param format defines the format of the data\r\n     * @param type defines the type of the data (like Engine.TEXTURETYPE_UNSIGNED_INT)\r\n     * @param generateMipMaps  defines if the engine should generate the mip levels\r\n     * @param invertY defines if data must be stored with Y axis inverted\r\n     * @param samplingMode defines the required sampling mode (like Texture.NEAREST_SAMPLINGMODE)\r\n     * @param compression defines the compression used (null by default)\r\n     * @returns the cube texture as an InternalTexture\r\n     */\r\n    public createRawCubeTexture(\r\n        data: Nullable<ArrayBufferView[]>,\r\n        size: number,\r\n        format: number,\r\n        type: number,\r\n        generateMipMaps: boolean,\r\n        invertY: boolean,\r\n        samplingMode: number,\r\n        compression: Nullable<string> = null\r\n    ): InternalTexture {\r\n        throw _WarnImport(\"Engine.RawTexture\");\r\n    }\r\n\r\n    // eslint-disable-next-line jsdoc/require-returns-check\r\n    /**\r\n     * Creates a new raw 3D texture\r\n     * @param data defines the data used to create the texture\r\n     * @param width defines the width of the texture\r\n     * @param height defines the height of the texture\r\n     * @param depth defines the depth of the texture\r\n     * @param format defines the format of the texture\r\n     * @param generateMipMaps defines if the engine must generate mip levels\r\n     * @param invertY defines if data must be stored with Y axis inverted\r\n     * @param samplingMode defines the required sampling mode (like Texture.NEAREST_SAMPLINGMODE)\r\n     * @param compression defines the compressed used (can be null)\r\n     * @param textureType defines the compressed used (can be null)\r\n     * @returns a new raw 3D texture (stored in an InternalTexture)\r\n     */\r\n    public createRawTexture3D(\r\n        data: Nullable<ArrayBufferView>,\r\n        width: number,\r\n        height: number,\r\n        depth: number,\r\n        format: number,\r\n        generateMipMaps: boolean,\r\n        invertY: boolean,\r\n        samplingMode: number,\r\n        compression: Nullable<string> = null,\r\n        textureType = Constants.TEXTURETYPE_UNSIGNED_INT\r\n    ): InternalTexture {\r\n        throw _WarnImport(\"Engine.RawTexture\");\r\n    }\r\n\r\n    // eslint-disable-next-line jsdoc/require-returns-check\r\n    /**\r\n     * Creates a new raw 2D array texture\r\n     * @param data defines the data used to create the texture\r\n     * @param width defines the width of the texture\r\n     * @param height defines the height of the texture\r\n     * @param depth defines the number of layers of the texture\r\n     * @param format defines the format of the texture\r\n     * @param generateMipMaps defines if the engine must generate mip levels\r\n     * @param invertY defines if data must be stored with Y axis inverted\r\n     * @param samplingMode defines the required sampling mode (like Texture.NEAREST_SAMPLINGMODE)\r\n     * @param compression defines the compressed used (can be null)\r\n     * @param textureType defines the compressed used (can be null)\r\n     * @returns a new raw 2D array texture (stored in an InternalTexture)\r\n     */\r\n    public createRawTexture2DArray(\r\n        data: Nullable<ArrayBufferView>,\r\n        width: number,\r\n        height: number,\r\n        depth: number,\r\n        format: number,\r\n        generateMipMaps: boolean,\r\n        invertY: boolean,\r\n        samplingMode: number,\r\n        compression: Nullable<string> = null,\r\n        textureType = Constants.TEXTURETYPE_UNSIGNED_INT\r\n    ): InternalTexture {\r\n        throw _WarnImport(\"Engine.RawTexture\");\r\n    }\r\n\r\n    private _unpackFlipYCached: Nullable<boolean> = null;\r\n\r\n    /**\r\n     * In case you are sharing the context with other applications, it might\r\n     * be interested to not cache the unpack flip y state to ensure a consistent\r\n     * value would be set.\r\n     */\r\n    public enableUnpackFlipYCached = true;\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _unpackFlipY(value: boolean): void {\r\n        if (this._unpackFlipYCached !== value) {\r\n            this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL, value ? 1 : 0);\r\n\r\n            if (this.enableUnpackFlipYCached) {\r\n                this._unpackFlipYCached = value;\r\n            }\r\n        }\r\n    }\r\n\r\n    /** @internal */\r\n    public _getUnpackAlignement(): number {\r\n        return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT);\r\n    }\r\n\r\n    private _getTextureTarget(texture: InternalTexture): number {\r\n        if (texture.isCube) {\r\n            return this._gl.TEXTURE_CUBE_MAP;\r\n        } else if (texture.is3D) {\r\n            return this._gl.TEXTURE_3D;\r\n        } else if (texture.is2DArray || texture.isMultiview) {\r\n            return this._gl.TEXTURE_2D_ARRAY;\r\n        }\r\n        return this._gl.TEXTURE_2D;\r\n    }\r\n\r\n    /**\r\n     * Update the sampling mode of a given texture\r\n     * @param samplingMode defines the required sampling mode\r\n     * @param texture defines the texture to update\r\n     * @param generateMipMaps defines whether to generate mipmaps for the texture\r\n     */\r\n    public updateTextureSamplingMode(samplingMode: number, texture: InternalTexture, generateMipMaps: boolean = false): void {\r\n        const target = this._getTextureTarget(texture);\r\n        const filters = this._getSamplingParameters(samplingMode, texture.useMipMaps || generateMipMaps);\r\n\r\n        this._setTextureParameterInteger(target, this._gl.TEXTURE_MAG_FILTER, filters.mag, texture);\r\n        this._setTextureParameterInteger(target, this._gl.TEXTURE_MIN_FILTER, filters.min);\r\n\r\n        if (generateMipMaps) {\r\n            texture.generateMipMaps = true;\r\n            this._gl.generateMipmap(target);\r\n        }\r\n\r\n        this._bindTextureDirectly(target, null);\r\n\r\n        texture.samplingMode = samplingMode;\r\n    }\r\n\r\n    /**\r\n     * Update the dimensions of a texture\r\n     * @param texture texture to update\r\n     * @param width new width of the texture\r\n     * @param height new height of the texture\r\n     * @param depth new depth of the texture\r\n     */\r\n    public updateTextureDimensions(texture: InternalTexture, width: number, height: number, depth: number = 1): void {}\r\n\r\n    /**\r\n     * Update the sampling mode of a given texture\r\n     * @param texture defines the texture to update\r\n     * @param wrapU defines the texture wrap mode of the u coordinates\r\n     * @param wrapV defines the texture wrap mode of the v coordinates\r\n     * @param wrapR defines the texture wrap mode of the r coordinates\r\n     */\r\n    public updateTextureWrappingMode(texture: InternalTexture, wrapU: Nullable<number>, wrapV: Nullable<number> = null, wrapR: Nullable<number> = null): void {\r\n        const target = this._getTextureTarget(texture);\r\n\r\n        if (wrapU !== null) {\r\n            this._setTextureParameterInteger(target, this._gl.TEXTURE_WRAP_S, this._getTextureWrapMode(wrapU), texture);\r\n            texture._cachedWrapU = wrapU;\r\n        }\r\n        if (wrapV !== null) {\r\n            this._setTextureParameterInteger(target, this._gl.TEXTURE_WRAP_T, this._getTextureWrapMode(wrapV), texture);\r\n            texture._cachedWrapV = wrapV;\r\n        }\r\n        if ((texture.is2DArray || texture.is3D) && wrapR !== null) {\r\n            this._setTextureParameterInteger(target, this._gl.TEXTURE_WRAP_R, this._getTextureWrapMode(wrapR), texture);\r\n            texture._cachedWrapR = wrapR;\r\n        }\r\n\r\n        this._bindTextureDirectly(target, null);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _setupDepthStencilTexture(\r\n        internalTexture: InternalTexture,\r\n        size: number | { width: number; height: number; layers?: number },\r\n        generateStencil: boolean,\r\n        bilinearFiltering: boolean,\r\n        comparisonFunction: number,\r\n        samples = 1\r\n    ): void {\r\n        const width = (<{ width: number; height: number; layers?: number }>size).width || <number>size;\r\n        const height = (<{ width: number; height: number; layers?: number }>size).height || <number>size;\r\n        const layers = (<{ width: number; height: number; layers?: number }>size).layers || 0;\r\n\r\n        internalTexture.baseWidth = width;\r\n        internalTexture.baseHeight = height;\r\n        internalTexture.width = width;\r\n        internalTexture.height = height;\r\n        internalTexture.is2DArray = layers > 0;\r\n        internalTexture.depth = layers;\r\n        internalTexture.isReady = true;\r\n        internalTexture.samples = samples;\r\n        internalTexture.generateMipMaps = false;\r\n        internalTexture.samplingMode = bilinearFiltering ? Constants.TEXTURE_BILINEAR_SAMPLINGMODE : Constants.TEXTURE_NEAREST_SAMPLINGMODE;\r\n        internalTexture.type = Constants.TEXTURETYPE_UNSIGNED_INT;\r\n        internalTexture._comparisonFunction = comparisonFunction;\r\n\r\n        const gl = this._gl;\r\n        const target = this._getTextureTarget(internalTexture);\r\n        const samplingParameters = this._getSamplingParameters(internalTexture.samplingMode, false);\r\n        gl.texParameteri(target, gl.TEXTURE_MAG_FILTER, samplingParameters.mag);\r\n        gl.texParameteri(target, gl.TEXTURE_MIN_FILTER, samplingParameters.min);\r\n        gl.texParameteri(target, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n        gl.texParameteri(target, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n\r\n        // TEXTURE_COMPARE_FUNC/MODE are only availble in WebGL2.\r\n        if (this.webGLVersion > 1) {\r\n            if (comparisonFunction === 0) {\r\n                gl.texParameteri(target, gl.TEXTURE_COMPARE_FUNC, Constants.LEQUAL);\r\n                gl.texParameteri(target, gl.TEXTURE_COMPARE_MODE, gl.NONE);\r\n            } else {\r\n                gl.texParameteri(target, gl.TEXTURE_COMPARE_FUNC, comparisonFunction);\r\n                gl.texParameteri(target, gl.TEXTURE_COMPARE_MODE, gl.COMPARE_REF_TO_TEXTURE);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _uploadCompressedDataToTextureDirectly(\r\n        texture: InternalTexture,\r\n        internalFormat: number,\r\n        width: number,\r\n        height: number,\r\n        data: ArrayBufferView,\r\n        faceIndex: number = 0,\r\n        lod: number = 0\r\n    ) {\r\n        const gl = this._gl;\r\n\r\n        let target: GLenum = gl.TEXTURE_2D;\r\n        if (texture.isCube) {\r\n            target = gl.TEXTURE_CUBE_MAP_POSITIVE_X + faceIndex;\r\n        }\r\n\r\n        if (texture._useSRGBBuffer) {\r\n            switch (internalFormat) {\r\n                case Constants.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2:\r\n                case Constants.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL:\r\n                    // Note, if using ETC1 and sRGB is requested, this will use ETC2 if available.\r\n                    if (this._caps.etc2) {\r\n                        internalFormat = gl.COMPRESSED_SRGB8_ETC2;\r\n                    } else {\r\n                        texture._useSRGBBuffer = false;\r\n                    }\r\n                    break;\r\n                case Constants.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC:\r\n                    if (this._caps.etc2) {\r\n                        internalFormat = gl.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC;\r\n                    } else {\r\n                        texture._useSRGBBuffer = false;\r\n                    }\r\n                    break;\r\n                case Constants.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM:\r\n                    internalFormat = gl.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT;\r\n                    break;\r\n                case Constants.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4:\r\n                    internalFormat = gl.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;\r\n                    break;\r\n                case Constants.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1:\r\n                    if (this._caps.s3tc_srgb) {\r\n                        internalFormat = gl.COMPRESSED_SRGB_S3TC_DXT1_EXT;\r\n                    } else {\r\n                        // S3TC sRGB extension not supported\r\n                        texture._useSRGBBuffer = false;\r\n                    }\r\n                    break;\r\n                case Constants.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1:\r\n                    if (this._caps.s3tc_srgb) {\r\n                        internalFormat = gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;\r\n                    } else {\r\n                        // S3TC sRGB extension not supported\r\n                        texture._useSRGBBuffer = false;\r\n                    }\r\n                    break;\r\n                case Constants.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5:\r\n                    if (this._caps.s3tc_srgb) {\r\n                        internalFormat = gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;\r\n                    } else {\r\n                        // S3TC sRGB extension not supported\r\n                        texture._useSRGBBuffer = false;\r\n                    }\r\n                    break;\r\n                default:\r\n                    // We don't support a sRGB format corresponding to internalFormat, so revert to non sRGB format\r\n                    texture._useSRGBBuffer = false;\r\n                    break;\r\n            }\r\n        }\r\n\r\n        this._gl.compressedTexImage2D(target, lod, internalFormat, width, height, 0, <DataView>data);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _uploadDataToTextureDirectly(\r\n        texture: InternalTexture,\r\n        imageData: ArrayBufferView,\r\n        faceIndex: number = 0,\r\n        lod: number = 0,\r\n        babylonInternalFormat?: number,\r\n        useTextureWidthAndHeight = false\r\n    ): void {\r\n        const gl = this._gl;\r\n\r\n        const textureType = this._getWebGLTextureType(texture.type);\r\n        const format = this._getInternalFormat(texture.format);\r\n        const internalFormat =\r\n            babylonInternalFormat === undefined\r\n                ? this._getRGBABufferInternalSizedFormat(texture.type, texture.format, texture._useSRGBBuffer)\r\n                : this._getInternalFormat(babylonInternalFormat, texture._useSRGBBuffer);\r\n\r\n        this._unpackFlipY(texture.invertY);\r\n\r\n        let target: GLenum = gl.TEXTURE_2D;\r\n        if (texture.isCube) {\r\n            target = gl.TEXTURE_CUBE_MAP_POSITIVE_X + faceIndex;\r\n        }\r\n\r\n        const lodMaxWidth = Math.round(Math.log(texture.width) * Math.LOG2E);\r\n        const lodMaxHeight = Math.round(Math.log(texture.height) * Math.LOG2E);\r\n        const width = useTextureWidthAndHeight ? texture.width : Math.pow(2, Math.max(lodMaxWidth - lod, 0));\r\n        const height = useTextureWidthAndHeight ? texture.height : Math.pow(2, Math.max(lodMaxHeight - lod, 0));\r\n\r\n        gl.texImage2D(target, lod, internalFormat, width, height, 0, format, textureType, imageData);\r\n    }\r\n\r\n    /**\r\n     * Update a portion of an internal texture\r\n     * @param texture defines the texture to update\r\n     * @param imageData defines the data to store into the texture\r\n     * @param xOffset defines the x coordinates of the update rectangle\r\n     * @param yOffset defines the y coordinates of the update rectangle\r\n     * @param width defines the width of the update rectangle\r\n     * @param height defines the height of the update rectangle\r\n     * @param faceIndex defines the face index if texture is a cube (0 by default)\r\n     * @param lod defines the lod level to update (0 by default)\r\n     * @param generateMipMaps defines whether to generate mipmaps or not\r\n     */\r\n    public updateTextureData(\r\n        texture: InternalTexture,\r\n        imageData: ArrayBufferView,\r\n        xOffset: number,\r\n        yOffset: number,\r\n        width: number,\r\n        height: number,\r\n        faceIndex: number = 0,\r\n        lod: number = 0,\r\n        generateMipMaps = false\r\n    ): void {\r\n        const gl = this._gl;\r\n\r\n        const textureType = this._getWebGLTextureType(texture.type);\r\n        const format = this._getInternalFormat(texture.format);\r\n\r\n        this._unpackFlipY(texture.invertY);\r\n\r\n        let targetForBinding: GLenum = gl.TEXTURE_2D;\r\n        let target: GLenum = gl.TEXTURE_2D;\r\n        if (texture.isCube) {\r\n            target = gl.TEXTURE_CUBE_MAP_POSITIVE_X + faceIndex;\r\n            targetForBinding = gl.TEXTURE_CUBE_MAP;\r\n        }\r\n\r\n        this._bindTextureDirectly(targetForBinding, texture, true);\r\n\r\n        gl.texSubImage2D(target, lod, xOffset, yOffset, width, height, format, textureType, imageData);\r\n\r\n        if (generateMipMaps) {\r\n            this._gl.generateMipmap(target);\r\n        }\r\n\r\n        this._bindTextureDirectly(targetForBinding, null);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _uploadArrayBufferViewToTexture(texture: InternalTexture, imageData: ArrayBufferView, faceIndex: number = 0, lod: number = 0): void {\r\n        const gl = this._gl;\r\n        const bindTarget = texture.isCube ? gl.TEXTURE_CUBE_MAP : gl.TEXTURE_2D;\r\n\r\n        this._bindTextureDirectly(bindTarget, texture, true);\r\n\r\n        this._uploadDataToTextureDirectly(texture, imageData, faceIndex, lod);\r\n\r\n        this._bindTextureDirectly(bindTarget, null, true);\r\n    }\r\n\r\n    protected _prepareWebGLTextureContinuation(texture: InternalTexture, scene: Nullable<ISceneLike>, noMipmap: boolean, isCompressed: boolean, samplingMode: number): void {\r\n        const gl = this._gl;\r\n        if (!gl) {\r\n            return;\r\n        }\r\n\r\n        const filters = this._getSamplingParameters(samplingMode, !noMipmap);\r\n\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, filters.mag);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, filters.min);\r\n\r\n        if (!noMipmap && !isCompressed) {\r\n            gl.generateMipmap(gl.TEXTURE_2D);\r\n        }\r\n\r\n        this._bindTextureDirectly(gl.TEXTURE_2D, null);\r\n\r\n        // this.resetTextureCache();\r\n        if (scene) {\r\n            scene.removePendingData(texture);\r\n        }\r\n\r\n        texture.onLoadedObservable.notifyObservers(texture);\r\n        texture.onLoadedObservable.clear();\r\n    }\r\n\r\n    private _prepareWebGLTexture(\r\n        texture: InternalTexture,\r\n        extension: string,\r\n        scene: Nullable<ISceneLike>,\r\n        img: HTMLImageElement | ImageBitmap | { width: number; height: number },\r\n        invertY: boolean,\r\n        noMipmap: boolean,\r\n        isCompressed: boolean,\r\n        processFunction: (\r\n            width: number,\r\n            height: number,\r\n            img: HTMLImageElement | ImageBitmap | { width: number; height: number },\r\n            extension: string,\r\n            texture: InternalTexture,\r\n            continuationCallback: () => void\r\n        ) => boolean,\r\n        samplingMode: number = Constants.TEXTURE_TRILINEAR_SAMPLINGMODE\r\n    ): void {\r\n        const maxTextureSize = this.getCaps().maxTextureSize;\r\n        const potWidth = Math.min(maxTextureSize, this.needPOTTextures ? ThinEngine.GetExponentOfTwo(img.width, maxTextureSize) : img.width);\r\n        const potHeight = Math.min(maxTextureSize, this.needPOTTextures ? ThinEngine.GetExponentOfTwo(img.height, maxTextureSize) : img.height);\r\n\r\n        const gl = this._gl;\r\n        if (!gl) {\r\n            return;\r\n        }\r\n\r\n        if (!texture._hardwareTexture) {\r\n            //  this.resetTextureCache();\r\n            if (scene) {\r\n                scene.removePendingData(texture);\r\n            }\r\n\r\n            return;\r\n        }\r\n\r\n        this._bindTextureDirectly(gl.TEXTURE_2D, texture, true);\r\n        this._unpackFlipY(invertY === undefined ? true : invertY ? true : false);\r\n\r\n        texture.baseWidth = img.width;\r\n        texture.baseHeight = img.height;\r\n        texture.width = potWidth;\r\n        texture.height = potHeight;\r\n        texture.isReady = true;\r\n        texture.type = texture.type !== -1 ? texture.type : Constants.TEXTURETYPE_UNSIGNED_BYTE;\r\n        texture.format = texture.format !== -1 ? texture.format : extension === \".jpg\" && !texture._useSRGBBuffer ? Constants.TEXTUREFORMAT_RGB : Constants.TEXTUREFORMAT_RGBA;\r\n\r\n        if (\r\n            processFunction(potWidth, potHeight, img, extension, texture, () => {\r\n                this._prepareWebGLTextureContinuation(texture, scene, noMipmap, isCompressed, samplingMode);\r\n            })\r\n        ) {\r\n            // Returning as texture needs extra async steps\r\n            return;\r\n        }\r\n\r\n        this._prepareWebGLTextureContinuation(texture, scene, noMipmap, isCompressed, samplingMode);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _setupFramebufferDepthAttachments(\r\n        generateStencilBuffer: boolean,\r\n        generateDepthBuffer: boolean,\r\n        width: number,\r\n        height: number,\r\n        samples = 1\r\n    ): Nullable<WebGLRenderbuffer> {\r\n        const gl = this._gl;\r\n\r\n        // Create the depth/stencil buffer\r\n        if (generateStencilBuffer && generateDepthBuffer) {\r\n            return this._createRenderBuffer(width, height, samples, gl.DEPTH_STENCIL, gl.DEPTH24_STENCIL8, gl.DEPTH_STENCIL_ATTACHMENT);\r\n        }\r\n        if (generateDepthBuffer) {\r\n            let depthFormat: GLenum = gl.DEPTH_COMPONENT16;\r\n            if (this._webGLVersion > 1) {\r\n                depthFormat = gl.DEPTH_COMPONENT32F;\r\n            }\r\n\r\n            return this._createRenderBuffer(width, height, samples, depthFormat, depthFormat, gl.DEPTH_ATTACHMENT);\r\n        }\r\n        if (generateStencilBuffer) {\r\n            return this._createRenderBuffer(width, height, samples, gl.STENCIL_INDEX8, gl.STENCIL_INDEX8, gl.STENCIL_ATTACHMENT);\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _createRenderBuffer(\r\n        width: number,\r\n        height: number,\r\n        samples: number,\r\n        internalFormat: number,\r\n        msInternalFormat: number,\r\n        attachment: number,\r\n        unbindBuffer = true\r\n    ): Nullable<WebGLRenderbuffer> {\r\n        const gl = this._gl;\r\n        const renderBuffer = gl.createRenderbuffer();\r\n        return this._updateRenderBuffer(renderBuffer, width, height, samples, internalFormat, msInternalFormat, attachment, unbindBuffer);\r\n    }\r\n\r\n    public _updateRenderBuffer(\r\n        renderBuffer: Nullable<WebGLRenderbuffer>,\r\n        width: number,\r\n        height: number,\r\n        samples: number,\r\n        internalFormat: number,\r\n        msInternalFormat: number,\r\n        attachment: number,\r\n        unbindBuffer = true\r\n    ): Nullable<WebGLRenderbuffer> {\r\n        const gl = this._gl;\r\n\r\n        gl.bindRenderbuffer(gl.RENDERBUFFER, renderBuffer);\r\n\r\n        if (samples > 1 && gl.renderbufferStorageMultisample) {\r\n            gl.renderbufferStorageMultisample(gl.RENDERBUFFER, samples, msInternalFormat, width, height);\r\n        } else {\r\n            gl.renderbufferStorage(gl.RENDERBUFFER, internalFormat, width, height);\r\n        }\r\n\r\n        gl.framebufferRenderbuffer(gl.FRAMEBUFFER, attachment, gl.RENDERBUFFER, renderBuffer);\r\n\r\n        if (unbindBuffer) {\r\n            gl.bindRenderbuffer(gl.RENDERBUFFER, null);\r\n        }\r\n\r\n        return renderBuffer;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _releaseTexture(texture: InternalTexture): void {\r\n        this._deleteTexture(texture._hardwareTexture?.underlyingResource);\r\n\r\n        // Unbind channels\r\n        this.unbindAllTextures();\r\n\r\n        const index = this._internalTexturesCache.indexOf(texture);\r\n        if (index !== -1) {\r\n            this._internalTexturesCache.splice(index, 1);\r\n        }\r\n\r\n        // Integrated fixed lod samplers.\r\n        if (texture._lodTextureHigh) {\r\n            texture._lodTextureHigh.dispose();\r\n        }\r\n        if (texture._lodTextureMid) {\r\n            texture._lodTextureMid.dispose();\r\n        }\r\n        if (texture._lodTextureLow) {\r\n            texture._lodTextureLow.dispose();\r\n        }\r\n\r\n        // Integrated irradiance map.\r\n        if (texture._irradianceTexture) {\r\n            texture._irradianceTexture.dispose();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _releaseRenderTargetWrapper(rtWrapper: RenderTargetWrapper): void {\r\n        const index = this._renderTargetWrapperCache.indexOf(rtWrapper);\r\n        if (index !== -1) {\r\n            this._renderTargetWrapperCache.splice(index, 1);\r\n        }\r\n    }\r\n\r\n    protected _deleteTexture(texture: Nullable<WebGLTexture>): void {\r\n        if (texture) {\r\n            this._gl.deleteTexture(texture);\r\n        }\r\n    }\r\n\r\n    protected _setProgram(program: WebGLProgram): void {\r\n        if (this._currentProgram !== program) {\r\n            this._gl.useProgram(program);\r\n            this._currentProgram = program;\r\n        }\r\n    }\r\n\r\n    protected _boundUniforms: { [key: number]: WebGLUniformLocation } = {};\r\n\r\n    /**\r\n     * Binds an effect to the webGL context\r\n     * @param effect defines the effect to bind\r\n     */\r\n    public bindSamplers(effect: Effect): void {\r\n        const webGLPipelineContext = effect.getPipelineContext() as WebGLPipelineContext;\r\n        this._setProgram(webGLPipelineContext.program!);\r\n        const samplers = effect.getSamplers();\r\n        for (let index = 0; index < samplers.length; index++) {\r\n            const uniform = effect.getUniform(samplers[index]);\r\n\r\n            if (uniform) {\r\n                this._boundUniforms[index] = uniform;\r\n            }\r\n        }\r\n        this._currentEffect = null;\r\n    }\r\n\r\n    private _activateCurrentTexture() {\r\n        if (this._currentTextureChannel !== this._activeChannel) {\r\n            this._gl.activeTexture(this._gl.TEXTURE0 + this._activeChannel);\r\n            this._currentTextureChannel = this._activeChannel;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _bindTextureDirectly(target: number, texture: Nullable<InternalTexture>, forTextureDataUpdate = false, force = false): boolean {\r\n        let wasPreviouslyBound = false;\r\n        const isTextureForRendering = texture && texture._associatedChannel > -1;\r\n        if (forTextureDataUpdate && isTextureForRendering) {\r\n            this._activeChannel = texture!._associatedChannel;\r\n        }\r\n\r\n        const currentTextureBound = this._boundTexturesCache[this._activeChannel];\r\n\r\n        if (currentTextureBound !== texture || force) {\r\n            this._activateCurrentTexture();\r\n\r\n            if (texture && texture.isMultiview) {\r\n                //this._gl.bindTexture(target, texture ? texture._colorTextureArray : null);\r\n                Logger.Error([\"_bindTextureDirectly called with a multiview texture!\", target, texture]);\r\n                // eslint-disable-next-line no-throw-literal\r\n                throw \"_bindTextureDirectly called with a multiview texture!\";\r\n            } else {\r\n                this._gl.bindTexture(target, texture?._hardwareTexture?.underlyingResource ?? null);\r\n            }\r\n\r\n            this._boundTexturesCache[this._activeChannel] = texture;\r\n\r\n            if (texture) {\r\n                texture._associatedChannel = this._activeChannel;\r\n            }\r\n        } else if (forTextureDataUpdate) {\r\n            wasPreviouslyBound = true;\r\n            this._activateCurrentTexture();\r\n        }\r\n\r\n        if (isTextureForRendering && !forTextureDataUpdate) {\r\n            this._bindSamplerUniformToChannel(texture!._associatedChannel, this._activeChannel);\r\n        }\r\n\r\n        return wasPreviouslyBound;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _bindTexture(channel: number, texture: Nullable<InternalTexture>, name: string): void {\r\n        if (channel === undefined) {\r\n            return;\r\n        }\r\n\r\n        if (texture) {\r\n            texture._associatedChannel = channel;\r\n        }\r\n\r\n        this._activeChannel = channel;\r\n        const target = texture ? this._getTextureTarget(texture) : this._gl.TEXTURE_2D;\r\n        this._bindTextureDirectly(target, texture);\r\n    }\r\n\r\n    /**\r\n     * Unbind all textures from the webGL context\r\n     */\r\n    public unbindAllTextures(): void {\r\n        for (let channel = 0; channel < this._maxSimultaneousTextures; channel++) {\r\n            this._activeChannel = channel;\r\n            this._bindTextureDirectly(this._gl.TEXTURE_2D, null);\r\n            this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP, null);\r\n            if (this.webGLVersion > 1) {\r\n                this._bindTextureDirectly(this._gl.TEXTURE_3D, null);\r\n                this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY, null);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets a texture to the according uniform.\r\n     * @param channel The texture channel\r\n     * @param uniform The uniform to set\r\n     * @param texture The texture to apply\r\n     * @param name The name of the uniform in the effect\r\n     */\r\n    public setTexture(channel: number, uniform: Nullable<WebGLUniformLocation>, texture: Nullable<ThinTexture>, name: string): void {\r\n        if (channel === undefined) {\r\n            return;\r\n        }\r\n\r\n        if (uniform) {\r\n            this._boundUniforms[channel] = uniform;\r\n        }\r\n\r\n        this._setTexture(channel, texture);\r\n    }\r\n\r\n    private _bindSamplerUniformToChannel(sourceSlot: number, destination: number) {\r\n        const uniform = this._boundUniforms[sourceSlot];\r\n        if (!uniform || uniform._currentState === destination) {\r\n            return;\r\n        }\r\n        this._gl.uniform1i(uniform, destination);\r\n        uniform._currentState = destination;\r\n    }\r\n\r\n    private _getTextureWrapMode(mode: number): number {\r\n        switch (mode) {\r\n            case Constants.TEXTURE_WRAP_ADDRESSMODE:\r\n                return this._gl.REPEAT;\r\n            case Constants.TEXTURE_CLAMP_ADDRESSMODE:\r\n                return this._gl.CLAMP_TO_EDGE;\r\n            case Constants.TEXTURE_MIRROR_ADDRESSMODE:\r\n                return this._gl.MIRRORED_REPEAT;\r\n        }\r\n        return this._gl.REPEAT;\r\n    }\r\n\r\n    protected _setTexture(channel: number, texture: Nullable<ThinTexture>, isPartOfTextureArray = false, depthStencilTexture = false, name = \"\"): boolean {\r\n        // Not ready?\r\n        if (!texture) {\r\n            if (this._boundTexturesCache[channel] != null) {\r\n                this._activeChannel = channel;\r\n                this._bindTextureDirectly(this._gl.TEXTURE_2D, null);\r\n                this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP, null);\r\n                if (this.webGLVersion > 1) {\r\n                    this._bindTextureDirectly(this._gl.TEXTURE_3D, null);\r\n                    this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY, null);\r\n                }\r\n            }\r\n            return false;\r\n        }\r\n\r\n        // Video\r\n        if ((<VideoTexture>texture).video) {\r\n            this._activeChannel = channel;\r\n            const videoInternalTexture = (<VideoTexture>texture).getInternalTexture();\r\n            if (videoInternalTexture) {\r\n                videoInternalTexture._associatedChannel = channel;\r\n            }\r\n            (<VideoTexture>texture).update();\r\n        } else if (texture.delayLoadState === Constants.DELAYLOADSTATE_NOTLOADED) {\r\n            // Delay loading\r\n            texture.delayLoad();\r\n            return false;\r\n        }\r\n\r\n        let internalTexture: InternalTexture;\r\n        if (depthStencilTexture) {\r\n            internalTexture = (<RenderTargetTexture>texture).depthStencilTexture!;\r\n        } else if (texture.isReady()) {\r\n            internalTexture = <InternalTexture>texture.getInternalTexture();\r\n        } else if (texture.isCube) {\r\n            internalTexture = this.emptyCubeTexture;\r\n        } else if (texture.is3D) {\r\n            internalTexture = this.emptyTexture3D;\r\n        } else if (texture.is2DArray) {\r\n            internalTexture = this.emptyTexture2DArray;\r\n        } else {\r\n            internalTexture = this.emptyTexture;\r\n        }\r\n\r\n        if (!isPartOfTextureArray && internalTexture) {\r\n            internalTexture._associatedChannel = channel;\r\n        }\r\n\r\n        let needToBind = true;\r\n        if (this._boundTexturesCache[channel] === internalTexture) {\r\n            if (!isPartOfTextureArray) {\r\n                this._bindSamplerUniformToChannel(internalTexture._associatedChannel, channel);\r\n            }\r\n\r\n            needToBind = false;\r\n        }\r\n\r\n        this._activeChannel = channel;\r\n        const target = this._getTextureTarget(internalTexture);\r\n        if (needToBind) {\r\n            this._bindTextureDirectly(target, internalTexture, isPartOfTextureArray);\r\n        }\r\n\r\n        if (internalTexture && !internalTexture.isMultiview) {\r\n            // CUBIC_MODE and SKYBOX_MODE both require CLAMP_TO_EDGE.  All other modes use REPEAT.\r\n            if (internalTexture.isCube && internalTexture._cachedCoordinatesMode !== texture.coordinatesMode) {\r\n                internalTexture._cachedCoordinatesMode = texture.coordinatesMode;\r\n\r\n                const textureWrapMode =\r\n                    texture.coordinatesMode !== Constants.TEXTURE_CUBIC_MODE && texture.coordinatesMode !== Constants.TEXTURE_SKYBOX_MODE\r\n                        ? Constants.TEXTURE_WRAP_ADDRESSMODE\r\n                        : Constants.TEXTURE_CLAMP_ADDRESSMODE;\r\n                texture.wrapU = textureWrapMode;\r\n                texture.wrapV = textureWrapMode;\r\n            }\r\n\r\n            if (internalTexture._cachedWrapU !== texture.wrapU) {\r\n                internalTexture._cachedWrapU = texture.wrapU;\r\n                this._setTextureParameterInteger(target, this._gl.TEXTURE_WRAP_S, this._getTextureWrapMode(texture.wrapU), internalTexture);\r\n            }\r\n\r\n            if (internalTexture._cachedWrapV !== texture.wrapV) {\r\n                internalTexture._cachedWrapV = texture.wrapV;\r\n                this._setTextureParameterInteger(target, this._gl.TEXTURE_WRAP_T, this._getTextureWrapMode(texture.wrapV), internalTexture);\r\n            }\r\n\r\n            if (internalTexture.is3D && internalTexture._cachedWrapR !== texture.wrapR) {\r\n                internalTexture._cachedWrapR = texture.wrapR;\r\n                this._setTextureParameterInteger(target, this._gl.TEXTURE_WRAP_R, this._getTextureWrapMode(texture.wrapR), internalTexture);\r\n            }\r\n\r\n            this._setAnisotropicLevel(target, internalTexture, texture.anisotropicFilteringLevel);\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Sets an array of texture to the webGL context\r\n     * @param channel defines the channel where the texture array must be set\r\n     * @param uniform defines the associated uniform location\r\n     * @param textures defines the array of textures to bind\r\n     * @param name name of the channel\r\n     */\r\n    public setTextureArray(channel: number, uniform: Nullable<WebGLUniformLocation>, textures: ThinTexture[], name: string): void {\r\n        if (channel === undefined || !uniform) {\r\n            return;\r\n        }\r\n\r\n        if (!this._textureUnits || this._textureUnits.length !== textures.length) {\r\n            this._textureUnits = new Int32Array(textures.length);\r\n        }\r\n        for (let i = 0; i < textures.length; i++) {\r\n            const texture = textures[i].getInternalTexture();\r\n\r\n            if (texture) {\r\n                this._textureUnits[i] = channel + i;\r\n                texture._associatedChannel = channel + i;\r\n            } else {\r\n                this._textureUnits[i] = -1;\r\n            }\r\n        }\r\n        this._gl.uniform1iv(uniform, this._textureUnits);\r\n\r\n        for (let index = 0; index < textures.length; index++) {\r\n            this._setTexture(this._textureUnits[index], textures[index], true);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _setAnisotropicLevel(target: number, internalTexture: InternalTexture, anisotropicFilteringLevel: number) {\r\n        const anisotropicFilterExtension = this._caps.textureAnisotropicFilterExtension;\r\n        if (\r\n            internalTexture.samplingMode !== Constants.TEXTURE_LINEAR_LINEAR_MIPNEAREST &&\r\n            internalTexture.samplingMode !== Constants.TEXTURE_LINEAR_LINEAR_MIPLINEAR &&\r\n            internalTexture.samplingMode !== Constants.TEXTURE_LINEAR_LINEAR\r\n        ) {\r\n            anisotropicFilteringLevel = 1; // Forcing the anisotropic to 1 because else webgl will force filters to linear\r\n        }\r\n\r\n        if (anisotropicFilterExtension && internalTexture._cachedAnisotropicFilteringLevel !== anisotropicFilteringLevel) {\r\n            this._setTextureParameterFloat(\r\n                target,\r\n                anisotropicFilterExtension.TEXTURE_MAX_ANISOTROPY_EXT,\r\n                Math.min(anisotropicFilteringLevel, this._caps.maxAnisotropy),\r\n                internalTexture\r\n            );\r\n            internalTexture._cachedAnisotropicFilteringLevel = anisotropicFilteringLevel;\r\n        }\r\n    }\r\n\r\n    private _setTextureParameterFloat(target: number, parameter: number, value: number, texture: InternalTexture): void {\r\n        this._bindTextureDirectly(target, texture, true, true);\r\n        this._gl.texParameterf(target, parameter, value);\r\n    }\r\n\r\n    private _setTextureParameterInteger(target: number, parameter: number, value: number, texture?: InternalTexture) {\r\n        if (texture) {\r\n            this._bindTextureDirectly(target, texture, true, true);\r\n        }\r\n        this._gl.texParameteri(target, parameter, value);\r\n    }\r\n\r\n    /**\r\n     * Unbind all vertex attributes from the webGL context\r\n     */\r\n    public unbindAllAttributes() {\r\n        if (this._mustWipeVertexAttributes) {\r\n            this._mustWipeVertexAttributes = false;\r\n\r\n            for (let i = 0; i < this._caps.maxVertexAttribs; i++) {\r\n                this.disableAttributeByIndex(i);\r\n            }\r\n            return;\r\n        }\r\n\r\n        for (let i = 0, ul = this._vertexAttribArraysEnabled.length; i < ul; i++) {\r\n            if (i >= this._caps.maxVertexAttribs || !this._vertexAttribArraysEnabled[i]) {\r\n                continue;\r\n            }\r\n\r\n            this.disableAttributeByIndex(i);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Force the engine to release all cached effects. This means that next effect compilation will have to be done completely even if a similar effect was already compiled\r\n     */\r\n    public releaseEffects() {\r\n        for (const name in this._compiledEffects) {\r\n            const webGLPipelineContext = this._compiledEffects[name].getPipelineContext() as WebGLPipelineContext;\r\n            this._deletePipelineContext(webGLPipelineContext);\r\n        }\r\n\r\n        this._compiledEffects = {};\r\n    }\r\n\r\n    /**\r\n     * Dispose and release all associated resources\r\n     */\r\n    public dispose(): void {\r\n        this._isDisposed = true;\r\n        this.stopRenderLoop();\r\n\r\n        // Clear observables\r\n        if (this.onBeforeTextureInitObservable) {\r\n            this.onBeforeTextureInitObservable.clear();\r\n        }\r\n\r\n        // Empty texture\r\n        if (this._emptyTexture) {\r\n            this._releaseTexture(this._emptyTexture);\r\n            this._emptyTexture = null;\r\n        }\r\n        if (this._emptyCubeTexture) {\r\n            this._releaseTexture(this._emptyCubeTexture);\r\n            this._emptyCubeTexture = null;\r\n        }\r\n\r\n        if (this._dummyFramebuffer) {\r\n            this._gl.deleteFramebuffer(this._dummyFramebuffer);\r\n        }\r\n\r\n        // Release effects\r\n        this.releaseEffects();\r\n        this.releaseComputeEffects?.();\r\n\r\n        // Unbind\r\n        this.unbindAllAttributes();\r\n        this._boundUniforms = {};\r\n\r\n        // Events\r\n        if (IsWindowObjectExist()) {\r\n            if (this._renderingCanvas) {\r\n                if (!this._doNotHandleContextLost) {\r\n                    this._renderingCanvas.removeEventListener(\"webglcontextlost\", this._onContextLost);\r\n                    this._renderingCanvas.removeEventListener(\"webglcontextrestored\", this._onContextRestored);\r\n                }\r\n\r\n                window.removeEventListener(\"resize\", this._checkForMobile);\r\n            }\r\n        }\r\n\r\n        this._workingCanvas = null;\r\n        this._workingContext = null;\r\n        this._currentBufferPointers.length = 0;\r\n        this._renderingCanvas = null;\r\n        this._currentProgram = null;\r\n        this._boundRenderFunction = null;\r\n\r\n        Effect.ResetCache();\r\n\r\n        // Abort active requests\r\n        for (const request of this._activeRequests) {\r\n            request.abort();\r\n        }\r\n\r\n        this.onDisposeObservable.notifyObservers(this);\r\n        this.onDisposeObservable.clear();\r\n\r\n        if (this._creationOptions.loseContextOnDispose) {\r\n            this._gl.getExtension(\"WEBGL_lose_context\")?.loseContext();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Attach a new callback raised when context lost event is fired\r\n     * @param callback defines the callback to call\r\n     */\r\n    public attachContextLostEvent(callback: (event: WebGLContextEvent) => void): void {\r\n        if (this._renderingCanvas) {\r\n            this._renderingCanvas.addEventListener(\"webglcontextlost\", <any>callback, false);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Attach a new callback raised when context restored event is fired\r\n     * @param callback defines the callback to call\r\n     */\r\n    public attachContextRestoredEvent(callback: (event: WebGLContextEvent) => void): void {\r\n        if (this._renderingCanvas) {\r\n            this._renderingCanvas.addEventListener(\"webglcontextrestored\", <any>callback, false);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get the current error code of the webGL context\r\n     * @returns the error code\r\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/getError\r\n     */\r\n    public getError(): number {\r\n        return this._gl.getError();\r\n    }\r\n\r\n    private _canRenderToFloatFramebuffer(): boolean {\r\n        if (this._webGLVersion > 1) {\r\n            return this._caps.colorBufferFloat;\r\n        }\r\n        return this._canRenderToFramebuffer(Constants.TEXTURETYPE_FLOAT);\r\n    }\r\n\r\n    private _canRenderToHalfFloatFramebuffer(): boolean {\r\n        if (this._webGLVersion > 1) {\r\n            return this._caps.colorBufferFloat;\r\n        }\r\n        return this._canRenderToFramebuffer(Constants.TEXTURETYPE_HALF_FLOAT);\r\n    }\r\n\r\n    // Thank you : http://stackoverflow.com/questions/28827511/webgl-ios-render-to-floating-point-texture\r\n    private _canRenderToFramebuffer(type: number): boolean {\r\n        const gl = this._gl;\r\n\r\n        //clear existing errors\r\n        // eslint-disable-next-line no-empty\r\n        while (gl.getError() !== gl.NO_ERROR) {}\r\n\r\n        let successful = true;\r\n\r\n        const texture = gl.createTexture();\r\n        gl.bindTexture(gl.TEXTURE_2D, texture);\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, this._getRGBABufferInternalSizedFormat(type), 1, 1, 0, gl.RGBA, this._getWebGLTextureType(type), null);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n\r\n        const fb = gl.createFramebuffer();\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, fb);\r\n        gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0);\r\n        const status = gl.checkFramebufferStatus(gl.FRAMEBUFFER);\r\n\r\n        successful = successful && status === gl.FRAMEBUFFER_COMPLETE;\r\n        successful = successful && gl.getError() === gl.NO_ERROR;\r\n\r\n        //try render by clearing frame buffer's color buffer\r\n        if (successful) {\r\n            gl.clear(gl.COLOR_BUFFER_BIT);\r\n            successful = successful && gl.getError() === gl.NO_ERROR;\r\n        }\r\n\r\n        //try reading from frame to ensure render occurs (just creating the FBO is not sufficient to determine if rendering is supported)\r\n        if (successful) {\r\n            //in practice it's sufficient to just read from the backbuffer rather than handle potentially issues reading from the texture\r\n            gl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n            const readFormat = gl.RGBA;\r\n            const readType = gl.UNSIGNED_BYTE;\r\n            const buffer = new Uint8Array(4);\r\n            gl.readPixels(0, 0, 1, 1, readFormat, readType, buffer);\r\n            successful = successful && gl.getError() === gl.NO_ERROR;\r\n        }\r\n\r\n        //clean up\r\n        gl.deleteTexture(texture);\r\n        gl.deleteFramebuffer(fb);\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n\r\n        //clear accumulated errors\r\n        // eslint-disable-next-line no-empty\r\n        while (!successful && gl.getError() !== gl.NO_ERROR) {}\r\n\r\n        return successful;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _getWebGLTextureType(type: number): number {\r\n        if (this._webGLVersion === 1) {\r\n            switch (type) {\r\n                case Constants.TEXTURETYPE_FLOAT:\r\n                    return this._gl.FLOAT;\r\n                case Constants.TEXTURETYPE_HALF_FLOAT:\r\n                    return this._gl.HALF_FLOAT_OES;\r\n                case Constants.TEXTURETYPE_UNSIGNED_BYTE:\r\n                    return this._gl.UNSIGNED_BYTE;\r\n                case Constants.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4:\r\n                    return this._gl.UNSIGNED_SHORT_4_4_4_4;\r\n                case Constants.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1:\r\n                    return this._gl.UNSIGNED_SHORT_5_5_5_1;\r\n                case Constants.TEXTURETYPE_UNSIGNED_SHORT_5_6_5:\r\n                    return this._gl.UNSIGNED_SHORT_5_6_5;\r\n            }\r\n            return this._gl.UNSIGNED_BYTE;\r\n        }\r\n\r\n        switch (type) {\r\n            case Constants.TEXTURETYPE_BYTE:\r\n                return this._gl.BYTE;\r\n            case Constants.TEXTURETYPE_UNSIGNED_BYTE:\r\n                return this._gl.UNSIGNED_BYTE;\r\n            case Constants.TEXTURETYPE_SHORT:\r\n                return this._gl.SHORT;\r\n            case Constants.TEXTURETYPE_UNSIGNED_SHORT:\r\n                return this._gl.UNSIGNED_SHORT;\r\n            case Constants.TEXTURETYPE_INT:\r\n                return this._gl.INT;\r\n            case Constants.TEXTURETYPE_UNSIGNED_INTEGER: // Refers to UNSIGNED_INT\r\n                return this._gl.UNSIGNED_INT;\r\n            case Constants.TEXTURETYPE_FLOAT:\r\n                return this._gl.FLOAT;\r\n            case Constants.TEXTURETYPE_HALF_FLOAT:\r\n                return this._gl.HALF_FLOAT;\r\n            case Constants.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4:\r\n                return this._gl.UNSIGNED_SHORT_4_4_4_4;\r\n            case Constants.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1:\r\n                return this._gl.UNSIGNED_SHORT_5_5_5_1;\r\n            case Constants.TEXTURETYPE_UNSIGNED_SHORT_5_6_5:\r\n                return this._gl.UNSIGNED_SHORT_5_6_5;\r\n            case Constants.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV:\r\n                return this._gl.UNSIGNED_INT_2_10_10_10_REV;\r\n            case Constants.TEXTURETYPE_UNSIGNED_INT_24_8:\r\n                return this._gl.UNSIGNED_INT_24_8;\r\n            case Constants.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV:\r\n                return this._gl.UNSIGNED_INT_10F_11F_11F_REV;\r\n            case Constants.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV:\r\n                return this._gl.UNSIGNED_INT_5_9_9_9_REV;\r\n            case Constants.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV:\r\n                return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV;\r\n        }\r\n\r\n        return this._gl.UNSIGNED_BYTE;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _getInternalFormat(format: number, useSRGBBuffer = false): number {\r\n        let internalFormat: GLenum = useSRGBBuffer ? this._glSRGBExtensionValues.SRGB8_ALPHA8 : this._gl.RGBA;\r\n\r\n        switch (format) {\r\n            case Constants.TEXTUREFORMAT_ALPHA:\r\n                internalFormat = this._gl.ALPHA;\r\n                break;\r\n            case Constants.TEXTUREFORMAT_LUMINANCE:\r\n                internalFormat = this._gl.LUMINANCE;\r\n                break;\r\n            case Constants.TEXTUREFORMAT_LUMINANCE_ALPHA:\r\n                internalFormat = this._gl.LUMINANCE_ALPHA;\r\n                break;\r\n            case Constants.TEXTUREFORMAT_RED:\r\n                internalFormat = this._gl.RED;\r\n                break;\r\n            case Constants.TEXTUREFORMAT_RG:\r\n                internalFormat = this._gl.RG;\r\n                break;\r\n            case Constants.TEXTUREFORMAT_RGB:\r\n                internalFormat = useSRGBBuffer ? this._glSRGBExtensionValues.SRGB : this._gl.RGB;\r\n                break;\r\n            case Constants.TEXTUREFORMAT_RGBA:\r\n                internalFormat = useSRGBBuffer ? this._glSRGBExtensionValues.SRGB8_ALPHA8 : this._gl.RGBA;\r\n                break;\r\n        }\r\n\r\n        if (this._webGLVersion > 1) {\r\n            switch (format) {\r\n                case Constants.TEXTUREFORMAT_RED_INTEGER:\r\n                    internalFormat = this._gl.RED_INTEGER;\r\n                    break;\r\n                case Constants.TEXTUREFORMAT_RG_INTEGER:\r\n                    internalFormat = this._gl.RG_INTEGER;\r\n                    break;\r\n                case Constants.TEXTUREFORMAT_RGB_INTEGER:\r\n                    internalFormat = this._gl.RGB_INTEGER;\r\n                    break;\r\n                case Constants.TEXTUREFORMAT_RGBA_INTEGER:\r\n                    internalFormat = this._gl.RGBA_INTEGER;\r\n                    break;\r\n            }\r\n        }\r\n\r\n        return internalFormat;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _getRGBABufferInternalSizedFormat(type: number, format?: number, useSRGBBuffer = false): number {\r\n        if (this._webGLVersion === 1) {\r\n            if (format !== undefined) {\r\n                switch (format) {\r\n                    case Constants.TEXTUREFORMAT_ALPHA:\r\n                        return this._gl.ALPHA;\r\n                    case Constants.TEXTUREFORMAT_LUMINANCE:\r\n                        return this._gl.LUMINANCE;\r\n                    case Constants.TEXTUREFORMAT_LUMINANCE_ALPHA:\r\n                        return this._gl.LUMINANCE_ALPHA;\r\n                    case Constants.TEXTUREFORMAT_RGB:\r\n                        return useSRGBBuffer ? this._glSRGBExtensionValues.SRGB : this._gl.RGB;\r\n                }\r\n            }\r\n            return this._gl.RGBA;\r\n        }\r\n\r\n        switch (type) {\r\n            case Constants.TEXTURETYPE_BYTE:\r\n                switch (format) {\r\n                    case Constants.TEXTUREFORMAT_RED:\r\n                        return this._gl.R8_SNORM;\r\n                    case Constants.TEXTUREFORMAT_RG:\r\n                        return this._gl.RG8_SNORM;\r\n                    case Constants.TEXTUREFORMAT_RGB:\r\n                        return this._gl.RGB8_SNORM;\r\n                    case Constants.TEXTUREFORMAT_RED_INTEGER:\r\n                        return this._gl.R8I;\r\n                    case Constants.TEXTUREFORMAT_RG_INTEGER:\r\n                        return this._gl.RG8I;\r\n                    case Constants.TEXTUREFORMAT_RGB_INTEGER:\r\n                        return this._gl.RGB8I;\r\n                    case Constants.TEXTUREFORMAT_RGBA_INTEGER:\r\n                        return this._gl.RGBA8I;\r\n                    default:\r\n                        return this._gl.RGBA8_SNORM;\r\n                }\r\n            case Constants.TEXTURETYPE_UNSIGNED_BYTE:\r\n                switch (format) {\r\n                    case Constants.TEXTUREFORMAT_RED:\r\n                        return this._gl.R8;\r\n                    case Constants.TEXTUREFORMAT_RG:\r\n                        return this._gl.RG8;\r\n                    case Constants.TEXTUREFORMAT_RGB:\r\n                        return useSRGBBuffer ? this._glSRGBExtensionValues.SRGB8 : this._gl.RGB8; // By default. Other possibilities are RGB565, SRGB8.\r\n                    case Constants.TEXTUREFORMAT_RGBA:\r\n                        return useSRGBBuffer ? this._glSRGBExtensionValues.SRGB8_ALPHA8 : this._gl.RGBA8; // By default. Other possibilities are RGB5_A1, RGBA4, SRGB8_ALPHA8.\r\n                    case Constants.TEXTUREFORMAT_RED_INTEGER:\r\n                        return this._gl.R8UI;\r\n                    case Constants.TEXTUREFORMAT_RG_INTEGER:\r\n                        return this._gl.RG8UI;\r\n                    case Constants.TEXTUREFORMAT_RGB_INTEGER:\r\n                        return this._gl.RGB8UI;\r\n                    case Constants.TEXTUREFORMAT_RGBA_INTEGER:\r\n                        return this._gl.RGBA8UI;\r\n                    case Constants.TEXTUREFORMAT_ALPHA:\r\n                        return this._gl.ALPHA;\r\n                    case Constants.TEXTUREFORMAT_LUMINANCE:\r\n                        return this._gl.LUMINANCE;\r\n                    case Constants.TEXTUREFORMAT_LUMINANCE_ALPHA:\r\n                        return this._gl.LUMINANCE_ALPHA;\r\n                    default:\r\n                        return this._gl.RGBA8;\r\n                }\r\n            case Constants.TEXTURETYPE_SHORT:\r\n                switch (format) {\r\n                    case Constants.TEXTUREFORMAT_RED_INTEGER:\r\n                        return this._gl.R16I;\r\n                    case Constants.TEXTUREFORMAT_RG_INTEGER:\r\n                        return this._gl.RG16I;\r\n                    case Constants.TEXTUREFORMAT_RGB_INTEGER:\r\n                        return this._gl.RGB16I;\r\n                    case Constants.TEXTUREFORMAT_RGBA_INTEGER:\r\n                        return this._gl.RGBA16I;\r\n                    default:\r\n                        return this._gl.RGBA16I;\r\n                }\r\n            case Constants.TEXTURETYPE_UNSIGNED_SHORT:\r\n                switch (format) {\r\n                    case Constants.TEXTUREFORMAT_RED_INTEGER:\r\n                        return this._gl.R16UI;\r\n                    case Constants.TEXTUREFORMAT_RG_INTEGER:\r\n                        return this._gl.RG16UI;\r\n                    case Constants.TEXTUREFORMAT_RGB_INTEGER:\r\n                        return this._gl.RGB16UI;\r\n                    case Constants.TEXTUREFORMAT_RGBA_INTEGER:\r\n                        return this._gl.RGBA16UI;\r\n                    default:\r\n                        return this._gl.RGBA16UI;\r\n                }\r\n            case Constants.TEXTURETYPE_INT:\r\n                switch (format) {\r\n                    case Constants.TEXTUREFORMAT_RED_INTEGER:\r\n                        return this._gl.R32I;\r\n                    case Constants.TEXTUREFORMAT_RG_INTEGER:\r\n                        return this._gl.RG32I;\r\n                    case Constants.TEXTUREFORMAT_RGB_INTEGER:\r\n                        return this._gl.RGB32I;\r\n                    case Constants.TEXTUREFORMAT_RGBA_INTEGER:\r\n                        return this._gl.RGBA32I;\r\n                    default:\r\n                        return this._gl.RGBA32I;\r\n                }\r\n            case Constants.TEXTURETYPE_UNSIGNED_INTEGER: // Refers to UNSIGNED_INT\r\n                switch (format) {\r\n                    case Constants.TEXTUREFORMAT_RED_INTEGER:\r\n                        return this._gl.R32UI;\r\n                    case Constants.TEXTUREFORMAT_RG_INTEGER:\r\n                        return this._gl.RG32UI;\r\n                    case Constants.TEXTUREFORMAT_RGB_INTEGER:\r\n                        return this._gl.RGB32UI;\r\n                    case Constants.TEXTUREFORMAT_RGBA_INTEGER:\r\n                        return this._gl.RGBA32UI;\r\n                    default:\r\n                        return this._gl.RGBA32UI;\r\n                }\r\n            case Constants.TEXTURETYPE_FLOAT:\r\n                switch (format) {\r\n                    case Constants.TEXTUREFORMAT_RED:\r\n                        return this._gl.R32F; // By default. Other possibility is R16F.\r\n                    case Constants.TEXTUREFORMAT_RG:\r\n                        return this._gl.RG32F; // By default. Other possibility is RG16F.\r\n                    case Constants.TEXTUREFORMAT_RGB:\r\n                        return this._gl.RGB32F; // By default. Other possibilities are RGB16F, R11F_G11F_B10F, RGB9_E5.\r\n                    case Constants.TEXTUREFORMAT_RGBA:\r\n                        return this._gl.RGBA32F; // By default. Other possibility is RGBA16F.\r\n                    default:\r\n                        return this._gl.RGBA32F;\r\n                }\r\n            case Constants.TEXTURETYPE_HALF_FLOAT:\r\n                switch (format) {\r\n                    case Constants.TEXTUREFORMAT_RED:\r\n                        return this._gl.R16F;\r\n                    case Constants.TEXTUREFORMAT_RG:\r\n                        return this._gl.RG16F;\r\n                    case Constants.TEXTUREFORMAT_RGB:\r\n                        return this._gl.RGB16F; // By default. Other possibilities are R11F_G11F_B10F, RGB9_E5.\r\n                    case Constants.TEXTUREFORMAT_RGBA:\r\n                        return this._gl.RGBA16F;\r\n                    default:\r\n                        return this._gl.RGBA16F;\r\n                }\r\n            case Constants.TEXTURETYPE_UNSIGNED_SHORT_5_6_5:\r\n                return this._gl.RGB565;\r\n            case Constants.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV:\r\n                return this._gl.R11F_G11F_B10F;\r\n            case Constants.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV:\r\n                return this._gl.RGB9_E5;\r\n            case Constants.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4:\r\n                return this._gl.RGBA4;\r\n            case Constants.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1:\r\n                return this._gl.RGB5_A1;\r\n            case Constants.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV:\r\n                switch (format) {\r\n                    case Constants.TEXTUREFORMAT_RGBA:\r\n                        return this._gl.RGB10_A2; // By default. Other possibility is RGB5_A1.\r\n                    case Constants.TEXTUREFORMAT_RGBA_INTEGER:\r\n                        return this._gl.RGB10_A2UI;\r\n                    default:\r\n                        return this._gl.RGB10_A2;\r\n                }\r\n        }\r\n\r\n        return useSRGBBuffer ? this._glSRGBExtensionValues.SRGB8_ALPHA8 : this._gl.RGBA8;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _loadFile(\r\n        url: string,\r\n        onSuccess: (data: string | ArrayBuffer, responseURL?: string) => void,\r\n        onProgress?: (data: any) => void,\r\n        offlineProvider?: IOfflineProvider,\r\n        useArrayBuffer?: boolean,\r\n        onError?: (request?: IWebRequest, exception?: any) => void\r\n    ): IFileRequest {\r\n        const request = ThinEngine._FileToolsLoadFile(url, onSuccess, onProgress, offlineProvider, useArrayBuffer, onError);\r\n        this._activeRequests.push(request);\r\n        request.onCompleteObservable.add((request) => {\r\n            this._activeRequests.splice(this._activeRequests.indexOf(request), 1);\r\n        });\r\n        return request;\r\n    }\r\n\r\n    /**\r\n     * Loads a file from a url\r\n     * @param url url to load\r\n     * @param onSuccess callback called when the file successfully loads\r\n     * @param onProgress callback called while file is loading (if the server supports this mode)\r\n     * @param offlineProvider defines the offline provider for caching\r\n     * @param useArrayBuffer defines a boolean indicating that date must be returned as ArrayBuffer\r\n     * @param onError callback called when the file fails to load\r\n     * @returns a file request object\r\n     * @internal\r\n     */\r\n    public static _FileToolsLoadFile(\r\n        url: string,\r\n        onSuccess: (data: string | ArrayBuffer, responseURL?: string) => void,\r\n        onProgress?: (ev: ProgressEvent) => void,\r\n        offlineProvider?: IOfflineProvider,\r\n        useArrayBuffer?: boolean,\r\n        onError?: (request?: WebRequest, exception?: LoadFileError) => void\r\n    ): IFileRequest {\r\n        throw _WarnImport(\"FileTools\");\r\n    }\r\n\r\n    /**\r\n     * Reads pixels from the current frame buffer. Please note that this function can be slow\r\n     * @param x defines the x coordinate of the rectangle where pixels must be read\r\n     * @param y defines the y coordinate of the rectangle where pixels must be read\r\n     * @param width defines the width of the rectangle where pixels must be read\r\n     * @param height defines the height of the rectangle where pixels must be read\r\n     * @param hasAlpha defines whether the output should have alpha or not (defaults to true)\r\n     * @param flushRenderer true to flush the renderer from the pending commands before reading the pixels\r\n     * @returns a ArrayBufferView promise (Uint8Array) containing RGBA colors\r\n     */\r\n    public readPixels(x: number, y: number, width: number, height: number, hasAlpha = true, flushRenderer = true): Promise<ArrayBufferView> {\r\n        const numChannels = hasAlpha ? 4 : 3;\r\n        const format = hasAlpha ? this._gl.RGBA : this._gl.RGB;\r\n        const data = new Uint8Array(height * width * numChannels);\r\n        if (flushRenderer) {\r\n            this.flushFramebuffer();\r\n        }\r\n        this._gl.readPixels(x, y, width, height, format, this._gl.UNSIGNED_BYTE, data);\r\n        return Promise.resolve(data);\r\n    }\r\n\r\n    // Statics\r\n\r\n    private static _IsSupported: Nullable<boolean> = null;\r\n    private static _HasMajorPerformanceCaveat: Nullable<boolean> = null;\r\n\r\n    /**\r\n     * Gets a Promise<boolean> indicating if the engine can be instantiated (ie. if a webGL context can be found)\r\n     */\r\n    public static get IsSupportedAsync(): Promise<boolean> {\r\n        return Promise.resolve(this.isSupported());\r\n    }\r\n\r\n    /**\r\n     * Gets a boolean indicating if the engine can be instantiated (ie. if a webGL context can be found)\r\n     */\r\n    public static get IsSupported(): boolean {\r\n        return this.isSupported(); // Backward compat\r\n    }\r\n\r\n    /**\r\n     * Gets a boolean indicating if the engine can be instantiated (ie. if a webGL context can be found)\r\n     * @returns true if the engine can be created\r\n     * @ignorenaming\r\n     */\r\n    // eslint-disable-next-line @typescript-eslint/naming-convention\r\n    public static isSupported(): boolean {\r\n        if (this._HasMajorPerformanceCaveat !== null) {\r\n            return !this._HasMajorPerformanceCaveat; // We know it is performant so WebGL is supported\r\n        }\r\n\r\n        if (this._IsSupported === null) {\r\n            try {\r\n                const tempcanvas = this._CreateCanvas(1, 1);\r\n                const gl = tempcanvas.getContext(\"webgl\") || (tempcanvas as any).getContext(\"experimental-webgl\");\r\n\r\n                this._IsSupported = gl != null && !!window.WebGLRenderingContext;\r\n            } catch (e) {\r\n                this._IsSupported = false;\r\n            }\r\n        }\r\n\r\n        return this._IsSupported;\r\n    }\r\n\r\n    /**\r\n     * Gets a boolean indicating if the engine can be instantiated on a performant device (ie. if a webGL context can be found and it does not use a slow implementation)\r\n     */\r\n    public static get HasMajorPerformanceCaveat(): boolean {\r\n        if (this._HasMajorPerformanceCaveat === null) {\r\n            try {\r\n                const tempcanvas = this._CreateCanvas(1, 1);\r\n                const gl =\r\n                    tempcanvas.getContext(\"webgl\", { failIfMajorPerformanceCaveat: true }) ||\r\n                    (tempcanvas as any).getContext(\"experimental-webgl\", { failIfMajorPerformanceCaveat: true });\r\n\r\n                this._HasMajorPerformanceCaveat = !gl;\r\n            } catch (e) {\r\n                this._HasMajorPerformanceCaveat = false;\r\n            }\r\n        }\r\n\r\n        return this._HasMajorPerformanceCaveat;\r\n    }\r\n\r\n    /**\r\n     * Find the next highest power of two.\r\n     * @param x Number to start search from.\r\n     * @returns Next highest power of two.\r\n     */\r\n    public static CeilingPOT(x: number): number {\r\n        x--;\r\n        x |= x >> 1;\r\n        x |= x >> 2;\r\n        x |= x >> 4;\r\n        x |= x >> 8;\r\n        x |= x >> 16;\r\n        x++;\r\n        return x;\r\n    }\r\n\r\n    /**\r\n     * Find the next lowest power of two.\r\n     * @param x Number to start search from.\r\n     * @returns Next lowest power of two.\r\n     */\r\n    public static FloorPOT(x: number): number {\r\n        x = x | (x >> 1);\r\n        x = x | (x >> 2);\r\n        x = x | (x >> 4);\r\n        x = x | (x >> 8);\r\n        x = x | (x >> 16);\r\n        return x - (x >> 1);\r\n    }\r\n\r\n    /**\r\n     * Find the nearest power of two.\r\n     * @param x Number to start search from.\r\n     * @returns Next nearest power of two.\r\n     */\r\n    public static NearestPOT(x: number): number {\r\n        const c = ThinEngine.CeilingPOT(x);\r\n        const f = ThinEngine.FloorPOT(x);\r\n        return c - x > x - f ? f : c;\r\n    }\r\n\r\n    /**\r\n     * Get the closest exponent of two\r\n     * @param value defines the value to approximate\r\n     * @param max defines the maximum value to return\r\n     * @param mode defines how to define the closest value\r\n     * @returns closest exponent of two of the given value\r\n     */\r\n    public static GetExponentOfTwo(value: number, max: number, mode = Constants.SCALEMODE_NEAREST): number {\r\n        let pot;\r\n\r\n        switch (mode) {\r\n            case Constants.SCALEMODE_FLOOR:\r\n                pot = ThinEngine.FloorPOT(value);\r\n                break;\r\n            case Constants.SCALEMODE_NEAREST:\r\n                pot = ThinEngine.NearestPOT(value);\r\n                break;\r\n            case Constants.SCALEMODE_CEILING:\r\n            default:\r\n                pot = ThinEngine.CeilingPOT(value);\r\n                break;\r\n        }\r\n\r\n        return Math.min(pot, max);\r\n    }\r\n\r\n    /**\r\n     * Queue a new function into the requested animation frame pool (ie. this function will be executed by the browser (or the javascript engine) for the next frame)\r\n     * @param func - the function to be called\r\n     * @param requester - the object that will request the next frame. Falls back to window.\r\n     * @returns frame number\r\n     */\r\n    public static QueueNewFrame(func: () => void, requester?: any): number {\r\n        // Note that there is kind of a typing issue here, as `setTimeout` might return something else than a number (NodeJs returns a NodeJS.Timeout object).\r\n        // Also if the global `requestAnimationFrame`'s returnType is number, `requester.requestPostAnimationFrame` and `requester.requestAnimationFrame` types\r\n        // are `any`.\r\n\r\n        if (!IsWindowObjectExist()) {\r\n            if (typeof requestAnimationFrame === \"function\") {\r\n                return requestAnimationFrame(func);\r\n            }\r\n        } else {\r\n            const { requestAnimationFrame } = requester || window;\r\n            if (typeof requestAnimationFrame === \"function\") {\r\n                return requestAnimationFrame(func);\r\n            }\r\n        }\r\n\r\n        // fallback to the global `setTimeout`.\r\n        // In most cases (aka in the browser), `window` is the global object, so instead of calling `window.setTimeout` we could call the global `setTimeout`.\r\n        return setTimeout(func, 16) as unknown as number;\r\n    }\r\n\r\n    /**\r\n     * Gets host document\r\n     * @returns the host document object\r\n     */\r\n    public getHostDocument(): Nullable<Document> {\r\n        if (this._renderingCanvas && this._renderingCanvas.ownerDocument) {\r\n            return this._renderingCanvas.ownerDocument;\r\n        }\r\n\r\n        return IsDocumentAvailable() ? document : null;\r\n    }\r\n}\r\n\r\ninterface TexImageParameters {\r\n    internalFormat: number;\r\n    format: number;\r\n    type: number;\r\n}\r\n"],
  "mappings": ";;;;;;;;;;;;;AAAA,IAKa;AALb;;AAKM,IAAO,SAAP,MAAO,QAAM;MAkDP,OAAO,YAAY,SAAiB,OAAa;AACrD,YAAI,QAAQ,QAAO,iBAAiB,OAAO;AAC3C,YAAI,CAAC,OAAO;AACR,kBAAQ,EAAE,OAAO,SAAS,EAAC;AAC3B,kBAAO,iBAAiB,OAAO,IAAI;eAChC;AACH,gBAAM;;AAEV,eAAO,MAAM,WAAW,MAAM;MAClC;MAEQ,OAAO,sBAAsB,SAAiB,QAAgB,GAAC;AACnE,cAAM,QAAQ,QAAO,iBAAiB,OAAO;AAC7C,YAAI,CAAC,SAAS,CAAC,QAAO,qBAAqB;AACvC;;AAEJ,cAAM,OAAO,KAAK,QAAQ,KAAK;AAC/B,YAAI,MAAM,YAAY,MAAM,OAAO;AAC/B,kBAAO,KAAK,IAAgC,EAAE,QAAO,oBAAoB,QAAQ,YAAY,KAAK,MAAM,KAAK,EAAE,QAAQ,WAAW,KAAK,QAAQ,EAAE,CAAC;;MAE1J;MAEQ,OAAO,aAAa,OAAa;AACrC,gBAAO,YAAY,QAAQ,QAAO;AAElC,YAAI,QAAO,iBAAiB;AACxB,kBAAO,gBAAgB,KAAK;;MAEpC;MAEQ,OAAO,eAAe,SAAe;AACzC,cAAM,SAAS,CAAC,MAAe,IAAI,KAAK,MAAM,IAAI,KAAK;AAEvD,cAAM,OAAO,oBAAI,KAAI;AACrB,eAAO,MAAM,OAAO,KAAK,SAAQ,CAAE,IAAI,MAAM,OAAO,KAAK,WAAU,CAAE,IAAI,MAAM,OAAO,KAAK,WAAU,CAAE,IAAI,QAAQ;MACvH;;MAGQ,OAAO,aAAa,SAAyB,OAAc;MAEnE;MACQ,OAAO,YAAY,QAAgB,GAAG,SAAyB,OAAc;AAEjF,cAAM,MAAM,MAAM,QAAQ,OAAO,IAAI,QAAQ,CAAC,IAAI;AAClD,YAAI,UAAU,UAAa,CAAC,QAAO,YAAY,KAAK,KAAK,GAAG;AACxD;;AAGJ,cAAM,mBAAmB,QAAO,eAAe,GAAG;AAClD,cAAM,OAAO,KAAK,QAAQ,KAAK;AAC/B,cAAM,YAAY,MAAM,QAAQ,OAAO,IAAI,QAAQ,MAAM,CAAC,IAAI,CAAA;AAC9D,aAAK,WAAW,KAAK,QAAQ,WAAW,kBAAkB,GAAG,SAAS;AAEtE,cAAM,QAAQ,qBAAqB,KAAK,KAAK,KAAK,gBAAgB;AAClE,gBAAO,aAAa,KAAK;AACzB,gBAAO,sBAAsB,KAAK,KAAK;MAC3C;;;;MAoBO,WAAW,WAAQ;AACtB,eAAO,QAAO;MAClB;;;;MAKO,OAAO,gBAAa;AACvB,gBAAO,YAAY;AACnB,gBAAO,mBAAmB,CAAA;AAC1B,gBAAO,cAAc;MACzB;;;;MAKO,WAAW,UAAU,OAAa;AACrC,gBAAO,MAAM,QAAO;AACpB,gBAAO,OAAO,QAAO;AACrB,gBAAO,QAAQ,QAAO;AACtB,SAAC,QAAO,iBAAiB,QAAO,iBAAiB,QAAO,aAAa,EAAE,QAAQ,CAAC,MAAK;AACjF,eAAK,QAAQ,OAAO,GAAG;AACnB,kBAAM,OAAO,KAAK,QAAQ,CAAC;AAC3B,oBAAO,KAAK,IAAgC,IAAI,QAAO,YAAY,KAAK,SAAQ,CAAC;;QAEzF,CAAC;MACL;;AApJuB,WAAA,eAAe;AAIf,WAAA,kBAAkB;AAIlB,WAAA,kBAAkB;AAIlB,WAAA,gBAAgB;AAIhB,WAAA,cAAc;AAKvB,WAAA,sBAAsB;AAErB,WAAA,YAAY;AACZ,WAAA,mBAA8E,CAAA;AAE9E,WAAA,UAAU;MACrB,CAAA;MACA,EAAE,OAAO,SAAS,SAAS,QAAQ,KAAK,MAAM,MAAK;MACnD,EAAE,OAAO,UAAU,SAAS,QAAQ,MAAM,MAAM,OAAM;MACtD,CAAA;MACA,EAAE,OAAO,OAAO,SAAS,QAAQ,OAAO,MAAM,QAAO;;AAQ3C,WAAA,cAAc;AAoEd,WAAA,MAAyD,OAAO,YAAY,KAAK,QAAQ,OAAO,eAAe;AAK/G,WAAA,OAA0D,OAAO,YAAY,KAAK,QAAQ,OAAO,eAAe;AAKhH,WAAA,QAA2D,OAAO,YAAY,KAAK,QAAQ,OAAO,aAAa;;;;;AC1H3H,SAAU,YAAY,MAAc,WAAW,OAAK;AACtD,MAAI,YAAY,UAAU,IAAI,GAAG;AAC7B;;AAEJ,YAAU,IAAI,IAAI;AAClB,SAAO,GAAG,IAAI;AAClB;AAVA,IAAM;AAAN;;IAAM,YAAwC,CAAA;;;;;ACKxC,SAAU,sBAAmB;AAC/B,SAAO,OAAO,WAAW;AAC7B;AAMM,SAAU,uBAAoB;AAChC,SAAO,OAAO,cAAc;AAChC;AAMM,SAAU,sBAAmB;AAC/B,SAAO,OAAO,aAAa;AAC/B;AAOM,SAAU,kBAAkB,SAAoB;AAClD,MAAI,SAAS;AACb,MAAI,QAAQ,QAAQ;AAEpB,SAAO,OAAO;AACV,QAAI,MAAM,aAAa,GAAG;AACtB,gBAAU,MAAM;;AAEpB,YAAa,MAAM;;AAGvB,SAAO;AACX;AA1CA,IAgDa;AAhDb;;AAgDO,IAAM,gBAAgB;;;;;MAKzB;;;;;MAMA;;;;;MAMA;;;;;;MAMA;;;;;;ACvEJ,IAKa;AALb;;;AAKM,IAAO,gBAAP,MAAoB;;;;MAIf,WAAW,MAAG;AACjB,YAAI,oBAAmB,KAAM,OAAO,eAAe,OAAO,YAAY,KAAK;AACvE,iBAAO,OAAO,YAAY,IAAG;;AAGjC,eAAO,KAAK,IAAG;MACnB;;;;;;ACfJ,IAGY;AAHZ;;AAGA,KAAA,SAAYA,iBAAc;AAEtB,MAAAA,gBAAAA,gBAAA,MAAA,IAAA,CAAA,IAAA;AAEA,MAAAA,gBAAAA,gBAAA,MAAA,IAAA,CAAA,IAAA;IACJ,GALY,mBAAA,iBAAc,CAAA,EAAA;;;;;ACH1B,IAKa;AALb;;;AAKM,IAAO,cAAP,MAAO,aAAW;;;;;;MAgCb,OAAO,qBAAqB,iBAAiB,eAAe,MAAI;AACnE,eAAO,mBAAmB,eAAe,OAAO,aAAY,oBAAoB,aAAY;MAChG;;;;;;MAOO,OAAO,gBAAgB,iBAAiB,eAAe,MAAI;AAC9D,eAAO,mBAAmB,eAAe,OAAO,aAAY,eAAe,aAAY;MAC3F;;;;;;MAOO,OAAO,wBAAwB,iBAAiB,eAAe,MAAI;AACtE,eAAO,mBAAmB,eAAe,OAAO,aAAY,uBAAuB,aAAY;MACnG;;AAhDc,gBAAA,oBAAoB;AAIpB,gBAAA,eAA0C,CAAA;AAI1C,gBAAA,uBAAkD,CAAA;AAKlD,gBAAA,wBAAwB;AAIxB,gBAAA,mBAA8C,CAAA;AAI9C,gBAAA,2BAAsD,CAAA;;;;;AC5BxE,IAAM,6BACA,2BAGO;AAJb;;IAAM,8BAA8B;AACpC,IAAM,4BAA4B;AAG5B,IAAO,iBAAP,MAAqB;MAA3B,cAAA;AAEI,aAAA,WAA6B,CAAA;MAoFjC;;MA/EI,QAAQ,eAAwC;AAC5C,eAAO;MACX;MAEA,QAAQ,eAA0C,SAA0B;AAfhF;AAgBQ,YAAI,SAAS;AACb,YAAI,KAAK,MAAM;AACX,cAAI,QAAgB,KAAK;AACzB,gBAAM,YAAY,QAAQ;AAC1B,cAAI,WAAW;AAEX,gBAAI,UAAU,eAAe;AACzB,sBAAQ,UAAU,cAAc,OAAO,QAAQ,YAAY,QAAQ,iBAAiB;;AAGxF,kBAAM,qBAAmB,aAAQ,cAAR,mBAAmB,yBAAwB;AACpE,kBAAM,iBACF,QAAQ,gBAAc,aAAQ,cAAR,mBAAmB,+BACnC,aAAQ,cAAR,mBAAmB,6BACnB,CAAC,QAAQ,gBAAc,aAAQ,cAAR,mBAAmB,6BACxC,aAAQ,cAAR,mBAAmB,2BACnB;AAEZ,gBAAI,CAAC,QAAQ,cAAc,UAAU,sBAAsB,KAAK,KAAK,WAAW,gBAAgB,GAAG;AAC/F,sBAAQ,UAAU,mBAAmB,KAAK,MAAM,eAAe,QAAQ,iBAAiB;uBAExF,UAAU,uBACT,eAAU,iBAAV,mCAAyB,KAAK,MAAM,QAAQ,gBAAgB,CAAC,UAAU,gBAAgB,KAAK,KAAK,WAAW,cAAc,IAC7H;AACE,sBAAQ,UAAU,iBAAiB,KAAK,MAAM,QAAQ,YAAY,eAAe,QAAQ,iBAAiB;uBACnG,UAAU,oBAAoB,UAAU,iBAAiB,UAAU,cAAc,KAAK,KAAK,IAAI,GAAG;AACzG,kBAAI,CAAC,QAAQ,uCAAuC;AAChD,wBAAQ,UAAU,iBAAiB,KAAK,MAAM,QAAQ,YAAY,eAAe,QAAQ,iBAAiB;;uBAEvG,UAAU,0BAA0B,UAAU,uBAAuB,UAAU,oBAAoB,KAAK,KAAK,IAAI,GAAG;AAC3H,kBAAI,CAAC,QAAQ,uCAAuC;AAChD,wBAAQ,UAAU,uBAAuB,KAAK,MAAM,QAAQ,YAAY,QAAQ,iBAAiB;AACjG,wBAAQ,wCAAwC;;uBAE7C,UAAU,oBAAoB,UAAU,iBAAiB,UAAU,cAAc,KAAK,KAAK,IAAI,GAAG;AACzG,sBAAQ,UAAU,iBAAiB,KAAK,MAAM,QAAQ,YAAY,eAAe,QAAQ,iBAAiB;wBAClG,UAAU,oBAAoB,UAAU,2BAA2B,KAAK,KAAK,WAAW,SAAS,KAAK,CAAC,QAAQ,uCAAuC;AAC9J,oBAAM,QAAQ;AAEd,kBAAI,MAAM,KAAK,KAAK,IAAI,GAAG;AAEvB,oBAAI,UAAU,kBAAkB;AAC5B,0BAAQ,UAAU,iBAAiB,KAAK,MAAM,QAAQ,YAAY,eAAe,QAAQ,iBAAiB;;qBAE3G;AAEH,oBAAI,UAAU,wBAAwB;AAClC,0BAAQ,UAAU,uBAAuB,KAAK,MAAM,QAAQ,YAAY,QAAQ,iBAAiB;AACjG,0BAAQ,wCAAwC;;;;AAK5D,gBAAI,QAAQ,yCAAyC,KAAK,KAAK,QAAQ,GAAG,MAAM,IAAI;AAChF,sBAAQ,wCAAwC;AAChD,kBAAI,UAAU,6BAA6B;AACvC,wBAAQ,UAAU,4BAA4B,KAAK,MAAM,QAAQ,YAAY,QAAQ,iBAAiB;;;;AAKlH,oBAAU,QAAQ;;AAGtB,aAAK,SAAS,QAAQ,CAAC,UAAS;AAC5B,oBAAU,MAAM,QAAQ,eAAe,OAAO;QAClD,CAAC;AAED,YAAI,KAAK,qBAAqB;AAC1B,wBAAc,KAAK,mBAAmB,IAAI,KAAK,yBAAyB;;AAG5E,eAAO;MACX;;;;;;AC3FJ,IACa;AADb;;AACM,IAAO,mBAAP,MAAuB;MAA7B,cAAA;AACY,aAAA,SAAmB,CAAA;MAwE/B;MArEI,IAAI,cAAW;AACX,eAAO,KAAK,OAAO,KAAK,SAAS;MACrC;MAEA,IAAI,UAAO;AACP,eAAO,KAAK,YAAY,KAAK,OAAO,SAAS;MACjD;MAEA,IAAI,MAAM,OAAe;AACrB,aAAK,OAAO,SAAS;AAErB,mBAAW,QAAQ,OAAO;AAEtB,cAAI,CAAC,QAAQ,SAAS,MAAM;AACxB;;AAIJ,cAAI,KAAK,CAAC,MAAM,KAAK;AACjB,iBAAK,OAAO,KAAK,IAAI;AACrB;;AAIJ,gBAAM,cAAc,KAAK,KAAI;AAE7B,cAAI,CAAC,aAAa;AACd;;AAGJ,cAAI,YAAY,WAAW,IAAI,GAAG;AAC9B,iBAAK,OAAO,KAAK,IAAI;AACrB;;AAIJ,gBAAM,iBAAiB,YAAY,QAAQ,GAAG;AAE9C,cAAI,mBAAmB,IAAI;AAEvB,iBAAK,OAAO,KAAK,WAAW;qBACrB,mBAAmB,YAAY,SAAS,GAAG;AAGlD,gBAAI,YAAY,SAAS,GAAG;AACxB,mBAAK,OAAO,KAAK,WAAW;;iBAE7B;AAEH,kBAAM,QAAQ,KAAK,MAAM,GAAG;AAE5B,qBAAS,QAAQ,GAAG,QAAQ,MAAM,QAAQ,SAAS;AAC/C,kBAAI,UAAU,MAAM,KAAK;AAEzB,kBAAI,CAAC,SAAS;AACV;;AAGJ,wBAAU,QAAQ,KAAI;AAEtB,kBAAI,CAAC,SAAS;AACV;;AAGJ,mBAAK,OAAO,KAAK,WAAW,UAAU,MAAM,SAAS,IAAI,MAAM,GAAG;;;;MAIlF;;;;;;ACzEJ,IAIa;AAJb;;;AAIM,IAAO,0BAAP,cAAuC,eAAc;MACvD,QAAQ,eAA0C,SAA0B;AACxE,iBAAS,QAAQ,GAAG,QAAQ,KAAK,SAAS,QAAQ,SAAS;AACvD,gBAAM,OAAO,KAAK,SAAS,KAAK;AAEhC,cAAI,KAAK,QAAQ,aAAa,GAAG;AAC7B,mBAAO,KAAK,QAAQ,eAAe,OAAO;;;AAIlD,eAAO;MACX;;;;;;ACfJ,IAIa;AAJb;;;AAIM,IAAO,qBAAP,cAAkC,eAAc;MAG3C,QAAQ,eAAwC;AACnD,eAAO,KAAK,eAAe,OAAO,aAAa;MACnD;;;;;;ACTJ,IAEa;AAFb;;AAEM,IAAO,yBAAP,MAAO,wBAAsB;;MAyBxB,OAAO,eAAwC;AAClD,eAAO;MACX;MAWO,OAAO,eAAe,SAAiB;AAC1C,cAAM,QAAkB,CAAA;AAExB,mBAAW,KAAK,SAAS;AACrB,cAAI,wBAAuB,kBAAkB,CAAC,MAAM,QAAW;AAC3D,kBAAM,KAAK,CAAC;iBACT;AACH,kBAAM,KAAK,MAAM,MAAM,SAAS,CAAC,GAC7B,KAAK,MAAM,MAAM,SAAS,CAAC;AAE/B,kBAAM,UAAU;AAChB,kBAAM,KAAK,IAAI,EAAE,GAAG,CAAC,GAAG,EAAE,GAAG;;;AAIrC,eAAO,MAAM,MAAM,SAAS,CAAC;MACjC;;;;;;;;;;;;;;;;;;;;MAqBO,OAAO,eAAe,OAAa;AAEtC,cAAM,YAAY,wBAAuB,qBAAqB,IAAI,KAAK;AACvE,YAAI,WAAW;AACX,oBAAU,aAAa,KAAK,IAAG;AAC/B,iBAAO,UAAU;;AAIrB,YAAI,CAAC,MAAM,SAAS,IAAI,KAAK,CAAC,MAAM,SAAS,IAAI,KAAK,CAAC,MAAM,SAAS,GAAG,KAAK,CAAC,MAAM,SAAS,GAAG,GAAG;AAChG,iBAAO,CAAC,KAAK;;AAGjB,cAAM,SAAmB,CAAA;AAEzB,YAAI,WAAW;AAEf,cAAM,cAAc,MAAK;AACrB,oBAAU,QAAQ,KAAI;AACtB,cAAI,YAAY,IAAI;AAChB,mBAAO,KAAK,OAAO;AACnB,sBAAU;;QAElB;AAEA,cAAM,OAAO,CAAC,MAAa;AACvB,cAAI,WAAW,wBAAuB,OAAO,SAAS,GAAG;AACrD,oCAAuB,OAAO,EAAE,QAAQ,IAAI;;QAEpD;AAEA,cAAM,OAAO,MAAM,wBAAuB,OAAO,QAAQ;AAEzD,cAAM,MAAM,MAAO,aAAa,KAAK,2BAA2B,wBAAuB,OAAO,UAAU;AAExG,YAAI,MAAM,GACN,UAAU;AAEd,eAAO,MAAM,MAAM,QAAQ;AACvB,gBAAM,IAAI,MAAM,OAAO,GAAG,GACtB,QAAQ,MAAM,MAAM,SAAS,IAAI,MAAM,OAAO,KAAK,CAAC,IAAI;AAE5D,cAAI,MAAM,KAAK;AACX,sBAAU;AACV,iBAAK,CAAC;qBACC,MAAM,KAAK;AAClB,wBAAW;AACX,mBAAO,aAAa,MAAM,KAAI,MAAO,KAAK;AACtC,qBAAO,KAAK,IAAG,CAAE;;AAErB,gBAAG;qBACI,wBAAuB,kBAAkB,KAAK,IAAI,GAAG;AAC5D,wBAAW;AACX,mBAAO,aAAa,MAAM,wBAAuB,kBAAkB,KAAI,CAAE,KAAK,wBAAuB,kBAAkB,KAAK,GAAG;AAC3H,qBAAO,KAAK,IAAG,CAAE;;AAErB,iBAAK,KAAK;AACV;iBACG;AACH,uBAAW;;AAEf;;AAGJ,oBAAW;AAEX,eAAO,aAAa,IAAI;AACpB,cAAI,KAAI,MAAO,KAAK;AAChB,gBAAG;iBACA;AACH,mBAAO,KAAK,IAAG,CAAE;;;AAKzB,YAAI,wBAAuB,qBAAqB,QAAQ,wBAAuB,8BAA8B;AACzG,kCAAuB,WAAU;;AAIrC,gCAAuB,qBAAqB,IAAI,OAAO,EAAE,QAAQ,YAAY,KAAK,IAAG,EAAE,CAAE;AAEzF,eAAO;MACX;MAEQ,OAAO,aAAU;AAErB,cAAM,cAAc,MAAM,KAAK,wBAAuB,qBAAqB,QAAO,CAAE,EAAE,KAAK,CAAC,GAAG,MAAM,EAAE,CAAC,EAAE,aAAa,EAAE,CAAC,EAAE,UAAU;AAGtI,iBAAS,IAAI,GAAG,IAAI,wBAAuB,gCAAgC,KAAK;AAC5E,kCAAuB,qBAAqB,OAAO,YAAY,CAAC,EAAE,CAAC,CAAC;;MAE5E;;AAlKO,2BAAA,+BAA+B;AAQ/B,2BAAA,iCAAiC;AAEvB,2BAAA,uBAMb,oBAAI,IAAG;AAOI,2BAAA,oBAAgD;MAC3D,KAAK;MACL,KAAK;MACL,MAAM;MACN,MAAM;;AAGK,2BAAA,SAAS,CAAC,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,EAAE;;;;;ACtC3G,IAGa;AAHb;;;AAGM,IAAO,gCAAP,cAA6C,uBAAsB;MACrE,YACW,QACA,MAAe,OAAK;AAE3B,cAAK;AAHE,aAAA,SAAA;AACA,aAAA,MAAA;MAGX;MAEO,OAAO,eAAwC;AAClD,YAAI,YAAY,cAAc,KAAK,MAAM,MAAM;AAE/C,YAAI,KAAK,KAAK;AACV,sBAAY,CAAC;;AAGjB,eAAO;MACX;;;;;;ACnBJ,IAGa;AAHb;;;AAGM,IAAO,yBAAP,cAAsC,uBAAsB;MAIvD,OAAO,eAAwC;AAClD,eAAO,KAAK,YAAY,OAAO,aAAa,KAAK,KAAK,aAAa,OAAO,aAAa;MAC3F;;;;;;ACTJ,IAGa;AAHb;;;AAGM,IAAO,0BAAP,cAAuC,uBAAsB;MAIxD,OAAO,eAAwC;AAClD,eAAO,KAAK,YAAY,OAAO,aAAa,KAAK,KAAK,aAAa,OAAO,aAAa;MAC3F;;;;;;ACTJ,IAGa;AAHb;;;AAGM,IAAO,iCAAP,cAA8C,uBAAsB;MACtE,YACW,QACA,SACA,WAAiB;AAExB,cAAK;AAJE,aAAA,SAAA;AACA,aAAA,UAAA;AACA,aAAA,YAAA;MAGX;MAEO,OAAO,eAAwC;AAClD,YAAI,QAAQ,cAAc,KAAK,MAAM;AAErC,YAAI,UAAU,QAAW;AACrB,kBAAQ,KAAK;;AAGjB,YAAI,YAAY;AAChB,cAAM,OAAO,SAAS,KAAK;AAC3B,cAAM,QAAQ,SAAS,KAAK,SAAS;AAErC,gBAAQ,KAAK,SAAS;UAClB,KAAK;AACD,wBAAY,OAAO;AACnB;UACJ,KAAK;AACD,wBAAY,OAAO;AACnB;UACJ,KAAK;AACD,wBAAY,QAAQ;AACpB;UACJ,KAAK;AACD,wBAAY,QAAQ;AACpB;UACJ,KAAK;AACD,wBAAY,SAAS;AACrB;UACJ,KAAK;AACD,wBAAY,SAAS;AACrB;;AAGR,eAAO;MACX;;;;;;AC7CJ,IAoBM,SACA,eACA,oBACA,iBACA,aACA,QACA,iBAGO;AA7Bb;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAQA,IAAM,UAAU;AAChB,IAAM,gBAAgB;AACtB,IAAM,qBAAqB;AAC3B,IAAM,kBAAkB;AACxB,IAAM,cAAc;AACpB,IAAM,SAAS;AACf,IAAM,kBAAsC,CAAA;AAGtC,IAAO,kBAAP,MAAO,iBAAe;MAGjB,OAAO,WAAW,SAA0B;AAC/C,YAAI,QAAQ,aAAa,QAAQ,UAAU,mBAAmB;AAC1D,kBAAQ,UAAU,kBAAkB,QAAQ,iBAAiB;;MAErE;MAEO,OAAO,QAAQ,YAAoB,SAA4B,UAAuE,QAAkB;AAtCnK;AAuCQ,aAAI,aAAQ,cAAR,mBAAmB,sBAAsB;AACzC,uBAAa,QAAQ,UAAU,qBAAqB,YAAY,QAAQ,UAAU;;AAEtF,aAAK,iBAAiB,YAAY,SAAS,CAAC,qBAAoB;AAC5D,cAAI,QAAQ,0BAA0B;AAClC,+BAAmB,QAAQ,yBAAyB,QAAQ,aAAa,aAAa,UAAU,gBAAgB;;AAEpH,gBAAM,eAAe,KAAK,yBAAyB,kBAAkB,SAAS,MAAM;AACpF,mBAAS,cAAc,gBAAgB;QAC3C,CAAC;MACL;MAEO,OAAO,WAAW,YAAoB,SAA4B,UAAuE,QAAkB;AAnDtK;AAoDQ,aAAI,aAAQ,cAAR,mBAAmB,sBAAsB;AACzC,uBAAa,QAAQ,UAAU,qBAAqB,YAAY,QAAQ,UAAU;;AAEtF,aAAK,iBAAiB,YAAY,SAAS,CAAC,qBAAoB;AAC5D,cAAI,QAAQ,0BAA0B;AAClC,+BAAmB,QAAQ,yBAAyB,QAAQ,aAAa,aAAa,UAAU,gBAAgB;;AAEpH,gBAAM,eAAe,KAAK,oBAAoB,kBAAkB,SAAS,MAAM;AAC/E,mBAAS,cAAc,gBAAgB;QAC3C,CAAC;MACL;MAEO,OAAO,SAAS,YAAoB,cAAsB,SAA0B;AACvF,YAAI,CAAC,QAAQ,aAAa,CAAC,QAAQ,UAAU,iBAAiB;AAC1D,iBAAO,EAAE,YAAY,aAAY;;AAGrC,eAAO,QAAQ,UAAU,gBAAgB,YAAY,cAAc,QAAQ,iBAAiB;MAChG;MAEQ,OAAO,kBAAkB,QAAgB,SAA0B;AAxE/E;AAyEQ,aAAI,aAAQ,cAAR,mBAAmB,aAAa;AAChC,iBAAO;;AAGX,cAAM,+BAA+B,QAAQ;AAE7C,YAAI,OAAO,QAAQ,uBAAuB,MAAM,IAAI;AAChD,cAAI,CAAC,8BAA8B;AAC/B,qBAAS,+BAA+B;iBACrC;AACH,qBAAS,6BAA6B;;eAEvC;AACH,cAAI,CAAC,8BAA8B;AAE/B,qBAAS,OAAO,QAAQ,yBAAyB,yBAAyB;;;AAIlF,eAAO;MACX;MAEQ,OAAO,kBAAkB,YAAkB;AAC/C,cAAM,QAAQ;AAEd,cAAM,QAAQ,MAAM,KAAK,UAAU;AAEnC,YAAI,SAAS,MAAM,QAAQ;AACvB,iBAAO,IAAI,8BAA8B,MAAM,CAAC,EAAE,KAAI,GAAI,WAAW,CAAC,MAAM,GAAG;;AAGnF,cAAM,YAAY,CAAC,MAAM,MAAM,MAAM,MAAM,KAAK,GAAG;AACnD,YAAI,WAAW;AACf,YAAI,gBAAgB;AAEpB,aAAK,YAAY,WAAW;AACxB,0BAAgB,WAAW,QAAQ,QAAQ;AAE3C,cAAI,gBAAgB,IAAI;AACpB;;;AAIR,YAAI,kBAAkB,IAAI;AACtB,iBAAO,IAAI,8BAA8B,UAAU;;AAGvD,cAAM,SAAS,WAAW,UAAU,GAAG,aAAa,EAAE,KAAI;AAC1D,cAAM,QAAQ,WAAW,UAAU,gBAAgB,SAAS,MAAM,EAAE,KAAI;AAExE,eAAO,IAAI,+BAA+B,QAAQ,UAAU,KAAK;MACrE;MAEQ,OAAO,oBAAoB,YAAkB;AACjD,qBAAa,WAAW,QAAQ,SAAS,aAAa;AAEtD,cAAM,UAAU,uBAAuB,eAAe,UAAU;AAEhE,cAAM,QAA6C,CAAA;AAEnD,mBAAW,KAAK,SAAS;AACrB,cAAI,MAAM,QAAQ,MAAM,MAAM;AAC1B,kBAAM,KAAK,CAAC;qBACL,MAAM,UAAU,GAAG;AAC1B,gBAAI,KAAK,MAAM,MAAM,SAAS,CAAC,GAC3B,KAAK,MAAM,MAAM,SAAS,CAAC;AAE/B,kBAAM,UAAU;AAEhB,kBAAM,WAAW,KAAK,OAAO,IAAI,wBAAuB,IAAK,IAAI,uBAAsB;AAEvF,gBAAI,OAAO,OAAO,UAAU;AACxB,mBAAK,GAAG,QAAQ,eAAe,aAAa;;AAGhD,gBAAI,OAAO,OAAO,UAAU;AACxB,mBAAK,GAAG,QAAQ,eAAe,aAAa;;AAGhD,qBAAS,cAAc,OAAO,OAAO,WAAW,KAAK,kBAAkB,EAAE,IAAI;AAC7E,qBAAS,eAAe,OAAO,OAAO,WAAW,KAAK,kBAAkB,EAAE,IAAI;AAE9E,kBAAM,KAAK,QAAQ;;;AAI3B,YAAI,SAAS,MAAM,MAAM,SAAS,CAAC;AAEnC,YAAI,OAAO,WAAW,UAAU;AAC5B,mBAAS,OAAO,QAAQ,eAAe,aAAa;;AAKxD,eAAO,OAAO,WAAW,WAAW,KAAK,kBAAkB,MAAM,IAAI;MACzE;MAEQ,OAAO,iBAAiB,MAAc,OAAa;AACvD,cAAM,OAAO,IAAI,mBAAkB;AACnC,cAAM,UAAU,KAAK,UAAU,GAAG,KAAK;AACvC,YAAI,aAAa,KAAK,UAAU,KAAK;AAErC,qBAAa,WAAW,UAAU,IAAI,WAAW,QAAQ,IAAI,IAAI,KAAK,WAAW,SAAS,KAAK,CAAC,EAAE,KAAI;AAEtG,YAAI,YAAY,UAAU;AACtB,eAAK,iBAAiB,IAAI,8BAA8B,UAAU;mBAC3D,YAAY,WAAW;AAC9B,eAAK,iBAAiB,IAAI,8BAA8B,YAAY,IAAI;eACrE;AACH,eAAK,iBAAiB,KAAK,oBAAoB,UAAU;;AAG7D,eAAO;MACX;MAEQ,OAAO,oBAAoB,QAA0B,UAAmC,QAAsB;AAClH,YAAI,OAAO,OAAO;AAClB,eAAO,KAAK,YAAY,QAAQ,MAAM,GAAG;AACrC,iBAAO,OAAO;AACd,gBAAM,SAAS,KAAK,UAAU,GAAG,CAAC,EAAE,YAAW;AAE/C,cAAI,WAAW,SAAS;AACpB,kBAAM,WAAW,IAAI,eAAc;AACnC,qBAAS,SAAS,KAAK,QAAQ;AAC/B,iBAAK,YAAY,QAAQ,QAAQ;AACjC;qBACO,WAAW,SAAS;AAC3B,kBAAM,WAAW,KAAK,iBAAiB,MAAM,CAAC;AAE9C,qBAAS,SAAS,KAAK,QAAQ;AAC/B,qBAAS;;;MAGrB;MAEQ,OAAO,YAAY,QAA0B,UAAwB;AACzE,eAAO,OAAO,SAAS;AACnB,iBAAO;AACP,gBAAM,OAAO,OAAO;AAEpB,cAAI,KAAK,QAAQ,GAAG,KAAK,GAAG;AACxB,kBAAM,UAAU,iBAAgB,iBAAiB,KAAK,IAAI;AAE1D,gBAAI,WAAW,QAAQ,QAAQ;AAC3B,oBAAM,UAAU,QAAQ,CAAC;AAEzB,sBAAQ,SAAS;gBACb,KAAK,UAAU;AACX,wBAAM,cAAc,IAAI,wBAAuB;AAC/C,2BAAS,SAAS,KAAK,WAAW;AAElC,wBAAM,SAAS,KAAK,iBAAiB,MAAM,CAAC;AAC5C,8BAAY,SAAS,KAAK,MAAM;AAChC,uBAAK,oBAAoB,QAAQ,aAAa,MAAM;AACpD;;gBAEJ,KAAK;gBACL,KAAK;AACD,yBAAO;gBACX,KAAK;AACD,yBAAO;gBACX,KAAK,WAAW;AACZ,wBAAM,cAAc,IAAI,wBAAuB;AAC/C,2BAAS,SAAS,KAAK,WAAW;AAElC,wBAAM,SAAS,KAAK,iBAAiB,MAAM,CAAC;AAC5C,8BAAY,SAAS,KAAK,MAAM;AAChC,uBAAK,oBAAoB,QAAQ,aAAa,MAAM;AACpD;;gBAEJ,KAAK,OAAO;AACR,wBAAM,cAAc,IAAI,wBAAuB;AAC/C,wBAAM,SAAS,KAAK,iBAAiB,MAAM,CAAC;AAC5C,2BAAS,SAAS,KAAK,WAAW;AAElC,8BAAY,SAAS,KAAK,MAAM;AAChC,uBAAK,oBAAoB,QAAQ,aAAa,MAAM;AACpD;;;AAGR;;;AAIR,gBAAM,UAAU,IAAI,eAAc;AAClC,kBAAQ,OAAO;AACf,mBAAS,SAAS,KAAK,OAAO;AAG9B,cAAI,KAAK,CAAC,MAAM,OAAO,KAAK,CAAC,MAAM,KAAK;AACpC,kBAAM,QAAQ,KAAK,QAAQ,KAAK,EAAE,EAAE,MAAM,GAAG;AAC7C,oBAAQ,sBAAsB,MAAM,CAAC;AAErC,gBAAI,MAAM,WAAW,GAAG;AACpB,sBAAQ,wBAAwB,MAAM,CAAC;;;;AAInD,eAAO;MACX;MAEQ,OAAO,uBAAuB,YAAoB,eAA0C,SAA0B;AAC1H,cAAM,WAAW,IAAI,eAAc;AACnC,cAAM,SAAS,IAAI,iBAAgB;AAEnC,eAAO,YAAY;AACnB,eAAO,QAAQ,WAAW,MAAM,IAAI;AAGpC,aAAK,YAAY,QAAQ,QAAQ;AAGjC,eAAO,SAAS,QAAQ,eAAe,OAAO;MAClD;MAEQ,OAAO,sBAAsB,SAA4B,QAAkB;AAhSvF;AAiSQ,cAAM,UAAU,QAAQ;AACxB,cAAM,gBAA2C,CAAA;AAEjD,mBAAW,UAAU,SAAS;AAC1B,gBAAM,WAAW,OAAO,QAAQ,WAAW,EAAE,EAAE,QAAQ,KAAK,EAAE,EAAE,KAAI;AACpE,gBAAM,QAAQ,SAAS,MAAM,GAAG;AAChC,wBAAc,MAAM,CAAC,CAAC,IAAI,MAAM,SAAS,IAAI,MAAM,CAAC,IAAI;;AAG5D,cAAI,aAAQ,cAAR,mBAAmB,oBAAmB,eAAe,MAAM;AAC3D,wBAAc,OAAO,IAAI;;AAE7B,sBAAc,aAAa,IAAI,QAAQ;AACvC,sBAAc,QAAQ,YAAY,IAAI;AAEtC,eAAO,kBAAkB,aAAa;AAEtC,eAAO;MACX;MAEQ,OAAO,yBAAyB,YAAoB,SAA4B,QAAkB;AACtG,YAAI,qBAAqB,KAAK,kBAAkB,YAAY,OAAO;AAEnE,YAAI,CAAC,QAAQ,WAAW;AACpB,iBAAO;;AAIX,YAAI,QAAQ,UAAU,mBAAmB,eAAe,QAAQ,mBAAmB,QAAQ,YAAY,MAAM,IAAI;AAC7G,+BAAqB,mBAAmB,QAAQ,mBAAmB,EAAE;AACrE,cAAI,CAAC,QAAQ,UAAU,YAAY;AAC/B,mBAAO;;;AAIf,cAAM,UAAU,QAAQ;AAExB,cAAM,gBAAgB,KAAK,sBAAsB,SAAS,MAAM;AAGhE,YAAI,QAAQ,UAAU,cAAc;AAChC,+BAAqB,QAAQ,UAAU,aAAa,oBAAoB,SAAS,QAAQ,YAAY,QAAQ,iBAAiB;;AAGlI,6BAAqB,KAAK,uBAAuB,oBAAoB,eAAe,OAAO;AAG3F,YAAI,QAAQ,UAAU,eAAe;AACjC,+BAAqB,QAAQ,UAAU,cAAc,oBAAoB,SAAS,QAAQ,YAAY,QAAQ,mBAAmB,MAAM;;AAI3I,YAAI,OAAO,UAAU,wBAAwB;AACzC,+BAAqB,OAAO,iBAAiB,kBAAkB;;AAGnE,eAAO;MACX;MAEQ,OAAO,oBAAoB,YAAoB,SAA4B,QAAkB;AA5VzG;AA6VQ,YAAI,qBAAqB;AAEzB,cAAM,UAAU,QAAQ;AAExB,cAAM,gBAAgB,KAAK,sBAAsB,SAAS,MAAM;AAGhE,aAAI,aAAQ,cAAR,mBAAmB,cAAc;AACjC,+BAAqB,QAAQ,UAAU,aAAa,oBAAoB,SAAS,QAAQ,YAAY,QAAQ,iBAAiB;;AAGlI,6BAAqB,KAAK,uBAAuB,oBAAoB,eAAe,OAAO;AAG3F,aAAI,aAAQ,cAAR,mBAAmB,eAAe;AAClC,+BAAqB,QAAQ,UAAU,cAAc,oBAAoB,SAAS,QAAQ,YAAY,QAAQ,mBAAmB,MAAM;;AAI3I,YAAI,OAAO,UAAU,wBAAwB;AACzC,+BAAqB,OAAO,iBAAiB,kBAAkB;;AAGnE,eAAO;MACX;;MAGO,OAAO,iBAAiB,YAAoB,SAA4B,UAA6B;AACxG,wBAAgB,SAAS;AACzB,YAAI;AAEJ,gBAAQ,QAAQ,mBAAmB,KAAK,UAAU,OAAO,MAAM;AAC3D,0BAAgB,KAAK,KAAK;;AAG9B,YAAI,cAAc,OAAO,UAAU;AACnC,YAAI,QAAQ,CAAC,UAAU;AAEvB,YAAI,iBAAiB;AAErB,mBAAWC,UAAS,iBAAiB;AACjC,cAAI,cAAcA,OAAM,CAAC;AAGzB,cAAI,YAAY,QAAQ,UAAU,MAAM,IAAI;AACxC,0BAAc,YAAY,QAAQ,iBAAiB,EAAE;AACrD,gBAAI,QAAQ,wBAAwB;AAChC,4BAAc,YAAY,QAAQ,UAAU,KAAK,EAAE,QAAQ,YAAY,KAAK;;AAEhF,0BAAc,cAAc;;AAGhC,cAAI,QAAQ,qBAAqB,WAAW,GAAG;AAE3C,gBAAI,iBAAiB,QAAQ,qBAAqB,WAAW;AAC7D,gBAAIA,OAAM,CAAC,GAAG;AACV,oBAAM,SAASA,OAAM,CAAC,EAAE,MAAM,GAAG;AAEjC,uBAAS,QAAQ,GAAG,QAAQ,OAAO,QAAQ,SAAS,GAAG;AACnD,sBAAM,SAAS,IAAI,OAAO,OAAO,KAAK,GAAG,GAAG;AAC5C,sBAAM,OAAO,OAAO,QAAQ,CAAC;AAE7B,iCAAiB,eAAe,QAAQ,QAAQ,IAAI;;;AAI5D,gBAAIA,OAAM,CAAC,GAAG;AACV,oBAAM,cAAcA,OAAM,CAAC;AAE3B,kBAAI,YAAY,QAAQ,IAAI,MAAM,IAAI;AAClC,sBAAM,cAAc,YAAY,MAAM,IAAI;AAC1C,sBAAM,WAAW,SAAS,YAAY,CAAC,CAAC;AACxC,oBAAI,WAAW,SAAS,YAAY,CAAC,CAAC;AACtC,oBAAI,uBAAuB,eAAe,MAAM,CAAC;AACjD,iCAAiB;AAEjB,oBAAI,MAAM,QAAQ,GAAG;AACjB,6BAAW,QAAQ,gBAAgB,YAAY,CAAC,CAAC;;AAGrD,yBAAS,IAAI,UAAU,IAAI,UAAU,KAAK;AACtC,sBAAI,CAAC,QAAQ,wBAAwB;AAEjC,2CAAuB,qBAAqB,QAAQ,aAAa,CAAC,KAAa,OAAc;AACzF,6BAAO,KAAK;oBAChB,CAAC;;AAEL,oCAAkB,qBAAqB,QAAQ,QAAQ,EAAE,SAAQ,CAAE,IAAI;;qBAExE;AACH,oBAAI,CAAC,QAAQ,wBAAwB;AAEjC,mCAAiB,eAAe,QAAQ,aAAa,CAAC,KAAa,OAAc;AAC7E,2BAAO,KAAK;kBAChB,CAAC;;AAEL,iCAAiB,eAAe,QAAQ,QAAQ,WAAW;;;AAMnE,kBAAM,WAAW,CAAA;AACjB,uBAAW,QAAQ,OAAO;AACtB,oBAAM,YAAY,KAAK,MAAMA,OAAM,CAAC,CAAC;AACrC,uBAAS,IAAI,GAAG,IAAI,UAAU,SAAS,GAAG,KAAK;AAC3C,yBAAS,KAAK,UAAU,CAAC,CAAC;AAC1B,yBAAS,KAAK,cAAc;;AAEhC,uBAAS,KAAK,UAAU,UAAU,SAAS,CAAC,CAAC;;AAEjD,oBAAQ;AAER,6BAAiB,kBAAkB,eAAe,QAAQ,WAAW,KAAK,KAAK,eAAe,QAAQ,YAAY,KAAK;iBACpH;AACH,kBAAM,mBAAmB,QAAQ,oBAAoB,oBAAoB,cAAc;AAEvF,6BAAgB,mBAAmB,kBAAkB,CAAC,gBAAe;AACjE,sBAAQ,qBAAqB,WAAW,IAAI;AAC5C,mBAAK,iBAAiB,MAAM,KAAK,EAAE,GAAG,SAAS,QAAQ;YAC3D,CAAC;AACD;;;AAGR,wBAAgB,SAAS;AAEzB,sBAAc,MAAM,KAAK,EAAE;AAE3B,YAAI,gBAAgB;AAChB,eAAK,iBAAiB,YAAY,SAAQ,GAAI,SAAS,QAAQ;eAC5D;AACH,mBAAS,WAAW;;MAE5B;;;;;;;;;;;;MAaO,OAAO,mBACV,KACA,WACA,YACA,iBACA,gBACA,SAAmE;AAEnE,cAAM,YAAY,WAAW;MACjC;;AA1de,oBAAA,mBAAmB;;;;;AC9BtC,IA4Fa;AA5Fb;;;AAGA;AACA;AAIA;AAMA;AACA;AA6EM,IAAO,SAAP,MAAO,QAAM;;;;MAIR,WAAW,oBAAiB;AAC/B,eAAO,YAAkB;MAC7B;MACO,WAAW,kBAAkB,MAAY;AAC5C,oBAAkB,oBAAoB;MAC1C;;;;MA+CA,IAAW,mBAAgB;AACvB,YAAI,CAAC,KAAK,mBAAmB;AACzB,eAAK,oBAAoB,IAAI,WAAU;;AAG3C,eAAO,KAAK;MAChB;;;;MAgEA,IAAW,iBAAc;AACrB,eAAO,KAAK;MAChB;;;;;;;;;;;;;;;;;MAkBA,YACI,UACA,0BACA,uBACA,WAA+B,MAC/B,QACA,UAA4B,MAC5B,YAAwC,MACxC,aAAiD,MACjD,UAA8D,MAC9D,iBACA,MAAc,IACd,iBAAiB,eAAe,MAAI;AA7IjC,aAAA,OAAY;AAIZ,aAAA,UAAkB;AAIlB,aAAA,aAAiD;AAIjD,aAAA,UAA8D;AAI9D,aAAA,SAA6C;AAI7C,aAAA,WAAW;AAKX,aAAA,sBAAsB,IAAI,WAAU;AAIpC,aAAA,oBAAoB,IAAI,WAAU;AAGlC,aAAA,oBAAkD;AAEjD,aAAA,cAAc;AAcf,aAAA,+BAA+B;AAE/B,aAAA,uBAAkD,CAAA;AAIlD,aAAA,eAAwB;AAOvB,aAAA,YAAuC,CAAA;AACvC,aAAA,WAAW;AACX,aAAA,oBAAoB;AACpB,aAAA,yBAAyB;AAIzB,aAAA,YAA+D,CAAA;AAKhE,aAAA,OAAe;AAEd,aAAA,aAAyC;AACzC,aAAA,4BAAoC;AACpC,aAAA,8BAAsC;AACtC,aAAA,6BAAiD;AAMlD,aAAA,mBAA+C;AAE/C,aAAA,oBAA4B;AAE5B,aAAA,sBAA8B;AAG7B,aAAA,mCAA2C;AAE3C,aAAA,qCAA6C;AAG7C,aAAA,uBAA+B;AAE/B,aAAA,yBAAiC;AAKjC,aAAA,4BAAwE;AACxE,aAAA,oBAA8D;AAuClE,aAAK,OAAO;AACZ,aAAK,OAAO;AAEZ,YAA6B,yBAA0B,YAAY;AAC/D,gBAAM,UAAkC;AACxC,eAAK,UAAkB;AAEvB,eAAK,mBAAmB,QAAQ;AAChC,eAAK,iBAAiB,QAAQ,cAAc,OAAO,QAAQ,QAAQ;AACnE,eAAK,eAAe,QAAQ,SAAS,MAAK;AAC1C,eAAK,UAAU,QAAQ;AACvB,eAAK,UAAU,QAAQ;AACvB,eAAK,aAAa,QAAQ;AAC1B,eAAK,aAAa,QAAQ;AAC1B,eAAK,mBAAmB,QAAQ;AAChC,eAAK,6BAA6B,QAAQ,6BAA6B;AACvE,eAAK,eAAe,CAAC,CAAC,QAAQ;AAC9B,eAAK,kBAAkB,QAAQ,kBAAkB,eAAe;AAEhE,cAAI,QAAQ,qBAAqB;AAC7B,iBAAK,2BAA2B,QAAQ,oBAAoB,MAAK;AACjE,qBAAS,IAAI,GAAG,IAAI,QAAQ,oBAAoB,QAAQ,KAAK;AACzD,mBAAK,qBAAqB,QAAQ,oBAAoB,CAAC,CAAC,IAAI;;;AAIpE,eAAK,oBAAoB,QAAQ,oBAAoB;AACrD,eAAK,4BAA4B,QAAQ,4BAA4B;eAClE;AACH,eAAK,UAAkB;AACvB,eAAK,UAAU,WAAW,OAAO,KAAK;AACtC,eAAK,iBAA4B,sBAAuB,OAAiB,QAAQ;AACjF,eAAK,eAAe,WAAqB,SAAS,MAAK,IAAK,CAAA;AAC5D,eAAK,mBAA6B;AAClC,eAAK,2BAA2B,CAAA;AAChC,eAAK,kBAAkB;AAEvB,eAAK,UAAU;AACf,eAAK,aAAa;AAElB,eAAK,mBAAmB;AACxB,eAAK,aAAa;;AAGtB,aAAK,2BAA2B,CAAA;AAEhC,aAAK,WAAW,QAAO;AAEvB,aAAK,mBAAkB;MAC3B;;MAGO,mBAAmB,kBAA8C,MAAM,8BAA8B,OAAK;AAC7G,YAAI;AACJ,YAAI;AAEJ,cAAM,WAAW,KAAK;AACtB,cAAM,eAAe,oBAAmB,IAAK,KAAK,QAAQ,gBAAe,IAAK;AAE9E,YAAI,SAAS,cAAc;AACvB,yBAAe,YAAY,SAAS;mBAC7B,SAAS,eAAe;AAC/B,yBAAe,eAAe,aAAa,eAAe,SAAS,aAAa,IAAI;AAEpF,cAAI,CAAC,cAAc;AACf,2BAAe,SAAS;;eAEzB;AACH,yBAAe,SAAS,UAAU;;AAGtC,YAAI,SAAS,gBAAgB;AACzB,2BAAiB,YAAY,SAAS;mBAC/B,SAAS,iBAAiB;AACjC,2BAAiB,eAAe,aAAa,eAAe,SAAS,eAAe,IAAI;AAExF,cAAI,CAAC,gBAAgB;AACjB,6BAAiB,SAAS;;eAE3B;AACH,2BAAiB,SAAS,YAAY;;AAG1C,aAAK,qBAAqB,KAAK,QAAQ,4BAA4B,KAAK,eAAe;AAEvF,YAAI,mBAAsC;UACtC,SAAS,KAAK,QAAQ,MAAM,IAAI;UAChC,iBAAiB,KAAK;UACtB,YAAY;UACZ,8BAA8B,KAAK,QAAQ;UAC3C,WAAW,mBAAmB,KAAK,QAAQ,oBAAoB,KAAK,eAAe;UACnF,wBAAwB,KAAK,QAAQ;UACrC,mBAAmB,YAAkB,qBAAqB,KAAK,eAAe;UAC9E,sBAAsB,YAAkB,wBAAwB,KAAK,eAAe;UACpF,UAAU,KAAK,QAAQ,UAAU,KAAK,SAAQ;UAC9C,cAAc,KAAK,QAAQ;UAC3B,mBAAmB,KAAK;UACxB,iBAAiB,KAAK,QAAQ;UAC9B,uBAAuB,KAAK,QAAQ;UACpC,0BAA0B,KAAK;;AAGnC,cAAM,cAAwD,CAAC,QAAW,MAAS;AACnF,cAAM,gBAAgB,MAAK;AACvB,cAAI,YAAY,CAAC,KAAK,YAAY,CAAC,GAAG;AAClC,6BAAiB,aAAa;AAC9B,kBAAM,CAAC,oBAAoB,YAAY,IAAI;AAC3C,4BAAgB,QACZ,cACA,kBACA,CAAC,sBAAsB,wBAAuB;AAC1C,mBAAK,qCAAqC;AAC1C,kBAAI,KAAK,mBAAmB;AACxB,uCAAuB,KAAK,kBAAkB,YAAY,oBAAoB;;AAElF,oBAAM,eAAe,gBAAgB,SAAS,oBAAoB,sBAAsB,gBAAgB;AACxG,iCAAmB;AACnB,mBAAK,cAAc,aAAa,YAAY,aAAa,cAAc,UAAU,2BAA2B;YAChH,GACA,KAAK,OAAO;;QAGxB;AACA,aAAK,YAAY,cAAc,UAAU,IAAI,CAAC,eAAc;AACxD,0BAAgB,WAAW,gBAAgB;AAC3C,0BAAgB,QACZ,YACA,kBACA,CAAC,oBAAoB,wBAAuB;AACxC,iBAAK,uBAAuB;AAC5B,iBAAK,mCAAmC;AACxC,gBAAI,KAAK,mBAAmB;AACxB,mCAAqB,KAAK,kBAAkB,UAAU,kBAAkB;;AAE5E,wBAAY,CAAC,IAAI;AACjB,0BAAa;UACjB,GACA,KAAK,OAAO;QAEpB,CAAC;AACD,aAAK,YAAY,gBAAgB,YAAY,SAAS,CAAC,iBAAgB;AACnE,eAAK,yBAAyB;AAC9B,sBAAY,CAAC,IAAI;AACjB,wBAAa;QACjB,CAAC;MACL;MAEQ,cAAc,oBAA4B,sBAA8B,UAAe,8BAA8B,OAAK;AAC9H,YAAI,UAAU;AACV,gBAAM,SAAS,SAAS,iBAAiB,SAAS,UAAU,SAAS,eAAe;AACpF,gBAAM,WAAW,SAAS,mBAAmB,SAAS,YAAY,SAAS,eAAe;AAE1F,eAAK,qBAAqB,KAAK,oBAAoB,eAAe,OAAO,OAAO,MAAM,gCAAgC,SAAS,OAAO;AACtI,eAAK,uBAAuB,KAAK,oBAAoB,eAAe,OAAO,OAAO,MAAM,kCAAkC,WAAW,OAAO;eACzI;AACH,eAAK,oBAAoB;AACzB,eAAK,sBAAsB;;AAE/B,aAAK,eAAe,2BAA2B;MACnD;;;;MAKA,IAAW,MAAG;AACV,eAAO,KAAK;MAChB;;;;;MAMO,UAAO;AACV,YAAI;AACA,iBAAO,KAAK,iBAAgB;gBACxB;AACJ,iBAAO;;MAEf;MAEQ,mBAAgB;AACpB,YAAI,KAAK,UAAU;AACf,iBAAO;;AAEX,YAAI,KAAK,kBAAkB;AACvB,iBAAO,KAAK,iBAAiB;;AAEjC,eAAO;MACX;;;;;MAMO,YAAS;AACZ,eAAO,KAAK;MAChB;;;;;MAMO,qBAAkB;AACrB,eAAO,KAAK;MAChB;;;;;MAMO,qBAAkB;AACrB,eAAO,KAAK;MAChB;;;;;;MAOO,qBAAqB,OAAa;AACrC,eAAO,KAAK,YAAY,KAAK;MACjC;;;;;;MAOO,2BAA2B,MAAY;AAC1C,eAAO,KAAK,yBAAyB,IAAI;MAC7C;;;;;MAMO,qBAAkB;AACrB,eAAO,KAAK,YAAY;MAC5B;;;;;;MAOO,gBAAgB,aAAmB;AACtC,eAAO,KAAK,eAAe,QAAQ,WAAW;MAClD;;;;;;MAOO,WAAW,aAAmB;AACjC,eAAO,KAAK,UAAU,WAAW;MACrC;;;;;MAMO,cAAW;AACd,eAAO,KAAK;MAChB;;;;;MAMO,kBAAe;AAClB,eAAO,KAAK;MAChB;;;;;MAMO,yBAAsB;AACzB,eAAO,KAAK;MAChB;;;;;MAMO,qBAAkB;AACrB,eAAO,KAAK;MAChB;;;;;MAMO,sBAAmB;AACtB,eAAO,KAAK;MAChB;;;;;MAMO,wBAAqB;AACxB,eAAO,KAAK;MAChB;;;;;MAMO,oBAAoB,MAA8B;AACrD,YAAI,KAAK,QAAO,GAAI;AAChB,eAAK,IAAI;AACT;;AAGJ,aAAK,oBAAoB,IAAI,CAAC,WAAU;AACpC,eAAK,MAAM;QACf,CAAC;AAED,YAAI,CAAC,KAAK,oBAAoB,KAAK,iBAAiB,SAAS;AACzD,qBAAW,MAAK;AACZ,iBAAK,cAAc,IAAI;UAC3B,GAAG,EAAE;;MAEb;MAEQ,cAAc,yBAAmD;AACrE,YAAI;AACA,cAAI,KAAK,iBAAgB,GAAI;AACzB;;iBAEC,GAAG;AACR,eAAK,0BAA0B,GAAG,uBAAuB;AACzD;;AAGJ,YAAI,KAAK,aAAa;AAClB;;AAGJ,mBAAW,MAAK;AACZ,eAAK,cAAc,uBAAuB;QAC9C,GAAG,EAAE;MACT;MAEQ,YAAY,QAAa,KAAa,aAAqB,UAA6B;AAC5F,YAAI,OAAO,gBAAgB,aAAa;AAEpC,cAAI,kBAAkB,aAAa;AAC/B,kBAAM,aAAa,kBAAkB,MAAM;AAC3C,qBAAS,UAAU;AACnB;;;AAKR,YAAI,OAAO,OAAO,GAAG,CAAC,MAAM,WAAW;AACnC,mBAAS,OAAO,OAAO,CAAC,CAAC;AACzB;;AAIJ,YAAI,OAAO,OAAO,GAAG,CAAC,MAAM,WAAW;AACnC,gBAAM,eAAe,OAAO,KAAK,OAAO,OAAO,CAAC,CAAC;AACjD,mBAAS,YAAY;AACrB;;AAGJ,cAAM,cAAc,YAAkB,gBAAgB,KAAK,eAAe;AAG1E,YAAI,YAAY,SAAS,MAAM,QAAQ,GAAG;AACtC,mBAAS,YAAY,SAAS,MAAM,QAAQ,CAAC;AAC7C;;AAGJ,YAAI,eAAe,YAAY,SAAS,cAAc,QAAQ,GAAG;AAC7D,mBAAS,YAAY,SAAS,cAAc,QAAQ,CAAC;AACrD;;AAGJ,YAAI;AAEJ,YAAI,OAAO,CAAC,MAAM,OAAO,OAAO,CAAC,MAAM,OAAO,OAAO,QAAQ,MAAM,IAAI,IAAI;AACvE,sBAAY;eACT;AACH,sBAAY,YAAkB,qBAAqB,KAAK,eAAe,IAAI;;AAI/E,aAAK,QAAQ,UAAU,YAAY,MAAM,IAAI,YAAW,IAAK,OAAO,QAAQ;MAChF;;;;;MAMA,IAAW,mBAAgB;AA1oB/B;AA2oBQ,eAAO,KAAK,6BAA6B,KAAK,8BACxC,KAAK,8BACL,UAAK,qBAAL,mBAAuB,2BAA0B,KAAK;MAChE;;;;;MAMA,IAAW,qBAAkB;AAppBjC;AAqpBQ,eAAO,KAAK,6BAA6B,KAAK,8BACxC,KAAK,gCACL,UAAK,qBAAL,mBAAuB,6BAA4B,KAAK;MAClE;;;;;;MAOA,IAAW,kCAA+B;AACtC,eAAO,KAAK;MAChB;;;;;;MAOA,IAAW,oCAAiC;AACxC,eAAO,KAAK;MAChB;;;;MAKA,IAAW,sBAAmB;AAC1B,eAAO,KAAK;MAChB;;;;MAKA,IAAW,wBAAqB;AAC5B,eAAO,KAAK;MAChB;;;;;;;;;MAUO,gBAAgB,kBAA0B,oBAA4B,YAAyD,SAAkC;AACpK,aAAK,WAAW;AAEhB,aAAK,4BAA4B;AACjC,aAAK,8BAA8B;AACnC,aAAK,UAAU,CAAC,QAAQ,UAAS;AAC7B,cAAI,SAAS;AACT,oBAAQ,KAAK;;QAErB;AACA,aAAK,aAAa,MAAK;AA5sB/B;AA6sBY,gBAAM,SAAS,KAAK,UAAS,EAAG;AAChC,cAAI,QAAQ;AACR,qBAAS,IAAI,GAAG,IAAI,OAAO,QAAQ,KAAK;AACpC,qBAAO,CAAC,EAAE,wBAAwB,EAAA;;;AAI1C,2BAAK,kBAAkB,mCAAvB,4BAAwD;QAC5D;AACA,aAAK,aAAa;AAClB,aAAK,eAAc;MACvB;;;;;MAMO,eAAe,8BAA8B,OAAK;AACrD,cAAM,kBAAkB,KAAK;AAC7B,cAAM,UAAU,KAAK;AAErB,cAAM,0BAA0B,KAAK;AAErC,aAAK,WAAW;AAEhB,YAAI;AACA,gBAAM,SAAS,KAAK;AAEpB,eAAK,oBAAoB,8BAA8B,0BAA0B,WAAc,OAAO,sBAAsB,KAAK,kBAAkB;AACnJ,eAAK,iBAAiB,QAAQ,KAAK,KAAK,QAAQ,OAAO,EAAE,EAAE,QAAQ,OAAO,GAAG;AAE7E,gBAAM,gBAAgB,CAClB,kBACA,oBACA,YACA,YACC,KAAK,gBAAgB,kBAAkB,oBAAoB,YAAY,OAAO;AACnF,cAAI,KAAK,6BAA6B,KAAK,6BAA6B;AACpE,mBAAO,wBACH,KAAK,kBACL,KAAK,2BACL,KAAK,6BACL,MACA,KAAK,sBACL,KAAK,wBACL,eACA,MACA,KAAK,4BACL,KAAK,IAAI;iBAEV;AACH,mBAAO,wBACH,KAAK,kBACL,KAAK,mBACL,KAAK,qBACL,OACA,KAAK,sBACL,KAAK,wBACL,eACA,SACA,KAAK,4BACL,KAAK,IAAI;;AAIjB,iBAAO,qCAAqC,KAAK,kBAAkB,MAAK;AACpE,iBAAK,cAAc,CAAA;AACnB,iBAAK,iBAAkB,uBACnB,MACA,KAAK,sBACL,KAAK,gBACL,KAAK,WACL,KAAK,cACL,KAAK,WACL,iBACA,KAAK,WAAW;AAIpB,gBAAI,iBAAiB;AACjB,uBAAS,IAAI,GAAG,IAAI,gBAAgB,QAAQ,KAAK;AAC7C,sBAAM,OAAO,gBAAgB,CAAC;AAC9B,qBAAK,yBAAyB,IAAI,IAAI,KAAK,YAAY,CAAC;;;AAIhE,mBAAO,aAAa,IAAI;AAExB,iBAAK,oBAAoB;AACzB,iBAAK,WAAW;AAChB,gBAAI,KAAK,YAAY;AACjB,mBAAK,WAAW,IAAI;;AAExB,iBAAK,oBAAoB,gBAAgB,IAAI;AAC7C,iBAAK,oBAAoB,MAAK;AAG9B,gBAAI,KAAK,YAAY;AACjB,mBAAK,WAAW,WAAU;;AAG9B,gBAAI,2BAA2B,CAAC,6BAA6B;AACzD,mBAAK,UAAS,EAAG,uBAAuB,uBAAuB;;UAEvE,CAAC;AAED,cAAI,KAAK,iBAAiB,SAAS;AAC/B,iBAAK,cAAc,uBAAuB;;iBAEzC,GAAG;AACR,eAAK,0BAA0B,GAAG,uBAAuB;;MAEjE;MAEQ,2BAA2B,MAAwB,OAAyB,YAAmB;AACnG,cAAM,SAAS,aAAa,qCAAqC;AAEjE,YAAI,YAAY;AAEhB,YAAI,SAAS,MAAM;AACf,gBAAM,MAAM,MAAM,MAAM,MAAM;AAC9B,cAAI,OAAO,IAAI,WAAW,GAAG;AACzB,kBAAM,aAAa,SAAS,IAAI,CAAC,CAAC;AAClC,kBAAM,QAAQ,KAAK,MAAM,MAAM,EAAE;AACjC,gBAAI,MAAM,UAAU,YAAY;AAC5B,0BAAY,mBAAmB,UAAU,QAAQ,aAAa,aAAa,QAAQ,UAAU,MAAM,aAAa,CAAC,CAAC;;;;AAK9H,eAAO,CAAC,MAAM,SAAS;MAC3B;MAEQ,0BAA0B,GAAQ,0BAAsD,MAAI;AAl1BxG;AAm1BQ,aAAK,oBAAoB,EAAE;AAC3B,cAAM,kBAAkB,KAAK;AAC7B,cAAM,YAAY,KAAK;AAGvB,eAAO,MAAM,2BAA2B;AACxC,eAAO,MACH,eACI,KAAK,eAAe,IAAI,SAAU,SAAO;AACrC,iBAAO,MAAM;QACjB,CAAC,CAAC;AAEV,eAAO,MACH,iBACI,gBAAgB,IAAI,SAAU,WAAS;AACnC,iBAAO,MAAM;QACjB,CAAC,CAAC;AAEV,eAAO,MAAM,eAAe,KAAK,OAAO;AACxC,YAAI,QAAO,iCAAiC;AACxC,cAAI,kBAAkB,MAClB,oBAAoB,MACpB,OAAO;AACX,eAAI,UAAK,qBAAL,mBAAuB,wBAAwB;AAC/C,aAAC,MAAM,eAAe,IAAI,KAAK,2BAA2B,KAAK,iBAAiB,qBAAoB,GAAI,KAAK,mBAAmB,KAAK;AACrI,gBAAI,MAAM;AACN,qBAAO,MAAM,cAAc;AAC3B,qBAAO,MAAM,IAAI;;;AAGzB,eAAI,UAAK,qBAAL,mBAAuB,0BAA0B;AACjD,aAAC,MAAM,iBAAiB,IAAI,KAAK,4BAA2B,UAAK,qBAAL,mBAAuB,0BAA0B,KAAK,mBAAmB,IAAI;AACzI,gBAAI,MAAM;AACN,qBAAO,MAAM,gBAAgB;AAC7B,qBAAO,MAAM,IAAI;;;AAGzB,cAAI,iBAAiB;AACjB,mBAAO,MAAM,eAAe;;AAEhC,cAAI,mBAAmB;AACnB,mBAAO,MAAM,iBAAiB;;;AAGtC,eAAO,MAAM,YAAY,KAAK,iBAAiB;AAE/C,cAAM,eAAe,MAAK;AACtB,cAAI,KAAK,SAAS;AACd,iBAAK,QAAQ,MAAM,KAAK,iBAAiB;;AAE7C,eAAK,kBAAkB,gBAAgB,IAAI;QAC/C;AAGA,YAAI,yBAAyB;AACzB,eAAK,mBAAmB;AACxB,eAAK,WAAW;AAChB,uBAAY;;AAIhB,YAAI,WAAW;AACX,eAAK,mBAAmB;AACxB,cAAI,UAAU,kBAAkB;AAC5B,iBAAK,yBAAyB;AAC9B,mBAAO,MAAM,uBAAuB;AACpC,iBAAK,UAAU,UAAU,OAAO,KAAK,SAAS,IAAI;AAClD,iBAAK,eAAc;iBAChB;AAEH,iBAAK,yBAAyB;AAC9B,yBAAY;AACZ,iBAAK,kBAAkB,MAAK;AAG5B,gBAAI,KAAK,YAAY;AACjB,mBAAK,WAAW,WAAU;;;eAG/B;AACH,eAAK,yBAAyB;AAG9B,cAAI,CAAC,yBAAyB;AAC1B,yBAAY;;;MAGxB;;;;MAKA,IAAW,cAAW;AAClB,eAAO,KAAK,sBAAsB;MACtC;;;;;;;MAQO,aAAa,SAAiB,SAAkC;AACnE,aAAK,QAAQ,aAAa,KAAK,UAAU,OAAO,GAAG,SAAS,OAAO;MACvE;;;;;;MAOO,WAAW,SAAiB,SAA8B;AAC7D,aAAK,QAAQ,WAAW,KAAK,UAAU,OAAO,GAAG,KAAK,UAAU,OAAO,GAAG,SAAS,OAAO;MAC9F;;;;;;MAOO,uBAAuB,SAAiB,SAAsC;AACjF,aAAK,QAAQ,uBAAuB,KAAK,UAAU,OAAO,GAAG,KAAK,UAAU,OAAO,GAAG,SAAS,OAAO;MAC1G;;;;;;MAOO,gBAAgB,SAAiB,UAAuB;AAC3D,cAAM,SAAS,UAAU;AACzB,YAAI,KAAK,aAAa,QAAQ,SAAS,GAAG,MAAM,IAAI;AAChD,gBAAM,aAAa,KAAK,aAAa,QAAQ,OAAO;AACpD,mBAAS,QAAQ,GAAG,QAAQ,SAAS,QAAQ,SAAS;AAClD,kBAAM,gBAAgB,UAAU,QAAQ,GAAG,SAAQ;AACnD,iBAAK,aAAa,OAAO,aAAa,OAAO,GAAG,aAAa;;AAIjE,cAAI,eAAe;AACnB,qBAAW,OAAO,KAAK,cAAc;AACjC,iBAAK,UAAU,GAAG,IAAI;AACtB,4BAAgB;;;AAIxB,aAAK,QAAQ,gBAAgB,KAAK,UAAU,OAAO,GAAG,KAAK,UAAU,OAAO,GAAG,UAAU,OAAO;MACpG;;;;;;MAOO,0BAA0B,SAAiB,aAAkC;AAChF,aAAK,QAAQ,0BAA0B,KAAK,UAAU,OAAO,GAAG,aAAa,OAAO;MACxF;;;;;;;MAQO,gCAAgC,SAAiB,aAAkC;AACtF,aAAK,QAAQ,gCAAgC,KAAK,UAAU,OAAO,GAAG,aAAa,OAAO;MAC9F;;;;;;MAOO,kBAAkB,QAAoB,MAAY;AACrD,cAAM,aAAa,KAAK,qBAAqB,IAAI;AACjD,YAAI,eAAe,UAAc,QAAO,WAAW,UAAU,MAAM,UAAU,KAAK,QAAQ,UAAU,oBAAqB;AACrH;;AAEJ,gBAAO,WAAW,UAAU,IAAI;AAChC,aAAK,QAAQ,sBAAsB,QAAQ,YAAY,IAAI;MAC/D;;;;;;MAOO,iBAAiB,WAAmB,OAAa;AACpD,aAAK,QAAQ,iBAAiB,KAAK,kBAAmB,WAAW,KAAK;MAC1E;;;;;;;MAQO,OAAO,aAAqB,OAAa;AAC5C,aAAK,iBAAkB,OAAO,aAAa,KAAK;AAChD,eAAO;MACX;;;;;;;;MASO,QAAQ,aAAqB,GAAW,GAAS;AACpD,aAAK,iBAAkB,QAAQ,aAAa,GAAG,CAAC;AAChD,eAAO;MACX;;;;;;;;;MAUO,QAAQ,aAAqB,GAAW,GAAW,GAAS;AAC/D,aAAK,iBAAkB,QAAQ,aAAa,GAAG,GAAG,CAAC;AACnD,eAAO;MACX;;;;;;;;;;MAWO,QAAQ,aAAqB,GAAW,GAAW,GAAW,GAAS;AAC1E,aAAK,iBAAkB,QAAQ,aAAa,GAAG,GAAG,GAAG,CAAC;AACtD,eAAO;MACX;;;;;;;MAQO,YAAY,aAAqB,OAAiB;AACrD,aAAK,iBAAkB,YAAY,aAAa,KAAK;AACrD,eAAO;MACX;;;;;;;MAQO,aAAa,aAAqB,OAAiB;AACtD,aAAK,iBAAkB,aAAa,aAAa,KAAK;AACtD,eAAO;MACX;;;;;;;MAQO,aAAa,aAAqB,OAAiB;AACtD,aAAK,iBAAkB,aAAa,aAAa,KAAK;AACtD,eAAO;MACX;;;;;;;MAQO,aAAa,aAAqB,OAAiB;AACtD,aAAK,iBAAkB,aAAa,aAAa,KAAK;AACtD,eAAO;MACX;;;;;;;MAQO,QAAQ,aAAqB,OAAa;AAC7C,aAAK,iBAAkB,QAAQ,aAAa,KAAK;AACjD,eAAO;MACX;;;;;;;;MASO,SAAS,aAAqB,GAAW,GAAS;AACrD,aAAK,iBAAkB,SAAS,aAAa,GAAG,CAAC;AACjD,eAAO;MACX;;;;;;;;;MAUO,SAAS,aAAqB,GAAW,GAAW,GAAS;AAChE,aAAK,iBAAkB,SAAS,aAAa,GAAG,GAAG,CAAC;AACpD,eAAO;MACX;;;;;;;;;;MAWO,SAAS,aAAqB,GAAW,GAAW,GAAW,GAAS;AAC3E,aAAK,iBAAkB,SAAS,aAAa,GAAG,GAAG,GAAG,CAAC;AACvD,eAAO;MACX;;;;;;;MAQO,aAAa,aAAqB,OAAkB;AACvD,aAAK,iBAAkB,aAAa,aAAa,KAAK;AACtD,eAAO;MACX;;;;;;;MAQO,cAAc,aAAqB,OAAkB;AACxD,aAAK,iBAAkB,cAAc,aAAa,KAAK;AACvD,eAAO;MACX;;;;;;;MAQO,cAAc,aAAqB,OAAkB;AACxD,aAAK,iBAAkB,cAAc,aAAa,KAAK;AACvD,eAAO;MACX;;;;;;;MAQO,cAAc,aAAqB,OAAkB;AACxD,aAAK,iBAAkB,cAAc,aAAa,KAAK;AACvD,eAAO;MACX;;;;;;;MAQO,cAAc,aAAqB,OAAiB;AACvD,aAAK,iBAAkB,SAAS,aAAa,KAAK;AAClD,eAAO;MACX;;;;;;;MAQO,eAAe,aAAqB,OAAiB;AACxD,aAAK,iBAAkB,UAAU,aAAa,KAAK;AACnD,eAAO;MACX;;;;;;;MAQO,eAAe,aAAqB,OAAiB;AACxD,aAAK,iBAAkB,UAAU,aAAa,KAAK;AACnD,eAAO;MACX;;;;;;;MAQO,eAAe,aAAqB,OAAiB;AACxD,aAAK,iBAAkB,UAAU,aAAa,KAAK;AACnD,eAAO;MACX;;;;;;;MAQO,SAAS,aAAqB,OAAe;AAChD,aAAK,iBAAkB,SAAS,aAAa,KAAK;AAClD,eAAO;MACX;;;;;;;MAQO,UAAU,aAAqB,OAAe;AACjD,aAAK,iBAAkB,UAAU,aAAa,KAAK;AACnD,eAAO;MACX;;;;;;;MAQO,UAAU,aAAqB,OAAe;AACjD,aAAK,iBAAkB,UAAU,aAAa,KAAK;AACnD,eAAO;MACX;;;;;;;MAQO,UAAU,aAAqB,OAAe;AACjD,aAAK,iBAAkB,UAAU,aAAa,KAAK;AACnD,eAAO;MACX;;;;;;;MAQO,YAAY,aAAqB,UAAsC;AAC1E,aAAK,iBAAkB,YAAY,aAAa,QAAwB;AACxE,eAAO;MACX;;;;;;;MAQO,UAAU,aAAqB,QAAmB;AACrD,aAAK,iBAAkB,UAAU,aAAa,MAAM;AACpD,eAAO;MACX;;;;;;;MAQO,aAAa,aAAqB,QAAoC;AAEzE,aAAK,iBAAkB,aAAa,aAAa,MAAsB;AACvE,eAAO;MACX;;;;;;;MAQO,aAAa,aAAqB,QAAoC;AAEzE,aAAK,iBAAkB,aAAa,aAAa,MAAsB;AACvE,eAAO;MACX;;;;;;;MAQO,SAAS,aAAqB,OAAa;AAC9C,aAAK,iBAAkB,SAAS,aAAa,KAAK;AAClD,eAAO;MACX;;;;;;;MAQO,QAAQ,aAAqB,MAAa;AAC7C,aAAK,iBAAkB,OAAO,aAAa,OAAO,IAAI,CAAC;AACvD,eAAO;MACX;;;;;;;MAQO,WAAW,aAAqB,SAAqB;AACxD,aAAK,iBAAkB,WAAW,aAAa,OAAO;AACtD,eAAO;MACX;;;;;;;;MASO,UAAU,aAAqB,GAAW,GAAS;AACtD,aAAK,iBAAkB,UAAU,aAAa,GAAG,CAAC;AAClD,eAAO;MACX;;;;;;;MAQO,WAAW,aAAqB,SAAqB;AACxD,aAAK,iBAAkB,WAAW,aAAa,OAAO;AACtD,eAAO;MACX;;;;;;;;;MAUO,UAAU,aAAqB,GAAW,GAAW,GAAS;AACjE,aAAK,iBAAkB,UAAU,aAAa,GAAG,GAAG,CAAC;AACrD,eAAO;MACX;;;;;;;MAQO,WAAW,aAAqB,SAAqB;AACxD,aAAK,iBAAkB,WAAW,aAAa,OAAO;AACtD,eAAO;MACX;;;;;;;MAQO,cAAc,aAAqB,YAA2B;AACjE,aAAK,iBAAkB,cAAc,aAAa,UAAU;AAC5D,eAAO;MACX;;;;;;;;;;MAWO,UAAU,aAAqB,GAAW,GAAW,GAAW,GAAS;AAC5E,aAAK,iBAAkB,UAAU,aAAa,GAAG,GAAG,GAAG,CAAC;AACxD,eAAO;MACX;;;;;;;MAQO,UAAU,aAAqB,QAAmB;AACrD,aAAK,iBAAkB,UAAU,aAAa,MAAM;AACpD,eAAO;MACX;;;;;;;;MASO,UAAU,aAAqB,QAAqB,OAAa;AACpE,aAAK,iBAAkB,UAAU,aAAa,QAAQ,KAAK;AAC3D,eAAO;MACX;;;;;;;MAQO,gBAAgB,aAAqB,QAAmB;AAC3D,aAAK,iBAAkB,gBAAgB,aAAa,MAAM;AAC1D,eAAO;MACX;;;;MAKO,UAAO;AACV,YAAI,KAAK,kBAAkB;AACvB,eAAK,iBAAiB,QAAO;;AAEjC,aAAK,QAAQ,eAAe,IAAI;AAEhC,aAAK,cAAc;MACvB;;;;;;;;MASO,OAAO,eAAe,MAAc,aAAsB,cAAuB,iBAAiB,eAAe,MAAI;AACxH,YAAI,aAAa;AACb,sBAAkB,gBAAgB,cAAc,EAAE,GAAG,IAAI,aAAa,IAAI;;AAG9E,YAAI,cAAc;AACd,sBAAkB,gBAAgB,cAAc,EAAE,GAAG,IAAI,cAAc,IAAI;;MAEnF;;;;MAcO,OAAO,aAAU;AACpB,gBAAO,aAAa,CAAA;MACxB;;AAj6Cc,WAAA,kCAAkC;AA4DjC,WAAA,gBAAgB;AA4ChB,WAAA,aAA4C,CAAA;AA8yC7C,WAAA,eAA0C,YAAkB;AAI5D,WAAA,uBAAkD,YAAkB;;;;;ACjgDtF,IAGa;AAHb;;AAGM,IAAO,oBAAP,MAAwB;;;;;MAsB1B,YAAmB,QAAQ,MAAI;AArBrB,aAAA,oBAAoB;AACpB,aAAA,oBAAoB;AACpB,aAAA,oBAAoB;AACpB,aAAA,mBAAmB;AACnB,aAAA,eAAe;AACf,aAAA,kBAAkB;AAClB,aAAA,oBAAoB;AAgB1B,YAAI,OAAO;AACP,eAAK,MAAK;;MAElB;MAEA,IAAW,UAAO;AACd,eACI,KAAK,qBACL,KAAK,qBACL,KAAK,qBACL,KAAK,oBACL,KAAK,gBACL,KAAK,mBACL,KAAK;MAEb;MAEA,IAAW,UAAO;AACd,eAAO,KAAK;MAChB;MAEA,IAAW,QAAQ,OAAa;AAC5B,YAAI,KAAK,aAAa,OAAO;AACzB;;AAGJ,aAAK,WAAW;AAChB,aAAK,kBAAkB;MAC3B;MAEA,IAAW,eAAY;AACnB,eAAO,KAAK;MAChB;MAEA,IAAW,aAAa,OAAa;AACjC,YAAI,KAAK,kBAAkB,OAAO;AAC9B;;AAGJ,aAAK,gBAAgB;AACrB,aAAK,kBAAkB;MAC3B;MAEA,IAAW,WAAQ;AACf,eAAO,KAAK;MAChB;MAEA,IAAW,SAAS,OAAuB;AACvC,YAAI,KAAK,cAAc,OAAO;AAC1B;;AAGJ,aAAK,YAAY;AACjB,aAAK,mBAAmB;MAC5B;MAEA,IAAW,OAAI;AACX,eAAO,KAAK;MAChB;MAEA,IAAW,KAAK,OAAwB;AACpC,YAAI,KAAK,UAAU,OAAO;AACtB;;AAGJ,aAAK,QAAQ;AACb,aAAK,eAAe;MACxB;MAEA,IAAW,YAAS;AAChB,eAAO,KAAK;MAChB;MAEA,IAAW,UAAU,OAAuB;AACxC,YAAI,KAAK,eAAe,OAAO;AAC3B;;AAGJ,aAAK,aAAa;AAClB,aAAK,oBAAoB;MAC7B;MAEA,IAAW,YAAS;AAChB,eAAO,KAAK;MAChB;MAEA,IAAW,UAAU,OAAc;AAC/B,YAAI,KAAK,eAAe,OAAO;AAC3B;;AAGJ,aAAK,aAAa;AAClB,aAAK,oBAAoB;MAC7B;MAEA,IAAW,YAAS;AAChB,eAAO,KAAK;MAChB;MAEA,IAAW,UAAU,OAAc;AAC/B,YAAI,KAAK,eAAe,OAAO;AAC3B;;AAGJ,aAAK,aAAa;AAClB,aAAK,oBAAoB;MAC7B;MAEA,IAAW,YAAS;AAChB,eAAO,KAAK;MAChB;MAEA,IAAW,UAAU,OAAuB;AACxC,YAAI,KAAK,eAAe,OAAO;AAC3B;;AAGJ,aAAK,aAAa;AAClB,aAAK,oBAAoB;MAC7B;MAEO,QAAK;AACR,aAAK,aAAa;AAClB,aAAK,aAAa;AAClB,aAAK,aAAa;AAClB,aAAK,YAAY;AACjB,aAAK,QAAQ;AACb,aAAK,WAAW;AAChB,aAAK,gBAAgB;AACrB,aAAK,aAAa;AAElB,aAAK,oBAAoB;AACzB,aAAK,oBAAoB;AACzB,aAAK,oBAAoB;AACzB,aAAK,mBAAmB;AACxB,aAAK,eAAe;AACpB,aAAK,kBAAkB;AACvB,aAAK,oBAAoB;MAC7B;MAEO,MAAM,IAAyB;AAClC,YAAI,CAAC,KAAK,SAAS;AACf;;AAIJ,YAAI,KAAK,cAAc;AACnB,cAAI,KAAK,MAAM;AACX,eAAG,OAAO,GAAG,SAAS;iBACnB;AACH,eAAG,QAAQ,GAAG,SAAS;;AAG3B,eAAK,eAAe;;AAIxB,YAAI,KAAK,kBAAkB;AACvB,aAAG,SAAiB,KAAK,QAAQ;AACjC,eAAK,mBAAmB;;AAI5B,YAAI,KAAK,mBAAmB;AACxB,aAAG,UAAU,KAAK,SAAS;AAC3B,eAAK,oBAAoB;;AAI7B,YAAI,KAAK,mBAAmB;AACxB,cAAI,KAAK,WAAW;AAChB,eAAG,OAAO,GAAG,UAAU;iBACpB;AACH,eAAG,QAAQ,GAAG,UAAU;;AAE5B,eAAK,oBAAoB;;AAI7B,YAAI,KAAK,mBAAmB;AACxB,aAAG,UAAkB,KAAK,SAAS;AACnC,eAAK,oBAAoB;;AAI7B,YAAI,KAAK,iBAAiB;AACtB,cAAI,KAAK,WAAW,KAAK,cAAc;AACnC,eAAG,OAAO,GAAG,mBAAmB;AAChC,eAAG,cAAc,KAAK,SAAS,KAAK,YAAY;iBAC7C;AACH,eAAG,QAAQ,GAAG,mBAAmB;;AAGrC,eAAK,kBAAkB;;AAI3B,YAAI,KAAK,mBAAmB;AACxB,aAAG,UAAkB,KAAK,SAAS;AACnC,eAAK,oBAAoB;;MAEjC;;;;;;ACrOJ,IAMa;AANb;;AAMM,IAAO,eAAP,MAAO,cAAY;MAQrB,cAAA;AACI,aAAK,MAAK;MACd;MAEO,QAAK;AACR,aAAK,UAAU;AACf,aAAK,OAAO;AAEZ,aAAK,OAAO,cAAa;AACzB,aAAK,UAAU;AACf,aAAK,WAAW;AAEhB,aAAK,gBAAgB,cAAa;AAClC,aAAK,cAAc,cAAa;AAChC,aAAK,qBAAqB,cAAa;MAC3C;MAGA,IAAW,cAAW;AAClB,eAAO,KAAK;MAChB;MAEA,IAAW,YAAY,OAAa;AAChC,aAAK,OAAO;MAChB;MAGA,IAAW,iBAAc;AACrB,eAAO,KAAK;MAChB;MAEA,IAAW,eAAe,OAAa;AACnC,aAAK,UAAU;MACnB;MAGA,IAAW,kBAAe;AACtB,eAAO,KAAK;MAChB;MAEA,IAAW,gBAAgB,OAAa;AACpC,aAAK,WAAW;MACpB;MAGA,IAAW,uBAAoB;AAC3B,eAAO,KAAK;MAChB;MAEA,IAAW,qBAAqB,OAAa;AACzC,aAAK,gBAAgB;MACzB;MAGA,IAAW,qBAAkB;AACzB,eAAO,KAAK;MAChB;MAEA,IAAW,mBAAmB,OAAa;AACvC,aAAK,cAAc;MACvB;MAGA,IAAW,4BAAyB;AAChC,eAAO,KAAK;MAChB;MAEA,IAAW,0BAA0B,OAAa;AAC9C,aAAK,qBAAqB;MAC9B;MAGA,IAAW,cAAW;AAClB,eAAO,KAAK;MAChB;MAEA,IAAW,YAAY,OAAa;AAChC,aAAK,OAAO;MAChB;MAGA,IAAW,cAAW;AAClB,eAAO,KAAK;MAChB;MAEA,IAAW,YAAY,OAAc;AACjC,aAAK,UAAU;MACnB;;AA7FuB,iBAAA,SAAS;AAET,iBAAA,OAAO;AAEP,iBAAA,UAAU;;;;;ACVrC,IAGa;AAHb;;AAGM,IAAO,aAAP,MAAiB;;;;MAcnB,cAAA;AAbO,aAAA,2BAA2B,IAAI,MAAwB,CAAC;AACxD,aAAA,2BAA2B,IAAI,MAAwB,CAAC;AACxD,aAAA,kBAAkB,IAAI,MAAwB,CAAC;AAC/C,aAAA,yBAAyB;AAExB,aAAA,cAAc;AACd,aAAA,qBAAqB;AACrB,aAAA,kCAAkC;AAClC,aAAA,kCAAkC;AAMtC,aAAK,MAAK;MACd;MAEA,IAAW,UAAO;AACd,eAAO,KAAK,sBAAsB,KAAK,mCAAmC,KAAK;MACnF;MAEA,IAAW,aAAU;AACjB,eAAO,KAAK;MAChB;MAEA,IAAW,WAAW,OAAc;AAChC,YAAI,KAAK,gBAAgB,OAAO;AAC5B;;AAGJ,aAAK,cAAc;AACnB,aAAK,qBAAqB;MAC9B;MAEO,uBAAuB,GAAW,GAAW,GAAW,GAAS;AACpE,YAAI,KAAK,gBAAgB,CAAC,MAAM,KAAK,KAAK,gBAAgB,CAAC,MAAM,KAAK,KAAK,gBAAgB,CAAC,MAAM,KAAK,KAAK,gBAAgB,CAAC,MAAM,GAAG;AAClI;;AAGJ,aAAK,gBAAgB,CAAC,IAAI;AAC1B,aAAK,gBAAgB,CAAC,IAAI;AAC1B,aAAK,gBAAgB,CAAC,IAAI;AAC1B,aAAK,gBAAgB,CAAC,IAAI;AAE1B,aAAK,yBAAyB;MAClC;MAEO,gCAAgC,QAAgB,QAAgB,QAAgB,QAAc;AACjG,YACI,KAAK,yBAAyB,CAAC,MAAM,UACrC,KAAK,yBAAyB,CAAC,MAAM,UACrC,KAAK,yBAAyB,CAAC,MAAM,UACrC,KAAK,yBAAyB,CAAC,MAAM,QACvC;AACE;;AAGJ,aAAK,yBAAyB,CAAC,IAAI;AACnC,aAAK,yBAAyB,CAAC,IAAI;AACnC,aAAK,yBAAyB,CAAC,IAAI;AACnC,aAAK,yBAAyB,CAAC,IAAI;AAEnC,aAAK,kCAAkC;MAC3C;MAEO,2BAA2B,KAAa,OAAa;AACxD,YAAI,KAAK,yBAAyB,CAAC,MAAM,OAAO,KAAK,yBAAyB,CAAC,MAAM,OAAO;AACxF;;AAGJ,aAAK,yBAAyB,CAAC,IAAI;AACnC,aAAK,yBAAyB,CAAC,IAAI;AAEnC,aAAK,kCAAkC;MAC3C;MAEO,QAAK;AACR,aAAK,cAAc;AACnB,aAAK,yBAAyB,CAAC,IAAI;AACnC,aAAK,yBAAyB,CAAC,IAAI;AACnC,aAAK,yBAAyB,CAAC,IAAI;AACnC,aAAK,yBAAyB,CAAC,IAAI;AAEnC,aAAK,yBAAyB,CAAC,IAAI;AACnC,aAAK,yBAAyB,CAAC,IAAI;AAEnC,aAAK,gBAAgB,CAAC,IAAI;AAC1B,aAAK,gBAAgB,CAAC,IAAI;AAC1B,aAAK,gBAAgB,CAAC,IAAI;AAC1B,aAAK,gBAAgB,CAAC,IAAI;AAE1B,aAAK,qBAAqB;AAC1B,aAAK,kCAAkC;AACvC,aAAK,kCAAkC;AACvC,aAAK,yBAAyB;MAClC;MAEO,MAAM,IAAyB;AAClC,YAAI,CAAC,KAAK,SAAS;AACf;;AAIJ,YAAI,KAAK,oBAAoB;AACzB,cAAI,KAAK,aAAa;AAClB,eAAG,OAAO,GAAG,KAAK;iBACf;AACH,eAAG,QAAQ,GAAG,KAAK;;AAGvB,eAAK,qBAAqB;;AAI9B,YAAI,KAAK,iCAAiC;AACtC,aAAG,kBACS,KAAK,yBAAyB,CAAC,GAC/B,KAAK,yBAAyB,CAAC,GAC/B,KAAK,yBAAyB,CAAC,GAC/B,KAAK,yBAAyB,CAAC,CAAC;AAE5C,eAAK,kCAAkC;;AAI3C,YAAI,KAAK,iCAAiC;AACtC,aAAG,sBAAsB,KAAK,yBAAyB,CAAC,GAAI,KAAK,yBAAyB,CAAC,CAAE;AAC7F,eAAK,kCAAkC;;AAI3C,YAAI,KAAK,wBAAwB;AAC7B,aAAG,WAAmB,KAAK,gBAAgB,CAAC,GAAW,KAAK,gBAAgB,CAAC,GAAW,KAAK,gBAAgB,CAAC,GAAW,KAAK,gBAAgB,CAAC,CAAC;AAChJ,eAAK,yBAAyB;;MAEtC;;;;;;AC7IJ,IAMa;AANb;;AAMM,IAAO,iBAAP,MAAqB;;;;;;;;MAavB,IAAW,QAAK;AACZ,eAAO,KAAK;MAChB;MAEA,IAAW,MAAM,OAAuB;AACpC,aAAK,eAAe;MACxB;;;;;;;;MASA,IAAW,QAAK;AACZ,eAAO,KAAK;MAChB;MAEA,IAAW,MAAM,OAAuB;AACpC,aAAK,eAAe;MACxB;;;;;;;;MASA,IAAW,QAAK;AACZ,eAAO,KAAK;MAChB;MAEA,IAAW,MAAM,OAAuB;AACpC,aAAK,eAAe;MACxB;;;;;;MAOA,IAAW,4BAAyB;AAChC,eAAO,KAAK;MAChB;MAEA,IAAW,0BAA0B,OAAuB;AACxD,aAAK,mCAAmC;MAC5C;;;;MAKA,IAAW,qBAAkB;AACzB,eAAO,KAAK;MAChB;MAEA,IAAW,mBAAmB,OAAa;AACvC,aAAK,sBAAsB;MAC/B;;;;;MAOA,IAAW,aAAU;AACjB,eAAO,KAAK;MAChB;MAEA,IAAW,WAAW,OAAc;AAChC,aAAK,cAAc;MACvB;;;;MAyBA,cAAA;AA3GO,aAAA,eAAuB;AAuEtB,aAAA,cAAc;AAcf,aAAA,eAAiC;AAGjC,aAAA,eAAiC;AAGjC,aAAA,eAAiC;AAGjC,aAAA,mCAAqD;AAGrD,aAAA,sBAA8B;MAUtB;;;;;;;;;;;MAYR,cACH,QAAQ,GAAA,QAAU,GAAA,QAAA,GAAA,4BACD,GAAC,eAAA,GAAA,qBACV,GAAU;AAKlB,aAAK,eAAe;AACpB,aAAK,eAAe;AACpB,aAAK,eAAe;AACpB,aAAK,mCAAmC;AACxC,aAAK,eAAe;AACpB,aAAK,sBAAsB;AAE3B,eAAO;MACX;;;;;;MAOO,eAAe,OAAqB;AACvC,eACI,KAAK,iBAAiB,MAAM,gBAC5B,KAAK,iBAAiB,MAAM,gBAC5B,KAAK,iBAAiB,MAAM,gBAC5B,KAAK,qCAAqC,MAAM,oCAChD,KAAK,iBAAiB,MAAM,gBAC5B,KAAK,wBAAwB,MAAM,uBACnC,KAAK,gBAAgB,MAAM;MAEnC;;;;;;AClKJ,IAaY,uBAmEC;AAhFb;;;AAIA;AASA,KAAA,SAAYC,wBAAqB;AAI7B,MAAAA,uBAAAA,uBAAA,SAAA,IAAA,CAAA,IAAA;AAIA,MAAAA,uBAAAA,uBAAA,KAAA,IAAA,CAAA,IAAA;AAIA,MAAAA,uBAAAA,uBAAA,MAAA,IAAA,CAAA,IAAA;AAIA,MAAAA,uBAAAA,uBAAA,KAAA,IAAA,CAAA,IAAA;AAIA,MAAAA,uBAAAA,uBAAA,SAAA,IAAA,CAAA,IAAA;AAIA,MAAAA,uBAAAA,uBAAA,cAAA,IAAA,CAAA,IAAA;AAIA,MAAAA,uBAAAA,uBAAA,mBAAA,IAAA,CAAA,IAAA;AAIA,MAAAA,uBAAAA,uBAAA,MAAA,IAAA,CAAA,IAAA;AAIA,MAAAA,uBAAAA,uBAAA,SAAA,IAAA,CAAA,IAAA;AAIA,MAAAA,uBAAAA,uBAAA,iBAAA,IAAA,CAAA,IAAA;AAIA,MAAAA,uBAAAA,uBAAA,OAAA,IAAA,EAAA,IAAA;AAIA,MAAAA,uBAAAA,uBAAA,YAAA,IAAA,EAAA,IAAA;AAIA,MAAAA,uBAAAA,uBAAA,cAAA,IAAA,EAAA,IAAA;AAIA,MAAAA,uBAAAA,uBAAA,aAAA,IAAA,EAAA,IAAA;AAIA,MAAAA,uBAAAA,uBAAA,OAAA,IAAA,EAAA,IAAA;IACJ,GA7DY,0BAAA,wBAAqB,CAAA,EAAA;AAmE3B,IAAO,kBAAP,MAAO,yBAAwB,eAAc;;;;;MAmC/C,IAAW,aAAU;AACjB,eAAO,KAAK;MAChB;MACA,IAAW,WAAW,OAAc;AAChC,aAAK,kBAAkB;MAC3B;;MAsJA,IAAW,WAAQ;AACf,eAAO,KAAK;MAChB;;MAGO,aAAa,IAAU;AAC1B,aAAK,YAAY;MACrB;;;;;MAMO,YAAS;AACZ,eAAO,KAAK;MAChB;;;;MAKA,IAAW,SAAM;AACb,eAAO,KAAK;MAChB;;;;;;;MAQA,YAAY,QAAoB,QAA+B,kBAAkB,OAAK;AAClF,cAAK;AAzNF,aAAA,UAAmB;AAInB,aAAA,SAAkB;AAIlB,aAAA,OAAgB;AAIhB,aAAA,YAAqB;AAIrB,aAAA,cAAuB;AAIvB,aAAA,MAAc;AAMd,aAAA,kBAA2B;AAc3B,aAAA,UAAkB;AAIlB,aAAA,OAAe;AAIf,aAAA,SAAiB;AAIjB,aAAA,qBAAqB,IAAI,WAAU;AAInC,aAAA,oBAAoB,IAAI,WAAU;AAIlC,aAAA,oBAMH;AAIG,aAAA,QAAgB;AAIhB,aAAA,SAAiB;AAIjB,aAAA,QAAgB;AAIhB,aAAA,YAAoB;AAIpB,aAAA,aAAqB;AAIrB,aAAA,YAAoB;AAIpB,aAAA,UAAmB;AAInB,aAAA,gBAAgB;AAEhB,aAAA,qBAAqB;AAErB,aAAA,UAAU,sBAAsB;AAEhC,aAAA,UAAoG;AAEpG,aAAA,cAAyC;AAEzC,aAAA,mBAAgD;AAEhD,aAAA,wBAAuD;AAEvD,aAAA,QAAgB;AAEhB,aAAA,aAAqB;AAErB,aAAA,SAA6B;AAE7B,aAAA,iBAAoC;AAEpC,aAAA,kBAAqD;AAErD,aAAA,yBAA2C;AAE3C,aAAA,cAAuB;AAEvB,aAAA,eAAiC;AAEjC,aAAA,uBAAsD;AAEtD,aAAA,8BAAsE;AAEtE,aAAA,+BAA+B;AAE/B,aAAA,sBAA8B;AAE9B,aAAA,uBAA+B;AAE/B,aAAA,iBAA0B;AAE1B,aAAA,iBAAyB;AAQzB,aAAA,kBAAyC;AAEzC,aAAA,iBAAwC;AAExC,aAAA,iBAAwC;AAExC,aAAA,UAAmB;AAGnB,aAAA,qBAA8B;AAE9B,aAAA,qBAA4C;AAG5C,aAAA,mBAAqD;AAGrD,aAAA,eAAiC;AAGjC,aAAA,cAAsB;AAGtB,aAAA,cAAiC;AAGjC,aAAA,eAAe;AAGf,aAAA,wBAA+C;AA0ClD,aAAK,UAAU;AACf,aAAK,UAAU;AACf,aAAK,YAAY,iBAAgB;AAEjC,YAAI,CAAC,iBAAiB;AAClB,eAAK,mBAAmB,OAAO,uBAAsB;;MAE7D;;;;MAKO,sBAAmB;AACtB,aAAK;MACT;;;;;;;MAQO,WAAW,OAAY,QAAa,QAAa,GAAC;AACrD,aAAK,QAAQ,wBAAwB,MAAM,OAAO,QAAQ,KAAK;AAE/D,aAAK,QAAQ;AACb,aAAK,SAAS;AACd,aAAK,QAAQ;AAEb,aAAK,YAAY;AACjB,aAAK,aAAa;AAClB,aAAK,YAAY;AAEjB,aAAK,QAAQ,QAAQ,SAAS;MAClC;;MAGO,WAAQ;AACX,aAAK,UAAU;AACf,aAAK,yBAAyB;AAC9B,aAAK,eAAe;AACpB,aAAK,eAAe;AACpB,aAAK,eAAe;AACpB,aAAK,mCAAmC;AACxC,YAAI,KAAK,mBAAmB;AACxB,gBAAM,OAAO,KAAK,kBAAkB,IAAI;AACxC,gBAAM,oBAAoB,CAAC,yBAAyC;AAChE,iCAAqB,YAAY,MAAM,KAAK;AAC5C,iBAAK,UAAU,KAAK;UACxB;AACA,cAAI,KAAK,SAAS;AACb,iBAAK,MAAmC,KAAK,iBAAiB;iBAC5D;AACH,8BAAkB,KAAK,KAAwB;;AAEnD;;AAGJ,YAAI;AACJ,gBAAQ,KAAK,QAAQ;UACjB,KAAK,sBAAsB;AACvB;UAEJ,KAAK,sBAAsB;AACvB,oBAAQ,KAAK,QAAQ;cACjB,KAAK,gBAAgB,KAAK;cAC1B,CAAC,KAAK;cACN,KAAK;cACL;cACA,KAAK;;;cAGL,CAAC,SAAQ;AACL,qBAAK,YAAY,MAAM,KAAK;AAC5B,qBAAK,UAAU;cACnB;cACA;cACA,KAAK;cACL;cACA,KAAK;cACL,KAAK;cACL;cACA;cACA;cACA,KAAK;YAAc;AAEvB;UAEJ,KAAK,sBAAsB;AACvB,oBAAQ,KAAK,QAAQ,iBACjB,KAAK,aACL,KAAK,WACL,KAAK,YACL,KAAK,QACL,KAAK,iBACL,KAAK,SACL,KAAK,cACL,KAAK,cACL,KAAK,MACL,KAAK,gBACL,KAAK,cAAc;AAEvB,kBAAM,YAAY,MAAM,KAAK;AAE7B,iBAAK,UAAU;AACf;UAEJ,KAAK,sBAAsB;AACvB,oBAAQ,KAAK,QAAQ,mBACjB,KAAK,aACL,KAAK,WACL,KAAK,YACL,KAAK,WACL,KAAK,QACL,KAAK,iBACL,KAAK,SACL,KAAK,cACL,KAAK,cACL,KAAK,IAAI;AAEb,kBAAM,YAAY,MAAM,KAAK;AAE7B,iBAAK,UAAU;AACf;UAEJ,KAAK,sBAAsB;AACvB,oBAAQ,KAAK,QAAQ,wBACjB,KAAK,aACL,KAAK,WACL,KAAK,YACL,KAAK,WACL,KAAK,QACL,KAAK,iBACL,KAAK,SACL,KAAK,cACL,KAAK,cACL,KAAK,IAAI;AAEb,kBAAM,YAAY,MAAM,KAAK;AAE7B,iBAAK,UAAU;AACf;UAEJ,KAAK,sBAAsB;AACvB,oBAAQ,KAAK,QAAQ,qBAAqB,KAAK,WAAW,KAAK,YAAY,KAAK,iBAAiB,KAAK,YAAY;AAClH,kBAAM,YAAY,MAAM,KAAK;AAC7B,gBAAI,KAAK,uBAAuB;AAC5B,mBAAK,QAAQ,qBAAqB,MAAM,KAAK,uBAAuB,KAAK,SAAS,KAAK,cAAc,KAAK,QAAQ,IAAI;;AAI1H;UAEJ,KAAK,sBAAsB;AACvB,oBAAQ,KAAK,QAAQ,kBACjB,KAAK,KACL,MACA,KAAK,QACL,CAAC,KAAK,iBACN,MAAK;AACD,oBAAM,YAAY,MAAM,KAAK;AAC7B,mBAAK,UAAU;YACnB,GACA,MACA,KAAK,QACL,KAAK,YACL,OACA,GACA,GACA,MACA,QACA,KAAK,cAAc;AAEvB;UAEJ,KAAK,sBAAsB;AACvB,oBAAQ,KAAK,QAAQ,qBACjB,KAAK,kBACL,KAAK,OACL,KAAK,mBAAmB,KAAK,QAC7B,KAAK,MACL,KAAK,iBACL,KAAK,SACL,KAAK,cACL,KAAK,YAAY;AAErB,kBAAM,YAAY,MAAM,KAAK;AAC7B,iBAAK,UAAU;AACf;UAEJ,KAAK,sBAAsB;AAGvB;UAEJ,KAAK,sBAAsB;AACvB,oBAAQ,KAAK,QAAQ,6BACjB,KAAK,KACL,MACA,KAAK,qBACL,KAAK,sBACL,CAACC,WAAS;AACN,kBAAIA,QAAO;AACP,gBAAAA,OAAM,YAAY,MAAM,KAAK;;AAEjC,mBAAK,UAAU;YACnB,GACA,MACA,KAAK,QACL,KAAK,UAAU;AAEnB,kBAAM,uBAAuB,KAAK;AAClC;UAEJ,KAAK,sBAAsB;UAC3B,KAAK,sBAAsB,OAAO;AAE9B;;;MAGZ;;;;MAKO,YAAY,QAAyB,UAAU,MAAI;AAhhB9D;AAmhBQ,mBAAK,qBAAL,mBAAuB,SAAS,OAAO,SAAS,KAAK,iBAAiB,KAAK,WAAW,KAAK,QAAQ,KAAK,MAAM,KAAK,OAAO,KAAK,QAAQ,KAAK;AAE5I,eAAO,mBAAmB,KAAK;AAC/B,YAAI,SAAS;AACT,iBAAO,UAAU,KAAK;;AAG1B,YAAI,KAAK,iBAAiB;AACtB,cAAI,OAAO,iBAAiB;AACxB,mBAAO,gBAAgB,QAAO;;AAElC,iBAAO,kBAAkB,KAAK;;AAGlC,YAAI,KAAK,gBAAgB;AACrB,cAAI,OAAO,gBAAgB;AACvB,mBAAO,eAAe,QAAO;;AAEjC,iBAAO,iBAAiB,KAAK;;AAGjC,YAAI,KAAK,gBAAgB;AACrB,cAAI,OAAO,gBAAgB;AACvB,mBAAO,eAAe,QAAO;;AAEjC,iBAAO,iBAAiB,KAAK;;AAGjC,YAAI,KAAK,oBAAoB;AACzB,cAAI,OAAO,oBAAoB;AAC3B,mBAAO,mBAAmB,QAAO;;AAErC,iBAAO,qBAAqB,KAAK;;AAGrC,cAAM,QAAQ,KAAK,QAAQ,uBAAsB;AACjD,YAAI,QAAQ,MAAM,QAAQ,IAAI;AAC9B,YAAI,UAAU,IAAI;AACd,gBAAM,OAAO,OAAO,CAAC;;AAGzB,gBAAQ,MAAM,QAAQ,MAAM;AAC5B,YAAI,UAAU,IAAI;AACd,gBAAM,KAAK,MAAM;;MAEzB;;;;MAKO,UAAO;AACV,aAAK;AACL,aAAK,mBAAmB,MAAK;AAC7B,aAAK,kBAAkB,MAAK;AAC5B,YAAI,KAAK,gBAAgB,GAAG;AACxB,eAAK,QAAQ,gBAAgB,IAAI;AACjC,eAAK,mBAAmB;AACxB,eAAK,wBAAwB;;MAErC;;AAnUc,oBAAA,WAAW;;;;;AC3Q7B,IAGM,cAGO;AANb;;;AAGA,IAAM,eAAe;AAGf,IAAO,wBAAP,MAA4B;MAAlC,cAAA;AACW,aAAA,iBAAiB,eAAe;MA0C3C;MAxCW,mBAAmB,WAAiB;AACvC,eAAO,UAAU,QAAQ,aAAa,IAAI;MAC9C;MAEO,aAAa,SAAiB,aAAoB;AACrD,eAAO,aAAa,KAAK,OAAO;MACpC;MAEO,iBAAiB,SAAiB,YAAmB;AACxD,eAAO,QAAQ,QAAQ,WAAW,aAAa,OAAO,KAAK;MAC/D;MAEO,cAAc,MAAc,SAAmB,YAAmB;AACrE,cAAM,0BAA0B,KAAK,OAAO,0CAA0C,MAAM;AAG5F,cAAM,QAAQ;AACd,eAAO,KAAK,QAAQ,OAAO,EAAE;AAG7B,eAAO,KAAK,QAAQ,mBAAmB,UAAU;AACjD,YAAI,YAAY;AACZ,gBAAM,YAAY,KAAK,OAAO,kCAAkC,MAAM;AAEtE,iBAAO,KAAK,QAAQ,yBAAyB,aAAa;AAC1D,iBAAO,KAAK,QAAQ,2BAA2B,aAAa;AAC5D,iBAAO,KAAK,QAAQ,qBAAqB,UAAU;AACnD,iBAAO,KAAK,QAAQ,oBAAoB,cAAc;AACtD,iBAAO,KAAK,QAAQ,iBAAiB,aAAa;AAClD,iBAAO,KAAK,QAAQ,gBAAgB,YAAY;AAChD,iBAAO,KAAK,QAAQ,uBAAuB,2BAA2B,YAAY,KAAK,kDAAkD,YAAY;eAClJ;AACH,gBAAM,wBAAwB,QAAQ,QAAQ,mBAAmB,MAAM;AACvE,cAAI,uBAAuB;AACvB,mBAAO,yEAAyE;;;AAIxF,eAAO;MACX;;;;;;AChDJ,IAGa;AAHb;;AAGM,IAAO,aAAP,MAAO,YAAU;;;;MAiBnB,IAAW,qBAAkB;AACzB,eAAO;MACX;;;;MAUA,cAAA;AAvBO,aAAA,aAAqB;AAErB,aAAA,WAAmB;AAInB,aAAA,WAAoB;AAkBvB,aAAK,WAAW,YAAW;MAC/B;;AA9Be,eAAA,WAAW;;;;;ACJ9B,IAIa;AAJb;;;AAIM,IAAO,kBAAP,cAA+B,WAAU;MAG3C,YAAmB,UAAqB;AACpC,cAAK;AACL,aAAK,UAAU;MACnB;MAEA,IAAW,qBAAkB;AACzB,eAAO,KAAK;MAChB;;;;;;ACRJ,IACa;AADb;;AACM,IAAO,uBAAP,MAA2B;MAAjC,cAAA;AACY,aAAA,cAAsC,CAAA;AAYvC,aAAA,yBAA2C;AAC3C,aAAA,2BAA6C;AAC7C,aAAA,mBAAqC;AACrC,aAAA,yBAA2C;AAG3C,aAAA,cAAc;MA4mBzB;MA1mBI,IAAW,UAAO;AACd,eAAO,KAAK;MAChB;MAEA,IAAW,UAAO;AACd,YAAI,KAAK,SAAS;AACd,cAAI,KAAK,oBAAoB;AACzB,mBAAO,KAAK,OAAO,0BAA0B,IAAI;;AAErD,iBAAO;;AAGX,eAAO;MACX;MAEO,+BAA+B,YAA2C;AAC7E,YAAI,cAAc,KAAK,SAAS;AAC5B,qBAAW,KAAK,OAAO;;MAE/B;MAEO,uBACH,QACA,qBACA,eACA,UACA,aACA,UACA,iBACA,YAAoB;AAEpB,cAAM,SAAS,KAAK;AACpB,YAAI,OAAO,wBAAwB;AAC/B,qBAAW,QAAQ,qBAAqB;AACpC,mBAAO,iBAAiB,MAAM,oBAAoB,IAAI,CAAC;;;AAI/D,cAAM,0BAA0B,KAAK,OAAO,YAAY,MAAM,aAAa;AAC3E,gCAAwB,QAAQ,CAAC,SAASC,WAAS;AAC/C,mBAAS,cAAcA,MAAK,CAAC,IAAI;QACrC,CAAC;AACD,aAAK,YAAY;AAEjB,YAAI;AACJ,aAAK,QAAQ,GAAG,QAAQ,YAAY,QAAQ,SAAS;AACjD,gBAAM,UAAU,OAAO,WAAW,YAAY,KAAK,CAAC;AACpD,cAAI,WAAW,MAAM;AACjB,wBAAY,OAAO,OAAO,CAAC;AAC3B;;;AAIR,oBAAY,QAAQ,CAAC,MAAMA,WAAS;AAChC,mBAAS,IAAI,IAAIA;QACrB,CAAC;AAED,mBAAW,QAAQ,OAAO,cAAc,MAAM,eAAe,GAAG;AAC5D,qBAAW,KAAK,IAAI;;MAE5B;;;;MAKO,UAAO;AACV,aAAK,YAAY,CAAA;AACjB,aAAK,cAAc;MACvB;;;;MAKO,aAAa,aAAqB,QAAmB;AACxD,cAAM,QAAQ,KAAK,YAAY,WAAW;AAC1C,cAAM,OAAO,OAAO;AACpB,YAAI,UAAU,UAAa,UAAU,MAAM;AACvC,iBAAO;;AAGX,aAAK,YAAY,WAAW,IAAI;AAEhC,eAAO;MACX;;;;MAKO,aAAa,aAAqB,GAAW,GAAS;AACzD,YAAI,QAAQ,KAAK,YAAY,WAAW;AACxC,YAAI,CAAC,SAAS,MAAM,WAAW,GAAG;AAC9B,kBAAQ,CAAC,GAAG,CAAC;AACb,eAAK,YAAY,WAAW,IAAI;AAChC,iBAAO;;AAGX,YAAI,UAAU;AACd,YAAI,MAAM,CAAC,MAAM,GAAG;AAChB,gBAAM,CAAC,IAAI;AACX,oBAAU;;AAEd,YAAI,MAAM,CAAC,MAAM,GAAG;AAChB,gBAAM,CAAC,IAAI;AACX,oBAAU;;AAGd,eAAO;MACX;;;;MAKO,aAAa,aAAqB,GAAW,GAAW,GAAS;AACpE,YAAI,QAAQ,KAAK,YAAY,WAAW;AACxC,YAAI,CAAC,SAAS,MAAM,WAAW,GAAG;AAC9B,kBAAQ,CAAC,GAAG,GAAG,CAAC;AAChB,eAAK,YAAY,WAAW,IAAI;AAChC,iBAAO;;AAGX,YAAI,UAAU;AACd,YAAI,MAAM,CAAC,MAAM,GAAG;AAChB,gBAAM,CAAC,IAAI;AACX,oBAAU;;AAEd,YAAI,MAAM,CAAC,MAAM,GAAG;AAChB,gBAAM,CAAC,IAAI;AACX,oBAAU;;AAEd,YAAI,MAAM,CAAC,MAAM,GAAG;AAChB,gBAAM,CAAC,IAAI;AACX,oBAAU;;AAGd,eAAO;MACX;;;;MAKO,aAAa,aAAqB,GAAW,GAAW,GAAW,GAAS;AAC/E,YAAI,QAAQ,KAAK,YAAY,WAAW;AACxC,YAAI,CAAC,SAAS,MAAM,WAAW,GAAG;AAC9B,kBAAQ,CAAC,GAAG,GAAG,GAAG,CAAC;AACnB,eAAK,YAAY,WAAW,IAAI;AAChC,iBAAO;;AAGX,YAAI,UAAU;AACd,YAAI,MAAM,CAAC,MAAM,GAAG;AAChB,gBAAM,CAAC,IAAI;AACX,oBAAU;;AAEd,YAAI,MAAM,CAAC,MAAM,GAAG;AAChB,gBAAM,CAAC,IAAI;AACX,oBAAU;;AAEd,YAAI,MAAM,CAAC,MAAM,GAAG;AAChB,gBAAM,CAAC,IAAI;AACX,oBAAU;;AAEd,YAAI,MAAM,CAAC,MAAM,GAAG;AAChB,gBAAM,CAAC,IAAI;AACX,oBAAU;;AAGd,eAAO;MACX;;;;;;MAOO,OAAO,aAAqB,OAAa;AAC5C,cAAM,QAAQ,KAAK,YAAY,WAAW;AAC1C,YAAI,UAAU,UAAa,UAAU,OAAO;AACxC;;AAGJ,YAAI,KAAK,OAAO,OAAO,KAAK,UAAU,WAAW,GAAG,KAAK,GAAG;AACxD,eAAK,YAAY,WAAW,IAAI;;MAExC;;;;;;;MAQO,QAAQ,aAAqB,GAAW,GAAS;AACpD,YAAI,KAAK,aAAa,aAAa,GAAG,CAAC,GAAG;AACtC,cAAI,CAAC,KAAK,OAAO,QAAQ,KAAK,UAAU,WAAW,GAAG,GAAG,CAAC,GAAG;AACzD,iBAAK,YAAY,WAAW,IAAI;;;MAG5C;;;;;;;;MASO,QAAQ,aAAqB,GAAW,GAAW,GAAS;AAC/D,YAAI,KAAK,aAAa,aAAa,GAAG,GAAG,CAAC,GAAG;AACzC,cAAI,CAAC,KAAK,OAAO,QAAQ,KAAK,UAAU,WAAW,GAAG,GAAG,GAAG,CAAC,GAAG;AAC5D,iBAAK,YAAY,WAAW,IAAI;;;MAG5C;;;;;;;;;MAUO,QAAQ,aAAqB,GAAW,GAAW,GAAW,GAAS;AAC1E,YAAI,KAAK,aAAa,aAAa,GAAG,GAAG,GAAG,CAAC,GAAG;AAC5C,cAAI,CAAC,KAAK,OAAO,QAAQ,KAAK,UAAU,WAAW,GAAG,GAAG,GAAG,GAAG,CAAC,GAAG;AAC/D,iBAAK,YAAY,WAAW,IAAI;;;MAG5C;;;;;;MAOO,YAAY,aAAqB,OAAiB;AACrD,aAAK,YAAY,WAAW,IAAI;AAChC,aAAK,OAAO,YAAY,KAAK,UAAU,WAAW,GAAG,KAAK;MAC9D;;;;;;MAOO,aAAa,aAAqB,OAAiB;AACtD,aAAK,YAAY,WAAW,IAAI;AAChC,aAAK,OAAO,aAAa,KAAK,UAAU,WAAW,GAAG,KAAK;MAC/D;;;;;;MAOO,aAAa,aAAqB,OAAiB;AACtD,aAAK,YAAY,WAAW,IAAI;AAChC,aAAK,OAAO,aAAa,KAAK,UAAU,WAAW,GAAG,KAAK;MAC/D;;;;;;MAOO,aAAa,aAAqB,OAAiB;AACtD,aAAK,YAAY,WAAW,IAAI;AAChC,aAAK,OAAO,aAAa,KAAK,UAAU,WAAW,GAAG,KAAK;MAC/D;;;;;;MAOO,QAAQ,aAAqB,OAAa;AAC7C,cAAM,QAAQ,KAAK,YAAY,WAAW;AAC1C,YAAI,UAAU,UAAa,UAAU,OAAO;AACxC;;AAGJ,YAAI,KAAK,OAAO,QAAQ,KAAK,UAAU,WAAW,GAAG,KAAK,GAAG;AACzD,eAAK,YAAY,WAAW,IAAI;;MAExC;;;;;;;MAQO,SAAS,aAAqB,GAAW,GAAS;AACrD,YAAI,KAAK,aAAa,aAAa,GAAG,CAAC,GAAG;AACtC,cAAI,CAAC,KAAK,OAAO,SAAS,KAAK,UAAU,WAAW,GAAG,GAAG,CAAC,GAAG;AAC1D,iBAAK,YAAY,WAAW,IAAI;;;MAG5C;;;;;;;;MASO,SAAS,aAAqB,GAAW,GAAW,GAAS;AAChE,YAAI,KAAK,aAAa,aAAa,GAAG,GAAG,CAAC,GAAG;AACzC,cAAI,CAAC,KAAK,OAAO,SAAS,KAAK,UAAU,WAAW,GAAG,GAAG,GAAG,CAAC,GAAG;AAC7D,iBAAK,YAAY,WAAW,IAAI;;;MAG5C;;;;;;;;;MAUO,SAAS,aAAqB,GAAW,GAAW,GAAW,GAAS;AAC3E,YAAI,KAAK,aAAa,aAAa,GAAG,GAAG,GAAG,CAAC,GAAG;AAC5C,cAAI,CAAC,KAAK,OAAO,SAAS,KAAK,UAAU,WAAW,GAAG,GAAG,GAAG,GAAG,CAAC,GAAG;AAChE,iBAAK,YAAY,WAAW,IAAI;;;MAG5C;;;;;;MAOO,aAAa,aAAqB,OAAkB;AACvD,aAAK,YAAY,WAAW,IAAI;AAChC,aAAK,OAAO,aAAa,KAAK,UAAU,WAAW,GAAG,KAAK;MAC/D;;;;;;MAOO,cAAc,aAAqB,OAAkB;AACxD,aAAK,YAAY,WAAW,IAAI;AAChC,aAAK,OAAO,cAAc,KAAK,UAAU,WAAW,GAAG,KAAK;MAChE;;;;;;MAOO,cAAc,aAAqB,OAAkB;AACxD,aAAK,YAAY,WAAW,IAAI;AAChC,aAAK,OAAO,cAAc,KAAK,UAAU,WAAW,GAAG,KAAK;MAChE;;;;;;MAOO,cAAc,aAAqB,OAAkB;AACxD,aAAK,YAAY,WAAW,IAAI;AAChC,aAAK,OAAO,cAAc,KAAK,UAAU,WAAW,GAAG,KAAK;MAChE;;;;;;MAOO,SAAS,aAAqB,OAAe;AAChD,aAAK,YAAY,WAAW,IAAI;AAChC,aAAK,OAAO,SAAS,KAAK,UAAU,WAAW,GAAG,KAAK;MAC3D;;;;;;MAOO,UAAU,aAAqB,OAAe;AACjD,aAAK,YAAY,WAAW,IAAI;AAChC,aAAK,OAAO,UAAU,KAAK,UAAU,WAAW,GAAG,KAAK;MAC5D;;;;;;MAOO,UAAU,aAAqB,OAAe;AACjD,aAAK,YAAY,WAAW,IAAI;AAChC,aAAK,OAAO,UAAU,KAAK,UAAU,WAAW,GAAG,KAAK;MAC5D;;;;;;MAOO,UAAU,aAAqB,OAAe;AACjD,aAAK,YAAY,WAAW,IAAI;AAChC,aAAK,OAAO,UAAU,KAAK,UAAU,WAAW,GAAG,KAAK;MAC5D;;;;;;MAOO,YAAY,aAAqB,UAAsB;AAC1D,YAAI,CAAC,UAAU;AACX;;AAGJ,aAAK,YAAY,WAAW,IAAI;AAChC,aAAK,OAAO,YAAY,KAAK,UAAU,WAAW,GAAG,QAAQ;MACjE;;;;;;MAOO,UAAU,aAAqB,QAAmB;AACrD,YAAI,KAAK,aAAa,aAAa,MAAM,GAAG;AACxC,cAAI,CAAC,KAAK,OAAO,YAAY,KAAK,UAAU,WAAW,GAAG,OAAO,QAAO,CAAE,GAAG;AACzE,iBAAK,YAAY,WAAW,IAAI;;;MAG5C;;;;;;MAOO,aAAa,aAAqB,QAAoB;AACzD,aAAK,YAAY,WAAW,IAAI;AAChC,aAAK,OAAO,aAAa,KAAK,UAAU,WAAW,GAAG,MAAM;MAChE;;;;;;MAOO,aAAa,aAAqB,QAAoB;AACzD,aAAK,YAAY,WAAW,IAAI;AAChC,aAAK,OAAO,aAAa,KAAK,UAAU,WAAW,GAAG,MAAM;MAChE;;;;;;MAOO,SAAS,aAAqB,OAAa;AAC9C,cAAM,QAAQ,KAAK,YAAY,WAAW;AAC1C,YAAI,UAAU,UAAa,UAAU,OAAO;AACxC;;AAGJ,YAAI,KAAK,OAAO,SAAS,KAAK,UAAU,WAAW,GAAG,KAAK,GAAG;AAC1D,eAAK,YAAY,WAAW,IAAI;;MAExC;;;;;;MAOO,WAAW,aAAqB,SAAqB;AACxD,YAAI,KAAK,aAAa,aAAa,QAAQ,GAAG,QAAQ,CAAC,GAAG;AACtD,cAAI,CAAC,KAAK,OAAO,UAAU,KAAK,UAAU,WAAW,GAAG,QAAQ,GAAG,QAAQ,CAAC,GAAG;AAC3E,iBAAK,YAAY,WAAW,IAAI;;;MAG5C;;;;;;;MAQO,UAAU,aAAqB,GAAW,GAAS;AACtD,YAAI,KAAK,aAAa,aAAa,GAAG,CAAC,GAAG;AACtC,cAAI,CAAC,KAAK,OAAO,UAAU,KAAK,UAAU,WAAW,GAAG,GAAG,CAAC,GAAG;AAC3D,iBAAK,YAAY,WAAW,IAAI;;;MAG5C;;;;;;MAOO,WAAW,aAAqB,SAAqB;AACxD,YAAI,KAAK,aAAa,aAAa,QAAQ,GAAG,QAAQ,GAAG,QAAQ,CAAC,GAAG;AACjE,cAAI,CAAC,KAAK,OAAO,UAAU,KAAK,UAAU,WAAW,GAAG,QAAQ,GAAG,QAAQ,GAAG,QAAQ,CAAC,GAAG;AACtF,iBAAK,YAAY,WAAW,IAAI;;;MAG5C;;;;;;;;MASO,UAAU,aAAqB,GAAW,GAAW,GAAS;AACjE,YAAI,KAAK,aAAa,aAAa,GAAG,GAAG,CAAC,GAAG;AACzC,cAAI,CAAC,KAAK,OAAO,UAAU,KAAK,UAAU,WAAW,GAAG,GAAG,GAAG,CAAC,GAAG;AAC9D,iBAAK,YAAY,WAAW,IAAI;;;MAG5C;;;;;;MAOO,WAAW,aAAqB,SAAqB;AACxD,YAAI,KAAK,aAAa,aAAa,QAAQ,GAAG,QAAQ,GAAG,QAAQ,GAAG,QAAQ,CAAC,GAAG;AAC5E,cAAI,CAAC,KAAK,OAAO,UAAU,KAAK,UAAU,WAAW,GAAG,QAAQ,GAAG,QAAQ,GAAG,QAAQ,GAAG,QAAQ,CAAC,GAAG;AACjG,iBAAK,YAAY,WAAW,IAAI;;;MAG5C;;;;;;MAOO,cAAc,aAAqB,YAA2B;AACjE,YAAI,KAAK,aAAa,aAAa,WAAW,GAAG,WAAW,GAAG,WAAW,GAAG,WAAW,CAAC,GAAG;AACxF,cAAI,CAAC,KAAK,OAAO,UAAU,KAAK,UAAU,WAAW,GAAG,WAAW,GAAG,WAAW,GAAG,WAAW,GAAG,WAAW,CAAC,GAAG;AAC7G,iBAAK,YAAY,WAAW,IAAI;;;MAG5C;;;;;;;;;MAUO,UAAU,aAAqB,GAAW,GAAW,GAAW,GAAS;AAC5E,YAAI,KAAK,aAAa,aAAa,GAAG,GAAG,GAAG,CAAC,GAAG;AAC5C,cAAI,CAAC,KAAK,OAAO,UAAU,KAAK,UAAU,WAAW,GAAG,GAAG,GAAG,GAAG,CAAC,GAAG;AACjE,iBAAK,YAAY,WAAW,IAAI;;;MAG5C;;;;;;MAOO,UAAU,aAAqB,QAAmB;AACrD,YAAI,KAAK,aAAa,aAAa,OAAO,GAAG,OAAO,GAAG,OAAO,CAAC,GAAG;AAC9D,cAAI,CAAC,KAAK,OAAO,UAAU,KAAK,UAAU,WAAW,GAAG,OAAO,GAAG,OAAO,GAAG,OAAO,CAAC,GAAG;AACnF,iBAAK,YAAY,WAAW,IAAI;;;MAG5C;;;;;;;MAQO,UAAU,aAAqB,QAAqB,OAAa;AACpE,YAAI,KAAK,aAAa,aAAa,OAAO,GAAG,OAAO,GAAG,OAAO,GAAG,KAAK,GAAG;AACrE,cAAI,CAAC,KAAK,OAAO,UAAU,KAAK,UAAU,WAAW,GAAG,OAAO,GAAG,OAAO,GAAG,OAAO,GAAG,KAAK,GAAG;AAC1F,iBAAK,YAAY,WAAW,IAAI;;;MAG5C;;;;;;MAOO,gBAAgB,aAAqB,QAAmB;AAC3D,YAAI,KAAK,aAAa,aAAa,OAAO,GAAG,OAAO,GAAG,OAAO,GAAG,OAAO,CAAC,GAAG;AACxE,cAAI,CAAC,KAAK,OAAO,UAAU,KAAK,UAAU,WAAW,GAAG,OAAO,GAAG,OAAO,GAAG,OAAO,GAAG,OAAO,CAAC,GAAG;AAC7F,iBAAK,YAAY,WAAW,IAAI;;;MAG5C;MAEO,uBAAoB;AACvB,eAAO,KAAK,eAAe,KAAK,OAAO,iBAAiB,KAAK,YAAY,IAAI;MACjF;MAEO,yBAAsB;AACzB,eAAO,KAAK,iBAAiB,KAAK,OAAO,iBAAiB,KAAK,cAAc,IAAI;MACrF;;;;;;ACloBJ,IACa;AADb;;AACM,IAAO,uBAAP,MAA2B;MAS7B,IAAW,qBAAkB;AACzB,eAAO,KAAK;MAChB;MAEA,YAAY,kBAA0C,MAAM,SAA8B;AANlF,aAAA,qBAAoD;AAOxD,aAAK,WAAW;AAChB,YAAI,CAAC,iBAAiB;AAClB,4BAAkB,QAAQ,cAAa;AACvC,cAAI,CAAC,iBAAiB;AAClB,kBAAM,IAAI,MAAM,gCAAgC;;;AAGxD,aAAK,IAAI,eAAe;MAC5B;MAEO,WAAQ;MAAU;MAElB,IAAI,iBAA6B;AACpC,aAAK,gBAAgB;MACzB;MAEO,QAAK;AACR,aAAK,gBAAgB;AACrB,aAAK,qBAAqB;MAC9B;MAEO,oBAAoB,QAAyB;AAChD,YAAI,CAAC,KAAK,oBAAoB;AAC1B,eAAK,qBAAqB,CAAA;;AAE9B,aAAK,mBAAmB,KAAK,MAAM;MACvC;MAEO,2BAAwB;AAC3B,YAAI,KAAK,oBAAoB;AACzB,qBAAW,UAAU,KAAK,oBAAoB;AAC1C,iBAAK,SAAS,mBAAmB,MAAM;;AAE3C,eAAK,qBAAqB;;MAElC;MAEO,oBAAoB,QAAQ,GAAC;AApDxC;AAqDQ,iBAAO,UAAK,uBAAL,mBAA0B,WAAU;MAC/C;MAEO,UAAO;AACV,aAAK,yBAAwB;AAE7B,YAAI,KAAK,eAAe;AACpB,eAAK,SAAS,cAAc,KAAK,aAAa;;AAElD,aAAK,MAAK;MACd;;;;;;AC1DJ,IACa;AADb;;AACM,IAAO,cAAP,MAAkB;MAwBb,OAAO,UAAU,QAA4B;AAChD,eAAQ,OAAkB,uBAAuB;MACrD;MAEO,OAAO,UAAU,QAA4B;AAChD,eAAQ,OAAkB,uBAAuB,SAAa,OAAuB,SAAU;MACnG;MAEA,YAAY,QAAoB,wBAAwB,MAAI;AAtBrD,aAAA,sBAAsB;AAMtB,aAAA,yBAAyB;AAMzB,aAAA,+BAAkD;AAWrD,aAAK,SAAS;AACd,aAAK,UAAU;AACf,aAAK,cAAc,OAAO,kBAAiB;AAC3C,YAAI,uBAAuB;AACvB,eAAK,kBAAkB,OAAO,sBAAqB;;MAE3D;MAEO,UAAU,QAA0B,SAA8C,eAAe,MAAI;AA1ChH;AA2CQ,aAAK,SAAS;AACd,YAAI,YAAY,QAAW;AACvB,eAAK,UAAU;;AAEnB,YAAI,cAAc;AACd,qBAAK,gBAAL,mBAAkB;;MAE1B;MAEO,UAAO;AApDlB;AAqDQ,mBAAK,gBAAL,mBAAkB;MACtB;;;;;;AC5DJ,IAGa;AAHb;;AAGM,IAAO,uBAAP,MAA2B;MAuB7B,IAAW,UAAO;AACd,eAAO,KAAK,uBAAuB,KAAK,uBAAuB,KAAK,uBAAuB,KAAK;MACpG;MAEA,IAAW,OAAI;AACX,eAAO,KAAK;MAChB;MAEA,IAAW,KAAK,OAAa;AACzB,YAAI,KAAK,UAAU,OAAO;AACtB;;AAGJ,aAAK,QAAQ;AACb,aAAK,sBAAsB;MAC/B;MAEA,IAAW,UAAO;AACd,eAAO,KAAK;MAChB;MAEA,IAAW,QAAQ,OAAa;AAC5B,YAAI,KAAK,aAAa,OAAO;AACzB;;AAGJ,aAAK,WAAW;AAChB,aAAK,sBAAsB;MAC/B;MAEA,IAAW,WAAQ;AACf,eAAO,KAAK;MAChB;MAEA,IAAW,SAAS,OAAa;AAC7B,YAAI,KAAK,cAAc,OAAO;AAC1B;;AAGJ,aAAK,YAAY;AACjB,aAAK,sBAAsB;MAC/B;MAEA,IAAW,gBAAa;AACpB,eAAO,KAAK;MAChB;MAEA,IAAW,cAAc,OAAa;AAClC,YAAI,KAAK,mBAAmB,OAAO;AAC/B;;AAGJ,aAAK,iBAAiB;AACtB,aAAK,oBAAoB;MAC7B;MAEA,IAAW,cAAW;AAClB,eAAO,KAAK;MAChB;MAEA,IAAW,YAAY,OAAa;AAChC,YAAI,KAAK,iBAAiB,OAAO;AAC7B;;AAGJ,aAAK,eAAe;AACpB,aAAK,oBAAoB;MAC7B;MAEA,IAAW,qBAAkB;AACzB,eAAO,KAAK;MAChB;MAEA,IAAW,mBAAmB,OAAa;AACvC,YAAI,KAAK,wBAAwB,OAAO;AACpC;;AAGJ,aAAK,sBAAsB;AAC3B,aAAK,oBAAoB;MAC7B;MAEA,IAAW,OAAI;AACX,eAAO,KAAK;MAChB;MAEA,IAAW,KAAK,OAAa;AACzB,YAAI,KAAK,UAAU,OAAO;AACtB;;AAGJ,aAAK,QAAQ;AACb,aAAK,sBAAsB;MAC/B;MAEA,IAAW,UAAO;AACd,eAAO,KAAK;MAChB;MAEA,IAAW,QAAQ,OAAc;AAC7B,YAAI,KAAK,aAAa,OAAO;AACzB;;AAGJ,aAAK,WAAW;AAChB,aAAK,sBAAsB;MAC/B;MAEA,YAAmB,QAAQ,MAAI;AAlIrB,aAAA,sBAAsB;AACtB,aAAA,sBAAsB;AACtB,aAAA,sBAAsB;AACtB,aAAA,oBAAoB;AAiBvB,aAAA,uBAAuB;AA+G1B,YAAI,OAAO;AACP,eAAK,MAAK;;MAElB;MAEO,QAAK;AA5IhB;AA6IQ,aAAK,kBAAkB;AAEvB,mBAAK,kBAAL,mBAAoB;AAEpB,aAAK,sBAAsB;AAC3B,aAAK,sBAAsB;AAC3B,aAAK,sBAAsB;AAC3B,aAAK,oBAAoB;MAC7B;MAEO,MAAM,IAA0B;AAvJ3C;AAwJQ,YAAI,CAAC,IAAI;AACL;;AAGJ,cAAM,yBAAyB,CAAC,KAAK,wBAAwB,CAAC,GAAC,UAAK,oBAAL,mBAAsB;AAErF,aAAK,UAAU,yBAAyB,KAAK,gBAAiB,UAAU,KAAK,cAAc;AAC3F,aAAK,OAAO,yBAAyB,KAAK,gBAAiB,OAAO,KAAK,cAAc;AACrF,aAAK,UAAU,yBAAyB,KAAK,gBAAiB,UAAU,KAAK,cAAc;AAC3F,aAAK,WAAW,yBAAyB,KAAK,gBAAiB,WAAW,KAAK,cAAc;AAC7F,aAAK,gBAAgB,yBAAyB,KAAK,gBAAiB,gBAAgB,KAAK,cAAc;AACvG,aAAK,cAAc,yBAAyB,KAAK,gBAAiB,cAAc,KAAK,cAAc;AACnG,aAAK,qBAAqB,yBAAyB,KAAK,gBAAiB,qBAAqB,KAAK,cAAc;AACjH,aAAK,OAAO,yBAAyB,KAAK,gBAAiB,OAAO,KAAK,cAAc;AAErF,YAAI,CAAC,KAAK,SAAS;AACf;;AAIJ,YAAI,KAAK,qBAAqB;AAC1B,cAAI,KAAK,SAAS;AACd,eAAG,OAAO,GAAG,YAAY;iBACtB;AACH,eAAG,QAAQ,GAAG,YAAY;;AAE9B,eAAK,sBAAsB;;AAI/B,YAAI,KAAK,qBAAqB;AAC1B,aAAG,YAAY,KAAK,IAAI;AACxB,eAAK,sBAAsB;;AAI/B,YAAI,KAAK,qBAAqB;AAC1B,aAAG,YAAY,KAAK,MAAM,KAAK,SAAS,KAAK,QAAQ;AACrD,eAAK,sBAAsB;;AAI/B,YAAI,KAAK,mBAAmB;AACxB,aAAG,UAAU,KAAK,eAAe,KAAK,aAAa,KAAK,kBAAkB;AAC1E,eAAK,oBAAoB;;MAEjC;;;;;;ACxMJ,IAQa;AARb;;;AAQM,IAAO,uBAAP,MAA2B;MAAjC,cAAA;AACW,aAAA,iBAAiB,eAAe;MAY3C;MAVW,cAAc,MAAc,SAAmB,YAAqB,mBAAsD,QAAkB;AAE/I,YAAI,CAAC,OAAO,QAAO,EAAG,sBAAsB;AAExC,gBAAM,QAAQ;AACd,iBAAO,KAAK,QAAQ,OAAO,EAAE;;AAGjC,eAAO;MACX;;;;;;ACpBJ,IAsEM,eAiIO;AAvMb;;AACA;AAGA;AACA;AAOA;AACA;AACA;AACA;AAEA;AAIA;AACA;AACA;AACA;AACA;AAEA;AAOA;AAGA;AACA;AAIA;AAKA;AAQA;AAeA,IAAM,gBAAN,MAAmB;;AAiIb,IAAO,aAAP,MAAO,YAAU;;;;;MA6BZ,WAAW,aAAU;AACxB,eAAO;MACX;;;;MAKO,WAAW,UAAO;AACrB,eAAO;MACX;;;;MAKA,IAAW,cAAW;AAClB,YAAI,cAAc,KAAK,OAAO,KAAK;AAEnC,YAAI,KAAK,MAAM,uBAAuB;AAClC,yBAAe;;AAGnB,eAAO;MACX;;;;MAQA,IAAW,OAAI;AACX,eAAO,KAAK;MAChB;MAEA,IAAW,KAAK,OAAa;AACzB,aAAK,QAAQ;MACjB;;;;MAKA,IAAW,UAAO;AACd,eAAO,KAAK;MAChB;MAIA,IAAW,aAAU;AACjB,eAAO,KAAK;MAChB;;;;MAYO,WAAW,oBAAiB;AAC/B,eAAO,OAAO;MAClB;MACO,WAAW,kBAAkB,OAAa;AAC7C,eAAO,oBAAoB;MAC/B;;;;MAOO,oBAAoB,gBAA8B;AACrD,eAAO,KAAK;MAChB;;;;;MAoCA,IAAW,wBAAqB;AAC5B,eAAO,KAAK;MAChB;MAEA,IAAW,sBAAsB,YAAU;AACvC,YAAI,eAAe,KAAK,wBAAwB;AAC5C;;AAGJ,aAAK,yBAAyB;AAE9B,YAAI,YAAY;AACZ,eAAK,mBAAmB,YAAY;eACjC;AACH,eAAK,mBAAmB,YAAY;;MAE5C;;;;MA0BA,IAAW,UAAO;AACd,eAAO,KAAK;MAChB;;;;;MAgBA,IAAW,yBAAsB;AAC7B,eAAO,KAAK,eAAe,KAAK,CAAC,KAAK;MAC1C;;;;;MAuBO,qBAAkB;AACrB,eAAO,KAAK;MAChB;;MAIA,IAAW,gCAA6B;AACpC,eAAO,CAAC,EAAE,KAAK,MAAM,gCAAgC,KAAK;MAC9D;;;;;MAMA,IAAW,kBAAe;AACtB,eAAO,KAAK,gBAAgB,KAAK,KAAK;MAC1C;;;;;MA6BA,IAAW,oBAAiB;AACxB,eAAO,KAAK;MAChB;;;;;MAsBA,IAAW,yBAAsB;AAC7B,eAAO,KAAK;MAChB;MAEA,IAAW,uBAAuB,OAAc;AAC5C,aAAK,0BAA0B;MACnC;MA6GA,IAAc,oCAAiC;AAC3C,eAAO;MACX;;;;;;MASA,IAAW,4BAA4B,YAA6E;AAChH,aAAK,+BAA+B;MACxC;;;;MAKA,IAAW,kBAAe;AACtB,eAAO,KAAK;MAChB;;;;MAKA,IAAW,eAAY;AACnB,YAAI,CAAC,KAAK,eAAe;AACrB,eAAK,gBAAgB,KAAK,iBAAiB,IAAI,WAAW,CAAC,GAAG,GAAG,GAAG,GAAA,OAAU,OAAA,CAAA;;AAGlF,eAAO,KAAK;MAChB;;;;MAKA,IAAW,iBAAc;AACrB,YAAI,CAAC,KAAK,iBAAiB;AACvB,eAAK,kBAAkB,KAAK,mBAAmB,IAAI,WAAW,CAAC,GAAG,GAAG,GAAG,GAAG,GAAA,OAAU,OAAA,CAAA;;AAGzF,eAAO,KAAK;MAChB;;;;MAKA,IAAW,sBAAmB;AAC1B,YAAI,CAAC,KAAK,sBAAsB;AAC5B,eAAK,uBAAuB,KAAK,wBAC7B,IAAI,WAAW,CAAC,GAChB,GACA,GACA,GACA,GAAA,OAAU,OAAA,CAAA;;AAOlB,eAAO,KAAK;MAChB;;;;MAKA,IAAW,mBAAgB;AACvB,YAAI,CAAC,KAAK,mBAAmB;AACzB,gBAAM,WAAW,IAAI,WAAW,CAAC;AACjC,gBAAM,WAAW,CAAC,UAAU,UAAU,UAAU,UAAU,UAAU,QAAQ;AAC5E,eAAK,oBAAoB,KAAK,qBAC1B,UACA,GACA,GAAA,GAAA,OAAU,OAAA,CAAA;;AAQlB,eAAO,KAAK;MAChB;;;;MAiBA,IAAW,WAAQ;AACf,eAAO,KAAK;MAChB;;;;MAOA,IAAW,qBAAkB;AACzB,eAAO,KAAK;MAChB;;;;;MAMA,IAAW,oBAAiB;AACxB,eAAO;MACX;MAEA,IAAW,kBAAkB,UAAQ;MAErC;;;;MAMA,IAAW,wBAAqB;AAC5B,eAAO,KAAK;MAChB;MAEA,IAAW,sBAAsB,MAAY;AACzC,aAAK,yBAAyB;MAClC;;;;MAUO,yBAAsB;AACzB,aAAK,oBAAoB;MAC7B;MAIQ,OAAO,cAAc,OAAe,QAAc;AACtD,YAAI,OAAO,aAAa,aAAa;AACjC,iBAAsB,IAAI,gBAAgB,OAAO,MAAM;;AAE3D,cAAM,SAAwB,SAAS,cAAc,QAAQ;AAC7D,eAAO,QAAQ;AACf,eAAO,SAAS;AAChB,eAAO;MACX;;;;;;;MAQO,aAAa,OAAe,QAAc;AAC7C,eAAO,YAAW,cAAc,OAAO,MAAM;MACjD;;;;;MAMO,oBAAiB;AACpB,eAAO,SAAS,cAAc,KAAK;MACvC;;;;;;;;MASA,YACI,iBACA,WACA,SACA,oBAA4B;AA9xBpC;AA6Pc,aAAA,QAAQ;AAoBR,aAAA,cAAc;AAmCjB,aAAA,mBAAmB;AAKnB,aAAA,eAAe;AAMf,aAAA,gBAAmC;AAKnC,aAAA,yBAAyB;AAKzB,aAAA,gCAAgC;AAGhC,aAAA,yBAAyB;AAExB,aAAA,yBAAyB;AA0BjB,aAAA,kBAA2B;AAK3B,aAAA,sBAA+B;AAKxC,aAAA,wBAAwB;AAKf,aAAA,sBAAsB,IAAI,WAAU;AAE5C,aAAA,WAAW;AAcZ,aAAA,kBAAkB,IAAI,MAAK;AAE3B,aAAA,kBAAkB,IAAI,MAAK;AAe3B,aAAA,gBAAgB;AAEb,aAAA,sBAAsB;AAkBtB,aAAA,+BAA+B;AAelC,aAAA,SAAS;AAGT,aAAA,gBAAgB;AAiBb,aAAA,qBAAqB,IAAI,MAAK;AAcjC,aAAA,0BAA0B,IAAI,WAAU;AAIxC,aAAA,8BAA8B,IAAI,WAAU;AAGzC,aAAA,kBAAkB;AAGrB,aAAA,0BAA0B;AAiB1B,aAAA,4BAA4B;AAIzB,aAAA,cAAc;AAEd,aAAA,qBAAqB;AAErB,aAAA,qBAAqB,IAAI,kBAAiB;AAE1C,aAAA,wBAAwB,IAAI,qBAAoB;AAEhD,aAAA,gBAAgB,IAAI,aAAY;AAEnC,aAAA,cAAc,IAAI,WAAU;AAE5B,aAAA,aAAa;AAEb,aAAA,iBAAiB;AAIjB,aAAA,yBAAyB,IAAI,MAAK;AAElC,aAAA,4BAA4B,IAAI,MAAK;AAElC,aAAA,iBAAiB;AACnB,aAAA,yBAAyB;AAEvB,aAAA,sBAAoE,CAAA;AAQpE,aAAA,mBAA8C,CAAA;AAChD,aAAA,6BAAwC,CAAA;AAYzC,aAAA,uBAAsD;AACrD,aAAA,2BAA2B;AACzB,aAAA,sBAAsB,IAAI,MAAK;AAElC,aAAA,sBAAkD;AAElD,aAAA,oBAAgD;AAC/C,aAAA,yBAAyB,IAAI,MAAK;AAClC,aAAA,4BAA4B,IAAI,MAAK;AACrC,aAAA,0BAA0B,IAAI,MAAK;AASpC,aAAA,uBAA4B,MAAM,KAAK,YAAW;AAEjD,aAAA,uBAAuB;AACvB,aAAA,4BAA4B;AAQ7B,aAAA,gBAAwB;AAEvB,aAAA,wBAAwB,IAAI,MAAK;AACjC,aAAA,2BAA2B;AAC3B,aAAA,0BAA4C;AAE5C,aAAA,kBAAkB,IAAI,MAAK;AAK5B,aAAA,qBAA8B;AAE3B,aAAA,wBAAgC;AAGnC,aAAA,uBAA0D;AAK1D,aAAA,kBAAmC;UACtC,UAAU;;AA2FP,aAAA,qBAA8B;AAK9B,aAAA,gCAAgC,IAAI,WAAU;AAG3C,aAAA,YAAqB;AA6BrB,aAAA,yBAAyB;AA+iCzB,aAAA,kBAAkB,EAAE,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,EAAC;AA+xF5C,aAAA,qBAAwC;AAOzC,aAAA,0BAA0B;AA+gBvB,aAAA,iBAA0D,CAAA;AAjyIhE,aAAK,YAAY,cAAc;AAE/B,YAAI,SAAsC;AAE1C,kBAAU,WAAW,CAAA;AAErB,aAAK,mBAAmB;AAGxB,aAAK,qBAAqB,sBAAsB;AAEhD,aAAK,sBAAsB,gBAAgB,KAAK;AAEhD,gCAAwB,mBAAmB,CAAC,CAAC,QAAQ,sBAAsB;AAE3E,gBAAQ,YAAY,aAAa,QAAQ;AACzC,gBAAQ,wBAAwB,QAAQ,yBAAyB;AACjE,gBAAQ,mBAAmB,QAAQ,oBAAoB;AACvD,gBAAQ,WAAW,QAAQ,YAAY,IAAI;AAC3C,gBAAQ,cAAc,QAAQ,eAAe;AAC7C,gBAAQ,UAAU,QAAQ,WAAW;AAErC,aAAK,kBAAgB,aAAQ,uBAAR,mBAA4B,iBAAgB;AACjE,aAAK,sBAAoB,aAAQ,uBAAR,mBAA4B,qBAAoB;AACzE,aAAK,qBAAqB,QAAQ,sBAAsB;AACxD,aAAK,0BAA0B,QAAQ,2BAA2B;AAClE,aAAK,0BAA0B,CAAC,CAAC,QAAQ;AACzC,aAAK,mBAAmB,QAAQ,UAAU,OAAO;AAGjD,6BAAqB,sBAAsB,QAAQ,sBAAsB;AAEzE,cAAM,mBAAmB,oBAAmB,IAAK,OAAO,oBAAoB,IAAM;AAElF,cAAM,mBAAmB,QAAQ,oBAAoB;AACrD,aAAK,wBAAwB,qBAAqB,IAAM,KAAK,IAAI,kBAAkB,gBAAgB,IAAI;AACvG,aAAK,wBAAwB;AAE7B,YAAI,CAAC,iBAAiB;AAClB;;AAGJ,YAAK,gBAAwB,YAAY;AACrC,mBAA4B;AAC5B,eAAK,mBAAmB;AAExB,cAAI,QAAQ,0BAA0B,QAAW;AAC7C,oBAAQ,wBAAwB;;AAGpC,cAAI,QAAQ,iBAAiB,QAAW;AACpC,oBAAQ,eAAe;;AAI3B,cAAI,aAAa,UAAU,WAAW;AAClC,iBAAK,mBAAkB;AAEvB,kBAAM,KAAK,UAAU;AACrB,uBAAW,aAAa,YAAW,eAAe;AAC9C,oBAAM,MAAM,UAAU;AACtB,oBAAM,UAAU,UAAU;AAC1B,oBAAM,QAAQ,IAAI,OAAO,GAAG;AAE5B,kBAAI,MAAM,KAAK,EAAE,GAAG;AAChB,oBAAI,UAAU,WAAW,UAAU,mBAAmB;AAClD,wBAAM,UAAU,UAAU;AAC1B,wBAAM,aAAa,UAAU;AAE7B,wBAAM,QAAQ,IAAI,OAAO,OAAO;AAChC,wBAAM,UAAU,MAAM,KAAK,EAAE;AAE7B,sBAAI,WAAW,QAAQ,SAAS,GAAG;AAC/B,0BAAM,gBAAgB,SAAS,QAAQ,QAAQ,SAAS,CAAC,CAAC;AAC1D,wBAAI,iBAAiB,YAAY;AAC7B;;;;AAKZ,2BAAW,UAAU,SAAS;AAC1B,0BAAQ,QAAQ;oBACZ,KAAK;AACD,2BAAK,wBAAwB;AAC7B;oBACJ,KAAK;AACD,2BAAK,4BAA4B;AACjC;oBACJ,KAAK;AACD,8BAAQ,YAAY;AACpB;oBACJ,KAAK;AACD,2BAAK,0BAA0B;AAC/B;;;;;;AAQxB,cAAI,CAAC,KAAK,yBAAyB;AAC/B,iBAAK,iBAAiB,CAAC,QAAc;AACjC,kBAAI,eAAc;AAClB,mBAAK,kBAAkB;AACvB,qBAAO,KAAK,qBAAqB;AAEjC,mBAAK,wBAAwB,gBAAgB,IAAI;YACrD;AAEA,iBAAK,qBAAqB,MAAK;AAC3B,mBAAK,+BAA+B,MAAM,KAAK,eAAc,CAAE;YACnE;AAEA,mBAAO,iBAAiB,oBAAoB,KAAK,gBAAgB,KAAK;AACtE,mBAAO,iBAAiB,wBAAwB,KAAK,oBAAoB,KAAK;AAE9E,oBAAQ,kBAAkB,QAAQ,mBAAmB;;AAIzD,eAAK,gBAAgB,iCAAiC,KAAK,UAAU,SAAS;AAC9E,cAAI,KAAK,eAAe;AACpB,oBAAQ,eAAe;;AAI3B,cAAI,CAAC,QAAQ,sBAAsB;AAC/B,gBAAI;AACA,mBAAK,MAAY,OAAO,WAAW,UAAU,OAAO,KAAK,OAAO,WAAW,uBAAuB,OAAO;AACzG,kBAAI,KAAK,KAAK;AACV,qBAAK,gBAAgB;AACrB,qBAAK,sBAAsB;AAG3B,oBAAI,CAAC,KAAK,IAAI,aAAa;AACvB,uBAAK,gBAAgB;AACrB,uBAAK,sBAAsB;;;qBAG9B,GAAG;;;AAKhB,cAAI,CAAC,KAAK,KAAK;AACX,gBAAI,CAAC,QAAQ;AACT,oBAAM,IAAI,MAAM,2CAA2C;;AAE/D,gBAAI;AACA,mBAAK,MAA+B,OAAO,WAAW,SAAS,OAAO,KAAK,OAAO,WAAW,sBAAsB,OAAO;qBACrH,GAAG;AACR,oBAAM,IAAI,MAAM,qBAAqB;;;AAI7C,cAAI,CAAC,KAAK,KAAK;AACX,kBAAM,IAAI,MAAM,qBAAqB;;eAEtC;AACH,eAAK,MAA8B;AACnC,eAAK,mBAAmB,KAAK,IAAI;AAEjC,cAAK,KAAK,IAAY,gCAAgC;AAClD,iBAAK,gBAAgB;AACrB,iBAAK,sBAAsB;iBACxB;AACH,iBAAK,sBAAsB;;AAG/B,gBAAM,aAAa,KAAK,IAAI,qBAAoB;AAChD,cAAI,YAAY;AACZ,oBAAQ,UAAU,WAAW;;;AAKrC,aAAK,IAAI,YAAY,KAAK,IAAI,oCAAoC,KAAK,IAAI,IAAI;AAE/E,YAAI,QAAQ,2BAA2B,QAAW;AAC9C,eAAK,+BAA+B,QAAQ;;AAGhD,aAAK,OAAM;AAEX,aAAK,eAAc;AACnB,aAAK,cAAa;AAGlB,iBAAS,IAAI,GAAG,IAAI,KAAK,MAAM,kBAAkB,KAAK;AAClD,eAAK,uBAAuB,CAAC,IAAI,IAAI,cAAa;;AAItD,aAAK,mBAAmB,KAAK,eAAe,IAAI,IAAI,sBAAqB,IAAK,IAAI,qBAAoB;AAGtG,aAAK,SAAS,QAAQ,KAAK,UAAU,SAAS,KAAK,UAAU,KAAK,UAAU,SAAS;AAWrF,cAAM,eAAe,eAAe,YAAW,OAAO;AACtD,eAAO,IAAI,eAAe,MAAM,KAAK,WAAW,EAAE;AAGlD,YAAI,KAAK,oBAAoB,KAAK,iBAAiB,cAAc;AAC7D,eAAK,iBAAiB,aAAa,eAAe,YAAY;;MAEtE;MAEU,qBAAkB;AACxB,YAAI,EAAE,aAAa,UAAU,YAAY;AACrC;;AAIJ,aAAK,kBAAkB,MAAK;AACxB,gBAAM,YAAY,UAAU;AAC5B,eAAK,gBAAgB,WACjB,UAAU,QAAQ,QAAQ,MAAM;UAE/B,UAAU,QAAQ,KAAK,MAAM,MAAM,oBAAmB,KAAM,gBAAgB;QACrF;AAGA,aAAK,gBAAe;AAGpB,YAAI,oBAAmB,GAAI;AACvB,iBAAO,iBAAiB,UAAU,KAAK,eAAe;;MAE9D;MAEU,uBAAoB;AAC1B,aAAK,oBAAoB;AACzB,aAAK,gBAAgB;AACrB,aAAK,oBAAoB;AACzB,aAAK,kBAAkB;AACvB,aAAK,uBAAuB;MAChC;MAEU,4BAAyB;AAxhCvC;AA0hCQ,aAAK,WAAW,IAAI;AAGpB,aAAK,gBAAe;AACpB,mBAAK,2BAAL;AAOA,aAAK,gBAAe;AAEpB,aAAK,yBAAwB;AAE7B,aAAK,iBAAgB;AAErB,aAAK,6BAA4B;AAGjC,aAAK,WAAW,IAAI;MACxB;MAEU,uBAAoB;AAC1B,eAAO,KAAK,KAAK,OAAO,iCAAiC;AACzD,aAAK,4BAA4B,gBAAgB,IAAI;AACrD,aAAK,kBAAkB;MAC3B;MAEU,+BAA+B,YAAsB;AAE3D,mBAAW,YAAW;AAClB,eAAK,qBAAoB;AAEzB,gBAAM,YAAY,KAAK,mBAAmB;AAC1C,gBAAM,YAAY,KAAK,mBAAmB;AAC1C,gBAAM,YAAY,KAAK,mBAAmB;AAC1C,gBAAM,cAAc,KAAK,cAAc;AAGvC,gBAAM,WAAU;AAChB,eAAK,0BAAyB;AAE9B,eAAK,mBAAmB,YAAY;AACpC,eAAK,mBAAmB,YAAY;AACpC,eAAK,mBAAmB,YAAY;AACpC,eAAK,cAAc,cAAc;AAEjC,eAAK,qBAAoB;QAC7B,GAAG,CAAC;MACR;;;;;MAMU,YAAY,QAAyB;AAC3C,aAAK,mBAAmB;MAC5B;;;;MAKO,4BAA4B,gBAA8B;AAC7D,eAAO;MACX;MAEQ,2BAAwB;AAC5B,cAAM,eAAe,KAAK,uBAAuB,MAAK;AAEtD,mBAAW,mBAAmB,cAAc;AACxC,0BAAgB,SAAQ;;MAEhC;MAEQ,+BAA4B;AAChC,cAAM,eAAe,KAAK,0BAA0B,MAAK;AAEzD,mBAAW,uBAAuB,cAAc;AAC5C,8BAAoB,SAAQ;;MAEpC;MAEQ,kBAAe;AACnB,mBAAW,OAAO,KAAK,kBAAkB;AACrC,gBAAM,SAAiB,KAAK,iBAAiB,GAAG;AAEhD,iBAAO,mBAAmB;AAC1B,iBAAO,eAAc;;AAGzB,eAAO,WAAU;MACrB;;;;;MAMO,qBAAkB;AACrB,mBAAW,OAAO,KAAK,kBAAkB;AACrC,gBAAM,SAAiB,KAAK,iBAAiB,GAAG;AAEhD,cAAI,CAAC,OAAO,QAAO,GAAI;AACnB,mBAAO;;;AAIf,eAAO;MACX;MAEU,kBAAe;AAErB,mBAAW,iBAAiB,KAAK,iBAAiB;AAC9C,wBAAc,yBAAwB;;MAE9C;MAEU,mBAAgB;MAAU;MAE1B,iBAAc;AAEpB,aAAK,QAAQ;UACT,uBAAuB,KAAK,IAAI,aAAa,KAAK,IAAI,uBAAuB;UAC7E,+BAA+B,KAAK,IAAI,aAAa,KAAK,IAAI,gCAAgC;UAC9F,4BAA4B,KAAK,IAAI,aAAa,KAAK,IAAI,8BAA8B;UACzF,gBAAgB,KAAK,IAAI,aAAa,KAAK,IAAI,gBAAgB;UAC/D,YAAY,KAAK,gBAAgB,IAAI,KAAK,IAAI,aAAa,KAAK,IAAI,WAAW,IAAI;UACnF,uBAAuB,KAAK,IAAI,aAAa,KAAK,IAAI,yBAAyB;UAC/E,sBAAsB,KAAK,IAAI,aAAa,KAAK,IAAI,qBAAqB;UAC1E,kBAAkB,KAAK,IAAI,aAAa,KAAK,IAAI,kBAAkB;UACnE,mBAAmB,KAAK,IAAI,aAAa,KAAK,IAAI,mBAAmB;UACrE,2BAA2B,KAAK,IAAI,aAAa,KAAK,IAAI,4BAA4B;UACtF,yBAAyB,KAAK,IAAI,aAAa,KAAK,IAAI,0BAA0B;UAClF,uBAAuB,KAAK,IAAI,aAAa,6BAA6B,KAAK;UAC/E,qBAAqB,KAAK,gBAAgB,KAAK,KAAK,IAAI,aAAa,0BAA0B,MAAM;UACrG,eAAe;UACf,MAAM,KAAK,IAAI,aAAa,+BAA+B,KAAK,KAAK,IAAI,aAAa,sCAAsC;UAC5H,MAAM,KAAK,IAAI,aAAa,8BAA8B,KAAK,KAAK,IAAI,aAAa,qCAAqC;UAC1H,MAAM,KAAK,IAAI,aAAa,+BAA+B,KAAK,KAAK,IAAI,aAAa,sCAAsC;;UAE5H,WAAW,KAAK,IAAI,aAAa,oCAAoC,KAAK,KAAK,IAAI,aAAa,2CAA2C;UAC3I,OAAO,KAAK,IAAI,aAAa,gCAAgC,KAAK,KAAK,IAAI,aAAa,uCAAuC;UAC/H,MAAM,KAAK,IAAI,aAAa,+BAA+B,KAAK,KAAK,IAAI,aAAa,sCAAsC;UAC5H,MACI,KAAK,IAAI,aAAa,8BAA8B,KACpD,KAAK,IAAI,aAAa,qCAAqC,KAC3D,KAAK,IAAI,aAAa,gCAAgC;UAC1D,mCACI,KAAK,IAAI,aAAa,gCAAgC,KACtD,KAAK,IAAI,aAAa,uCAAuC,KAC7D,KAAK,IAAI,aAAa,oCAAoC;UAC9D,aAAa,KAAK,gBAAgB,KAAK,KAAK,IAAI,aAAa,wBAAwB,MAAM;UAC3F,wBAAwB,KAAK,gBAAgB,KAAK,KAAK,IAAI,aAAa,gBAAgB,MAAM;UAC9F,8BAA8B;UAC9B,YAAY,KAAK,IAAI,aAAa,iCAAiC,KAAK,KAAK,IAAI,aAAa,0BAA0B;UACxH,uBAAuB,KAAK,gBAAgB;UAC5C,8BAA8B;UAC9B,sBAAsB;UACtB,gBAAgB;UAChB,kBAAkB,CAAC,EAAE,KAAK,gBAAgB,KAAK,KAAK,IAAI,aAAa,wBAAwB;UAC7F,6BAA6B;UAC7B,0BAA0B;UAC1B,sBAAsB,CAAC,EAAE,KAAK,gBAAgB,KAAK,KAAK,IAAI,aAAa,6BAA6B;UACtG,cAAc,KAAK,gBAAgB,KAAK,KAAK,IAAI,aAAa,mBAAmB,IAAI,OAAO;UAC5F,kBAAkB,KAAK,gBAAgB,KAAK,KAAK,IAAI,aAAa,wBAAwB,IAAI,OAAO;UACrG,wBAAwB;UACxB,6BAA6B;UAC7B,oBAAoB;UACpB,iCAAiC;UACjC,mBAAmB;UACnB,iBAAiB;UACjB,YAAY,KAAK,gBAAgB,KAAK,KAAK,IAAI,aAAa,wBAAwB,IAAI,OAAO;UAC/F,YAAY,KAAK,kBAAkB;UACnC,aAAa;UACb,WAAW,KAAK,IAAI,aAAa,gBAAgB;UACjD,iBAAiB,KAAK,IAAI,aAAa,kBAAkB;UACzD,uBAAuB;UACvB,oBAAoB,KAAK,gBAAgB;UACzC,kBAAkB,KAAK,gBAAgB;UACvC,uBAAuB;UACvB,oBAAoB;UACpB,2BAA2B,KAAK,gBAAgB;UAChD,iBAAiB,KAAK,gBAAgB;UACtC,6BAA6B,KAAK,gBAAgB,IAAI,KAAK,IAAI,aAAa,KAAK,IAAI,wBAAwB,IAAI;UACjH,2BAA2B;;AAG/B,aAAK,MAAM,8BAA8B,KAAK,MAAM;AACpD,aAAK,MAAM,2BAA2B,KAAK,MAAM;AAGjD,aAAK,aAAa,KAAK,IAAI,aAAa,KAAK,IAAI,OAAO;AAExD,cAAM,eAAoB,KAAK,IAAI,aAAa,2BAA2B;AAC3E,YAAI,gBAAgB,MAAM;AACtB,eAAK,cAAc,KAAK,IAAI,aAAa,aAAa,uBAAuB;AAC7E,eAAK,YAAY,KAAK,IAAI,aAAa,aAAa,qBAAqB;;AAG7E,YAAI,CAAC,KAAK,WAAW;AACjB,eAAK,YAAY,KAAK,IAAI,aAAa,KAAK,IAAI,MAAM,KAAK;;AAG/D,YAAI,CAAC,KAAK,aAAa;AACnB,eAAK,cAAc,KAAK,IAAI,aAAa,KAAK,IAAI,QAAQ,KAAK;;AAInE,YAAI,KAAK,IAAI,mBAAmB,OAAQ;AACpC,eAAK,IAAI,iBAAiB;;AAE9B,YAAI,KAAK,IAAI,YAAY,OAAQ;AAC7B,eAAK,IAAI,UAAU;;AAEvB,YAAI,KAAK,IAAI,YAAY,OAAQ;AAC7B,eAAK,IAAI,UAAU;;AAEvB,YAAI,KAAK,IAAI,qBAAqB,OAAO;AACrC,eAAK,IAAI,mBAAmB;;AAIhC,YAAI,KAAK,MAAM,YAAY;AACvB,cAAI,KAAK,kBAAkB,GAAG;AAC1B,iBAAK,IAAI,WAAiB,KAAK,MAAM,WAAY,YAAY,KAAK,KAAK,MAAM,UAAU;;AAG3F,eAAK,MAAM,gCAAiC,KAAK,IAAI,SAAS,KAAK,MAAM,WAAW,eAAe,KAAK,MAAM,WAAW,sBAAsB,KAAgB,KAAK;;AAGxK,aAAK,MAAM,gBAAgB,KAAK,MAAM,oCAChC,KAAK,IAAI,aAAa,KAAK,MAAM,kCAAkC,8BAA8B,IACjG;AACN,aAAK,MAAM,8BAA8B,KAAK,MAAM,gBAAgB,KAAK,IAAI,aAAa,0BAA0B,IAAI,OAAO;AAC/H,aAAK,MAAM,qBAAqB,KAAK,MAAM,gBAAgB,KAAK,6BAA4B,IAAK,OAAO;AACxG,aAAK,MAAM,kCACP,KAAK,gBAAgB,KAAM,KAAK,MAAM,oBAAoB,KAAK,IAAI,aAAa,+BAA+B,IAAK,OAAO;AAG/H,YAAI,KAAK,MAAM,MAAM;AACjB,eAAK,IAAI,uCAAuC,KAAK,MAAM,KAAK;;AAEpE,YAAI,KAAK,MAAM,MAAM;AACjB,eAAK,IAAI,uCAAuC,KAAK,MAAM,KAAK;;AAEpE,YAAI,KAAK,MAAM,WAAW;AACtB,eAAK,IAAI,gCAAgC,KAAK,MAAM,UAAU;AAC9D,eAAK,IAAI,sCAAsC,KAAK,MAAM,UAAU;AACpE,eAAK,IAAI,sCAAsC,KAAK,MAAM,UAAU;;AAExE,YAAI,KAAK,MAAM,MAAM;AACjB,eAAK,IAAI,wBAAwB,KAAK,MAAM,KAAK;AACjD,eAAK,IAAI,mCAAmC,KAAK,MAAM,KAAK;;AAIhE,YAAI,KAAK,gBAAgB,GAAG;AACxB,cAAI,KAAK,IAAI,mBAAmB,MAAQ;AACpC,iBAAK,IAAI,iBAAiB;;;AAGlC,aAAK,MAAM,yBAAyB,KAAK,MAAM,oBAAoB,KAAK,iCAAgC;AAExG,YAAI,KAAK,gBAAgB,GAAG;AACxB,eAAK,MAAM,uBAAuB;AAClC,eAAK,MAAM,iBAAiB,KAAK,4BAA4B,OAAO,KAAK,0BAA0B,KAAK,IAAI,aAAa,KAAK,IAAI,WAAW;eAC1I;AACH,gBAAM,uBAAuB,KAAK,IAAI,aAAa,oBAAoB;AAEvE,cAAI,yBAAyB,MAAM;AAC/B,iBAAK,MAAM,uBAAuB;AAClC,iBAAK,IAAI,cAAc,qBAAqB,iBAAiB,KAAK,oBAAoB;AACrF,iBAAK,IAAI,mBAA2B,KAAK,IAAI;AAE9C,qBAAS,IAAI,GAAG,IAAI,IAAI,KAAK;AACnB,mBAAK,IAAK,qBAAqB,IAAI,QAAQ,IAAU,qBAAsB,qBAAqB,IAAI,QAAQ;;;;AAM9H,YAAI,KAAK,gBAAgB,GAAG;AACxB,eAAK,MAAM,wBAAwB;eAChC;AACH,gBAAM,wBAAwB,KAAK,IAAI,aAAa,qBAAqB;AAEzE,cAAI,yBAAyB,MAAM;AAC/B,iBAAK,MAAM,wBAAwB;AACnC,iBAAK,IAAI,oBAAoB,sBAAsB;;;AAK3D,YAAI,KAAK,2BAA2B;AAChC,eAAK,MAAM,oBAAoB;mBACxB,KAAK,gBAAgB,GAAG;AAC/B,eAAK,MAAM,oBAAoB;eAC5B;AACH,gBAAM,6BAA6B,KAAK,IAAI,aAAa,yBAAyB;AAElF,cAAI,8BAA8B,MAAM;AACpC,iBAAK,MAAM,oBAAoB;AAC/B,iBAAK,IAAI,oBAAoB,2BAA2B,qBAAqB,KAAK,0BAA0B;AAC5G,iBAAK,IAAI,kBAAkB,2BAA2B,mBAAmB,KAAK,0BAA0B;AACxG,iBAAK,IAAI,oBAAoB,2BAA2B,qBAAqB,KAAK,0BAA0B;;;AAKpH,YAAI,KAAK,gBAAgB,GAAG;AACxB,eAAK,MAAM,kBAAkB;eAC1B;AACH,gBAAM,oBAA4C,KAAK,IAAI,aAAa,wBAAwB;AAEhG,cAAI,qBAAqB,MAAM;AAC3B,iBAAK,MAAM,kBAAkB;AAC7B,iBAAK,IAAI,sBAAsB,kBAAkB,yBAAyB,KAAK,iBAAiB;AAChG,iBAAK,IAAI,wBAAwB,kBAAkB,2BAA2B,KAAK,iBAAiB;AACpG,iBAAK,IAAI,sBAAsB,kBAAkB,yBAAyB,KAAK,iBAAiB;iBAC7F;AACH,iBAAK,MAAM,kBAAkB;;;AAIrC,YAAI,KAAK,IAAI,0BAA0B;AACnC,gBAAM,cAAc,KAAK,IAAI,yBAAyB,KAAK,IAAI,eAAe,KAAK,IAAI,UAAU;AACjG,gBAAM,gBAAgB,KAAK,IAAI,yBAAyB,KAAK,IAAI,iBAAiB,KAAK,IAAI,UAAU;AAErG,cAAI,eAAe,eAAe;AAC9B,iBAAK,MAAM,+BAA+B,YAAY,cAAc,KAAK,cAAc,cAAc;;;AAI7G,YAAI,KAAK,gBAAgB,GAAG;AACxB,eAAK,MAAM,cAAc;eACtB;AACH,gBAAM,uBAAuB,KAAK,IAAI,aAAa,kBAAkB;AACrE,cAAI,wBAAwB,MAAM;AAC9B,iBAAK,MAAM,cAAc;AACzB,iBAAK,IAAI,MAAM,qBAAqB;AACpC,iBAAK,IAAI,MAAM,qBAAqB;;;AAM5C,YAAI,CAAC,KAAK,MAAM,oBAAoB;AAChC,cAAI,KAAK,gBAAgB,GAAG;AACxB,iBAAK,MAAM,qBAAqB;AAChC,iBAAK,yBAAyB;cAC1B,MAAM,uBAAuB;cAC7B,OAAO,uBAAuB;cAC9B,cAAc,uBAAuB;;iBAEtC;AACH,kBAAM,gBAAgB,KAAK,IAAI,aAAa,UAAU;AAEtD,gBAAI,iBAAiB,MAAM;AACvB,mBAAK,MAAM,qBAAqB;AAChC,mBAAK,yBAAyB;gBAC1B,MAAM,cAAc;gBACpB,OAAO,cAAc;gBACrB,cAAc,cAAc;;;;AAMxC,eAAK,MAAM,qBAAqB,KAAK,MAAM,sBAAsB,CAAC,EAAE,KAAK,oBAAoB,KAAK,iBAAiB;;AAIvH,aAAK,mBAAmB,YAAY;AACpC,aAAK,mBAAmB,YAAY,KAAK,IAAI;AAC7C,aAAK,mBAAmB,YAAY;AAGpC,aAAK,2BAA2B,KAAK,MAAM;AAC3C,iBAAS,OAAO,GAAG,OAAO,KAAK,0BAA0B,QAAQ;AAC7D,eAAK,sBAAsB,KAAK,IAAI;;AAGxC,YAAI,KAAK,gBAAgB,YAAY;AAEjC,eAAK,MAAM,4BAA4B;;MAE/C;MAEU,gBAAa;AACnB,aAAK,YAAY;UACb,iCAAiC,OAAO,qBAAqB;UAC7D,2CAA2C,KAAK,kBAAkB;UAClE,4BAA4B,KAAK,kBAAkB;UACnD,uBAAuB,KAAK,kBAAkB;UAC9C,8BAA8B;UAC9B,0BAA0B,KAAK,kBAAkB;UACjD,kBAAkB;UAClB,8BAA8B;UAC9B,YAAY,KAAK,kBAAkB;UACnC,eAAe,KAAK,kBAAkB;UACtC,mBAAmB,KAAK,kBAAkB;UAC1C,iCAAiC,KAAK,kBAAkB;UACxD,aAAa,KAAK,kBAAkB;UACpC,cAAc,KAAK,kBAAkB;UACrC,+BAA+B,KAAK,kBAAkB;UACtD,2BAA2B,KAAK,kBAAkB;UAClD,wBAAwB;UACxB,sBAAsB;UACtB,oBAAoB;UACpB,wBAAwB;UACxB,gCAAgC;UAChC,qBAAqB;UACrB,yBAAyB;UACzB,gDAAgD;UAChD,4BAA4B;;MAEpC;;;;;MAMA,IAAW,eAAY;AACnB,eAAO,KAAK;MAChB;;;;;MAMO,eAAY;AACf,eAAO;MACX;;;;MAKA,IAAW,kBAAe;AACtB,eAAO,KAAK;MAChB;;MAGO,wBAAqB;AACxB,YAAI,KAAK,gBAAgB;AACrB;;AAGJ,aAAK,iBAAiB,KAAK,aAAa,GAAG,CAAC;AAC5C,cAAM,UAAU,KAAK,eAAe,WAAW,IAAI;AAEnD,YAAI,SAAS;AACT,eAAK,kBAAkB;;MAE/B;;;;MAKO,oBAAiB;AACpB,mBAAW,OAAO,KAAK,qBAAqB;AACxC,cAAI,CAAC,OAAO,UAAU,eAAe,KAAK,KAAK,qBAAqB,GAAG,GAAG;AACtE;;AAEJ,eAAK,oBAAoB,GAAG,IAAI;;AAGpC,aAAK,yBAAyB;MAClC;;;;;MAMO,UAAO;AACV,eAAO,KAAK,UAAS;MACzB;;;;;MAMO,YAAS;AACZ,eAAO;UACH,QAAQ,KAAK;UACb,UAAU,KAAK;UACf,SAAS,KAAK;;MAEtB;;;;;;;MAQO,wBAAwB,OAAa;AACxC,aAAK,wBAAwB;AAC7B,aAAK,OAAM;MACf;;;;;;;MAQO,0BAAuB;AAC1B,eAAO,KAAK;MAChB;;;;;MAMO,yBAAsB;AACzB,eAAO,KAAK;MAChB;;;;;MAMO,UAAO;AACV,eAAO,KAAK;MAChB;;;;;MAMO,eAAe,gBAA2B;AAC7C,YAAI,CAAC,gBAAgB;AACjB,eAAK,mBAAmB,SAAS;AACjC,eAAK,aAAY;AACjB;;AAGJ,cAAM,QAAQ,KAAK,mBAAmB,QAAQ,cAAc;AAE5D,YAAI,SAAS,GAAG;AACZ,eAAK,mBAAmB,OAAO,OAAO,CAAC;AACvC,cAAI,KAAK,mBAAmB,UAAU,GAAG;AACrC,iBAAK,aAAY;;;MAG7B;MAEU,eAAY;AAClB,YAAI,KAAK,kBAAkB,GAAG;AAC1B,gBAAM,kBAAkB,KAAK;AAC7B,eAAK,gBAAgB;AAErB,cAAI,CAAC,oBAAmB,GAAI;AACxB,gBAAI,OAAO,yBAAyB,YAAY;AAC5C,qBAAO,qBAAqB,eAAe;;iBAE5C;AACH,kBAAM,EAAE,sBAAAC,sBAAoB,IAAK,KAAK,cAAa,KAAM;AACzD,gBAAI,OAAOA,0BAAyB,YAAY;AAC5C,qBAAOA,sBAAqB,eAAe;;;AAGnD,iBAAO,aAAa,eAAe;;MAE3C;;MAGO,cAAW;AACd,aAAK,gBAAgB;AAErB,YAAI,CAAC,KAAK,iBAAiB;AACvB,cAAI,eAAe;AACnB,cAAI,KAAK,eAAgB,CAAC,KAAK,0BAA0B,KAAK,qBAAsB;AAChF,2BAAe;;AAGnB,cAAI,cAAc;AAEd,iBAAK,WAAU;AAEf,qBAAS,QAAQ,GAAG,QAAQ,KAAK,mBAAmB,QAAQ,SAAS;AACjE,oBAAM,iBAAiB,KAAK,mBAAmB,KAAK;AAEpD,6BAAc;;AAIlB,iBAAK,SAAQ;;;AAIrB,YAAI,KAAK,kBAAkB,GAAG;AAC1B,eAAK,gBAAgB,KAAK,eAAe,KAAK,sBAAsB,KAAK,cAAa,CAAE;;MAEhG;;;;;MAMO,qBAAkB;AACrB,eAAO,KAAK;MAChB;;;;;MAMO,kBAAe;AAClB,eAAO,KAAK;MAChB;;;;;MAMO,sBAAmB;AACtB,eAAO,KAAK;MAChB;;;;;MAMO,gBAAa;AAChB,YAAI,CAAC,oBAAmB,GAAI;AACxB,iBAAO;;AAGX,YAAI,KAAK,oBAAoB,KAAK,iBAAiB,iBAAiB,KAAK,iBAAiB,cAAc,aAAa;AACjH,iBAAO,KAAK,iBAAiB,cAAc;;AAG/C,eAAO;MACX;;;;;;MAOO,eAAe,YAAY,OAAK;AACnC,YAAI,CAAC,aAAa,KAAK,sBAAsB;AACzC,iBAAO,KAAK,qBAAqB;;AAGrC,eAAO,KAAK,+BAA+B,KAAK,6BAA6B,mBAAmB,KAAK,IAAI;MAC7G;;;;;;MAOO,gBAAgB,YAAY,OAAK;AACpC,YAAI,CAAC,aAAa,KAAK,sBAAsB;AACzC,iBAAO,KAAK,qBAAqB;;AAGrC,eAAO,KAAK,+BAA+B,KAAK,6BAA6B,oBAAoB,KAAK,IAAI;MAC9G;;;;;MAMU,eAAe,sBAA2B,WAAe;AAC/D,eAAO,YAAW,cAAc,sBAAsB,SAAS;MACnE;;;;;MAMO,cAAc,gBAA0B;AAC3C,YAAI,KAAK,mBAAmB,QAAQ,cAAc,MAAM,IAAI;AACxD;;AAGJ,aAAK,mBAAmB,KAAK,cAAc;AAG3C,YAAI,KAAK,mBAAmB,WAAW,KAAK,KAAK,kBAAkB,GAAG;AAClE,eAAK,gBAAgB,KAAK,eAAe,KAAK,sBAAsB,KAAK,cAAa,CAAE;;MAEhG;;;;;;;;MASO,MAAM,OAA8B,YAAqB,OAAgB,UAAmB,OAAK;AAhtD5G;AAitDQ,cAAM,uBAAuB,KAAK,qBAAqB;AACvD,aAAK,qBAAqB,uBAAuB;AAEjD,aAAK,YAAW;AAEhB,aAAK,qBAAqB,uBAAuB;AAEjD,YAAI,OAAO;AACX,YAAI,cAAc,OAAO;AACrB,cAAI,qBAAqB;AACzB,cAAI,KAAK,sBAAsB;AAC3B,kBAAM,iBAAgB,UAAK,qBAAqB,YAA1B,mBAAmC;AACzD,gBACI,kBAAkB,KAClB,kBAAkB,KAClB,kBAAkB,MAClB,kBAAkB,IAAA;AAElB,oBAAM,eAAc,UAAK,qBAAqB,YAA1B,mBAAmC;AACvD,kBAAI,gBAAgB,KAAA,gBAAU,GAAA;AAC1B,4BAAW,sBAAsB,CAAC,IAAI,MAAM,IAAI;AAChD,4BAAW,sBAAsB,CAAC,IAAI,MAAM,IAAI;AAChD,4BAAW,sBAAsB,CAAC,IAAI,MAAM,IAAI;AAChD,4BAAW,sBAAsB,CAAC,IAAI,MAAM,IAAI;AAChD,qBAAK,IAAI,eAAe,KAAK,IAAI,OAAO,GAAG,YAAW,qBAAqB;AAC3E,qCAAqB;qBAClB;AACH,4BAAW,qBAAqB,CAAC,IAAI,MAAM,IAAI;AAC/C,4BAAW,qBAAqB,CAAC,IAAI,MAAM,IAAI;AAC/C,4BAAW,qBAAqB,CAAC,IAAI,MAAM,IAAI;AAC/C,4BAAW,qBAAqB,CAAC,IAAI,MAAM,IAAI;AAC/C,qBAAK,IAAI,cAAc,KAAK,IAAI,OAAO,GAAG,YAAW,oBAAoB;AACzE,qCAAqB;;;;AAKjC,cAAI,oBAAoB;AACpB,iBAAK,IAAI,WAAW,MAAM,GAAG,MAAM,GAAG,MAAM,GAAG,MAAM,MAAM,SAAY,MAAM,IAAI,CAAG;AACpF,oBAAQ,KAAK,IAAI;;;AAIzB,YAAI,OAAO;AACP,cAAI,KAAK,uBAAuB;AAC5B,iBAAK,mBAAmB,YAAY,KAAK,IAAI;AAC7C,iBAAK,IAAI,WAAW,CAAG;iBACpB;AACH,iBAAK,IAAI,WAAW,CAAG;;AAE3B,kBAAQ,KAAK,IAAI;;AAErB,YAAI,SAAS;AACT,eAAK,IAAI,aAAa,CAAC;AACvB,kBAAQ,KAAK,IAAI;;AAErB,aAAK,IAAI,MAAM,IAAI;MACvB;;;;MAOO,UAAU,GAAW,GAAW,OAAe,QAAc;AAChE,YAAI,MAAM,KAAK,gBAAgB,KAAK,MAAM,KAAK,gBAAgB,KAAK,UAAU,KAAK,gBAAgB,KAAK,WAAW,KAAK,gBAAgB,GAAG;AACvI,eAAK,gBAAgB,IAAI;AACzB,eAAK,gBAAgB,IAAI;AACzB,eAAK,gBAAgB,IAAI;AACzB,eAAK,gBAAgB,IAAI;AAEzB,eAAK,IAAI,SAAS,GAAG,GAAG,OAAO,MAAM;;MAE7C;;;;;;;MAQO,YAAY,UAAyB,eAAwB,gBAAuB;AACvF,cAAM,QAAQ,iBAAiB,KAAK,eAAc;AAClD,cAAM,SAAS,kBAAkB,KAAK,gBAAe;AACrD,cAAM,IAAI,SAAS,KAAK;AACxB,cAAM,IAAI,SAAS,KAAK;AAExB,aAAK,kBAAkB;AAEvB,aAAK,UAAU,IAAI,OAAO,IAAI,QAAQ,QAAQ,SAAS,OAAO,SAAS,SAAS,MAAM;MAC1F;;;;MAKO,aAAU;MAAU;;;;MAKpB,WAAQ;AAEX,YAAI,KAAK,QAAQ;AACb,eAAK,iBAAgB;;AAEzB,aAAK;MACT;;;;;MAMO,OAAO,eAAe,OAAK;AAC9B,YAAI;AACJ,YAAI;AAGJ,YAAI,KAAK,oBAAoB;AACzB,gBAAM,mBAAmB,oBAAmB,IAAK,OAAO,oBAAoB,IAAM;AAClF,gBAAM,cAAc,KAAK,wBAAwB;AACjD,eAAK,wBAAwB;AAC7B,eAAK,yBAAyB;;AAGlC,YAAI,oBAAmB,KAAM,oBAAmB,GAAI;AAEhD,cAAI,KAAK,kBAAkB;AACvB,kBAAM,eAAe,KAAK,iBAAiB,wBACrC,KAAK,iBAAiB,sBAAqB,IAC3C;;cAEI,OAAO,KAAK,iBAAiB,QAAQ,KAAK;cAC1C,QAAQ,KAAK,iBAAiB,SAAS,KAAK;;AAEtD,oBAAQ,KAAK,iBAAiB,eAAe,aAAa,SAAS,KAAK,iBAAiB,SAAS;AAClG,qBAAS,KAAK,iBAAiB,gBAAgB,aAAa,UAAU,KAAK,iBAAiB,UAAU;iBACnG;AACH,oBAAQ,OAAO;AACf,qBAAS,OAAO;;eAEjB;AACH,kBAAQ,KAAK,mBAAmB,KAAK,iBAAiB,QAAQ;AAC9D,mBAAS,KAAK,mBAAmB,KAAK,iBAAiB,SAAS;;AAGpE,aAAK,QAAQ,QAAQ,KAAK,uBAAuB,SAAS,KAAK,uBAAuB,YAAY;MACtG;;;;;;;;MASO,QAAQ,OAAe,QAAgB,eAAe,OAAK;AAC9D,YAAI,CAAC,KAAK,kBAAkB;AACxB,iBAAO;;AAGX,gBAAQ,QAAQ;AAChB,iBAAS,SAAS;AAElB,YAAI,CAAC,gBAAgB,KAAK,iBAAiB,UAAU,SAAS,KAAK,iBAAiB,WAAW,QAAQ;AACnG,iBAAO;;AAGX,aAAK,iBAAiB,QAAQ;AAC9B,aAAK,iBAAiB,SAAS;AAE/B,eAAO;MACX;;;;;;;;;;;MAYO,gBACH,WACA,YAAoB,GACpB,eACA,gBACA,yBACA,WAAW,GACX,QAAQ,GAAC;AA/4DjB;AAi5DQ,cAAM,iBAAiB;AAEvB,YAAI,KAAK,sBAAsB;AAC3B,eAAK,kBAAkB,KAAK,oBAAoB;;AAEpD,aAAK,uBAAuB;AAC5B,aAAK,wBAAwB,eAAe,mBAAmB,eAAe,mBAAmB,eAAe,YAAY;AAE5H,cAAM,KAAK,KAAK;AAChB,YAAI,CAAC,UAAU,SAAS;AACpB,cAAI,UAAU,WAAW;AACrB,eAAG,wBAAwB,GAAG,aAAa,GAAG,oBAAmB,eAAU,QAAS,qBAAnB,mBAAqC,oBAAoB,UAAU,KAAK;qBAClI,UAAU,QAAQ;AACzB,eAAG,qBACC,GAAG,aACH,GAAG,mBACH,GAAG,8BAA8B,YACjC,eAAU,QAAS,qBAAnB,mBAAqC,oBACrC,QAAQ;qBAEL,eAAe,gBAAgB,UAAU;AAChD,eAAG,qBAAqB,GAAG,aAAa,GAAG,mBAAmB,GAAG,aAAY,eAAU,QAAS,qBAAnB,mBAAqC,oBAAoB,QAAQ;AAC9I,2BAAe,cAAc;;;AAIrC,cAAM,sBAAsB,UAAU;AACtC,YAAI,qBAAqB;AACrB,gBAAM,aAAa,UAAU,kCAAkC,GAAG,2BAA2B,GAAG;AAChG,cAAI,UAAU,WAAW;AACrB,eAAG,wBAAwB,GAAG,aAAa,aAAY,yBAAoB,qBAApB,mBAAsC,oBAAoB,UAAU,KAAK;qBACzH,UAAU,QAAQ;AACzB,eAAG,qBAAqB,GAAG,aAAa,YAAY,GAAG,8BAA8B,YAAW,yBAAoB,qBAApB,mBAAsC,oBAAoB,QAAQ;iBAC/J;AACH,eAAG,qBAAqB,GAAG,aAAa,YAAY,GAAG,aAAY,yBAAoB,qBAApB,mBAAsC,oBAAoB,QAAQ;;;AAI7I,YAAI,KAAK,mBAAmB,CAAC,yBAAyB;AAClD,eAAK,YAAY,KAAK,iBAAiB,eAAe,cAAc;eACjE;AACH,cAAI,CAAC,eAAe;AAChB,4BAAgB,UAAU;AAC1B,gBAAI,UAAU;AACV,8BAAgB,gBAAgB,KAAK,IAAI,GAAG,QAAQ;;;AAG5D,cAAI,CAAC,gBAAgB;AACjB,6BAAiB,UAAU;AAC3B,gBAAI,UAAU;AACV,+BAAiB,iBAAiB,KAAK,IAAI,GAAG,QAAQ;;;AAI9D,eAAK,UAAU,GAAG,GAAG,eAAe,cAAc;;AAGtD,aAAK,WAAU;MACnB;;;;;;;;;;;MAYO,SAAS,SAAkB,UAAkB,GAAG,OAAiB,cAAc,OAAO,eAAyB,SAAyB,eAAuB,GAAC;AAEnK,YAAI,KAAK,mBAAmB,SAAS,WAAW,OAAO;AACnD,eAAK,mBAAmB,OAAO;;AAInC,cAAM,WAAW,KAAK,iBAAiB,iBAAiB,OAAO,KAAK,IAAI,OAAO,KAAK,IAAI;AACxF,YAAI,KAAK,mBAAmB,aAAa,YAAY,OAAO;AACxD,eAAK,mBAAmB,WAAW;;AAIvC,aAAK,WAAW,OAAO;AACvB,aAAK,gBAAgB,YAAY;AAGjC,cAAM,YAAY,cAAc,KAAK,IAAI,KAAK,KAAK,IAAI;AACvD,YAAI,KAAK,mBAAmB,cAAc,aAAa,OAAO;AAC1D,eAAK,mBAAmB,YAAY;;AAGxC,aAAK,sBAAsB,kBAAkB;MACjD;;;;;MAMO,iBAAc;AACjB,eAAO,KAAK,mBAAmB;MACnC;;;;;MAMO,eAAe,QAAe;AACjC,aAAK,mBAAmB,YAAY;MACxC;;;;;MAMO,WAAW,OAAa;AAC3B,aAAK,mBAAmB,UAAU,KAAK,wBAAwB,CAAC,QAAQ;MAC5E;;;;;MAMO,aAAU;AACb,cAAM,UAAU,KAAK,mBAAmB;AACxC,eAAO,KAAK,wBAAwB,CAAC,UAAU;MACnD;;;;;MAMO,gBAAgB,OAAa;AAChC,aAAK,mBAAmB,eAAe,KAAK,wBAAwB,CAAC,QAAQ;MACjF;;;;;MAMO,kBAAe;AAClB,cAAM,eAAe,KAAK,mBAAmB;AAC7C,eAAO,KAAK,wBAAwB,CAAC,eAAe;MACxD;;;;MAKO,wBAAwB,aAAuC;AAClE,YAAI,KAAK,wBAAwB,aAAa;AAC1C,eAAK,IAAI,gBAAgB,KAAK,IAAI,aAAa,WAAW;AAC1D,eAAK,sBAAsB;;MAEnC;;MAGO,0CAAuC;AAC1C,eAAO,KAAK,wBAAwB;MACxC;;;;;MAMO,gBAAgB,SAAwB;AAC3C,aAAK,qBAAqB,KAAK,IAAI,YAAY,SAAS,IAAI;AAC5D,aAAK,IAAI,eAAe,KAAK,IAAI,UAAU;AAC3C,aAAK,qBAAqB,KAAK,IAAI,YAAY,IAAI;MACvD;;;;;;;MAQO,kBAAkB,SAA8B,yBAAyB,OAAO,gBAA2B;AAjkEtH;AAkkEQ,cAAM,iBAAiB;AAEvB,aAAK,uBAAuB;AAG5B,cAAM,KAAK,KAAK;AAChB,YAAI,eAAe,kBAAkB;AACjC,cAAI,QAAQ,SAAS;AAEjB,iBAAK,sCAAsC,SAAS,wBAAwB,cAAc;AAC1F;;AAEJ,aAAG,gBAAgB,GAAG,kBAAkB,eAAe,gBAAgB;AACvE,aAAG,gBAAgB,GAAG,kBAAkB,eAAe,YAAY;AACnE,aAAG,gBAAgB,GAAG,GAAG,QAAQ,OAAO,QAAQ,QAAQ,GAAG,GAAG,QAAQ,OAAO,QAAQ,QAAQ,GAAG,kBAAkB,GAAG,OAAO;;AAGhI,cAAI,aAAQ,YAAR,mBAAiB,oBAAmB,CAAC,0BAA0B,CAAC,QAAQ,QAAQ;AAChF,eAAK,gBAAgB,QAAQ,OAAO;;AAGxC,YAAI,gBAAgB;AAChB,cAAI,eAAe,kBAAkB;AAEjC,iBAAK,wBAAwB,eAAe,YAAY;;AAE5D,yBAAc;;AAGlB,aAAK,wBAAwB,IAAI;MACrC;;;;MAKO,mBAAgB;AACnB,aAAK,IAAI,MAAK;MAClB;;;;MAKO,4BAAyB;AAC5B,YAAI,KAAK,sBAAsB;AAC3B,eAAK,kBAAkB,KAAK,oBAAoB;eAC7C;AACH,eAAK,wBAAwB,IAAI;;AAErC,YAAI,KAAK,iBAAiB;AACtB,eAAK,YAAY,KAAK,eAAe;;AAGzC,aAAK,WAAU;MACnB;;;MAKU,4BAAyB;AAC/B,aAAK,gBAAgB,IAAI;AACzB,aAAK,uBAAuB;MAChC;;;;;;;;MASO,mBAAmB,MAA0B,YAAsB,QAAe;AACrF,eAAO,KAAK,oBAAoB,MAAM,KAAK,IAAI,WAAW;MAC9D;MAEQ,oBAAoB,MAA0B,OAAa;AAC/D,cAAM,MAAM,KAAK,IAAI,aAAY;AAEjC,YAAI,CAAC,KAAK;AACN,gBAAM,IAAI,MAAM,gCAAgC;;AAGpD,cAAM,aAAa,IAAI,gBAAgB,GAAG;AAC1C,aAAK,gBAAgB,UAAU;AAE/B,YAAI,OAAO,SAAS,UAAU;AAC1B,cAAI,gBAAgB,OAAO;AACvB,iBAAK,IAAI,WAAW,KAAK,IAAI,cAAc,IAAI,aAAa,IAAI,GAAG,KAAK;AACxE,uBAAW,WAAW,KAAK,SAAS;iBACjC;AACH,iBAAK,IAAI,WAAW,KAAK,IAAI,cAA2B,MAAM,KAAK;AACnE,uBAAW,WAAW,KAAK;;eAE5B;AACH,eAAK,IAAI,WAAW,KAAK,IAAI,cAAc,IAAI,WAAW,IAAI,GAAG,KAAK;AACtE,qBAAW,WAAW;;AAG1B,aAAK,0BAAyB;AAE9B,mBAAW,aAAa;AACxB,eAAO;MACX;;;;;;;MAQO,0BAA0B,MAA0B,QAAe;AACtE,eAAO,KAAK,oBAAoB,MAAM,KAAK,IAAI,YAAY;MAC/D;MAEU,2BAAwB;AAC9B,aAAK,gBAAgB,IAAI;AACzB,aAAK,qBAAqB;MAC9B;;;;;;;;MASO,kBAAkB,SAAuB,WAAqB,QAAe;AAChF,cAAM,MAAM,KAAK,IAAI,aAAY;AACjC,cAAM,aAAa,IAAI,gBAAgB,GAAI;AAE3C,YAAI,CAAC,KAAK;AACN,gBAAM,IAAI,MAAM,+BAA+B;;AAGnD,aAAK,gBAAgB,UAAU;AAE/B,cAAM,OAAO,KAAK,oBAAoB,OAAO;AAC7C,aAAK,IAAI,WAAW,KAAK,IAAI,sBAAsB,MAAM,YAAY,KAAK,IAAI,eAAe,KAAK,IAAI,WAAW;AACjH,aAAK,yBAAwB;AAC7B,mBAAW,aAAa;AACxB,mBAAW,WAAW,KAAK,sBAAsB;AACjD,eAAO;MACX;MAEU,oBAAoB,SAAqB;AAC/C,cAAM,kBAAmB,QAA4C;AACrE,YAAI,oBAAoB,GAAG;AACvB,iBAAO;;AAIX,YAAI,KAAK,MAAM,aAAa;AACxB,cAAI,mBAAmB,aAAa;AAChC,mBAAO;iBACJ;AAEH,qBAAS,QAAQ,GAAG,QAAQ,QAAQ,QAAQ,SAAS;AACjD,kBAAI,QAAQ,KAAK,KAAK,OAAO;AACzB,uBAAO,IAAI,YAAY,OAAO;;;AAItC,mBAAO,IAAI,YAAY,OAAO;;;AAKtC,eAAO,IAAI,YAAY,OAAO;MAClC;;;;;MAMO,gBAAgB,QAA4B;AAC/C,YAAI,CAAC,KAAK,sBAAsB;AAC5B,eAAK,yBAAwB;;AAEjC,aAAK,YAAY,QAAQ,KAAK,IAAI,YAAY;MAClD;;;;;;;MAQO,iBAAiB,iBAAmC,WAAmB,OAAa;AACvF,cAAM,UAAW,gBAAyC;AAE1D,cAAM,kBAAkB,KAAK,IAAI,qBAAqB,SAAS,SAAS;AAExE,aAAK,IAAI,oBAAoB,SAAS,iBAAiB,KAAK;MAChE;;MAGU,gBAAgB,QAA4B;AAClD,YAAI,CAAC,KAAK,sBAAsB;AAC5B,eAAK,yBAAwB;;AAEjC,aAAK,YAAY,QAAQ,KAAK,IAAI,oBAAoB;MAC1D;MAEQ,YAAY,QAA8B,QAAc;AAC5D,YAAI,KAAK,wBAAwB,KAAK,oBAAoB,MAAM,MAAM,QAAQ;AAC1E,eAAK,IAAI,WAAW,QAAQ,SAAS,OAAO,qBAAqB,IAAI;AACrE,eAAK,oBAAoB,MAAM,IAAI;;MAE3C;;;;;MAMO,kBAAkB,MAAkB;AACvC,aAAK,IAAI,cAAc,KAAK,IAAI,cAAc,GAAG,IAAI;MACzD;MAEQ,qBAAqB,QAAoB,MAAc,MAAc,MAAc,YAAqB,QAAgB,QAAc;AAC1I,cAAM,UAAU,KAAK,uBAAuB,IAAI;AAChD,YAAI,CAAC,SAAS;AACV;;AAGJ,YAAI,UAAU;AACd,YAAI,CAAC,QAAQ,QAAQ;AACjB,oBAAU;AACV,kBAAQ,SAAS;AACjB,kBAAQ,QAAQ;AAChB,kBAAQ,OAAO;AACf,kBAAQ,OAAO;AACf,kBAAQ,aAAa;AACrB,kBAAQ,SAAS;AACjB,kBAAQ,SAAS;AACjB,kBAAQ,SAAS;eACd;AACH,cAAI,QAAQ,WAAW,QAAQ;AAC3B,oBAAQ,SAAS;AACjB,sBAAU;;AAEd,cAAI,QAAQ,SAAS,MAAM;AACvB,oBAAQ,OAAO;AACf,sBAAU;;AAEd,cAAI,QAAQ,SAAS,MAAM;AACvB,oBAAQ,OAAO;AACf,sBAAU;;AAEd,cAAI,QAAQ,eAAe,YAAY;AACnC,oBAAQ,aAAa;AACrB,sBAAU;;AAEd,cAAI,QAAQ,WAAW,QAAQ;AAC3B,oBAAQ,SAAS;AACjB,sBAAU;;AAEd,cAAI,QAAQ,WAAW,QAAQ;AAC3B,oBAAQ,SAAS;AACjB,sBAAU;;;AAIlB,YAAI,WAAW,KAAK,sBAAsB;AACtC,eAAK,gBAAgB,MAAM;AAC3B,cAAI,SAAS,KAAK,IAAI,gBAAgB,SAAS,KAAK,IAAI,KAAK;AACzD,iBAAK,IAAI,qBAAqB,MAAM,MAAM,MAAM,QAAQ,MAAM;iBAC3D;AACH,iBAAK,IAAI,oBAAoB,MAAM,MAAM,MAAM,YAAY,QAAQ,MAAM;;;MAGrF;;;;MAKO,0BAA0B,aAAiC;AAC9D,YAAI,eAAe,MAAM;AACrB;;AAEJ,YAAI,KAAK,uBAAuB,aAAa;AACzC,eAAK,qBAAqB;AAC1B,eAAK,gBAAgB,WAAW;AAChC,eAAK,2BAA2B,YAAY;;MAEpD;MAEQ,6BACJ,eACA,QACA,uBAAkE;AAElE,cAAM,aAAa,OAAO,mBAAkB;AAE5C,YAAI,CAAC,KAAK,sBAAsB;AAC5B,eAAK,yBAAwB;;AAGjC,aAAK,oBAAmB;AAExB,iBAAS,QAAQ,GAAG,QAAQ,WAAW,QAAQ,SAAS;AACpD,gBAAM,QAAQ,OAAO,qBAAqB,KAAK;AAE/C,cAAI,SAAS,GAAG;AACZ,kBAAM,KAAK,WAAW,KAAK;AAC3B,gBAAI,eAAuC;AAE3C,gBAAI,uBAAuB;AACvB,6BAAe,sBAAsB,EAAE;;AAG3C,gBAAI,CAAC,cAAc;AACf,6BAAe,cAAc,EAAE;;AAGnC,gBAAI,CAAC,cAAc;AACf;;AAGJ,iBAAK,IAAI,wBAAwB,KAAK;AACtC,gBAAI,CAAC,KAAK,sBAAsB;AAC5B,mBAAK,2BAA2B,KAAK,IAAI;;AAG7C,kBAAM,SAAS,aAAa,UAAS;AACrC,gBAAI,QAAQ;AACR,mBAAK,qBAAqB,QAAQ,OAAO,aAAa,QAAO,GAAI,aAAa,MAAM,aAAa,YAAY,aAAa,YAAY,aAAa,UAAU;AAE7J,kBAAI,aAAa,eAAc,GAAI;AAC/B,qBAAK,IAAI,oBAAoB,OAAO,aAAa,mBAAkB,CAAE;AACrE,oBAAI,CAAC,KAAK,sBAAsB;AAC5B,uBAAK,0BAA0B,KAAK,KAAK;AACzC,uBAAK,wBAAwB,KAAK,MAAM;;;;;;MAMhE;;;;;;;;;;MAWO,wBACH,eACA,aACA,QACA,uBAAkE;AAElE,cAAM,MAAM,KAAK,IAAI,kBAAiB;AAEtC,YAAI,CAAC,KAAK;AACN,gBAAM,IAAI,MAAM,sBAAsB;;AAG1C,aAAK,uBAAuB;AAE5B,aAAK,IAAI,gBAAgB,GAAG;AAE5B,aAAK,4BAA4B;AACjC,aAAK,6BAA6B,eAAe,QAAQ,qBAAqB;AAE9E,aAAK,gBAAgB,WAAW;AAEhC,aAAK,uBAAuB;AAC5B,aAAK,IAAI,gBAAgB,IAAI;AAE7B,eAAO;MACX;;;;;;;MAQO,sBAAsB,mBAA2C,aAAiC;AACrG,YAAI,KAAK,6BAA6B,mBAAmB;AACrD,eAAK,2BAA2B;AAEhC,eAAK,IAAI,gBAAgB,iBAAiB;AAC1C,eAAK,uBAAuB;AAC5B,eAAK,qBAAqB;AAE1B,eAAK,2BAA2B,eAAe,QAAQ,YAAY;AACnE,eAAK,4BAA4B;;MAEzC;;;;;;;;;MAUO,oBAAoB,cAA0B,aAAyB,mBAA6B,kBAA0B,QAAc;AAC/I,YAAI,KAAK,yBAAyB,gBAAgB,KAAK,kCAAkC,QAAQ;AAC7F,eAAK,uBAAuB;AAC5B,eAAK,gCAAgC;AAErC,gBAAM,kBAAkB,OAAO,mBAAkB;AAEjD,eAAK,yBAAwB;AAC7B,eAAK,oBAAmB;AAExB,cAAI,SAAS;AACb,mBAAS,QAAQ,GAAG,QAAQ,iBAAiB,SAAS;AAClD,gBAAI,QAAQ,kBAAkB,QAAQ;AAClC,oBAAM,QAAQ,OAAO,qBAAqB,KAAK;AAE/C,kBAAI,SAAS,GAAG;AACZ,qBAAK,IAAI,wBAAwB,KAAK;AACtC,qBAAK,2BAA2B,KAAK,IAAI;AACzC,qBAAK,qBAAqB,cAAc,OAAO,kBAAkB,KAAK,GAAG,KAAK,IAAI,OAAO,OAAO,kBAAkB,MAAM;;AAG5H,wBAAU,kBAAkB,KAAK,IAAI;;;;AAKjD,aAAK,0BAA0B,WAAW;MAC9C;MAEQ,2BAAwB;AAC5B,YAAI,CAAC,KAAK,0BAA0B;AAChC;;AAGJ,aAAK,2BAA2B;AAChC,aAAK,IAAI,gBAAgB,IAAI;MACjC;;;;;;;;MASO,YACH,eACA,aACA,QACA,uBAAkE;AAElE,YAAI,KAAK,yBAAyB,iBAAiB,KAAK,kCAAkC,QAAQ;AAC9F,eAAK,uBAAuB;AAC5B,eAAK,gCAAgC;AAErC,eAAK,6BAA6B,eAAe,QAAQ,qBAAqB;;AAGlF,aAAK,0BAA0B,WAAW;MAC9C;;;;MAKO,2BAAwB;AAC3B,YAAI;AACJ,iBAAS,IAAI,GAAG,KAAK,KAAK,0BAA0B,QAAQ,IAAI,IAAI,KAAK;AACrE,gBAAM,kBAAkB,KAAK,wBAAwB,CAAC;AACtD,cAAI,eAAe,mBAAmB,gBAAgB,YAAY;AAC9D,0BAAc;AACd,iBAAK,gBAAgB,eAAe;;AAExC,gBAAM,iBAAiB,KAAK,0BAA0B,CAAC;AACvD,eAAK,IAAI,oBAAoB,gBAAgB,CAAC;;AAElD,aAAK,wBAAwB,SAAS;AACtC,aAAK,0BAA0B,SAAS;MAC5C;;;;;MAMO,yBAAyB,KAA2B;AACvD,aAAK,IAAI,kBAAkB,GAAG;MAClC;;;;MAKO,eAAe,QAAkB;AACpC,eAAO;AAEP,YAAI,OAAO,eAAe,GAAG;AACzB,eAAK,cAAc,MAAM;AACzB,iBAAO;;AAGX,eAAO;MACX;MAEU,cAAc,QAAkB;AACtC,aAAK,IAAI,aAAa,OAAO,kBAAkB;MACnD;;;;;;;MAQO,6BAA6B,iBAA6B,MAAoB,iBAAqD;AACtI,aAAK,gBAAgB,eAAe;AACpC,YAAI,MAAM;AACN,eAAK,IAAI,cAAc,KAAK,IAAI,cAAc,GAAG,IAAI;;AAGzD,YAAU,gBAAgB,CAAC,EAAG,UAAU,QAAW;AAC/C,eAAK,oBAAoB,iBAAiB,iBAAwB,IAAI;eACnE;AACH,mBAAS,QAAQ,GAAG,QAAQ,GAAG,SAAS;AACpC,kBAAM,iBAAyB,gBAAgB,KAAK;AAEpD,gBAAI,CAAC,KAAK,2BAA2B,cAAc,GAAG;AAClD,mBAAK,IAAI,wBAAwB,cAAc;AAC/C,mBAAK,2BAA2B,cAAc,IAAI;;AAGtD,iBAAK,qBAAqB,iBAAiB,gBAAgB,GAAG,KAAK,IAAI,OAAO,OAAO,IAAI,QAAQ,EAAE;AACnG,iBAAK,IAAI,oBAAoB,gBAAgB,CAAC;AAC9C,iBAAK,0BAA0B,KAAK,cAAc;AAClD,iBAAK,wBAAwB,KAAK,eAAe;;;MAG7D;;;;;;;MAQO,oBAAoB,iBAA6B,gBAA2C,gBAAgB,MAAI;AACnH,aAAK,gBAAgB,eAAe;AAEpC,YAAI,SAAS;AACb,YAAI,eAAe;AACf,mBAAS,IAAI,GAAG,IAAI,eAAe,QAAQ,KAAK;AAC5C,kBAAM,KAAK,eAAe,CAAC;AAC3B,sBAAU,GAAG,gBAAgB;;;AAIrC,iBAAS,IAAI,GAAG,IAAI,eAAe,QAAQ,KAAK;AAC5C,gBAAM,KAAK,eAAe,CAAC;AAC3B,cAAI,GAAG,UAAU,QAAW;AACxB,eAAG,QAAQ,KAAK,eAAgB,2BAA2B,GAAG,aAAa;;AAG/E,cAAI,GAAG,QAAQ,GAAG;AACd;;AAGJ,cAAI,CAAC,KAAK,2BAA2B,GAAG,KAAK,GAAG;AAC5C,iBAAK,IAAI,wBAAwB,GAAG,KAAK;AACzC,iBAAK,2BAA2B,GAAG,KAAK,IAAI;;AAGhD,eAAK,qBAAqB,iBAAiB,GAAG,OAAO,GAAG,eAAe,GAAG,iBAAiB,KAAK,IAAI,OAAO,GAAG,cAAc,OAAO,QAAQ,GAAG,MAAM;AACpJ,eAAK,IAAI,oBAAoB,GAAG,OAAO,GAAG,YAAY,SAAY,IAAI,GAAG,OAAO;AAChF,eAAK,0BAA0B,KAAK,GAAG,KAAK;AAC5C,eAAK,wBAAwB,KAAK,eAAe;;MAEzD;;;;;MAMO,+BAA+B,MAAY;AAC9C,YAAI,CAAC,KAAK,gBAAgB;AACtB;;AAGJ,cAAM,oBAAoB,KAAK,eAAe,2BAA2B,IAAI;AAC7E,aAAK,yBAAyB,iBAAiB;MACnD;;;;;MAMO,yBAAyB,mBAAyB;AACrD,YAAI,cAAc;AAClB,YAAI;AACJ,gBAAQ,QAAQ,KAAK,0BAA0B,QAAQ,iBAAiB,OAAO,IAAI;AAC/E,eAAK,0BAA0B,OAAO,OAAO,CAAC;AAC9C,eAAK,wBAAwB,OAAO,OAAO,CAAC;AAE5C,wBAAc;AACd,kBAAQ,KAAK,0BAA0B,QAAQ,iBAAiB;;AAGpE,YAAI,aAAa;AACb,eAAK,IAAI,oBAAoB,mBAAmB,CAAC;AACjD,eAAK,wBAAwB,iBAAiB;;MAEtD;;;;;MAMO,wBAAwB,mBAAyB;AACpD,aAAK,IAAI,yBAAyB,iBAAiB;AACnD,aAAK,2BAA2B,iBAAiB,IAAI;AACrD,aAAK,uBAAuB,iBAAiB,EAAE,SAAS;MAC5D;;;;;;;;MASO,KAAK,cAAuB,YAAoB,YAAoB,gBAAuB;AAC9F,aAAK,iBAAiB,eAAe,IAAA,GAAA,YAAU,YAAA,cAA4B;MAC/E;;;;;;;MAQO,gBAAgB,eAAuB,eAAuB,gBAAuB;AACxF,aAAK,eAAe,GAAA,eAAU,eAAsB,cAAe;MACvE;;;;;;;;MASO,cAAc,cAAuB,eAAuB,eAAuB,gBAAuB;AAC7G,aAAK,eAAe,eAAe,IAAA,GAAA,eAAU,eAA2B,cAAW;MACvF;;;;;;;;MASO,iBAAiB,UAAkB,YAAoB,YAAoB,gBAAuB;AAErG,aAAK,YAAW;AAEhB,aAAK,gBAAe;AAIpB,cAAM,WAAW,KAAK,UAAU,QAAQ;AACxC,cAAM,cAAc,KAAK,2BAA2B,KAAK,IAAI,eAAe,KAAK,IAAI;AACrF,cAAM,OAAO,KAAK,2BAA2B,IAAI;AACjD,YAAI,gBAAgB;AAChB,eAAK,IAAI,sBAAsB,UAAU,YAAY,aAAa,aAAa,MAAM,cAAc;eAChG;AACH,eAAK,IAAI,aAAa,UAAU,YAAY,aAAa,aAAa,IAAI;;MAElF;;;;;;;;MASO,eAAe,UAAkB,eAAuB,eAAuB,gBAAuB;AAEzG,aAAK,YAAW;AAEhB,aAAK,gBAAe;AAEpB,cAAM,WAAW,KAAK,UAAU,QAAQ;AACxC,YAAI,gBAAgB;AAChB,eAAK,IAAI,oBAAoB,UAAU,eAAe,eAAe,cAAc;eAChF;AACH,eAAK,IAAI,WAAW,UAAU,eAAe,aAAa;;MAElE;MAEQ,UAAU,UAAgB;AAC9B,gBAAQ,UAAU;UAEd,KAAK;AACD,mBAAO,KAAK,IAAI;UACpB,KAAK;AACD,mBAAO,KAAK,IAAI;UACpB,KAAK;AACD,mBAAO,KAAK,IAAI;UAEpB,KAAK;AACD,mBAAO,KAAK,IAAI;UACpB,KAAK;AACD,mBAAO,KAAK,IAAI;UACpB,KAAK;AACD,mBAAO,KAAK,IAAI;UACpB,KAAK;AACD,mBAAO,KAAK,IAAI;UACpB,KAAK;AACD,mBAAO,KAAK,IAAI;UACpB,KAAK;AACD,mBAAO,KAAK,IAAI;UACpB;AACI,mBAAO,KAAK,IAAI;;MAE5B;;MAGU,kBAAe;MAEzB;;;;;MAOO,eAAe,QAAc;AAChC,YAAI,KAAK,iBAAiB,OAAO,IAAI,GAAG;AACpC,iBAAO,KAAK,iBAAiB,OAAO,IAAI;;AAE5C,cAAM,kBAAkB,OAAO,mBAAkB;AACjD,YAAI,iBAAiB;AACjB,eAAK,uBAAuB,eAAe;;MAEnD;;;;MAKO,uBAAuB,iBAAiC;AAC3D,cAAM,uBAAuB;AAC7B,YAAI,wBAAwB,qBAAqB,SAAS;AACtD,+BAAqB,QAAQ,2BAA2B;AAExD,eAAK,IAAI,cAAc,qBAAqB,OAAO;;MAE3D;;MAGO,kBAAkB,SAAmC;AACxD,YAAI,SAAS;AACT,cAAI,KAAK,iBAAiB;AACtB,oBAAQ,oBAAoB,IAAI;iBAC7B;AACH,mBAAO,QAAQ,oBAAoB;;AAEvC,cAAI,KAAK,uBAAuB;AAC5B,oBAAQ,yBAAyB,IAAI;iBAClC;AACH,mBAAO,QAAQ,yBAAyB;;AAE5C,cAAI,KAAK,yBAAyB;AAC9B,oBAAQ,4BAA4B,IAAI;iBACrC;AACH,mBAAO,QAAQ,4BAA4B;;AAE/C;eACG;AACH,cAAI,IAAI;AACR,cAAI,KAAK,iBAAiB;AACtB,iBAAK;;AAET,cAAI,KAAK,uBAAuB;AAC5B,gBAAI,GAAG;AACH,mBAAK;;AAET,iBAAK;;AAET,cAAI,KAAK,yBAAyB;AAC9B,gBAAI,GAAG;AACH,mBAAK;;AAET,iBAAK;;AAET,iBAAO;;MAEf;;;;;;;;;;;;;;;MAgBO,aACH,UACA,0BACA,uBACA,UACA,SACA,WACA,YACA,SACA,iBACA,iBAAiB,eAAe,MAAI;AAEpC,cAAM,SAAS,SAAS,iBAAiB,SAAS,UAAU,SAAS,eAAe,SAAS,gBAAgB;AAC7G,cAAM,WAAW,SAAS,mBAAmB,SAAS,YAAY,SAAS,iBAAiB,SAAS,kBAAkB;AACvH,cAAM,gBAAgB,KAAK,kBAAiB;AAE5C,YAAI,cAAc,WAAoC,yBAA0B,WAAW;AAE3F,YAAI,eAAe;AACf,yBAAe;;AAGnB,cAAM,OAAO,SAAS,MAAM,WAAW,MAAM;AAC7C,YAAI,KAAK,iBAAiB,IAAI,GAAG;AAC7B,gBAAM,iBAAyB,KAAK,iBAAiB,IAAI;AACzD,cAAI,cAAc,eAAe,QAAO,GAAI;AACxC,uBAAW,cAAc;;AAG7B,iBAAO;;AAEX,cAAM,SAAS,IAAI,OACf,UACA,0BACA,uBACA,UACA,MACA,SACA,WACA,YACA,SACA,iBACA,MACA,cAAc;AAElB,aAAK,iBAAiB,IAAI,IAAI;AAE9B,eAAO;MACX;;MAGU,OAAO,mBAAmB,QAAgB,SAA2B,gBAAwB,IAAE;AACrG,eAAO,iBAAiB,UAAU,UAAU,OAAO,MAAM;MAC7D;MAEQ,eAAe,QAAgB,MAAc,SAA2B,eAAqB;AACjG,eAAO,KAAK,kBAAkB,YAAW,mBAAmB,QAAQ,SAAS,aAAa,GAAG,IAAI;MACrG;MAEQ,kBAAkB,QAAgB,MAAY;AAClD,cAAM,KAAK,KAAK;AAEhB,cAAM,SAAS,GAAG,aAAa,SAAS,WAAW,GAAG,gBAAgB,GAAG,eAAe;AAExF,YAAI,CAAC,QAAQ;AACT,cAAI,QAAgB,GAAG;AACvB,cAAI,YAAoB,GAAG;AAC3B,kBAAQ,YAAY,GAAG,SAAQ,OAAQ,GAAG,UAAU;AAChD,oBAAQ;;AAGZ,gBAAM,IAAI,MACN,4CAA4C,IAAI,4BAA4B,KAAK,sBAAsB,GAAG,cAAa,CAAE,qBAAqB,KAAK,eAAe,EAAE;;AAI5K,WAAG,aAAa,QAAQ,MAAM;AAC9B,WAAG,cAAc,MAAM;AAEvB,eAAO;MACX;;;;MAKO,iBAAiB,QAAmB;AACvC,eAAO,KAAK,IAAI,gBAAgB,MAAM;MAC1C;;;;;;;;;;MAWO,uBACH,iBACA,YACA,cACA,SACA,4BAAgD,MAAI;AAEpD,kBAAU,WAAW,KAAK;AAE1B,cAAM,eAAe,KAAK,kBAAkB,YAAY,QAAQ;AAChE,cAAM,iBAAiB,KAAK,kBAAkB,cAAc,UAAU;AAEtE,eAAO,KAAK,qBAAqB,iBAAyC,cAAc,gBAAgB,SAAS,yBAAyB;MAC9I;;;;;;;;;;;MAYO,oBACH,iBACA,YACA,cACA,SACA,SACA,4BAAgD,MAAI;AAEpD,kBAAU,WAAW,KAAK;AAE1B,cAAM,gBAAgB,KAAK,gBAAgB,IAAI,uCAAuC;AACtF,cAAM,eAAe,KAAK,eAAe,YAAY,UAAU,SAAS,aAAa;AACrF,cAAM,iBAAiB,KAAK,eAAe,cAAc,YAAY,SAAS,aAAa;AAE3F,eAAO,KAAK,qBAAqB,iBAAyC,cAAc,gBAAgB,SAAS,yBAAyB;MAC9I;;;;;;MAOO,iBAAiB,MAAY;AAEhC,eAAO;MACX;;;;;;MAOO,sBAAsB,yBAA0D;AACnF,cAAM,kBAAkB,IAAI,qBAAoB;AAChD,wBAAgB,SAAS;AAEzB,YAAI,KAAK,MAAM,uBAAuB;AAClC,0BAAgB,qBAAqB;;AAGzC,eAAO;MACX;;;;;MAMO,wBAAqB;AACxB,eAAO;MACX;;;;;MAMO,oBAAiB;AACpB,eAAO;MACX;MAEU,qBACN,iBACA,cACA,gBACA,SACA,4BAAgD,MAAI;AAEpD,cAAM,gBAAgB,QAAQ,cAAa;AAC3C,wBAAgB,UAAU;AAE1B,YAAI,CAAC,eAAe;AAChB,gBAAM,IAAI,MAAM,0BAA0B;;AAG9C,gBAAQ,aAAa,eAAe,YAAY;AAChD,gBAAQ,aAAa,eAAe,cAAc;AAElD,gBAAQ,YAAY,aAAa;AAEjC,wBAAgB,UAAU;AAC1B,wBAAgB,eAAe;AAC/B,wBAAgB,iBAAiB;AAEjC,YAAI,CAAC,gBAAgB,oBAAoB;AACrC,eAAK,yBAAyB,eAAe;;AAGjD,eAAO;MACX;MAEU,yBAAyB,iBAAqC;AACpE,cAAM,UAAU,gBAAgB;AAChC,cAAM,eAAe,gBAAgB;AACrC,cAAM,iBAAiB,gBAAgB;AACvC,cAAM,UAAU,gBAAgB;AAEhC,cAAM,SAAS,QAAQ,oBAAoB,SAAS,QAAQ,WAAW;AACvE,YAAI,CAAC,QAAQ;AAGT,cAAI,CAAC,KAAK,IAAI,mBAAmB,cAAc,KAAK,IAAI,cAAc,GAAG;AACrE,kBAAM,MAAM,KAAK,IAAI,iBAAiB,YAAY;AAClD,gBAAI,KAAK;AACL,8BAAgB,yBAAyB;AACzC,oBAAM,IAAI,MAAM,mBAAmB,GAAG;;;AAK9C,cAAI,CAAC,KAAK,IAAI,mBAAmB,gBAAgB,KAAK,IAAI,cAAc,GAAG;AACvE,kBAAM,MAAM,KAAK,IAAI,iBAAiB,cAAc;AACpD,gBAAI,KAAK;AACL,8BAAgB,2BAA2B;AAC3C,oBAAM,IAAI,MAAM,qBAAqB,GAAG;;;AAIhD,gBAAM,QAAQ,QAAQ,kBAAkB,OAAO;AAC/C,cAAI,OAAO;AACP,4BAAgB,mBAAmB;AACnC,kBAAM,IAAI,MAAM,KAAK;;;AAI7B,YAAI,KAAK,wBAAwB;AAC7B,kBAAQ,gBAAgB,OAAO;AAC/B,gBAAM,YAAY,QAAQ,oBAAoB,SAAS,QAAQ,eAAe;AAE9E,cAAI,CAAC,WAAW;AACZ,kBAAM,QAAQ,QAAQ,kBAAkB,OAAO;AAC/C,gBAAI,OAAO;AACP,8BAAgB,yBAAyB;AACzC,oBAAM,IAAI,MAAM,KAAK;;;;AAKjC,gBAAQ,aAAa,YAAY;AACjC,gBAAQ,aAAa,cAAc;AAEnC,wBAAgB,eAAe;AAC/B,wBAAgB,iBAAiB;AAEjC,YAAI,gBAAgB,YAAY;AAC5B,0BAAgB,WAAU;AAC1B,0BAAgB,aAAa;;MAErC;;;;MAKO,wBACH,iBACA,kBACA,oBACA,aACA,qBACA,uBACA,eACA,SACA,2BACA,KAAW;AAEX,cAAM,sBAAsB;AAE5B,YAAI,aAAa;AACb,8BAAoB,UAAU,KAAK,uBAAuB,qBAAqB,kBAAkB,oBAAoB,QAAW,yBAAyB;eACtJ;AACH,8BAAoB,UAAU,KAAK,oBAAoB,qBAAqB,kBAAkB,oBAAoB,SAAS,QAAW,yBAAyB;;AAEnK,4BAAoB,QAAQ,2BAA2B;MAC3D;;;;MAKO,0BAA0B,iBAAiC;AAC9D,cAAM,uBAAuB;AAC7B,YAAI,KAAK,eAAe,qBAAqB,aAAa;AACtD,iBAAO;;AAEX,YAAI,KAAK,IAAI,oBAAoB,qBAAqB,SAAU,KAAK,MAAM,sBAAuB,qBAAqB,GAAG;AACtH,eAAK,yBAAyB,oBAAoB;AAClD,iBAAO;;AAGX,eAAO;MACX;;;;MAKO,qCAAqC,iBAAmC,QAAkB;AAC7F,cAAM,uBAAuB;AAE7B,YAAI,CAAC,qBAAqB,oBAAoB;AAC1C,iBAAM;AACN;;AAGJ,cAAM,aAAa,qBAAqB;AAExC,YAAI,YAAY;AACZ,+BAAqB,aAAa,MAAK;AACnC,uBAAW;AACX,mBAAM;UACV;eACG;AACH,+BAAqB,aAAa;;MAE1C;;;;;;;MAQO,YAAY,iBAAmC,eAAuB;AACzE,cAAM,UAAU,IAAI,MAAK;AACzB,cAAM,uBAAuB;AAE7B,iBAAS,QAAQ,GAAG,QAAQ,cAAc,QAAQ,SAAS;AACvD,kBAAQ,KAAK,KAAK,IAAI,mBAAmB,qBAAqB,SAAU,cAAc,KAAK,CAAC,CAAC;;AAGjG,eAAO;MACX;;;;;;;MAQO,cAAc,iBAAmC,iBAAyB;AAC7E,cAAM,UAAU,CAAA;AAChB,cAAM,uBAAuB;AAE7B,iBAAS,QAAQ,GAAG,QAAQ,gBAAgB,QAAQ,SAAS;AACzD,cAAI;AACA,oBAAQ,KAAK,KAAK,IAAI,kBAAkB,qBAAqB,SAAU,gBAAgB,KAAK,CAAC,CAAC;mBACzF,GAAG;AACR,oBAAQ,KAAK,EAAE;;;AAIvB,eAAO;MACX;;;;;MAMO,aAAa,QAAsC;AACtD,iBAAS,WAAW,QAAQ,YAAY,UAAU,MAAM,IAAI,OAAO,SAAS;AAE5E,YAAI,CAAC,UAAU,WAAW,KAAK,gBAAgB;AAC3C;;AAGJ,aAAK,sBAAsB,kBAAkB;AAE7C,iBAAS;AAGT,aAAK,aAAa,MAAM;AAExB,aAAK,iBAAiB;AAEtB,YAAI,OAAO,QAAQ;AACf,iBAAO,OAAO,MAAM;;AAExB,YAAI,OAAO,mBAAmB;AAC1B,iBAAO,kBAAkB,gBAAgB,MAAM;;MAEvD;;;;;;;MAQO,OAAO,SAAyC,OAAa;AAChE,YAAI,CAAC,SAAS;AACV,iBAAO;;AAGX,aAAK,IAAI,UAAU,SAAS,KAAK;AAEjC,eAAO;MACX;;;;;;;;MASO,QAAQ,SAAyC,GAAW,GAAS;AACxE,YAAI,CAAC,SAAS;AACV,iBAAO;;AAGX,aAAK,IAAI,UAAU,SAAS,GAAG,CAAC;AAEhC,eAAO;MACX;;;;;;;;;MAUO,QAAQ,SAAyC,GAAW,GAAW,GAAS;AACnF,YAAI,CAAC,SAAS;AACV,iBAAO;;AAGX,aAAK,IAAI,UAAU,SAAS,GAAG,GAAG,CAAC;AAEnC,eAAO;MACX;;;;;;;;;;MAWO,QAAQ,SAAyC,GAAW,GAAW,GAAW,GAAS;AAC9F,YAAI,CAAC,SAAS;AACV,iBAAO;;AAGX,aAAK,IAAI,UAAU,SAAS,GAAG,GAAG,GAAG,CAAC;AAEtC,eAAO;MACX;;;;;;;MAQO,YAAY,SAAyC,OAAiB;AACzE,YAAI,CAAC,SAAS;AACV,iBAAO;;AAGX,aAAK,IAAI,WAAW,SAAS,KAAK;AAElC,eAAO;MACX;;;;;;;MAQO,aAAa,SAAyC,OAAiB;AAC1E,YAAI,CAAC,WAAW,MAAM,SAAS,MAAM,GAAG;AACpC,iBAAO;;AAGX,aAAK,IAAI,WAAW,SAAS,KAAK;AAClC,eAAO;MACX;;;;;;;MAQO,aAAa,SAAyC,OAAiB;AAC1E,YAAI,CAAC,WAAW,MAAM,SAAS,MAAM,GAAG;AACpC,iBAAO;;AAGX,aAAK,IAAI,WAAW,SAAS,KAAK;AAClC,eAAO;MACX;;;;;;;MAQO,aAAa,SAAyC,OAAiB;AAC1E,YAAI,CAAC,WAAW,MAAM,SAAS,MAAM,GAAG;AACpC,iBAAO;;AAGX,aAAK,IAAI,WAAW,SAAS,KAAK;AAClC,eAAO;MACX;;;;;;;MAQO,QAAQ,SAAyC,OAAa;AACjE,YAAI,CAAC,SAAS;AACV,iBAAO;;AAGX,aAAK,IAAI,WAAW,SAAS,KAAK;AAElC,eAAO;MACX;;;;;;;;MASO,SAAS,SAAyC,GAAW,GAAS;AACzE,YAAI,CAAC,SAAS;AACV,iBAAO;;AAGX,aAAK,IAAI,WAAW,SAAS,GAAG,CAAC;AAEjC,eAAO;MACX;;;;;;;;;MAUO,SAAS,SAAyC,GAAW,GAAW,GAAS;AACpF,YAAI,CAAC,SAAS;AACV,iBAAO;;AAGX,aAAK,IAAI,WAAW,SAAS,GAAG,GAAG,CAAC;AAEpC,eAAO;MACX;;;;;;;;;;MAWO,SAAS,SAAyC,GAAW,GAAW,GAAW,GAAS;AAC/F,YAAI,CAAC,SAAS;AACV,iBAAO;;AAGX,aAAK,IAAI,WAAW,SAAS,GAAG,GAAG,GAAG,CAAC;AAEvC,eAAO;MACX;;;;;;;MAQO,aAAa,SAAyC,OAAkB;AAC3E,YAAI,CAAC,SAAS;AACV,iBAAO;;AAGX,aAAK,IAAI,YAAY,SAAS,KAAK;AAEnC,eAAO;MACX;;;;;;;MAQO,cAAc,SAAyC,OAAkB;AAC5E,YAAI,CAAC,WAAW,MAAM,SAAS,MAAM,GAAG;AACpC,iBAAO;;AAGX,aAAK,IAAI,YAAY,SAAS,KAAK;AACnC,eAAO;MACX;;;;;;;MAQO,cAAc,SAAyC,OAAkB;AAC5E,YAAI,CAAC,WAAW,MAAM,SAAS,MAAM,GAAG;AACpC,iBAAO;;AAGX,aAAK,IAAI,YAAY,SAAS,KAAK;AACnC,eAAO;MACX;;;;;;;MAQO,cAAc,SAAyC,OAAkB;AAC5E,YAAI,CAAC,WAAW,MAAM,SAAS,MAAM,GAAG;AACpC,iBAAO;;AAGX,aAAK,IAAI,YAAY,SAAS,KAAK;AACnC,eAAO;MACX;;;;;;;MAQO,SAAS,SAAyC,OAA8B;AACnF,YAAI,CAAC,SAAS;AACV,iBAAO;;AAGX,YAAI,MAAM,SAAS,GAAG;AAClB,iBAAO;;AAEX,aAAK,IAAI,WAAW,SAAS,KAAK;AAClC,eAAO;MACX;;;;;;;MAQO,UAAU,SAAyC,OAA8B;AACpF,YAAI,CAAC,WAAW,MAAM,SAAS,MAAM,GAAG;AACpC,iBAAO;;AAGX,aAAK,IAAI,WAAW,SAAc,KAAK;AACvC,eAAO;MACX;;;;;;;MAQO,UAAU,SAAyC,OAA8B;AACpF,YAAI,CAAC,WAAW,MAAM,SAAS,MAAM,GAAG;AACpC,iBAAO;;AAGX,aAAK,IAAI,WAAW,SAAc,KAAK;AACvC,eAAO;MACX;;;;;;;MAQO,UAAU,SAAyC,OAA8B;AACpF,YAAI,CAAC,WAAW,MAAM,SAAS,MAAM,GAAG;AACpC,iBAAO;;AAGX,aAAK,IAAI,WAAW,SAAc,KAAK;AACvC,eAAO;MACX;;;;;;;MAQO,YAAY,SAAyC,UAAmC;AAC3F,YAAI,CAAC,SAAS;AACV,iBAAO;;AAGX,aAAK,IAAI,iBAAiB,SAAS,OAAO,QAAQ;AAClD,eAAO;MACX;;;;;;;MAQO,aAAa,SAAyC,QAAoB;AAC7E,YAAI,CAAC,SAAS;AACV,iBAAO;;AAGX,aAAK,IAAI,iBAAiB,SAAS,OAAO,MAAM;AAChD,eAAO;MACX;;;;;;;MAQO,aAAa,SAAyC,QAAoB;AAC7E,YAAI,CAAC,SAAS;AACV,iBAAO;;AAGX,aAAK,IAAI,iBAAiB,SAAS,OAAO,MAAM;AAChD,eAAO;MACX;;;;;;;MAQO,SAAS,SAAyC,OAAa;AAClE,YAAI,CAAC,SAAS;AACV,iBAAO;;AAGX,aAAK,IAAI,UAAU,SAAS,KAAK;AAEjC,eAAO;MACX;;;;;;;;MASO,UAAU,SAAyC,GAAW,GAAS;AAC1E,YAAI,CAAC,SAAS;AACV,iBAAO;;AAGX,aAAK,IAAI,UAAU,SAAS,GAAG,CAAC;AAEhC,eAAO;MACX;;;;;;;;;MAUO,UAAU,SAAyC,GAAW,GAAW,GAAS;AACrF,YAAI,CAAC,SAAS;AACV,iBAAO;;AAGX,aAAK,IAAI,UAAU,SAAS,GAAG,GAAG,CAAC;AAEnC,eAAO;MACX;;;;;;;;;;MAWO,UAAU,SAAyC,GAAW,GAAW,GAAW,GAAS;AAChG,YAAI,CAAC,SAAS;AACV,iBAAO;;AAGX,aAAK,IAAI,UAAU,SAAS,GAAG,GAAG,GAAG,CAAC;AAEtC,eAAO;MACX;;;;;MAOO,cAAW;AACd,aAAK,mBAAmB,MAAM,KAAK,GAAG;AACtC,aAAK,sBAAsB,MAAM,KAAK,GAAG;AACzC,aAAK,YAAY,MAAM,KAAK,GAAG;AAE/B,YAAI,KAAK,oBAAoB;AACzB,eAAK,qBAAqB;AAC1B,gBAAM,SAAS,KAAK;AACpB,eAAK,IAAI,UAAU,QAAQ,QAAQ,QAAQ,MAAM;;MAEzD;;;;;MAMO,cAAc,QAAe;AAChC,YAAI,WAAW,KAAK,aAAa;AAC7B,eAAK,qBAAqB;AAC1B,eAAK,cAAc;;MAE3B;;;;;MAMO,gBAAa;AAChB,eAAO,KAAK;MAChB;;;;MAKA,IAAW,oBAAiB;AACxB,eAAO,KAAK;MAChB;;;;MAKA,IAAW,aAAU;AACjB,eAAO,KAAK;MAChB;;;;MAKA,IAAW,eAAY;AACnB,eAAO,KAAK;MAChB;;;;MAKA,IAAW,uBAAoB;AAC3B,eAAO,KAAK;MAChB;;;;;;MAQO,6BAA0B;AAC7B,aAAK,uBAAuB,SAAS;MACzC;;;;;;MAOO,WAAW,YAAoB;AAClC,YAAI,KAAK,iCAAiC,CAAC,YAAY;AACnD;;AAEJ,aAAK,iBAAiB;AACtB,aAAK,gBAAgB,IAAI;AACzB,aAAK,gBAAgB,IAAI;AACzB,aAAK,gBAAgB,IAAI;AACzB,aAAK,gBAAgB,IAAI;AAGzB,aAAK,yBAAwB;AAE7B,YAAI,YAAY;AACZ,eAAK,kBAAkB;AACvB,eAAK,kBAAiB;AAEtB,eAAK,sBAAsB,MAAK;AAEhC,eAAK,mBAAmB,MAAK;AAC7B,eAAK,mBAAmB,YAAY,KAAK,IAAI;AAE7C,eAAK,YAAY,MAAK;AACtB,eAAK,aAAa;AAClB,eAAK,iBAAiB;AAEtB,eAAK,cAAc;AACnB,eAAK,qBAAqB;AAE1B,eAAK,qBAAqB;AAE1B,eAAK,IAAI,YAAY,KAAK,IAAI,oCAAoC,KAAK,IAAI,IAAI;AAC/E,eAAK,IAAI,YAAY,KAAK,IAAI,gCAAgC,CAAC;AAE/D,eAAK,4BAA4B;AACjC,eAAK,oBAAmB;;AAG5B,aAAK,0BAAyB;AAC9B,aAAK,qBAAqB;AAC1B,aAAK,gCAAgC;AACrC,aAAK,gBAAgB,IAAI;MAC7B;;;;MAKO,uBAAuB,cAAsB,iBAAwB;AACxE,cAAM,KAAK,KAAK;AAChB,YAAI,YAAoB,GAAG;AAC3B,YAAI,YAAoB,GAAG;AAE3B,gBAAQ,cAAc;UAClB,KAAK;AACD,wBAAY,GAAG;AACf,gBAAI,iBAAiB;AACjB,0BAAY,GAAG;mBACZ;AACH,0BAAY,GAAG;;AAEnB;UACJ,KAAK;AACD,wBAAY,GAAG;AACf,gBAAI,iBAAiB;AACjB,0BAAY,GAAG;mBACZ;AACH,0BAAY,GAAG;;AAEnB;UACJ,KAAK;AACD,wBAAY,GAAG;AACf,gBAAI,iBAAiB;AACjB,0BAAY,GAAG;mBACZ;AACH,0BAAY,GAAG;;AAEnB;UACJ,KAAK;AACD,wBAAY,GAAG;AACf,gBAAI,iBAAiB;AACjB,0BAAY,GAAG;mBACZ;AACH,0BAAY,GAAG;;AAEnB;UACJ,KAAK;AACD,wBAAY,GAAG;AACf,gBAAI,iBAAiB;AACjB,0BAAY,GAAG;mBACZ;AACH,0BAAY,GAAG;;AAEnB;UACJ,KAAK;AACD,wBAAY,GAAG;AACf,gBAAI,iBAAiB;AACjB,0BAAY,GAAG;mBACZ;AACH,0BAAY,GAAG;;AAEnB;UACJ,KAAK;AACD,wBAAY,GAAG;AACf,wBAAY,GAAG;AACf;UACJ,KAAK;AACD,wBAAY,GAAG;AACf,wBAAY,GAAG;AACf;UACJ,KAAK;AACD,wBAAY,GAAG;AACf,gBAAI,iBAAiB;AACjB,0BAAY,GAAG;mBACZ;AACH,0BAAY,GAAG;;AAEnB;UACJ,KAAK;AACD,wBAAY,GAAG;AACf,gBAAI,iBAAiB;AACjB,0BAAY,GAAG;mBACZ;AACH,0BAAY,GAAG;;AAEnB;UACJ,KAAK;AACD,wBAAY,GAAG;AACf,wBAAY,GAAG;AACf;UACJ,KAAK;AACD,wBAAY,GAAG;AACf,wBAAY,GAAG;AACf;;AAGR,eAAO;UACH,KAAK;UACL,KAAK;;MAEb;;MAGU,iBAAc;AACpB,cAAM,UAAU,KAAK,IAAI,cAAa;AAEtC,YAAI,CAAC,SAAS;AACV,gBAAM,IAAI,MAAM,0BAA0B;;AAG9C,eAAO;MACX;;MAGO,yBAAsB;AACzB,eAAO,IAAI,qBAAqB,KAAK,eAAc,GAAI,KAAK,GAAG;MACnE;;;;;;;;;;MAWO,uBACH,MACA,SACA,0BAA0B,MAC1B,SAAS,sBAAsB,SAAO;AAEtC,YAAI,kBAAkB;AACtB,YAAI,OAAO;AACX,YAAI,eAAe;AACnB,YAAI,SAAS;AACb,YAAI,gBAAgB;AACpB,YAAI,UAAU;AACd,YAAI;AACJ,YAAI,YAAY,UAAa,OAAO,YAAY,UAAU;AACtD,4BAAkB,CAAC,CAAC,QAAQ;AAC5B,iBAAO,QAAQ,SAAS,SAAY,IAAA,QAAU;AAC9C,yBAAe,QAAQ,iBAAiB,SAAY,IAAA,QAAU;AAC9D,mBAAS,QAAQ,WAAW,SAAY,IAAA,QAAU;AAClD,0BAAgB,QAAQ,kBAAkB,SAAY,QAAQ,QAAQ;AACtE,oBAAU,QAAQ,WAAW;AAC7B,kBAAQ,QAAQ;eACb;AACH,4BAAkB,CAAC,CAAC;;AAGxB,0BAAA,gBAAkB,KAAK,MAAM,uBAAuB,KAAK,eAAe,KAAK,KAAK;AAElF,YAAI,SAAS,KAAA,CAAA,KAAU,MAAA,6BAAiC;AAEpD,yBAAe;mBACR,SAAS,KAAA,CAAA,KAAU,MAAA,iCAAsC;AAEhE,yBAAe;;AAEnB,YAAI,SAAS,KAAA,CAAA,KAAU,MAAA,cAAqB;AACxC,iBAAO;AACP,iBAAO,KAAK,4EAA4E;;AAG5F,cAAM,KAAK,KAAK;AAChB,cAAM,UAAU,IAAI,gBAAgB,MAAM,MAAM;AAChD,cAAM,QAA6D,KAAM,SAAiB;AAC1F,cAAM,SAA8D,KAAM,UAAkB;AAC5F,cAAM,SAA8D,KAAM,UAAU;AACpF,cAAM,UAAU,KAAK,uBAAuB,cAAc,eAAe;AACzE,cAAM,SAAS,WAAW,IAAI,GAAG,mBAAmB,GAAG;AACvD,cAAM,cAAc,KAAK,kCAAkC,MAAM,QAAQ,aAAa;AACtF,cAAM,iBAAiB,KAAK,mBAAmB,MAAM;AACrD,cAAM,cAAc,KAAK,qBAAqB,IAAI;AAGlD,aAAK,qBAAqB,QAAQ,OAAO;AAEzC,YAAI,WAAW,GAAG;AACd,kBAAQ,YAAY;AACpB,aAAG,WAAW,QAAQ,GAAG,aAAa,OAAO,QAAQ,QAAQ,GAAG,gBAAgB,aAAa,IAAI;eAC9F;AACH,aAAG,WAAW,QAAQ,GAAG,aAAa,OAAO,QAAQ,GAAG,gBAAgB,aAAa,IAAI;;AAG7F,WAAG,cAAc,QAAQ,GAAG,oBAAoB,QAAQ,GAAG;AAC3D,WAAG,cAAc,QAAQ,GAAG,oBAAoB,QAAQ,GAAG;AAC3D,WAAG,cAAc,QAAQ,GAAG,gBAAgB,GAAG,aAAa;AAC5D,WAAG,cAAc,QAAQ,GAAG,gBAAgB,GAAG,aAAa;AAG5D,YAAI,iBAAiB;AACjB,eAAK,IAAI,eAAe,MAAM;;AAGlC,aAAK,qBAAqB,QAAQ,IAAI;AAEtC,gBAAQ,iBAAiB;AACzB,gBAAQ,YAAY;AACpB,gBAAQ,aAAa;AACrB,gBAAQ,QAAQ;AAChB,gBAAQ,SAAS;AACjB,gBAAQ,QAAQ;AAChB,gBAAQ,UAAU;AAClB,gBAAQ,UAAU;AAClB,gBAAQ,kBAAkB;AAC1B,gBAAQ,eAAe;AACvB,gBAAQ,OAAO;AACf,gBAAQ,SAAS;AACjB,gBAAQ,QAAQ;AAEhB,aAAK,uBAAuB,KAAK,OAAO;AAExC,eAAO;MACX;;;;MAKO,kBAAkB,eAAwB,UAAiB;AAE9D,eAAO,iBAAiB,KAAK,MAAM,uBAAuB,KAAK,eAAe,KAAK,KAAK,YAAY;MACxG;MAEU,mBACN,KACA,UACA,SACA,OACA,eAAuB,GAAA,SAAU,MAAA,UAAA,MAAA,gBACjC,+BAEA,SAkBA,MAAA,WAAA,MAAA,SAQA,MAAA,kBACsC,MACtC,UAA2B,eAC3B,eACA;AAIA,cAAM,OAAO;AACb,cAAM,WAAW,IAAI,OAAO,GAAG,CAAC,MAAM;AACtC,cAAM,WAAW,IAAI,OAAO,GAAG,CAAC,MAAM;AACtC,cAAM,WAAW,YAAY,IAAI,QAAQ,UAAU,MAAM;AAEzD,cAAM,UAAU,WAAW,WAAW,IAAI,gBAAgB,MAAM,sBAAsB,GAAG;AAEzF,YAAI,YAAY,UAAU;AACtB,kBAAQ,QAAQ,IAAI,UAAU,GAAG,EAAE;;AAGvC,cAAM,cAAc;AACpB,YAAI,KAAK,wBAAwB,CAAC,YAAY,CAAC,YAAY,CAAC,QAAQ;AAChE,gBAAM,KAAK,qBAAqB,GAAG;;AAGvC,YAAI,gBAAgB,KAAK;AACrB,kBAAQ,eAAe;;AAI3B,cAAM,UAAU,IAAI,YAAY,GAAG;AACnC,YAAI,YAAY,kBAAkB,kBAAkB,UAAU,KAAK,IAAI,UAAU,OAAO,EAAE,YAAW,IAAK;AAC1G,YAAI,SAA2C;AAG/C,cAAM,mBAAmB,UAAU,QAAQ,GAAG;AAE9C,YAAI,mBAAmB,IAAI;AACvB,sBAAY,UAAU,MAAM,GAAG,EAAE,CAAC;;AAGtC,mBAAW,mBAAmB,YAAW,iBAAiB;AACtD,cAAI,gBAAgB,QAAQ,WAAW,QAAQ,GAAG;AAC9C,qBAAS;AACT;;;AAIR,YAAI,OAAO;AACP,gBAAM,eAAe,OAAO;;AAEhC,gBAAQ,MAAM;AACd,gBAAQ,kBAAkB,CAAC;AAC3B,gBAAQ,eAAe;AACvB,gBAAQ,UAAU;AAClB,gBAAQ,iBAAiB,KAAK,kBAAkB,CAAC,CAAC,eAAe,QAAQ;AAEzE,YAAI,CAAC,KAAK,yBAAyB;AAE/B,kBAAQ,UAAU;;AAGtB,YAAI,iBAAsD;AAC1D,YAAI,UAAU,CAAC,UAAU;AACrB,2BAAiB,QAAQ,mBAAmB,IAAI,MAAM;;AAG1D,YAAI,CAAC,UAAU;AACX,eAAK,uBAAuB,KAAK,OAAO;;AAG5C,cAAM,kBAAkB,CAAC,SAAkB,cAAmB;AAC1D,cAAI,OAAO;AACP,kBAAM,kBAAkB,OAAO;;AAGnC,cAAI,QAAQ,aAAa;AACrB,gBAAI,gBAAgB;AAChB,sBAAQ,mBAAmB,OAAO,cAAc;;AAGpD,gBAAI,YAAY,sBAAsB,QAAQ,YAAY,iBAAiB;AACvE,mBAAK,mBACD,YAAY,iBACZ,UACA,QAAQ,SACR,OACA,cACA,MACA,SACA,gBACA,+BACA,QACA,OAAO;;AAIf,uBAAW,WAAW,oBAAoB,YAAY,qBAAqB,iCAAiC;AAC5G,oBAAQ,kBAAkB,gBAAgB,EAAE,SAAS,UAAS,CAAE;AAChE,gBAAI,SAAS;AACT,sBAAQ,SAAS,SAAS;;iBAE3B;AAEH,mBAAO,KAAK,kBAAkB,GAAG,qBAAqB,WAAW,EAAE;AACnE,iBAAK,mBACD,aACA,UACA,QAAQ,SACR,OACA,cACA,QACA,SACA,gBACA,+BACA,QACA,SACA,QACA,iBACA,UACA,eACA,aAAa;;QAGzB;AAGA,YAAI,QAAQ;AACR,gBAAM,WAAW,CAAC,SAAyB;AACvC,mBAAQ,SACJ,MACA,SACA,CAAC,OAAe,QAAgB,YAAqB,cAAuB,MAAkB,eAAc;AACxG,kBAAI,YAAY;AACZ,gCAAgB,mCAAmC;qBAChD;AACH,+BACI,SACA,WACA,OACA,EAAE,OAAO,OAAM,GACf,QAAQ,SACR,CAAC,YACD,cACA,MAAK;AACD,uBAAI;AACJ,yBAAO;gBACX,GACA,YAAY;;YAGxB,GACA,aAAa;UAErB;AAEA,cAAI,CAAC,QAAQ;AACT,iBAAK,UACD,KACA,CAAC,SAAS,SAAS,IAAI,WAAW,IAAmB,CAAC,GACtD,QACA,QAAQ,MAAM,kBAAkB,QAChC,MACA,CAAC,SAAuB,cAAmB;AACvC,8BAAgB,qBAAqB,UAAU,QAAQ,cAAc,KAAK,UAAU;YACxF,CAAC;iBAEF;AACH,gBAAI,kBAAkB,aAAa;AAC/B,uBAAS,IAAI,WAAW,MAAM,CAAC;uBACxB,YAAY,OAAO,MAAM,GAAG;AACnC,uBAAS,MAAM;mBACZ;AACH,kBAAI,SAAS;AACT,wBAAQ,oEAAoE,IAAI;;;;eAIzF;AACH,gBAAM,SAAS,CAAC,QAAuC;AACnD,gBAAI,YAAY,CAAC,KAAK,yBAAyB;AAG3C,sBAAQ,UAAU;;AAGtB,2BAAe,SAAS,WAAW,OAAO,KAAK,QAAQ,SAAS,UAAU,OAAO,+BAA+B,YAAY;UAChI;AAIA,cAAI,CAAC,YAAY,UAAU;AACvB,gBAAI,WAAW,OAA0B,OAAQ,aAAa,YAA0B,OAAQ,QAAQ;AACpG,qBAAyB,MAAM;mBAC5B;AACH,0BAAW,oBACP,KACA,QACA,iBACA,QAAQ,MAAM,kBAAkB,MAChC,UACA,QAAQ,WAAW,KAAK,UAAU,uBAAuB,EAAE,kBAAkB,QAAO,IAAK,MAAS;;qBAGnG,OAAO,WAAW,YAAY,kBAAkB,eAAe,YAAY,OAAO,MAAM,KAAK,kBAAkB,MAAM;AAC5H,wBAAW,oBACP,QACA,QACA,iBACA,QAAQ,MAAM,kBAAkB,MAChC,UACA,QAAQ,WAAW,KAAK,UAAU,uBAAuB,EAAE,kBAAkB,QAAO,IAAK,MAAS;qBAE/F,QAAQ;AACf,mBAAO,MAAM;;;AAIrB,eAAO;MACX;;;;;;;;;;;;;;;;;;;;;;;;MAyBO,cACH,KACA,UACA,SACA,OACA,eAAuB,GAAA,SAAU,MAAA,UAAA,MAAA,SACjC,MAAA,WACA,MAAA,SACA,MAAA,kBACsC,MACtC,UAA2B,eAC3B,eACA,eACA;AAIA,eAAO,KAAK,mBACR,KACA,UACA,SACA,OACA,cACA,QACA,SACA,KAAK,qBAAqB,KAAK,IAAI,GACnC,CAAC,UAAU,WAAW,KAAK,WAAW,SAAS,yBAAwB;AACnE,gBAAM,KAAK,KAAK;AAChB,gBAAM,QAAQ,IAAI,UAAU,YAAY,IAAI,WAAW;AAEvD,kBAAQ,iBAAiB,iBAAiB;AAE1C,gBAAM,MAAM,KAAK,uCAAuC,QAAQ,WAAW,QAAQ,cAAc;AACjG,cAAI,OAAO;AACP,eAAG,WAAW,GAAG,YAAY,GAAG,IAAI,gBAAgB,IAAI,QAAQ,IAAI,MAAM,GAAU;AACpF,mBAAO;;AAGX,gBAAM,iBAAiB,KAAK,MAAM;AAElC,cAAI,IAAI,QAAQ,kBAAkB,IAAI,SAAS,kBAAkB,CAAC,KAAK,mCAAmC;AACtG,iBAAK,sBAAqB;AAC1B,gBAAI,CAAC,KAAK,kBAAkB,CAAC,KAAK,iBAAiB;AAC/C,qBAAO;;AAGX,iBAAK,eAAe,QAAQ;AAC5B,iBAAK,eAAe,SAAS;AAE7B,iBAAK,gBAAgB,UAAU,KAAY,GAAG,GAAG,IAAI,OAAO,IAAI,QAAQ,GAAG,GAAG,UAAU,SAAS;AACjG,eAAG,WAAW,GAAG,YAAY,GAAG,IAAI,gBAAgB,IAAI,QAAQ,IAAI,MAAM,KAAK,cAAgC;AAE/G,oBAAQ,QAAQ;AAChB,oBAAQ,SAAS;AAEjB,mBAAO;iBACJ;AAEH,kBAAM,SAAS,IAAI,gBAAgB,MAAM,sBAAsB,IAAI;AACnE,iBAAK,qBAAqB,GAAG,YAAY,QAAQ,IAAI;AACrD,eAAG,WAAW,GAAG,YAAY,GAAG,IAAI,gBAAgB,IAAI,QAAQ,IAAI,MAAM,GAAU;AAEpF,iBAAK,gBAAgB,QAAQ,SAAS,OAAO,IAAI,QAAQ,MAAK;AAC1D,mBAAK,gBAAgB,MAAM;AAC3B,mBAAK,qBAAqB,GAAG,YAAY,SAAS,IAAI;AAEtD,mCAAoB;YACxB,CAAC;;AAGL,iBAAO;QACX,GACA,QACA,UACA,QACA,iBACA,UACA,eACA,aAAa;MAErB;;;;;;;;;;;MAYO,uCAAuC,eAAiC,eAAuB,eAAsB;AACxH,YAAI,kBAAkB,UAAa,kBAAkB,MAAM;AACvD,0BAAgB,kBAAkB,UAAU,CAAC,gBAAgB,IAAA;;AAGjE,YAAI,QAAgB;AACpB,YAAI,KAAK,iBAAiB,GAAG;AAIzB,mBAAS,KAAK,mBAAmB,eAAe,aAAa;AAC7D,2BAAiB;eACd;AAIH,mBAAS,KAAK,mBAAmB,eAAe,KAAK;AACrD,2BAAiB,KAAK,kCAAkC,GAAA,eAAU,aAAA;;AAGtE,eAAO;UACH;UACA;UACA,MAAM,KAAK,IAAI;;MAEvB;;;;;;;;;;;;MAaO,OAAO,oBACV,OACA,QACA,SACA,iBACA,UACA,oBAAuC;AAEvC,cAAM,YAAY,WAAW;MACjC;;;;MAKO,gBAAgB,QAAyB,aAA8B,OAAsB,gBAAwB,YAAsB;MAAS;;;;;;;;;;;;;;;;;MAkBpJ,iBACH,MACA,OACA,QACA,QACA,iBACA,SACA,cACA,cAAgC,MAChC,OAAe,GAAA,gBAAU,GAAA,gBACzB,OAAA;AAGA,cAAM,YAAY,mBAAmB;MACzC;;;;;;;;;;;;;;MAeO,qBACH,MACA,MACA,QACA,MACA,iBACA,SACA,cACA,cAAgC,MAAI;AAEpC,cAAM,YAAY,mBAAmB;MACzC;;;;;;;;;;;;;;;;MAiBO,mBACH,MACA,OACA,QACA,OACA,QACA,iBACA,SACA,cACA,cAAgC,MAChC,cAAc,GAAA;AAEd,cAAM,YAAY,mBAAmB;MACzC;;;;;;;;;;;;;;;;MAiBO,wBACH,MACA,OACA,QACA,OACA,QACA,iBACA,SACA,cACA,cAAgC,MAChC,cAAc,GAAA;AAEd,cAAM,YAAY,mBAAmB;MACzC;;;;MAcO,aAAa,OAAc;AAC9B,YAAI,KAAK,uBAAuB,OAAO;AACnC,eAAK,IAAI,YAAY,KAAK,IAAI,qBAAqB,QAAQ,IAAI,CAAC;AAEhE,cAAI,KAAK,yBAAyB;AAC9B,iBAAK,qBAAqB;;;MAGtC;;MAGO,uBAAoB;AACvB,eAAO,KAAK,IAAI,aAAa,KAAK,IAAI,gBAAgB;MAC1D;MAEQ,kBAAkB,SAAwB;AAC9C,YAAI,QAAQ,QAAQ;AAChB,iBAAO,KAAK,IAAI;mBACT,QAAQ,MAAM;AACrB,iBAAO,KAAK,IAAI;mBACT,QAAQ,aAAa,QAAQ,aAAa;AACjD,iBAAO,KAAK,IAAI;;AAEpB,eAAO,KAAK,IAAI;MACpB;;;;;;;MAQO,0BAA0B,cAAsB,SAA0B,kBAA2B,OAAK;AAC7G,cAAM,SAAS,KAAK,kBAAkB,OAAO;AAC7C,cAAM,UAAU,KAAK,uBAAuB,cAAc,QAAQ,cAAc,eAAe;AAE/F,aAAK,4BAA4B,QAAQ,KAAK,IAAI,oBAAoB,QAAQ,KAAK,OAAO;AAC1F,aAAK,4BAA4B,QAAQ,KAAK,IAAI,oBAAoB,QAAQ,GAAG;AAEjF,YAAI,iBAAiB;AACjB,kBAAQ,kBAAkB;AAC1B,eAAK,IAAI,eAAe,MAAM;;AAGlC,aAAK,qBAAqB,QAAQ,IAAI;AAEtC,gBAAQ,eAAe;MAC3B;;;;;;;;MASO,wBAAwB,SAA0B,OAAe,QAAgB,QAAgB,GAAC;MAAS;;;;;;;;MAS3G,0BAA0B,SAA0B,OAAyB,QAA0B,MAAM,QAA0B,MAAI;AAC9I,cAAM,SAAS,KAAK,kBAAkB,OAAO;AAE7C,YAAI,UAAU,MAAM;AAChB,eAAK,4BAA4B,QAAQ,KAAK,IAAI,gBAAgB,KAAK,oBAAoB,KAAK,GAAG,OAAO;AAC1G,kBAAQ,eAAe;;AAE3B,YAAI,UAAU,MAAM;AAChB,eAAK,4BAA4B,QAAQ,KAAK,IAAI,gBAAgB,KAAK,oBAAoB,KAAK,GAAG,OAAO;AAC1G,kBAAQ,eAAe;;AAE3B,aAAK,QAAQ,aAAa,QAAQ,SAAS,UAAU,MAAM;AACvD,eAAK,4BAA4B,QAAQ,KAAK,IAAI,gBAAgB,KAAK,oBAAoB,KAAK,GAAG,OAAO;AAC1G,kBAAQ,eAAe;;AAG3B,aAAK,qBAAqB,QAAQ,IAAI;MAC1C;;;;MAKO,0BACH,iBACA,MACA,iBACA,mBACA,oBACA,UAAU,GAAC;AAEX,cAAM,QAA6D,KAAM,SAAiB;AAC1F,cAAM,SAA8D,KAAM,UAAkB;AAC5F,cAAM,SAA8D,KAAM,UAAU;AAEpF,wBAAgB,YAAY;AAC5B,wBAAgB,aAAa;AAC7B,wBAAgB,QAAQ;AACxB,wBAAgB,SAAS;AACzB,wBAAgB,YAAY,SAAS;AACrC,wBAAgB,QAAQ;AACxB,wBAAgB,UAAU;AAC1B,wBAAgB,UAAU;AAC1B,wBAAgB,kBAAkB;AAClC,wBAAgB,eAAe,oBAAoB,IAAA;AACnD,wBAAgB,OAAO;AACvB,wBAAgB,sBAAsB;AAEtC,cAAM,KAAK,KAAK;AAChB,cAAM,SAAS,KAAK,kBAAkB,eAAe;AACrD,cAAM,qBAAqB,KAAK,uBAAuB,gBAAgB,cAAc,KAAK;AAC1F,WAAG,cAAc,QAAQ,GAAG,oBAAoB,mBAAmB,GAAG;AACtE,WAAG,cAAc,QAAQ,GAAG,oBAAoB,mBAAmB,GAAG;AACtE,WAAG,cAAc,QAAQ,GAAG,gBAAgB,GAAG,aAAa;AAC5D,WAAG,cAAc,QAAQ,GAAG,gBAAgB,GAAG,aAAa;AAG5D,YAAI,KAAK,eAAe,GAAG;AACvB,cAAI,uBAAuB,GAAG;AAC1B,eAAG,cAAc,QAAQ,GAAG,sBAAsB,GAAA;AAClD,eAAG,cAAc,QAAQ,GAAG,sBAAsB,GAAG,IAAI;iBACtD;AACH,eAAG,cAAc,QAAQ,GAAG,sBAAsB,kBAAkB;AACpE,eAAG,cAAc,QAAQ,GAAG,sBAAsB,GAAG,sBAAsB;;;MAGvF;;;;MAKO,uCACH,SACA,gBACA,OACA,QACA,MACA,YAAoB,GACpB,MAAc,GAAC;AAEf,cAAM,KAAK,KAAK;AAEhB,YAAI,SAAiB,GAAG;AACxB,YAAI,QAAQ,QAAQ;AAChB,mBAAS,GAAG,8BAA8B;;AAG9C,YAAI,QAAQ,gBAAgB;AACxB,kBAAQ,gBAAgB;YACpB,KAAK;YACL,KAAK;AAED,kBAAI,KAAK,MAAM,MAAM;AACjB,iCAAiB,GAAG;qBACjB;AACH,wBAAQ,iBAAiB;;AAE7B;YACJ,KAAK;AACD,kBAAI,KAAK,MAAM,MAAM;AACjB,iCAAiB,GAAG;qBACjB;AACH,wBAAQ,iBAAiB;;AAE7B;YACJ,KAAK;AACD,+BAAiB,GAAG;AACpB;YACJ,KAAK;AACD,+BAAiB,GAAG;AACpB;YACJ,KAAK;AACD,kBAAI,KAAK,MAAM,WAAW;AACtB,iCAAiB,GAAG;qBACjB;AAEH,wBAAQ,iBAAiB;;AAE7B;YACJ,KAAK;AACD,kBAAI,KAAK,MAAM,WAAW;AACtB,iCAAiB,GAAG;qBACjB;AAEH,wBAAQ,iBAAiB;;AAE7B;YACJ,KAAK;AACD,kBAAI,KAAK,MAAM,WAAW;AACtB,iCAAiB,GAAG;qBACjB;AAEH,wBAAQ,iBAAiB;;AAE7B;YACJ;AAEI,sBAAQ,iBAAiB;AACzB;;;AAIZ,aAAK,IAAI,qBAAqB,QAAQ,KAAK,gBAAgB,OAAO,QAAQ,GAAa,IAAI;MAC/F;;;;MAKO,6BACH,SACA,WACA,YAAoB,GACpB,MAAc,GACd,uBACA,2BAA2B,OAAK;AAEhC,cAAM,KAAK,KAAK;AAEhB,cAAM,cAAc,KAAK,qBAAqB,QAAQ,IAAI;AAC1D,cAAM,SAAS,KAAK,mBAAmB,QAAQ,MAAM;AACrD,cAAM,iBACF,0BAA0B,SACpB,KAAK,kCAAkC,QAAQ,MAAM,QAAQ,QAAQ,QAAQ,cAAc,IAC3F,KAAK,mBAAmB,uBAAuB,QAAQ,cAAc;AAE/E,aAAK,aAAa,QAAQ,OAAO;AAEjC,YAAI,SAAiB,GAAG;AACxB,YAAI,QAAQ,QAAQ;AAChB,mBAAS,GAAG,8BAA8B;;AAG9C,cAAM,cAAc,KAAK,MAAM,KAAK,IAAI,QAAQ,KAAK,IAAI,KAAK,KAAK;AACnE,cAAM,eAAe,KAAK,MAAM,KAAK,IAAI,QAAQ,MAAM,IAAI,KAAK,KAAK;AACrE,cAAM,QAAQ,2BAA2B,QAAQ,QAAQ,KAAK,IAAI,GAAG,KAAK,IAAI,cAAc,KAAK,CAAC,CAAC;AACnG,cAAM,SAAS,2BAA2B,QAAQ,SAAS,KAAK,IAAI,GAAG,KAAK,IAAI,eAAe,KAAK,CAAC,CAAC;AAEtG,WAAG,WAAW,QAAQ,KAAK,gBAAgB,OAAO,QAAQ,GAAG,QAAQ,aAAa,SAAS;MAC/F;;;;;;;;;;;;;MAcO,kBACH,SACA,WACA,SACA,SACA,OACA,QACA,YAAoB,GACpB,MAAc,GACd,kBAAkB,OAAK;AAEvB,cAAM,KAAK,KAAK;AAEhB,cAAM,cAAc,KAAK,qBAAqB,QAAQ,IAAI;AAC1D,cAAM,SAAS,KAAK,mBAAmB,QAAQ,MAAM;AAErD,aAAK,aAAa,QAAQ,OAAO;AAEjC,YAAI,mBAA2B,GAAG;AAClC,YAAI,SAAiB,GAAG;AACxB,YAAI,QAAQ,QAAQ;AAChB,mBAAS,GAAG,8BAA8B;AAC1C,6BAAmB,GAAG;;AAG1B,aAAK,qBAAqB,kBAAkB,SAAS,IAAI;AAEzD,WAAG,cAAc,QAAQ,KAAK,SAAS,SAAS,OAAO,QAAQ,QAAQ,aAAa,SAAS;AAE7F,YAAI,iBAAiB;AACjB,eAAK,IAAI,eAAe,MAAM;;AAGlC,aAAK,qBAAqB,kBAAkB,IAAI;MACpD;;;;MAKO,gCAAgC,SAA0B,WAA4B,YAAoB,GAAG,MAAc,GAAC;AAC/H,cAAM,KAAK,KAAK;AAChB,cAAM,aAAa,QAAQ,SAAS,GAAG,mBAAmB,GAAG;AAE7D,aAAK,qBAAqB,YAAY,SAAS,IAAI;AAEnD,aAAK,6BAA6B,SAAS,WAAW,WAAW,GAAG;AAEpE,aAAK,qBAAqB,YAAY,MAAM,IAAI;MACpD;MAEU,iCAAiC,SAA0B,OAA6B,UAAmB,cAAuB,cAAoB;AAC5J,cAAM,KAAK,KAAK;AAChB,YAAI,CAAC,IAAI;AACL;;AAGJ,cAAM,UAAU,KAAK,uBAAuB,cAAc,CAAC,QAAQ;AAEnE,WAAG,cAAc,GAAG,YAAY,GAAG,oBAAoB,QAAQ,GAAG;AAClE,WAAG,cAAc,GAAG,YAAY,GAAG,oBAAoB,QAAQ,GAAG;AAElE,YAAI,CAAC,YAAY,CAAC,cAAc;AAC5B,aAAG,eAAe,GAAG,UAAU;;AAGnC,aAAK,qBAAqB,GAAG,YAAY,IAAI;AAG7C,YAAI,OAAO;AACP,gBAAM,kBAAkB,OAAO;;AAGnC,gBAAQ,mBAAmB,gBAAgB,OAAO;AAClD,gBAAQ,mBAAmB,MAAK;MACpC;MAEQ,qBACJ,SACA,WACA,OACA,KACA,SACA,UACA,cACA,iBAQA,eAAuB,GAAA;AAEvB,cAAM,iBAAiB,KAAK,QAAO,EAAG;AACtC,cAAM,WAAW,KAAK,IAAI,gBAAgB,KAAK,kBAAkB,YAAW,iBAAiB,IAAI,OAAO,cAAc,IAAI,IAAI,KAAK;AACnI,cAAM,YAAY,KAAK,IAAI,gBAAgB,KAAK,kBAAkB,YAAW,iBAAiB,IAAI,QAAQ,cAAc,IAAI,IAAI,MAAM;AAEtI,cAAM,KAAK,KAAK;AAChB,YAAI,CAAC,IAAI;AACL;;AAGJ,YAAI,CAAC,QAAQ,kBAAkB;AAE3B,cAAI,OAAO;AACP,kBAAM,kBAAkB,OAAO;;AAGnC;;AAGJ,aAAK,qBAAqB,GAAG,YAAY,SAAS,IAAI;AACtD,aAAK,aAAa,YAAY,SAAY,OAAO,UAAU,OAAO,KAAK;AAEvE,gBAAQ,YAAY,IAAI;AACxB,gBAAQ,aAAa,IAAI;AACzB,gBAAQ,QAAQ;AAChB,gBAAQ,SAAS;AACjB,gBAAQ,UAAU;AAClB,gBAAQ,OAAO,QAAQ,SAAS,KAAK,QAAQ,OAAO;AACpD,gBAAQ,SAAS,QAAQ,WAAW,KAAK,QAAQ,SAAS,cAAc,UAAU,CAAC,QAAQ,iBAAiB,IAAA;AAE5G,YACI,gBAAgB,UAAU,WAAW,KAAK,WAAW,SAAS,MAAK;AAC/D,eAAK,iCAAiC,SAAS,OAAO,UAAU,cAAc,YAAY;QAC9F,CAAC,GACH;AAEE;;AAGJ,aAAK,iCAAiC,SAAS,OAAO,UAAU,cAAc,YAAY;MAC9F;;;;MAKO,kCACH,uBACA,qBACA,OACA,QACA,UAAU,GAAC;AAEX,cAAM,KAAK,KAAK;AAGhB,YAAI,yBAAyB,qBAAqB;AAC9C,iBAAO,KAAK,oBAAoB,OAAO,QAAQ,SAAS,GAAG,eAAe,GAAG,kBAAkB,GAAG,wBAAwB;;AAE9H,YAAI,qBAAqB;AACrB,cAAI,cAAsB,GAAG;AAC7B,cAAI,KAAK,gBAAgB,GAAG;AACxB,0BAAc,GAAG;;AAGrB,iBAAO,KAAK,oBAAoB,OAAO,QAAQ,SAAS,aAAa,aAAa,GAAG,gBAAgB;;AAEzG,YAAI,uBAAuB;AACvB,iBAAO,KAAK,oBAAoB,OAAO,QAAQ,SAAS,GAAG,gBAAgB,GAAG,gBAAgB,GAAG,kBAAkB;;AAGvH,eAAO;MACX;;;;MAKO,oBACH,OACA,QACA,SACA,gBACA,kBACA,YACA,eAAe,MAAI;AAEnB,cAAM,KAAK,KAAK;AAChB,cAAM,eAAe,GAAG,mBAAkB;AAC1C,eAAO,KAAK,oBAAoB,cAAc,OAAO,QAAQ,SAAS,gBAAgB,kBAAkB,YAAY,YAAY;MACpI;MAEO,oBACH,cACA,OACA,QACA,SACA,gBACA,kBACA,YACA,eAAe,MAAI;AAEnB,cAAM,KAAK,KAAK;AAEhB,WAAG,iBAAiB,GAAG,cAAc,YAAY;AAEjD,YAAI,UAAU,KAAK,GAAG,gCAAgC;AAClD,aAAG,+BAA+B,GAAG,cAAc,SAAS,kBAAkB,OAAO,MAAM;eACxF;AACH,aAAG,oBAAoB,GAAG,cAAc,gBAAgB,OAAO,MAAM;;AAGzE,WAAG,wBAAwB,GAAG,aAAa,YAAY,GAAG,cAAc,YAAY;AAEpF,YAAI,cAAc;AACd,aAAG,iBAAiB,GAAG,cAAc,IAAI;;AAG7C,eAAO;MACX;;;;MAKO,gBAAgB,SAAwB;AA9gKnD;AA+gKQ,aAAK,gBAAe,aAAQ,qBAAR,mBAA0B,kBAAkB;AAGhE,aAAK,kBAAiB;AAEtB,cAAM,QAAQ,KAAK,uBAAuB,QAAQ,OAAO;AACzD,YAAI,UAAU,IAAI;AACd,eAAK,uBAAuB,OAAO,OAAO,CAAC;;AAI/C,YAAI,QAAQ,iBAAiB;AACzB,kBAAQ,gBAAgB,QAAO;;AAEnC,YAAI,QAAQ,gBAAgB;AACxB,kBAAQ,eAAe,QAAO;;AAElC,YAAI,QAAQ,gBAAgB;AACxB,kBAAQ,eAAe,QAAO;;AAIlC,YAAI,QAAQ,oBAAoB;AAC5B,kBAAQ,mBAAmB,QAAO;;MAE1C;;;;MAKO,4BAA4B,WAA8B;AAC7D,cAAM,QAAQ,KAAK,0BAA0B,QAAQ,SAAS;AAC9D,YAAI,UAAU,IAAI;AACd,eAAK,0BAA0B,OAAO,OAAO,CAAC;;MAEtD;MAEU,eAAe,SAA+B;AACpD,YAAI,SAAS;AACT,eAAK,IAAI,cAAc,OAAO;;MAEtC;MAEU,YAAY,SAAqB;AACvC,YAAI,KAAK,oBAAoB,SAAS;AAClC,eAAK,IAAI,WAAW,OAAO;AAC3B,eAAK,kBAAkB;;MAE/B;;;;;MAQO,aAAa,QAAc;AAC9B,cAAM,uBAAuB,OAAO,mBAAkB;AACtD,aAAK,YAAY,qBAAqB,OAAQ;AAC9C,cAAM,WAAW,OAAO,YAAW;AACnC,iBAAS,QAAQ,GAAG,QAAQ,SAAS,QAAQ,SAAS;AAClD,gBAAM,UAAU,OAAO,WAAW,SAAS,KAAK,CAAC;AAEjD,cAAI,SAAS;AACT,iBAAK,eAAe,KAAK,IAAI;;;AAGrC,aAAK,iBAAiB;MAC1B;MAEQ,0BAAuB;AAC3B,YAAI,KAAK,2BAA2B,KAAK,gBAAgB;AACrD,eAAK,IAAI,cAAc,KAAK,IAAI,WAAW,KAAK,cAAc;AAC9D,eAAK,yBAAyB,KAAK;;MAE3C;;;;MAKO,qBAAqB,QAAgB,SAAoC,uBAAuB,OAAO,QAAQ,OAAK;AA/lK/H;AAgmKQ,YAAI,qBAAqB;AACzB,cAAM,wBAAwB,WAAW,QAAQ,qBAAqB;AACtE,YAAI,wBAAwB,uBAAuB;AAC/C,eAAK,iBAAiB,QAAS;;AAGnC,cAAM,sBAAsB,KAAK,oBAAoB,KAAK,cAAc;AAExE,YAAI,wBAAwB,WAAW,OAAO;AAC1C,eAAK,wBAAuB;AAE5B,cAAI,WAAW,QAAQ,aAAa;AAEhC,mBAAO,MAAM,CAAC,yDAAyD,QAAQ,OAAO,CAAC;AAEvF,kBAAM;iBACH;AACH,iBAAK,IAAI,YAAY,UAAQ,wCAAS,qBAAT,mBAA2B,uBAAsB,IAAI;;AAGtF,eAAK,oBAAoB,KAAK,cAAc,IAAI;AAEhD,cAAI,SAAS;AACT,oBAAQ,qBAAqB,KAAK;;mBAE/B,sBAAsB;AAC7B,+BAAqB;AACrB,eAAK,wBAAuB;;AAGhC,YAAI,yBAAyB,CAAC,sBAAsB;AAChD,eAAK,6BAA6B,QAAS,oBAAoB,KAAK,cAAc;;AAGtF,eAAO;MACX;;;;MAKO,aAAa,SAAiB,SAAoC,MAAY;AACjF,YAAI,YAAY,QAAW;AACvB;;AAGJ,YAAI,SAAS;AACT,kBAAQ,qBAAqB;;AAGjC,aAAK,iBAAiB;AACtB,cAAM,SAAS,UAAU,KAAK,kBAAkB,OAAO,IAAI,KAAK,IAAI;AACpE,aAAK,qBAAqB,QAAQ,OAAO;MAC7C;;;;MAKO,oBAAiB;AACpB,iBAAS,UAAU,GAAG,UAAU,KAAK,0BAA0B,WAAW;AACtE,eAAK,iBAAiB;AACtB,eAAK,qBAAqB,KAAK,IAAI,YAAY,IAAI;AACnD,eAAK,qBAAqB,KAAK,IAAI,kBAAkB,IAAI;AACzD,cAAI,KAAK,eAAe,GAAG;AACvB,iBAAK,qBAAqB,KAAK,IAAI,YAAY,IAAI;AACnD,iBAAK,qBAAqB,KAAK,IAAI,kBAAkB,IAAI;;;MAGrE;;;;;;;;MASO,WAAW,SAAiB,SAAyC,SAAgC,MAAY;AACpH,YAAI,YAAY,QAAW;AACvB;;AAGJ,YAAI,SAAS;AACT,eAAK,eAAe,OAAO,IAAI;;AAGnC,aAAK,YAAY,SAAS,OAAO;MACrC;MAEQ,6BAA6B,YAAoB,aAAmB;AACxE,cAAM,UAAU,KAAK,eAAe,UAAU;AAC9C,YAAI,CAAC,WAAW,QAAQ,kBAAkB,aAAa;AACnD;;AAEJ,aAAK,IAAI,UAAU,SAAS,WAAW;AACvC,gBAAQ,gBAAgB;MAC5B;MAEQ,oBAAoB,MAAY;AACpC,gBAAQ,MAAM;UACV,KAAK;AACD,mBAAO,KAAK,IAAI;UACpB,KAAK;AACD,mBAAO,KAAK,IAAI;UACpB,KAAK;AACD,mBAAO,KAAK,IAAI;;AAExB,eAAO,KAAK,IAAI;MACpB;MAEU,YAAY,SAAiB,SAAgC,uBAAuB,OAAO,sBAAsB,OAAO,OAAO,IAAE;AAEvI,YAAI,CAAC,SAAS;AACV,cAAI,KAAK,oBAAoB,OAAO,KAAK,MAAM;AAC3C,iBAAK,iBAAiB;AACtB,iBAAK,qBAAqB,KAAK,IAAI,YAAY,IAAI;AACnD,iBAAK,qBAAqB,KAAK,IAAI,kBAAkB,IAAI;AACzD,gBAAI,KAAK,eAAe,GAAG;AACvB,mBAAK,qBAAqB,KAAK,IAAI,YAAY,IAAI;AACnD,mBAAK,qBAAqB,KAAK,IAAI,kBAAkB,IAAI;;;AAGjE,iBAAO;;AAIX,YAAmB,QAAS,OAAO;AAC/B,eAAK,iBAAiB;AACtB,gBAAM,uBAAsC,QAAS,mBAAkB;AACvE,cAAI,sBAAsB;AACtB,iCAAqB,qBAAqB;;AAE/B,kBAAS,OAAM;mBACvB,QAAQ,mBAAmB,GAAA;AAElC,kBAAQ,UAAS;AACjB,iBAAO;;AAGX,YAAI;AACJ,YAAI,qBAAqB;AACrB,4BAAwC,QAAS;mBAC1C,QAAQ,QAAO,GAAI;AAC1B,4BAAmC,QAAQ,mBAAkB;mBACtD,QAAQ,QAAQ;AACvB,4BAAkB,KAAK;mBAChB,QAAQ,MAAM;AACrB,4BAAkB,KAAK;mBAChB,QAAQ,WAAW;AAC1B,4BAAkB,KAAK;eACpB;AACH,4BAAkB,KAAK;;AAG3B,YAAI,CAAC,wBAAwB,iBAAiB;AAC1C,0BAAgB,qBAAqB;;AAGzC,YAAI,aAAa;AACjB,YAAI,KAAK,oBAAoB,OAAO,MAAM,iBAAiB;AACvD,cAAI,CAAC,sBAAsB;AACvB,iBAAK,6BAA6B,gBAAgB,oBAAoB,OAAO;;AAGjF,uBAAa;;AAGjB,aAAK,iBAAiB;AACtB,cAAM,SAAS,KAAK,kBAAkB,eAAe;AACrD,YAAI,YAAY;AACZ,eAAK,qBAAqB,QAAQ,iBAAiB,oBAAoB;;AAG3E,YAAI,mBAAmB,CAAC,gBAAgB,aAAa;AAEjD,cAAI,gBAAgB,UAAU,gBAAgB,2BAA2B,QAAQ,iBAAiB;AAC9F,4BAAgB,yBAAyB,QAAQ;AAEjD,kBAAM,kBACF,QAAQ,oBAAoB,KAAA,QAAU,oBAAsB,IACtD,IACA;AACV,oBAAQ,QAAQ;AAChB,oBAAQ,QAAQ;;AAGpB,cAAI,gBAAgB,iBAAiB,QAAQ,OAAO;AAChD,4BAAgB,eAAe,QAAQ;AACvC,iBAAK,4BAA4B,QAAQ,KAAK,IAAI,gBAAgB,KAAK,oBAAoB,QAAQ,KAAK,GAAG,eAAe;;AAG9H,cAAI,gBAAgB,iBAAiB,QAAQ,OAAO;AAChD,4BAAgB,eAAe,QAAQ;AACvC,iBAAK,4BAA4B,QAAQ,KAAK,IAAI,gBAAgB,KAAK,oBAAoB,QAAQ,KAAK,GAAG,eAAe;;AAG9H,cAAI,gBAAgB,QAAQ,gBAAgB,iBAAiB,QAAQ,OAAO;AACxE,4BAAgB,eAAe,QAAQ;AACvC,iBAAK,4BAA4B,QAAQ,KAAK,IAAI,gBAAgB,KAAK,oBAAoB,QAAQ,KAAK,GAAG,eAAe;;AAG9H,eAAK,qBAAqB,QAAQ,iBAAiB,QAAQ,yBAAyB;;AAGxF,eAAO;MACX;;;;;;;;MASO,gBAAgB,SAAiB,SAAyC,UAAyB,MAAY;AAClH,YAAI,YAAY,UAAa,CAAC,SAAS;AACnC;;AAGJ,YAAI,CAAC,KAAK,iBAAiB,KAAK,cAAc,WAAW,SAAS,QAAQ;AACtE,eAAK,gBAAgB,IAAI,WAAW,SAAS,MAAM;;AAEvD,iBAAS,IAAI,GAAG,IAAI,SAAS,QAAQ,KAAK;AACtC,gBAAM,UAAU,SAAS,CAAC,EAAE,mBAAkB;AAE9C,cAAI,SAAS;AACT,iBAAK,cAAc,CAAC,IAAI,UAAU;AAClC,oBAAQ,qBAAqB,UAAU;iBACpC;AACH,iBAAK,cAAc,CAAC,IAAI;;;AAGhC,aAAK,IAAI,WAAW,SAAS,KAAK,aAAa;AAE/C,iBAAS,QAAQ,GAAG,QAAQ,SAAS,QAAQ,SAAS;AAClD,eAAK,YAAY,KAAK,cAAc,KAAK,GAAG,SAAS,KAAK,GAAG,IAAI;;MAEzE;;;;MAKO,qBAAqB,QAAgB,iBAAkC,2BAAiC;AAC3G,cAAM,6BAA6B,KAAK,MAAM;AAC9C,YACI,gBAAgB,iBAAiB,MACjC,gBAAgB,iBAAiB,KACjC,gBAAgB,iBAAiB,GAAA;AAEjC,sCAA4B;;AAGhC,YAAI,8BAA8B,gBAAgB,qCAAqC,2BAA2B;AAC9G,eAAK,0BACD,QACA,2BAA2B,4BAC3B,KAAK,IAAI,2BAA2B,KAAK,MAAM,aAAa,GAC5D,eAAe;AAEnB,0BAAgB,mCAAmC;;MAE3D;MAEQ,0BAA0B,QAAgB,WAAmB,OAAe,SAAwB;AACxG,aAAK,qBAAqB,QAAQ,SAAS,MAAM,IAAI;AACrD,aAAK,IAAI,cAAc,QAAQ,WAAW,KAAK;MACnD;MAEQ,4BAA4B,QAAgB,WAAmB,OAAe,SAAyB;AAC3G,YAAI,SAAS;AACT,eAAK,qBAAqB,QAAQ,SAAS,MAAM,IAAI;;AAEzD,aAAK,IAAI,cAAc,QAAQ,WAAW,KAAK;MACnD;;;;MAKO,sBAAmB;AACtB,YAAI,KAAK,2BAA2B;AAChC,eAAK,4BAA4B;AAEjC,mBAAS,IAAI,GAAG,IAAI,KAAK,MAAM,kBAAkB,KAAK;AAClD,iBAAK,wBAAwB,CAAC;;AAElC;;AAGJ,iBAAS,IAAI,GAAG,KAAK,KAAK,2BAA2B,QAAQ,IAAI,IAAI,KAAK;AACtE,cAAI,KAAK,KAAK,MAAM,oBAAoB,CAAC,KAAK,2BAA2B,CAAC,GAAG;AACzE;;AAGJ,eAAK,wBAAwB,CAAC;;MAEtC;;;;MAKO,iBAAc;AACjB,mBAAW,QAAQ,KAAK,kBAAkB;AACtC,gBAAM,uBAAuB,KAAK,iBAAiB,IAAI,EAAE,mBAAkB;AAC3E,eAAK,uBAAuB,oBAAoB;;AAGpD,aAAK,mBAAmB,CAAA;MAC5B;;;;MAKO,UAAO;AAv5KlB;AAw5KQ,aAAK,cAAc;AACnB,aAAK,eAAc;AAGnB,YAAI,KAAK,+BAA+B;AACpC,eAAK,8BAA8B,MAAK;;AAI5C,YAAI,KAAK,eAAe;AACpB,eAAK,gBAAgB,KAAK,aAAa;AACvC,eAAK,gBAAgB;;AAEzB,YAAI,KAAK,mBAAmB;AACxB,eAAK,gBAAgB,KAAK,iBAAiB;AAC3C,eAAK,oBAAoB;;AAG7B,YAAI,KAAK,mBAAmB;AACxB,eAAK,IAAI,kBAAkB,KAAK,iBAAiB;;AAIrD,aAAK,eAAc;AACnB,mBAAK,0BAAL;AAGA,aAAK,oBAAmB;AACxB,aAAK,iBAAiB,CAAA;AAGtB,YAAI,oBAAmB,GAAI;AACvB,cAAI,KAAK,kBAAkB;AACvB,gBAAI,CAAC,KAAK,yBAAyB;AAC/B,mBAAK,iBAAiB,oBAAoB,oBAAoB,KAAK,cAAc;AACjF,mBAAK,iBAAiB,oBAAoB,wBAAwB,KAAK,kBAAkB;;AAG7F,mBAAO,oBAAoB,UAAU,KAAK,eAAe;;;AAIjE,aAAK,iBAAiB;AACtB,aAAK,kBAAkB;AACvB,aAAK,uBAAuB,SAAS;AACrC,aAAK,mBAAmB;AACxB,aAAK,kBAAkB;AACvB,aAAK,uBAAuB;AAE5B,eAAO,WAAU;AAGjB,mBAAW,WAAW,KAAK,iBAAiB;AACxC,kBAAQ,MAAK;;AAGjB,aAAK,oBAAoB,gBAAgB,IAAI;AAC7C,aAAK,oBAAoB,MAAK;AAE9B,YAAI,KAAK,iBAAiB,sBAAsB;AAC5C,qBAAK,IAAI,aAAa,oBAAoB,MAA1C,mBAA6C;;MAErD;;;;;MAMO,uBAAuB,UAA4C;AACtE,YAAI,KAAK,kBAAkB;AACvB,eAAK,iBAAiB,iBAAiB,oBAAyB,UAAU,KAAK;;MAEvF;;;;;MAMO,2BAA2B,UAA4C;AAC1E,YAAI,KAAK,kBAAkB;AACvB,eAAK,iBAAiB,iBAAiB,wBAA6B,UAAU,KAAK;;MAE3F;;;;;;MAOO,WAAQ;AACX,eAAO,KAAK,IAAI,SAAQ;MAC5B;MAEQ,+BAA4B;AAChC,YAAI,KAAK,gBAAgB,GAAG;AACxB,iBAAO,KAAK,MAAM;;AAEtB,eAAO,KAAK,wBAAwB,CAAA;MACxC;MAEQ,mCAAgC;AACpC,YAAI,KAAK,gBAAgB,GAAG;AACxB,iBAAO,KAAK,MAAM;;AAEtB,eAAO,KAAK,wBAAwB,CAAA;MACxC;;MAGQ,wBAAwB,MAAY;AACxC,cAAM,KAAK,KAAK;AAIhB,eAAO,GAAG,SAAQ,MAAO,GAAG,UAAU;QAAA;AAEtC,YAAI,aAAa;AAEjB,cAAM,UAAU,GAAG,cAAa;AAChC,WAAG,YAAY,GAAG,YAAY,OAAO;AACrC,WAAG,WAAW,GAAG,YAAY,GAAG,KAAK,kCAAkC,IAAI,GAAG,GAAG,GAAG,GAAG,GAAG,MAAM,KAAK,qBAAqB,IAAI,GAAG,IAAI;AACrI,WAAG,cAAc,GAAG,YAAY,GAAG,oBAAoB,GAAG,OAAO;AACjE,WAAG,cAAc,GAAG,YAAY,GAAG,oBAAoB,GAAG,OAAO;AAEjE,cAAM,KAAK,GAAG,kBAAiB;AAC/B,WAAG,gBAAgB,GAAG,aAAa,EAAE;AACrC,WAAG,qBAAqB,GAAG,aAAa,GAAG,mBAAmB,GAAG,YAAY,SAAS,CAAC;AACvF,cAAM,SAAS,GAAG,uBAAuB,GAAG,WAAW;AAEvD,qBAAa,cAAc,WAAW,GAAG;AACzC,qBAAa,cAAc,GAAG,SAAQ,MAAO,GAAG;AAGhD,YAAI,YAAY;AACZ,aAAG,MAAM,GAAG,gBAAgB;AAC5B,uBAAa,cAAc,GAAG,SAAQ,MAAO,GAAG;;AAIpD,YAAI,YAAY;AAEZ,aAAG,gBAAgB,GAAG,aAAa,IAAI;AACvC,gBAAM,aAAa,GAAG;AACtB,gBAAM,WAAW,GAAG;AACpB,gBAAM,SAAS,IAAI,WAAW,CAAC;AAC/B,aAAG,WAAW,GAAG,GAAG,GAAG,GAAG,YAAY,UAAU,MAAM;AACtD,uBAAa,cAAc,GAAG,SAAQ,MAAO,GAAG;;AAIpD,WAAG,cAAc,OAAO;AACxB,WAAG,kBAAkB,EAAE;AACvB,WAAG,gBAAgB,GAAG,aAAa,IAAI;AAIvC,eAAO,CAAC,cAAc,GAAG,SAAQ,MAAO,GAAG,UAAU;QAAA;AAErD,eAAO;MACX;;;;MAKO,qBAAqB,MAAY;AACpC,YAAI,KAAK,kBAAkB,GAAG;AAC1B,kBAAQ,MAAM;YACV,KAAK;AACD,qBAAO,KAAK,IAAI;YACpB,KAAK;AACD,qBAAO,KAAK,IAAI;YACpB,KAAK;AACD,qBAAO,KAAK,IAAI;YACpB,KAAK;AACD,qBAAO,KAAK,IAAI;YACpB,KAAK;AACD,qBAAO,KAAK,IAAI;YACpB,KAAK;AACD,qBAAO,KAAK,IAAI;;AAExB,iBAAO,KAAK,IAAI;;AAGpB,gBAAQ,MAAM;UACV,KAAK;AACD,mBAAO,KAAK,IAAI;UACpB,KAAK;AACD,mBAAO,KAAK,IAAI;UACpB,KAAK;AACD,mBAAO,KAAK,IAAI;UACpB,KAAK;AACD,mBAAO,KAAK,IAAI;UACpB,KAAK;AACD,mBAAO,KAAK,IAAI;UACpB,KAAK;AACD,mBAAO,KAAK,IAAI;UACpB,KAAK;AACD,mBAAO,KAAK,IAAI;UACpB,KAAK;AACD,mBAAO,KAAK,IAAI;UACpB,KAAK;AACD,mBAAO,KAAK,IAAI;UACpB,KAAK;AACD,mBAAO,KAAK,IAAI;UACpB,KAAK;AACD,mBAAO,KAAK,IAAI;UACpB,KAAK;AACD,mBAAO,KAAK,IAAI;UACpB,KAAK;AACD,mBAAO,KAAK,IAAI;UACpB,KAAK;AACD,mBAAO,KAAK,IAAI;UACpB,KAAK;AACD,mBAAO,KAAK,IAAI;UACpB,KAAK;AACD,mBAAO,KAAK,IAAI;;AAGxB,eAAO,KAAK,IAAI;MACpB;;;;MAKO,mBAAmB,QAAgB,gBAAgB,OAAK;AAC3D,YAAI,iBAAyB,gBAAgB,KAAK,uBAAuB,eAAe,KAAK,IAAI;AAEjG,gBAAQ,QAAQ;UACZ,KAAK;AACD,6BAAiB,KAAK,IAAI;AAC1B;UACJ,KAAK;AACD,6BAAiB,KAAK,IAAI;AAC1B;UACJ,KAAK;AACD,6BAAiB,KAAK,IAAI;AAC1B;UACJ,KAAK;AACD,6BAAiB,KAAK,IAAI;AAC1B;UACJ,KAAK;AACD,6BAAiB,KAAK,IAAI;AAC1B;UACJ,KAAK;AACD,6BAAiB,gBAAgB,KAAK,uBAAuB,OAAO,KAAK,IAAI;AAC7E;UACJ,KAAK;AACD,6BAAiB,gBAAgB,KAAK,uBAAuB,eAAe,KAAK,IAAI;AACrF;;AAGR,YAAI,KAAK,gBAAgB,GAAG;AACxB,kBAAQ,QAAQ;YACZ,KAAK;AACD,+BAAiB,KAAK,IAAI;AAC1B;YACJ,KAAK;AACD,+BAAiB,KAAK,IAAI;AAC1B;YACJ,KAAK;AACD,+BAAiB,KAAK,IAAI;AAC1B;YACJ,KAAK;AACD,+BAAiB,KAAK,IAAI;AAC1B;;;AAIZ,eAAO;MACX;;;;MAKO,kCAAkC,MAAc,QAAiB,gBAAgB,OAAK;AACzF,YAAI,KAAK,kBAAkB,GAAG;AAC1B,cAAI,WAAW,QAAW;AACtB,oBAAQ,QAAQ;cACZ,KAAK;AACD,uBAAO,KAAK,IAAI;cACpB,KAAK;AACD,uBAAO,KAAK,IAAI;cACpB,KAAK;AACD,uBAAO,KAAK,IAAI;cACpB,KAAK;AACD,uBAAO,gBAAgB,KAAK,uBAAuB,OAAO,KAAK,IAAI;;;AAG/E,iBAAO,KAAK,IAAI;;AAGpB,gBAAQ,MAAM;UACV,KAAK;AACD,oBAAQ,QAAQ;cACZ,KAAK;AACD,uBAAO,KAAK,IAAI;cACpB,KAAK;AACD,uBAAO,KAAK,IAAI;cACpB,KAAK;AACD,uBAAO,KAAK,IAAI;cACpB,KAAK;AACD,uBAAO,KAAK,IAAI;cACpB,KAAK;AACD,uBAAO,KAAK,IAAI;cACpB,KAAK;AACD,uBAAO,KAAK,IAAI;cACpB,KAAK;AACD,uBAAO,KAAK,IAAI;cACpB;AACI,uBAAO,KAAK,IAAI;;UAE5B,KAAK;AACD,oBAAQ,QAAQ;cACZ,KAAK;AACD,uBAAO,KAAK,IAAI;cACpB,KAAK;AACD,uBAAO,KAAK,IAAI;cACpB,KAAK;AACD,uBAAO,gBAAgB,KAAK,uBAAuB,QAAQ,KAAK,IAAI;cACxE,KAAK;AACD,uBAAO,gBAAgB,KAAK,uBAAuB,eAAe,KAAK,IAAI;cAC/E,KAAK;AACD,uBAAO,KAAK,IAAI;cACpB,KAAK;AACD,uBAAO,KAAK,IAAI;cACpB,KAAK;AACD,uBAAO,KAAK,IAAI;cACpB,KAAK;AACD,uBAAO,KAAK,IAAI;cACpB,KAAK;AACD,uBAAO,KAAK,IAAI;cACpB,KAAK;AACD,uBAAO,KAAK,IAAI;cACpB,KAAK;AACD,uBAAO,KAAK,IAAI;cACpB;AACI,uBAAO,KAAK,IAAI;;UAE5B,KAAK;AACD,oBAAQ,QAAQ;cACZ,KAAK;AACD,uBAAO,KAAK,IAAI;cACpB,KAAK;AACD,uBAAO,KAAK,IAAI;cACpB,KAAK;AACD,uBAAO,KAAK,IAAI;cACpB,KAAK;AACD,uBAAO,KAAK,IAAI;cACpB;AACI,uBAAO,KAAK,IAAI;;UAE5B,KAAK;AACD,oBAAQ,QAAQ;cACZ,KAAK;AACD,uBAAO,KAAK,IAAI;cACpB,KAAK;AACD,uBAAO,KAAK,IAAI;cACpB,KAAK;AACD,uBAAO,KAAK,IAAI;cACpB,KAAK;AACD,uBAAO,KAAK,IAAI;cACpB;AACI,uBAAO,KAAK,IAAI;;UAE5B,KAAK;AACD,oBAAQ,QAAQ;cACZ,KAAK;AACD,uBAAO,KAAK,IAAI;cACpB,KAAK;AACD,uBAAO,KAAK,IAAI;cACpB,KAAK;AACD,uBAAO,KAAK,IAAI;cACpB,KAAK;AACD,uBAAO,KAAK,IAAI;cACpB;AACI,uBAAO,KAAK,IAAI;;UAE5B,KAAK;AACD,oBAAQ,QAAQ;cACZ,KAAK;AACD,uBAAO,KAAK,IAAI;cACpB,KAAK;AACD,uBAAO,KAAK,IAAI;cACpB,KAAK;AACD,uBAAO,KAAK,IAAI;cACpB,KAAK;AACD,uBAAO,KAAK,IAAI;cACpB;AACI,uBAAO,KAAK,IAAI;;UAE5B,KAAK;AACD,oBAAQ,QAAQ;cACZ,KAAK;AACD,uBAAO,KAAK,IAAI;cACpB,KAAK;AACD,uBAAO,KAAK,IAAI;cACpB,KAAK;AACD,uBAAO,KAAK,IAAI;cACpB,KAAK;AACD,uBAAO,KAAK,IAAI;cACpB;AACI,uBAAO,KAAK,IAAI;;UAE5B,KAAK;AACD,oBAAQ,QAAQ;cACZ,KAAK;AACD,uBAAO,KAAK,IAAI;cACpB,KAAK;AACD,uBAAO,KAAK,IAAI;cACpB,KAAK;AACD,uBAAO,KAAK,IAAI;cACpB,KAAK;AACD,uBAAO,KAAK,IAAI;cACpB;AACI,uBAAO,KAAK,IAAI;;UAE5B,KAAK;AACD,mBAAO,KAAK,IAAI;UACpB,KAAK;AACD,mBAAO,KAAK,IAAI;UACpB,KAAK;AACD,mBAAO,KAAK,IAAI;UACpB,KAAK;AACD,mBAAO,KAAK,IAAI;UACpB,KAAK;AACD,mBAAO,KAAK,IAAI;UACpB,KAAK;AACD,oBAAQ,QAAQ;cACZ,KAAK;AACD,uBAAO,KAAK,IAAI;cACpB,KAAK;AACD,uBAAO,KAAK,IAAI;cACpB;AACI,uBAAO,KAAK,IAAI;;;AAIhC,eAAO,gBAAgB,KAAK,uBAAuB,eAAe,KAAK,IAAI;MAC/E;;;;MAKO,UACH,KACA,WACA,YACA,iBACA,gBACA,SAA0D;AAE1D,cAAM,UAAU,YAAW,mBAAmB,KAAK,WAAW,YAAY,iBAAiB,gBAAgB,OAAO;AAClH,aAAK,gBAAgB,KAAK,OAAO;AACjC,gBAAQ,qBAAqB,IAAI,CAACC,aAAW;AACzC,eAAK,gBAAgB,OAAO,KAAK,gBAAgB,QAAQA,QAAO,GAAG,CAAC;QACxE,CAAC;AACD,eAAO;MACX;;;;;;;;;;;;MAaO,OAAO,mBACV,KACA,WACA,YACA,iBACA,gBACA,SAAmE;AAEnE,cAAM,YAAY,WAAW;MACjC;;;;;;;;;;;MAYO,WAAW,GAAW,GAAW,OAAe,QAAgB,WAAW,MAAM,gBAAgB,MAAI;AACxG,cAAM,cAAc,WAAW,IAAI;AACnC,cAAM,SAAS,WAAW,KAAK,IAAI,OAAO,KAAK,IAAI;AACnD,cAAM,OAAO,IAAI,WAAW,SAAS,QAAQ,WAAW;AACxD,YAAI,eAAe;AACf,eAAK,iBAAgB;;AAEzB,aAAK,IAAI,WAAW,GAAG,GAAG,OAAO,QAAQ,QAAQ,KAAK,IAAI,eAAe,IAAI;AAC7E,eAAO,QAAQ,QAAQ,IAAI;MAC/B;;;;MAUO,WAAW,mBAAgB;AAC9B,eAAO,QAAQ,QAAQ,KAAK,YAAW,CAAE;MAC7C;;;;MAKO,WAAW,cAAW;AACzB,eAAO,KAAK,YAAW;MAC3B;;;;;;;MAQO,OAAO,cAAW;AACrB,YAAI,KAAK,+BAA+B,MAAM;AAC1C,iBAAO,CAAC,KAAK;;AAGjB,YAAI,KAAK,iBAAiB,MAAM;AAC5B,cAAI;AACA,kBAAM,aAAa,KAAK,cAAc,GAAG,CAAC;AAC1C,kBAAM,KAAK,WAAW,WAAW,OAAO,KAAM,WAAmB,WAAW,oBAAoB;AAEhG,iBAAK,eAAe,MAAM,QAAQ,CAAC,CAAC,OAAO;mBACtC,GAAG;AACR,iBAAK,eAAe;;;AAI5B,eAAO,KAAK;MAChB;;;;MAKO,WAAW,4BAAyB;AACvC,YAAI,KAAK,+BAA+B,MAAM;AAC1C,cAAI;AACA,kBAAM,aAAa,KAAK,cAAc,GAAG,CAAC;AAC1C,kBAAM,KACF,WAAW,WAAW,SAAS,EAAE,8BAA8B,KAAI,CAAE,KACpE,WAAmB,WAAW,sBAAsB,EAAE,8BAA8B,KAAI,CAAE;AAE/F,iBAAK,6BAA6B,CAAC;mBAC9B,GAAG;AACR,iBAAK,6BAA6B;;;AAI1C,eAAO,KAAK;MAChB;;;;;;MAOO,OAAO,WAAW,GAAS;AAC9B;AACA,aAAK,KAAK;AACV,aAAK,KAAK;AACV,aAAK,KAAK;AACV,aAAK,KAAK;AACV,aAAK,KAAK;AACV;AACA,eAAO;MACX;;;;;;MAOO,OAAO,SAAS,GAAS;AAC5B,YAAI,IAAK,KAAK;AACd,YAAI,IAAK,KAAK;AACd,YAAI,IAAK,KAAK;AACd,YAAI,IAAK,KAAK;AACd,YAAI,IAAK,KAAK;AACd,eAAO,KAAK,KAAK;MACrB;;;;;;MAOO,OAAO,WAAW,GAAS;AAC9B,cAAM,IAAI,YAAW,WAAW,CAAC;AACjC,cAAM,IAAI,YAAW,SAAS,CAAC;AAC/B,eAAO,IAAI,IAAI,IAAI,IAAI,IAAI;MAC/B;;;;;;;;MASO,OAAO,iBAAiB,OAAe,KAAa,OAAO,GAAA;AAC9D,YAAI;AAEJ,gBAAQ,MAAM;UACV,KAAK;AACD,kBAAM,YAAW,SAAS,KAAK;AAC/B;UACJ,KAAK;AACD,kBAAM,YAAW,WAAW,KAAK;AACjC;UACJ,KAAK;UACL;AACI,kBAAM,YAAW,WAAW,KAAK;AACjC;;AAGR,eAAO,KAAK,IAAI,KAAK,GAAG;MAC5B;;;;;;;MAQO,OAAO,cAAc,MAAkB,WAAe;AAKzD,YAAI,CAAC,oBAAmB,GAAI;AACxB,cAAI,OAAO,0BAA0B,YAAY;AAC7C,mBAAO,sBAAsB,IAAI;;eAElC;AACH,gBAAM,EAAE,uBAAAC,uBAAqB,IAAK,aAAa;AAC/C,cAAI,OAAOA,2BAA0B,YAAY;AAC7C,mBAAOA,uBAAsB,IAAI;;;AAMzC,eAAO,WAAW,MAAM,EAAE;MAC9B;;;;;MAMO,kBAAe;AAClB,YAAI,KAAK,oBAAoB,KAAK,iBAAiB,eAAe;AAC9D,iBAAO,KAAK,iBAAiB;;AAGjC,eAAO,oBAAmB,IAAK,WAAW;MAC9C;;AA72Le,eAAA,wBAAwB,IAAI,YAAY,CAAC;AACzC,eAAA,uBAAuB,IAAI,WAAW,CAAC;AAGxC,eAAA,gBAAgB;MAC1B,EAAE,KAAK,eAAe,SAAS,0BAA0B,mBAAmB,KAAK,SAAS,CAAC,eAAe,EAAC;MAC3G,EAAE,KAAK,cAAc,SAAS,MAAM,mBAAmB,MAAM,SAAS,CAAC,eAAe,EAAC;MACvF,EAAE,KAAK,cAAc,SAAS,MAAM,mBAAmB,MAAM,SAAS,CAAC,eAAe,EAAC;MACvF,EAAE,KAAK,sBAAsB,SAAS,MAAM,mBAAmB,MAAM,SAAS,CAAC,KAAK,EAAC;MACrF,EAAE,KAAK,sBAAsB,SAAS,MAAM,mBAAmB,MAAM,SAAS,CAAC,KAAK,EAAC;MACrF,EAAE,KAAK,sBAAsB,SAAS,MAAM,mBAAmB,MAAM,SAAS,CAAC,KAAK,EAAC;MACrF,EAAE,KAAK,qBAAqB,SAAS,MAAM,mBAAmB,MAAM,SAAS,CAAC,KAAK,EAAC;MACpF,EAAE,KAAK,qBAAqB,SAAS,MAAM,mBAAmB,MAAM,SAAS,CAAC,KAAK,EAAC;MACpF,EAAE,KAAK,kBAAkB,SAAS,MAAM,mBAAmB,MAAM,SAAS,CAAC,eAAe,EAAC;MAC3F,EAAE,KAAK,4BAA4B,SAAS,MAAM,mBAAmB,MAAM,SAAS,CAAC,eAAe,EAAC;;MAErG,EAAE,KAAK,iCAAiC,SAAS,MAAM,mBAAmB,MAAM,SAAS,CAAC,aAAa,gBAAgB,EAAC;;MAExH,EAAE,KAAK,iCAAiC,SAAS,MAAM,mBAAmB,MAAM,SAAS,CAAC,aAAa,gBAAgB,EAAC;;AAI9G,eAAA,kBAA4C,CAAA;AA8D5C,eAAA,oBAAoB;AAmnLnB,eAAA,eAAkC;AAClC,eAAA,6BAAgD;;;",
  "names": ["ShaderLanguage", "match", "InternalTextureSource", "proxy", "index", "cancelAnimationFrame", "request", "requestAnimationFrame"]
}
