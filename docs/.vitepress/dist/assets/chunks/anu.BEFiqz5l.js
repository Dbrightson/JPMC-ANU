import{V as _e,Q as Ji,O as Xl,b as Hl,c as Zp,d as Xt,S as JC,P as vl,T as dn,M as El,e as Fn,L as Fr,f as hi,g as jp,h as U_,G as $C,i as ji,j as oh,k as ca,l as eR,m as tR,n as iR,o as rR,p as sR,q as nR,r as oR,s as aR,t as lR,u as hR,v as cR,w as uR,x as dR,y as fR,z as pR,B as gR,D as mR,F as _R,I as vR,J as ER,K as TR,N as xR,R as CR,U as RR,W as SR,X as yR,Y as bR,C as _i,Z as es,_ as Ur,$ as Kl,a0 as ua,a as Ws,a1 as IR,a2 as AR,a3 as V_,a4 as Uh,a5 as Un,a6 as Xs,a7 as ql,a8 as MR,a9 as Qp,aa as As,ab as Yc,ac as Jp,ad as PR,ae as B_,af as OR}from"./flowGraphSceneTickEventBlock.jsKt_esu.js";class Us{constructor(){this._attachedToElement=!1,this._virtualMeshesInfo={},this._tmpVector=new _e,this._tmpQuaternion=new Ji,this._dragType={NONE:0,DRAG:1,DRAG_WITH_CONTROLLER:2,NEAR_DRAG:3},this._moving=!1,this._dragging=this._dragType.NONE,this.draggableMeshes=null,this.zDragFactor=3,this.currentDraggingPointerIds=[],this.detachCameraControls=!0,this.onDragStartObservable=new Xl,this.onDragObservable=new Xl,this.onDragEndObservable=new Xl,this.allowMultiPointer=!0}get currentDraggingPointerId(){return this.currentDraggingPointerIds[0]!==void 0?this.currentDraggingPointerIds[0]:-1}set currentDraggingPointerId(e){this.currentDraggingPointerIds[0]=e}get currentDraggingPointerID(){return this.currentDraggingPointerId}set currentDraggingPointerID(e){this.currentDraggingPointerId=e}get name(){return"BaseSixDofDrag"}get isMoving(){return this._moving}init(){}get _pointerCamera(){return this._scene.cameraToUseForPointers?this._scene.cameraToUseForPointers:this._scene.activeCamera}_createVirtualMeshInfo(){const e=new Hl("",Us._virtualScene);e.rotationQuaternion=new Ji;const t=new Hl("",Us._virtualScene);t.rotationQuaternion=new Ji;const i=new Hl("",Us._virtualScene);return i.rotationQuaternion=new Ji,{dragging:!1,moving:!1,dragMesh:e,originMesh:t,pivotMesh:i,startingPivotPosition:new _e,startingPivotOrientation:new Ji,startingPosition:new _e,startingOrientation:new Ji,lastOriginPosition:new _e,lastDragPosition:new _e}}_resetVirtualMeshesPosition(){for(let e=0;e<this.currentDraggingPointerIds.length;e++)this._virtualMeshesInfo[this.currentDraggingPointerIds[e]].pivotMesh.position.copyFrom(this._ownerNode.getAbsolutePivotPoint()),this._virtualMeshesInfo[this.currentDraggingPointerIds[e]].pivotMesh.rotationQuaternion.copyFrom(this._ownerNode.rotationQuaternion),this._virtualMeshesInfo[this.currentDraggingPointerIds[e]].startingPivotPosition.copyFrom(this._virtualMeshesInfo[this.currentDraggingPointerIds[e]].pivotMesh.position),this._virtualMeshesInfo[this.currentDraggingPointerIds[e]].startingPivotOrientation.copyFrom(this._virtualMeshesInfo[this.currentDraggingPointerIds[e]].pivotMesh.rotationQuaternion),this._virtualMeshesInfo[this.currentDraggingPointerIds[e]].startingPosition.copyFrom(this._virtualMeshesInfo[this.currentDraggingPointerIds[e]].dragMesh.position),this._virtualMeshesInfo[this.currentDraggingPointerIds[e]].startingOrientation.copyFrom(this._virtualMeshesInfo[this.currentDraggingPointerIds[e]].dragMesh.rotationQuaternion)}_pointerUpdate2D(e,t,i){this._pointerCamera&&this._pointerCamera.cameraRigMode==Zp.RIG_MODE_NONE&&!this._pointerCamera._isLeftCamera&&!this._pointerCamera._isRightCamera&&(e.origin.copyFrom(this._pointerCamera.globalPosition),i=0);const r=this._virtualMeshesInfo[t],s=Xt.Vector3[0];e.origin.subtractToRef(r.lastOriginPosition,s),r.lastOriginPosition.copyFrom(e.origin);const o=-_e.Dot(s,e.direction);r.originMesh.addChild(r.dragMesh),r.originMesh.addChild(r.pivotMesh),this._applyZOffset(r.dragMesh,o,i),this._applyZOffset(r.pivotMesh,o,i),r.originMesh.position.copyFrom(e.origin);const a=Xt.Vector3[0];e.origin.addToRef(e.direction,a),r.originMesh.lookAt(a),r.originMesh.removeChild(r.dragMesh),r.originMesh.removeChild(r.pivotMesh)}_pointerUpdateXR(e,t,i,r){const s=this._virtualMeshesInfo[i];if(s.originMesh.position.copyFrom(e.position),this._dragging===this._dragType.NEAR_DRAG&&t?s.originMesh.rotationQuaternion.copyFrom(t.rotationQuaternion):s.originMesh.rotationQuaternion.copyFrom(e.rotationQuaternion),s.pivotMesh.computeWorldMatrix(!0),s.dragMesh.computeWorldMatrix(!0),r!==0){const o=Xt.Vector3[0],a=Xt.Vector3[1];o.copyFrom(this._pointerCamera.getForwardRay().direction),s.originMesh.position.subtractToRef(s.lastOriginPosition,a),s.lastOriginPosition.copyFrom(s.originMesh.position);const l=a.length();a.normalize();const h=Xt.Vector3[2],c=Xt.Vector3[3];s.dragMesh.absolutePosition.subtractToRef(this._pointerCamera.globalPosition,h),s.dragMesh.absolutePosition.subtractToRef(s.originMesh.position,c);const u=c.length();h.normalize(),c.normalize();let f=Math.abs(_e.Dot(a,c))*_e.Dot(a,o)*r*l*u;const p=.01;f<0&&p-u>f&&(f=Math.min(p-u,0)),c.scaleInPlace(f),c.addToRef(s.pivotMesh.absolutePosition,this._tmpVector),s.pivotMesh.setAbsolutePosition(this._tmpVector),c.addToRef(s.dragMesh.absolutePosition,this._tmpVector),s.dragMesh.setAbsolutePosition(this._tmpVector)}}attach(e){this._ownerNode=e,this._scene=this._ownerNode.getScene(),Us._virtualScene||(Us._virtualScene=new JC(this._scene.getEngine(),{virtual:!0}),Us._virtualScene.detachControl());const t=i=>this._ownerNode===i||i.isDescendantOf(this._ownerNode)&&(!this.draggableMeshes||this.draggableMeshes.indexOf(i)!==-1);this._pointerObserver=this._scene.onPointerObservable.add(i=>{const r=i.event.pointerId;this._virtualMeshesInfo[r]||(this._virtualMeshesInfo[r]=this._createVirtualMeshInfo());const s=this._virtualMeshesInfo[r],o=i.event.pointerType==="xr-near"||i.event.pointerType==="xr";if(i.type==vl.POINTERDOWN){if(!s.dragging&&i.pickInfo&&i.pickInfo.hit&&i.pickInfo.pickedMesh&&i.pickInfo.pickedPoint&&i.pickInfo.ray&&(!o||i.pickInfo.aimTransform)&&t(i.pickInfo.pickedMesh)){if((!this.allowMultiPointer||o)&&this.currentDraggingPointerIds.length>0)return;this._pointerCamera&&this._pointerCamera.cameraRigMode===Zp.RIG_MODE_NONE&&!this._pointerCamera._isLeftCamera&&!this._pointerCamera._isRightCamera&&i.pickInfo.ray.origin.copyFrom(this._pointerCamera.globalPosition),this._ownerNode.computeWorldMatrix(!0);const a=this._virtualMeshesInfo[r];o?(this._dragging=i.pickInfo.originMesh?this._dragType.NEAR_DRAG:this._dragType.DRAG_WITH_CONTROLLER,a.originMesh.position.copyFrom(i.pickInfo.aimTransform.position),this._dragging===this._dragType.NEAR_DRAG&&i.pickInfo.gripTransform?a.originMesh.rotationQuaternion.copyFrom(i.pickInfo.gripTransform.rotationQuaternion):a.originMesh.rotationQuaternion.copyFrom(i.pickInfo.aimTransform.rotationQuaternion)):(this._dragging=this._dragType.DRAG,a.originMesh.position.copyFrom(i.pickInfo.ray.origin)),a.lastOriginPosition.copyFrom(a.originMesh.position),a.dragMesh.position.copyFrom(i.pickInfo.pickedPoint),a.lastDragPosition.copyFrom(i.pickInfo.pickedPoint),a.pivotMesh.position.copyFrom(this._ownerNode.getAbsolutePivotPoint()),a.pivotMesh.rotationQuaternion.copyFrom(this._ownerNode.absoluteRotationQuaternion),a.startingPosition.copyFrom(a.dragMesh.position),a.startingPivotPosition.copyFrom(a.pivotMesh.position),a.startingOrientation.copyFrom(a.dragMesh.rotationQuaternion),a.startingPivotOrientation.copyFrom(a.pivotMesh.rotationQuaternion),o?(a.originMesh.addChild(a.dragMesh),a.originMesh.addChild(a.pivotMesh)):a.originMesh.lookAt(a.dragMesh.position),a.dragging=!0,this.currentDraggingPointerIds.indexOf(r)===-1&&this.currentDraggingPointerIds.push(r),this.detachCameraControls&&this._pointerCamera&&!this._pointerCamera.leftCamera&&(this._pointerCamera.inputs&&this._pointerCamera.inputs.attachedToElement?(this._pointerCamera.detachControl(),this._attachedToElement=!0):(!this.allowMultiPointer||this.currentDraggingPointerIds.length===0)&&(this._attachedToElement=!1)),this._targetDragStart(a.pivotMesh.position,a.pivotMesh.rotationQuaternion,r),this.onDragStartObservable.notifyObservers({position:a.pivotMesh.position})}}else if(i.type==vl.POINTERUP||i.type==vl.POINTERDOUBLETAP){const a=this.currentDraggingPointerIds.indexOf(r);s.dragging=!1,a!==-1&&(this.currentDraggingPointerIds.splice(a,1),this.currentDraggingPointerIds.length===0&&(this._moving=!1,this._dragging=this._dragType.NONE,this.detachCameraControls&&this._attachedToElement&&this._pointerCamera&&!this._pointerCamera.leftCamera&&(this._reattachCameraControls(),this._attachedToElement=!1)),s.originMesh.removeChild(s.dragMesh),s.originMesh.removeChild(s.pivotMesh),this._targetDragEnd(r),this.onDragEndObservable.notifyObservers({}))}else if(i.type==vl.POINTERMOVE&&this.currentDraggingPointerIds.indexOf(r)!==-1&&s.dragging&&i.pickInfo&&(i.pickInfo.ray||i.pickInfo.aimTransform)){let l=this.zDragFactor;(this.currentDraggingPointerIds.length>1||i.pickInfo.originMesh)&&(l=0),this._ownerNode.computeWorldMatrix(!0),o?this._pointerUpdateXR(i.pickInfo.aimTransform,i.pickInfo.gripTransform,r,l):this._pointerUpdate2D(i.pickInfo.ray,r,l),this._tmpQuaternion.copyFrom(s.startingPivotOrientation),this._tmpQuaternion.x=-this._tmpQuaternion.x,this._tmpQuaternion.y=-this._tmpQuaternion.y,this._tmpQuaternion.z=-this._tmpQuaternion.z,s.pivotMesh.absoluteRotationQuaternion.multiplyToRef(this._tmpQuaternion,this._tmpQuaternion),s.pivotMesh.absolutePosition.subtractToRef(s.startingPivotPosition,this._tmpVector),this.onDragObservable.notifyObservers({delta:this._tmpVector,position:s.pivotMesh.position,pickInfo:i.pickInfo}),this._targetDrag(this._tmpVector,this._tmpQuaternion,r),s.lastDragPosition.copyFrom(s.dragMesh.absolutePosition),this._moving=!0}})}_applyZOffset(e,t,i){e.position.z-=e.position.z<1?t*i:t*i*e.position.z,e.position.z<0&&(e.position.z=0)}_targetDragStart(e,t,i){}_targetDrag(e,t,i){}_targetDragEnd(e){}_reattachCameraControls(){if(this._pointerCamera)if(this._pointerCamera.getClassName()==="ArcRotateCamera"){const e=this._pointerCamera;e.attachControl(e.inputs?e.inputs.noPreventDefault:!0,e._useCtrlForPanning,e._panningMouseButton)}else this._pointerCamera.attachControl(this._pointerCamera.inputs?this._pointerCamera.inputs.noPreventDefault:!0)}detach(){this._scene&&(this.detachCameraControls&&this._attachedToElement&&this._pointerCamera&&!this._pointerCamera.leftCamera&&(this._reattachCameraControls(),this._attachedToElement=!1),this._scene.onPointerObservable.remove(this._pointerObserver));for(const e in this._virtualMeshesInfo)this._virtualMeshesInfo[e].originMesh.dispose(),this._virtualMeshesInfo[e].dragMesh.dispose();this.onDragEndObservable.clear(),this.onDragObservable.clear(),this.onDragStartObservable.clear()}}class DR extends Us{constructor(){super(...arguments),this._sceneRenderObserver=null,this._targetPosition=new _e(0,0,0),this._targetOrientation=new Ji,this._targetScaling=new _e(1,1,1),this._startingPosition=new _e(0,0,0),this._startingOrientation=new Ji,this._startingScaling=new _e(1,1,1),this.onPositionChangedObservable=new Xl,this.dragDeltaRatio=.2,this.rotateDraggedObject=!0,this.rotateAroundYOnly=!1,this.rotateWithMotionController=!0,this.disableMovement=!1,this.faceCameraOnDragStart=!1}get name(){return"SixDofDrag"}attach(e){super.attach(e),e.isNearGrabbable=!0,e.getChildMeshes().forEach(t=>{t.isNearGrabbable=!0}),this._virtualTransformNode=new dn("virtual_sixDof",Us._virtualScene),this._virtualTransformNode.rotationQuaternion=Ji.Identity(),this._sceneRenderObserver=e.getScene().onBeforeRenderObservable.add(()=>{if(this.currentDraggingPointerIds.length===1&&this._moving&&!this.disableMovement){const t=Xt.Vector3[0];t.copyFrom(this._targetPosition).subtractInPlace(e.absolutePosition).scaleInPlace(this.dragDeltaRatio);const i=Xt.Vector3[1];if(i.copyFrom(t),e.parent){const r=Xt.Matrix[0];e.parent.absoluteRotationQuaternion.toRotationMatrix(r),r.invert(),_e.TransformNormalToRef(t,r,i)}if(e.position.addInPlace(i),this.onPositionChangedObservable.notifyObservers({position:e.absolutePosition}),!e.parent||e.parent.scaling&&!e.parent.scaling.isNonUniformWithinEpsilon(.001)){const r=Xt.Quaternion[0];if(r.copyFrom(this._targetOrientation),e.parent){const s=Xt.Quaternion[0];s.copyFrom(e.parent.absoluteRotationQuaternion),s.invertInPlace(),s.multiplyToRef(this._targetOrientation,r)}Ji.SlerpToRef(e.rotationQuaternion,r,this.dragDeltaRatio,e.rotationQuaternion)}}})}_getPositionOffsetAround(e,t,i){const r=Xt.Matrix[0],s=Xt.Matrix[1],o=Xt.Matrix[2],a=Xt.Matrix[3],l=Xt.Matrix[4];return El.TranslationToRef(e.x,e.y,e.z,r),El.TranslationToRef(-e.x,-e.y,-e.z,s),El.FromQuaternionToRef(i,o),El.ScalingToRef(t,t,t,a),s.multiplyToRef(o,l),l.multiplyToRef(a,l),l.multiplyToRef(r,l),l.getTranslation()}_onePointerPositionUpdated(e,t){Xt.Vector3[0].setAll(0),this._dragging===this._dragType.DRAG?this.rotateDraggedObject&&(this.rotateAroundYOnly?Ji.RotationYawPitchRollToRef(t.toEulerAngles().y,0,0,Xt.Quaternion[0]):Xt.Quaternion[0].copyFrom(t),Xt.Quaternion[0].multiplyToRef(this._startingOrientation,this._targetOrientation)):(this._dragging===this._dragType.NEAR_DRAG||this._dragging===this._dragType.DRAG_WITH_CONTROLLER&&this.rotateWithMotionController)&&t.multiplyToRef(this._startingOrientation,this._targetOrientation),this._targetPosition.copyFrom(this._startingPosition).addInPlace(e)}_twoPointersPositionUpdated(){const e=this._virtualMeshesInfo[this.currentDraggingPointerIds[0]].startingPosition,t=this._virtualMeshesInfo[this.currentDraggingPointerIds[1]].startingPosition,i=Xt.Vector3[0];e.addToRef(t,i),i.scaleInPlace(.5);const r=Xt.Vector3[1];t.subtractToRef(e,r);const s=this._virtualMeshesInfo[this.currentDraggingPointerIds[0]].dragMesh.absolutePosition,o=this._virtualMeshesInfo[this.currentDraggingPointerIds[1]].dragMesh.absolutePosition,a=Xt.Vector3[2];s.addToRef(o,a),a.scaleInPlace(.5);const l=Xt.Vector3[3];o.subtractToRef(s,l);const h=l.length()/r.length(),c=a.subtract(i),u=Ji.FromEulerAngles(0,_e.GetAngleBetweenVectorsOnPlane(r.normalize(),l.normalize(),_e.UpReadOnly),0),d=this._ownerNode.parent;this._ownerNode.setParent(null);const f=this._getPositionOffsetAround(i.subtract(this._virtualTransformNode.getAbsolutePivotPoint()),h,u);this._virtualTransformNode.rotationQuaternion.multiplyToRef(u,this._ownerNode.rotationQuaternion),this._virtualTransformNode.scaling.scaleToRef(h,this._ownerNode.scaling),this._virtualTransformNode.position.addToRef(c.addInPlace(f),this._ownerNode.position),this.onPositionChangedObservable.notifyObservers({position:this._ownerNode.position}),this._ownerNode.setParent(d)}_targetDragStart(){const e=this.currentDraggingPointerIds.length;this._ownerNode.rotationQuaternion||(this._ownerNode.rotationQuaternion=Ji.RotationYawPitchRoll(this._ownerNode.rotation.y,this._ownerNode.rotation.x,this._ownerNode.rotation.z));const t=this._ownerNode.getAbsolutePivotPoint();if(e===1){if(this._targetPosition.copyFrom(this._ownerNode.absolutePosition),this._targetOrientation.copyFrom(this._ownerNode.absoluteRotationQuaternion),this._targetScaling.copyFrom(this._ownerNode.absoluteScaling),this.faceCameraOnDragStart&&this._scene.activeCamera){const i=Xt.Vector3[0];this._scene.activeCamera.position.subtractToRef(t,i),i.normalize();const r=Xt.Quaternion[0];this._scene.useRightHandedSystem?Ji.FromLookDirectionRHToRef(i,new _e(0,1,0),r):Ji.FromLookDirectionLHToRef(i,new _e(0,1,0),r),r.normalize(),Ji.RotationYawPitchRollToRef(r.toEulerAngles().y,0,0,Xt.Quaternion[0]),this._targetOrientation.copyFrom(Xt.Quaternion[0])}this._startingPosition.copyFrom(this._targetPosition),this._startingOrientation.copyFrom(this._targetOrientation),this._startingScaling.copyFrom(this._targetScaling)}else e===2&&(this._virtualTransformNode.setPivotPoint(new _e(0,0,0),Fn.LOCAL),this._virtualTransformNode.position.copyFrom(this._ownerNode.absolutePosition),this._virtualTransformNode.scaling.copyFrom(this._ownerNode.absoluteScaling),this._virtualTransformNode.rotationQuaternion.copyFrom(this._ownerNode.absoluteRotationQuaternion),this._virtualTransformNode.setPivotPoint(t,Fn.WORLD),this._resetVirtualMeshesPosition())}_targetDrag(e,t){this.currentDraggingPointerIds.length===1?this._onePointerPositionUpdated(e,t):this.currentDraggingPointerIds.length===2&&this._twoPointersPositionUpdated()}_targetDragEnd(){if(this.currentDraggingPointerIds.length===1){this._resetVirtualMeshesPosition();const e=this.faceCameraOnDragStart;this.faceCameraOnDragStart=!1,this._targetDragStart(),this.faceCameraOnDragStart=e}}detach(){super.detach(),this._ownerNode&&this._ownerNode.getScene().onBeforeRenderObservable.remove(this._sceneRenderObserver),this._virtualTransformNode&&this._virtualTransformNode.dispose()}}class zt{constructor(e=0,t=0){this.x=e,this.y=t,e!==Math.floor(e)&&Fr.Warn("x is not an integer, floor(x) used"),t!==Math.floor(t)&&Fr.Warn("y is not an integer, floor(y) used")}clone(){return new zt(this.x,this.y)}rotate60About(e){const t=this.x;return this.x=e.x+e.y-this.y,this.y=t+this.y-e.x,this}rotateNeg60About(e){const t=this.x;return this.x=t+this.y-e.y,this.y=e.x+e.y-t,this}rotate120(e,t){e!==Math.floor(e)&&Fr.Warn("m not an integer only floor(m) used"),t!==Math.floor(t)&&Fr.Warn("n not an integer only floor(n) used");const i=this.x;return this.x=e-i-this.y,this.y=t+i,this}rotateNeg120(e,t){e!==Math.floor(e)&&Fr.Warn("m is not an integer, floor(m) used"),t!==Math.floor(t)&&Fr.Warn("n is not an integer,   floor(n) used");const i=this.x;return this.x=this.y-t,this.y=e+t-i-this.y,this}toCartesianOrigin(e,t){const i=_e.Zero();return i.x=e.x+2*this.x*t+this.y*t,i.y=e.y+Math.sqrt(3)*this.y*t,i}static Zero(){return new zt(0,0)}}class k_{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new Su("icosahedron","Regular",[[0,hi,-1],[-hi,1,0],[-1,0,-hi],[1,0,-hi],[hi,1,0],[0,hi,1],[-1,0,hi],[-hi,-1,0],[0,-hi,-1],[hi,-1,0],[1,0,hi],[0,-hi,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let e=12;const t={},i=this.m,r=this.n;let s=i,o=1,a=0;r!==0&&(s=jp.HCF(i,r)),o=i/s,a=r/s;let l,h,c,u,d;const f=zt.Zero(),p=new zt(i,r),g=new zt(-r,i+r),m=zt.Zero(),x=zt.Zero(),E=zt.Zero();let R=[],C,_,T,y;const P=[],D=this.vertByDist,F=(N,G,J,j)=>{C=N+"|"+J,_=G+"|"+j,C in t||_ in t?C in t&&!(_ in t)?t[_]=t[C]:_ in t&&!(C in t)&&(t[C]=t[_]):(t[C]=e,t[_]=e,e++),D[J][0]>2?P[t[C]]=[-D[J][0],D[J][1],t[C]]:P[t[C]]=[R[D[J][0]],D[J][1],t[C]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let N=0;N<20;N++){if(R=this.IDATA.face[N],c=R[2],u=R[1],d=R[0],T=f.x+"|"+f.y,C=N+"|"+T,C in t||(t[C]=c,P[c]=[R[D[T][0]],D[T][1]]),T=p.x+"|"+p.y,C=N+"|"+T,C in t||(t[C]=u,P[u]=[R[D[T][0]],D[T][1]]),T=g.x+"|"+g.y,C=N+"|"+T,C in t||(t[C]=d,P[d]=[R[D[T][0]],D[T][1]]),l=this.IDATA.edgematch[N][0],h=this.IDATA.edgematch[N][1],h==="B")for(let G=1;G<s;G++)x.x=i-G*(o+a),x.y=r+G*o,E.x=-G*a,E.y=G*(o+a),T=x.x+"|"+x.y,y=E.x+"|"+E.y,F(N,l,T,y);if(h==="O")for(let G=1;G<s;G++)E.x=-G*a,E.y=G*(o+a),m.x=G*o,m.y=G*a,T=E.x+"|"+E.y,y=m.x+"|"+m.y,F(N,l,T,y);if(l=this.IDATA.edgematch[N][2],h=this.IDATA.edgematch[N][3],h&&h==="A")for(let G=1;G<s;G++)m.x=G*o,m.y=G*a,x.x=i-(s-G)*(o+a),x.y=r+(s-G)*o,T=m.x+"|"+m.y,y=x.x+"|"+x.y,F(N,l,T,y);for(let G=0;G<this.vertices.length;G++)T=this.vertices[G].x+"|"+this.vertices[G].y,C=N+"|"+T,C in t||(t[C]=e++,D[T][0]>2?P[t[C]]=[-D[T][0],D[T][1],t[C]]:P[t[C]]=[R[D[T][0]],D[T][1],t[C]])}this.closestTo=P,this.vecToidx=t}calcCoeffs(){const e=this.m,t=this.n,i=Math.sqrt(3)/3,r=e*e+t*t+e*t;this.coau=(e+t)/r,this.cobu=-t/r,this.coav=-i*(e-t)/r,this.cobv=i*(2*e+t)/r}createInnerFacets(){const e=this.m,t=this.n;for(let i=0;i<t+e+1;i++)for(let r=this.min[i];r<this.max[i]+1;r++)r<this.max[i]&&r<this.max[i+1]+1&&this.innerFacets.push(["|"+r+"|"+i,"|"+r+"|"+(i+1),"|"+(r+1)+"|"+i]),i>0&&r<this.max[i-1]&&r+1<this.max[i]+1&&this.innerFacets.push(["|"+r+"|"+i,"|"+(r+1)+"|"+i,"|"+(r+1)+"|"+(i-1)])}edgeVecsABOB(){const e=this.m,t=this.n,i=new zt(-t,e+t);for(let r=1;r<e+t;r++){const s=new zt(this.min[r],r),o=new zt(this.min[r-1],r-1),a=new zt(this.min[r+1],r+1),l=s.clone(),h=o.clone(),c=a.clone();l.rotate60About(i),h.rotate60About(i),c.rotate60About(i);const u=new zt(this.max[l.y],l.y),d=new zt(this.max[l.y-1],l.y-1),f=new zt(this.max[l.y-1]-1,l.y-1);(l.x!==u.x||l.y!==u.y)&&(l.x!==d.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([s,d,f]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([s,f,u])):l.y===c.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([s,o,d]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([s,d,a])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([s,o,d]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([s,d,u])))}}mapABOBtoOBOA(){const e=new zt(0,0);for(let t=0;t<this.isoVecsABOB.length;t++){const i=[];for(let r=0;r<3;r++)e.x=this.isoVecsABOB[t][r].x,e.y=this.isoVecsABOB[t][r].y,this.vertexTypes[t][r]===0&&e.rotateNeg120(this.m,this.n),i.push(e.clone());this.isoVecsOBOA.push(i)}}mapABOBtoBAOA(){const e=new zt(0,0);for(let t=0;t<this.isoVecsABOB.length;t++){const i=[];for(let r=0;r<3;r++)e.x=this.isoVecsABOB[t][r].x,e.y=this.isoVecsABOB[t][r].y,this.vertexTypes[t][r]===1&&e.rotate120(this.m,this.n),i.push(e.clone());this.isoVecsBAOA.push(i)}}MapToFace(e,t){const i=this.IDATA.face[e],r=i[2],s=i[1],o=i[0],a=_e.FromArray(this.IDATA.vertex[r]),l=_e.FromArray(this.IDATA.vertex[s]),h=_e.FromArray(this.IDATA.vertex[o]),c=l.subtract(a),u=h.subtract(a),d=c.scale(this.coau).add(u.scale(this.cobu)),f=c.scale(this.coav).add(u.scale(this.cobv));let p,g=Xt.Vector3[0];for(let m=0;m<this.cartesian.length;m++)g=d.scale(this.cartesian[m].x).add(f.scale(this.cartesian[m].y)).add(a),g.x,g.y,g.z,p=e+"|"+this.vertices[m].x+"|"+this.vertices[m].y,t.vertex[this.vecToidx[p]]=[g.x,g.y,g.z]}build(e,t){const i=[],r=zt.Zero(),s=new zt(e,t),o=new zt(-t,e+t);i.push(r,s,o);for(let _=t;_<e+1;_++)for(let T=0;T<e+1-_;T++)i.push(new zt(T,_));if(t>0){const _=jp.HCF(e,t),T=e/_,y=t/_;for(let D=1;D<_;D++)i.push(new zt(D*T,D*y)),i.push(new zt(-D*y,D*(T+y))),i.push(new zt(e-D*(T+y),t+D*T));const P=e/t;for(let D=1;D<t;D++)for(let F=0;F<D*P;F++)i.push(new zt(F,D)),i.push(new zt(F,D).rotate120(e,t)),i.push(new zt(F,D).rotateNeg120(e,t))}i.sort((_,T)=>_.x-T.x),i.sort((_,T)=>_.y-T.y);const a=new Array(e+t+1),l=new Array(e+t+1);for(let _=0;_<a.length;_++)a[_]=1/0,l[_]=-1/0;let h=0,c=0;const u=i.length;for(let _=0;_<u;_++)c=i[_].x,h=i[_].y,a[h]=Math.min(c,a[h]),l[h]=Math.max(c,l[h]);const d=(_,T)=>{const y=_.clone();return T==="A"&&y.rotateNeg120(e,t),T==="B"&&y.rotate120(e,t),y.x<0?y.y:y.x+y.y},f=[],p=[],g=[],m=[],x={},E=[];let R=-1,C=-1;for(let _=0;_<u;_++)f[_]=i[_].toCartesianOrigin(new zt(0,0),.5),p[_]=d(i[_],"O"),g[_]=d(i[_],"A"),m[_]=d(i[_],"B"),p[_]===g[_]&&g[_]===m[_]?(R=3,C=p[_]):p[_]===g[_]?(R=4,C=p[_]):g[_]===m[_]?(R=5,C=g[_]):m[_]===p[_]&&(R=6,C=p[_]),p[_]<g[_]&&p[_]<m[_]&&(R=2,C=p[_]),g[_]<p[_]&&g[_]<m[_]&&(R=1,C=g[_]),m[_]<g[_]&&m[_]<p[_]&&(R=0,C=m[_]),E.push([R,C,i[_].x,i[_].y]);E.sort((_,T)=>_[2]-T[2]),E.sort((_,T)=>_[3]-T[3]),E.sort((_,T)=>_[1]-T[1]),E.sort((_,T)=>_[0]-T[0]);for(let _=0;_<E.length;_++)x[E[_][2]+"|"+E[_][3]]=[E[_][0],E[_][1],_];return this.m=e,this.n=t,this.vertices=i,this.vertByDist=x,this.cartesian=f,this.min=a,this.max=l,this}}class Su{constructor(e,t,i,r){this.name=e,this.category=t,this.vertex=i,this.face=r}}class Vh extends Su{innerToData(e,t){for(let i=0;i<t.innerFacets.length;i++)this.face.push(t.innerFacets[i].map(r=>t.vecToidx[e+r]))}mapABOBtoDATA(e,t){const i=t.IDATA.edgematch[e][0];for(let r=0;r<t.isoVecsABOB.length;r++){const s=[];for(let o=0;o<3;o++)t.vertexTypes[r][o]===0?s.push(e+"|"+t.isoVecsABOB[r][o].x+"|"+t.isoVecsABOB[r][o].y):s.push(i+"|"+t.isoVecsABOB[r][o].x+"|"+t.isoVecsABOB[r][o].y);this.face.push([t.vecToidx[s[0]],t.vecToidx[s[1]],t.vecToidx[s[2]]])}}mapOBOAtoDATA(e,t){const i=t.IDATA.edgematch[e][0];for(let r=0;r<t.isoVecsOBOA.length;r++){const s=[];for(let o=0;o<3;o++)t.vertexTypes[r][o]===1?s.push(e+"|"+t.isoVecsOBOA[r][o].x+"|"+t.isoVecsOBOA[r][o].y):s.push(i+"|"+t.isoVecsOBOA[r][o].x+"|"+t.isoVecsOBOA[r][o].y);this.face.push([t.vecToidx[s[0]],t.vecToidx[s[1]],t.vecToidx[s[2]]])}}mapBAOAtoDATA(e,t){const i=t.IDATA.edgematch[e][2];for(let r=0;r<t.isoVecsBAOA.length;r++){const s=[];for(let o=0;o<3;o++)t.vertexTypes[r][o]===1?s.push(e+"|"+t.isoVecsBAOA[r][o].x+"|"+t.isoVecsBAOA[r][o].y):s.push(i+"|"+t.isoVecsBAOA[r][o].x+"|"+t.isoVecsBAOA[r][o].y);this.face.push([t.vecToidx[s[0]],t.vecToidx[s[1]],t.vecToidx[s[2]]])}}orderData(e){const t=[];for(let o=0;o<13;o++)t[o]=[];const i=e.closestTo;for(let o=0;o<i.length;o++)i[o][0]>-1?i[o][1]>0&&t[i[o][0]].push([o,i[o][1]]):t[12].push([o,i[o][0]]);const r=[];for(let o=0;o<12;o++)r[o]=o;let s=12;for(let o=0;o<12;o++){t[o].sort((a,l)=>a[1]-l[1]);for(let a=0;a<t[o].length;a++)r[t[o][a][0]]=s++}for(let o=0;o<t[12].length;o++)r[t[12][o][0]]=s++;for(let o=0;o<this.vertex.length;o++)this.vertex[o].push(r[o]);this.vertex.sort((o,a)=>o[3]-a[3]);for(let o=0;o<this.vertex.length;o++)this.vertex[o].pop();for(let o=0;o<this.face.length;o++)for(let a=0;a<this.face[o].length;a++)this.face[o][a]=r[this.face[o][a]];this.sharedNodes=t[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(e,t){const i=[],r=[];let s=t.pop();r.push(s);let o=this.face[s].indexOf(e);o=(o+2)%3;let a=this.face[s][o];i.push(a);let l=0;for(;t.length>0;)s=t[l],this.face[s].indexOf(a)>-1?(o=(this.face[s].indexOf(a)+1)%3,a=this.face[s][o],i.push(a),r.push(s),t.splice(l,1),l=0):l++;return this.adjacentFaces.push(i),r}toGoldbergPolyhedronData(){const e=new Su("GeoDual","Goldberg",[],[]);e.name="GD dual";const t=this.vertex.length,i=new Array(t);for(let h=0;h<t;h++)i[h]=[];for(let h=0;h<this.face.length;h++)for(let c=0;c<3;c++)i[this.face[h][c]].push(h);let r=0,s=0,o=0,a=[],l=[];this.adjacentFaces=[];for(let h=0;h<i.length;h++)e.face[h]=this.setOrder(h,i[h].concat([])),i[h].forEach(c=>{r=0,s=0,o=0,a=this.face[c];for(let u=0;u<3;u++)l=this.vertex[a[u]],r+=l[0],s+=l[1],o+=l[2];e.vertex[c]=[r/3,s/3,o/3]});return e}static BuildGeodesicData(e){const t=new Vh("Geodesic-m-n","Geodesic",[[0,hi,-1],[-hi,1,0],[-1,0,-hi],[1,0,-hi],[hi,1,0],[0,hi,1],[-1,0,hi],[-hi,-1,0],[0,-hi,-1],[hi,-1,0],[1,0,hi],[0,-hi,1]],[]);e.setIndices(),e.calcCoeffs(),e.createInnerFacets(),e.edgeVecsABOB(),e.mapABOBtoOBOA(),e.mapABOBtoBAOA();for(let r=0;r<e.IDATA.face.length;r++)e.MapToFace(r,t),t.innerToData(r,e),e.IDATA.edgematch[r][1]==="B"&&t.mapABOBtoDATA(r,e),e.IDATA.edgematch[r][1]==="O"&&t.mapOBOAtoDATA(r,e),e.IDATA.edgematch[r][3]==="A"&&t.mapBAOAtoDATA(r,e);t.orderData(e);const i=1;return t.vertex=t.vertex.map(function(r){const s=r[0],o=r[1],a=r[2],l=Math.sqrt(s*s+o*o+a*a);return r[0]*=i/l,r[1]*=i/l,r[2]*=i/l,r}),t}}function NR(n,e,t=null){let i=e.m||1;i!==Math.floor(i)&&Fr.Warn("m not an integer only floor(m) used");let r=e.n||0;if(r!==Math.floor(r)&&Fr.Warn("n not an integer only floor(n) used"),r>i){const h=r;r=i,i=h,Fr.Warn("n > m therefore m and n swapped")}const s=new k_;s.build(i,r);const a={custom:Vh.BuildGeodesicData(s),size:e.size,sizeX:e.sizeX,sizeY:e.sizeY,sizeZ:e.sizeZ,faceUV:e.faceUV,faceColors:e.faceColors,flat:e.flat,updatable:e.updatable,sideOrientation:e.sideOrientation,frontUVs:e.frontUVs,backUVs:e.backUVs};return U_(n,a,t)}function FR(n,e){const t=n.size,i=n.sizeX||t||1,r=n.sizeY||t||1,s=n.sizeZ||t||1,o=n.sideOrientation===0?0:n.sideOrientation||ca.DEFAULTSIDE,a=[],l=[],h=[],c=[];let u=1/0,d=-1/0,f=1/0,p=-1/0;for(let x=0;x<e.vertex.length;x++)u=Math.min(u,e.vertex[x][0]*i),d=Math.max(d,e.vertex[x][0]*i),f=Math.min(f,e.vertex[x][1]*r),p=Math.max(p,e.vertex[x][1]*r);let g=0;for(let x=0;x<e.face.length;x++){const E=e.face[x],R=_e.FromArray(e.vertex[E[0]]),C=_e.FromArray(e.vertex[E[2]]),_=_e.FromArray(e.vertex[E[1]]),T=C.subtract(R),y=_.subtract(R),P=_e.Cross(y,T).normalize();for(let D=0;D<E.length;D++){h.push(P.x,P.y,P.z);const F=e.vertex[E[D]];a.push(F[0]*i,F[1]*r,F[2]*s);const N=(F[1]*r-f)/(p-f);c.push((F[0]*i-u)/(d-u),eR.UseOpenGLOrientationForUV?1-N:N)}for(let D=0;D<E.length-2;D++)l.push(g,g+D+2,g+D+1);g+=E.length}ca._ComputeSides(o,a,l,h,c);const m=new ca;return m.positions=a,m.indices=l,m.normals=h,m.uvs=c,m}function LR(n,e,t=null){const i=e.size,r=e.sizeX||i||1,s=e.sizeY||i||1,o=e.sizeZ||i||1;let a=e.m||1;a!==Math.floor(a)&&Fr.Warn("m not an integer only floor(m) used");let l=e.n||0;if(l!==Math.floor(l)&&Fr.Warn("n not an integer only floor(n) used"),l>a){const p=l;l=a,a=p,Fr.Warn("n > m therefore m and n swapped")}const h=new k_;h.build(a,l);const c=Vh.BuildGeodesicData(h),u=c.toGoldbergPolyhedronData(),d=new $C(n,t);e.sideOrientation=ji._GetDefaultSideOrientation(e.sideOrientation),d._originalBuilderSideOrientation=e.sideOrientation,FR(e,u).applyToMesh(d,e.updatable),d.goldbergData.nbSharedFaces=c.sharedNodes,d.goldbergData.nbUnsharedFaces=c.poleNodes,d.goldbergData.adjacentFaces=c.adjacentFaces,d.goldbergData.nbFaces=d.goldbergData.nbSharedFaces+d.goldbergData.nbUnsharedFaces,d.goldbergData.nbFacesAtPole=(d.goldbergData.nbUnsharedFaces-12)/12;for(let p=0;p<c.vertex.length;p++)d.goldbergData.faceCenters.push(_e.FromArray(c.vertex[p])),d.goldbergData.faceCenters[p].x*=r,d.goldbergData.faceCenters[p].y*=s,d.goldbergData.faceCenters[p].z*=o,d.goldbergData.faceColors.push(new oh(1,1,1,1));for(let p=0;p<u.face.length;p++){const g=u.face[p],m=_e.FromArray(u.vertex[g[0]]),x=_e.FromArray(u.vertex[g[2]]),E=_e.FromArray(u.vertex[g[1]]),R=x.subtract(m),C=E.subtract(m),_=_e.Cross(C,R).normalize(),T=_e.Cross(C,_).normalize();d.goldbergData.faceXaxis.push(C.normalize()),d.goldbergData.faceYaxis.push(_),d.goldbergData.faceZaxis.push(T)}return d}const Bt={CreateBox:tR,CreateTiledBox:iR,CreateSphere:rR,CreateDisc:sR,CreateIcoSphere:nR,CreateRibbon:oR,CreateCylinder:aR,CreateTorus:lR,CreateTorusKnot:hR,CreateLineSystem:cR,CreateLines:uR,CreateDashedLines:dR,ExtrudeShape:fR,ExtrudeShapeCustom:pR,CreateLathe:gR,CreateTiledPlane:mR,CreatePlane:_R,CreateGround:vR,CreateTiledGround:ER,CreateGroundFromHeightMap:TR,CreatePolygon:xR,ExtrudePolygon:CR,CreateTube:RR,CreatePolyhedron:U_,CreateGeodesic:NR,CreateGoldberg:LR,CreateDecal:SR,CreateCapsule:yR,CreateText:bR};function wR(n){let e=n[0],t=n.slice(1),i=[];return e==="."?(this.selected.forEach(r=>i=i.concat(r==null?void 0:r.getChildren(s=>s.name==t))),new ai(i,this.scene)):e==="#"?(this.selected.forEach(r=>i=i.concat(r==null?void 0:r.getChildren(s=>s.id==t))),new ai(i,this.scene)):e==="$"?(this.selected.forEach(r=>i=i.concat(r==null?void 0:r.getChildren(s=>Ur.MatchesQuery(s,t)==!0))),new ai(i,this.scene)):new ai([],this.scene)}function UR(n){let e=[];return Array.isArray(n)?n.forEach((t,i)=>this.selected.forEach(r=>e=e.concat(r==null?void 0:r.getChildren(s=>s.name==t)))):this.selected.forEach(t=>e=e.concat(t==null?void 0:t.getChildren(i=>i.name==n))),new ai(e,this.scene)}function VR(n){let e=[];return Array.isArray(n)?n.forEach((t,i)=>this.selected.forEach(r=>e=e.concat(r==null?void 0:r.getChildren(s=>s.id==t)))):this.selected.forEach(t=>e=e.concat(t==null?void 0:t.getChildren(i=>i.id==n))),new ai(e,this.scene)}function BR(n){let e=[];return Array.isArray(n)?n.forEach((t,i)=>this.selected.forEach(r=>e=e.concat(r==null?void 0:r.getChildren(s=>Ur.MatchesQuery(s,t)==!0)))):this.selected.forEach(t=>e=e.concat(t==null?void 0:t.getChildren(i=>Ur.MatchesQuery(i,n)==!0))),new ai(e,this.scene)}const kR=["roboto-regular.png"],zR=[{id:40,index:12,char:"(",width:25,height:87,xoffset:3,yoffset:-2,xadvance:27,chnl:15,x:0,y:0,page:0},{id:41,index:13,char:")",width:25,height:87,xoffset:-1,yoffset:-2,xadvance:28,chnl:15,x:0,y:88,page:0},{id:91,index:63,char:"[",width:19,height:81,xoffset:4,yoffset:-3,xadvance:21,chnl:15,x:0,y:176,page:0},{id:93,index:65,char:"]",width:19,height:81,xoffset:-2,yoffset:-3,xadvance:21,chnl:15,x:0,y:258,page:0},{id:123,index:95,char:"{",width:28,height:81,xoffset:1,yoffset:0,xadvance:27,chnl:15,x:0,y:340,page:0},{id:125,index:97,char:"}",width:28,height:81,xoffset:-1,yoffset:0,xadvance:27,chnl:15,x:0,y:422,page:0},{id:106,index:78,char:"j",width:20,height:79,xoffset:-5,yoffset:4,xadvance:19,chnl:15,x:20,y:176,page:0},{id:36,index:8,char:"$",width:40,height:78,xoffset:2,yoffset:-4,xadvance:45,chnl:15,x:20,y:256,page:0},{id:64,index:36,char:"@",width:67,height:78,xoffset:3,yoffset:6,xadvance:72,chnl:15,x:26,y:0,page:0},{id:81,index:53,char:"Q",width:50,height:71,xoffset:2,yoffset:4,xadvance:55,chnl:15,x:26,y:79,page:0},{id:87,index:59,char:"W",width:71,height:61,xoffset:0,yoffset:5,xadvance:71,chnl:15,x:41,y:151,page:0},{id:124,index:96,char:"|",width:10,height:71,xoffset:5,yoffset:5,xadvance:19,chnl:15,x:77,y:79,page:0},{id:92,index:64,char:"\\",width:35,height:66,xoffset:0,yoffset:5,xadvance:33,chnl:15,x:88,y:79,page:0},{id:47,index:19,char:"/",width:34,height:66,xoffset:-1,yoffset:5,xadvance:33,chnl:15,x:94,y:0,page:0},{id:162,index:100,char:"¢",width:40,height:65,xoffset:2,yoffset:11,xadvance:44,chnl:15,x:29,y:335,page:0},{id:98,index:70,char:"b",width:40,height:65,xoffset:3,yoffset:2,xadvance:45,chnl:15,x:29,y:401,page:0},{id:100,index:72,char:"d",width:40,height:65,xoffset:2,yoffset:2,xadvance:45,chnl:15,x:61,y:213,page:0},{id:102,index:74,char:"f",width:30,height:65,xoffset:0,yoffset:1,xadvance:28,chnl:15,x:70,y:279,page:0},{id:103,index:75,char:"g",width:40,height:64,xoffset:2,yoffset:19,xadvance:45,chnl:15,x:70,y:345,page:0},{id:104,index:76,char:"h",width:37,height:64,xoffset:3,yoffset:2,xadvance:44,chnl:15,x:101,y:279,page:0},{id:107,index:79,char:"k",width:39,height:64,xoffset:4,yoffset:2,xadvance:41,chnl:15,x:102,y:213,page:0},{id:108,index:80,char:"l",width:11,height:64,xoffset:4,yoffset:2,xadvance:19,chnl:15,x:113,y:146,page:0},{id:37,index:9,char:"%",width:55,height:63,xoffset:2,yoffset:4,xadvance:59,chnl:15,x:124,y:67,page:0},{id:109,index:81,char:"m",width:63,height:47,xoffset:3,yoffset:19,xadvance:70,chnl:15,x:129,y:0,page:0},{id:112,index:84,char:"p",width:40,height:63,xoffset:3,yoffset:19,xadvance:45,chnl:15,x:125,y:131,page:0},{id:113,index:85,char:"q",width:40,height:63,xoffset:2,yoffset:19,xadvance:45,chnl:15,x:70,y:410,page:0},{id:121,index:93,char:"y",width:40,height:63,xoffset:-1,yoffset:20,xadvance:38,chnl:15,x:111,y:344,page:0},{id:163,index:101,char:"£",width:45,height:62,xoffset:2,yoffset:4,xadvance:46,chnl:15,x:139,y:278,page:0},{id:38,index:10,char:"&",width:50,height:62,xoffset:2,yoffset:4,xadvance:50,chnl:15,x:142,y:195,page:0},{id:48,index:20,char:"0",width:40,height:62,xoffset:2,yoffset:4,xadvance:45,chnl:15,x:166,y:131,page:0},{id:50,index:22,char:"2",width:42,height:62,xoffset:2,yoffset:4,xadvance:45,chnl:15,x:180,y:48,page:0},{id:51,index:23,char:"3",width:40,height:62,xoffset:2,yoffset:4,xadvance:45,chnl:15,x:111,y:408,page:0},{id:53,index:25,char:"5",width:40,height:62,xoffset:4,yoffset:5,xadvance:45,chnl:15,x:152,y:341,page:0},{id:54,index:26,char:"6",width:40,height:62,xoffset:3,yoffset:5,xadvance:45,chnl:15,x:185,y:258,page:0},{id:56,index:28,char:"8",width:40,height:62,xoffset:2,yoffset:4,xadvance:45,chnl:15,x:193,y:194,page:0},{id:57,index:29,char:"9",width:40,height:62,xoffset:2,yoffset:4,xadvance:45,chnl:15,x:207,y:111,page:0},{id:63,index:35,char:"?",width:36,height:62,xoffset:1,yoffset:4,xadvance:38,chnl:15,x:152,y:404,page:0},{id:67,index:39,char:"C",width:48,height:62,xoffset:3,yoffset:4,xadvance:52,chnl:15,x:189,y:404,page:0},{id:71,index:43,char:"G",width:48,height:62,xoffset:3,yoffset:4,xadvance:54,chnl:15,x:193,y:321,page:0},{id:74,index:46,char:"J",width:40,height:62,xoffset:0,yoffset:5,xadvance:44,chnl:15,x:226,y:257,page:0},{id:79,index:51,char:"O",width:50,height:62,xoffset:3,yoffset:4,xadvance:55,chnl:15,x:234,y:174,page:0},{id:83,index:55,char:"S",width:45,height:62,xoffset:1,yoffset:4,xadvance:47,chnl:15,x:223,y:0,page:0},{id:85,index:57,char:"U",width:45,height:62,xoffset:3,yoffset:5,xadvance:52,chnl:15,x:248,y:63,page:0},{id:105,index:77,char:"i",width:13,height:62,xoffset:4,yoffset:4,xadvance:19,chnl:15,x:269,y:0,page:0},{id:165,index:103,char:"¥",width:45,height:61,xoffset:-1,yoffset:5,xadvance:42,chnl:15,x:283,y:0,page:0},{id:161,index:99,char:"¡",width:13,height:61,xoffset:3,yoffset:19,xadvance:19,chnl:15,x:238,y:384,page:0},{id:33,index:5,char:"!",width:13,height:61,xoffset:4,yoffset:5,xadvance:21,chnl:15,x:242,y:320,page:0},{id:35,index:7,char:"#",width:48,height:61,xoffset:3,yoffset:5,xadvance:49,chnl:15,x:238,y:446,page:0},{id:49,index:21,char:"1",width:26,height:61,xoffset:5,yoffset:5,xadvance:45,chnl:15,x:252,y:382,page:0},{id:52,index:24,char:"4",width:45,height:61,xoffset:0,yoffset:5,xadvance:45,chnl:15,x:256,y:320,page:0},{id:55,index:27,char:"7",width:42,height:61,xoffset:1,yoffset:5,xadvance:45,chnl:15,x:279,y:382,page:0},{id:65,index:37,char:"A",width:54,height:61,xoffset:-1,yoffset:5,xadvance:52,chnl:15,x:287,y:444,page:0},{id:66,index:38,char:"B",width:43,height:61,xoffset:5,yoffset:5,xadvance:50,chnl:15,x:267,y:237,page:0},{id:68,index:40,char:"D",width:45,height:61,xoffset:5,yoffset:5,xadvance:52,chnl:15,x:302,y:299,page:0},{id:69,index:41,char:"E",width:40,height:61,xoffset:5,yoffset:5,xadvance:45,chnl:15,x:322,y:361,page:0},{id:70,index:42,char:"F",width:39,height:61,xoffset:5,yoffset:5,xadvance:44,chnl:15,x:342,y:423,page:0},{id:72,index:44,char:"H",width:48,height:61,xoffset:5,yoffset:5,xadvance:57,chnl:15,x:285,y:126,page:0},{id:73,index:45,char:"I",width:12,height:61,xoffset:5,yoffset:5,xadvance:22,chnl:15,x:294,y:62,page:0},{id:75,index:47,char:"K",width:48,height:61,xoffset:5,yoffset:5,xadvance:50,chnl:15,x:307,y:62,page:0},{id:76,index:48,char:"L",width:38,height:61,xoffset:5,yoffset:5,xadvance:43,chnl:15,x:329,y:0,page:0},{id:77,index:49,char:"M",width:61,height:61,xoffset:5,yoffset:5,xadvance:70,chnl:15,x:311,y:188,page:0},{id:78,index:50,char:"N",width:48,height:61,xoffset:5,yoffset:5,xadvance:57,chnl:15,x:334,y:124,page:0},{id:80,index:52,char:"P",width:45,height:61,xoffset:5,yoffset:5,xadvance:50,chnl:15,x:356,y:62,page:0},{id:82,index:54,char:"R",width:45,height:61,xoffset:5,yoffset:5,xadvance:49,chnl:15,x:368,y:0,page:0},{id:84,index:56,char:"T",width:48,height:61,xoffset:0,yoffset:5,xadvance:48,chnl:15,x:348,y:250,page:0},{id:86,index:58,char:"V",width:53,height:61,xoffset:-1,yoffset:5,xadvance:51,chnl:15,x:373,y:186,page:0},{id:88,index:60,char:"X",width:50,height:61,xoffset:0,yoffset:5,xadvance:50,chnl:15,x:383,y:124,page:0},{id:89,index:61,char:"Y",width:51,height:61,xoffset:-1,yoffset:5,xadvance:48,chnl:15,x:402,y:62,page:0},{id:90,index:62,char:"Z",width:45,height:61,xoffset:1,yoffset:5,xadvance:48,chnl:15,x:414,y:0,page:0},{id:119,index:91,char:"w",width:61,height:46,xoffset:0,yoffset:20,xadvance:60,chnl:15,x:348,y:312,page:0},{id:59,index:31,char:";",width:16,height:58,xoffset:0,yoffset:19,xadvance:17,chnl:15,x:363,y:359,page:0},{id:116,index:88,char:"t",width:27,height:57,xoffset:-2,yoffset:10,xadvance:26,chnl:15,x:397,y:248,page:0},{id:164,index:102,char:"¤",width:53,height:54,xoffset:2,yoffset:13,xadvance:57,chnl:15,x:454,y:62,page:0},{id:97,index:69,char:"a",width:39,height:48,xoffset:2,yoffset:19,xadvance:44,chnl:15,x:460,y:0,page:0},{id:99,index:71,char:"c",width:40,height:48,xoffset:2,yoffset:19,xadvance:42,chnl:15,x:380,y:359,page:0},{id:101,index:73,char:"e",width:40,height:48,xoffset:2,yoffset:19,xadvance:42,chnl:15,x:410,y:306,page:0},{id:111,index:83,char:"o",width:42,height:48,xoffset:2,yoffset:19,xadvance:46,chnl:15,x:425,y:248,page:0},{id:115,index:87,char:"s",width:38,height:48,xoffset:2,yoffset:19,xadvance:41,chnl:15,x:468,y:117,page:0},{id:126,index:98,char:"~",width:48,height:20,xoffset:3,yoffset:31,xadvance:54,chnl:15,x:342,y:485,page:0},{id:58,index:30,char:":",width:13,height:47,xoffset:3,yoffset:19,xadvance:19,chnl:15,x:193,y:0,page:0},{id:110,index:82,char:"n",width:37,height:47,xoffset:3,yoffset:19,xadvance:44,chnl:15,x:468,y:166,page:0},{id:114,index:86,char:"r",width:24,height:47,xoffset:3,yoffset:19,xadvance:27,chnl:15,x:223,y:63,page:0},{id:117,index:89,char:"u",width:37,height:47,xoffset:3,yoffset:20,xadvance:44,chnl:15,x:427,y:186,page:0},{id:118,index:90,char:"v",width:40,height:46,xoffset:-1,yoffset:20,xadvance:39,chnl:15,x:468,y:214,page:0},{id:120,index:92,char:"x",width:40,height:46,xoffset:0,yoffset:20,xadvance:40,chnl:15,x:468,y:261,page:0},{id:122,index:94,char:"z",width:38,height:46,xoffset:1,yoffset:20,xadvance:40,chnl:15,x:451,y:308,page:0},{id:43,index:15,char:"+",width:43,height:45,xoffset:1,yoffset:15,xadvance:45,chnl:15,x:152,y:467,page:0},{id:95,index:67,char:"_",width:40,height:10,xoffset:-2,yoffset:62,xadvance:36,chnl:15,x:29,y:467,page:0},{id:60,index:32,char:"<",width:36,height:39,xoffset:1,yoffset:19,xadvance:41,chnl:15,x:248,y:126,page:0},{id:62,index:34,char:">",width:37,height:39,xoffset:3,yoffset:19,xadvance:42,chnl:15,x:111,y:471,page:0},{id:42,index:14,char:"*",width:36,height:37,xoffset:-1,yoffset:5,xadvance:34,chnl:15,x:311,y:250,page:0},{id:61,index:33,char:"=",width:37,height:27,xoffset:4,yoffset:24,xadvance:44,chnl:15,x:70,y:474,page:0},{id:171,index:109,char:"«",width:34,height:35,xoffset:2,yoffset:25,xadvance:38,chnl:15,x:196,y:467,page:0},{id:94,index:66,char:"^",width:32,height:32,xoffset:1,yoffset:5,xadvance:33,chnl:15,x:434,y:124,page:0},{id:44,index:16,char:",",width:15,height:24,xoffset:-1,yoffset:53,xadvance:16,chnl:15,x:207,y:0,page:0},{id:34,index:6,char:'"',width:20,height:23,xoffset:3,yoffset:2,xadvance:26,chnl:15,x:490,y:308,page:0},{id:39,index:11,char:"'",width:10,height:23,xoffset:2,yoffset:2,xadvance:14,chnl:15,x:26,y:151,page:0},{id:45,index:17,char:"-",width:23,height:10,xoffset:-1,yoffset:35,xadvance:22,chnl:15,x:311,y:288,page:0},{id:96,index:68,char:"`",width:20,height:15,xoffset:0,yoffset:2,xadvance:25,chnl:15,x:490,y:332,page:0},{id:46,index:18,char:".",width:13,height:13,xoffset:4,yoffset:54,xadvance:21,chnl:15,x:427,y:234,page:0},{id:32,index:4,char:" ",width:0,height:0,xoffset:-2,yoffset:62,xadvance:20,chnl:15,x:124,y:131,page:0}],GR={face:"Roboto-Regular",size:80,bold:0,italic:0,charset:["«","¢","£","¤","¥","¡","!","\\",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/","0","1","2","3","4","5","6","7","8","9",":",";","<","=",">","?","@","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","[","]","^","_","`","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","{","|","}","~"," "],unicode:1,stretchH:100,smooth:1,aa:1,padding:[2,2,2,2],spacing:[0,0]},WR={lineHeight:84,base:62,scaleW:512,scaleH:512,pages:1,packed:0,alphaChnl:0,redChnl:0,greenChnl:0,blueChnl:0},XR={fieldType:"msdf",distanceRange:4},HR=[{first:34,second:34,amount:-4},{first:34,second:39,amount:-4},{first:34,second:65,amount:-5},{first:34,second:97,amount:-2},{first:34,second:99,amount:-2},{first:34,second:100,amount:-2},{first:34,second:101,amount:-2},{first:34,second:103,amount:-2},{first:34,second:109,amount:-1},{first:34,second:110,amount:-1},{first:34,second:111,amount:-2},{first:34,second:112,amount:-1},{first:34,second:113,amount:-2},{first:34,second:115,amount:-3},{first:34,second:119,amount:0},{first:39,second:34,amount:-4},{first:39,second:39,amount:-4},{first:39,second:65,amount:-5},{first:39,second:97,amount:-2},{first:39,second:99,amount:-2},{first:39,second:100,amount:-2},{first:39,second:101,amount:-2},{first:39,second:103,amount:-2},{first:39,second:109,amount:-1},{first:39,second:110,amount:-1},{first:39,second:111,amount:-2},{first:39,second:112,amount:-1},{first:39,second:113,amount:-2},{first:39,second:115,amount:-3},{first:39,second:119,amount:0},{first:40,second:86,amount:1},{first:40,second:87,amount:1},{first:40,second:89,amount:1},{first:44,second:34,amount:-7},{first:44,second:39,amount:-7},{first:46,second:34,amount:-7},{first:46,second:39,amount:-7},{first:47,second:47,amount:-9},{first:65,second:34,amount:-5},{first:65,second:39,amount:-5},{first:65,second:63,amount:-2},{first:65,second:67,amount:0},{first:65,second:71,amount:0},{first:65,second:79,amount:0},{first:65,second:81,amount:0},{first:65,second:84,amount:-5},{first:65,second:85,amount:-1},{first:65,second:86,amount:-3},{first:65,second:87,amount:-3},{first:65,second:89,amount:-4},{first:65,second:111,amount:0},{first:65,second:116,amount:-1},{first:65,second:117,amount:0},{first:65,second:118,amount:-2},{first:65,second:119,amount:-1},{first:65,second:121,amount:-2},{first:65,second:122,amount:0},{first:66,second:84,amount:-1},{first:66,second:86,amount:-1},{first:66,second:89,amount:-2},{first:67,second:41,amount:-1},{first:67,second:84,amount:-1},{first:67,second:93,amount:0},{first:67,second:125,amount:-1},{first:68,second:44,amount:-4},{first:68,second:46,amount:-4},{first:68,second:65,amount:-1},{first:68,second:84,amount:-1},{first:68,second:86,amount:-1},{first:68,second:88,amount:-1},{first:68,second:89,amount:-2},{first:68,second:90,amount:-1},{first:69,second:84,amount:1},{first:69,second:99,amount:-1},{first:69,second:100,amount:-1},{first:69,second:101,amount:-1},{first:69,second:102,amount:-1},{first:69,second:103,amount:-1},{first:69,second:111,amount:-1},{first:69,second:113,amount:-1},{first:69,second:117,amount:-1},{first:69,second:118,amount:-1},{first:69,second:119,amount:-1},{first:69,second:121,amount:-1},{first:70,second:44,amount:-9},{first:70,second:46,amount:-9},{first:70,second:65,amount:-7},{first:70,second:74,amount:-10},{first:70,second:84,amount:1},{first:70,second:97,amount:-1},{first:70,second:99,amount:-1},{first:70,second:100,amount:-1},{first:70,second:101,amount:-1},{first:70,second:103,amount:-1},{first:70,second:111,amount:-1},{first:70,second:113,amount:-1},{first:70,second:114,amount:-1},{first:70,second:117,amount:-1},{first:70,second:118,amount:-1},{first:70,second:121,amount:-1},{first:72,second:65,amount:1},{first:72,second:84,amount:-1},{first:72,second:88,amount:1},{first:72,second:89,amount:-1},{first:73,second:65,amount:1},{first:73,second:84,amount:-1},{first:73,second:88,amount:1},{first:73,second:89,amount:-1},{first:74,second:65,amount:-1},{first:75,second:45,amount:-2},{first:75,second:67,amount:-1},{first:75,second:71,amount:-1},{first:75,second:79,amount:-1},{first:75,second:81,amount:-1},{first:75,second:99,amount:-1},{first:75,second:100,amount:-1},{first:75,second:101,amount:-1},{first:75,second:103,amount:-1},{first:75,second:109,amount:-1},{first:75,second:110,amount:-1},{first:75,second:111,amount:-1},{first:75,second:112,amount:-1},{first:75,second:113,amount:-1},{first:75,second:117,amount:-1},{first:75,second:118,amount:-2},{first:75,second:119,amount:-2},{first:75,second:121,amount:-2},{first:76,second:34,amount:-13},{first:76,second:39,amount:-13},{first:76,second:65,amount:1},{first:76,second:67,amount:-3},{first:76,second:71,amount:-3},{first:76,second:79,amount:-3},{first:76,second:81,amount:-3},{first:76,second:84,amount:-11},{first:76,second:85,amount:-2},{first:76,second:86,amount:-7},{first:76,second:87,amount:-6},{first:76,second:89,amount:-9},{first:76,second:117,amount:-2},{first:76,second:118,amount:-5},{first:76,second:119,amount:-4},{first:76,second:121,amount:-5},{first:77,second:65,amount:1},{first:77,second:84,amount:-1},{first:77,second:88,amount:1},{first:77,second:89,amount:-1},{first:78,second:65,amount:1},{first:78,second:84,amount:-1},{first:78,second:88,amount:1},{first:78,second:89,amount:-1},{first:79,second:44,amount:-4},{first:79,second:46,amount:-4},{first:79,second:65,amount:-1},{first:79,second:84,amount:-1},{first:79,second:86,amount:-1},{first:79,second:88,amount:-1},{first:79,second:89,amount:-2},{first:79,second:90,amount:-1},{first:80,second:44,amount:-13},{first:80,second:46,amount:-13},{first:80,second:65,amount:-5},{first:80,second:74,amount:-8},{first:80,second:88,amount:-1},{first:80,second:90,amount:-1},{first:80,second:97,amount:0},{first:80,second:99,amount:-1},{first:80,second:100,amount:-1},{first:80,second:101,amount:-1},{first:80,second:103,amount:-1},{first:80,second:111,amount:-1},{first:80,second:113,amount:-1},{first:80,second:116,amount:1},{first:80,second:118,amount:1},{first:80,second:121,amount:1},{first:81,second:84,amount:-2},{first:81,second:86,amount:-1},{first:81,second:87,amount:-1},{first:81,second:89,amount:-1},{first:82,second:84,amount:-3},{first:82,second:86,amount:-1},{first:82,second:89,amount:-2},{first:84,second:171,amount:-13},{first:84,second:44,amount:-9},{first:84,second:45,amount:-9},{first:84,second:46,amount:-9},{first:84,second:65,amount:-3},{first:84,second:67,amount:-1},{first:84,second:71,amount:-1},{first:84,second:74,amount:-9},{first:84,second:79,amount:-1},{first:84,second:81,amount:-1},{first:84,second:83,amount:-1},{first:84,second:84,amount:1},{first:84,second:86,amount:1},{first:84,second:87,amount:1},{first:84,second:89,amount:1},{first:84,second:97,amount:-4},{first:84,second:99,amount:-4},{first:84,second:100,amount:-4},{first:84,second:101,amount:-4},{first:84,second:103,amount:-4},{first:84,second:109,amount:-4},{first:84,second:110,amount:-4},{first:84,second:111,amount:-4},{first:84,second:112,amount:-4},{first:84,second:113,amount:-4},{first:84,second:114,amount:-3},{first:84,second:115,amount:-5},{first:84,second:117,amount:-4},{first:84,second:118,amount:-3},{first:84,second:119,amount:-2},{first:84,second:120,amount:-3},{first:84,second:121,amount:-3},{first:84,second:122,amount:-2},{first:84,second:32,amount:-2},{first:85,second:65,amount:-1},{first:86,second:41,amount:1},{first:86,second:44,amount:-9},{first:86,second:45,amount:-1},{first:86,second:46,amount:-9},{first:86,second:65,amount:-3},{first:86,second:67,amount:-1},{first:86,second:71,amount:-1},{first:86,second:79,amount:-1},{first:86,second:81,amount:-1},{first:86,second:93,amount:1},{first:86,second:97,amount:-2},{first:86,second:99,amount:-2},{first:86,second:100,amount:-2},{first:86,second:101,amount:-2},{first:86,second:103,amount:-2},{first:86,second:111,amount:-2},{first:86,second:113,amount:-2},{first:86,second:114,amount:-1},{first:86,second:117,amount:-1},{first:86,second:118,amount:0},{first:86,second:121,amount:0},{first:86,second:125,amount:1},{first:87,second:41,amount:1},{first:87,second:44,amount:-5},{first:87,second:45,amount:-2},{first:87,second:46,amount:-5},{first:87,second:65,amount:-2},{first:87,second:84,amount:1},{first:87,second:93,amount:0},{first:87,second:97,amount:-1},{first:87,second:99,amount:-1},{first:87,second:100,amount:-1},{first:87,second:101,amount:-1},{first:87,second:103,amount:-1},{first:87,second:111,amount:-1},{first:87,second:113,amount:-1},{first:87,second:114,amount:-1},{first:87,second:117,amount:-1},{first:87,second:125,amount:1},{first:88,second:45,amount:-2},{first:88,second:67,amount:-1},{first:88,second:71,amount:-1},{first:88,second:79,amount:-1},{first:88,second:81,amount:-1},{first:88,second:86,amount:1},{first:88,second:99,amount:-1},{first:88,second:100,amount:-1},{first:88,second:101,amount:-1},{first:88,second:103,amount:-1},{first:88,second:111,amount:-1},{first:88,second:113,amount:-1},{first:88,second:117,amount:-1},{first:88,second:118,amount:-1},{first:88,second:121,amount:-1},{first:89,second:171,amount:-3},{first:89,second:38,amount:-1},{first:89,second:41,amount:1},{first:89,second:42,amount:-2},{first:89,second:44,amount:-8},{first:89,second:45,amount:-2},{first:89,second:46,amount:-8},{first:89,second:65,amount:-4},{first:89,second:67,amount:-1},{first:89,second:71,amount:-1},{first:89,second:74,amount:-4},{first:89,second:79,amount:-1},{first:89,second:81,amount:-1},{first:89,second:83,amount:-1},{first:89,second:84,amount:1},{first:89,second:85,amount:-4},{first:89,second:86,amount:1},{first:89,second:87,amount:1},{first:89,second:88,amount:1},{first:89,second:89,amount:1},{first:89,second:93,amount:1},{first:89,second:97,amount:-3},{first:89,second:99,amount:-3},{first:89,second:100,amount:-3},{first:89,second:101,amount:-3},{first:89,second:102,amount:-1},{first:89,second:103,amount:-3},{first:89,second:109,amount:-2},{first:89,second:110,amount:-2},{first:89,second:111,amount:-3},{first:89,second:112,amount:-2},{first:89,second:113,amount:-3},{first:89,second:114,amount:-2},{first:89,second:115,amount:-2},{first:89,second:116,amount:-1},{first:89,second:117,amount:-2},{first:89,second:118,amount:-1},{first:89,second:120,amount:-1},{first:89,second:121,amount:-1},{first:89,second:122,amount:-1},{first:89,second:125,amount:1},{first:90,second:65,amount:1},{first:90,second:67,amount:-1},{first:90,second:71,amount:-1},{first:90,second:79,amount:-1},{first:90,second:81,amount:-1},{first:90,second:99,amount:-1},{first:90,second:100,amount:-1},{first:90,second:101,amount:-1},{first:90,second:103,amount:-1},{first:90,second:111,amount:-1},{first:90,second:113,amount:-1},{first:90,second:117,amount:-1},{first:90,second:118,amount:-1},{first:90,second:119,amount:-1},{first:90,second:121,amount:-1},{first:91,second:74,amount:-1},{first:91,second:85,amount:-1},{first:97,second:34,amount:-3},{first:97,second:39,amount:-3},{first:97,second:118,amount:-1},{first:97,second:121,amount:-1},{first:98,second:34,amount:-1},{first:98,second:39,amount:-1},{first:98,second:118,amount:0},{first:98,second:120,amount:-1},{first:98,second:121,amount:0},{first:98,second:122,amount:-1},{first:99,second:34,amount:0},{first:99,second:39,amount:0},{first:101,second:34,amount:-1},{first:101,second:39,amount:-1},{first:101,second:118,amount:-1},{first:101,second:121,amount:-1},{first:102,second:34,amount:1},{first:102,second:39,amount:1},{first:102,second:41,amount:1},{first:102,second:93,amount:1},{first:102,second:99,amount:-1},{first:102,second:100,amount:-1},{first:102,second:101,amount:-1},{first:102,second:103,amount:-1},{first:102,second:113,amount:-1},{first:102,second:125,amount:1},{first:104,second:34,amount:-4},{first:104,second:39,amount:-4},{first:107,second:99,amount:-1},{first:107,second:100,amount:-1},{first:107,second:101,amount:-1},{first:107,second:103,amount:-1},{first:107,second:113,amount:-1},{first:109,second:34,amount:-4},{first:109,second:39,amount:-4},{first:110,second:34,amount:-4},{first:110,second:39,amount:-4},{first:111,second:34,amount:-5},{first:111,second:39,amount:-5},{first:111,second:118,amount:-1},{first:111,second:120,amount:-1},{first:111,second:121,amount:-1},{first:111,second:122,amount:-1},{first:112,second:34,amount:-1},{first:112,second:39,amount:-1},{first:112,second:118,amount:0},{first:112,second:120,amount:-1},{first:112,second:121,amount:0},{first:112,second:122,amount:-1},{first:114,second:34,amount:1},{first:114,second:39,amount:1},{first:114,second:44,amount:-5},{first:114,second:46,amount:-5},{first:114,second:97,amount:-2},{first:114,second:99,amount:-1},{first:114,second:100,amount:-1},{first:114,second:101,amount:-1},{first:114,second:102,amount:1},{first:114,second:103,amount:-1},{first:114,second:111,amount:-1},{first:114,second:113,amount:-1},{first:114,second:116,amount:2},{first:114,second:118,amount:1},{first:114,second:119,amount:1},{first:114,second:121,amount:1},{first:116,second:111,amount:-1},{first:118,second:34,amount:1},{first:118,second:39,amount:1},{first:118,second:44,amount:-4},{first:118,second:46,amount:-4},{first:118,second:97,amount:-1},{first:118,second:99,amount:-1},{first:118,second:100,amount:-1},{first:118,second:101,amount:-1},{first:118,second:102,amount:1},{first:118,second:103,amount:-1},{first:118,second:111,amount:-1},{first:118,second:113,amount:-1},{first:119,second:44,amount:-5},{first:119,second:46,amount:-5},{first:120,second:99,amount:-1},{first:120,second:100,amount:-1},{first:120,second:101,amount:-1},{first:120,second:103,amount:-1},{first:120,second:111,amount:-1},{first:120,second:113,amount:-1},{first:121,second:34,amount:1},{first:121,second:39,amount:1},{first:121,second:44,amount:-4},{first:121,second:46,amount:-4},{first:121,second:97,amount:-1},{first:121,second:99,amount:-1},{first:121,second:100,amount:-1},{first:121,second:101,amount:-1},{first:121,second:102,amount:1},{first:121,second:103,amount:-1},{first:121,second:111,amount:-1},{first:121,second:113,amount:-1},{first:122,second:99,amount:-1},{first:122,second:100,amount:-1},{first:122,second:101,amount:-1},{first:122,second:103,amount:-1},{first:122,second:111,amount:-1},{first:122,second:113,amount:-1},{first:123,second:74,amount:-1},{first:123,second:85,amount:-1},{first:32,second:84,amount:-2}],KR={pages:kR,chars:zR,info:GR,common:WR,distanceField:XR,kernings:HR},z_="data:image/png;base64,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QiAEQiAEH6OuJ3JeJ4eu96Xb7bp//77R0VEjIyMGBwf19vb6/PPPHRscHPTNN984c+aM5eVlaZra3Ny0t7fn6OhIPp9XLBYNDw8rl8smJydNTEx40d27d926dcudO3fcu3dPvV73sbl06ZJqtapWq7l8+bLp6WknNZtNs7OzfvOb35idnXXr1i137961vr7utLa3t927d8/y8rJWq2V7e1u73faDQqFgamrKscnJSZ999pksy6ytrVldXZWmqZeZWcKSD2TG29rAjD8dk//ZJL/Cr/Ar9Hvev8e/wa/xbw7IMu9i2e9MeifjxuX9I/wK/wi/9Lw9/Bq/xq8tL/8rQ78Y8rnruI7r+Pue928wgxl+M8PRkVf57hdeqajoC9dxHdfxn3jeX2MGM7777v/2dhaw62NR8C5yaHtnOzs7vv32W2maGhsbMzQ0JJfL2d/f12q1LCwsSNPUaR0cEALr64RACJRKnokioohSiShib08iEYvFYonEU90uWUaWkWVkmTfJMlotWi2yjGrVE8PDxDFxTBwzMsLmpkgkEolEIpHnhEAIhMD6uo9ZFzmvk0PX+7K2tub27duKxaLe3l7dble73Xb58mV9fX2OjY+PGx8fd3h4aGtry/7+vqOjI/l8Xn9/v+HhYT09PV50cHDg7t27bt26ZXZ21q1bt9y+fVuapj4m4+PjLly44OLFiy5duqRarTppZ2fH7du33bx50+zsrO+//97s7Kx2u+1dbG5u+u677xwcHOh2uwqFgmKxaGhoSKlUcqxarVpdXbW8vGxpacni4qKlpSUvevjwr/HX+Kfev4fe1sPv8T3+J38Sxlev+3IVq1jFOc8bwxjGMPYdWeZd/JXfue6djBnztTGMoeL3rWAFK8yu+KtlXGcKn3uD33ij7657rQl84Q1u8J23dRs5H4uCV+oi50M5ODhw9+5dd+/e1dfXJ5fLOTg40O12vYsQCIEQCIFSyTOlElFEFFEqsboqFkskYrFY7KksI8vIMrKM3V1v0mrRapFltFrs7VEseiKOiWPimDhmc1MkUlISiUQizwmBEAiBEHzsup7IeZWcJ7reh4cPHyoUCn7Qbrft7OxYX1934cIF09PTTurp6VEqlZzGwsKCubk59+/fd+fOHbdu3TI7O2tubs7HZnp62rlz55w/f96FCxcMDAw46f79++7evev27dtu3bpl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",Ms=({engine:n,data:e,kind:t,stride:i,mesh:r})=>{const s=new OR(n,e,t,!0,!1,i);r.setVerticesBuffer(s)},qR=`
precision highp float; 

attribute vec3 position; 
attribute vec2 uv; 
attribute vec2 center; 

uniform mat4 worldViewProjection; 

varying vec2 vUv;
varying vec2 vCenter; 

void main(void) { 
  gl_Position = worldViewProjection * vec4(position, 1.0); 
  vUv = uv; 
  vCenter = center;
}
`,YR=`
precision highp float;

varying vec2 vUv; 
varying vec2 vCenter; 

uniform sampler2D uFontAtlas;

uniform vec3 uStrokeColor;
uniform vec3 uColor;

uniform float uThreshold;
uniform float uStrokeOutsetWidth;
uniform float uStrokeInsetWidth;
uniform float  uOpacity;
uniform float uAlphaTest;

uniform int uLinesTotal;
uniform int uWordsTotal;
uniform int uLettersTotal;

float median(float r, float g, float b) {
  return max(min(r, g), min(max(r, g), b));
}


void main(void) { 

  float thickness = 0.5;
  float softness = 0.5;

  vec3 s = texture2D(uFontAtlas, vUv).rgb;
  float sigDist = median(s.r, s.g, s.b) - 0.5;
  float afwidth = 1.4142135623730951 / 2.0;

  #ifdef IS_SMALL
  float alpha = smoothstep(uThreshold - afwidth, uThreshold + afwidth, sigDist);
  #else
  float alpha = clamp(sigDist / fwidth(sigDist) + 0.5, 0.0, 1.0);
  #endif
  
  float sigDistOutset = sigDist + uStrokeOutsetWidth * 0.5;
  
  // Inset
  float sigDistInset = sigDist - uStrokeInsetWidth * 0.5;
  
  #ifdef IS_SMALL
  float outset = smoothstep(uThreshold - afwidth, uThreshold + afwidth, sigDistOutset);
  float inset = 1.0 - smoothstep(uThreshold - afwidth, uThreshold + afwidth, sigDistInset);
  #else
  float outset = clamp(sigDistOutset / fwidth(sigDistOutset) + 0.5, 0.0, 1.0);
  float inset = 1.0 - clamp(sigDistInset / fwidth(sigDistInset) + 0.5, 0.0, 1.0);
  #endif
  
  float border = outset * inset;
  
  // Alpha Test
  if (alpha < uAlphaTest) discard;

  // Output: Common
  vec4 filledFragColor = vec4(uColor, uOpacity * alpha);
  
  // Output: Strokes
  vec4 strokedFragColor = vec4(uStrokeColor, uOpacity * border);
  
  gl_FragColor = filledFragColor; 
}
`;function G_(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var ZR=function(n){switch(n){case"int8":return Int8Array;case"int16":return Int16Array;case"int32":return Int32Array;case"uint8":return Uint8Array;case"uint16":return Uint16Array;case"uint32":return Uint32Array;case"float32":return Float32Array;case"float64":return Float64Array;case"array":return Array;case"uint8_clamped":return Uint8ClampedArray}},jR=Object.prototype.toString,QR=JR;function JR(n){return n.BYTES_PER_ELEMENT&&jR.call(n.buffer)==="[object ArrayBuffer]"||Array.isArray(n)}/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var $R=function(n){return n!=null&&(W_(n)||eS(n)||!!n._isBuffer)};function W_(n){return!!n.constructor&&typeof n.constructor.isBuffer=="function"&&n.constructor.isBuffer(n)}function eS(n){return typeof n.readFloatLE=="function"&&typeof n.slice=="function"&&W_(n.slice(0,0))}var tS=ZR,iS=QR,rS=$R,sS=[0,2,3],nS=[2,1,3],oS=function(n,e){(!n||!(iS(n)||rS(n)))&&(e=n||{},n=null),typeof e=="number"?e={count:e}:e=e||{};for(var t=typeof e.type=="string"?e.type:"uint16",i=typeof e.count=="number"?e.count:1,r=e.start||0,s=e.clockwise!==!1?sS:nS,o=s[0],a=s[1],l=s[2],h=i*6,c=n||new(tS(t))(h),u=0,d=0;u<h;u+=6,d+=4){var f=u+r;c[f+0]=d+0,c[f+1]=d+1,c[f+2]=d+2,c[f+3]=d+o,c[f+4]=d+a,c[f+5]=d+l}return c};const aS=G_(oS);var X_={exports:{}};(function(n){var e=/\n/,t=`
`,i=/\s/;n.exports=function(h,c){var u=n.exports.lines(h,c);return u.map(function(d){return h.substring(d.start,d.end)}).join(`
`)},n.exports.lines=function(h,c){if(c=c||{},c.width===0&&c.mode!=="nowrap")return[];h=h||"";var u=typeof c.width=="number"?c.width:Number.MAX_VALUE,d=Math.max(0,c.start||0),f=typeof c.end=="number"?c.end:h.length,p=c.mode,g=c.measure||l;return p==="pre"?o(g,h,d,f,u):a(g,h,d,f,u,p)};function r(h,c,u,d){var f=h.indexOf(c,u);return f===-1||f>d?d:f}function s(h){return i.test(h)}function o(h,c,u,d,f){for(var p=[],g=u,m=u;m<d&&m<c.length;m++){var x=c.charAt(m),E=e.test(x);if(E||m===d-1){var R=E?m:m+1,C=h(c,g,R,f);p.push(C),g=m+1}}return p}function a(h,c,u,d,f,p){var g=[],m=f;for(p==="nowrap"&&(m=Number.MAX_VALUE);u<d&&u<c.length;){for(var x=r(c,t,u,d);u<x&&s(c.charAt(u));)u++;var E=h(c,u,x,m),R=u+(E.end-E.start),C=R+t.length;if(R<x){for(;R>u&&!s(c.charAt(R));)R--;if(R===u)C>u+t.length&&C--,R=C;else for(C=R;R>u&&s(c.charAt(R-t.length));)R--}if(R>=u){var _=h(c,u,R,m);g.push(_)}u=C}return g}function l(h,c,u,d){var f=Math.min(d,u-c);return{start:c,end:c+f}}})(X_);var lS=X_.exports;const hS=G_(lS),$p=["x","e","a","o","n","s","r","c","u","m","v","w","z"],eg=["m","w"],tg=["H","I","N","E","F","K","L","T","U","V","W","X","Y","Z"],ig=9,sa=32,cS=0,H_=1,K_=2;class uS{constructor(e={}){this.glyphs=[],this._measure=this.computeMetrics.bind(this),this.update(e)}get width(){return this._width}get height(){return this._height}get descender(){return this._descender}get ascender(){return this._ascender}get xHeight(){return this._xHeight}get baseline(){return this._baseline}get capHeight(){return this._capHeight}get lineHeight(){return this._lineHeight}get linesTotal(){return this._linesTotal}get lettersTotal(){return this._lettersTotal}get wordsTotal(){return this._wordsTotal}update(e){if(e=Object.assign({measure:this._measure},e),this._options=e,this._options.tabSize=_S(this._options.tabSize,4),!e.font)throw new Error("must provide a valid bitmap font");const t=this.glyphs,i=e.text||"",r=e.font;this._setupSpaceGlyphs(r);const s=hS.lines(i,e),o=e.width||0,a=i.split(" ").filter(_=>_!==`
`).length,l=i.split("").filter(_=>_!==`
`&&_!==" ").length;t.length=0;const h=s.reduce(function(_,T){return Math.max(_,T.width,o)},0);let c=0,u=0;const d=e.lineHeight?e.lineHeight:1,f=r.common.lineHeight*Math.max(d,1),p=r.common.base,g=f-p,m=e.letterSpacing||0,x=f*s.length-g,E=mS(this._options.align);u-=x,this._width=h,this._height=x,this._descender=f-p,this._baseline=p,this._xHeight=fS(r),this._capHeight=gS(r),this._lineHeight=f,this._ascender=f-g-this._xHeight;let R=0,C=0;s.forEach((_,T)=>{const y=_.start,P=_.end,D=_.width,F=i.slice(y,P).split(" ").filter(z=>z!=="").length,N=i.slice(y,P).split(" ").join("").length;let G=0,J=0,j;for(let z=y;z<P;z++){const $=i.charCodeAt(z),te=this.getGlyph(r,$);if(te){j&&(c+=sg(r,j.id,te.id));let fe=c;E===H_?fe+=(h-D)/2:E===K_&&(fe+=h-D),t.push({position:[fe,u],data:te,index:z,linesTotal:s.length,lineIndex:T,lineLettersTotal:N,lineLetterIndex:G,lineWordsTotal:F,lineWordIndex:J,wordsTotal:a,wordIndex:R,lettersTotal:l,letterIndex:C}),te.id===sa&&j.id!==sa&&(J++,R++),te.id!==sa&&(G++,C++),c+=te.xadvance+m,j=te}}u+=f,c=0}),this._lettersTotal=l,this._wordsTotal=a,this._linesTotal=s.length}getGlyph(e,t){return rg(e,t)||(t===ig?this._fallbackTabGlyph:t===sa?this._fallbackSpaceGlyph:null)}computeMetrics(e,t,i,r){const s=this._options.letterSpacing||0,o=this._options.font;let a=0,l=0,h=0,c,u;if(!o.chars||o.chars.length===0)return{start:t,end:t,width:0};i=Math.min(e.length,i);for(let d=t;d<i;d++){const f=e.charCodeAt(d);if(c=this.getGlyph(o,f),c){c.char=e[d],c.xoffset;const p=u?sg(o,u.id,c.id):0;a+=p;const g=a+c.xadvance+s,m=a+c.width;if(m>=r||g>=r)break;a=g,l=m,u=c}h++}return u&&(l+=u.xoffset),{start:t,end:t+h,width:l}}_setupSpaceGlyphs(e){if(this._fallbackSpaceGlyph=null,this._fallbackTabGlyph=null,!e.chars||e.chars.length===0)return;const t=rg(e,sa)||pS(e)||e.chars[0],i=this._options.tabSize*t.xadvance;this._fallbackSpaceGlyph=t;const r=Object.assign({},t);this._fallbackTabGlyph=Object.assign(r,{x:0,y:0,xadvance:i,id:ig,xoffset:0,yoffset:0,width:0,height:0})}}function dS(n){return new uS(n)}function rg(n,e){if(!n.chars||n.chars.length===0)return null;const t=Bh(n.chars,e);return t>=0?n.chars[t]:null}function fS(n){for(let e=0;e<$p.length;e++){const t=$p[e].charCodeAt(0),i=Bh(n.chars,t);if(i>=0)return n.chars[i].height}return 0}function pS(n){for(let e=0;e<eg.length;e++){const t=eg[e].charCodeAt(0),i=Bh(n.chars,t);if(i>=0)return n.chars[i]}return 0}function gS(n){for(let e=0;e<tg.length;e++){const t=tg[e].charCodeAt(0),i=Bh(n.chars,t);if(i>=0)return n.chars[i].height}return 0}function sg(n,e,t){if(!n.kernings||n.kernings.length===0)return 0;const i=n.kernings;for(let r=0;r<i.length;r++){const s=i[r];if(s.first===e&&s.second===t)return s.amount}return 0}function mS(n){return n==="center"?H_:n==="right"?K_:cS}function Bh(n,e,t){t=t||0;for(let i=t;i<n.length;i++)if(n[i].id===e)return i;return-1}function _S(n,e){return typeof n=="number"?n:typeof e=="number"?e:0}function vS(n){const e=new Float32Array(n.length*4*1);let t=0;return n.forEach(function(i){const r=i.data.page||0;e[t++]=r,e[t++]=r,e[t++]=r,e[t++]=r}),e}function ES(n,e,t,i,r){const s=new Float32Array(n.length*4*2),o=new Float32Array(n.length*4*2),a=new Float32Array(n.length*4*3),l=new Float32Array(n.length*4*2);let h=0,c=0,u=0,d=0;return n.forEach(function(f){const p=f.data,g=p.x+p.width,m=p.y+p.height,x=p.x/e;let E=p.y/t;const R=g/e;let C=m/t;i&&(E=(t-p.y)/t,C=(t-m)/t),s[h++]=x,s[h++]=E,s[h++]=x,s[h++]=C,s[h++]=R,s[h++]=C,s[h++]=R,s[h++]=E,o[d++]=f.position[0]/r.width,o[d++]=(f.position[1]+r.height)/r.height,o[d++]=f.position[0]/r.width,o[d++]=(f.position[1]+r.height+p.height)/r.height,o[d++]=(f.position[0]+p.width)/r.width,o[d++]=(f.position[1]+r.height+p.height)/r.height,o[d++]=(f.position[0]+p.width)/r.width,o[d++]=(f.position[1]+r.height)/r.height;const _=f.position[0]+p.xoffset,T=f.position[1]+p.yoffset,y=0,P=p.width,D=p.height;a[c++]=_,a[c++]=T,a[c++]=y,a[c++]=_,a[c++]=T+D,a[c++]=y,a[c++]=_+P,a[c++]=T+D,a[c++]=y,a[c++]=_+P,a[c++]=T,a[c++]=y,l[u++]=_+P/2,l[u++]=T+D/2,l[u++]=_+P/2,l[u++]=T+D/2,l[u++]=_+P/2,l[u++]=T+D/2,l[u++]=_+P/2,l[u++]=T+D/2}),{uvs:s,layoutUvs:o,positions:a,centers:l}}function TS(n){const e=new Float32Array(n.length*4),t=new Float32Array(n.length*4),i=new Float32Array(n.length*4),r=new Float32Array(n.length*4),s=new Float32Array(n.length*4),o=new Float32Array(n.length*4),a=new Float32Array(n.length*4);let l,h,c,u=0,d=0,f=0,p=0,g=0,m=0,x=0;for(let E=0;E<n.length;E++){const R=n[E];e[u++]=R.lineIndex,e[u++]=R.lineIndex,e[u++]=R.lineIndex,e[u++]=R.lineIndex,t[d++]=R.lineLettersTotal,t[d++]=R.lineLettersTotal,t[d++]=R.lineLettersTotal,t[d++]=R.lineLettersTotal,i[f++]=R.lineLetterIndex,i[f++]=R.lineLetterIndex,i[f++]=R.lineLetterIndex,i[f++]=R.lineLetterIndex,r[p++]=R.lineWordsTotal,r[p++]=R.lineWordsTotal,r[p++]=R.lineWordsTotal,r[p++]=R.lineWordsTotal,s[g++]=R.lineWordIndex,s[g++]=R.lineWordIndex,s[g++]=R.lineWordIndex,s[g++]=R.lineWordIndex,o[m++]=R.wordIndex,o[m++]=R.wordIndex,o[m++]=R.wordIndex,o[m++]=R.wordIndex,a[x++]=R.letterIndex,a[x++]=R.letterIndex,a[x++]=R.letterIndex,a[x++]=R.letterIndex,c=R.lettersTotal,l=R.wordsTotal,h=R.linesTotal}return{linesTotal:h,lineIndex:e,lineLettersTotal:t,lineLetterIndex:i,lineWordsTotal:r,lineWordIndex:s,wordsTotal:l,wordIndex:o,lettersTotal:c,letterIndex:a}}const ng={pages:vS,attributes:ES,infos:TS},xS=({color:n=new _i(0,0,0),stroke:e,strokeColor:t=new _i(0,0,0),opacity:i=1,strokeWidth:r=.5,...s})=>{const o=dS(s),a=s.font;s.engine&&console.warn("Warning: The engine argument is no longer required and will be ignored."),s.atlas instanceof Kl||console.warn("Please provide the atlas as texture instead of image so each text mesh won't have a seperate texture instance");const l=s.scene.getEngine(),h=a.common.scaleW,c=a.common.scaleH,u=o.glyphs.filter(T=>{const y=T.data;return y.width*y.height>0}),d=ng.attributes(u,h,c,!0,o),f=ng.infos(u,o),p=aS([],{clockwise:!0,type:"uint16",count:u.length}),g=new ji(s.text||"text",s.scene),m=new ca;m.positions=d.positions,m.indices=p,m.uvs=d.uvs;const x=[];ca.ComputeNormals(d.positions,p,x),m.normals=x,Ms({engine:l,data:d.centers,kind:"center",stride:2,mesh:g}),Ms({engine:l,data:d.layoutUvs,kind:"layoutUv",stride:2,mesh:g}),Ms({engine:l,data:f.lineIndex,kind:"lineIndex",stride:1,mesh:g}),Ms({engine:l,data:f.lineLettersTotal,kind:"lineLettersTotal",stride:1,mesh:g}),Ms({engine:l,data:f.lineLetterIndex,kind:"lineLetterIndex",stride:1,mesh:g}),Ms({engine:l,data:f.lineWordsTotal,kind:"lineWordsTotal",stride:1,mesh:g}),Ms({engine:l,data:f.lineWordIndex,kind:"lineWordIndex",stride:1,mesh:g}),Ms({engine:l,data:f.wordIndex,kind:"wordIndex",stride:1,mesh:g}),Ms({engine:l,data:f.letterIndex,kind:"letterIndex",stride:1,mesh:g}),m.applyToMesh(g),g.scaling=new _e(.5,.5,.5),g.rotation.y=0,g.rotation.x=3.14,Jp.ShadersStore.customVertexShader=qR,Jp.ShadersStore.customFragmentShader=YR;const E=new PR("shader",s.scene,{vertex:"custom",fragment:"custom"},{attributes:["position","normal","uv","center","layoutUv","lineIndex","lineLettersTotal","lineLetterIndex","lineWordsTotal","lineWordIndex","wordIndex","letterIndex"],uniforms:["world","worldView","worldViewProjection","view","projection","uColor","uThreshold","uStrokeOutsetWidth","uStrokeInsetWidth","uOpacity","uAlphaTest","uStrokeColor","uLinesTotal","uWordsTotal","uLettersTotal"],needAlphaBlending:!0}),R=s.atlas instanceof Kl?s.atlas:new Kl(s.atlas,s.scene);E.setTexture("uFontAtlas",R);const C=new _i(n.r,n.g,n.b);E.setColor3("uColor",C);const _=new _i(t.r,t.g,t.b);return E.setColor3("uStrokeColor",_),E.setFloat("uThreshold",.05),E.setFloat("uStrokeOutsetWidth",0),E.setFloat("uStrokeInsetWidth",.3),E.setFloat("uOpacity",i),E.setFloat("uAlphaTest",.01),E.setInt("uLinesTotal",f.linesTotal),E.setInt("uWordsTotal",f.wordsTotal),E.setInt("uLettersTotal",f.lettersTotal),E.backFaceCulling=!1,g.material=E,g};class CS{constructor(e,t,i){this.name=e,this.options=t,this.scene=i,this.mesh=this.run()}run(){let e=new ji("cot"),t=xS({text:this.options.text.toString(),color:this.options.color,opacity:this.options.opacity,align:this.options.align,font:this.options.font,scene:e.getScene(),atlas:this.options.atlas});t.computeWorldMatrix(!0);let i=1/t.getBoundingInfo().boundingBox.extendSize._y;t.scaling=new _e(i,i,i),t.computeWorldMatrix(!0),t.bakeCurrentTransformIntoVertices(),t.scaling=new _e(this.options.size,this.options.size,this.options.size),t.computeWorldMatrix(!0),t.bakeCurrentTransformIntoVertices();let r=t.getBoundingInfo().boundingBox;return e.position=new _e(r.center.x,r.center.y,0),t.setParent(e),e}}function RS(n,e,t){const i={text:e.text||"undefined",size:e.size||1,opacity:e.opacity||1,align:e.align||"center",color:e.color||_i.White(),font:e.font||KR,atlas:e.atlas||z_};return new CS(n,i,t).mesh}function SS(n,e,t){let i=e.calculateBounds||!0,r=e.exclude||void 0,s=e.childObserver||!1,o=new ji(n,t);if(i){let{min:a,max:l}=o.getHierarchyBoundingVectors(!0,r);o.setBoundingInfo(new Un(a,l))}return s&&o.onAfterWorldMatrixUpdateObservable.add(()=>{setTimeout(()=>{if(o.detectReentrancy)return;o.detectReentrancy=!0;let{min:a,max:l}=o.getHierarchyBoundingVectors(!0,r);const h=o.getWorldMatrix().clone().invert();_e.TransformCoordinatesToRef(a,h,a),_e.TransformCoordinatesToRef(l,h,l),o.setBoundingInfo(new Un(a,l)),setTimeout(()=>{o.detectReentrancy=!1})})}),o}function yS(n,e,t){return new dn(n,t)}function bS(n,e,t){return B_(n,e,{},t)}const IS={cot:yS,sphere:Bt.CreateSphere,box:Bt.CreateBox,tiledBox:Bt.CreateTiledBox,cylinder:Bt.CreateCylinder,capsule:Bt.CreateCapsule,plane:Bt.CreatePlane,tiledPlane:Bt.CreateTiledPlane,disc:Bt.CreateDisc,torus:Bt.CreateTorus,torusKnot:Bt.CreateTorusKnot,ground:Bt.CreateGround,tiledGround:Bt.CreateTiledGround,lines:Bt.CreateLines,dashedLines:Bt.CreateDashedLines,lineSystem:Bt.CreateLineSystem,ribbon:Bt.CreateRibbon,tube:Bt.CreateTube,extrude:Bt.ExtrudeShape,extrudeCustom:Bt.ExtrudeShapeCustom,lathe:Bt.CreateLathe,polygon:Bt.CreatePolygon,extrudePolygon:Bt.ExtrudePolygon,polyhedra:Bt.CreatePolyhedron,icosphere:Bt.CreateIcoSphere,geodesic:Bt.CreateGeodesic,goldberg:Bt.CreateGoldberg,planeText:RS,greasedLine:bS,container:SS};function Ka(n,e,t={},i={},r){let s={};for(let[l,h]of Object.entries(t))h instanceof Function?s[l]=h(i):s[l]=h;let o=IS[n],a=o(e,s,r);return a instanceof ji&&(a.actionManager=new es(a.getScene())),Ur.EnableFor(a),a.metadata={...a.metadata,data:i},a}function AS(n,e={},t=[{}]){let i=[];return this.selected.forEach(r=>{t.forEach((s,o)=>{var a=Ka(n,n,e,s,this.scene);a.setParent(r),i.push(a)})}),new ai(i,this.scene)}function MS(n,e=[{}]){let t=[];return this.selected.forEach(i=>{e.forEach((r,s)=>{var o=n.createInstance(n.name+"_"+s);n instanceof V_&&(n.actionManager=new es(this.scene)),Ur.EnableFor(o),o.parent=i,o.metadata={...n.metadata,data:r},t.push(o)})}),new ai(t,this.scene)}function PS(n){return this.prop("position",n),this}function OS(n){return this.prop("position.x",n),this}function DS(n){return this.prop("position.y",n),this}function NS(n){return this.prop("position.z",n),this}function FS(n,e,t){return this.selected.forEach((i,r)=>{i instanceof dn?i.translate(n instanceof Function?n(i.metadata.data,r):n,e instanceof Function?e(i.metadata.data,r):e,t):console.log("Node not a mesh, skipping.")}),this}function LS(n){return this.prop("rotation",n),this}function wS(n){return this.prop("rotation.x",n),this}function US(n){return this.prop("rotation.y",n),this}function VS(n){return this.prop("rotation.z",n),this}function BS(n){return this.prop("scaling",n),this}function kS(n){return this.prop("scaling.x",n),this}function zS(n){return this.prop("scaling.y",n),this}function GS(n){return this.prop("scaling.z",n),this}class q_{constructor(e,t=!1,i,r){this.initialize(e,t,i,r)}initialize(e,t=!1,i,r){return this.mask=e,this.skipNextObservers=t,this.target=i,this.currentTarget=r,this}}class WS{constructor(e,t,i=null){this.callback=e,this.mask=t,this.scope=i,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){this._remove&&this._remove()}}let he=class yu{static FromPromise(e,t){const i=new yu;return e.then(r=>{i.notifyObservers(r)}).catch(r=>{if(t)t.notifyObservers(r);else throw r}),i}get observers(){return this._observers}constructor(e,t=!1){this.notifyIfTriggered=t,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new q_(0),e&&(this._onObserverAdded=e)}add(e,t=-1,i=!1,r=null,s=!1){if(!e)return null;const o=new WS(e,t,r);return o.unregisterOnNextCall=s,i?this._observers.unshift(o):this._observers.push(o),this._onObserverAdded&&this._onObserverAdded(o),this._hasNotified&&this.notifyIfTriggered&&this._lastNotifiedValue!==void 0&&this.notifyObserver(o,this._lastNotifiedValue),o._remove=()=>{this.remove(o)},o}addOnce(e){return this.add(e,void 0,void 0,void 0,!0)}remove(e){return e?(e._remove=null,this._observers.indexOf(e)!==-1?(this._deferUnregister(e),!0):!1):!1}removeCallback(e,t){for(let i=0;i<this._observers.length;i++){const r=this._observers[i];if(!r._willBeUnregistered&&r.callback===e&&(!t||t===r.scope))return this._deferUnregister(r),!0}return!1}_deferUnregister(e){e._willBeUnregistered||(this._numObserversMarkedAsDeleted++,e.unregisterOnNextCall=!1,e._willBeUnregistered=!0,setTimeout(()=>{this._remove(e)},0))}_remove(e,t=!0){if(!e)return!1;const i=this._observers.indexOf(e);return i!==-1?(t&&this._numObserversMarkedAsDeleted--,this._observers.splice(i,1),!0):!1}makeObserverTopPriority(e){this._remove(e,!1),this._observers.unshift(e)}makeObserverBottomPriority(e){this._remove(e,!1),this._observers.push(e)}notifyObservers(e,t=-1,i,r,s){if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=e),!this._observers.length)return!0;const o=this._eventState;o.mask=t,o.target=i,o.currentTarget=r,o.skipNextObservers=!1,o.lastReturnValue=e,o.userInfo=s;for(const a of this._observers)if(!a._willBeUnregistered&&(a.mask&t&&(a.unregisterOnNextCall&&this._deferUnregister(a),a.scope?o.lastReturnValue=a.callback.apply(a.scope,[e,o]):o.lastReturnValue=a.callback(e,o)),o.skipNextObservers))return!1;return!0}notifyObserver(e,t,i=-1){if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=t),e._willBeUnregistered)return;const r=this._eventState;r.mask=i,r.skipNextObservers=!1,e.unregisterOnNextCall&&this._deferUnregister(e),e.callback(t,r)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const e=this._observers.pop();e&&(e._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const e=new yu;return e._observers=this._observers.slice(0),e}hasSpecificMask(e=-1){for(const t of this._observers)if(t.mask&e||t.mask===e)return!0;return!1}};function Ai(){return typeof window<"u"}function aa(){return typeof navigator<"u"}function da(){return typeof document<"u"}function Y_(n){let e="",t=n.firstChild;for(;t;)t.nodeType===3&&(e+=t.textContent),t=t.nextSibling;return e}class oe{static _CheckLimit(e,t){let i=oe._LogLimitOutputs[e];return i?i.current++:(i={limit:t,current:1},oe._LogLimitOutputs[e]=i),i.current<=i.limit}static _GenerateLimitMessage(e,t=1){const i=oe._LogLimitOutputs[e];if(!i||!oe.MessageLimitReached)return;const r=this._Levels[t];i.current===i.limit&&oe[r.name](oe.MessageLimitReached.replace(/%LIMIT%/g,""+i.limit).replace(/%TYPE%/g,r.name??""))}static _AddLogEntry(e){oe._LogCache=e+oe._LogCache,oe.OnNewCacheEntry&&oe.OnNewCacheEntry(e)}static _FormatMessage(e){const t=r=>r<10?"0"+r:""+r,i=new Date;return"["+t(i.getHours())+":"+t(i.getMinutes())+":"+t(i.getSeconds())+"]: "+e}static _LogDisabled(e,t){}static _LogEnabled(e=1,t,i){const r=Array.isArray(t)?t[0]:t;if(i!==void 0&&!oe._CheckLimit(r,i))return;const s=oe._FormatMessage(r),o=this._Levels[e],a=Array.isArray(t)?t.slice(1):[];o.logFunc&&o.logFunc("BJS - "+s,...a);const l=`<div style='color:${o.color}'>${s}</div><br>`;oe._AddLogEntry(l),oe._GenerateLimitMessage(r,e)}static get LogCache(){return oe._LogCache}static ClearLogCache(){oe._LogCache="",oe._LogLimitOutputs={},oe.errorsCount=0}static set LogLevels(e){oe.Log=oe._LogDisabled,oe.Warn=oe._LogDisabled,oe.Error=oe._LogDisabled,[oe.MessageLogLevel,oe.WarningLogLevel,oe.ErrorLogLevel].forEach(t=>{if((e&t)===t){const i=this._Levels[t];oe[i.name]=oe._LogEnabled.bind(oe,t)}})}}oe.NoneLogLevel=0;oe.MessageLogLevel=1;oe.WarningLogLevel=2;oe.ErrorLogLevel=4;oe.AllLogLevel=7;oe.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.";oe._LogCache="";oe._LogLimitOutputs={};oe._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}];oe.errorsCount=0;oe.Log=oe._LogEnabled.bind(oe,oe.MessageLogLevel);oe.Warn=oe._LogEnabled.bind(oe,oe.WarningLogLevel);oe.Error=oe._LogEnabled.bind(oe,oe.ErrorLogLevel);const og=(n,e,t)=>!n||n.getClassName&&n.getClassName()==="Mesh"?null:n.getClassName&&(n.getClassName()==="SubMesh"||n.getClassName()==="PhysicsBody")?n.clone(e):n.clone?n.clone():Array.isArray(n)?n.slice():t&&typeof n=="object"?{...n}:null;function XS(n){const e=[];do Object.getOwnPropertyNames(n).forEach(function(t){e.indexOf(t)===-1&&e.push(t)});while(n=Object.getPrototypeOf(n));return e}class Vn{static DeepCopy(e,t,i,r,s=!1){const o=XS(e);for(const a of o){if(a[0]==="_"&&(!r||r.indexOf(a)===-1)||a.endsWith("Observable")||i&&i.indexOf(a)!==-1)continue;const l=e[a],h=typeof l;if(h!=="function")try{if(h==="object")if(l instanceof Uint8Array)t[a]=Uint8Array.from(l);else if(l instanceof Array){if(t[a]=[],l.length>0)if(typeof l[0]=="object")for(let c=0;c<l.length;c++){const u=og(l[c],t,s);t[a].indexOf(u)===-1&&t[a].push(u)}else t[a]=l.slice(0)}else t[a]=og(l,t,s);else t[a]=l}catch(c){oe.Warn(c.message)}}}}class hr{static get Now(){return Ai()&&window.performance&&window.performance.now?window.performance.now():Date.now()}}const ag={};function Ge(n,e=!1){if(!(e&&ag[n]))return ag[n]=!0,`${n} needs to be imported before as it contains a side-effect required by your code.`}function HS(){return typeof _native<"u"&&_native.XMLHttpRequest?new _native.XMLHttpRequest:new XMLHttpRequest}class Ei{constructor(){this._xhr=HS(),this._requestURL=""}static get IsCustomRequestAvailable(){return Object.keys(Ei.CustomRequestHeaders).length>0||Ei.CustomRequestModifiers.length>0}_injectCustomRequestHeaders(){if(!this._shouldSkipRequestModifications(this._requestURL))for(const e in Ei.CustomRequestHeaders){const t=Ei.CustomRequestHeaders[e];t&&this._xhr.setRequestHeader(e,t)}}_shouldSkipRequestModifications(e){return Ei.SkipRequestModificationForBabylonCDN&&(e.includes("preview.babylonjs.com")||e.includes("cdn.babylonjs.com"))}get onprogress(){return this._xhr.onprogress}set onprogress(e){this._xhr.onprogress=e}get readyState(){return this._xhr.readyState}get status(){return this._xhr.status}get statusText(){return this._xhr.statusText}get response(){return this._xhr.response}get responseURL(){return this._xhr.responseURL}get responseText(){return this._xhr.responseText}get responseType(){return this._xhr.responseType}set responseType(e){this._xhr.responseType=e}get timeout(){return this._xhr.timeout}set timeout(e){this._xhr.timeout=e}addEventListener(e,t,i){this._xhr.addEventListener(e,t,i)}removeEventListener(e,t,i){this._xhr.removeEventListener(e,t,i)}abort(){this._xhr.abort()}send(e){Ei.CustomRequestHeaders&&this._injectCustomRequestHeaders(),this._xhr.send(e)}open(e,t){for(const i of Ei.CustomRequestModifiers){if(this._shouldSkipRequestModifications(t))return;i(this._xhr,t)}t=t.replace("file:http:","http:"),t=t.replace("file:https:","https:"),this._requestURL=t,this._xhr.open(e,t,!0)}setRequestHeader(e,t){this._xhr.setRequestHeader(e,t)}getResponseHeader(e){return this._xhr.getResponseHeader(e)}}Ei.CustomRequestHeaders={};Ei.CustomRequestModifiers=new Array;Ei.SkipRequestModificationForBabylonCDN=!0;class rt{static get LastCreatedEngine(){return this.Instances.length===0?null:this.Instances[this.Instances.length-1]}static get LastCreatedScene(){return this._LastCreatedScene}}rt.Instances=[];rt.OnEnginesDisposedObservable=new he;rt._LastCreatedScene=null;rt.UseFallbackTexture=!0;rt.FallbackTexture="";class fa{}fa.FilesToLoad={};class KS{static ExponentialBackoff(e=3,t=500){return(i,r,s)=>r.status!==0||s>=e||i.indexOf("file:")!==-1?-1:Math.pow(2,s)*t}}class No extends Error{}No._setPrototypeOf=Object.setPrototypeOf||((n,e)=>(n.__proto__=e,n));const kh={MeshInvalidPositionsError:0,UnsupportedTextureError:1e3,GLTFLoaderUnexpectedMagicError:2e3,SceneLoaderError:3e3,LoadFileError:4e3,RequestFileError:4001,ReadFileError:4002};class Ho extends No{constructor(e,t,i){super(e),this.errorCode=t,this.innerError=i,this.name="RuntimeError",No._setPrototypeOf(this,Ho.prototype)}}const Z_=n=>{const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let t="",i,r,s,o,a,l,h,c=0;const u=ArrayBuffer.isView(n)?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):new Uint8Array(n);for(;c<u.length;)i=u[c++],r=c<u.length?u[c++]:Number.NaN,s=c<u.length?u[c++]:Number.NaN,o=i>>2,a=(i&3)<<4|r>>4,l=(r&15)<<2|s>>6,h=s&63,isNaN(r)?l=h=64:isNaN(s)&&(h=64),t+=e.charAt(o)+e.charAt(a)+e.charAt(l)+e.charAt(h);return t},j_=n=>atob(n),qS=n=>{const e=j_(n),t=e.length,i=new Uint8Array(new ArrayBuffer(t));for(let r=0;r<t;r++)i[r]=e.charCodeAt(r);return i.buffer},YS="attribute",ZS="varying";class pa{constructor(){this.children=[]}isValid(e){return!0}process(e,t){var i,r,s,o,a,l;let h="";if(this.line){let c=this.line;const u=t.processor;if(u){u.lineProcessor&&(c=u.lineProcessor(c,t.isFragment,t.processingContext));const d=((i=t.processor)==null?void 0:i.attributeKeywordName)??YS,f=t.isFragment&&(r=t.processor)!=null&&r.varyingFragmentKeywordName?(s=t.processor)==null?void 0:s.varyingFragmentKeywordName:!t.isFragment&&(o=t.processor)!=null&&o.varyingVertexKeywordName?(a=t.processor)==null?void 0:a.varyingVertexKeywordName:ZS;!t.isFragment&&u.attributeProcessor&&this.line.startsWith(d)?c=u.attributeProcessor(this.line,e,t.processingContext):u.varyingProcessor&&((l=u.varyingCheck)!=null&&l.call(u,this.line,t.isFragment)||!u.varyingCheck&&this.line.startsWith(f))?c=u.varyingProcessor(this.line,t.isFragment,e,t.processingContext):u.uniformProcessor&&u.uniformRegexp&&u.uniformRegexp.test(this.line)?t.lookForClosingBracketForUniformBuffer||(c=u.uniformProcessor(this.line,t.isFragment,e,t.processingContext)):u.uniformBufferProcessor&&u.uniformBufferRegexp&&u.uniformBufferRegexp.test(this.line)?t.lookForClosingBracketForUniformBuffer||(c=u.uniformBufferProcessor(this.line,t.isFragment,t.processingContext),t.lookForClosingBracketForUniformBuffer=!0):u.textureProcessor&&u.textureRegexp&&u.textureRegexp.test(this.line)?c=u.textureProcessor(this.line,t.isFragment,e,t.processingContext):(u.uniformProcessor||u.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!t.lookForClosingBracketForUniformBuffer&&(/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?u.uniformProcessor&&(c=u.uniformProcessor(this.line,t.isFragment,e,t.processingContext)):u.uniformBufferProcessor&&(c=u.uniformBufferProcessor(this.line,t.isFragment,t.processingContext),t.lookForClosingBracketForUniformBuffer=!0)),t.lookForClosingBracketForUniformBuffer&&this.line.indexOf("}")!==-1&&(t.lookForClosingBracketForUniformBuffer=!1,u.endOfUniformBufferProcessor&&(c=u.endOfUniformBufferProcessor(this.line,t.isFragment,t.processingContext)))}h+=c+`
`}return this.children.forEach(c=>{h+=c.process(e,t)}),this.additionalDefineKey&&(e[this.additionalDefineKey]=this.additionalDefineValue||"true"),h}}class jS{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(e){this._lines.length=0;for(const t of e){if(!t||t==="\r")continue;if(t[0]==="#"){this._lines.push(t);continue}const i=t.trim();if(!i)continue;if(i.startsWith("//")){this._lines.push(t);continue}const r=i.indexOf(";");if(r===-1)this._lines.push(i);else if(r===i.length-1)i.length>1&&this._lines.push(i);else{const s=t.split(";");for(let o=0;o<s.length;o++){let a=s[o];a&&(a=a.trim(),a&&this._lines.push(a+(o!==s.length-1?";":"")))}}}}}class Zc extends pa{process(e,t){for(let i=0;i<this.children.length;i++){const r=this.children[i];if(r.isValid(e))return r.process(e,t)}return""}}class QS extends pa{isValid(e){return this.testExpression.isTrue(e)}}class Zt{isTrue(e){return!0}static postfixToInfix(e){const t=[];for(const i of e)if(Zt._OperatorPriority[i]===void 0)t.push(i);else{const r=t[t.length-1],s=t[t.length-2];t.length-=2,t.push(`(${s}${i}${r})`)}return t[t.length-1]}static infixToPostfix(e){const t=Zt._InfixToPostfixCache.get(e);if(t)return t.accessTime=Date.now(),t.result;if(!e.includes("&&")&&!e.includes("||")&&!e.includes(")")&&!e.includes("("))return[e];const i=[];let r=-1;const s=()=>{c=c.trim(),c!==""&&(i.push(c),c="")},o=u=>{r<Zt._Stack.length-1&&(Zt._Stack[++r]=u)},a=()=>Zt._Stack[r],l=()=>r===-1?"!!INVALID EXPRESSION!!":Zt._Stack[r--];let h=0,c="";for(;h<e.length;){const u=e.charAt(h),d=h<e.length-1?e.substr(h,2):"";if(u==="(")c="",o(u);else if(u===")"){for(s();r!==-1&&a()!=="(";)i.push(l());l()}else if(Zt._OperatorPriority[d]>1){for(s();r!==-1&&Zt._OperatorPriority[a()]>=Zt._OperatorPriority[d];)i.push(l());o(d),h++}else c+=u;h++}for(s();r!==-1;)a()==="("?l():i.push(l());return Zt._InfixToPostfixCache.size>=Zt.InfixToPostfixCacheLimitSize&&Zt.ClearCache(),Zt._InfixToPostfixCache.set(e,{result:i,accessTime:Date.now()}),i}static ClearCache(){const e=Array.from(Zt._InfixToPostfixCache.entries()).sort((t,i)=>t[1].accessTime-i[1].accessTime);for(let t=0;t<Zt.InfixToPostfixCacheCleanupSize;t++)Zt._InfixToPostfixCache.delete(e[t][0])}}Zt.InfixToPostfixCacheLimitSize=5e4;Zt.InfixToPostfixCacheCleanupSize=25e3;Zt._InfixToPostfixCache=new Map;Zt._OperatorPriority={")":0,"(":1,"||":2,"&&":3};Zt._Stack=["","","","","","","","","","","","","","","","","","","",""];class Tl extends Zt{constructor(e,t=!1){super(),this.define=e,this.not=t}isTrue(e){let t=e[this.define]!==void 0;return this.not&&(t=!t),t}}class JS extends Zt{isTrue(e){return this.leftOperand.isTrue(e)||this.rightOperand.isTrue(e)}}class $S extends Zt{isTrue(e){return this.leftOperand.isTrue(e)&&this.rightOperand.isTrue(e)}}class ey extends Zt{constructor(e,t,i){super(),this.define=e,this.operand=t,this.testValue=i}isTrue(e){let t=e[this.define];t===void 0&&(t=this.define);let i=!1;const r=parseInt(t),s=parseInt(this.testValue);switch(this.operand){case">":i=r>s;break;case"<":i=r<s;break;case"<=":i=r<=s;break;case">=":i=r>=s;break;case"==":i=r===s;break;case"!=":i=r!==s;break}return i}}var Ti;(function(n){n[n.GLSL=0]="GLSL",n[n.WGSL=1]="WGSL"})(Ti||(Ti={}));const ty=/defined\s*?\((.+?)\)/g,jc=/defined\s*?\[(.+?)\]/g,iy=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,ry=/__decl__/,lg=/light\{X\}.(\w*)/g,hg=/\{X\}/g,xl=[];class ms{static Initialize(e){e.processor&&e.processor.initializeShaders&&e.processor.initializeShaders(e.processingContext)}static Process(e,t,i,r){var s;(s=t.processor)!=null&&s.preProcessShaderCode&&(e=t.processor.preProcessShaderCode(e,t.isFragment)),this._ProcessIncludes(e,t,o=>{t.processCodeAfterIncludes&&(o=t.processCodeAfterIncludes(t.isFragment?"fragment":"vertex",o));const a=this._ProcessShaderConversion(o,t,r);i(a,o)})}static PreProcess(e,t,i,r){var s;(s=t.processor)!=null&&s.preProcessShaderCode&&(e=t.processor.preProcessShaderCode(e,t.isFragment)),this._ProcessIncludes(e,t,o=>{t.processCodeAfterIncludes&&(o=t.processCodeAfterIncludes(t.isFragment?"fragment":"vertex",o));const a=this._ApplyPreProcessing(o,t,r);i(a,o)})}static Finalize(e,t,i){return!i.processor||!i.processor.finalizeShaders?{vertexCode:e,fragmentCode:t}:i.processor.finalizeShaders(e,t,i.processingContext)}static _ProcessPrecision(e,t){var i;if((i=t.processor)!=null&&i.noPrecision)return e;const r=t.shouldUseHighPrecisionShader;return e.indexOf("precision highp float")===-1?r?e=`precision highp float;
`+e:e=`precision mediump float;
`+e:r||(e=e.replace("precision highp float","precision mediump float")),e}static _ExtractOperation(e){const t=/defined\((.+)\)/.exec(e);if(t&&t.length)return new Tl(t[1].trim(),e[0]==="!");const i=["==","!=",">=","<=","<",">"];let r="",s=0;for(r of i)if(s=e.indexOf(r),s>-1)break;if(s===-1)return new Tl(e);const o=e.substring(0,s).trim(),a=e.substring(s+r.length).trim();return new ey(o,r,a)}static _BuildSubExpression(e){e=e.replace(ty,"defined[$1]");const t=Zt.infixToPostfix(e),i=[];for(const s of t)if(s!=="||"&&s!=="&&")i.push(s);else if(i.length>=2){let o=i[i.length-1],a=i[i.length-2];i.length-=2;const l=s=="&&"?new $S:new JS;typeof o=="string"&&(o=o.replace(jc,"defined($1)")),typeof a=="string"&&(a=a.replace(jc,"defined($1)")),l.leftOperand=typeof a=="string"?this._ExtractOperation(a):a,l.rightOperand=typeof o=="string"?this._ExtractOperation(o):o,i.push(l)}let r=i[i.length-1];return typeof r=="string"&&(r=r.replace(jc,"defined($1)")),typeof r=="string"?this._ExtractOperation(r):r}static _BuildExpression(e,t){const i=new QS,r=e.substring(0,t);let s=e.substring(t);return s=s.substring(0,(s.indexOf("//")+1||s.length+1)-1).trim(),r==="#ifdef"?i.testExpression=new Tl(s):r==="#ifndef"?i.testExpression=new Tl(s,!0):i.testExpression=this._BuildSubExpression(s),i}static _MoveCursorWithinIf(e,t,i){let r=e.currentLine;for(;this._MoveCursor(e,i);){r=e.currentLine;const s=r.substring(0,5).toLowerCase();if(s==="#else"){const o=new pa;t.children.push(o),this._MoveCursor(e,o);return}else if(s==="#elif"){const o=this._BuildExpression(r,5);t.children.push(o),i=o}}}static _MoveCursor(e,t){for(;e.canRead;){e.lineIndex++;const i=e.currentLine;if(i.indexOf("#")>=0){const s=ms._MoveCursorRegex.exec(i);if(s&&s.length){switch(s[0]){case"#ifdef":{const o=new Zc;t.children.push(o);const a=this._BuildExpression(i,6);o.children.push(a),this._MoveCursorWithinIf(e,o,a);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const o=new Zc;t.children.push(o);const a=this._BuildExpression(i,7);o.children.push(a),this._MoveCursorWithinIf(e,o,a);break}case"#if":{const o=new Zc,a=this._BuildExpression(i,3);t.children.push(o),o.children.push(a),this._MoveCursorWithinIf(e,o,a);break}}continue}}const r=new pa;if(r.line=i,t.children.push(r),i[0]==="#"&&i[1]==="d"){const s=i.replace(";","").split(" ");r.additionalDefineKey=s[1],s.length===3&&(r.additionalDefineValue=s[2])}}return!1}static _EvaluatePreProcessors(e,t,i){const r=new pa,s=new jS;return s.lineIndex=-1,s.lines=e.split(`
`),this._MoveCursor(s,r),r.process(t,i)}static _PreparePreProcessors(e,t){var i;const r=e.defines,s={};for(const o of r){const a=o.replace("#define","").replace(";","").trim().split(" ");s[a[0]]=a.length>1?a[1]:""}return((i=e.processor)==null?void 0:i.shaderLanguage)===Ti.GLSL&&(s.GL_ES="true"),s.__VERSION__=e.version,s[e.platformName]="true",t._getGlobalDefines(s),s}static _ProcessShaderConversion(e,t,i){let r=this._ProcessPrecision(e,t);if(!t.processor||t.processor.shaderLanguage===Ti.GLSL&&r.indexOf("#version 3")!==-1&&(r=r.replace("#version 300 es",""),!t.processor.parseGLES3))return r;const s=t.defines,o=this._PreparePreProcessors(t,i);return t.processor.preProcessor&&(r=t.processor.preProcessor(r,s,t.isFragment,t.processingContext)),r=this._EvaluatePreProcessors(r,o,t),t.processor.postProcessor&&(r=t.processor.postProcessor(r,s,t.isFragment,t.processingContext,i)),i._features.needShaderCodeInlining&&(r=i.inlineShaderCode(r)),r}static _ApplyPreProcessing(e,t,i){var r,s;let o=e;const a=t.defines,l=this._PreparePreProcessors(t,i);return(r=t.processor)!=null&&r.preProcessor&&(o=t.processor.preProcessor(o,a,t.isFragment,t.processingContext)),o=this._EvaluatePreProcessors(o,l,t),(s=t.processor)!=null&&s.postProcessor&&(o=t.processor.postProcessor(o,a,t.isFragment,t.processingContext,i)),i._features.needShaderCodeInlining&&(o=i.inlineShaderCode(o)),o}static _ProcessIncludes(e,t,i){xl.length=0;let r;for(;(r=iy.exec(e))!==null;)xl.push(r);let s=String(e),o=[e],a=!1;for(const l of xl){let h=l[1];if(h.indexOf("__decl__")!==-1&&(h=h.replace(ry,""),t.supportsUniformBuffers&&(h=h.replace("Vertex","Ubo").replace("Fragment","Ubo")),h=h+"Declaration"),t.includesShadersStore[h]){let c=t.includesShadersStore[h];if(l[2]){const d=l[3].split(",");for(let f=0;f<d.length;f+=2){const p=new RegExp(d[f],"g"),g=d[f+1];c=c.replace(p,g)}}if(l[4]){const d=l[5];if(d.indexOf("..")!==-1){const f=d.split(".."),p=parseInt(f[0]);let g=parseInt(f[1]),m=c.slice(0);c="",isNaN(g)&&(g=t.indexParameters[f[1]]);for(let x=p;x<g;x++)t.supportsUniformBuffers||(m=m.replace(lg,(E,R)=>R+"{X}")),c+=m.replace(hg,x.toString())+`
`}else t.supportsUniformBuffers||(c=c.replace(lg,(f,p)=>p+"{X}")),c=c.replace(hg,d)}const u=[];for(const d of o){const f=d.split(l[0]);for(let p=0;p<f.length-1;p++)u.push(f[p]),u.push(c);u.push(f[f.length-1])}o=u,a=a||c.indexOf("#include<")>=0||c.indexOf("#include <")>=0}else{const c=t.shadersRepository+"ShadersInclude/"+h+".fx";ms._FileToolsLoadFile(c,u=>{t.includesShadersStore[h]=u,this._ProcessIncludes(o.join(""),t,i)});return}}xl.length=0,s=o.join(""),a?this._ProcessIncludes(s.toString(),t,i):i(s)}static _FileToolsLoadFile(e,t,i,r,s,o){throw Ge("FileTools")}}ms._MoveCursorRegex=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;class Y{static GetShadersRepository(e=Ti.GLSL){return e===Ti.GLSL?Y.ShadersRepository:Y.ShadersRepositoryWGSL}static GetShadersStore(e=Ti.GLSL){return e===Ti.GLSL?Y.ShadersStore:Y.ShadersStoreWGSL}static GetIncludesShadersStore(e=Ti.GLSL){return e===Ti.GLSL?Y.IncludesShadersStore:Y.IncludesShadersStoreWGSL}}Y.ShadersRepository="src/Shaders/";Y.ShadersStore={};Y.IncludesShadersStore={};Y.ShadersRepositoryWGSL="src/ShadersWGSL/";Y.ShadersStoreWGSL={};Y.IncludesShadersStoreWGSL={};class Zi{static get ShadersRepository(){return Y.ShadersRepository}static set ShadersRepository(e){Y.ShadersRepository=e}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new he),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(e,t,i,r=null,s,o=null,a=null,l=null,h=null,c,u="",d=Ti.GLSL){if(this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new he,this.onErrorObservable=new he,this._onBindObservable=null,this._isDisposed=!1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=e,this._key=u,t.attributes){const f=t;if(this._engine=i,this._attributesNames=f.attributes,this._uniformsNames=f.uniformsNames.concat(f.samplers),this._samplerList=f.samplers.slice(),this.defines=f.defines,this.onError=f.onError,this.onCompiled=f.onCompiled,this._fallbacks=f.fallbacks,this._indexParameters=f.indexParameters,this._transformFeedbackVaryings=f.transformFeedbackVaryings||null,this._multiTarget=!!f.multiTarget,this._shaderLanguage=f.shaderLanguage??Ti.GLSL,f.uniformBuffersNames){this._uniformBuffersNamesList=f.uniformBuffersNames.slice();for(let p=0;p<f.uniformBuffersNames.length;p++)this._uniformBuffersNames[f.uniformBuffersNames[p]]=p}this._processFinalCode=f.processFinalCode??null,this._processCodeAfterIncludes=f.processCodeAfterIncludes??void 0}else this._engine=s,this.defines=o??"",this._uniformsNames=i.concat(r),this._samplerList=r?r.slice():[],this._attributesNames=t,this._uniformBuffersNamesList=[],this._shaderLanguage=d,this.onError=h,this.onCompiled=l,this._indexParameters=c,this._fallbacks=a;this._attributeLocationByName={},this.uniqueId=Zi._UniqueIdSeed++,this._processShaderCode()}_processShaderCode(e=null,t=!1){let i,r;const s=this.name,o=Ai()?this._engine.getHostDocument():null;typeof s=="string"?i=s:s.vertexSource?i="source:"+s.vertexSource:s.vertexElement?i=(o==null?void 0:o.getElementById(s.vertexElement))||s.vertexElement:i=s.vertex||s,typeof s=="string"?r=s:s.fragmentSource?r="source:"+s.fragmentSource:s.fragmentElement?r=(o==null?void 0:o.getElementById(s.fragmentElement))||s.fragmentElement:r=s.fragment||s,this._processingContext=this._engine._getShaderProcessingContext(this._shaderLanguage);let a={defines:this.defines.split(`
`),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:e??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:Y.GetShadersRepository(this._shaderLanguage),includesShadersStore:Y.GetIncludesShadersStore(this._shaderLanguage),version:(this._engine.version*100).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:this._processCodeAfterIncludes};const l=[void 0,void 0],h=()=>{if(l[0]&&l[1]){a.isFragment=!0;const[c,u]=l;ms.Process(u,a,(d,f)=>{this._fragmentSourceCodeBeforeMigration=f,this._processFinalCode&&(d=this._processFinalCode("fragment",d));const p=ms.Finalize(c,d,a);a=null,this._useFinalCode(p.vertexCode,p.fragmentCode,s,t)},this._engine)}};this._loadShader(i,"Vertex","",c=>{ms.Initialize(a),ms.Process(c,a,(u,d)=>{this._rawVertexSourceCode=c,this._vertexSourceCodeBeforeMigration=d,this._processFinalCode&&(u=this._processFinalCode("vertex",u)),l[0]=u,h()},this._engine)}),this._loadShader(r,"Fragment","Pixel",c=>{this._rawFragmentSourceCode=c,l[1]=c,h()})}_useFinalCode(e,t,i,r=!1){if(i){const s=i.vertexElement||i.vertex||i.spectorName||i,o=i.fragmentElement||i.fragment||i.spectorName||i;this._vertexSourceCode=(this._shaderLanguage===Ti.WGSL?"//":"")+"#define SHADER_NAME vertex:"+s+`
`+e,this._fragmentSourceCode=(this._shaderLanguage===Ti.WGSL?"//":"")+"#define SHADER_NAME fragment:"+o+`
`+t}else this._vertexSourceCode=e,this._fragmentSourceCode=t;this._prepareEffect(r)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return this._isReady?!0:this._pipelineContext?this._pipelineContext.isReady:!1}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(e){return this._attributes[e]}getAttributeLocationByName(e){return this._attributeLocationByName[e]}getAttributesCount(){return this._attributes.length}getUniformIndex(e){return this._uniformsNames.indexOf(e)}getUniform(e){return this._uniforms[e]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}executeWhenCompiled(e){if(this.isReady()){e(this);return}this.onCompileObservable.add(t=>{e(t)}),(!this._pipelineContext||this._pipelineContext.isAsync)&&setTimeout(()=>{this._checkIsReady(null)},16)}_checkIsReady(e){try{if(this._isReadyInternal())return}catch(t){this._processCompilationErrors(t,e);return}this._isDisposed||setTimeout(()=>{this._checkIsReady(e)},16)}_loadShader(e,t,i,r){if(typeof HTMLElement<"u"&&e instanceof HTMLElement){const a=Y_(e);r(a);return}if(e.substr(0,7)==="source:"){r(e.substr(7));return}if(e.substr(0,7)==="base64:"){const a=window.atob(e.substr(7));r(a);return}const s=Y.GetShadersStore(this._shaderLanguage);if(s[e+t+"Shader"]){r(s[e+t+"Shader"]);return}if(i&&s[e+i+"Shader"]){r(s[e+i+"Shader"]);return}let o;e[0]==="."||e[0]==="/"||e.indexOf("http")>-1?o=e:o=Y.GetShadersRepository(this._shaderLanguage)+e,this._engine._loadFile(o+"."+t.toLowerCase()+".fx",r)}get vertexSourceCode(){var e;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:((e=this._pipelineContext)==null?void 0:e._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var e;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:((e=this._pipelineContext)==null?void 0:e._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}_rebuildProgram(e,t,i,r){this._isReady=!1,this._vertexSourceCodeOverride=e,this._fragmentSourceCodeOverride=t,this.onError=(s,o)=>{r&&r(o)},this.onCompiled=()=>{var s,o;const a=this.getEngine().scenes;if(a)for(let l=0;l<a.length;l++)a[l].markAllMaterialsAsDirty(63);(o=(s=this._pipelineContext)._handlesSpectorRebuildCallback)==null||o.call(s,i)},this._fallbacks=null,this._prepareEffect()}_prepareEffect(e=!1){const t=this._attributesNames,i=this.defines,r=this._pipelineContext;this._isReady=!1;try{const s=this._engine;this._pipelineContext=(e?r:void 0)??s.createPipelineContext(this._processingContext),this._pipelineContext._name=this._key.replace(/\r/g,"").replace(/\n/g,"|");const o=(a,l,h,c)=>this._rebuildProgram(a,l,h,c);this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?s._preparePipelineContext(this._pipelineContext,this._vertexSourceCodeOverride,this._fragmentSourceCodeOverride,!0,this._rawVertexSourceCode,this._rawFragmentSourceCode,o,null,this._transformFeedbackVaryings,this._key):s._preparePipelineContext(this._pipelineContext,this._vertexSourceCode,this._fragmentSourceCode,!1,this._rawVertexSourceCode,this._rawFragmentSourceCode,o,i,this._transformFeedbackVaryings,this._key),s._executeWhenRenderingStateIsCompiled(this._pipelineContext,()=>{if(this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,t,this._attributes),t)for(let a=0;a<t.length;a++){const l=t[a];this._attributeLocationByName[l]=this._attributes[a]}s.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),r&&!e&&this.getEngine()._deletePipelineContext(r)}),this._pipelineContext.isAsync&&this._checkIsReady(r)}catch(s){this._processCompilationErrors(s,r)}}_getShaderCodeAndErrorLine(e,t,i){const r=i?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let s=null;if(t&&e){const o=t.match(r);if(o&&o.length===2){const a=parseInt(o[1]),l=e.split(`
`,-1);l.length>=a&&(s=`Offending line [${a}] in ${i?"fragment":"vertex"} code: ${l[a-1]}`)}}return[e,s]}_processCompilationErrors(e,t=null){var i,r,s;this._compilationError=e.message;const o=this._attributesNames,a=this._fallbacks;if(oe.Error("Unable to compile effect:"),oe.Error("Uniforms: "+this._uniformsNames.map(function(h){return" "+h})),oe.Error("Attributes: "+o.map(function(h){return" "+h})),oe.Error(`Defines:
`+this.defines),Zi.LogShaderCodeOnCompilationError){let h=null,c=null,u=null;(i=this._pipelineContext)!=null&&i._getVertexShaderCode()&&([u,h]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),u&&(oe.Error("Vertex code:"),oe.Error(u))),(r=this._pipelineContext)!=null&&r._getFragmentShaderCode()&&([u,c]=this._getShaderCodeAndErrorLine((s=this._pipelineContext)==null?void 0:s._getFragmentShaderCode(),this._compilationError,!0),u&&(oe.Error("Fragment code:"),oe.Error(u))),h&&oe.Error(h),c&&oe.Error(c)}oe.Error("Error: "+this._compilationError);const l=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this)};t&&(this._pipelineContext=t,this._isReady=!0,l()),a?(this._pipelineContext=null,a.hasMoreFallbacks?(this._allFallbacksProcessed=!1,oe.Error("Trying next fallback."),this.defines=a.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,l(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,t||l())}get isSupported(){return this._compilationError===""}_bindTexture(e,t){this._engine._bindTexture(this._samplers[e],t,e)}setTexture(e,t){this._engine.setTexture(this._samplers[e],this._uniforms[e],t,e)}setDepthStencilTexture(e,t){this._engine.setDepthStencilTexture(this._samplers[e],this._uniforms[e],t,e)}setTextureArray(e,t){const i=e+"Ex";if(this._samplerList.indexOf(i+"0")===-1){const r=this._samplerList.indexOf(e);for(let o=1;o<t.length;o++){const a=i+(o-1).toString();this._samplerList.splice(r+o,0,a)}let s=0;for(const o of this._samplerList)this._samplers[o]=s,s+=1}this._engine.setTextureArray(this._samplers[e],this._uniforms[e],t,e)}setTextureFromPostProcess(e,t){this._engine.setTextureFromPostProcess(this._samplers[e],t,e)}setTextureFromPostProcessOutput(e,t){this._engine.setTextureFromPostProcessOutput(this._samplers[e],t,e)}bindUniformBuffer(e,t){const i=this._uniformBuffersNames[t];i===void 0||Zi._BaseCache[i]===e&&this._engine._features.useUBOBindingCache||(Zi._BaseCache[i]=e,this._engine.bindUniformBufferBase(e,i,t))}bindUniformBlock(e,t){this._engine.bindUniformBlock(this._pipelineContext,e,t)}setInt(e,t){return this._pipelineContext.setInt(e,t),this}setInt2(e,t,i){return this._pipelineContext.setInt2(e,t,i),this}setInt3(e,t,i,r){return this._pipelineContext.setInt3(e,t,i,r),this}setInt4(e,t,i,r,s){return this._pipelineContext.setInt4(e,t,i,r,s),this}setIntArray(e,t){return this._pipelineContext.setIntArray(e,t),this}setIntArray2(e,t){return this._pipelineContext.setIntArray2(e,t),this}setIntArray3(e,t){return this._pipelineContext.setIntArray3(e,t),this}setIntArray4(e,t){return this._pipelineContext.setIntArray4(e,t),this}setUInt(e,t){return this._pipelineContext.setUInt(e,t),this}setUInt2(e,t,i){return this._pipelineContext.setUInt2(e,t,i),this}setUInt3(e,t,i,r){return this._pipelineContext.setUInt3(e,t,i,r),this}setUInt4(e,t,i,r,s){return this._pipelineContext.setUInt4(e,t,i,r,s),this}setUIntArray(e,t){return this._pipelineContext.setUIntArray(e,t),this}setUIntArray2(e,t){return this._pipelineContext.setUIntArray2(e,t),this}setUIntArray3(e,t){return this._pipelineContext.setUIntArray3(e,t),this}setUIntArray4(e,t){return this._pipelineContext.setUIntArray4(e,t),this}setFloatArray(e,t){return this._pipelineContext.setArray(e,t),this}setFloatArray2(e,t){return this._pipelineContext.setArray2(e,t),this}setFloatArray3(e,t){return this._pipelineContext.setArray3(e,t),this}setFloatArray4(e,t){return this._pipelineContext.setArray4(e,t),this}setArray(e,t){return this._pipelineContext.setArray(e,t),this}setArray2(e,t){return this._pipelineContext.setArray2(e,t),this}setArray3(e,t){return this._pipelineContext.setArray3(e,t),this}setArray4(e,t){return this._pipelineContext.setArray4(e,t),this}setMatrices(e,t){return this._pipelineContext.setMatrices(e,t),this}setMatrix(e,t){return this._pipelineContext.setMatrix(e,t),this}setMatrix3x3(e,t){return this._pipelineContext.setMatrix3x3(e,t),this}setMatrix2x2(e,t){return this._pipelineContext.setMatrix2x2(e,t),this}setFloat(e,t){return this._pipelineContext.setFloat(e,t),this}setBool(e,t){return this._pipelineContext.setInt(e,t?1:0),this}setVector2(e,t){return this._pipelineContext.setVector2(e,t),this}setFloat2(e,t,i){return this._pipelineContext.setFloat2(e,t,i),this}setVector3(e,t){return this._pipelineContext.setVector3(e,t),this}setFloat3(e,t,i,r){return this._pipelineContext.setFloat3(e,t,i,r),this}setVector4(e,t){return this._pipelineContext.setVector4(e,t),this}setQuaternion(e,t){return this._pipelineContext.setQuaternion(e,t),this}setFloat4(e,t,i,r,s){return this._pipelineContext.setFloat4(e,t,i,r,s),this}setColor3(e,t){return this._pipelineContext.setColor3(e,t),this}setColor4(e,t,i){return this._pipelineContext.setColor4(e,t,i),this}setDirectColor4(e,t){return this._pipelineContext.setDirectColor4(e,t),this}dispose(){this._pipelineContext&&this._pipelineContext.dispose(),this._engine._releaseEffect(this),this._isDisposed=!0}static RegisterShader(e,t,i,r=Ti.GLSL){t&&(Y.GetShadersStore(r)[`${e}PixelShader`]=t),i&&(Y.GetShadersStore(r)[`${e}VertexShader`]=i)}static ResetCache(){Zi._BaseCache={}}}Zi.LogShaderCodeOnCompilationError=!0;Zi._UniqueIdSeed=0;Zi._BaseCache={};Zi.ShadersStore=Y.ShadersStore;Zi.IncludesShadersStore=Y.IncludesShadersStore;class sy{constructor(e=!0){this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,e&&this.reset()}get isDirty(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty}get zOffset(){return this._zOffset}set zOffset(e){this._zOffset!==e&&(this._zOffset=e,this._isZOffsetDirty=!0)}get zOffsetUnits(){return this._zOffsetUnits}set zOffsetUnits(e){this._zOffsetUnits!==e&&(this._zOffsetUnits=e,this._isZOffsetDirty=!0)}get cullFace(){return this._cullFace}set cullFace(e){this._cullFace!==e&&(this._cullFace=e,this._isCullFaceDirty=!0)}get cull(){return this._cull}set cull(e){this._cull!==e&&(this._cull=e,this._isCullDirty=!0)}get depthFunc(){return this._depthFunc}set depthFunc(e){this._depthFunc!==e&&(this._depthFunc=e,this._isDepthFuncDirty=!0)}get depthMask(){return this._depthMask}set depthMask(e){this._depthMask!==e&&(this._depthMask=e,this._isDepthMaskDirty=!0)}get depthTest(){return this._depthTest}set depthTest(e){this._depthTest!==e&&(this._depthTest=e,this._isDepthTestDirty=!0)}get frontFace(){return this._frontFace}set frontFace(e){this._frontFace!==e&&(this._frontFace=e,this._isFrontFaceDirty=!0)}reset(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._zOffsetUnits=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!0,this._isFrontFaceDirty=!1}apply(e){this.isDirty&&(this._isCullDirty&&(this.cull?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(e.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(e.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(e.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset||this.zOffsetUnits?(e.enable(e.POLYGON_OFFSET_FILL),e.polygonOffset(this.zOffset,this.zOffsetUnits)):e.disable(e.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(e.frontFace(this.frontFace),this._isFrontFaceDirty=!1))}}class ks{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=ks.ALWAYS,this.funcRef=1,this.funcMask=255,this.opStencilFail=ks.KEEP,this.opDepthFail=ks.KEEP,this.opStencilDepthPass=ks.REPLACE}get stencilFunc(){return this.func}set stencilFunc(e){this.func=e}get stencilFuncRef(){return this.funcRef}set stencilFuncRef(e){this.funcRef=e}get stencilFuncMask(){return this.funcMask}set stencilFuncMask(e){this.funcMask=e}get stencilOpStencilFail(){return this.opStencilFail}set stencilOpStencilFail(e){this.opStencilFail=e}get stencilOpDepthFail(){return this.opDepthFail}set stencilOpDepthFail(e){this.opDepthFail=e}get stencilOpStencilDepthPass(){return this.opStencilDepthPass}set stencilOpStencilDepthPass(e){this.opStencilDepthPass=e}get stencilMask(){return this.mask}set stencilMask(e){this.mask=e}get stencilTest(){return this.enabled}set stencilTest(e){this.enabled=e}}ks.ALWAYS=519;ks.KEEP=7680;ks.REPLACE=7681;class ny{constructor(){this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this.reset()}get isDirty(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty||this._isBlendEquationParametersDirty}get alphaBlend(){return this._alphaBlend}set alphaBlend(e){this._alphaBlend!==e&&(this._alphaBlend=e,this._isAlphaBlendDirty=!0)}setAlphaBlendConstants(e,t,i,r){this._blendConstants[0]===e&&this._blendConstants[1]===t&&this._blendConstants[2]===i&&this._blendConstants[3]===r||(this._blendConstants[0]=e,this._blendConstants[1]=t,this._blendConstants[2]=i,this._blendConstants[3]=r,this._isBlendConstantsDirty=!0)}setAlphaBlendFunctionParameters(e,t,i,r){this._blendFunctionParameters[0]===e&&this._blendFunctionParameters[1]===t&&this._blendFunctionParameters[2]===i&&this._blendFunctionParameters[3]===r||(this._blendFunctionParameters[0]=e,this._blendFunctionParameters[1]=t,this._blendFunctionParameters[2]=i,this._blendFunctionParameters[3]=r,this._isBlendFunctionParametersDirty=!0)}setAlphaEquationParameters(e,t){this._blendEquationParameters[0]===e&&this._blendEquationParameters[1]===t||(this._blendEquationParameters[0]=e,this._blendEquationParameters[1]=t,this._isBlendEquationParametersDirty=!0)}reset(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1}apply(e){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?e.enable(e.BLEND):e.disable(e.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(e.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(e.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(e.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))}}class oy{get wrapU(){return this._cachedWrapU}set wrapU(e){this._cachedWrapU=e}get wrapV(){return this._cachedWrapV}set wrapV(e){this._cachedWrapV=e}get wrapR(){return this._cachedWrapR}set wrapR(e){this._cachedWrapR=e}get anisotropicFilteringLevel(){return this._cachedAnisotropicFilteringLevel}set anisotropicFilteringLevel(e){this._cachedAnisotropicFilteringLevel=e}get comparisonFunction(){return this._comparisonFunction}set comparisonFunction(e){this._comparisonFunction=e}get useMipMaps(){return this._useMipMaps}set useMipMaps(e){this._useMipMaps=e}constructor(){this.samplingMode=-1,this._useMipMaps=!0,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._comparisonFunction=0}setParameters(e=1,t=1,i=1,r=1,s=2,o=0){return this._cachedWrapU=e,this._cachedWrapV=t,this._cachedWrapR=i,this._cachedAnisotropicFilteringLevel=r,this.samplingMode=s,this._comparisonFunction=o,this}compareSampler(e){return this._cachedWrapU===e._cachedWrapU&&this._cachedWrapV===e._cachedWrapV&&this._cachedWrapR===e._cachedWrapR&&this._cachedAnisotropicFilteringLevel===e._cachedAnisotropicFilteringLevel&&this.samplingMode===e.samplingMode&&this._comparisonFunction===e._comparisonFunction&&this._useMipMaps===e._useMipMaps}}var Dt;(function(n){n[n.Unknown=0]="Unknown",n[n.Url=1]="Url",n[n.Temp=2]="Temp",n[n.Raw=3]="Raw",n[n.Dynamic=4]="Dynamic",n[n.RenderTarget=5]="RenderTarget",n[n.MultiRenderTarget=6]="MultiRenderTarget",n[n.Cube=7]="Cube",n[n.CubeRaw=8]="CubeRaw",n[n.CubePrefiltered=9]="CubePrefiltered",n[n.Raw3D=10]="Raw3D",n[n.Raw2DArray=11]="Raw2DArray",n[n.DepthStencil=12]="DepthStencil",n[n.CubeRawRGBD=13]="CubeRawRGBD",n[n.Depth=14]="Depth"})(Dt||(Dt={}));class ur extends oy{get useMipMaps(){return this.generateMipMaps}set useMipMaps(e){this.generateMipMaps=e}get uniqueId(){return this._uniqueId}_setUniqueId(e){this._uniqueId=e}getEngine(){return this._engine}get source(){return this._source}constructor(e,t,i=!1){super(),this.isReady=!1,this.isCube=!1,this.is3D=!1,this.is2DArray=!1,this.isMultiview=!1,this.url="",this.generateMipMaps=!1,this.samples=0,this.type=-1,this.format=-1,this.onLoadedObservable=new he,this.onErrorObservable=new he,this.onRebuildCallback=null,this.width=0,this.height=0,this.depth=0,this.baseWidth=0,this.baseHeight=0,this.baseDepth=0,this.invertY=!1,this._invertVScale=!1,this._associatedChannel=-1,this._source=Dt.Unknown,this._buffer=null,this._bufferView=null,this._bufferViewArray=null,this._bufferViewArrayArray=null,this._size=0,this._extension="",this._files=null,this._workingCanvas=null,this._workingContext=null,this._cachedCoordinatesMode=null,this._isDisabled=!1,this._compression=null,this._sphericalPolynomial=null,this._sphericalPolynomialPromise=null,this._sphericalPolynomialComputed=!1,this._lodGenerationScale=0,this._lodGenerationOffset=0,this._useSRGBBuffer=!1,this._creationFlags=0,this._lodTextureHigh=null,this._lodTextureMid=null,this._lodTextureLow=null,this._isRGBD=!1,this._linearSpecularLOD=!1,this._irradianceTexture=null,this._hardwareTexture=null,this._maxLodLevel=null,this._references=1,this._gammaSpace=null,this._premulAlpha=!1,this._dynamicTextureSource=null,this._engine=e,this._source=t,this._uniqueId=ur._Counter++,i||(this._hardwareTexture=e._createHardwareTexture())}incrementReferences(){this._references++}updateSize(e,t,i=1){this._engine.updateTextureDimensions(this,e,t,i),this.width=e,this.height=t,this.depth=i,this.baseWidth=e,this.baseHeight=t,this.baseDepth=i,this._size=e*t*i}_rebuild(){if(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this.onRebuildCallback){const t=this.onRebuildCallback(this),i=r=>{r._swapAndDie(this,!1),this.isReady=t.isReady};t.isAsync?t.proxy.then(i):i(t.proxy);return}let e;switch(this.source){case Dt.Temp:break;case Dt.Url:e=this._engine.createTexture(this._originalUrl??this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,t=>{t._swapAndDie(this,!1),this.isReady=!0},null,this._buffer,void 0,this.format,this._extension,void 0,void 0,void 0,this._useSRGBBuffer);return;case Dt.Raw:e=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type,this._creationFlags,this._useSRGBBuffer),e._swapAndDie(this,!1),this.isReady=!0;break;case Dt.Raw3D:e=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),e._swapAndDie(this,!1),this.isReady=!0;break;case Dt.Raw2DArray:e=this._engine.createRawTexture2DArray(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),e._swapAndDie(this,!1),this.isReady=!0;break;case Dt.Dynamic:e=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode),e._swapAndDie(this,!1),this._dynamicTextureSource&&this._engine.updateDynamicTexture(this,this._dynamicTextureSource,this.invertY,this._premulAlpha,this.format,!0);break;case Dt.Cube:e=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,()=>{e._swapAndDie(this,!1),this.isReady=!0},null,this.format,this._extension,!1,0,0,null,void 0,this._useSRGBBuffer);return;case Dt.CubeRaw:e=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this._originalFormat??this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),e._swapAndDie(this,!1),this.isReady=!0;break;case Dt.CubeRawRGBD:return;case Dt.CubePrefiltered:e=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,t=>{t&&t._swapAndDie(this,!1),this.isReady=!0},null,this.format,this._extension),e._sphericalPolynomial=this._sphericalPolynomial;return;case Dt.DepthStencil:case Dt.Depth:break}}_swapAndDie(e,t=!0){var i;(i=this._hardwareTexture)==null||i.setUsage(e._source,this.generateMipMaps,this.is2DArray,this.isCube,this.is3D,this.width,this.height,this.depth),e._hardwareTexture=this._hardwareTexture,t&&(e._isRGBD=this._isRGBD),this._lodTextureHigh&&(e._lodTextureHigh&&e._lodTextureHigh.dispose(),e._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(e._lodTextureMid&&e._lodTextureMid.dispose(),e._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(e._lodTextureLow&&e._lodTextureLow.dispose(),e._lodTextureLow=this._lodTextureLow),this._irradianceTexture&&(e._irradianceTexture&&e._irradianceTexture.dispose(),e._irradianceTexture=this._irradianceTexture);const r=this._engine.getLoadedTexturesCache();let s=r.indexOf(this);s!==-1&&r.splice(s,1),s=r.indexOf(e),s===-1&&r.push(e)}dispose(){this._references--,this.onLoadedObservable.clear(),this.onErrorObservable.clear(),this._references===0&&(this._engine._releaseTexture(this),this._hardwareTexture=null,this._dynamicTextureSource=null)}}ur._Counter=0;class ay{constructor(){this.shaderLanguage=Ti.GLSL}postProcessor(e,t,i,r,s){if(!s.getCaps().drawBuffersExtension){const o=/#extension.+GL_EXT_draw_buffers.+(enable|require)/g;e=e.replace(o,"")}return e}}const ly=/(flat\s)?\s*varying\s*.*/;class hy{constructor(){this.shaderLanguage=Ti.GLSL}attributeProcessor(e){return e.replace("attribute","in")}varyingCheck(e,t){return ly.test(e)}varyingProcessor(e,t){return e.replace("varying",t?"in":"out")}postProcessor(e,t,i){const r=e.search(/#extension.+GL_EXT_draw_buffers.+require/)!==-1,s=/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g;if(e=e.replace(s,""),e=e.replace(/texture2D\s*\(/g,"texture("),i){const o=e.search(/layout *\(location *= *0\) *out/g)!==-1;e=e.replace(/texture2DLodEXT\s*\(/g,"textureLod("),e=e.replace(/textureCubeLodEXT\s*\(/g,"textureLod("),e=e.replace(/textureCube\s*\(/g,"texture("),e=e.replace(/gl_FragDepthEXT/g,"gl_FragDepth"),e=e.replace(/gl_FragColor/g,"glFragColor"),e=e.replace(/gl_FragData/g,"glFragData"),e=e.replace(/void\s+?main\s*\(/g,(r||o?"":`layout(location = 0) out vec4 glFragColor;
`)+"void main(")}else if(t.indexOf("#define MULTIVIEW")!==-1)return`#extension GL_OVR_multiview2 : require
layout (num_views = 2) in;
`+e;return e}}class qa{get underlyingResource(){return null}constructor(){this.references=0,this.capacity=0,this.is32Bits=!1,this.uniqueId=qa._Counter++}}qa._Counter=0;class Ta extends qa{constructor(e){super(),this._buffer=e}get underlyingResource(){return this._buffer}}class cy{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return this.program?this.isParallelCompiled?this.engine._isRenderingStateCompiled(this):!0:!1}_handlesSpectorRebuildCallback(e){e&&this.program&&e(this.program)}_fillEffectInformation(e,t,i,r,s,o,a,l){const h=this.engine;if(h.supportsUniformBuffers)for(const u in t)e.bindUniformBlock(u,t[u]);this.engine.getUniforms(this,i).forEach((u,d)=>{r[i[d]]=u}),this._uniforms=r;let c;for(c=0;c<s.length;c++)e.getUniform(s[c])==null&&(s.splice(c,1),c--);s.forEach((u,d)=>{o[u]=d});for(const u of h.getAttributes(this,a))l.push(u)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(e,t){const i=this._valueCache[e],r=t.updateFlag;return i!==void 0&&i===r?!1:(this._valueCache[e]=r,!0)}_cacheFloat2(e,t,i){let r=this._valueCache[e];if(!r||r.length!==2)return r=[t,i],this._valueCache[e]=r,!0;let s=!1;return r[0]!==t&&(r[0]=t,s=!0),r[1]!==i&&(r[1]=i,s=!0),s}_cacheFloat3(e,t,i,r){let s=this._valueCache[e];if(!s||s.length!==3)return s=[t,i,r],this._valueCache[e]=s,!0;let o=!1;return s[0]!==t&&(s[0]=t,o=!0),s[1]!==i&&(s[1]=i,o=!0),s[2]!==r&&(s[2]=r,o=!0),o}_cacheFloat4(e,t,i,r,s){let o=this._valueCache[e];if(!o||o.length!==4)return o=[t,i,r,s],this._valueCache[e]=o,!0;let a=!1;return o[0]!==t&&(o[0]=t,a=!0),o[1]!==i&&(o[1]=i,a=!0),o[2]!==r&&(o[2]=r,a=!0),o[3]!==s&&(o[3]=s,a=!0),a}setInt(e,t){const i=this._valueCache[e];i!==void 0&&i===t||this.engine.setInt(this._uniforms[e],t)&&(this._valueCache[e]=t)}setInt2(e,t,i){this._cacheFloat2(e,t,i)&&(this.engine.setInt2(this._uniforms[e],t,i)||(this._valueCache[e]=null))}setInt3(e,t,i,r){this._cacheFloat3(e,t,i,r)&&(this.engine.setInt3(this._uniforms[e],t,i,r)||(this._valueCache[e]=null))}setInt4(e,t,i,r,s){this._cacheFloat4(e,t,i,r,s)&&(this.engine.setInt4(this._uniforms[e],t,i,r,s)||(this._valueCache[e]=null))}setIntArray(e,t){this._valueCache[e]=null,this.engine.setIntArray(this._uniforms[e],t)}setIntArray2(e,t){this._valueCache[e]=null,this.engine.setIntArray2(this._uniforms[e],t)}setIntArray3(e,t){this._valueCache[e]=null,this.engine.setIntArray3(this._uniforms[e],t)}setIntArray4(e,t){this._valueCache[e]=null,this.engine.setIntArray4(this._uniforms[e],t)}setUInt(e,t){const i=this._valueCache[e];i!==void 0&&i===t||this.engine.setUInt(this._uniforms[e],t)&&(this._valueCache[e]=t)}setUInt2(e,t,i){this._cacheFloat2(e,t,i)&&(this.engine.setUInt2(this._uniforms[e],t,i)||(this._valueCache[e]=null))}setUInt3(e,t,i,r){this._cacheFloat3(e,t,i,r)&&(this.engine.setUInt3(this._uniforms[e],t,i,r)||(this._valueCache[e]=null))}setUInt4(e,t,i,r,s){this._cacheFloat4(e,t,i,r,s)&&(this.engine.setUInt4(this._uniforms[e],t,i,r,s)||(this._valueCache[e]=null))}setUIntArray(e,t){this._valueCache[e]=null,this.engine.setUIntArray(this._uniforms[e],t)}setUIntArray2(e,t){this._valueCache[e]=null,this.engine.setUIntArray2(this._uniforms[e],t)}setUIntArray3(e,t){this._valueCache[e]=null,this.engine.setUIntArray3(this._uniforms[e],t)}setUIntArray4(e,t){this._valueCache[e]=null,this.engine.setUIntArray4(this._uniforms[e],t)}setArray(e,t){this._valueCache[e]=null,this.engine.setArray(this._uniforms[e],t)}setArray2(e,t){this._valueCache[e]=null,this.engine.setArray2(this._uniforms[e],t)}setArray3(e,t){this._valueCache[e]=null,this.engine.setArray3(this._uniforms[e],t)}setArray4(e,t){this._valueCache[e]=null,this.engine.setArray4(this._uniforms[e],t)}setMatrices(e,t){t&&(this._valueCache[e]=null,this.engine.setMatrices(this._uniforms[e],t))}setMatrix(e,t){this._cacheMatrix(e,t)&&(this.engine.setMatrices(this._uniforms[e],t.asArray())||(this._valueCache[e]=null))}setMatrix3x3(e,t){this._valueCache[e]=null,this.engine.setMatrix3x3(this._uniforms[e],t)}setMatrix2x2(e,t){this._valueCache[e]=null,this.engine.setMatrix2x2(this._uniforms[e],t)}setFloat(e,t){const i=this._valueCache[e];i!==void 0&&i===t||this.engine.setFloat(this._uniforms[e],t)&&(this._valueCache[e]=t)}setVector2(e,t){this._cacheFloat2(e,t.x,t.y)&&(this.engine.setFloat2(this._uniforms[e],t.x,t.y)||(this._valueCache[e]=null))}setFloat2(e,t,i){this._cacheFloat2(e,t,i)&&(this.engine.setFloat2(this._uniforms[e],t,i)||(this._valueCache[e]=null))}setVector3(e,t){this._cacheFloat3(e,t.x,t.y,t.z)&&(this.engine.setFloat3(this._uniforms[e],t.x,t.y,t.z)||(this._valueCache[e]=null))}setFloat3(e,t,i,r){this._cacheFloat3(e,t,i,r)&&(this.engine.setFloat3(this._uniforms[e],t,i,r)||(this._valueCache[e]=null))}setVector4(e,t){this._cacheFloat4(e,t.x,t.y,t.z,t.w)&&(this.engine.setFloat4(this._uniforms[e],t.x,t.y,t.z,t.w)||(this._valueCache[e]=null))}setQuaternion(e,t){this._cacheFloat4(e,t.x,t.y,t.z,t.w)&&(this.engine.setFloat4(this._uniforms[e],t.x,t.y,t.z,t.w)||(this._valueCache[e]=null))}setFloat4(e,t,i,r,s){this._cacheFloat4(e,t,i,r,s)&&(this.engine.setFloat4(this._uniforms[e],t,i,r,s)||(this._valueCache[e]=null))}setColor3(e,t){this._cacheFloat3(e,t.r,t.g,t.b)&&(this.engine.setFloat3(this._uniforms[e],t.r,t.g,t.b)||(this._valueCache[e]=null))}setColor4(e,t,i){this._cacheFloat4(e,t.r,t.g,t.b,i)&&(this.engine.setFloat4(this._uniforms[e],t.r,t.g,t.b,i)||(this._valueCache[e]=null))}setDirectColor4(e,t){this._cacheFloat4(e,t.r,t.g,t.b,t.a)&&(this.engine.setFloat4(this._uniforms[e],t.r,t.g,t.b,t.a)||(this._valueCache[e]=null))}_getVertexShaderCode(){return this.vertexShader?this.engine._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.engine._getShaderSource(this.fragmentShader):null}}class vi{static SetMatrixPrecision(e){if(vi.MatrixTrackPrecisionChange=!1,e&&!vi.MatrixUse64Bits&&vi.MatrixTrackedMatrices)for(let t=0;t<vi.MatrixTrackedMatrices.length;++t){const i=vi.MatrixTrackedMatrices[t],r=i._m;i._m=new Array(16);for(let s=0;s<16;++s)i._m[s]=r[s]}vi.MatrixUse64Bits=e,vi.MatrixCurrentType=vi.MatrixUse64Bits?Array:Float32Array,vi.MatrixTrackedMatrices=null}}vi.MatrixUse64Bits=!1;vi.MatrixTrackPrecisionChange=!0;vi.MatrixCurrentType=Float32Array;vi.MatrixTrackedMatrices=[];class Q_{get underlyingResource(){return this._webGLTexture}constructor(e=null,t){if(this._MSAARenderBuffers=null,this._context=t,!e&&(e=t.createTexture(),!e))throw new Error("Unable to create webGL texture");this.set(e)}setUsage(){}set(e){this._webGLTexture=e}reset(){this._webGLTexture=null,this._MSAARenderBuffers=null}addMSAARenderBuffer(e){this._MSAARenderBuffers||(this._MSAARenderBuffers=[]),this._MSAARenderBuffers.push(e)}releaseMSAARenderBuffers(){if(this._MSAARenderBuffers){for(const e of this._MSAARenderBuffers)this._context.deleteRenderbuffer(e);this._MSAARenderBuffers=null}}getMSAARenderBuffer(e=0){var t;return((t=this._MSAARenderBuffers)==null?void 0:t[e])??null}release(){this.releaseMSAARenderBuffers(),this._webGLTexture&&this._context.deleteTexture(this._webGLTexture),this.reset()}}class Ko{static IsWrapper(e){return e.getPipelineContext===void 0}static GetEffect(e){return e.getPipelineContext===void 0?e.effect:e}constructor(e,t=!0){this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=e.createDrawContext(),t&&(this.materialContext=e.createMaterialContext())}setEffect(e,t,i=!0){var r;this.effect=e,t!==void 0&&(this.defines=t),i&&((r=this.drawContext)==null||r.reset())}dispose(){var e;(e=this.drawContext)==null||e.dispose()}}class uy{get isDirty(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty}get func(){return this._func}set func(e){this._func!==e&&(this._func=e,this._isStencilFuncDirty=!0)}get funcRef(){return this._funcRef}set funcRef(e){this._funcRef!==e&&(this._funcRef=e,this._isStencilFuncDirty=!0)}get funcMask(){return this._funcMask}set funcMask(e){this._funcMask!==e&&(this._funcMask=e,this._isStencilFuncDirty=!0)}get opStencilFail(){return this._opStencilFail}set opStencilFail(e){this._opStencilFail!==e&&(this._opStencilFail=e,this._isStencilOpDirty=!0)}get opDepthFail(){return this._opDepthFail}set opDepthFail(e){this._opDepthFail!==e&&(this._opDepthFail=e,this._isStencilOpDirty=!0)}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(e){this._opStencilDepthPass!==e&&(this._opStencilDepthPass=e,this._isStencilOpDirty=!0)}get mask(){return this._mask}set mask(e){this._mask!==e&&(this._mask=e,this._isStencilMaskDirty=!0)}get enabled(){return this._enabled}set enabled(e){this._enabled!==e&&(this._enabled=e,this._isStencilTestDirty=!0)}constructor(e=!0){this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.useStencilGlobalOnly=!1,e&&this.reset()}reset(){var e;this.stencilMaterial=void 0,(e=this.stencilGlobal)==null||e.reset(),this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0}apply(e){var t;if(!e)return;const i=!this.useStencilGlobalOnly&&!!((t=this.stencilMaterial)!=null&&t.enabled);this.enabled=i?this.stencilMaterial.enabled:this.stencilGlobal.enabled,this.func=i?this.stencilMaterial.func:this.stencilGlobal.func,this.funcRef=i?this.stencilMaterial.funcRef:this.stencilGlobal.funcRef,this.funcMask=i?this.stencilMaterial.funcMask:this.stencilGlobal.funcMask,this.opStencilFail=i?this.stencilMaterial.opStencilFail:this.stencilGlobal.opStencilFail,this.opDepthFail=i?this.stencilMaterial.opDepthFail:this.stencilGlobal.opDepthFail,this.opStencilDepthPass=i?this.stencilMaterial.opStencilDepthPass:this.stencilGlobal.opStencilDepthPass,this.mask=i?this.stencilMaterial.mask:this.stencilGlobal.mask,this.isDirty&&(this._isStencilTestDirty&&(this.enabled?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(e.stencilMask(this.mask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(e.stencilFunc(this.func,this.funcRef,this.funcMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(e.stencilOp(this.opStencilFail,this.opDepthFail,this.opStencilDepthPass),this._isStencilOpDirty=!1))}}class dy{}class Oe{static get NpmPackage(){return"babylonjs@7.0.0"}static get Version(){return"7.0.0"}get description(){let e=this.name+this.webGLVersion;return this._caps.parallelShaderCompile&&(e+=" - Parallel shader compilation"),e}get name(){return this._name}set name(e){this._name=e}get version(){return this._webGLVersion}get isDisposed(){return this._isDisposed}static get ShadersRepository(){return Zi.ShadersRepository}static set ShadersRepository(e){Zi.ShadersRepository=e}_getShaderProcessor(e){return this._shaderProcessor}get useReverseDepthBuffer(){return this._useReverseDepthBuffer}set useReverseDepthBuffer(e){e!==this._useReverseDepthBuffer&&(this._useReverseDepthBuffer=e,e?this._depthCullingState.depthFunc=518:this._depthCullingState.depthFunc=515)}get frameId(){return this._frameId}get supportsUniformBuffers(){return this.webGLVersion>1&&!this.disableUniformBuffers}getCreationOptions(){return this._creationOptions}get _shouldUseHighPrecisionShader(){return!!(this._caps.highPrecisionShaderSupported&&this._highPrecisionShadersAllowed)}get needPOTTextures(){return this._webGLVersion<2||this.forcePOTTextures}get activeRenderLoops(){return this._activeRenderLoops}get doNotHandleContextLost(){return this._doNotHandleContextLost}set doNotHandleContextLost(e){this._doNotHandleContextLost=e}get _supportsHardwareTextureRescaling(){return!1}set framebufferDimensionsObject(e){this._framebufferDimensionsObject=e}get currentViewport(){return this._cachedViewport}get emptyTexture(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,5,!1,!1,1)),this._emptyTexture}get emptyTexture3D(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture3D}get emptyTexture2DArray(){return this._emptyTexture2DArray||(this._emptyTexture2DArray=this.createRawTexture2DArray(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture2DArray}get emptyCubeTexture(){if(!this._emptyCubeTexture){const e=new Uint8Array(4),t=[e,e,e,e,e,e];this._emptyCubeTexture=this.createRawCubeTexture(t,1,5,0,!1,!1,1)}return this._emptyCubeTexture}get isWebGPU(){return this._isWebGPU}get shaderPlatformName(){return this._shaderPlatformName}get snapshotRendering(){return!1}set snapshotRendering(e){}get snapshotRenderingMode(){return this._snapshotRenderingMode}set snapshotRenderingMode(e){this._snapshotRenderingMode=e}snapshotRenderingReset(){this.snapshotRendering=!1}static _CreateCanvas(e,t){if(typeof document>"u")return new OffscreenCanvas(e,t);const i=document.createElement("canvas");return i.width=e,i.height=t,i}createCanvas(e,t){return Oe._CreateCanvas(e,t)}createCanvasImage(){return document.createElement("img")}constructor(e,t,i,r){var s,o;this._name="WebGL",this._isDisposed=!1,this.forcePOTTextures=!1,this.isFullscreen=!1,this.cullBackFaces=null,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this.validateShaderPrograms=!1,this._useReverseDepthBuffer=!1,this.isNDCHalfZRange=!1,this.hasOriginBottomLeft=!0,this.disableUniformBuffers=!1,this.onDisposeObservable=new he,this._frameId=0,this._uniformBuffers=new Array,this._storageBuffers=new Array,this._webGLVersion=1,this._windowIsBackground=!1,this._highPrecisionShadersAllowed=!0,this._badOS=!1,this._badDesktopOS=!1,this._activeRenderLoops=new Array,this.onContextLostObservable=new he,this.onContextRestoredObservable=new he,this._contextWasLost=!1,this._doNotHandleContextLost=!1,this.disableVertexArrayObjects=!1,this._colorWrite=!0,this._colorWriteChanged=!0,this._depthCullingState=new sy,this._stencilStateComposer=new uy,this._stencilState=new ks,this._alphaState=new ny,this._alphaMode=1,this._alphaEquation=0,this._internalTexturesCache=new Array,this._renderTargetWrapperCache=new Array,this._activeChannel=0,this._currentTextureChannel=-1,this._boundTexturesCache={},this._compiledEffects={},this._vertexAttribArraysEnabled=[],this._currentRenderTarget=null,this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._dummyFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._boundRenderFunction=()=>this._renderLoop(),this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._frameHandler=0,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._maxMSAASamplesOverride=null,this._activeRequests=new Array,this.adaptToDeviceRatio=!1,this._lastDevicePixelRatio=1,this._transformTextureUrl=null,this.hostInformation={isMobile:!1},this.premultipliedAlpha=!0,this.onBeforeTextureInitObservable=new he,this._isWebGPU=!1,this._snapshotRenderingMode=0,this._viewportCached={x:0,y:0,z:0,w:0},this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._boundUniforms={},this.startTime=hr.Now;let a=null;i=i||{},this._creationOptions=i,this.adaptToDeviceRatio=r??!1,this._stencilStateComposer.stencilGlobal=this._stencilState,vi.SetMatrixPrecision(!!i.useHighPrecisionMatrix),i.antialias=t??i.antialias,i.deterministicLockstep=i.deterministicLockstep??!1,i.lockstepMaxSteps=i.lockstepMaxSteps??4,i.timeStep=i.timeStep??1/60,i.audioEngine=i.audioEngine??!0,i.stencil=i.stencil??!0,this._audioContext=((s=i.audioEngineOptions)==null?void 0:s.audioContext)??null,this._audioDestination=((o=i.audioEngineOptions)==null?void 0:o.audioDestination)??null,this.premultipliedAlpha=i.premultipliedAlpha??!0,this.useExactSrgbConversions=i.useExactSrgbConversions??!1,this._doNotHandleContextLost=!!i.doNotHandleContextLost,this._isStencilEnable=!!i.stencil,r=r||i.adaptToDeviceRatio||!1;const l=Ai()&&window.devicePixelRatio||1,h=i.limitDeviceRatio||l;if(this._hardwareScalingLevel=r?1/Math.min(h,l):1,this._lastDevicePixelRatio=l,!e)return;if(e.getContext){if(a=e,this._renderingCanvas=a,i.preserveDrawingBuffer===void 0&&(i.preserveDrawingBuffer=!1),i.xrCompatible===void 0&&(i.xrCompatible=!0),navigator&&navigator.userAgent){this._setupMobileChecks();const u=navigator.userAgent;for(const d of Oe.ExceptionList){const f=d.key,p=d.targets;if(new RegExp(f).test(u)){if(d.capture&&d.captureConstraint){const g=d.capture,m=d.captureConstraint,x=new RegExp(g).exec(u);if(x&&x.length>0&&parseInt(x[x.length-1])>=m)continue}for(const g of p)switch(g){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0;break;case"antialias":i.antialias=!1;break;case"maxMSAASamples":this._maxMSAASamplesOverride=1;break}}}}if(this._doNotHandleContextLost||(this._onContextLost=u=>{u.preventDefault(),this._contextWasLost=!0,oe.Warn("WebGL context lost."),this.onContextLostObservable.notifyObservers(this)},this._onContextRestored=()=>{this._restoreEngineAfterContextLost(()=>this._initGLContext())},a.addEventListener("webglcontextlost",this._onContextLost,!1),a.addEventListener("webglcontextrestored",this._onContextRestored,!1),i.powerPreference=i.powerPreference||"high-performance"),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),this._badDesktopOS&&(i.xrCompatible=!1),!i.disableWebGL2Support)try{this._gl=a.getContext("webgl2",i)||a.getContext("experimental-webgl2",i),this._gl&&(this._webGLVersion=2,this._shaderPlatformName="WEBGL2",this._gl.deleteQuery||(this._webGLVersion=1,this._shaderPlatformName="WEBGL1"))}catch{}if(!this._gl){if(!a)throw new Error("The provided canvas is null or undefined.");try{this._gl=a.getContext("webgl",i)||a.getContext("experimental-webgl",i)}catch{throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported")}else{this._gl=e,this._renderingCanvas=this._gl.canvas,this._gl.renderbufferStorageMultisample?(this._webGLVersion=2,this._shaderPlatformName="WEBGL2"):this._shaderPlatformName="WEBGL1";const u=this._gl.getContextAttributes();u&&(i.stencil=u.stencil)}this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),i.useHighPrecisionFloats!==void 0&&(this._highPrecisionShadersAllowed=i.useHighPrecisionFloats),this.resize(),this._initGLContext(),this._initFeatures();for(let u=0;u<this._caps.maxVertexAttribs;u++)this._currentBufferPointers[u]=new dy;this._shaderProcessor=this.webGLVersion>1?new hy:new ay,this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent);const c=`Babylon.js v${Oe.Version}`;oe.Log(c+` - ${this.description}`),this._renderingCanvas&&this._renderingCanvas.setAttribute&&this._renderingCanvas.setAttribute("data-engine",c)}_setupMobileChecks(){navigator&&navigator.userAgent&&(this._checkForMobile=()=>{const e=navigator.userAgent;this.hostInformation.isMobile=e.indexOf("Mobile")!==-1||e.indexOf("Mac")!==-1&&da()&&"ontouchend"in document},this._checkForMobile(),Ai()&&window.addEventListener("resize",this._checkForMobile))}_clearEmptyResources(){this._dummyFramebuffer=null,this._emptyTexture=null,this._emptyCubeTexture=null,this._emptyTexture3D=null,this._emptyTexture2DArray=null}_rebuildGraphicsResources(){var e;this.wipeCaches(!0),this._rebuildEffects(),(e=this._rebuildComputeEffects)==null||e.call(this),this._rebuildBuffers(),this._rebuildInternalTextures(),this._rebuildTextures(),this._rebuildRenderTargetWrappers(),this.wipeCaches(!0)}_flagContextRestored(){oe.Warn(this.name+" context successfully restored."),this.onContextRestoredObservable.notifyObservers(this),this._contextWasLost=!1}_restoreEngineAfterContextLost(e){setTimeout(async()=>{this._clearEmptyResources();const t=this._depthCullingState.depthTest,i=this._depthCullingState.depthFunc,r=this._depthCullingState.depthMask,s=this._stencilState.stencilTest;await e(),this._rebuildGraphicsResources(),this._depthCullingState.depthTest=t,this._depthCullingState.depthFunc=i,this._depthCullingState.depthMask=r,this._stencilState.stencilTest=s,this._flagContextRestored()},0)}_sharedInit(e){this._renderingCanvas=e}_getShaderProcessingContext(e){return null}_rebuildInternalTextures(){const e=this._internalTexturesCache.slice();for(const t of e)t._rebuild()}_rebuildRenderTargetWrappers(){const e=this._renderTargetWrapperCache.slice();for(const t of e)t._rebuild()}_rebuildEffects(){for(const e in this._compiledEffects){const t=this._compiledEffects[e];t._pipelineContext=null,t._prepareEffect()}Zi.ResetCache()}areAllEffectsReady(){for(const e in this._compiledEffects)if(!this._compiledEffects[e].isReady())return!1;return!0}_rebuildBuffers(){for(const e of this._uniformBuffers)e._rebuildAfterContextLost()}_rebuildTextures(){}_initGLContext(){this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile")||void 0,standardDerivatives:this._webGLVersion>1||this._gl.getExtension("OES_standard_derivatives")!==null,maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),bptc:this._gl.getExtension("EXT_texture_compression_bptc")||this._gl.getExtension("WEBKIT_EXT_texture_compression_bptc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),s3tc_srgb:this._gl.getExtension("WEBGL_compressed_texture_s3tc_srgb")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc_srgb"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:this._webGLVersion>1||this._gl.getExtension("OES_element_index_uint")!==null,fragmentDepthSupported:this._webGLVersion>1||this._gl.getExtension("EXT_frag_depth")!==null,highPrecisionShaderSupported:!1,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),supportOcclusionQuery:this._webGLVersion>1,canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float")),supportFloatTexturesResolve:!1,rg11b10ufColorRenderable:!1,colorBufferHalfFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_half_float")),textureFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),textureHalfFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),texelFetch:this._webGLVersion!==1,blendMinMax:!1,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:!1,canUseGLInstanceID:this._webGLVersion>1,canUseGLVertexID:this._webGLVersion>1,supportComputeShaders:!1,supportSRGBBuffers:!1,supportTransformFeedbacks:this._webGLVersion>1,textureMaxLevel:this._webGLVersion>1,texture2DArrayMaxLayerCount:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_ARRAY_TEXTURE_LAYERS):128,disableMorphTargetTexture:!1},this._caps.supportFloatTexturesResolve=this._caps.colorBufferFloat,this._caps.rg11b10ufColorRenderable=this._caps.colorBufferFloat,this._glVersion=this._gl.getParameter(this._gl.VERSION);const e=this._gl.getExtension("WEBGL_debug_renderer_info");if(e!=null&&(this._glRenderer=this._gl.getParameter(e.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(e.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor=this._gl.getParameter(this._gl.VENDOR)||"Unknown vendor"),this._glRenderer||(this._glRenderer=this._gl.getParameter(this._gl.RENDERER)||"Unknown renderer"),this._gl.HALF_FLOAT_OES!==36193&&(this._gl.HALF_FLOAT_OES=36193),this._gl.RGBA16F!==34842&&(this._gl.RGBA16F=34842),this._gl.RGBA32F!==34836&&(this._gl.RGBA32F=34836),this._gl.DEPTH24_STENCIL8!==35056&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(this._webGLVersion===1&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=(this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)??0)>0),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!!(this._caps.textureFloat&&this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!!(this._caps.textureFloat&&this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._caps.astc&&(this._gl.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=this._caps.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR),this._caps.bptc&&(this._gl.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=this._caps.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT),this._caps.s3tc_srgb&&(this._gl.COMPRESSED_SRGB_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT),this._caps.etc2&&(this._gl.COMPRESSED_SRGB8_ETC2=this._caps.etc2.COMPRESSED_SRGB8_ETC2,this._gl.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=this._caps.etc2.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC),this._webGLVersion>1&&this._gl.HALF_FLOAT_OES!==5131&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._webGLVersion>1)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=this._maxMSAASamplesOverride!==null?this._maxMSAASamplesOverride:this._gl.getParameter(this._gl.MAX_SAMPLES);else{const t=this._gl.getExtension("WEBGL_draw_buffers");if(t!==null){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=t.drawBuffersWEBGL.bind(t),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(let i=0;i<16;i++)this._gl["COLOR_ATTACHMENT"+i+"_WEBGL"]=t["COLOR_ATTACHMENT"+i+"_WEBGL"]}}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{const t=this._gl.getExtension("WEBGL_depth_texture");t!=null&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=t.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{const t=this._gl.getExtension("OES_vertex_array_object");t!=null&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=t.createVertexArrayOES.bind(t),this._gl.bindVertexArray=t.bindVertexArrayOES.bind(t),this._gl.deleteVertexArray=t.deleteVertexArrayOES.bind(t))}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{const t=this._gl.getExtension("ANGLE_instanced_arrays");t!=null?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=t.drawArraysInstancedANGLE.bind(t),this._gl.drawElementsInstanced=t.drawElementsInstancedANGLE.bind(t),this._gl.vertexAttribDivisor=t.vertexAttribDivisorANGLE.bind(t)):this._caps.instancedArrays=!1}if(this._gl.getShaderPrecisionFormat){const t=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),i=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);t&&i&&(this._caps.highPrecisionShaderSupported=t.precision!==0&&i.precision!==0)}if(this._webGLVersion>1)this._caps.blendMinMax=!0;else{const t=this._gl.getExtension("EXT_blend_minmax");t!=null&&(this._caps.blendMinMax=!0,this._gl.MAX=t.MAX_EXT,this._gl.MIN=t.MIN_EXT)}if(!this._caps.supportSRGBBuffers){if(this._webGLVersion>1)this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:WebGL2RenderingContext.SRGB,SRGB8:WebGL2RenderingContext.SRGB8,SRGB8_ALPHA8:WebGL2RenderingContext.SRGB8_ALPHA8};else{const t=this._gl.getExtension("EXT_sRGB");t!=null&&(this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:t.SRGB_EXT,SRGB8:t.SRGB_ALPHA_EXT,SRGB8_ALPHA8:t.SRGB_ALPHA_EXT})}this._caps.supportSRGBBuffers=this._caps.supportSRGBBuffers&&!!(this._creationOptions&&this._creationOptions.forceSRGBBufferSupportState)}this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(let t=0;t<this._maxSimultaneousTextures;t++)this._nextFreeTextureSlots.push(t);this._glRenderer==="Mali-G72"&&(this._caps.disableMorphTargetTexture=!0)}_initFeatures(){this._features={forceBitmapOverHTMLImageElement:typeof HTMLImageElement>"u",supportRenderAndCopyToLodForFloatTextures:this._webGLVersion!==1,supportDepthStencilTexture:this._webGLVersion!==1,supportShadowSamplers:this._webGLVersion!==1,uniformBufferHardCheckMatrix:!1,allowTexturePrefiltering:this._webGLVersion!==1,trackUbosInFrame:!1,checkUbosContentBeforeUpload:!1,supportCSM:this._webGLVersion!==1,basisNeedsPOT:this._webGLVersion===1,support3DTextures:this._webGLVersion!==1,needTypeSuffixInShaderConstants:this._webGLVersion!==1,supportMSAA:this._webGLVersion!==1,supportSSAO2:this._webGLVersion!==1,supportExtendedTextureFormats:this._webGLVersion!==1,supportSwitchCaseInShader:this._webGLVersion!==1,supportSyncTextureRead:!0,needsInvertingBitmap:!0,useUBOBindingCache:!0,needShaderCodeInlining:!1,needToAlwaysBindUniformBuffers:!1,supportRenderPasses:!1,supportSpriteInstancing:!0,forceVertexBufferStrideAndOffsetMultiple4Bytes:!1,_collectUbosUpdatedInFrame:!1}}get webGLVersion(){return this._webGLVersion}getClassName(){return"ThinEngine"}get isStencilEnable(){return this._isStencilEnable}_prepareWorkingCanvas(){if(this._workingCanvas)return;this._workingCanvas=this.createCanvas(1,1);const e=this._workingCanvas.getContext("2d");e&&(this._workingContext=e)}resetTextureCache(){for(const e in this._boundTexturesCache)Object.prototype.hasOwnProperty.call(this._boundTexturesCache,e)&&(this._boundTexturesCache[e]=null);this._currentTextureChannel=-1}getInfo(){return this.getGlInfo()}getGlInfo(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}}setHardwareScalingLevel(e){this._hardwareScalingLevel=e,this.resize()}getHardwareScalingLevel(){return this._hardwareScalingLevel}getLoadedTexturesCache(){return this._internalTexturesCache}getCaps(){return this._caps}stopRenderLoop(e){if(!e){this._activeRenderLoops.length=0,this._cancelFrame();return}const t=this._activeRenderLoops.indexOf(e);t>=0&&(this._activeRenderLoops.splice(t,1),this._activeRenderLoops.length==0&&this._cancelFrame())}_cancelFrame(){if(this._frameHandler!==0){const e=this._frameHandler;if(this._frameHandler=0,Ai()){const{cancelAnimationFrame:t}=this.getHostWindow()||window;if(typeof t=="function")return t(e)}else if(typeof cancelAnimationFrame=="function")return cancelAnimationFrame(e);return clearTimeout(e)}}_renderLoop(){if(this._frameHandler=0,!this._contextWasLost){let e=!0;if((this._isDisposed||!this.renderEvenInBackground&&this._windowIsBackground)&&(e=!1),e){this.beginFrame();for(let t=0;t<this._activeRenderLoops.length;t++){const i=this._activeRenderLoops[t];i()}this.endFrame()}}this._frameHandler===0&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}getRenderingCanvas(){return this._renderingCanvas}getAudioContext(){return this._audioContext}getAudioDestination(){return this._audioDestination}getHostWindow(){return Ai()?this._renderingCanvas&&this._renderingCanvas.ownerDocument&&this._renderingCanvas.ownerDocument.defaultView?this._renderingCanvas.ownerDocument.defaultView:window:null}getRenderWidth(e=!1){return!e&&this._currentRenderTarget?this._currentRenderTarget.width:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth}getRenderHeight(e=!1){return!e&&this._currentRenderTarget?this._currentRenderTarget.height:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight}_queueNewFrame(e,t){return Oe.QueueNewFrame(e,t)}runRenderLoop(e){this._activeRenderLoops.indexOf(e)===-1&&(this._activeRenderLoops.push(e),this._activeRenderLoops.length===1&&this._frameHandler===0&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow())))}clear(e,t,i,r=!1){var s,o;const a=this.stencilStateComposer.useStencilGlobalOnly;this.stencilStateComposer.useStencilGlobalOnly=!0,this.applyStates(),this.stencilStateComposer.useStencilGlobalOnly=a;let l=0;if(t&&e){let h=!0;if(this._currentRenderTarget){const c=(s=this._currentRenderTarget.texture)==null?void 0:s.format;if(c===8||c===9||c===10||c===11){const u=(o=this._currentRenderTarget.texture)==null?void 0:o.type;u===7||u===5?(Oe._TempClearColorUint32[0]=e.r*255,Oe._TempClearColorUint32[1]=e.g*255,Oe._TempClearColorUint32[2]=e.b*255,Oe._TempClearColorUint32[3]=e.a*255,this._gl.clearBufferuiv(this._gl.COLOR,0,Oe._TempClearColorUint32),h=!1):(Oe._TempClearColorInt32[0]=e.r*255,Oe._TempClearColorInt32[1]=e.g*255,Oe._TempClearColorInt32[2]=e.b*255,Oe._TempClearColorInt32[3]=e.a*255,this._gl.clearBufferiv(this._gl.COLOR,0,Oe._TempClearColorInt32),h=!1)}}h&&(this._gl.clearColor(e.r,e.g,e.b,e.a!==void 0?e.a:1),l|=this._gl.COLOR_BUFFER_BIT)}i&&(this.useReverseDepthBuffer?(this._depthCullingState.depthFunc=this._gl.GEQUAL,this._gl.clearDepth(0)):this._gl.clearDepth(1),l|=this._gl.DEPTH_BUFFER_BIT),r&&(this._gl.clearStencil(0),l|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(l)}_viewport(e,t,i,r){(e!==this._viewportCached.x||t!==this._viewportCached.y||i!==this._viewportCached.z||r!==this._viewportCached.w)&&(this._viewportCached.x=e,this._viewportCached.y=t,this._viewportCached.z=i,this._viewportCached.w=r,this._gl.viewport(e,t,i,r))}setViewport(e,t,i){const r=t||this.getRenderWidth(),s=i||this.getRenderHeight(),o=e.x||0,a=e.y||0;this._cachedViewport=e,this._viewport(o*r,a*s,r*e.width,s*e.height)}beginFrame(){}endFrame(){this._badOS&&this.flushFramebuffer(),this._frameId++}resize(e=!1){let t,i;if(this.adaptToDeviceRatio){const r=Ai()&&window.devicePixelRatio||1,s=this._lastDevicePixelRatio/r;this._lastDevicePixelRatio=r,this._hardwareScalingLevel*=s}if(Ai()&&da())if(this._renderingCanvas){const r=this._renderingCanvas.getBoundingClientRect?this._renderingCanvas.getBoundingClientRect():{width:this._renderingCanvas.width*this._hardwareScalingLevel,height:this._renderingCanvas.height*this._hardwareScalingLevel};t=this._renderingCanvas.clientWidth||r.width||this._renderingCanvas.width||100,i=this._renderingCanvas.clientHeight||r.height||this._renderingCanvas.height||100}else t=window.innerWidth,i=window.innerHeight;else t=this._renderingCanvas?this._renderingCanvas.width:100,i=this._renderingCanvas?this._renderingCanvas.height:100;this.setSize(t/this._hardwareScalingLevel,i/this._hardwareScalingLevel,e)}setSize(e,t,i=!1){return!this._renderingCanvas||(e=e|0,t=t|0,!i&&this._renderingCanvas.width===e&&this._renderingCanvas.height===t)?!1:(this._renderingCanvas.width=e,this._renderingCanvas.height=t,!0)}bindFramebuffer(e,t=0,i,r,s,o=0,a=0){var l,h,c,u,d,f;const p=e;this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=e,this._bindUnboundFramebuffer(p._MSAAFramebuffer?p._MSAAFramebuffer:p._framebuffer);const g=this._gl;e.isMulti||(e.is2DArray?g.framebufferTextureLayer(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,(l=e.texture._hardwareTexture)==null?void 0:l.underlyingResource,o,a):e.isCube?g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_CUBE_MAP_POSITIVE_X+t,(h=e.texture._hardwareTexture)==null?void 0:h.underlyingResource,o):p._currentLOD!==o&&(g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,(c=e.texture._hardwareTexture)==null?void 0:c.underlyingResource,o),p._currentLOD=o));const m=e._depthStencilTexture;if(m){const x=e._depthStencilTextureWithStencil?g.DEPTH_STENCIL_ATTACHMENT:g.DEPTH_ATTACHMENT;e.is2DArray?g.framebufferTextureLayer(g.FRAMEBUFFER,x,(u=m._hardwareTexture)==null?void 0:u.underlyingResource,o,a):e.isCube?g.framebufferTexture2D(g.FRAMEBUFFER,x,g.TEXTURE_CUBE_MAP_POSITIVE_X+t,(d=m._hardwareTexture)==null?void 0:d.underlyingResource,o):g.framebufferTexture2D(g.FRAMEBUFFER,x,g.TEXTURE_2D,(f=m._hardwareTexture)==null?void 0:f.underlyingResource,o)}this._cachedViewport&&!s?this.setViewport(this._cachedViewport,i,r):(i||(i=e.width,o&&(i=i/Math.pow(2,o))),r||(r=e.height,o&&(r=r/Math.pow(2,o))),this._viewport(0,0,i,r)),this.wipeCaches()}setState(e,t=0,i,r=!1,s,o,a=0){(this._depthCullingState.cull!==e||i)&&(this._depthCullingState.cull=e);const l=this.cullBackFaces??s??!0?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==l||i)&&(this._depthCullingState.cullFace=l),this.setZOffset(t),this.setZOffsetUnits(a);const h=r?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==h||i)&&(this._depthCullingState.frontFace=h),this._stencilStateComposer.stencilMaterial=o}getDepthBuffer(){return this._depthCullingState.depthTest}setDepthBuffer(e){this._depthCullingState.depthTest=e}setZOffset(e){this._depthCullingState.zOffset=this.useReverseDepthBuffer?-e:e}getZOffset(){const e=this._depthCullingState.zOffset;return this.useReverseDepthBuffer?-e:e}setZOffsetUnits(e){this._depthCullingState.zOffsetUnits=this.useReverseDepthBuffer?-e:e}getZOffsetUnits(){const e=this._depthCullingState.zOffsetUnits;return this.useReverseDepthBuffer?-e:e}_bindUnboundFramebuffer(e){this._currentFramebuffer!==e&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,e),this._currentFramebuffer=e)}_currentFrameBufferIsDefaultFrameBuffer(){return this._currentFramebuffer===null}generateMipmaps(e){this._bindTextureDirectly(this._gl.TEXTURE_2D,e,!0),this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)}unBindFramebuffer(e,t=!1,i){var r;const s=e;this._currentRenderTarget=null;const o=this._gl;if(s._MSAAFramebuffer){if(e.isMulti){this.unBindMultiColorAttachmentFramebuffer(e,t,i);return}o.bindFramebuffer(o.READ_FRAMEBUFFER,s._MSAAFramebuffer),o.bindFramebuffer(o.DRAW_FRAMEBUFFER,s._framebuffer),o.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,o.COLOR_BUFFER_BIT,o.NEAREST)}(r=e.texture)!=null&&r.generateMipMaps&&!t&&!e.isCube&&this.generateMipmaps(e.texture),i&&(s._MSAAFramebuffer&&this._bindUnboundFramebuffer(s._framebuffer),i()),this._bindUnboundFramebuffer(null)}flushFramebuffer(){this._gl.flush()}restoreDefaultFramebuffer(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()}_resetVertexBufferBinding(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null}createVertexBuffer(e,t,i){return this._createVertexBuffer(e,this._gl.STATIC_DRAW)}_createVertexBuffer(e,t){const i=this._gl.createBuffer();if(!i)throw new Error("Unable to create vertex buffer");const r=new Ta(i);return this.bindArrayBuffer(r),typeof e!="number"?e instanceof Array?(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(e),t),r.capacity=e.length*4):(this._gl.bufferData(this._gl.ARRAY_BUFFER,e,t),r.capacity=e.byteLength):(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Uint8Array(e),t),r.capacity=e),this._resetVertexBufferBinding(),r.references=1,r}createDynamicVertexBuffer(e,t){return this._createVertexBuffer(e,this._gl.DYNAMIC_DRAW)}_resetIndexBufferBinding(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null}createIndexBuffer(e,t,i){const r=this._gl.createBuffer(),s=new Ta(r);if(!r)throw new Error("Unable to create index buffer");this.bindIndexBuffer(s);const o=this._normalizeIndexData(e);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,o,t?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),s.references=1,s.is32Bits=o.BYTES_PER_ELEMENT===4,s}_normalizeIndexData(e){if(e.BYTES_PER_ELEMENT===2)return e;if(this._caps.uintIndices){if(e instanceof Uint32Array)return e;for(let t=0;t<e.length;t++)if(e[t]>=65535)return new Uint32Array(e);return new Uint16Array(e)}return new Uint16Array(e)}bindArrayBuffer(e){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(e,this._gl.ARRAY_BUFFER)}bindUniformBlock(e,t,i){const r=e.program,s=this._gl.getUniformBlockIndex(r,t);this._gl.uniformBlockBinding(r,s,i)}bindIndexBuffer(e){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(e,this._gl.ELEMENT_ARRAY_BUFFER)}_bindBuffer(e,t){(this._vaoRecordInProgress||this._currentBoundBuffer[t]!==e)&&(this._gl.bindBuffer(t,e?e.underlyingResource:null),this._currentBoundBuffer[t]=e)}updateArrayBuffer(e){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,e)}_vertexAttribPointer(e,t,i,r,s,o,a){const l=this._currentBufferPointers[t];if(!l)return;let h=!1;l.active?(l.buffer!==e&&(l.buffer=e,h=!0),l.size!==i&&(l.size=i,h=!0),l.type!==r&&(l.type=r,h=!0),l.normalized!==s&&(l.normalized=s,h=!0),l.stride!==o&&(l.stride=o,h=!0),l.offset!==a&&(l.offset=a,h=!0)):(h=!0,l.active=!0,l.index=t,l.size=i,l.type=r,l.normalized=s,l.stride=o,l.offset=a,l.buffer=e),(h||this._vaoRecordInProgress)&&(this.bindArrayBuffer(e),r===this._gl.UNSIGNED_INT||r===this._gl.INT?this._gl.vertexAttribIPointer(t,i,r,o,a):this._gl.vertexAttribPointer(t,i,r,s,o,a))}_bindIndexBufferWithCache(e){e!=null&&this._cachedIndexBuffer!==e&&(this._cachedIndexBuffer=e,this.bindIndexBuffer(e),this._uintIndicesCurrentlySet=e.is32Bits)}_bindVertexBuffersAttributes(e,t,i){const r=t.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(let s=0;s<r.length;s++){const o=t.getAttributeLocation(s);if(o>=0){const a=r[s];let l=null;if(i&&(l=i[a]),l||(l=e[a]),!l)continue;this._gl.enableVertexAttribArray(o),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[o]=!0);const h=l.getBuffer();h&&(this._vertexAttribPointer(h,o,l.getSize(),l.type,l.normalized,l.byteStride,l.byteOffset),l.getIsInstanced()&&(this._gl.vertexAttribDivisor(o,l.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(o),this._currentInstanceBuffers.push(h))))}}}recordVertexArrayObject(e,t,i,r){const s=this._gl.createVertexArray();if(!s)throw new Error("Unable to create VAO");return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(s),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(e,i,r),this.bindIndexBuffer(t),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),s}bindVertexArrayObject(e,t){this._cachedVertexArrayObject!==e&&(this._cachedVertexArrayObject=e,this._gl.bindVertexArray(e),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=t!=null&&t.is32Bits,this._mustWipeVertexAttributes=!0)}bindBuffersDirectly(e,t,i,r,s){if(this._cachedVertexBuffers!==e||this._cachedEffectForVertexBuffers!==s){this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=s;const o=s.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();let a=0;for(let l=0;l<o;l++)if(l<i.length){const h=s.getAttributeLocation(l);h>=0&&(this._gl.enableVertexAttribArray(h),this._vertexAttribArraysEnabled[h]=!0,this._vertexAttribPointer(e,h,i[l],this._gl.FLOAT,!1,r,a)),a+=i[l]*4}}this._bindIndexBufferWithCache(t)}_unbindVertexArrayObject(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))}bindBuffers(e,t,i,r){(this._cachedVertexBuffers!==e||this._cachedEffectForVertexBuffers!==i)&&(this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=i,this._bindVertexBuffersAttributes(e,i,r)),this._bindIndexBufferWithCache(t)}unbindInstanceAttributes(){let e;for(let t=0,i=this._currentInstanceLocations.length;t<i;t++){const r=this._currentInstanceBuffers[t];e!=r&&r.references&&(e=r,this.bindArrayBuffer(r));const s=this._currentInstanceLocations[t];this._gl.vertexAttribDivisor(s,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0}releaseVertexArrayObject(e){this._gl.deleteVertexArray(e)}_releaseBuffer(e){return e.references--,e.references===0?(this._deleteBuffer(e),!0):!1}_deleteBuffer(e){this._gl.deleteBuffer(e.underlyingResource)}updateAndBindInstancesBuffer(e,t,i){if(this.bindArrayBuffer(e),t&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t),i[0].index!==void 0)this.bindInstancesBuffer(e,i,!0);else for(let r=0;r<4;r++){const s=i[r];this._vertexAttribArraysEnabled[s]||(this._gl.enableVertexAttribArray(s),this._vertexAttribArraysEnabled[s]=!0),this._vertexAttribPointer(e,s,4,this._gl.FLOAT,!1,64,r*16),this._gl.vertexAttribDivisor(s,1),this._currentInstanceLocations.push(s),this._currentInstanceBuffers.push(e)}}bindInstancesBuffer(e,t,i=!0){this.bindArrayBuffer(e);let r=0;if(i)for(let s=0;s<t.length;s++){const o=t[s];r+=o.attributeSize*4}for(let s=0;s<t.length;s++){const o=t[s];o.index===void 0&&(o.index=this._currentEffect.getAttributeLocationByName(o.attributeName)),!(o.index<0)&&(this._vertexAttribArraysEnabled[o.index]||(this._gl.enableVertexAttribArray(o.index),this._vertexAttribArraysEnabled[o.index]=!0),this._vertexAttribPointer(e,o.index,o.attributeSize,o.attributeType||this._gl.FLOAT,o.normalized||!1,r,o.offset),this._gl.vertexAttribDivisor(o.index,o.divisor===void 0?1:o.divisor),this._currentInstanceLocations.push(o.index),this._currentInstanceBuffers.push(e))}}disableInstanceAttributeByName(e){if(!this._currentEffect)return;const t=this._currentEffect.getAttributeLocationByName(e);this.disableInstanceAttribute(t)}disableInstanceAttribute(e){let t=!1,i;for(;(i=this._currentInstanceLocations.indexOf(e))!==-1;)this._currentInstanceLocations.splice(i,1),this._currentInstanceBuffers.splice(i,1),t=!0,i=this._currentInstanceLocations.indexOf(e);t&&(this._gl.vertexAttribDivisor(e,0),this.disableAttributeByIndex(e))}disableAttributeByIndex(e){this._gl.disableVertexAttribArray(e),this._vertexAttribArraysEnabled[e]=!1,this._currentBufferPointers[e].active=!1}draw(e,t,i,r){this.drawElementsType(e?0:1,t,i,r)}drawPointClouds(e,t,i){this.drawArraysType(2,e,t,i)}drawUnIndexed(e,t,i,r){this.drawArraysType(e?0:1,t,i,r)}drawElementsType(e,t,i,r){this.applyStates(),this._reportDrawCall();const s=this._drawMode(e),o=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,a=this._uintIndicesCurrentlySet?4:2;r?this._gl.drawElementsInstanced(s,i,o,t*a,r):this._gl.drawElements(s,i,o,t*a)}drawArraysType(e,t,i,r){this.applyStates(),this._reportDrawCall();const s=this._drawMode(e);r?this._gl.drawArraysInstanced(s,t,i,r):this._gl.drawArrays(s,t,i)}_drawMode(e){switch(e){case 0:return this._gl.TRIANGLES;case 2:return this._gl.POINTS;case 1:return this._gl.LINES;case 3:return this._gl.POINTS;case 4:return this._gl.LINES;case 5:return this._gl.LINE_LOOP;case 6:return this._gl.LINE_STRIP;case 7:return this._gl.TRIANGLE_STRIP;case 8:return this._gl.TRIANGLE_FAN;default:return this._gl.TRIANGLES}}_reportDrawCall(){}_releaseEffect(e){this._compiledEffects[e._key]&&delete this._compiledEffects[e._key];const t=e.getPipelineContext();t&&this._deletePipelineContext(t)}_deletePipelineContext(e){const t=e;t&&t.program&&(t.program.__SPECTOR_rebuildProgram=null,this._gl.deleteProgram(t.program))}_getGlobalDefines(e){if(e){this.isNDCHalfZRange?e.IS_NDC_HALF_ZRANGE="":delete e.IS_NDC_HALF_ZRANGE,this.useReverseDepthBuffer?e.USE_REVERSE_DEPTHBUFFER="":delete e.USE_REVERSE_DEPTHBUFFER,this.useExactSrgbConversions?e.USE_EXACT_SRGB_CONVERSIONS="":delete e.USE_EXACT_SRGB_CONVERSIONS;return}else{let t="";return this.isNDCHalfZRange&&(t+="#define IS_NDC_HALF_ZRANGE"),this.useReverseDepthBuffer&&(t&&(t+=`
`),t+="#define USE_REVERSE_DEPTHBUFFER"),this.useExactSrgbConversions&&(t&&(t+=`
`),t+="#define USE_EXACT_SRGB_CONVERSIONS"),t}}createEffect(e,t,i,r,s,o,a,l,h,c=Ti.GLSL){const u=typeof e=="string"?e:e.vertexToken||e.vertexSource||e.vertexElement||e.vertex,d=typeof e=="string"?e:e.fragmentToken||e.fragmentSource||e.fragmentElement||e.fragment,f=this._getGlobalDefines();let p=s??t.defines??"";f&&(p+=f);const g=u+"+"+d+"@"+p;if(this._compiledEffects[g]){const x=this._compiledEffects[g];return a&&x.isReady()&&a(x),x}const m=new Zi(e,t,i,r,this,s,o,a,l,h,g,c);return this._compiledEffects[g]=m,m}static _ConcatenateShader(e,t,i=""){return i+(t?t+`
`:"")+e}_compileShader(e,t,i,r){return this._compileRawShader(Oe._ConcatenateShader(e,i,r),t)}_compileRawShader(e,t){const i=this._gl,r=i.createShader(t==="vertex"?i.VERTEX_SHADER:i.FRAGMENT_SHADER);if(!r){let s=i.NO_ERROR,o=i.NO_ERROR;for(;(o=i.getError())!==i.NO_ERROR;)s=o;throw new Error(`Something went wrong while creating a gl ${t} shader object. gl error=${s}, gl isContextLost=${i.isContextLost()}, _contextWasLost=${this._contextWasLost}`)}return i.shaderSource(r,e),i.compileShader(r),r}_getShaderSource(e){return this._gl.getShaderSource(e)}createRawShaderProgram(e,t,i,r,s=null){r=r||this._gl;const o=this._compileRawShader(t,"vertex"),a=this._compileRawShader(i,"fragment");return this._createShaderProgram(e,o,a,r,s)}createShaderProgram(e,t,i,r,s,o=null){s=s||this._gl;const a=this._webGLVersion>1?`#version 300 es
#define WEBGL2 
`:"",l=this._compileShader(t,"vertex",r,a),h=this._compileShader(i,"fragment",r,a);return this._createShaderProgram(e,l,h,s,o)}inlineShaderCode(e){return e}createPipelineContext(e){const t=new cy;return t.engine=this,this._caps.parallelShaderCompile&&(t.isParallelCompiled=!0),t}createMaterialContext(){}createDrawContext(){}_createShaderProgram(e,t,i,r,s=null){const o=r.createProgram();if(e.program=o,!o)throw new Error("Unable to create program");return r.attachShader(o,t),r.attachShader(o,i),r.linkProgram(o),e.context=r,e.vertexShader=t,e.fragmentShader=i,e.isParallelCompiled||this._finalizePipelineContext(e),o}_finalizePipelineContext(e){const t=e.context,i=e.vertexShader,r=e.fragmentShader,s=e.program;if(!t.getProgramParameter(s,t.LINK_STATUS)){if(!this._gl.getShaderParameter(i,this._gl.COMPILE_STATUS)){const a=this._gl.getShaderInfoLog(i);if(a)throw e.vertexCompilationError=a,new Error("VERTEX SHADER "+a)}if(!this._gl.getShaderParameter(r,this._gl.COMPILE_STATUS)){const a=this._gl.getShaderInfoLog(r);if(a)throw e.fragmentCompilationError=a,new Error("FRAGMENT SHADER "+a)}const o=t.getProgramInfoLog(s);if(o)throw e.programLinkError=o,new Error(o)}if(this.validateShaderPrograms&&(t.validateProgram(s),!t.getProgramParameter(s,t.VALIDATE_STATUS))){const o=t.getProgramInfoLog(s);if(o)throw e.programValidationError=o,new Error(o)}t.deleteShader(i),t.deleteShader(r),e.vertexShader=void 0,e.fragmentShader=void 0,e.onCompiled&&(e.onCompiled(),e.onCompiled=void 0)}_preparePipelineContext(e,t,i,r,s,o,a,l,h,c){const u=e;r?u.program=this.createRawShaderProgram(u,t,i,void 0,h):u.program=this.createShaderProgram(u,t,i,l,void 0,h),u.program.__SPECTOR_rebuildProgram=a}_isRenderingStateCompiled(e){const t=e;return this._isDisposed||t._isDisposed?!1:this._gl.getProgramParameter(t.program,this._caps.parallelShaderCompile.COMPLETION_STATUS_KHR)?(this._finalizePipelineContext(t),!0):!1}_executeWhenRenderingStateIsCompiled(e,t){const i=e;if(!i.isParallelCompiled){t();return}const r=i.onCompiled;r?i.onCompiled=()=>{r(),t()}:i.onCompiled=t}getUniforms(e,t){const i=new Array,r=e;for(let s=0;s<t.length;s++)i.push(this._gl.getUniformLocation(r.program,t[s]));return i}getAttributes(e,t){const i=[],r=e;for(let s=0;s<t.length;s++)try{i.push(this._gl.getAttribLocation(r.program,t[s]))}catch{i.push(-1)}return i}enableEffect(e){e=e!==null&&Ko.IsWrapper(e)?e.effect:e,!(!e||e===this._currentEffect)&&(this._stencilStateComposer.stencilMaterial=void 0,e=e,this.bindSamplers(e),this._currentEffect=e,e.onBind&&e.onBind(e),e._onBindObservable&&e._onBindObservable.notifyObservers(e))}setInt(e,t){return e?(this._gl.uniform1i(e,t),!0):!1}setInt2(e,t,i){return e?(this._gl.uniform2i(e,t,i),!0):!1}setInt3(e,t,i,r){return e?(this._gl.uniform3i(e,t,i,r),!0):!1}setInt4(e,t,i,r,s){return e?(this._gl.uniform4i(e,t,i,r,s),!0):!1}setIntArray(e,t){return e?(this._gl.uniform1iv(e,t),!0):!1}setIntArray2(e,t){return!e||t.length%2!==0?!1:(this._gl.uniform2iv(e,t),!0)}setIntArray3(e,t){return!e||t.length%3!==0?!1:(this._gl.uniform3iv(e,t),!0)}setIntArray4(e,t){return!e||t.length%4!==0?!1:(this._gl.uniform4iv(e,t),!0)}setUInt(e,t){return e?(this._gl.uniform1ui(e,t),!0):!1}setUInt2(e,t,i){return e?(this._gl.uniform2ui(e,t,i),!0):!1}setUInt3(e,t,i,r){return e?(this._gl.uniform3ui(e,t,i,r),!0):!1}setUInt4(e,t,i,r,s){return e?(this._gl.uniform4ui(e,t,i,r,s),!0):!1}setUIntArray(e,t){return e?(this._gl.uniform1uiv(e,t),!0):!1}setUIntArray2(e,t){return!e||t.length%2!==0?!1:(this._gl.uniform2uiv(e,t),!0)}setUIntArray3(e,t){return!e||t.length%3!==0?!1:(this._gl.uniform3uiv(e,t),!0)}setUIntArray4(e,t){return!e||t.length%4!==0?!1:(this._gl.uniform4uiv(e,t),!0)}setArray(e,t){return!e||t.length<1?!1:(this._gl.uniform1fv(e,t),!0)}setArray2(e,t){return!e||t.length%2!==0?!1:(this._gl.uniform2fv(e,t),!0)}setArray3(e,t){return!e||t.length%3!==0?!1:(this._gl.uniform3fv(e,t),!0)}setArray4(e,t){return!e||t.length%4!==0?!1:(this._gl.uniform4fv(e,t),!0)}setMatrices(e,t){return e?(this._gl.uniformMatrix4fv(e,!1,t),!0):!1}setMatrix3x3(e,t){return e?(this._gl.uniformMatrix3fv(e,!1,t),!0):!1}setMatrix2x2(e,t){return e?(this._gl.uniformMatrix2fv(e,!1,t),!0):!1}setFloat(e,t){return e?(this._gl.uniform1f(e,t),!0):!1}setFloat2(e,t,i){return e?(this._gl.uniform2f(e,t,i),!0):!1}setFloat3(e,t,i,r){return e?(this._gl.uniform3f(e,t,i,r),!0):!1}setFloat4(e,t,i,r,s){return e?(this._gl.uniform4f(e,t,i,r,s),!0):!1}applyStates(){if(this._depthCullingState.apply(this._gl),this._stencilStateComposer.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged){this._colorWriteChanged=!1;const e=this._colorWrite;this._gl.colorMask(e,e,e,e)}}setColorWrite(e){e!==this._colorWrite&&(this._colorWriteChanged=!0,this._colorWrite=e)}getColorWrite(){return this._colorWrite}get depthCullingState(){return this._depthCullingState}get alphaState(){return this._alphaState}get stencilState(){return this._stencilState}get stencilStateComposer(){return this._stencilStateComposer}clearInternalTexturesCache(){this._internalTexturesCache.length=0}wipeCaches(e){this.preventCacheWipeBetweenFrames&&!e||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),e&&(this._currentProgram=null,this.resetTextureCache(),this._stencilStateComposer.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=1,this._alphaEquation=0,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))}_getSamplingParameters(e,t){const i=this._gl;let r=i.NEAREST,s=i.NEAREST;switch(e){case 11:r=i.LINEAR,t?s=i.LINEAR_MIPMAP_NEAREST:s=i.LINEAR;break;case 3:r=i.LINEAR,t?s=i.LINEAR_MIPMAP_LINEAR:s=i.LINEAR;break;case 8:r=i.NEAREST,t?s=i.NEAREST_MIPMAP_LINEAR:s=i.NEAREST;break;case 4:r=i.NEAREST,t?s=i.NEAREST_MIPMAP_NEAREST:s=i.NEAREST;break;case 5:r=i.NEAREST,t?s=i.LINEAR_MIPMAP_NEAREST:s=i.LINEAR;break;case 6:r=i.NEAREST,t?s=i.LINEAR_MIPMAP_LINEAR:s=i.LINEAR;break;case 7:r=i.NEAREST,s=i.LINEAR;break;case 1:r=i.NEAREST,s=i.NEAREST;break;case 9:r=i.LINEAR,t?s=i.NEAREST_MIPMAP_NEAREST:s=i.NEAREST;break;case 10:r=i.LINEAR,t?s=i.NEAREST_MIPMAP_LINEAR:s=i.NEAREST;break;case 2:r=i.LINEAR,s=i.LINEAR;break;case 12:r=i.LINEAR,s=i.NEAREST;break}return{min:s,mag:r}}_createTexture(){const e=this._gl.createTexture();if(!e)throw new Error("Unable to create texture");return e}_createHardwareTexture(){return new Q_(this._createTexture(),this._gl)}_createInternalTexture(e,t,i=!0,r=Dt.Unknown){let s=!1,o=0,a=3,l=5,h=!1,c=1,u;t!==void 0&&typeof t=="object"?(s=!!t.generateMipMaps,o=t.type===void 0?0:t.type,a=t.samplingMode===void 0?3:t.samplingMode,l=t.format===void 0?5:t.format,h=t.useSRGBBuffer===void 0?!1:t.useSRGBBuffer,c=t.samples??1,u=t.label):s=!!t,h&&(h=this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU)),(o===1&&!this._caps.textureFloatLinearFiltering||o===2&&!this._caps.textureHalfFloatLinearFiltering)&&(a=1),o===1&&!this._caps.textureFloat&&(o=0,oe.Warn("Float textures are not supported. Type forced to TEXTURETYPE_UNSIGNED_BYTE"));const d=this._gl,f=new ur(this,r),p=e.width||e,g=e.height||e,m=e.layers||0,x=this._getSamplingParameters(a,s),E=m!==0?d.TEXTURE_2D_ARRAY:d.TEXTURE_2D,R=this._getRGBABufferInternalSizedFormat(o,l,h),C=this._getInternalFormat(l),_=this._getWebGLTextureType(o);return this._bindTextureDirectly(E,f),m!==0?(f.is2DArray=!0,d.texImage3D(E,0,R,p,g,m,0,C,_,null)):d.texImage2D(E,0,R,p,g,0,C,_,null),d.texParameteri(E,d.TEXTURE_MAG_FILTER,x.mag),d.texParameteri(E,d.TEXTURE_MIN_FILTER,x.min),d.texParameteri(E,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(E,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),s&&this._gl.generateMipmap(E),this._bindTextureDirectly(E,null),f._useSRGBBuffer=h,f.baseWidth=p,f.baseHeight=g,f.width=p,f.height=g,f.depth=m,f.isReady=!0,f.samples=c,f.generateMipMaps=s,f.samplingMode=a,f.type=o,f.format=l,f.label=u,this._internalTexturesCache.push(f),f}_getUseSRGBBuffer(e,t){return e&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU||t)}_createTextureBase(e,t,i,r,s=3,o=null,a=null,l,h,c=null,u=null,d=null,f=null,p,g,m){e=e||"";const x=e.substr(0,5)==="data:",E=e.substr(0,5)==="blob:",R=x&&e.indexOf(";base64,")!==-1,C=u||new ur(this,Dt.Url);C!==u&&(C.label=e.substring(0,60));const _=e;this._transformTextureUrl&&!R&&!u&&!c&&(e=this._transformTextureUrl(e)),_!==e&&(C._originalUrl=_);const T=e.lastIndexOf(".");let y=f||(T>-1?e.substring(T).toLowerCase():""),P=null;y.indexOf("?")>-1&&(y=y.split("?")[0]);for(const N of Oe._TextureLoaders)if(N.canLoad(y,p)){P=N;break}r&&r.addPendingData(C),C.url=e,C.generateMipMaps=!t,C.samplingMode=s,C.invertY=i,C._useSRGBBuffer=this._getUseSRGBBuffer(!!m,t),this._doNotHandleContextLost||(C._buffer=c);let D=null;o&&!u&&(D=C.onLoadedObservable.add(o)),u||this._internalTexturesCache.push(C);const F=(N,G)=>{r&&r.removePendingData(C),e===_?(D&&C.onLoadedObservable.remove(D),rt.UseFallbackTexture&&e!==rt.FallbackTexture&&this._createTextureBase(rt.FallbackTexture,t,C.invertY,r,s,null,a,l,h,c,C),N=(N||"Unknown error")+(rt.UseFallbackTexture?" - Fallback texture was used":""),C.onErrorObservable.notifyObservers({message:N,exception:G}),a&&a(N,G)):(oe.Warn(`Failed to load ${e}, falling back to ${_}`),this._createTextureBase(_,t,C.invertY,r,s,o,a,l,h,c,C,d,f,p,g,m))};if(P){const N=G=>{P.loadData(G,C,(J,j,z,$,te,fe)=>{fe?F("TextureLoader failed to load data"):l(C,y,r,{width:J,height:j},C.invertY,!z,$,()=>(te(),!1),s)},g)};c?c instanceof ArrayBuffer?N(new Uint8Array(c)):ArrayBuffer.isView(c)?N(c):a&&a("Unable to load: only ArrayBuffer or ArrayBufferView is supported",null):this._loadFile(e,G=>N(new Uint8Array(G)),void 0,r?r.offlineProvider:void 0,!0,(G,J)=>{F("Unable to load "+(G&&G.responseURL,J))})}else{const N=G=>{E&&!this._doNotHandleContextLost&&(C._buffer=G),l(C,y,r,G,C.invertY,t,!1,h,s)};!x||R?c&&(typeof c.decoding=="string"||c.close)?N(c):Oe._FileToolsLoadImage(e,N,F,r?r.offlineProvider:null,p,C.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):typeof c=="string"||c instanceof ArrayBuffer||ArrayBuffer.isView(c)||c instanceof Blob?Oe._FileToolsLoadImage(c,N,F,r?r.offlineProvider:null,p,C.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):c&&N(c)}return C}createTexture(e,t,i,r,s=3,o=null,a=null,l=null,h=null,c=null,u=null,d,f,p,g){return this._createTextureBase(e,t,i,r,s,o,a,this._prepareWebGLTexture.bind(this),(m,x,E,R,C,_)=>{const T=this._gl,y=E.width===m&&E.height===x;C._creationFlags=p??0;const P=this._getTexImageParametersForCreateTexture(c,R,C._useSRGBBuffer);if(y)return T.texImage2D(T.TEXTURE_2D,0,P.internalFormat,P.format,P.type,E),!1;const D=this._caps.maxTextureSize;if(E.width>D||E.height>D||!this._supportsHardwareTextureRescaling)return this._prepareWorkingCanvas(),!this._workingCanvas||!this._workingContext||(this._workingCanvas.width=m,this._workingCanvas.height=x,this._workingContext.drawImage(E,0,0,E.width,E.height,0,0,m,x),T.texImage2D(T.TEXTURE_2D,0,P.internalFormat,P.format,P.type,this._workingCanvas),C.width=m,C.height=x),!1;{const F=new ur(this,Dt.Temp);this._bindTextureDirectly(T.TEXTURE_2D,F,!0),T.texImage2D(T.TEXTURE_2D,0,P.internalFormat,P.format,P.type,E),this._rescaleTexture(F,C,r,P.format,()=>{this._releaseTexture(F),this._bindTextureDirectly(T.TEXTURE_2D,C,!0),_()})}return!0},l,h,c,u,d,f,g)}_getTexImageParametersForCreateTexture(e,t,i){e==null&&(e=t===".jpg"&&!i?4:5);let r,s;return this.webGLVersion===1?(r=this._getInternalFormat(e,i),s=r):(r=this._getInternalFormat(e,!1),s=this._getRGBABufferInternalSizedFormat(0,e,i)),{internalFormat:s,format:r,type:this._gl.UNSIGNED_BYTE}}static _FileToolsLoadImage(e,t,i,r,s,o){throw Ge("FileTools")}_rescaleTexture(e,t,i,r,s){}createRawTexture(e,t,i,r,s,o,a,l=null,h=0,c=0,u=!1){throw Ge("Engine.RawTexture")}createRawCubeTexture(e,t,i,r,s,o,a,l=null){throw Ge("Engine.RawTexture")}createRawTexture3D(e,t,i,r,s,o,a,l,h=null,c=0){throw Ge("Engine.RawTexture")}createRawTexture2DArray(e,t,i,r,s,o,a,l,h=null,c=0){throw Ge("Engine.RawTexture")}_unpackFlipY(e){this._unpackFlipYCached!==e&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,e?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=e))}_getUnpackAlignement(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)}_getTextureTarget(e){return e.isCube?this._gl.TEXTURE_CUBE_MAP:e.is3D?this._gl.TEXTURE_3D:e.is2DArray||e.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D}updateTextureSamplingMode(e,t,i=!1){const r=this._getTextureTarget(t),s=this._getSamplingParameters(e,t.useMipMaps||i);this._setTextureParameterInteger(r,this._gl.TEXTURE_MAG_FILTER,s.mag,t),this._setTextureParameterInteger(r,this._gl.TEXTURE_MIN_FILTER,s.min),i&&(t.generateMipMaps=!0,this._gl.generateMipmap(r)),this._bindTextureDirectly(r,null),t.samplingMode=e}updateTextureDimensions(e,t,i,r=1){}updateTextureWrappingMode(e,t,i=null,r=null){const s=this._getTextureTarget(e);t!==null&&(this._setTextureParameterInteger(s,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(t),e),e._cachedWrapU=t),i!==null&&(this._setTextureParameterInteger(s,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(i),e),e._cachedWrapV=i),(e.is2DArray||e.is3D)&&r!==null&&(this._setTextureParameterInteger(s,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(r),e),e._cachedWrapR=r),this._bindTextureDirectly(s,null)}_setupDepthStencilTexture(e,t,i,r,s,o=1){const a=t.width||t,l=t.height||t,h=t.layers||0;e.baseWidth=a,e.baseHeight=l,e.width=a,e.height=l,e.is2DArray=h>0,e.depth=h,e.isReady=!0,e.samples=o,e.generateMipMaps=!1,e.samplingMode=r?2:1,e.type=0,e._comparisonFunction=s;const c=this._gl,u=this._getTextureTarget(e),d=this._getSamplingParameters(e.samplingMode,!1);c.texParameteri(u,c.TEXTURE_MAG_FILTER,d.mag),c.texParameteri(u,c.TEXTURE_MIN_FILTER,d.min),c.texParameteri(u,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(u,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),this.webGLVersion>1&&(s===0?(c.texParameteri(u,c.TEXTURE_COMPARE_FUNC,515),c.texParameteri(u,c.TEXTURE_COMPARE_MODE,c.NONE)):(c.texParameteri(u,c.TEXTURE_COMPARE_FUNC,s),c.texParameteri(u,c.TEXTURE_COMPARE_MODE,c.COMPARE_REF_TO_TEXTURE)))}_uploadCompressedDataToTextureDirectly(e,t,i,r,s,o=0,a=0){const l=this._gl;let h=l.TEXTURE_2D;if(e.isCube&&(h=l.TEXTURE_CUBE_MAP_POSITIVE_X+o),e._useSRGBBuffer)switch(t){case 37492:case 36196:this._caps.etc2?t=l.COMPRESSED_SRGB8_ETC2:e._useSRGBBuffer=!1;break;case 37496:this._caps.etc2?t=l.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:e._useSRGBBuffer=!1;break;case 36492:t=l.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT;break;case 37808:t=l.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;break;case 33776:this._caps.s3tc_srgb?t=l.COMPRESSED_SRGB_S3TC_DXT1_EXT:e._useSRGBBuffer=!1;break;case 33777:this._caps.s3tc_srgb?t=l.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:e._useSRGBBuffer=!1;break;case 33779:this._caps.s3tc_srgb?t=l.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:e._useSRGBBuffer=!1;break;default:e._useSRGBBuffer=!1;break}this._gl.compressedTexImage2D(h,a,t,i,r,0,s)}_uploadDataToTextureDirectly(e,t,i=0,r=0,s,o=!1){const a=this._gl,l=this._getWebGLTextureType(e.type),h=this._getInternalFormat(e.format),c=s===void 0?this._getRGBABufferInternalSizedFormat(e.type,e.format,e._useSRGBBuffer):this._getInternalFormat(s,e._useSRGBBuffer);this._unpackFlipY(e.invertY);let u=a.TEXTURE_2D;e.isCube&&(u=a.TEXTURE_CUBE_MAP_POSITIVE_X+i);const d=Math.round(Math.log(e.width)*Math.LOG2E),f=Math.round(Math.log(e.height)*Math.LOG2E),p=o?e.width:Math.pow(2,Math.max(d-r,0)),g=o?e.height:Math.pow(2,Math.max(f-r,0));a.texImage2D(u,r,c,p,g,0,h,l,t)}updateTextureData(e,t,i,r,s,o,a=0,l=0,h=!1){const c=this._gl,u=this._getWebGLTextureType(e.type),d=this._getInternalFormat(e.format);this._unpackFlipY(e.invertY);let f=c.TEXTURE_2D,p=c.TEXTURE_2D;e.isCube&&(p=c.TEXTURE_CUBE_MAP_POSITIVE_X+a,f=c.TEXTURE_CUBE_MAP),this._bindTextureDirectly(f,e,!0),c.texSubImage2D(p,l,i,r,s,o,d,u,t),h&&this._gl.generateMipmap(p),this._bindTextureDirectly(f,null)}_uploadArrayBufferViewToTexture(e,t,i=0,r=0){const s=this._gl,o=e.isCube?s.TEXTURE_CUBE_MAP:s.TEXTURE_2D;this._bindTextureDirectly(o,e,!0),this._uploadDataToTextureDirectly(e,t,i,r),this._bindTextureDirectly(o,null,!0)}_prepareWebGLTextureContinuation(e,t,i,r,s){const o=this._gl;if(!o)return;const a=this._getSamplingParameters(s,!i);o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,a.mag),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,a.min),!i&&!r&&o.generateMipmap(o.TEXTURE_2D),this._bindTextureDirectly(o.TEXTURE_2D,null),t&&t.removePendingData(e),e.onLoadedObservable.notifyObservers(e),e.onLoadedObservable.clear()}_prepareWebGLTexture(e,t,i,r,s,o,a,l,h=3){const c=this.getCaps().maxTextureSize,u=Math.min(c,this.needPOTTextures?Oe.GetExponentOfTwo(r.width,c):r.width),d=Math.min(c,this.needPOTTextures?Oe.GetExponentOfTwo(r.height,c):r.height),f=this._gl;if(f){if(!e._hardwareTexture){i&&i.removePendingData(e);return}this._bindTextureDirectly(f.TEXTURE_2D,e,!0),this._unpackFlipY(s===void 0?!0:!!s),e.baseWidth=r.width,e.baseHeight=r.height,e.width=u,e.height=d,e.isReady=!0,e.type=e.type!==-1?e.type:0,e.format=e.format!==-1?e.format:t===".jpg"&&!e._useSRGBBuffer?4:5,!l(u,d,r,t,e,()=>{this._prepareWebGLTextureContinuation(e,i,o,a,h)})&&this._prepareWebGLTextureContinuation(e,i,o,a,h)}}_setupFramebufferDepthAttachments(e,t,i,r,s=1){const o=this._gl;if(e&&t)return this._createRenderBuffer(i,r,s,o.DEPTH_STENCIL,o.DEPTH24_STENCIL8,o.DEPTH_STENCIL_ATTACHMENT);if(t){let a=o.DEPTH_COMPONENT16;return this._webGLVersion>1&&(a=o.DEPTH_COMPONENT32F),this._createRenderBuffer(i,r,s,a,a,o.DEPTH_ATTACHMENT)}return e?this._createRenderBuffer(i,r,s,o.STENCIL_INDEX8,o.STENCIL_INDEX8,o.STENCIL_ATTACHMENT):null}_createRenderBuffer(e,t,i,r,s,o,a=!0){const l=this._gl.createRenderbuffer();return this._updateRenderBuffer(l,e,t,i,r,s,o,a)}_updateRenderBuffer(e,t,i,r,s,o,a,l=!0){const h=this._gl;return h.bindRenderbuffer(h.RENDERBUFFER,e),r>1&&h.renderbufferStorageMultisample?h.renderbufferStorageMultisample(h.RENDERBUFFER,r,o,t,i):h.renderbufferStorage(h.RENDERBUFFER,s,t,i),h.framebufferRenderbuffer(h.FRAMEBUFFER,a,h.RENDERBUFFER,e),l&&h.bindRenderbuffer(h.RENDERBUFFER,null),e}_releaseTexture(e){var t;this._deleteTexture((t=e._hardwareTexture)==null?void 0:t.underlyingResource),this.unbindAllTextures();const i=this._internalTexturesCache.indexOf(e);i!==-1&&this._internalTexturesCache.splice(i,1),e._lodTextureHigh&&e._lodTextureHigh.dispose(),e._lodTextureMid&&e._lodTextureMid.dispose(),e._lodTextureLow&&e._lodTextureLow.dispose(),e._irradianceTexture&&e._irradianceTexture.dispose()}_releaseRenderTargetWrapper(e){const t=this._renderTargetWrapperCache.indexOf(e);t!==-1&&this._renderTargetWrapperCache.splice(t,1)}_deleteTexture(e){e&&this._gl.deleteTexture(e)}_setProgram(e){this._currentProgram!==e&&(this._gl.useProgram(e),this._currentProgram=e)}bindSamplers(e){const t=e.getPipelineContext();this._setProgram(t.program);const i=e.getSamplers();for(let r=0;r<i.length;r++){const s=e.getUniform(i[r]);s&&(this._boundUniforms[r]=s)}this._currentEffect=null}_activateCurrentTexture(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)}_bindTextureDirectly(e,t,i=!1,r=!1){var s;let o=!1;const a=t&&t._associatedChannel>-1;if(i&&a&&(this._activeChannel=t._associatedChannel),this._boundTexturesCache[this._activeChannel]!==t||r){if(this._activateCurrentTexture(),t&&t.isMultiview)throw oe.Error(["_bindTextureDirectly called with a multiview texture!",e,t]),"_bindTextureDirectly called with a multiview texture!";this._gl.bindTexture(e,((s=t==null?void 0:t._hardwareTexture)==null?void 0:s.underlyingResource)??null),this._boundTexturesCache[this._activeChannel]=t,t&&(t._associatedChannel=this._activeChannel)}else i&&(o=!0,this._activateCurrentTexture());return a&&!i&&this._bindSamplerUniformToChannel(t._associatedChannel,this._activeChannel),o}_bindTexture(e,t,i){if(e===void 0)return;t&&(t._associatedChannel=e),this._activeChannel=e;const r=t?this._getTextureTarget(t):this._gl.TEXTURE_2D;this._bindTextureDirectly(r,t)}unbindAllTextures(){for(let e=0;e<this._maxSimultaneousTextures;e++)this._activeChannel=e,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))}setTexture(e,t,i,r){e!==void 0&&(t&&(this._boundUniforms[e]=t),this._setTexture(e,i))}_bindSamplerUniformToChannel(e,t){const i=this._boundUniforms[e];!i||i._currentState===t||(this._gl.uniform1i(i,t),i._currentState=t)}_getTextureWrapMode(e){switch(e){case 1:return this._gl.REPEAT;case 0:return this._gl.CLAMP_TO_EDGE;case 2:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT}_setTexture(e,t,i=!1,r=!1,s=""){if(!t)return this._boundTexturesCache[e]!=null&&(this._activeChannel=e,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(t.video){this._activeChannel=e;const h=t.getInternalTexture();h&&(h._associatedChannel=e),t.update()}else if(t.delayLoadState===4)return t.delayLoad(),!1;let o;r?o=t.depthStencilTexture:t.isReady()?o=t.getInternalTexture():t.isCube?o=this.emptyCubeTexture:t.is3D?o=this.emptyTexture3D:t.is2DArray?o=this.emptyTexture2DArray:o=this.emptyTexture,!i&&o&&(o._associatedChannel=e);let a=!0;this._boundTexturesCache[e]===o&&(i||this._bindSamplerUniformToChannel(o._associatedChannel,e),a=!1),this._activeChannel=e;const l=this._getTextureTarget(o);if(a&&this._bindTextureDirectly(l,o,i),o&&!o.isMultiview){if(o.isCube&&o._cachedCoordinatesMode!==t.coordinatesMode){o._cachedCoordinatesMode=t.coordinatesMode;const h=t.coordinatesMode!==3&&t.coordinatesMode!==5?1:0;t.wrapU=h,t.wrapV=h}o._cachedWrapU!==t.wrapU&&(o._cachedWrapU=t.wrapU,this._setTextureParameterInteger(l,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(t.wrapU),o)),o._cachedWrapV!==t.wrapV&&(o._cachedWrapV=t.wrapV,this._setTextureParameterInteger(l,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(t.wrapV),o)),o.is3D&&o._cachedWrapR!==t.wrapR&&(o._cachedWrapR=t.wrapR,this._setTextureParameterInteger(l,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(t.wrapR),o)),this._setAnisotropicLevel(l,o,t.anisotropicFilteringLevel)}return!0}setTextureArray(e,t,i,r){if(!(e===void 0||!t)){(!this._textureUnits||this._textureUnits.length!==i.length)&&(this._textureUnits=new Int32Array(i.length));for(let s=0;s<i.length;s++){const o=i[s].getInternalTexture();o?(this._textureUnits[s]=e+s,o._associatedChannel=e+s):this._textureUnits[s]=-1}this._gl.uniform1iv(t,this._textureUnits);for(let s=0;s<i.length;s++)this._setTexture(this._textureUnits[s],i[s],!0)}}_setAnisotropicLevel(e,t,i){const r=this._caps.textureAnisotropicFilterExtension;t.samplingMode!==11&&t.samplingMode!==3&&t.samplingMode!==2&&(i=1),r&&t._cachedAnisotropicFilteringLevel!==i&&(this._setTextureParameterFloat(e,r.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(i,this._caps.maxAnisotropy),t),t._cachedAnisotropicFilteringLevel=i)}_setTextureParameterFloat(e,t,i,r){this._bindTextureDirectly(e,r,!0,!0),this._gl.texParameterf(e,t,i)}_setTextureParameterInteger(e,t,i,r){r&&this._bindTextureDirectly(e,r,!0,!0),this._gl.texParameteri(e,t,i)}unbindAllAttributes(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(let e=0;e<this._caps.maxVertexAttribs;e++)this.disableAttributeByIndex(e);return}for(let e=0,t=this._vertexAttribArraysEnabled.length;e<t;e++)e>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[e]||this.disableAttributeByIndex(e)}releaseEffects(){for(const e in this._compiledEffects){const t=this._compiledEffects[e].getPipelineContext();this._deletePipelineContext(t)}this._compiledEffects={}}dispose(){var e,t;this._isDisposed=!0,this.stopRenderLoop(),this.onBeforeTextureInitObservable&&this.onBeforeTextureInitObservable.clear(),this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.releaseEffects(),(e=this.releaseComputeEffects)==null||e.call(this),this.unbindAllAttributes(),this._boundUniforms={},Ai()&&this._renderingCanvas&&(this._doNotHandleContextLost||(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored)),window.removeEventListener("resize",this._checkForMobile)),this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers.length=0,this._renderingCanvas=null,this._currentProgram=null,this._boundRenderFunction=null,Zi.ResetCache();for(const i of this._activeRequests)i.abort();this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this._creationOptions.loseContextOnDispose&&((t=this._gl.getExtension("WEBGL_lose_context"))==null||t.loseContext())}attachContextLostEvent(e){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",e,!1)}attachContextRestoredEvent(e){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",e,!1)}getError(){return this._gl.getError()}_canRenderToFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(1)}_canRenderToHalfFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(2)}_canRenderToFramebuffer(e){const t=this._gl;for(;t.getError()!==t.NO_ERROR;);let i=!0;const r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(e),1,1,0,t.RGBA,this._getWebGLTextureType(e),null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST);const s=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,s),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0);const o=t.checkFramebufferStatus(t.FRAMEBUFFER);if(i=i&&o===t.FRAMEBUFFER_COMPLETE,i=i&&t.getError()===t.NO_ERROR,i&&(t.clear(t.COLOR_BUFFER_BIT),i=i&&t.getError()===t.NO_ERROR),i){t.bindFramebuffer(t.FRAMEBUFFER,null);const a=t.RGBA,l=t.UNSIGNED_BYTE,h=new Uint8Array(4);t.readPixels(0,0,1,1,a,l,h),i=i&&t.getError()===t.NO_ERROR}for(t.deleteTexture(r),t.deleteFramebuffer(s),t.bindFramebuffer(t.FRAMEBUFFER,null);!i&&t.getError()!==t.NO_ERROR;);return i}_getWebGLTextureType(e){if(this._webGLVersion===1){switch(e){case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT_OES;case 0:return this._gl.UNSIGNED_BYTE;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(e){case 3:return this._gl.BYTE;case 0:return this._gl.UNSIGNED_BYTE;case 4:return this._gl.SHORT;case 5:return this._gl.UNSIGNED_SHORT;case 6:return this._gl.INT;case 7:return this._gl.UNSIGNED_INT;case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5;case 11:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case 12:return this._gl.UNSIGNED_INT_24_8;case 13:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case 14:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case 15:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE}_getInternalFormat(e,t=!1){let i=t?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA;switch(e){case 0:i=this._gl.ALPHA;break;case 1:i=this._gl.LUMINANCE;break;case 2:i=this._gl.LUMINANCE_ALPHA;break;case 6:i=this._gl.RED;break;case 7:i=this._gl.RG;break;case 4:i=t?this._glSRGBExtensionValues.SRGB:this._gl.RGB;break;case 5:i=t?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA;break}if(this._webGLVersion>1)switch(e){case 8:i=this._gl.RED_INTEGER;break;case 9:i=this._gl.RG_INTEGER;break;case 10:i=this._gl.RGB_INTEGER;break;case 11:i=this._gl.RGBA_INTEGER;break}return i}_getRGBABufferInternalSizedFormat(e,t,i=!1){if(this._webGLVersion===1){if(t!==void 0)switch(t){case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;case 4:return i?this._glSRGBExtensionValues.SRGB:this._gl.RGB}return this._gl.RGBA}switch(e){case 3:switch(t){case 6:return this._gl.R8_SNORM;case 7:return this._gl.RG8_SNORM;case 4:return this._gl.RGB8_SNORM;case 8:return this._gl.R8I;case 9:return this._gl.RG8I;case 10:return this._gl.RGB8I;case 11:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case 0:switch(t){case 6:return this._gl.R8;case 7:return this._gl.RG8;case 4:return i?this._glSRGBExtensionValues.SRGB8:this._gl.RGB8;case 5:return i?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8;case 8:return this._gl.R8UI;case 9:return this._gl.RG8UI;case 10:return this._gl.RGB8UI;case 11:return this._gl.RGBA8UI;case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case 4:switch(t){case 8:return this._gl.R16I;case 9:return this._gl.RG16I;case 10:return this._gl.RGB16I;case 11:return this._gl.RGBA16I;default:return this._gl.RGBA16I}case 5:switch(t){case 8:return this._gl.R16UI;case 9:return this._gl.RG16UI;case 10:return this._gl.RGB16UI;case 11:return this._gl.RGBA16UI;default:return this._gl.RGBA16UI}case 6:switch(t){case 8:return this._gl.R32I;case 9:return this._gl.RG32I;case 10:return this._gl.RGB32I;case 11:return this._gl.RGBA32I;default:return this._gl.RGBA32I}case 7:switch(t){case 8:return this._gl.R32UI;case 9:return this._gl.RG32UI;case 10:return this._gl.RGB32UI;case 11:return this._gl.RGBA32UI;default:return this._gl.RGBA32UI}case 1:switch(t){case 6:return this._gl.R32F;case 7:return this._gl.RG32F;case 4:return this._gl.RGB32F;case 5:return this._gl.RGBA32F;default:return this._gl.RGBA32F}case 2:switch(t){case 6:return this._gl.R16F;case 7:return this._gl.RG16F;case 4:return this._gl.RGB16F;case 5:return this._gl.RGBA16F;default:return this._gl.RGBA16F}case 10:return this._gl.RGB565;case 13:return this._gl.R11F_G11F_B10F;case 14:return this._gl.RGB9_E5;case 8:return this._gl.RGBA4;case 9:return this._gl.RGB5_A1;case 11:switch(t){case 5:return this._gl.RGB10_A2;case 11:return this._gl.RGB10_A2UI;default:return this._gl.RGB10_A2}}return i?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8}_loadFile(e,t,i,r,s,o){const a=Oe._FileToolsLoadFile(e,t,i,r,s,o);return this._activeRequests.push(a),a.onCompleteObservable.add(l=>{this._activeRequests.splice(this._activeRequests.indexOf(l),1)}),a}static _FileToolsLoadFile(e,t,i,r,s,o){throw Ge("FileTools")}readPixels(e,t,i,r,s=!0,o=!0){const a=s?4:3,l=s?this._gl.RGBA:this._gl.RGB,h=new Uint8Array(r*i*a);return o&&this.flushFramebuffer(),this._gl.readPixels(e,t,i,r,l,this._gl.UNSIGNED_BYTE,h),Promise.resolve(h)}static get IsSupportedAsync(){return Promise.resolve(this.isSupported())}static get IsSupported(){return this.isSupported()}static isSupported(){if(this._HasMajorPerformanceCaveat!==null)return!this._HasMajorPerformanceCaveat;if(this._IsSupported===null)try{const e=this._CreateCanvas(1,1),t=e.getContext("webgl")||e.getContext("experimental-webgl");this._IsSupported=t!=null&&!!window.WebGLRenderingContext}catch{this._IsSupported=!1}return this._IsSupported}static get HasMajorPerformanceCaveat(){if(this._HasMajorPerformanceCaveat===null)try{const e=this._CreateCanvas(1,1),t=e.getContext("webgl",{failIfMajorPerformanceCaveat:!0})||e.getContext("experimental-webgl",{failIfMajorPerformanceCaveat:!0});this._HasMajorPerformanceCaveat=!t}catch{this._HasMajorPerformanceCaveat=!1}return this._HasMajorPerformanceCaveat}static CeilingPOT(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,e++,e}static FloorPOT(e){return e=e|e>>1,e=e|e>>2,e=e|e>>4,e=e|e>>8,e=e|e>>16,e-(e>>1)}static NearestPOT(e){const t=Oe.CeilingPOT(e),i=Oe.FloorPOT(e);return t-e>e-i?i:t}static GetExponentOfTwo(e,t,i=2){let r;switch(i){case 1:r=Oe.FloorPOT(e);break;case 2:r=Oe.NearestPOT(e);break;case 3:default:r=Oe.CeilingPOT(e);break}return Math.min(r,t)}static QueueNewFrame(e,t){if(Ai()){const{requestAnimationFrame:i}=t||window;if(typeof i=="function")return i(e)}else if(typeof requestAnimationFrame=="function")return requestAnimationFrame(e);return setTimeout(e,16)}getHostDocument(){return this._renderingCanvas&&this._renderingCanvas.ownerDocument?this._renderingCanvas.ownerDocument:da()?document:null}}Oe._TempClearColorUint32=new Uint32Array(4);Oe._TempClearColorInt32=new Int32Array(4);Oe.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/12\\d\\..+?Mobile",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:".*AppleWebKit.*(15.4).*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]},{key:".*(15.4).*AppleWebKit.*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]}];Oe._TextureLoaders=[];Oe.CollisionsEpsilon=.001;Oe._IsSupported=null;Oe._HasMajorPerformanceCaveat=null;class ah{static SetImmediate(e){Ai()&&window.setImmediate?window.setImmediate(e):setTimeout(e,1)}}const J_=new RegExp(/^data:([^,]+\/[^,]+)?;base64,/i);class lh extends Ho{constructor(e,t){super(e,kh.LoadFileError),this.name="LoadFileError",No._setPrototypeOf(this,lh.prototype),t instanceof Ei?this.request=t:this.file=t}}class hh extends Ho{constructor(e,t){super(e,kh.RequestFileError),this.request=t,this.name="RequestFileError",No._setPrototypeOf(this,hh.prototype)}}class cd extends Ho{constructor(e,t){super(e,kh.ReadFileError),this.file=t,this.name="ReadFileError",No._setPrototypeOf(this,cd.prototype)}}const di={DefaultRetryStrategy:KS.ExponentialBackoff(),BaseUrl:"",CorsBehavior:"anonymous",PreprocessUrl:n=>n,ScriptBaseUrl:"",ScriptPreprocessUrl:n=>n},$_=n=>(n=n.replace(/#/gm,"%23"),n),ud=(n,e)=>{if(!(n&&n.indexOf("data:")===0)&&di.CorsBehavior)if(typeof di.CorsBehavior=="string"||di.CorsBehavior instanceof String)e.crossOrigin=di.CorsBehavior;else{const t=di.CorsBehavior(n);t&&(e.crossOrigin=t)}},Ya=(n,e,t,i,r="",s)=>{const o=rt.LastCreatedEngine;if(typeof HTMLImageElement>"u"&&!(o!=null&&o._features.forceBitmapOverHTMLImageElement))return t("LoadImage is only supported in web or BabylonNative environments."),null;let a,l=!1;n instanceof ArrayBuffer||ArrayBuffer.isView(n)?typeof Blob<"u"&&typeof URL<"u"?(a=URL.createObjectURL(new Blob([n],{type:r})),l=!0):a=`data:${r};base64,`+Z_(n):n instanceof Blob?(a=URL.createObjectURL(n),l=!0):(a=$_(n),a=di.PreprocessUrl(n));const h=_=>{if(t){const T=a||n.toString();t(`Error while trying to load image: ${T.indexOf("http")===0||T.length<=128?T:T.slice(0,128)+"..."}`,_)}};if(o!=null&&o._features.forceBitmapOverHTMLImageElement)return fn(a,_=>{o.createImageBitmap(new Blob([_],{type:r}),{premultiplyAlpha:"none",...s}).then(T=>{e(T),l&&URL.revokeObjectURL(a)}).catch(T=>{t&&t("Error while trying to load image: "+n,T)})},void 0,i||void 0,!0,(_,T)=>{h(T)}),null;const c=new Image;ud(a,c);const u=[],d=()=>{u.forEach(_=>{_.target.addEventListener(_.name,_.handler)})},f=()=>{u.forEach(_=>{_.target.removeEventListener(_.name,_.handler)}),u.length=0},p=()=>{f(),e(c),l&&c.src&&URL.revokeObjectURL(c.src)},g=_=>{f(),h(_),l&&c.src&&URL.revokeObjectURL(c.src)},m=_=>{if(_.blockedURI!==c.src)return;f();const T=new Error(`CSP violation of policy ${_.effectiveDirective} ${_.blockedURI}. Current policy is ${_.originalPolicy}`);rt.UseFallbackTexture=!1,h(T),l&&c.src&&URL.revokeObjectURL(c.src),c.src=""};u.push({target:c,name:"load",handler:p}),u.push({target:c,name:"error",handler:g}),u.push({target:document,name:"securitypolicyviolation",handler:m}),d();const x=a.substring(0,5)==="blob:",E=a.substring(0,5)==="data:",R=()=>{x||E||!Ei.IsCustomRequestAvailable?c.src=a:fn(a,(_,T,y)=>{const P=!r&&y?y:r,D=new Blob([_],{type:P}),F=URL.createObjectURL(D);l=!0,c.src=F},void 0,i||void 0,!0,(_,T)=>{h(T)})},C=()=>{i&&i.loadImage(a,c)};if(!x&&!E&&i&&i.enableTexturesOffline)i.open(C,R);else{if(a.indexOf("file:")!==-1){const _=decodeURIComponent(a.substring(5).toLowerCase());if(fa.FilesToLoad[_]&&typeof URL<"u"){try{let T;try{T=URL.createObjectURL(fa.FilesToLoad[_])}catch{T=URL.createObjectURL(fa.FilesToLoad[_])}c.src=T,l=!0}catch{c.src=""}return c}}R()}return c},xa=(n,e,t,i,r)=>{const s=new FileReader,o={onCompleteObservable:new he,abort:()=>s.abort()};return s.onloadend=()=>o.onCompleteObservable.notifyObservers(o),r&&(s.onerror=()=>{r(new cd(`Unable to read ${n.name}`,n))}),s.onload=a=>{e(a.target.result)},t&&(s.onprogress=t),i?s.readAsArrayBuffer(n):s.readAsText(n),o},fn=(n,e,t,i,r,s,o)=>{if(n.name)return xa(n,e,t,r,s?c=>{s(void 0,c)}:void 0);const a=n;if(a.indexOf("file:")!==-1){let c=decodeURIComponent(a.substring(5).toLowerCase());c.indexOf("./")===0&&(c=c.substring(2));const u=fa.FilesToLoad[c];if(u)return xa(u,e,t,r,s?d=>s(void 0,new lh(d.message,d.file)):void 0)}const{match:l,type:h}=fy(a);if(l){const c={onCompleteObservable:new he,abort:()=>()=>{}};try{const u=r?fd(a):i0(a);e(u,void 0,h)}catch(u){s?s(void 0,u):oe.Error(u.message||"Failed to parse the Data URL")}return ah.SetImmediate(()=>{c.onCompleteObservable.notifyObservers(c)}),c}return dd(a,(c,u)=>{e(c,u==null?void 0:u.responseURL,u==null?void 0:u.getResponseHeader("content-type"))},t,i,r,s?c=>{s(c.request,new lh(c.message,c.request))}:void 0,o)},dd=(n,e,t,i,r,s,o)=>{n=$_(n),n=di.PreprocessUrl(n);const a=di.BaseUrl+n;let l=!1;const h={onCompleteObservable:new he,abort:()=>l=!0},c=()=>{let u=new Ei,d=null,f;const p=()=>{u&&(t&&u.removeEventListener("progress",t),f&&u.removeEventListener("readystatechange",f),u.removeEventListener("loadend",g))};let g=()=>{p(),h.onCompleteObservable.notifyObservers(h),h.onCompleteObservable.clear(),t=void 0,f=null,g=null,s=void 0,o=void 0,e=void 0};h.abort=()=>{l=!0,g&&g(),u&&u.readyState!==(XMLHttpRequest.DONE||4)&&u.abort(),d!==null&&(clearTimeout(d),d=null),u=null};const m=E=>{const R=E.message||"Unknown error";s&&u?s(new hh(R,u)):oe.Error(R)},x=E=>{if(u){if(u.open("GET",a),o)try{o(u)}catch(R){m(R);return}r&&(u.responseType="arraybuffer"),t&&u.addEventListener("progress",t),g&&u.addEventListener("loadend",g),f=()=>{if(!(l||!u)&&u.readyState===(XMLHttpRequest.DONE||4)){if(f&&u.removeEventListener("readystatechange",f),u.status>=200&&u.status<300||u.status===0&&(!Ai()||e0())){try{e&&e(r?u.response:u.responseText,u)}catch(_){m(_)}return}const R=di.DefaultRetryStrategy;if(R){const _=R(a,u,E);if(_!==-1){p(),u=new Ei,d=setTimeout(()=>x(E+1),_);return}}const C=new hh("Error status: "+u.status+" "+u.statusText+" - Unable to load "+a,u);s&&s(C)}},u.addEventListener("readystatechange",f),u.send()}};x(0)};if(i&&i.enableSceneOffline){const u=f=>{f&&f.status>400?s&&s(f):c()},d=()=>{i&&i.loadFile(di.BaseUrl+n,f=>{!l&&e&&e(f),h.onCompleteObservable.notifyObservers(h)},t?f=>{!l&&t&&t(f)}:void 0,u,r)};i.open(d,u)}else c();return h},e0=()=>typeof location<"u"&&location.protocol==="file:",t0=n=>J_.test(n),fy=n=>{const e=J_.exec(n);return e===null||e.length===0?{match:!1,type:""}:{match:!0,type:e[0].replace("data:","").replace("base64,","")}};function fd(n){return qS(n.split(",")[1])}const i0=n=>j_(n.split(",")[1]),py=()=>{Oe._FileToolsLoadImage=Ya,Oe._FileToolsLoadFile=fn,ms._FileToolsLoadFile=fn};py();let na;const gy=(n,e,t,i,r,s,o,a,l,h)=>{na={DecodeBase64UrlToBinary:n,DecodeBase64UrlToString:e,DefaultRetryStrategy:t.DefaultRetryStrategy,BaseUrl:t.BaseUrl,CorsBehavior:t.CorsBehavior,PreprocessUrl:t.PreprocessUrl,IsBase64DataUrl:i,IsFileURL:r,LoadFile:s,LoadImage:o,ReadFile:a,RequestFile:l,SetCorsBehavior:h},Object.defineProperty(na,"DefaultRetryStrategy",{get:function(){return t.DefaultRetryStrategy},set:function(c){t.DefaultRetryStrategy=c}}),Object.defineProperty(na,"BaseUrl",{get:function(){return t.BaseUrl},set:function(c){t.BaseUrl=c}}),Object.defineProperty(na,"PreprocessUrl",{get:function(){return t.PreprocessUrl},set:function(c){t.PreprocessUrl=c}}),Object.defineProperty(na,"CorsBehavior",{get:function(){return t.CorsBehavior},set:function(c){t.CorsBehavior=c}})};gy(fd,i0,di,t0,e0,fn,Ya,xa,dd,ud);const r0={};function ye(n,e){r0[n]=e}function Er(n){return r0[n]}class ga{static Instantiate(e){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[e])return this.RegisteredExternalClasses[e];const t=Er(e);if(t)return t;oe.Warn(e+" not found, you may have missed an import.");const i=e.split(".");let r=window||this;for(let s=0,o=i.length;s<o;s++)r=r[i[s]];return typeof r!="function"?null:r}}ga.RegisteredExternalClasses={};function pd(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{const e=Math.random()*16|0;return(n==="x"?e:e&3|8).toString(16)})}function Ca(n){let e=1;do e*=2;while(e<n);return e===n}function bu(n,e,t){return n*(1-t)+e*t}class ge{static get BaseUrl(){return di.BaseUrl}static set BaseUrl(e){di.BaseUrl=e}static IsAbsoluteUrl(e){return e.indexOf("//")===0?!0:e.indexOf("://")===-1||e.indexOf(".")===-1||e.indexOf("/")===-1||e.indexOf(":")>e.indexOf("/")?!1:e.indexOf("://")<e.indexOf(".")||e.indexOf("data:")===0||e.indexOf("blob:")===0}static set ScriptBaseUrl(e){di.ScriptBaseUrl=e}static get ScriptBaseUrl(){return di.ScriptBaseUrl}static set ScriptPreprocessUrl(e){di.ScriptPreprocessUrl=e}static get ScriptPreprocessUrl(){return di.ScriptPreprocessUrl}static get DefaultRetryStrategy(){return di.DefaultRetryStrategy}static set DefaultRetryStrategy(e){di.DefaultRetryStrategy=e}static get CorsBehavior(){return di.CorsBehavior}static set CorsBehavior(e){di.CorsBehavior=e}static get UseFallbackTexture(){return rt.UseFallbackTexture}static set UseFallbackTexture(e){rt.UseFallbackTexture=e}static get RegisteredExternalClasses(){return ga.RegisteredExternalClasses}static set RegisteredExternalClasses(e){ga.RegisteredExternalClasses=e}static get fallbackTexture(){return rt.FallbackTexture}static set fallbackTexture(e){rt.FallbackTexture=e}static FetchToRef(e,t,i,r,s,o){const a=Math.abs(e)*i%i|0,l=Math.abs(t)*r%r|0,h=(a+l*i)*4;o.r=s[h]/255,o.g=s[h+1]/255,o.b=s[h+2]/255,o.a=s[h+3]/255}static Mix(e,t,i){return 0}static Instantiate(e){return ga.Instantiate(e)}static SetImmediate(e){ah.SetImmediate(e)}static IsExponentOfTwo(e){return!0}static FloatRound(e){return Math.fround(e)}static GetFilename(e){const t=e.lastIndexOf("/");return t<0?e:e.substring(t+1)}static GetFolderPath(e,t=!1){const i=e.lastIndexOf("/");return i<0?t?e:"":e.substring(0,i+1)}static ToDegrees(e){return e*180/Math.PI}static ToRadians(e){return e*Math.PI/180}static SmoothAngleChange(e,t,i=.9){const r=this.ToRadians(e),s=this.ToRadians(t);return this.ToDegrees(Math.atan2((1-i)*Math.sin(s)+i*Math.sin(r),(1-i)*Math.cos(s)+i*Math.cos(r)))}static MakeArray(e,t){return t!==!0&&(e===void 0||e==null)?null:Array.isArray(e)?e:[e]}static GetPointerPrefix(e){let t="pointer";return Ai()&&!window.PointerEvent&&(t="mouse"),e._badDesktopOS&&!e._badOS&&!(document&&"ontouchend"in document)&&(t="mouse"),t}static SetCorsBehavior(e,t){ud(e,t)}static SetReferrerPolicyBehavior(e,t){t.referrerPolicy=e}static CleanUrl(e){return e=e.replace(/#/gm,"%23"),e}static get PreprocessUrl(){return di.PreprocessUrl}static set PreprocessUrl(e){di.PreprocessUrl=e}static LoadImage(e,t,i,r,s,o){return Ya(e,t,i,r,s,o)}static LoadFile(e,t,i,r,s,o){return fn(e,t,i,r,s,o)}static LoadFileAsync(e,t=!0){return new Promise((i,r)=>{fn(e,s=>{i(s)},void 0,void 0,t,(s,o)=>{r(o)})})}static GetBabylonScriptURL(e,t){if(!e)return"";if(ge.ScriptBaseUrl&&e.startsWith(ge._DefaultCdnUrl)){const i=ge.ScriptBaseUrl[ge.ScriptBaseUrl.length-1]==="/"?ge.ScriptBaseUrl.substring(0,ge.ScriptBaseUrl.length-1):ge.ScriptBaseUrl;e=e.replace(ge._DefaultCdnUrl,i)}return e=ge.ScriptPreprocessUrl(e),t&&(e=ge.GetAbsoluteUrl(e)),e}static LoadBabylonScript(e,t,i,r){e=ge.GetBabylonScriptURL(e),ge.LoadScript(e,t,i)}static LoadBabylonScriptAsync(e){return e=ge.GetBabylonScriptURL(e),ge.LoadScriptAsync(e)}static LoadScript(e,t,i,r){if(typeof importScripts=="function"){try{importScripts(e),t()}catch(a){i==null||i(`Unable to load script '${e}' in worker`,a)}return}else if(!Ai()){i==null||i(`Cannot load script '${e}' outside of a window or a worker`);return}const s=document.getElementsByTagName("head")[0],o=document.createElement("script");o.setAttribute("type","text/javascript"),o.setAttribute("src",e),r&&(o.id=r),o.onload=()=>{t&&t()},o.onerror=a=>{i&&i(`Unable to load script '${e}'`,a)},s.appendChild(o)}static LoadScriptAsync(e,t){return new Promise((i,r)=>{this.LoadScript(e,()=>{i()},(s,o)=>{r(o||new Error(s))},t)})}static ReadFileAsDataURL(e,t,i){const r=new FileReader,s={onCompleteObservable:new he,abort:()=>r.abort()};return r.onloadend=()=>{s.onCompleteObservable.notifyObservers(s)},r.onload=o=>{t(o.target.result)},r.onprogress=i,r.readAsDataURL(e),s}static ReadFile(e,t,i,r,s){return xa(e,t,i,r,s)}static FileAsURL(e){const t=new Blob([e]);return window.URL.createObjectURL(t)}static Format(e,t=2){return e.toFixed(t)}static DeepCopy(e,t,i,r){Vn.DeepCopy(e,t,i,r)}static IsEmpty(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}static RegisterTopRootEvents(e,t){for(let i=0;i<t.length;i++){const r=t[i];e.addEventListener(r.name,r.handler,!1);try{window.parent&&window.parent.addEventListener(r.name,r.handler,!1)}catch{}}}static UnregisterTopRootEvents(e,t){for(let i=0;i<t.length;i++){const r=t[i];e.removeEventListener(r.name,r.handler);try{e.parent&&e.parent.removeEventListener(r.name,r.handler)}catch{}}}static async DumpFramebuffer(e,t,i,r,s="image/png",o,a){throw Ge("DumpTools")}static DumpData(e,t,i,r,s="image/png",o,a=!1,l=!1,h){throw Ge("DumpTools")}static DumpDataAsync(e,t,i,r="image/png",s,o=!1,a=!1,l){throw Ge("DumpTools")}static _IsOffScreenCanvas(e){return e.convertToBlob!==void 0}static ToBlob(e,t,i="image/png",r){!ge._IsOffScreenCanvas(e)&&!e.toBlob&&(e.toBlob=function(s,o,a){setTimeout(()=>{const l=atob(this.toDataURL(o,a).split(",")[1]),h=l.length,c=new Uint8Array(h);for(let u=0;u<h;u++)c[u]=l.charCodeAt(u);s(new Blob([c]))})}),ge._IsOffScreenCanvas(e)?e.convertToBlob({type:i,quality:r}).then(s=>t(s)):e.toBlob(function(s){t(s)},i,r)}static DownloadBlob(e,t){if("download"in document.createElement("a")){if(!t){const i=new Date;t="screenshot_"+((i.getFullYear()+"-"+(i.getMonth()+1)).slice(2)+"-"+i.getDate()+"_"+i.getHours()+"-"+("0"+i.getMinutes()).slice(-2))+".png"}ge.Download(e,t)}else if(e&&typeof URL<"u"){const i=URL.createObjectURL(e),r=window.open("");if(!r)return;const s=r.document.createElement("img");s.onload=function(){URL.revokeObjectURL(i)},s.src=i,r.document.body.appendChild(s)}}static EncodeScreenshotCanvasData(e,t,i="image/png",r,s){if(typeof r=="string"||!t)this.ToBlob(e,function(o){o&&ge.DownloadBlob(o,r),t&&t("")},i,s);else if(t){if(ge._IsOffScreenCanvas(e)){e.convertToBlob({type:i,quality:s}).then(a=>{const l=new FileReader;l.readAsDataURL(a),l.onloadend=()=>{const h=l.result;t(h)}});return}const o=e.toDataURL(i,s);t(o)}}static Download(e,t){if(typeof URL>"u")return;const i=window.URL.createObjectURL(e),r=document.createElement("a");document.body.appendChild(r),r.style.display="none",r.href=i,r.download=t,r.addEventListener("click",()=>{r.parentElement&&r.parentElement.removeChild(r)}),r.click(),window.URL.revokeObjectURL(i)}static BackCompatCameraNoPreventDefault(e){return typeof e[0]=="boolean"?e[0]:typeof e[1]=="boolean"?e[1]:!1}static CreateScreenshot(e,t,i,r,s="image/png",o=!1,a){throw Ge("ScreenshotTools")}static CreateScreenshotAsync(e,t,i,r="image/png",s){throw Ge("ScreenshotTools")}static CreateScreenshotUsingRenderTarget(e,t,i,r,s="image/png",o=1,a=!1,l,h=!1,c=!1,u=!0,d){throw Ge("ScreenshotTools")}static CreateScreenshotUsingRenderTargetAsync(e,t,i,r="image/png",s=1,o=!1,a,l=!1,h=!1,c=!0,u){throw Ge("ScreenshotTools")}static RandomId(){return pd()}static IsBase64(e){return t0(e)}static DecodeBase64(e){return fd(e)}static get errorsCount(){return oe.errorsCount}static Log(e){oe.Log(e)}static Warn(e){oe.Warn(e)}static Error(e){oe.Error(e)}static get LogCache(){return oe.LogCache}static ClearLogCache(){oe.ClearLogCache()}static set LogLevels(e){oe.LogLevels=e}static set PerformanceLogLevel(e){if((e&ge.PerformanceUserMarkLogLevel)===ge.PerformanceUserMarkLogLevel){ge.StartPerformanceCounter=ge._StartUserMark,ge.EndPerformanceCounter=ge._EndUserMark;return}if((e&ge.PerformanceConsoleLogLevel)===ge.PerformanceConsoleLogLevel){ge.StartPerformanceCounter=ge._StartPerformanceConsole,ge.EndPerformanceCounter=ge._EndPerformanceConsole;return}ge.StartPerformanceCounter=ge._StartPerformanceCounterDisabled,ge.EndPerformanceCounter=ge._EndPerformanceCounterDisabled}static _StartPerformanceCounterDisabled(e,t){}static _EndPerformanceCounterDisabled(e,t){}static _StartUserMark(e,t=!0){if(!ge._Performance){if(!Ai())return;ge._Performance=window.performance}!t||!ge._Performance.mark||ge._Performance.mark(e+"-Begin")}static _EndUserMark(e,t=!0){!t||!ge._Performance.mark||(ge._Performance.mark(e+"-End"),ge._Performance.measure(e,e+"-Begin",e+"-End"))}static _StartPerformanceConsole(e,t=!0){t&&(ge._StartUserMark(e,t),console.time&&console.time(e))}static _EndPerformanceConsole(e,t=!0){t&&(ge._EndUserMark(e,t),console.timeEnd(e))}static get Now(){return hr.Now}static GetClassName(e,t=!1){let i=null;return!t&&e.getClassName?i=e.getClassName():(e instanceof Object&&(i=(t?e:Object.getPrototypeOf(e)).constructor.__bjsclassName__),i||(i=typeof e)),i}static First(e,t){for(const i of e)if(t(i))return i;return null}static getFullClassName(e,t=!1){let i=null,r=null;if(!t&&e.getClassName)i=e.getClassName();else{if(e instanceof Object){const s=t?e:Object.getPrototypeOf(e);i=s.constructor.__bjsclassName__,r=s.constructor.__bjsmoduleName__}i||(i=typeof e)}return i?(r!=null?r+".":"")+i:null}static DelayAsync(e){return new Promise(t=>{setTimeout(()=>{t()},e)})}static IsSafari(){return aa()?/^((?!chrome|android).)*safari/i.test(navigator.userAgent):!1}}ge.UseCustomRequestHeaders=!1;ge.CustomRequestHeaders=Ei.CustomRequestHeaders;ge.GetDOMTextContent=Y_;ge._DefaultCdnUrl="https://cdn.babylonjs.com";ge.GetAbsoluteUrl=typeof document=="object"?n=>{const e=document.createElement("a");return e.href=n,e.href}:typeof URL=="function"&&typeof location=="object"?n=>new URL(n,location.origin).href:()=>{throw new Error("Unable to get absolute URL. Override BABYLON.Tools.GetAbsoluteUrl to a custom implementation for the current context.")};ge.NoneLogLevel=oe.NoneLogLevel;ge.MessageLogLevel=oe.MessageLogLevel;ge.WarningLogLevel=oe.WarningLogLevel;ge.ErrorLogLevel=oe.ErrorLogLevel;ge.AllLogLevel=oe.AllLogLevel;ge.IsWindowObjectExist=Ai;ge.PerformanceNoneLogLevel=0;ge.PerformanceUserMarkLogLevel=1;ge.PerformanceConsoleLogLevel=2;ge.StartPerformanceCounter=ge._StartPerformanceCounterDisabled;ge.EndPerformanceCounter=ge._EndPerformanceCounterDisabled;class Dr{constructor(e,t,i,r=0){this.iterations=e,this.index=r-1,this._done=!1,this._fn=t,this._successCallback=i}executeNext(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())}breakLoop(){this._done=!0,this._successCallback()}static Run(e,t,i,r=0){const s=new Dr(e,t,i,r);return s.executeNext(),s}static SyncAsyncForLoop(e,t,i,r,s,o=0){return Dr.Run(Math.ceil(e/t),a=>{s&&s()?a.breakLoop():setTimeout(()=>{for(let l=0;l<t;++l){const h=a.index*t+l;if(h>=e)break;if(i(h),s&&s()){a.breakLoop();break}}a.executeNext()},o)},r)}}ge.Mix=bu;ge.IsExponentOfTwo=Ca;rt.FallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z";class Vi{constructor(e){this.length=0,this.data=new Array(e),this._id=Vi._GlobalId++}push(e){this.data[this.length++]=e,this.length>this.data.length&&(this.data.length*=2)}forEach(e){for(let t=0;t<this.length;t++)e(this.data[t])}sort(e){this.data.sort(e)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(e){if(e.length!==0){this.length+e.length>this.data.length&&(this.data.length=(this.length+e.length)*2);for(let t=0;t<e.length;t++)this.data[this.length++]=(e.data||e)[t]}}indexOf(e){const t=this.data.indexOf(e);return t>=this.length?-1:t}contains(e){return this.indexOf(e)!==-1}}Vi._GlobalId=0;class In extends Vi{constructor(){super(...arguments),this._duplicateId=0}push(e){super.push(e),e.__smartArrayFlags||(e.__smartArrayFlags={}),e.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(e){return e.__smartArrayFlags&&e.__smartArrayFlags[this._id]===this._duplicateId?!1:(this.push(e),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(e){if(e.length!==0){this.length+e.length>this.data.length&&(this.data.length=(this.length+e.length)*2);for(let t=0;t<e.length;t++){const i=(e.data||e)[t];this.pushNoDuplicate(i)}}}}class cg{constructor(){this._count=0,this._data={}}copyFrom(e){this.clear(),e.forEach((t,i)=>this.add(t,i))}get(e){const t=this._data[e];if(t!==void 0)return t}getOrAddWithFactory(e,t){let i=this.get(e);return i!==void 0||(i=t(e),i&&this.add(e,i)),i}getOrAdd(e,t){const i=this.get(e);return i!==void 0?i:(this.add(e,t),t)}contains(e){return this._data[e]!==void 0}add(e,t){return this._data[e]!==void 0?!1:(this._data[e]=t,++this._count,!0)}set(e,t){return this._data[e]===void 0?!1:(this._data[e]=t,!0)}getAndRemove(e){const t=this.get(e);return t!==void 0?(delete this._data[e],--this._count,t):null}remove(e){return this.contains(e)?(delete this._data[e],--this._count,!0):!1}clear(){this._data={},this._count=0}get count(){return this._count}forEach(e){for(const t in this._data){const i=this._data[t];e(t,i)}}first(e){for(const t in this._data){const i=this._data[t],r=e(t,i);if(r)return r}return null}}class Mn{static Eval(e,t){return e.match(/\([^()]*\)/g)?e=e.replace(/\([^()]*\)/g,i=>(i=i.slice(1,i.length-1),Mn._HandleParenthesisContent(i,t))):e=Mn._HandleParenthesisContent(e,t),e==="true"?!0:e==="false"?!1:Mn.Eval(e,t)}static _HandleParenthesisContent(e,t){t=t||(s=>s==="true");let i;const r=e.split("||");for(const s in r)if(Object.prototype.hasOwnProperty.call(r,s)){let o=Mn._SimplifyNegation(r[s].trim());const a=o.split("&&");if(a.length>1)for(let l=0;l<a.length;++l){const h=Mn._SimplifyNegation(a[l].trim());if(h!=="true"&&h!=="false"?h[0]==="!"?i=!t(h.substring(1)):i=t(h):i=h==="true",!i){o="false";break}}if(i||o==="true"){i=!0;break}o!=="true"&&o!=="false"?o[0]==="!"?i=!t(o.substring(1)):i=t(o):i=o==="true"}return i?"true":"false"}static _SimplifyNegation(e){return e=e.replace(/^[\s!]+/,t=>(t=t.replace(/[\s]/g,()=>""),t.length%2?"!":"")),e=e.trim(),e==="!true"?e="false":e==="!false"&&(e="true"),e}}class it{static EnableFor(e){e._tags=e._tags||{},e.hasTags=()=>it.HasTags(e),e.addTags=t=>it.AddTagsTo(e,t),e.removeTags=t=>it.RemoveTagsFrom(e,t),e.matchesTagsQuery=t=>it.MatchesQuery(e,t)}static DisableFor(e){delete e._tags,delete e.hasTags,delete e.addTags,delete e.removeTags,delete e.matchesTagsQuery}static HasTags(e){if(!e._tags)return!1;const t=e._tags;for(const i in t)if(Object.prototype.hasOwnProperty.call(t,i))return!0;return!1}static GetTags(e,t=!0){if(!e._tags)return null;if(t){const i=[];for(const r in e._tags)Object.prototype.hasOwnProperty.call(e._tags,r)&&e._tags[r]===!0&&i.push(r);return i.join(" ")}else return e._tags}static AddTagsTo(e,t){!t||typeof t!="string"||t.split(" ").forEach(function(i){it._AddTagTo(e,i)})}static _AddTagTo(e,t){t=t.trim(),!(t===""||t==="true"||t==="false")&&(t.match(/[\s]/)||t.match(/^([!]|([|]|[&]){2})/)||(it.EnableFor(e),e._tags[t]=!0))}static RemoveTagsFrom(e,t){if(!it.HasTags(e))return;const i=t.split(" ");for(const r in i)it._RemoveTagFrom(e,i[r])}static _RemoveTagFrom(e,t){delete e._tags[t]}static MatchesQuery(e,t){return t===void 0?!0:t===""?it.HasTags(e):Mn.Eval(t,i=>it.HasTags(e)&&e._tags[i])}}const Yl=1/2.2,Zl=2.2,xt=.001;class Ci{static BuildArray(e,t){const i=[];for(let r=0;r<e;++r)i.push(t());return i}static BuildTuple(e,t){return Ci.BuildArray(e,t)}}function my(n,e,t){const i=n[e];if(typeof i!="function")return null;const r=function(){const s=n.length,o=r.previous.apply(n,arguments);return t(e,s),o};return i.next=r,r.previous=i,n[e]=r,()=>{const s=r.previous;if(!s)return;const o=r.next;o?(s.next=o,o.previous=s):(s.next=void 0,n[e]=s),r.next=void 0,r.previous=void 0}}const _y=["push","splice","pop","shift","unshift"];function s0(n,e){const t=_y.map(i=>my(n,i,e));return()=>{t.forEach(i=>{i==null||i()})}}function Mi(n,e,t=1401298e-51){return Math.abs(n-e)<=t}function jt(n,e){return n===e?n:Math.random()*(e-n)+n}function n0(n,e,t){return n+(e-n)*t}function si(n,e=0,t=1){return Math.min(t,Math.max(e,n))}function o0(n){return n-=Math.PI*2*Math.floor((n+Math.PI)/(Math.PI*2)),n}function Yr(n){const e=n.toString(16);return n<=15?("0"+e).toUpperCase():e.toUpperCase()}const cr=n=>parseInt(n.toString().replace(/\W/g,""));class me{constructor(e=0,t=0){this.x=e,this.y=t}toString(){return`{X: ${this.x} Y: ${this.y}}`}getClassName(){return"Vector2"}getHashCode(){const e=cr(this.x),t=cr(this.y);let i=e;return i=i*397^t,i}toArray(e,t=0){return e[t]=this.x,e[t+1]=this.y,this}fromArray(e,t=0){return me.FromArrayToRef(e,t,this),this}asArray(){return[this.x,this.y]}copyFrom(e){return this.x=e.x,this.y=e.y,this}copyFromFloats(e,t){return this.x=e,this.y=t,this}set(e,t){return this.copyFromFloats(e,t)}setAll(e){return this.copyFromFloats(e,e)}add(e){return new this.constructor(this.x+e.x,this.y+e.y)}addToRef(e,t){return t.x=this.x+e.x,t.y=this.y+e.y,t}addInPlace(e){return this.x+=e.x,this.y+=e.y,this}addInPlaceFromFloats(e,t){return this.x+=e,this.y+=t,this}addVector3(e){return new this.constructor(this.x+e.x,this.y+e.y)}subtract(e){return new this.constructor(this.x-e.x,this.y-e.y)}subtractToRef(e,t){return t.x=this.x-e.x,t.y=this.y-e.y,t}subtractInPlace(e){return this.x-=e.x,this.y-=e.y,this}multiplyInPlace(e){return this.x*=e.x,this.y*=e.y,this}multiply(e){return new this.constructor(this.x*e.x,this.y*e.y)}multiplyToRef(e,t){return t.x=this.x*e.x,t.y=this.y*e.y,t}multiplyByFloats(e,t){return new this.constructor(this.x*e,this.y*t)}divide(e){return new this.constructor(this.x/e.x,this.y/e.y)}divideToRef(e,t){return t.x=this.x/e.x,t.y=this.y/e.y,t}divideInPlace(e){return this.x=this.x/e.x,this.y=this.y/e.y,this}minimizeInPlace(e){return this.minimizeInPlaceFromFloats(e.x,e.y)}maximizeInPlace(e){return this.maximizeInPlaceFromFloats(e.x,e.y)}minimizeInPlaceFromFloats(e,t){return this.x=Math.min(e,this.x),this.y=Math.min(t,this.y),this}maximizeInPlaceFromFloats(e,t){return this.x=Math.max(e,this.x),this.y=Math.max(t,this.y),this}subtractFromFloats(e,t){return new this.constructor(this.x-e,this.y-t)}subtractFromFloatsToRef(e,t,i){return i.copyFromFloats(this.x-e,this.y-t)}negate(){return new this.constructor(-this.x,-this.y)}negateInPlace(){return this.x*=-1,this.y*=-1,this}negateToRef(e){return e.copyFromFloats(this.x*-1,this.y*-1)}scaleInPlace(e){return this.x*=e,this.y*=e,this}scale(e){return new this.constructor(this.x*e,this.y*e)}scaleToRef(e,t){return t.x=this.x*e,t.y=this.y*e,t}scaleAndAddToRef(e,t){return t.x+=this.x*e,t.y+=this.y*e,t}equals(e){return e&&this.x===e.x&&this.y===e.y}equalsWithEpsilon(e,t=xt){return e&&Mi(this.x,e.x,t)&&Mi(this.y,e.y,t)}equalsToFloats(e,t){return this.x===e&&this.y===t}floor(){return new this.constructor(Math.floor(this.x),Math.floor(this.y))}floorToRef(e){return e.x=Math.floor(this.x),e.y=Math.floor(this.y),e}fract(){return new this.constructor(this.x-Math.floor(this.x),this.y-Math.floor(this.y))}fractToRef(e){return e.x=this.x-Math.floor(this.x),e.y=this.y-Math.floor(this.y),e}rotateToRef(e,t){const i=Math.cos(e),r=Math.sin(e),s=i*this.x-r*this.y,o=r*this.x+i*this.y;return t.x=s,t.y=o,t}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}lengthSquared(){return this.x*this.x+this.y*this.y}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(e){return e===0||e===1?this:this.scaleInPlace(1/e)}normalizeToNew(){const e=new this.constructor;return this.normalizeToRef(e),e}normalizeToRef(e){const t=this.length();return t===0?e.copyFrom(this):this.scaleToRef(1/t,e)}clone(){return new this.constructor(this.x,this.y)}dot(e){return this.x*e.x+this.y*e.y}static Zero(){return new me(0,0)}static One(){return new me(1,1)}static Random(e=0,t=1){return new me(jt(e,t),jt(e,t))}static RandomToRef(e=0,t=1,i){return i.copyFromFloats(jt(e,t),jt(e,t))}static get ZeroReadOnly(){return me._ZeroReadOnly}static FromArray(e,t=0){return new me(e[t],e[t+1])}static FromArrayToRef(e,t,i){return i.x=e[t],i.y=e[t+1],i}static FromFloatsToRef(e,t,i){return i.copyFromFloats(e,t),i}static CatmullRom(e,t,i,r,s){const o=s*s,a=s*o,l=.5*(2*t.x+(-e.x+i.x)*s+(2*e.x-5*t.x+4*i.x-r.x)*o+(-e.x+3*t.x-3*i.x+r.x)*a),h=.5*(2*t.y+(-e.y+i.y)*s+(2*e.y-5*t.y+4*i.y-r.y)*o+(-e.y+3*t.y-3*i.y+r.y)*a);return new e.constructor(l,h)}static ClampToRef(e,t,i,r){return r.x=si(e.x,t.x,i.x),r.y=si(e.y,t.y,i.y),r}static Clamp(e,t,i){const r=si(e.x,t.x,i.x),s=si(e.y,t.y,i.y);return new e.constructor(r,s)}static Hermite(e,t,i,r,s){const o=s*s,a=s*o,l=2*a-3*o+1,h=-2*a+3*o,c=a-2*o+s,u=a-o,d=e.x*l+i.x*h+t.x*c+r.x*u,f=e.y*l+i.y*h+t.y*c+r.y*u;return new e.constructor(d,f)}static Hermite1stDerivative(e,t,i,r,s){const o=new e.constructor;return this.Hermite1stDerivativeToRef(e,t,i,r,s,o),o}static Hermite1stDerivativeToRef(e,t,i,r,s,o){const a=s*s;return o.x=(a-s)*6*e.x+(3*a-4*s+1)*t.x+(-a+s)*6*i.x+(3*a-2*s)*r.x,o.y=(a-s)*6*e.y+(3*a-4*s+1)*t.y+(-a+s)*6*i.y+(3*a-2*s)*r.y,o}static Lerp(e,t,i){const r=e.x+(t.x-e.x)*i,s=e.y+(t.y-e.y)*i;return new e.constructor(r,s)}static Dot(e,t){return e.x*t.x+e.y*t.y}static Normalize(e){const t=new e.constructor;return me.NormalizeToRef(e,t),t}static NormalizeToRef(e,t){return e.normalizeToRef(t),t}static Minimize(e,t){const i=e.x<t.x?e.x:t.x,r=e.y<t.y?e.y:t.y;return new e.constructor(i,r)}static Maximize(e,t){const i=e.x>t.x?e.x:t.x,r=e.y>t.y?e.y:t.y;return new e.constructor(i,r)}static Transform(e,t){const i=new e.constructor;return me.TransformToRef(e,t,i),i}static TransformToRef(e,t,i){const r=t.m,s=e.x*r[0]+e.y*r[4]+r[12],o=e.x*r[1]+e.y*r[5]+r[13];return i.x=s,i.y=o,i}static PointInTriangle(e,t,i,r){const s=.5*(-i.y*r.x+t.y*(-i.x+r.x)+t.x*(i.y-r.y)+i.x*r.y),o=s<0?-1:1,a=(t.y*r.x-t.x*r.y+(r.y-t.y)*e.x+(t.x-r.x)*e.y)*o,l=(t.x*i.y-t.y*i.x+(t.y-i.y)*e.x+(i.x-t.x)*e.y)*o;return a>0&&l>0&&a+l<2*s*o}static Distance(e,t){return Math.sqrt(me.DistanceSquared(e,t))}static DistanceSquared(e,t){const i=e.x-t.x,r=e.y-t.y;return i*i+r*r}static Center(e,t){const i=new e.constructor;return me.CenterToRef(e,t,i)}static CenterToRef(e,t,i){return i.copyFromFloats((e.x+t.x)/2,(e.y+t.y)/2)}static DistanceOfPointFromSegment(e,t,i){const r=me.DistanceSquared(t,i);if(r===0)return me.Distance(e,t);const s=i.subtract(t),o=Math.max(0,Math.min(1,me.Dot(e.subtract(t),s)/r)),a=t.add(s.multiplyByFloats(o,o));return me.Distance(e,a)}}me._ZeroReadOnly=me.Zero();Object.defineProperties(me.prototype,{dimension:{value:[2]},rank:{value:1}});class v{get x(){return this._x}set x(e){this._x=e,this._isDirty=!0}get y(){return this._y}set y(e){this._y=e,this._isDirty=!0}get z(){return this._z}set z(e){this._z=e,this._isDirty=!0}constructor(e=0,t=0,i=0){this._isDirty=!0,this._x=e,this._y=t,this._z=i}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z}}`}getClassName(){return"Vector3"}getHashCode(){const e=cr(this._x),t=cr(this._y),i=cr(this._z);let r=e;return r=r*397^t,r=r*397^i,r}asArray(){return[this._x,this._y,this._z]}toArray(e,t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,this}fromArray(e,t=0){return v.FromArrayToRef(e,t,this),this}toQuaternion(){return Re.RotationYawPitchRoll(this._y,this._x,this._z)}addInPlace(e){return this._x+=e._x,this._y+=e._y,this._z+=e._z,this._isDirty=!0,this}addInPlaceFromFloats(e,t,i){return this._x+=e,this._y+=t,this._z+=i,this._isDirty=!0,this}add(e){return new this.constructor(this._x+e._x,this._y+e._y,this._z+e._z)}addToRef(e,t){return t.copyFromFloats(this._x+e._x,this._y+e._y,this._z+e._z)}subtractInPlace(e){return this._x-=e._x,this._y-=e._y,this._z-=e._z,this._isDirty=!0,this}subtract(e){return new this.constructor(this._x-e._x,this._y-e._y,this._z-e._z)}subtractToRef(e,t){return this.subtractFromFloatsToRef(e._x,e._y,e._z,t)}subtractFromFloats(e,t,i){return new this.constructor(this._x-e,this._y-t,this._z-i)}subtractFromFloatsToRef(e,t,i,r){return r.copyFromFloats(this._x-e,this._y-t,this._z-i)}negate(){return new this.constructor(-this._x,-this._y,-this._z)}negateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}negateToRef(e){return e.copyFromFloats(this._x*-1,this._y*-1,this._z*-1)}scaleInPlace(e){return this._x*=e,this._y*=e,this._z*=e,this._isDirty=!0,this}scale(e){return new this.constructor(this._x*e,this._y*e,this._z*e)}scaleToRef(e,t){return t.copyFromFloats(this._x*e,this._y*e,this._z*e)}getNormalToRef(e){const t=this.length();let i=Math.acos(this.y/t);const r=Math.atan2(this.z,this.x);i>Math.PI/2?i-=Math.PI/2:i+=Math.PI/2;const s=t*Math.sin(i)*Math.cos(r),o=t*Math.cos(i),a=t*Math.sin(i)*Math.sin(r);return e.set(s,o,a),e}applyRotationQuaternionToRef(e,t){const i=this._x,r=this._y,s=this._z,o=e._x,a=e._y,l=e._z,h=e._w,c=2*(a*s-l*r),u=2*(l*i-o*s),d=2*(o*r-a*i);return t._x=i+h*c+a*d-l*u,t._y=r+h*u+l*c-o*d,t._z=s+h*d+o*u-a*c,t._isDirty=!0,t}applyRotationQuaternionInPlace(e){return this.applyRotationQuaternionToRef(e,this)}applyRotationQuaternion(e){return this.applyRotationQuaternionToRef(e,new this.constructor)}scaleAndAddToRef(e,t){return t.addInPlaceFromFloats(this._x*e,this._y*e,this._z*e)}projectOnPlane(e,t){const i=new this.constructor;return this.projectOnPlaneToRef(e,t,i),i}projectOnPlaneToRef(e,t,i){const r=e.normal,s=e.d,o=Ae.Vector3[0];this.subtractToRef(t,o),o.normalize();const a=v.Dot(o,r);if(Math.abs(a)<1e-10)i.setAll(1/0);else{const l=-(v.Dot(t,r)+s)/a,h=o.scaleInPlace(l);t.addToRef(h,i)}return i}equals(e){return e&&this._x===e._x&&this._y===e._y&&this._z===e._z}equalsWithEpsilon(e,t=xt){return e&&Mi(this._x,e._x,t)&&Mi(this._y,e._y,t)&&Mi(this._z,e._z,t)}equalsToFloats(e,t,i){return this._x===e&&this._y===t&&this._z===i}multiplyInPlace(e){return this._x*=e._x,this._y*=e._y,this._z*=e._z,this._isDirty=!0,this}multiply(e){return this.multiplyByFloats(e._x,e._y,e._z)}multiplyToRef(e,t){return t.copyFromFloats(this._x*e._x,this._y*e._y,this._z*e._z)}multiplyByFloats(e,t,i){return new this.constructor(this._x*e,this._y*t,this._z*i)}divide(e){return new this.constructor(this._x/e._x,this._y/e._y,this._z/e._z)}divideToRef(e,t){return t.copyFromFloats(this._x/e._x,this._y/e._y,this._z/e._z)}divideInPlace(e){return this._x=this._x/e._x,this._y=this._y/e._y,this._z=this._z/e._z,this._isDirty=!0,this}minimizeInPlace(e){return this.minimizeInPlaceFromFloats(e._x,e._y,e._z)}maximizeInPlace(e){return this.maximizeInPlaceFromFloats(e._x,e._y,e._z)}minimizeInPlaceFromFloats(e,t,i){return e<this._x&&(this.x=e),t<this._y&&(this.y=t),i<this._z&&(this.z=i),this}maximizeInPlaceFromFloats(e,t,i){return e>this._x&&(this.x=e),t>this._y&&(this.y=t),i>this._z&&(this.z=i),this}isNonUniformWithinEpsilon(e){const t=Math.abs(this._x),i=Math.abs(this._y);if(!Mi(t,i,e))return!0;const r=Math.abs(this._z);return!Mi(t,r,e)||!Mi(i,r,e)}get isNonUniform(){const e=Math.abs(this._x),t=Math.abs(this._y);if(e!==t)return!0;const i=Math.abs(this._z);return e!==i}floorToRef(e){return e._x=Math.floor(this._x),e._y=Math.floor(this._y),e._z=Math.floor(this._z),e._isDirty=!0,e}floor(){return new this.constructor(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))}fractToRef(e){return e._x=this.x-Math.floor(this._x),e._y=this.y-Math.floor(this._y),e._z=this.z-Math.floor(this._z),e._isDirty=!0,e}fract(){return new this.constructor(this.x-Math.floor(this._x),this.y-Math.floor(this._y),this.z-Math.floor(this._z))}length(){return Math.sqrt(this.lengthSquared())}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z}get hasAZeroComponent(){return this._x*this._y*this._z===0}normalize(){return this.normalizeFromLength(this.length())}reorderInPlace(e){if(e=e.toLowerCase(),e==="xyz")return this;const t=Ae.Vector3[0].copyFrom(this);return this.x=t[e[0]],this.y=t[e[1]],this.z=t[e[2]],this}rotateByQuaternionToRef(e,t){return e.toRotationMatrix(Ae.Matrix[0]),v.TransformCoordinatesToRef(this,Ae.Matrix[0],t),t}rotateByQuaternionAroundPointToRef(e,t,i){return this.subtractToRef(t,Ae.Vector3[0]),Ae.Vector3[0].rotateByQuaternionToRef(e,Ae.Vector3[0]),t.addToRef(Ae.Vector3[0],i),i}cross(e){const t=new this.constructor;return v.CrossToRef(this,e,t)}normalizeFromLength(e){return e===0||e===1?this:this.scaleInPlace(1/e)}normalizeToNew(){const e=new this.constructor(0,0,0);return this.normalizeToRef(e),e}normalizeToRef(e){const t=this.length();return t===0||t===1?e.copyFrom(this):this.scaleToRef(1/t,e)}clone(){return new this.constructor(this._x,this._y,this._z)}copyFrom(e){return this.copyFromFloats(e._x,e._y,e._z)}copyFromFloats(e,t,i){return this._x=e,this._y=t,this._z=i,this._isDirty=!0,this}set(e,t,i){return this.copyFromFloats(e,t,i)}setAll(e){return this._x=this._y=this._z=e,this._isDirty=!0,this}static GetClipFactor(e,t,i,r){const s=v.Dot(e,i),o=v.Dot(t,i);return(s-r)/(s-o)}static GetAngleBetweenVectors(e,t,i){const r=e.normalizeToRef(Ae.Vector3[1]),s=t.normalizeToRef(Ae.Vector3[2]);let o=v.Dot(r,s);o=si(o,-1,1);const a=Math.acos(o),l=Ae.Vector3[3];return v.CrossToRef(r,s,l),v.Dot(l,i)>0?isNaN(a)?0:a:isNaN(a)?-Math.PI:-Math.acos(o)}static GetAngleBetweenVectorsOnPlane(e,t,i){Ae.Vector3[0].copyFrom(e);const r=Ae.Vector3[0];Ae.Vector3[1].copyFrom(t);const s=Ae.Vector3[1];Ae.Vector3[2].copyFrom(i);const o=Ae.Vector3[2],a=Ae.Vector3[3],l=Ae.Vector3[4];r.normalize(),s.normalize(),o.normalize(),v.CrossToRef(o,r,a),v.CrossToRef(a,o,l);const h=Math.atan2(v.Dot(s,a),v.Dot(s,l));return o0(h)}static PitchYawRollToMoveBetweenPointsToRef(e,t,i){const r=W.Vector3[0];return t.subtractToRef(e,r),i._y=Math.atan2(r.x,r.z)||0,i._x=Math.atan2(Math.sqrt(r.x**2+r.z**2),r.y)||0,i._z=0,i._isDirty=!0,i}static PitchYawRollToMoveBetweenPoints(e,t){const i=v.Zero();return v.PitchYawRollToMoveBetweenPointsToRef(e,t,i)}static SlerpToRef(e,t,i,r){i=si(i,0,1);const s=Ae.Vector3[0],o=Ae.Vector3[1];s.copyFrom(e);const a=s.length();s.normalizeFromLength(a),o.copyFrom(t);const l=o.length();o.normalizeFromLength(l);const h=v.Dot(s,o);let c,u;if(h<1-xt){const d=Math.acos(h),f=1/Math.sin(d);c=Math.sin((1-i)*d)*f,u=Math.sin(i*d)*f}else c=1-i,u=i;return s.scaleInPlace(c),o.scaleInPlace(u),r.copyFrom(s).addInPlace(o),r.scaleInPlace(n0(a,l,i)),r}static SmoothToRef(e,t,i,r,s){return v.SlerpToRef(e,t,r===0?1:i/r,s),s}static FromArray(e,t=0){return new v(e[t],e[t+1],e[t+2])}static FromFloatArray(e,t){return v.FromArray(e,t)}static FromArrayToRef(e,t,i){return i._x=e[t],i._y=e[t+1],i._z=e[t+2],i._isDirty=!0,i}static FromFloatArrayToRef(e,t,i){return v.FromArrayToRef(e,t,i)}static FromFloatsToRef(e,t,i,r){return r.copyFromFloats(e,t,i),r}static Zero(){return new v(0,0,0)}static One(){return new v(1,1,1)}static Up(){return new v(0,1,0)}static get UpReadOnly(){return v._UpReadOnly}static get DownReadOnly(){return v._DownReadOnly}static get RightReadOnly(){return v._RightReadOnly}static get LeftReadOnly(){return v._LeftReadOnly}static get LeftHandedForwardReadOnly(){return v._LeftHandedForwardReadOnly}static get RightHandedForwardReadOnly(){return v._RightHandedForwardReadOnly}static get LeftHandedBackwardReadOnly(){return v._LeftHandedBackwardReadOnly}static get RightHandedBackwardReadOnly(){return v._RightHandedBackwardReadOnly}static get ZeroReadOnly(){return v._ZeroReadOnly}static get OneReadOnly(){return v._OneReadOnly}static Down(){return new v(0,-1,0)}static Forward(e=!1){return new v(0,0,e?-1:1)}static Backward(e=!1){return new v(0,0,e?1:-1)}static Right(){return new v(1,0,0)}static Left(){return new v(-1,0,0)}static Random(e=0,t=1){return new v(jt(e,t),jt(e,t),jt(e,t))}static RandomToRef(e=0,t=1,i){return i.copyFromFloats(jt(e,t),jt(e,t),jt(e,t))}static TransformCoordinates(e,t){const i=v.Zero();return v.TransformCoordinatesToRef(e,t,i),i}static TransformCoordinatesToRef(e,t,i){return v.TransformCoordinatesFromFloatsToRef(e._x,e._y,e._z,t,i),i}static TransformCoordinatesFromFloatsToRef(e,t,i,r,s){const o=r.m,a=e*o[0]+t*o[4]+i*o[8]+o[12],l=e*o[1]+t*o[5]+i*o[9]+o[13],h=e*o[2]+t*o[6]+i*o[10]+o[14],c=1/(e*o[3]+t*o[7]+i*o[11]+o[15]);return s._x=a*c,s._y=l*c,s._z=h*c,s._isDirty=!0,s}static TransformNormal(e,t){const i=v.Zero();return v.TransformNormalToRef(e,t,i),i}static TransformNormalToRef(e,t,i){return this.TransformNormalFromFloatsToRef(e._x,e._y,e._z,t,i),i}static TransformNormalFromFloatsToRef(e,t,i,r,s){const o=r.m;return s._x=e*o[0]+t*o[4]+i*o[8],s._y=e*o[1]+t*o[5]+i*o[9],s._z=e*o[2]+t*o[6]+i*o[10],s._isDirty=!0,s}static CatmullRom(e,t,i,r,s){const o=s*s,a=s*o,l=.5*(2*t._x+(-e._x+i._x)*s+(2*e._x-5*t._x+4*i._x-r._x)*o+(-e._x+3*t._x-3*i._x+r._x)*a),h=.5*(2*t._y+(-e._y+i._y)*s+(2*e._y-5*t._y+4*i._y-r._y)*o+(-e._y+3*t._y-3*i._y+r._y)*a),c=.5*(2*t._z+(-e._z+i._z)*s+(2*e._z-5*t._z+4*i._z-r._z)*o+(-e._z+3*t._z-3*i._z+r._z)*a);return new e.constructor(l,h,c)}static Clamp(e,t,i){const r=new e.constructor;return v.ClampToRef(e,t,i,r),r}static ClampToRef(e,t,i,r){let s=e._x;s=s>i._x?i._x:s,s=s<t._x?t._x:s;let o=e._y;o=o>i._y?i._y:o,o=o<t._y?t._y:o;let a=e._z;return a=a>i._z?i._z:a,a=a<t._z?t._z:a,r.copyFromFloats(s,o,a),r}static CheckExtends(e,t,i){t.minimizeInPlace(e),i.maximizeInPlace(e)}static Hermite(e,t,i,r,s){const o=s*s,a=s*o,l=2*a-3*o+1,h=-2*a+3*o,c=a-2*o+s,u=a-o,d=e._x*l+i._x*h+t._x*c+r._x*u,f=e._y*l+i._y*h+t._y*c+r._y*u,p=e._z*l+i._z*h+t._z*c+r._z*u;return new e.constructor(d,f,p)}static Hermite1stDerivative(e,t,i,r,s){const o=new e.constructor;return this.Hermite1stDerivativeToRef(e,t,i,r,s,o),o}static Hermite1stDerivativeToRef(e,t,i,r,s,o){const a=s*s;return o._x=(a-s)*6*e._x+(3*a-4*s+1)*t._x+(-a+s)*6*i._x+(3*a-2*s)*r._x,o._y=(a-s)*6*e._y+(3*a-4*s+1)*t._y+(-a+s)*6*i._y+(3*a-2*s)*r._y,o._z=(a-s)*6*e._z+(3*a-4*s+1)*t._z+(-a+s)*6*i._z+(3*a-2*s)*r._z,o._isDirty=!0,o}static Lerp(e,t,i){const r=new e.constructor(0,0,0);return v.LerpToRef(e,t,i,r),r}static LerpToRef(e,t,i,r){return r._x=e._x+(t._x-e._x)*i,r._y=e._y+(t._y-e._y)*i,r._z=e._z+(t._z-e._z)*i,r._isDirty=!0,r}static Dot(e,t){return e._x*t._x+e._y*t._y+e._z*t._z}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z}static Cross(e,t){const i=new e.constructor;return v.CrossToRef(e,t,i),i}static CrossToRef(e,t,i){const r=e._y*t._z-e._z*t._y,s=e._z*t._x-e._x*t._z,o=e._x*t._y-e._y*t._x;return i.copyFromFloats(r,s,o),i}static Normalize(e){const t=v.Zero();return v.NormalizeToRef(e,t),t}static NormalizeToRef(e,t){return e.normalizeToRef(t),t}static Project(e,t,i,r){const s=new e.constructor;return v.ProjectToRef(e,t,i,r,s),s}static ProjectToRef(e,t,i,r,s){const o=r.width,a=r.height,l=r.x,h=r.y,c=Ae.Matrix[1];U.FromValuesToRef(o/2,0,0,0,0,-a/2,0,0,0,0,.5,0,l+o/2,a/2+h,.5,1,c);const u=Ae.Matrix[0];return t.multiplyToRef(i,u),u.multiplyToRef(c,u),v.TransformCoordinatesToRef(e,u,s),s}static Reflect(e,t){return this.ReflectToRef(e,t,new v)}static ReflectToRef(e,t,i){const r=W.Vector3[0];return r.copyFrom(t).scaleInPlace(2*v.Dot(e,t)),i.copyFrom(e).subtractInPlace(r)}static _UnprojectFromInvertedMatrixToRef(e,t,i){v.TransformCoordinatesToRef(e,t,i);const r=t.m,s=e._x*r[3]+e._y*r[7]+e._z*r[11]+r[15];return Mi(s,1)&&i.scaleInPlace(1/s),i}static UnprojectFromTransform(e,t,i,r,s){return this.Unproject(e,t,i,r,s,U.IdentityReadOnly)}static Unproject(e,t,i,r,s,o){const a=new e.constructor;return v.UnprojectToRef(e,t,i,r,s,o,a),a}static UnprojectToRef(e,t,i,r,s,o,a){return v.UnprojectFloatsToRef(e._x,e._y,e._z,t,i,r,s,o,a),a}static UnprojectFloatsToRef(e,t,i,r,s,o,a,l,h){var c;const u=Ae.Matrix[0];o.multiplyToRef(a,u),u.multiplyToRef(l,u),u.invert();const d=Ae.Vector3[0];return d.x=e/r*2-1,d.y=-(t/s*2-1),(c=rt.LastCreatedEngine)!=null&&c.isNDCHalfZRange?d.z=i:d.z=2*i-1,v._UnprojectFromInvertedMatrixToRef(d,u,h),h}static Minimize(e,t){const i=new e.constructor;return i.copyFrom(e),i.minimizeInPlace(t),i}static Maximize(e,t){const i=new e.constructor;return i.copyFrom(e),i.maximizeInPlace(t),i}static Distance(e,t){return Math.sqrt(v.DistanceSquared(e,t))}static DistanceSquared(e,t){const i=e._x-t._x,r=e._y-t._y,s=e._z-t._z;return i*i+r*r+s*s}static ProjectOnTriangleToRef(e,t,i,r,s){const o=Ae.Vector3[0],a=Ae.Vector3[1],l=Ae.Vector3[2],h=Ae.Vector3[3],c=Ae.Vector3[4];i.subtractToRef(t,o),r.subtractToRef(t,a),r.subtractToRef(i,l);const u=o.length(),d=a.length(),f=l.length();if(u<xt||d<xt||f<xt)return s.copyFrom(t),v.Distance(e,t);e.subtractToRef(t,c),v.CrossToRef(o,a,h);const p=h.length();if(p<xt)return s.copyFrom(t),v.Distance(e,t);h.normalizeFromLength(p);let g=c.length();if(g<xt)return s.copyFrom(t),0;c.normalizeFromLength(g);const m=v.Dot(h,c),x=Ae.Vector3[5],E=Ae.Vector3[6];x.copyFrom(h).scaleInPlace(-g*m),E.copyFrom(e).addInPlace(x);const R=Ae.Vector3[4],C=Ae.Vector3[5],_=Ae.Vector3[7],T=Ae.Vector3[8];R.copyFrom(o).scaleInPlace(1/u),T.copyFrom(a).scaleInPlace(1/d),R.addInPlace(T).scaleInPlace(-1),C.copyFrom(o).scaleInPlace(-1/u),T.copyFrom(l).scaleInPlace(1/f),C.addInPlace(T).scaleInPlace(-1),_.copyFrom(l).scaleInPlace(-1/f),T.copyFrom(a).scaleInPlace(-1/d),_.addInPlace(T).scaleInPlace(-1);const y=Ae.Vector3[9];let P;y.copyFrom(E).subtractInPlace(t),v.CrossToRef(R,y,T),P=v.Dot(T,h);const D=P;y.copyFrom(E).subtractInPlace(i),v.CrossToRef(C,y,T),P=v.Dot(T,h);const F=P;y.copyFrom(E).subtractInPlace(r),v.CrossToRef(_,y,T),P=v.Dot(T,h);const N=P,G=Ae.Vector3[10];let J,j;D>0&&F<0?(G.copyFrom(o),J=t,j=i):F>0&&N<0?(G.copyFrom(l),J=i,j=r):(G.copyFrom(a).scaleInPlace(-1),J=r,j=t);const z=Ae.Vector3[9],$=Ae.Vector3[4];if(J.subtractToRef(E,T),j.subtractToRef(E,z),v.CrossToRef(T,z,$),!(v.Dot($,h)<0))return s.copyFrom(E),Math.abs(g*m);const te=Ae.Vector3[5];v.CrossToRef(G,$,te),te.normalize();const fe=Ae.Vector3[9];fe.copyFrom(J).subtractInPlace(E);const Z=fe.length();if(Z<xt)return s.copyFrom(J),v.Distance(e,J);fe.normalizeFromLength(Z);const L=v.Dot(te,fe),w=Ae.Vector3[7];w.copyFrom(E).addInPlace(te.scaleInPlace(Z*L)),T.copyFrom(w).subtractInPlace(J),g=G.length(),G.normalizeFromLength(g);let H=v.Dot(T,G)/Math.max(g,xt);return H=si(H,0,1),w.copyFrom(J).addInPlace(G.scaleInPlace(H*g)),s.copyFrom(w),v.Distance(e,w)}static Center(e,t){return v.CenterToRef(e,t,v.Zero())}static CenterToRef(e,t,i){return i.copyFromFloats((e._x+t._x)/2,(e._y+t._y)/2,(e._z+t._z)/2)}static RotationFromAxis(e,t,i){const r=new e.constructor;return v.RotationFromAxisToRef(e,t,i,r),r}static RotationFromAxisToRef(e,t,i,r){const s=Ae.Quaternion[0];return Re.RotationQuaternionFromAxisToRef(e,t,i,s),s.toEulerAnglesToRef(r),r}}v._UpReadOnly=v.Up();v._DownReadOnly=v.Down();v._LeftHandedForwardReadOnly=v.Forward(!1);v._RightHandedForwardReadOnly=v.Forward(!0);v._LeftHandedBackwardReadOnly=v.Backward(!1);v._RightHandedBackwardReadOnly=v.Backward(!0);v._RightReadOnly=v.Right();v._LeftReadOnly=v.Left();v._ZeroReadOnly=v.Zero();v._OneReadOnly=v.One();Object.defineProperties(v.prototype,{dimension:{value:[3]},rank:{value:1}});class Ke{constructor(e=0,t=0,i=0,r=0){this.x=e,this.y=t,this.z=i,this.w=r}toString(){return`{X: ${this.x} Y: ${this.y} Z: ${this.z} W: ${this.w}}`}getClassName(){return"Vector4"}getHashCode(){const e=cr(this.x),t=cr(this.y),i=cr(this.z),r=cr(this.w);let s=e;return s=s*397^t,s=s*397^i,s=s*397^r,s}asArray(){return[this.x,this.y,this.z,this.w]}toArray(e,t){return t===void 0&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,this}fromArray(e,t=0){return Ke.FromArrayToRef(e,t,this),this}addInPlace(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addInPlaceFromFloats(e,t,i,r){return this.x+=e,this.y+=t,this.z+=i,this.w+=r,this}add(e){return new this.constructor(this.x+e.x,this.y+e.y,this.z+e.z,this.w+e.w)}addToRef(e,t){return t.x=this.x+e.x,t.y=this.y+e.y,t.z=this.z+e.z,t.w=this.w+e.w,t}subtractInPlace(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subtract(e){return new this.constructor(this.x-e.x,this.y-e.y,this.z-e.z,this.w-e.w)}subtractToRef(e,t){return t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z,t.w=this.w-e.w,t}subtractFromFloats(e,t,i,r){return new this.constructor(this.x-e,this.y-t,this.z-i,this.w-r)}subtractFromFloatsToRef(e,t,i,r,s){return s.x=this.x-e,s.y=this.y-t,s.z=this.z-i,s.w=this.w-r,s}negate(){return new this.constructor(-this.x,-this.y,-this.z,-this.w)}negateInPlace(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this}negateToRef(e){return e.copyFromFloats(this.x*-1,this.y*-1,this.z*-1,this.w*-1)}scaleInPlace(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}scale(e){return new this.constructor(this.x*e,this.y*e,this.z*e,this.w*e)}scaleToRef(e,t){return t.x=this.x*e,t.y=this.y*e,t.z=this.z*e,t.w=this.w*e,t}scaleAndAddToRef(e,t){return t.x+=this.x*e,t.y+=this.y*e,t.z+=this.z*e,t.w+=this.w*e,t}equals(e){return e&&this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w}equalsWithEpsilon(e,t=xt){return e&&Mi(this.x,e.x,t)&&Mi(this.y,e.y,t)&&Mi(this.z,e.z,t)&&Mi(this.w,e.w,t)}equalsToFloats(e,t,i,r){return this.x===e&&this.y===t&&this.z===i&&this.w===r}multiplyInPlace(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiply(e){return new this.constructor(this.x*e.x,this.y*e.y,this.z*e.z,this.w*e.w)}multiplyToRef(e,t){return t.x=this.x*e.x,t.y=this.y*e.y,t.z=this.z*e.z,t.w=this.w*e.w,t}multiplyByFloats(e,t,i,r){return new this.constructor(this.x*e,this.y*t,this.z*i,this.w*r)}divide(e){return new this.constructor(this.x/e.x,this.y/e.y,this.z/e.z,this.w/e.w)}divideToRef(e,t){return t.x=this.x/e.x,t.y=this.y/e.y,t.z=this.z/e.z,t.w=this.w/e.w,t}divideInPlace(e){return this.divideToRef(e,this)}minimizeInPlace(e){return e.x<this.x&&(this.x=e.x),e.y<this.y&&(this.y=e.y),e.z<this.z&&(this.z=e.z),e.w<this.w&&(this.w=e.w),this}maximizeInPlace(e){return e.x>this.x&&(this.x=e.x),e.y>this.y&&(this.y=e.y),e.z>this.z&&(this.z=e.z),e.w>this.w&&(this.w=e.w),this}minimizeInPlaceFromFloats(e,t,i,r){return this.x=Math.min(e,this.x),this.y=Math.min(t,this.y),this.z=Math.min(i,this.z),this.w=Math.min(r,this.w),this}maximizeInPlaceFromFloats(e,t,i,r){return this.x=Math.max(e,this.x),this.y=Math.max(t,this.y),this.z=Math.max(i,this.z),this.w=Math.max(r,this.w),this}floorToRef(e){return e.x=Math.floor(this.x),e.y=Math.floor(this.y),e.z=Math.floor(this.z),e.w=Math.floor(this.w),e}floor(){return new this.constructor(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))}fractToRef(e){return e.x=this.x-Math.floor(this.x),e.y=this.y-Math.floor(this.y),e.z=this.z-Math.floor(this.z),e.w=this.w-Math.floor(this.w),e}fract(){return new this.constructor(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z),this.w-Math.floor(this.w))}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(e){return e===0||e===1?this:this.scaleInPlace(1/e)}normalizeToNew(){const e=new this.constructor;return this.normalizeToRef(e),e}normalizeToRef(e){const t=this.length();return t===0||t===1?e.copyFrom(this):this.scaleToRef(1/t,e)}toVector3(){return new v(this.x,this.y,this.z)}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copyFrom(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}copyFromFloats(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this}set(e,t,i,r){return this.copyFromFloats(e,t,i,r)}setAll(e){return this.x=this.y=this.z=this.w=e,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}static FromArray(e,t){return t||(t=0),new Ke(e[t],e[t+1],e[t+2],e[t+3])}static FromArrayToRef(e,t,i){return i.x=e[t],i.y=e[t+1],i.z=e[t+2],i.w=e[t+3],i}static FromFloatArrayToRef(e,t,i){return Ke.FromArrayToRef(e,t,i),i}static FromFloatsToRef(e,t,i,r,s){return s.x=e,s.y=t,s.z=i,s.w=r,s}static Zero(){return new Ke(0,0,0,0)}static One(){return new Ke(1,1,1,1)}static Random(e=0,t=1){return new Ke(jt(e,t),jt(e,t),jt(e,t),jt(e,t))}static RandomToRef(e=0,t=1,i){return i.copyFromFloats(jt(e,t),jt(e,t),jt(e,t),jt(e,t))}static Clamp(e,t,i){const r=new e.constructor;return Ke.ClampToRef(e,t,i,r),r}static ClampToRef(e,t,i,r){return r.copyFromFloats(si(e.x,t.x,i.x),si(e.y,t.y,i.y),si(e.z,t.z,i.z),si(e.w,t.w,i.w))}static CheckExtends(e,t,i){t.minimizeInPlace(e),i.maximizeInPlace(e)}static get ZeroReadOnly(){return Ke._ZeroReadOnly}static Normalize(e){const t=Ke.Zero();return Ke.NormalizeToRef(e,t),t}static NormalizeToRef(e,t){return e.normalizeToRef(t),t}static Minimize(e,t){const i=new e.constructor;return i.copyFrom(e),i.minimizeInPlace(t),i}static Maximize(e,t){const i=new e.constructor;return i.copyFrom(e),i.maximizeInPlace(t),i}static Distance(e,t){return Math.sqrt(Ke.DistanceSquared(e,t))}static DistanceSquared(e,t){const i=e.x-t.x,r=e.y-t.y,s=e.z-t.z,o=e.w-t.w;return i*i+r*r+s*s+o*o}static Center(e,t){return Ke.CenterToRef(e,t,Ke.Zero())}static CenterToRef(e,t,i){return i.copyFromFloats((e.x+t.x)/2,(e.y+t.y)/2,(e.z+t.z)/2,(e.w+t.w)/2)}static TransformCoordinates(e,t){const i=Ke.Zero();return Ke.TransformCoordinatesToRef(e,t,i),i}static TransformCoordinatesToRef(e,t,i){return Ke.TransformCoordinatesFromFloatsToRef(e._x,e._y,e._z,t,i),i}static TransformCoordinatesFromFloatsToRef(e,t,i,r,s){const o=r.m,a=e*o[0]+t*o[4]+i*o[8]+o[12],l=e*o[1]+t*o[5]+i*o[9]+o[13],h=e*o[2]+t*o[6]+i*o[10]+o[14],c=e*o[3]+t*o[7]+i*o[11]+o[15];return s.x=a,s.y=l,s.z=h,s.w=c,s}static TransformNormal(e,t){const i=new e.constructor;return Ke.TransformNormalToRef(e,t,i),i}static TransformNormalToRef(e,t,i){const r=t.m,s=e.x*r[0]+e.y*r[4]+e.z*r[8],o=e.x*r[1]+e.y*r[5]+e.z*r[9],a=e.x*r[2]+e.y*r[6]+e.z*r[10];return i.x=s,i.y=o,i.z=a,i.w=e.w,i}static TransformNormalFromFloatsToRef(e,t,i,r,s,o){const a=s.m;return o.x=e*a[0]+t*a[4]+i*a[8],o.y=e*a[1]+t*a[5]+i*a[9],o.z=e*a[2]+t*a[6]+i*a[10],o.w=r,o}static FromVector3(e,t=0){return new Ke(e._x,e._y,e._z,t)}static Dot(e,t){return e.dot(t)}}Ke._ZeroReadOnly=Ke.Zero();Object.defineProperties(Ke.prototype,{dimension:{value:[4]},rank:{value:1}});class Re{get x(){return this._x}set x(e){this._x=e,this._isDirty=!0}get y(){return this._y}set y(e){this._y=e,this._isDirty=!0}get z(){return this._z}set z(e){this._z=e,this._isDirty=!0}get w(){return this._w}set w(e){this._w=e,this._isDirty=!0}constructor(e=0,t=0,i=0,r=1){this._isDirty=!0,this._x=e,this._y=t,this._z=i,this._w=r}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z} W: ${this._w}}`}getClassName(){return"Quaternion"}getHashCode(){const e=cr(this._x),t=cr(this._y),i=cr(this._z),r=cr(this._w);let s=e;return s=s*397^t,s=s*397^i,s=s*397^r,s}asArray(){return[this._x,this._y,this._z,this._w]}toArray(e,t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,this}fromArray(e,t=0){return Re.FromArrayToRef(e,t,this)}equals(e){return e&&this._x===e._x&&this._y===e._y&&this._z===e._z&&this._w===e._w}equalsWithEpsilon(e,t=xt){return e&&Mi(this._x,e._x,t)&&Mi(this._y,e._y,t)&&Mi(this._z,e._z,t)&&Mi(this._w,e._w,t)}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copyFrom(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._w=e._w,this._isDirty=!0,this}copyFromFloats(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this._isDirty=!0,this}set(e,t,i,r){return this.copyFromFloats(e,t,i,r)}setAll(e){return this.copyFromFloats(e,e,e,e)}add(e){return new this.constructor(this._x+e._x,this._y+e._y,this._z+e._z,this._w+e._w)}addInPlace(e){return this._x+=e._x,this._y+=e._y,this._z+=e._z,this._w+=e._w,this._isDirty=!0,this}addToRef(e,t){return t._x=this._x+e._x,t._y=this._y+e._y,t._z=this._z+e._z,t._w=this._w+e._w,t._isDirty=!0,t}addInPlaceFromFloats(e,t,i,r){return this._x+=e,this._y+=t,this._z+=i,this._w+=r,this._isDirty=!0,this}subtractToRef(e,t){return t._x=this._x-e._x,t._y=this._y-e._y,t._z=this._z-e._z,t._w=this._w-e._w,t._isDirty=!0,t}subtractFromFloats(e,t,i,r){return this.subtractFromFloatsToRef(e,t,i,r,new this.constructor)}subtractFromFloatsToRef(e,t,i,r,s){return s._x=this._x-e,s._y=this._y-t,s._z=this._z-i,s._w=this._w-r,s._isDirty=!0,s}subtract(e){return new this.constructor(this._x-e._x,this._y-e._y,this._z-e._z,this._w-e._w)}subtractInPlace(e){return this._x-=e._x,this._y-=e._y,this._z-=e._z,this._w-=e._w,this._isDirty=!0,this}scale(e){return new this.constructor(this._x*e,this._y*e,this._z*e,this._w*e)}scaleToRef(e,t){return t._x=this._x*e,t._y=this._y*e,t._z=this._z*e,t._w=this._w*e,t._isDirty=!0,t}scaleInPlace(e){return this._x*=e,this._y*=e,this._z*=e,this._w*=e,this._isDirty=!0,this}scaleAndAddToRef(e,t){return t._x+=this._x*e,t._y+=this._y*e,t._z+=this._z*e,t._w+=this._w*e,t._isDirty=!0,t}multiply(e){const t=new this.constructor(0,0,0,1);return this.multiplyToRef(e,t),t}multiplyToRef(e,t){const i=this._x*e._w+this._y*e._z-this._z*e._y+this._w*e._x,r=-this._x*e._z+this._y*e._w+this._z*e._x+this._w*e._y,s=this._x*e._y-this._y*e._x+this._z*e._w+this._w*e._z,o=-this._x*e._x-this._y*e._y-this._z*e._z+this._w*e._w;return t.copyFromFloats(i,r,s,o),t}multiplyInPlace(e){return this.multiplyToRef(e,this)}multiplyByFloats(e,t,i,r){return this._x*=e,this._y*=t,this._z*=i,this._w*=r,this._isDirty=!0,this}divide(e){throw new ReferenceError("Can not divide a quaternion")}divideToRef(e,t){throw new ReferenceError("Can not divide a quaternion")}divideInPlace(e){throw new ReferenceError("Can not divide a quaternion")}minimizeInPlace(){throw new ReferenceError("Can not minimize a quaternion")}minimizeInPlaceFromFloats(){throw new ReferenceError("Can not minimize a quaternion")}maximizeInPlace(){throw new ReferenceError("Can not maximize a quaternion")}maximizeInPlaceFromFloats(){throw new ReferenceError("Can not maximize a quaternion")}negate(){return this.negateToRef(new this.constructor)}negateInPlace(){return this._x=-this._x,this._y=-this._y,this._z=-this._z,this._w=-this._w,this._isDirty=!0,this}negateToRef(e){return e._x=-this._x,e._y=-this._y,e._z=-this._z,e._w=-this._w,e._isDirty=!0,e}equalsToFloats(e,t,i,r){return this._x===e&&this._y===t&&this._z===i&&this._w===r}floorToRef(e){throw new ReferenceError("Can not floor a quaternion")}floor(){throw new ReferenceError("Can not floor a quaternion")}fractToRef(e){throw new ReferenceError("Can not fract a quaternion")}fract(){throw new ReferenceError("Can not fract a quaternion")}conjugateToRef(e){return e.copyFromFloats(-this._x,-this._y,-this._z,this._w),e}conjugateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}conjugate(){return new this.constructor(-this._x,-this._y,-this._z,this._w)}invert(){const e=this.conjugate(),t=this.lengthSquared();return t==0||t==1||e.scaleInPlace(1/t),e}invertInPlace(){this.conjugateInPlace();const e=this.lengthSquared();return e==0||e==1?this:(this.scaleInPlace(1/e),this)}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this.lengthSquared())}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(e){return e===0||e===1?this:this.scaleInPlace(1/e)}normalizeToNew(){const e=new this.constructor(0,0,0,1);return this.normalizeToRef(e),e}normalizeToRef(e){const t=this.length();return t===0||t===1?e.copyFromFloats(this._x,this._y,this._z,this._w):this.scaleToRef(1/t,e)}toEulerAngles(){const e=v.Zero();return this.toEulerAnglesToRef(e),e}toEulerAnglesToRef(e){const t=this._z,i=this._x,r=this._y,s=this._w,o=r*t-i*s,a=.4999999;if(o<-a)e._y=2*Math.atan2(r,s),e._x=Math.PI/2,e._z=0,e._isDirty=!0;else if(o>a)e._y=2*Math.atan2(r,s),e._x=-Math.PI/2,e._z=0,e._isDirty=!0;else{const l=s*s,h=t*t,c=i*i,u=r*r;e._z=Math.atan2(2*(i*r+t*s),-h-c+u+l),e._x=Math.asin(-2*o),e._y=Math.atan2(2*(t*i+r*s),h-c-u+l),e._isDirty=!0}return e}toRotationMatrix(e){return U.FromQuaternionToRef(this,e),e}fromRotationMatrix(e){return Re.FromRotationMatrixToRef(e,this),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}static FromRotationMatrix(e){const t=new Re;return Re.FromRotationMatrixToRef(e,t),t}static FromRotationMatrixToRef(e,t){const i=e.m,r=i[0],s=i[4],o=i[8],a=i[1],l=i[5],h=i[9],c=i[2],u=i[6],d=i[10],f=r+l+d;let p;return f>0?(p=.5/Math.sqrt(f+1),t._w=.25/p,t._x=(u-h)*p,t._y=(o-c)*p,t._z=(a-s)*p,t._isDirty=!0):r>l&&r>d?(p=2*Math.sqrt(1+r-l-d),t._w=(u-h)/p,t._x=.25*p,t._y=(s+a)/p,t._z=(o+c)/p,t._isDirty=!0):l>d?(p=2*Math.sqrt(1+l-r-d),t._w=(o-c)/p,t._x=(s+a)/p,t._y=.25*p,t._z=(h+u)/p,t._isDirty=!0):(p=2*Math.sqrt(1+d-r-l),t._w=(a-s)/p,t._x=(o+c)/p,t._y=(h+u)/p,t._z=.25*p,t._isDirty=!0),t}static Dot(e,t){return e._x*t._x+e._y*t._y+e._z*t._z+e._w*t._w}static AreClose(e,t,i=.1){const r=Re.Dot(e,t);return 1-r*r<=i}static SmoothToRef(e,t,i,r,s){let o=r===0?1:i/r;return o=si(o,0,1),Re.SlerpToRef(e,t,o,s),s}static Zero(){return new Re(0,0,0,0)}static Inverse(e){return new e.constructor(-e._x,-e._y,-e._z,e._w)}static InverseToRef(e,t){return t.set(-e._x,-e._y,-e._z,e._w),t}static Identity(){return new Re(0,0,0,1)}static IsIdentity(e){return e&&e._x===0&&e._y===0&&e._z===0&&e._w===1}static RotationAxis(e,t){return Re.RotationAxisToRef(e,t,new Re)}static RotationAxisToRef(e,t,i){const r=Math.sin(t/2);return e.normalize(),i._w=Math.cos(t/2),i._x=e._x*r,i._y=e._y*r,i._z=e._z*r,i._isDirty=!0,i}static FromArray(e,t){return t||(t=0),new Re(e[t],e[t+1],e[t+2],e[t+3])}static FromArrayToRef(e,t,i){return i._x=e[t],i._y=e[t+1],i._z=e[t+2],i._w=e[t+3],i._isDirty=!0,i}static FromFloatsToRef(e,t,i,r,s){return s.copyFromFloats(e,t,i,r),s}static FromEulerAngles(e,t,i){const r=new Re;return Re.RotationYawPitchRollToRef(t,e,i,r),r}static FromEulerAnglesToRef(e,t,i,r){return Re.RotationYawPitchRollToRef(t,e,i,r),r}static FromEulerVector(e){const t=new Re;return Re.RotationYawPitchRollToRef(e._y,e._x,e._z,t),t}static FromEulerVectorToRef(e,t){return Re.RotationYawPitchRollToRef(e._y,e._x,e._z,t),t}static FromUnitVectorsToRef(e,t,i,r=xt){const s=v.Dot(e,t)+1;return s<r?Math.abs(e.x)>Math.abs(e.z)?i.set(-e.y,e.x,0,0):i.set(0,-e.z,e.y,0):(v.CrossToRef(e,t,W.Vector3[0]),i.set(W.Vector3[0].x,W.Vector3[0].y,W.Vector3[0].z,s)),i.normalize()}static RotationYawPitchRoll(e,t,i){const r=new Re;return Re.RotationYawPitchRollToRef(e,t,i,r),r}static RotationYawPitchRollToRef(e,t,i,r){const s=i*.5,o=t*.5,a=e*.5,l=Math.sin(s),h=Math.cos(s),c=Math.sin(o),u=Math.cos(o),d=Math.sin(a),f=Math.cos(a);return r._x=f*c*h+d*u*l,r._y=d*u*h-f*c*l,r._z=f*u*l-d*c*h,r._w=f*u*h+d*c*l,r._isDirty=!0,r}static RotationAlphaBetaGamma(e,t,i){const r=new Re;return Re.RotationAlphaBetaGammaToRef(e,t,i,r),r}static RotationAlphaBetaGammaToRef(e,t,i,r){const s=(i+e)*.5,o=(i-e)*.5,a=t*.5;return r._x=Math.cos(o)*Math.sin(a),r._y=Math.sin(o)*Math.sin(a),r._z=Math.sin(s)*Math.cos(a),r._w=Math.cos(s)*Math.cos(a),r._isDirty=!0,r}static RotationQuaternionFromAxis(e,t,i){const r=new Re(0,0,0,0);return Re.RotationQuaternionFromAxisToRef(e,t,i,r),r}static RotationQuaternionFromAxisToRef(e,t,i,r){const s=Ae.Matrix[0];return U.FromXYZAxesToRef(e.normalize(),t.normalize(),i.normalize(),s),Re.FromRotationMatrixToRef(s,r),r}static FromLookDirectionLH(e,t){const i=new Re;return Re.FromLookDirectionLHToRef(e,t,i),i}static FromLookDirectionLHToRef(e,t,i){const r=Ae.Matrix[0];return U.LookDirectionLHToRef(e,t,r),Re.FromRotationMatrixToRef(r,i),i}static FromLookDirectionRH(e,t){const i=new Re;return Re.FromLookDirectionRHToRef(e,t,i),i}static FromLookDirectionRHToRef(e,t,i){const r=Ae.Matrix[0];return U.LookDirectionRHToRef(e,t,r),Re.FromRotationMatrixToRef(r,i)}static Slerp(e,t,i){const r=Re.Identity();return Re.SlerpToRef(e,t,i,r),r}static SlerpToRef(e,t,i,r){let s,o,a=e._x*t._x+e._y*t._y+e._z*t._z+e._w*t._w,l=!1;if(a<0&&(l=!0,a=-a),a>.999999)o=1-i,s=l?-i:i;else{const h=Math.acos(a),c=1/Math.sin(h);o=Math.sin((1-i)*h)*c,s=l?-Math.sin(i*h)*c:Math.sin(i*h)*c}return r._x=o*e._x+s*t._x,r._y=o*e._y+s*t._y,r._z=o*e._z+s*t._z,r._w=o*e._w+s*t._w,r._isDirty=!0,r}static Hermite(e,t,i,r,s){const o=s*s,a=s*o,l=2*a-3*o+1,h=-2*a+3*o,c=a-2*o+s,u=a-o,d=e._x*l+i._x*h+t._x*c+r._x*u,f=e._y*l+i._y*h+t._y*c+r._y*u,p=e._z*l+i._z*h+t._z*c+r._z*u,g=e._w*l+i._w*h+t._w*c+r._w*u;return new e.constructor(d,f,p,g)}static Hermite1stDerivative(e,t,i,r,s){const o=new e.constructor;return this.Hermite1stDerivativeToRef(e,t,i,r,s,o),o}static Hermite1stDerivativeToRef(e,t,i,r,s,o){const a=s*s;return o._x=(a-s)*6*e._x+(3*a-4*s+1)*t._x+(-a+s)*6*i._x+(3*a-2*s)*r._x,o._y=(a-s)*6*e._y+(3*a-4*s+1)*t._y+(-a+s)*6*i._y+(3*a-2*s)*r._y,o._z=(a-s)*6*e._z+(3*a-4*s+1)*t._z+(-a+s)*6*i._z+(3*a-2*s)*r._z,o._w=(a-s)*6*e._w+(3*a-4*s+1)*t._w+(-a+s)*6*i._w+(3*a-2*s)*r._w,o._isDirty=!0,o}static Normalize(e){const t=Re.Zero();return Re.NormalizeToRef(e,t),t}static NormalizeToRef(e,t){return e.normalizeToRef(t),t}static Clamp(e,t,i){const r=new e.constructor;return Re.ClampToRef(e,t,i,r),r}static ClampToRef(e,t,i,r){return r.copyFromFloats(si(e.x,t.x,i.x),si(e.y,t.y,i.y),si(e.z,t.z,i.z),si(e.w,t.w,i.w))}static Random(e=0,t=1){return new Re(jt(e,t),jt(e,t),jt(e,t),jt(e,t))}static RandomToRef(e=0,t=1,i){return i.copyFromFloats(jt(e,t),jt(e,t),jt(e,t),jt(e,t))}static Minimize(){throw new ReferenceError("Quaternion.Minimize does not make sense")}static Maximize(){throw new ReferenceError("Quaternion.Maximize does not make sense")}static Distance(e,t){return Math.sqrt(Re.DistanceSquared(e,t))}static DistanceSquared(e,t){const i=e.x-t.x,r=e.y-t.y,s=e.z-t.z,o=e.w-t.w;return i*i+r*r+s*s+o*o}static Center(e,t){return Re.CenterToRef(e,t,Re.Zero())}static CenterToRef(e,t,i){return i.copyFromFloats((e.x+t.x)/2,(e.y+t.y)/2,(e.z+t.z)/2,(e.w+t.w)/2)}}Object.defineProperties(Re.prototype,{dimension:{value:[4]},rank:{value:1}});class U{static get Use64Bits(){return vi.MatrixUse64Bits}get m(){return this._m}markAsUpdated(){this.updateFlag=U._UpdateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0}_updateIdentityStatus(e,t=!1,i=!1,r=!0){this._isIdentity=e,this._isIdentity3x2=e||i,this._isIdentityDirty=this._isIdentity?!1:t,this._isIdentity3x2Dirty=this._isIdentity3x2?!1:r}constructor(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this.updateFlag=-1,vi.MatrixTrackPrecisionChange&&vi.MatrixTrackedMatrices.push(this),this._m=new vi.MatrixCurrentType(16),this.markAsUpdated()}isIdentity(){if(this._isIdentityDirty){this._isIdentityDirty=!1;const e=this._m;this._isIdentity=e[0]===1&&e[1]===0&&e[2]===0&&e[3]===0&&e[4]===0&&e[5]===1&&e[6]===0&&e[7]===0&&e[8]===0&&e[9]===0&&e[10]===1&&e[11]===0&&e[12]===0&&e[13]===0&&e[14]===0&&e[15]===1}return this._isIdentity}isIdentityAs3x2(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,this._m[0]!==1||this._m[5]!==1||this._m[15]!==1?this._isIdentity3x2=!1:this._m[1]!==0||this._m[2]!==0||this._m[3]!==0||this._m[4]!==0||this._m[6]!==0||this._m[7]!==0||this._m[8]!==0||this._m[9]!==0||this._m[10]!==0||this._m[11]!==0||this._m[12]!==0||this._m[13]!==0||this._m[14]!==0?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2}determinant(){if(this._isIdentity===!0)return 1;const e=this._m,t=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],h=e[7],c=e[8],u=e[9],d=e[10],f=e[11],p=e[12],g=e[13],m=e[14],x=e[15],E=d*x-m*f,R=u*x-g*f,C=u*m-g*d,_=c*x-p*f,T=c*m-d*p,y=c*g-p*u,P=+(a*E-l*R+h*C),D=-(o*E-l*_+h*T),F=+(o*R-a*_+h*y),N=-(o*C-a*T+l*y);return t*P+i*D+r*F+s*N}toString(){return`{${this.m[0]}, ${this.m[1]}, ${this.m[2]}, ${this.m[3]}
${this.m[4]}, ${this.m[5]}, ${this.m[6]}, ${this.m[7]}
${this.m[8]}, ${this.m[9]}, ${this.m[10]}, ${this.m[11]}
${this.m[12]}, ${this.m[13]}, ${this.m[14]}, ${this.m[15]}}`}toArray(e=null,t=0){if(!e)return this._m;const i=this._m;for(let r=0;r<16;r++)e[t+r]=i[r];return this}asArray(){return this._m}fromArray(e,t=0){return U.FromArrayToRef(e,t,this)}copyFromFloats(...e){return U.FromArrayToRef(e,0,this)}set(...e){const t=this._m;for(let i=0;i<16;i++)t[i]=e[i];return this.markAsUpdated(),this}setAll(e){const t=this._m;for(let i=0;i<16;i++)t[i]=e;return this.markAsUpdated(),this}invert(){return this.invertToRef(this),this}reset(){return U.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this}add(e){const t=new this.constructor;return this.addToRef(e,t),t}addToRef(e,t){const i=this._m,r=t._m,s=e.m;for(let o=0;o<16;o++)r[o]=i[o]+s[o];return t.markAsUpdated(),t}addToSelf(e){const t=this._m,i=e.m;for(let r=0;r<16;r++)t[r]+=i[r];return this.markAsUpdated(),this}addInPlace(e){const t=this._m,i=e.m;for(let r=0;r<16;r++)t[r]+=i[r];return this.markAsUpdated(),this}addInPlaceFromFloats(...e){const t=this._m;for(let i=0;i<16;i++)t[i]+=e[i];return this.markAsUpdated(),this}subtract(e){const t=this._m,i=e.m;for(let r=0;r<16;r++)t[r]-=i[r];return this.markAsUpdated(),this}subtractToRef(e,t){const i=this._m,r=e.m,s=t._m;for(let o=0;o<16;o++)s[o]=i[o]-r[o];return t.markAsUpdated(),t}subtractInPlace(e){const t=this._m,i=e.m;for(let r=0;r<16;r++)t[r]-=i[r];return this.markAsUpdated(),this}subtractFromFloats(...e){return this.subtractFromFloatsToRef(...e,new this.constructor)}subtractFromFloatsToRef(...e){const t=e.pop(),i=this._m,r=t._m,s=e;for(let o=0;o<16;o++)r[o]=i[o]-s[o];return t.markAsUpdated(),t}invertToRef(e){if(this._isIdentity===!0)return U.IdentityToRef(e),e;const t=this._m,i=t[0],r=t[1],s=t[2],o=t[3],a=t[4],l=t[5],h=t[6],c=t[7],u=t[8],d=t[9],f=t[10],p=t[11],g=t[12],m=t[13],x=t[14],E=t[15],R=f*E-x*p,C=d*E-m*p,_=d*x-m*f,T=u*E-g*p,y=u*x-f*g,P=u*m-g*d,D=+(l*R-h*C+c*_),F=-(a*R-h*T+c*y),N=+(a*C-l*T+c*P),G=-(a*_-l*y+h*P),J=i*D+r*F+s*N+o*G;if(J===0)return e.copyFrom(this),e;const j=1/J,z=h*E-x*c,$=l*E-m*c,te=l*x-m*h,fe=a*E-g*c,Z=a*x-g*h,L=a*m-g*l,w=h*p-f*c,H=l*p-d*c,de=l*f-d*h,Te=a*p-u*c,Ne=a*f-u*h,Fe=a*d-u*l,ce=-(r*R-s*C+o*_),ve=+(i*R-s*T+o*y),Ue=-(i*C-r*T+o*P),Se=+(i*_-r*y+s*P),ue=+(r*z-s*$+o*te),Ze=-(i*z-s*fe+o*Z),_t=+(i*$-r*fe+o*L),vt=-(i*te-r*Z+s*L),Ot=-(r*w-s*H+o*de),$t=+(i*w-s*Te+o*Ne),Ii=-(i*H-r*Te+o*Fe),Gi=+(i*de-r*Ne+s*Fe);return U.FromValuesToRef(D*j,ce*j,ue*j,Ot*j,F*j,ve*j,Ze*j,$t*j,N*j,Ue*j,_t*j,Ii*j,G*j,Se*j,vt*j,Gi*j,e),e}addAtIndex(e,t){return this._m[e]+=t,this.markAsUpdated(),this}multiplyAtIndex(e,t){return this._m[e]*=t,this.markAsUpdated(),this}setTranslationFromFloats(e,t,i){return this._m[12]=e,this._m[13]=t,this._m[14]=i,this.markAsUpdated(),this}addTranslationFromFloats(e,t,i){return this._m[12]+=e,this._m[13]+=t,this._m[14]+=i,this.markAsUpdated(),this}setTranslation(e){return this.setTranslationFromFloats(e._x,e._y,e._z)}getTranslation(){return new v(this._m[12],this._m[13],this._m[14])}getTranslationToRef(e){return e.x=this._m[12],e.y=this._m[13],e.z=this._m[14],e}removeRotationAndScaling(){const e=this.m;return U.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,e[12],e[13],e[14],e[15],this),this._updateIdentityStatus(e[12]===0&&e[13]===0&&e[14]===0&&e[15]===1),this}copyFrom(e){e.copyToArray(this._m);const t=e;return this.updateFlag=t.updateFlag,this._updateIdentityStatus(t._isIdentity,t._isIdentityDirty,t._isIdentity3x2,t._isIdentity3x2Dirty),this}copyToArray(e,t=0){const i=this._m;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],this}multiply(e){const t=new this.constructor;return this.multiplyToRef(e,t),t}multiplyInPlace(e){const t=this._m,i=e.m;for(let r=0;r<16;r++)t[r]*=i[r];return this.markAsUpdated(),this}multiplyByFloats(...e){const t=this._m;for(let i=0;i<16;i++)t[i]=e[i];return this.markAsUpdated(),this}multiplyByFloatsToRef(...e){const t=e.pop(),i=this._m,r=t._m,s=e;for(let o=0;o<16;o++)r[o]=i[o]*s[o];return t.markAsUpdated(),t}multiplyToRef(e,t){return this._isIdentity?(t.copyFrom(e),t):e._isIdentity?(t.copyFrom(this),t):(this.multiplyToArray(e,t._m,0),t.markAsUpdated(),t)}multiplyToArray(e,t,i){const r=this._m,s=e.m,o=r[0],a=r[1],l=r[2],h=r[3],c=r[4],u=r[5],d=r[6],f=r[7],p=r[8],g=r[9],m=r[10],x=r[11],E=r[12],R=r[13],C=r[14],_=r[15],T=s[0],y=s[1],P=s[2],D=s[3],F=s[4],N=s[5],G=s[6],J=s[7],j=s[8],z=s[9],$=s[10],te=s[11],fe=s[12],Z=s[13],L=s[14],w=s[15];return t[i]=o*T+a*F+l*j+h*fe,t[i+1]=o*y+a*N+l*z+h*Z,t[i+2]=o*P+a*G+l*$+h*L,t[i+3]=o*D+a*J+l*te+h*w,t[i+4]=c*T+u*F+d*j+f*fe,t[i+5]=c*y+u*N+d*z+f*Z,t[i+6]=c*P+u*G+d*$+f*L,t[i+7]=c*D+u*J+d*te+f*w,t[i+8]=p*T+g*F+m*j+x*fe,t[i+9]=p*y+g*N+m*z+x*Z,t[i+10]=p*P+g*G+m*$+x*L,t[i+11]=p*D+g*J+m*te+x*w,t[i+12]=E*T+R*F+C*j+_*fe,t[i+13]=E*y+R*N+C*z+_*Z,t[i+14]=E*P+R*G+C*$+_*L,t[i+15]=E*D+R*J+C*te+_*w,this}divide(e){return this.divideToRef(e,new this.constructor)}divideToRef(e,t){const i=this._m,r=e.m,s=t._m;for(let o=0;o<16;o++)s[o]=i[o]/r[o];return t.markAsUpdated(),t}divideInPlace(e){const t=this._m,i=e.m;for(let r=0;r<16;r++)t[r]/=i[r];return this.markAsUpdated(),this}minimizeInPlace(e){const t=this._m,i=e.m;for(let r=0;r<16;r++)t[r]=Math.min(t[r],i[r]);return this.markAsUpdated(),this}minimizeInPlaceFromFloats(...e){const t=this._m;for(let i=0;i<16;i++)t[i]=Math.min(t[i],e[i]);return this.markAsUpdated(),this}maximizeInPlace(e){const t=this._m,i=e.m;for(let r=0;r<16;r++)t[r]=Math.min(t[r],i[r]);return this.markAsUpdated(),this}maximizeInPlaceFromFloats(...e){const t=this._m;for(let i=0;i<16;i++)t[i]=Math.min(t[i],e[i]);return this.markAsUpdated(),this}negate(){return this.negateToRef(new this.constructor)}negateInPlace(){const e=this._m;for(let t=0;t<16;t++)e[t]=-e[t];return this.markAsUpdated(),this}negateToRef(e){const t=this._m,i=e._m;for(let r=0;r<16;r++)i[r]=-t[r];return e.markAsUpdated(),e}equals(e){const t=e;if(!t)return!1;if((this._isIdentity||t._isIdentity)&&!this._isIdentityDirty&&!t._isIdentityDirty)return this._isIdentity&&t._isIdentity;const i=this.m,r=t.m;return i[0]===r[0]&&i[1]===r[1]&&i[2]===r[2]&&i[3]===r[3]&&i[4]===r[4]&&i[5]===r[5]&&i[6]===r[6]&&i[7]===r[7]&&i[8]===r[8]&&i[9]===r[9]&&i[10]===r[10]&&i[11]===r[11]&&i[12]===r[12]&&i[13]===r[13]&&i[14]===r[14]&&i[15]===r[15]}equalsWithEpsilon(e,t=0){const i=this._m,r=e.m;for(let s=0;s<16;s++)if(!Mi(i[s],r[s],t))return!1;return!0}equalsToFloats(...e){const t=this._m;for(let i=0;i<16;i++)if(t[i]!=e[i])return!1;return!0}floor(){return this.floorToRef(new this.constructor)}floorToRef(e){const t=this._m,i=e._m;for(let r=0;r<16;r++)i[r]=Math.floor(t[r]);return e.markAsUpdated(),e}fract(){return this.fractToRef(new this.constructor)}fractToRef(e){const t=this._m,i=e._m;for(let r=0;r<16;r++)i[r]=t[r]-Math.floor(t[r]);return e.markAsUpdated(),e}clone(){const e=new this.constructor;return e.copyFrom(this),e}getClassName(){return"Matrix"}getHashCode(){let e=cr(this._m[0]);for(let t=1;t<16;t++)e=e*397^cr(this._m[t]);return e}decomposeToTransformNode(e){return e.rotationQuaternion=e.rotationQuaternion||new Re,this.decompose(e.scaling,e.rotationQuaternion,e.position)}decompose(e,t,i,r,s=!0){if(this._isIdentity)return i&&i.setAll(0),e&&e.setAll(1),t&&t.copyFromFloats(0,0,0,1),!0;const o=this._m;if(i&&i.copyFromFloats(o[12],o[13],o[14]),e=e||Ae.Vector3[0],e.x=Math.sqrt(o[0]*o[0]+o[1]*o[1]+o[2]*o[2]),e.y=Math.sqrt(o[4]*o[4]+o[5]*o[5]+o[6]*o[6]),e.z=Math.sqrt(o[8]*o[8]+o[9]*o[9]+o[10]*o[10]),r){const a=(s?r.absoluteScaling.x:r.scaling.x)<0?-1:1,l=(s?r.absoluteScaling.y:r.scaling.y)<0?-1:1,h=(s?r.absoluteScaling.z:r.scaling.z)<0?-1:1;e.x*=a,e.y*=l,e.z*=h}else this.determinant()<=0&&(e.y*=-1);if(e._x===0||e._y===0||e._z===0)return t&&t.copyFromFloats(0,0,0,1),!1;if(t){const a=1/e._x,l=1/e._y,h=1/e._z;U.FromValuesToRef(o[0]*a,o[1]*a,o[2]*a,0,o[4]*l,o[5]*l,o[6]*l,0,o[8]*h,o[9]*h,o[10]*h,0,0,0,0,1,Ae.Matrix[0]),Re.FromRotationMatrixToRef(Ae.Matrix[0],t)}return!0}getRow(e){if(e<0||e>3)return null;const t=e*4;return new Ke(this._m[t+0],this._m[t+1],this._m[t+2],this._m[t+3])}getRowToRef(e,t){if(e>=0&&e<=3){const i=e*4;t.x=this._m[i+0],t.y=this._m[i+1],t.z=this._m[i+2],t.w=this._m[i+3]}return t}setRow(e,t){return this.setRowFromFloats(e,t.x,t.y,t.z,t.w)}transpose(){const e=new this.constructor;return U.TransposeToRef(this,e),e}transposeToRef(e){return U.TransposeToRef(this,e),e}setRowFromFloats(e,t,i,r,s){if(e<0||e>3)return this;const o=e*4;return this._m[o+0]=t,this._m[o+1]=i,this._m[o+2]=r,this._m[o+3]=s,this.markAsUpdated(),this}scale(e){const t=new this.constructor;return this.scaleToRef(e,t),t}scaleToRef(e,t){for(let i=0;i<16;i++)t._m[i]=this._m[i]*e;return t.markAsUpdated(),t}scaleAndAddToRef(e,t){for(let i=0;i<16;i++)t._m[i]+=this._m[i]*e;return t.markAsUpdated(),t}scaleInPlace(e){const t=this._m;for(let i=0;i<16;i++)t[i]*=e;return this.markAsUpdated(),this}toNormalMatrix(e){const t=Ae.Matrix[0];this.invertToRef(t),t.transposeToRef(e);const i=e._m;return U.FromValuesToRef(i[0],i[1],i[2],0,i[4],i[5],i[6],0,i[8],i[9],i[10],0,0,0,0,1,e),e}getRotationMatrix(){const e=new this.constructor;return this.getRotationMatrixToRef(e),e}getRotationMatrixToRef(e){const t=Ae.Vector3[0];if(!this.decompose(t))return U.IdentityToRef(e),e;const i=this._m,r=1/t._x,s=1/t._y,o=1/t._z;return U.FromValuesToRef(i[0]*r,i[1]*r,i[2]*r,0,i[4]*s,i[5]*s,i[6]*s,0,i[8]*o,i[9]*o,i[10]*o,0,0,0,0,1,e),e}toggleModelMatrixHandInPlace(){const e=this._m;return e[2]*=-1,e[6]*=-1,e[8]*=-1,e[9]*=-1,e[14]*=-1,this.markAsUpdated(),this}toggleProjectionMatrixHandInPlace(){const e=this._m;return e[8]*=-1,e[9]*=-1,e[10]*=-1,e[11]*=-1,this.markAsUpdated(),this}static FromArray(e,t=0){const i=new U;return U.FromArrayToRef(e,t,i),i}static FromArrayToRef(e,t,i){for(let r=0;r<16;r++)i._m[r]=e[r+t];return i.markAsUpdated(),i}static FromFloat32ArrayToRefScaled(e,t,i,r){for(let s=0;s<16;s++)r._m[s]=e[s+t]*i;return r.markAsUpdated(),r}static get IdentityReadOnly(){return U._IdentityReadOnly}static FromValuesToRef(e,t,i,r,s,o,a,l,h,c,u,d,f,p,g,m,x){const E=x._m;E[0]=e,E[1]=t,E[2]=i,E[3]=r,E[4]=s,E[5]=o,E[6]=a,E[7]=l,E[8]=h,E[9]=c,E[10]=u,E[11]=d,E[12]=f,E[13]=p,E[14]=g,E[15]=m,x.markAsUpdated()}static FromValues(e,t,i,r,s,o,a,l,h,c,u,d,f,p,g,m){const x=new U,E=x._m;return E[0]=e,E[1]=t,E[2]=i,E[3]=r,E[4]=s,E[5]=o,E[6]=a,E[7]=l,E[8]=h,E[9]=c,E[10]=u,E[11]=d,E[12]=f,E[13]=p,E[14]=g,E[15]=m,x.markAsUpdated(),x}static Compose(e,t,i){const r=new U;return U.ComposeToRef(e,t,i,r),r}static ComposeToRef(e,t,i,r){const s=r._m,o=t._x,a=t._y,l=t._z,h=t._w,c=o+o,u=a+a,d=l+l,f=o*c,p=o*u,g=o*d,m=a*u,x=a*d,E=l*d,R=h*c,C=h*u,_=h*d,T=e._x,y=e._y,P=e._z;return s[0]=(1-(m+E))*T,s[1]=(p+_)*T,s[2]=(g-C)*T,s[3]=0,s[4]=(p-_)*y,s[5]=(1-(f+E))*y,s[6]=(x+R)*y,s[7]=0,s[8]=(g+C)*P,s[9]=(x-R)*P,s[10]=(1-(f+m))*P,s[11]=0,s[12]=i._x,s[13]=i._y,s[14]=i._z,s[15]=1,r.markAsUpdated(),r}static Identity(){const e=U.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return e._updateIdentityStatus(!0),e}static IdentityToRef(e){return U.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,e),e._updateIdentityStatus(!0),e}static Zero(){const e=U.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return e._updateIdentityStatus(!1),e}static RotationX(e){const t=new U;return U.RotationXToRef(e,t),t}static Invert(e){const t=new e.constructor;return e.invertToRef(t),t}static RotationXToRef(e,t){const i=Math.sin(e),r=Math.cos(e);return U.FromValuesToRef(1,0,0,0,0,r,i,0,0,-i,r,0,0,0,0,1,t),t._updateIdentityStatus(r===1&&i===0),t}static RotationY(e){const t=new U;return U.RotationYToRef(e,t),t}static RotationYToRef(e,t){const i=Math.sin(e),r=Math.cos(e);return U.FromValuesToRef(r,0,-i,0,0,1,0,0,i,0,r,0,0,0,0,1,t),t._updateIdentityStatus(r===1&&i===0),t}static RotationZ(e){const t=new U;return U.RotationZToRef(e,t),t}static RotationZToRef(e,t){const i=Math.sin(e),r=Math.cos(e);return U.FromValuesToRef(r,i,0,0,-i,r,0,0,0,0,1,0,0,0,0,1,t),t._updateIdentityStatus(r===1&&i===0),t}static RotationAxis(e,t){const i=new U;return U.RotationAxisToRef(e,t,i),i}static RotationAxisToRef(e,t,i){const r=Math.sin(-t),s=Math.cos(-t),o=1-s;e.normalize();const a=i._m;return a[0]=e._x*e._x*o+s,a[1]=e._x*e._y*o-e._z*r,a[2]=e._x*e._z*o+e._y*r,a[3]=0,a[4]=e._y*e._x*o+e._z*r,a[5]=e._y*e._y*o+s,a[6]=e._y*e._z*o-e._x*r,a[7]=0,a[8]=e._z*e._x*o-e._y*r,a[9]=e._z*e._y*o+e._x*r,a[10]=e._z*e._z*o+s,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,i.markAsUpdated(),i}static RotationAlignToRef(e,t,i,r=!1){const s=v.Dot(t,e),o=i._m;if(s<-1+xt)o[0]=-1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=r?1:-1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=r?-1:1,o[11]=0;else{const a=v.Cross(t,e),l=1/(1+s);o[0]=a._x*a._x*l+s,o[1]=a._y*a._x*l-a._z,o[2]=a._z*a._x*l+a._y,o[3]=0,o[4]=a._x*a._y*l+a._z,o[5]=a._y*a._y*l+s,o[6]=a._z*a._y*l-a._x,o[7]=0,o[8]=a._x*a._z*l-a._y,o[9]=a._y*a._z*l+a._x,o[10]=a._z*a._z*l+s,o[11]=0}return o[12]=0,o[13]=0,o[14]=0,o[15]=1,i.markAsUpdated(),i}static RotationYawPitchRoll(e,t,i){const r=new U;return U.RotationYawPitchRollToRef(e,t,i,r),r}static RotationYawPitchRollToRef(e,t,i,r){return Re.RotationYawPitchRollToRef(e,t,i,Ae.Quaternion[0]),Ae.Quaternion[0].toRotationMatrix(r),r}static Scaling(e,t,i){const r=new U;return U.ScalingToRef(e,t,i,r),r}static ScalingToRef(e,t,i,r){return U.FromValuesToRef(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1,r),r._updateIdentityStatus(e===1&&t===1&&i===1),r}static Translation(e,t,i){const r=new U;return U.TranslationToRef(e,t,i,r),r}static TranslationToRef(e,t,i,r){return U.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,e,t,i,1,r),r._updateIdentityStatus(e===0&&t===0&&i===0),r}static Lerp(e,t,i){const r=new e.constructor;return U.LerpToRef(e,t,i,r),r}static LerpToRef(e,t,i,r){const s=r._m,o=e.m,a=t.m;for(let l=0;l<16;l++)s[l]=o[l]*(1-i)+a[l]*i;return r.markAsUpdated(),r}static DecomposeLerp(e,t,i){const r=new e.constructor;return U.DecomposeLerpToRef(e,t,i,r),r}static DecomposeLerpToRef(e,t,i,r){const s=Ae.Vector3[0],o=Ae.Quaternion[0],a=Ae.Vector3[1];e.decompose(s,o,a);const l=Ae.Vector3[2],h=Ae.Quaternion[1],c=Ae.Vector3[3];t.decompose(l,h,c);const u=Ae.Vector3[4];v.LerpToRef(s,l,i,u);const d=Ae.Quaternion[2];Re.SlerpToRef(o,h,i,d);const f=Ae.Vector3[5];return v.LerpToRef(a,c,i,f),U.ComposeToRef(u,d,f,r),r}static LookAtLH(e,t,i){const r=new U;return U.LookAtLHToRef(e,t,i,r),r}static LookAtLHToRef(e,t,i,r){const s=Ae.Vector3[0],o=Ae.Vector3[1],a=Ae.Vector3[2];t.subtractToRef(e,a),a.normalize(),v.CrossToRef(i,a,s);const l=s.lengthSquared();l===0?s.x=1:s.normalizeFromLength(Math.sqrt(l)),v.CrossToRef(a,s,o),o.normalize();const h=-v.Dot(s,e),c=-v.Dot(o,e),u=-v.Dot(a,e);return U.FromValuesToRef(s._x,o._x,a._x,0,s._y,o._y,a._y,0,s._z,o._z,a._z,0,h,c,u,1,r),r}static LookAtRH(e,t,i){const r=new U;return U.LookAtRHToRef(e,t,i,r),r}static LookAtRHToRef(e,t,i,r){const s=Ae.Vector3[0],o=Ae.Vector3[1],a=Ae.Vector3[2];e.subtractToRef(t,a),a.normalize(),v.CrossToRef(i,a,s);const l=s.lengthSquared();l===0?s.x=1:s.normalizeFromLength(Math.sqrt(l)),v.CrossToRef(a,s,o),o.normalize();const h=-v.Dot(s,e),c=-v.Dot(o,e),u=-v.Dot(a,e);return U.FromValuesToRef(s._x,o._x,a._x,0,s._y,o._y,a._y,0,s._z,o._z,a._z,0,h,c,u,1,r),r}static LookDirectionLH(e,t){const i=new U;return U.LookDirectionLHToRef(e,t,i),i}static LookDirectionLHToRef(e,t,i){const r=Ae.Vector3[0];r.copyFrom(e),r.scaleInPlace(-1);const s=Ae.Vector3[1];return v.CrossToRef(t,r,s),U.FromValuesToRef(s._x,s._y,s._z,0,t._x,t._y,t._z,0,r._x,r._y,r._z,0,0,0,0,1,i),i}static LookDirectionRH(e,t){const i=new U;return U.LookDirectionRHToRef(e,t,i),i}static LookDirectionRHToRef(e,t,i){const r=Ae.Vector3[2];return v.CrossToRef(t,e,r),U.FromValuesToRef(r._x,r._y,r._z,0,t._x,t._y,t._z,0,e._x,e._y,e._z,0,0,0,0,1,i),i}static OrthoLH(e,t,i,r,s){const o=new U;return U.OrthoLHToRef(e,t,i,r,o,s),o}static OrthoLHToRef(e,t,i,r,s,o){const a=i,l=r,h=2/e,c=2/t,u=2/(l-a),d=-(l+a)/(l-a);return U.FromValuesToRef(h,0,0,0,0,c,0,0,0,0,u,0,0,0,d,1,s),o&&s.multiplyToRef(Sn,s),s._updateIdentityStatus(h===1&&c===1&&u===1&&d===0),s}static OrthoOffCenterLH(e,t,i,r,s,o,a){const l=new U;return U.OrthoOffCenterLHToRef(e,t,i,r,s,o,l,a),l}static OrthoOffCenterLHToRef(e,t,i,r,s,o,a,l){const h=s,c=o,u=2/(t-e),d=2/(r-i),f=2/(c-h),p=-(c+h)/(c-h),g=(e+t)/(e-t),m=(r+i)/(i-r);return U.FromValuesToRef(u,0,0,0,0,d,0,0,0,0,f,0,g,m,p,1,a),l&&a.multiplyToRef(Sn,a),a.markAsUpdated(),a}static ObliqueOffCenterLHToRef(e,t,i,r,s,o,a,l,h,c,u){const d=-a*Math.cos(l),f=-a*Math.sin(l);return U.TranslationToRef(0,0,-h,Ae.Matrix[1]),U.FromValuesToRef(1,0,0,0,0,1,0,0,d,f,1,0,0,0,0,1,Ae.Matrix[0]),Ae.Matrix[1].multiplyToRef(Ae.Matrix[0],Ae.Matrix[0]),U.TranslationToRef(0,0,h,Ae.Matrix[1]),Ae.Matrix[0].multiplyToRef(Ae.Matrix[1],Ae.Matrix[0]),U.OrthoOffCenterLHToRef(e,t,i,r,s,o,c,u),Ae.Matrix[0].multiplyToRef(c,c),c}static OrthoOffCenterRH(e,t,i,r,s,o,a){const l=new U;return U.OrthoOffCenterRHToRef(e,t,i,r,s,o,l,a),l}static OrthoOffCenterRHToRef(e,t,i,r,s,o,a,l){return U.OrthoOffCenterLHToRef(e,t,i,r,s,o,a,l),a._m[10]*=-1,a}static ObliqueOffCenterRHToRef(e,t,i,r,s,o,a,l,h,c,u){const d=a*Math.cos(l),f=a*Math.sin(l);return U.TranslationToRef(0,0,h,Ae.Matrix[1]),U.FromValuesToRef(1,0,0,0,0,1,0,0,d,f,1,0,0,0,0,1,Ae.Matrix[0]),Ae.Matrix[1].multiplyToRef(Ae.Matrix[0],Ae.Matrix[0]),U.TranslationToRef(0,0,-h,Ae.Matrix[1]),Ae.Matrix[0].multiplyToRef(Ae.Matrix[1],Ae.Matrix[0]),U.OrthoOffCenterRHToRef(e,t,i,r,s,o,c,u),Ae.Matrix[0].multiplyToRef(c,c),c}static PerspectiveLH(e,t,i,r,s,o=0){const a=new U,l=i,h=r,c=2*l/e,u=2*l/t,d=(h+l)/(h-l),f=-2*h*l/(h-l),p=Math.tan(o);return U.FromValuesToRef(c,0,0,0,0,u,0,p,0,0,d,1,0,0,f,0,a),s&&a.multiplyToRef(Sn,a),a._updateIdentityStatus(!1),a}static PerspectiveFovLH(e,t,i,r,s,o=0,a=!1){const l=new U;return U.PerspectiveFovLHToRef(e,t,i,r,l,!0,s,o,a),l}static PerspectiveFovLHToRef(e,t,i,r,s,o=!0,a,l=0,h=!1){const c=i,u=r,d=1/Math.tan(e*.5),f=o?d/t:d,p=o?d:d*t,g=h&&c===0?-1:u!==0?(u+c)/(u-c):1,m=h&&c===0?2*u:u!==0?-2*u*c/(u-c):-2*c,x=Math.tan(l);return U.FromValuesToRef(f,0,0,0,0,p,0,x,0,0,g,1,0,0,m,0,s),a&&s.multiplyToRef(Sn,s),s._updateIdentityStatus(!1),s}static PerspectiveFovReverseLHToRef(e,t,i,r,s,o=!0,a,l=0){const h=1/Math.tan(e*.5),c=o?h/t:h,u=o?h:h*t,d=Math.tan(l);return U.FromValuesToRef(c,0,0,0,0,u,0,d,0,0,-i,1,0,0,1,0,s),a&&s.multiplyToRef(Sn,s),s._updateIdentityStatus(!1),s}static PerspectiveFovRH(e,t,i,r,s,o=0,a=!1){const l=new U;return U.PerspectiveFovRHToRef(e,t,i,r,l,!0,s,o,a),l}static PerspectiveFovRHToRef(e,t,i,r,s,o=!0,a,l=0,h=!1){const c=i,u=r,d=1/Math.tan(e*.5),f=o?d/t:d,p=o?d:d*t,g=h&&c===0?1:u!==0?-(u+c)/(u-c):-1,m=h&&c===0?2*u:u!==0?-2*u*c/(u-c):-2*c,x=Math.tan(l);return U.FromValuesToRef(f,0,0,0,0,p,0,x,0,0,g,-1,0,0,m,0,s),a&&s.multiplyToRef(Sn,s),s._updateIdentityStatus(!1),s}static PerspectiveFovReverseRHToRef(e,t,i,r,s,o=!0,a,l=0){const h=1/Math.tan(e*.5),c=o?h/t:h,u=o?h:h*t,d=Math.tan(l);return U.FromValuesToRef(c,0,0,0,0,u,0,d,0,0,-i,-1,0,0,-1,0,s),a&&s.multiplyToRef(Sn,s),s._updateIdentityStatus(!1),s}static GetFinalMatrix(e,t,i,r,s,o){const a=e.width,l=e.height,h=e.x,c=e.y,u=U.FromValues(a/2,0,0,0,0,-l/2,0,0,0,0,o-s,0,h+a/2,l/2+c,s,1),d=new t.constructor;return t.multiplyToRef(i,d),d.multiplyToRef(r,d),d.multiplyToRef(u,d)}static GetAsMatrix2x2(e){const t=e.m,i=[t[0],t[1],t[4],t[5]];return vi.MatrixUse64Bits?i:new Float32Array(i)}static GetAsMatrix3x3(e){const t=e.m,i=[t[0],t[1],t[2],t[4],t[5],t[6],t[8],t[9],t[10]];return vi.MatrixUse64Bits?i:new Float32Array(i)}static Transpose(e){const t=new e.constructor;return U.TransposeToRef(e,t),t}static TransposeToRef(e,t){const i=e.m,r=i[0],s=i[4],o=i[8],a=i[12],l=i[1],h=i[5],c=i[9],u=i[13],d=i[2],f=i[6],p=i[10],g=i[14],m=i[3],x=i[7],E=i[11],R=i[15],C=t._m;return C[0]=r,C[1]=s,C[2]=o,C[3]=a,C[4]=l,C[5]=h,C[6]=c,C[7]=u,C[8]=d,C[9]=f,C[10]=p,C[11]=g,C[12]=m,C[13]=x,C[14]=E,C[15]=R,t.markAsUpdated(),t._updateIdentityStatus(e._isIdentity,e._isIdentityDirty),t}static Reflection(e){const t=new U;return U.ReflectionToRef(e,t),t}static ReflectionToRef(e,t){e.normalize();const i=e.normal.x,r=e.normal.y,s=e.normal.z,o=-2*i,a=-2*r,l=-2*s;return U.FromValuesToRef(o*i+1,a*i,l*i,0,o*r,a*r+1,l*r,0,o*s,a*s,l*s+1,0,o*e.d,a*e.d,l*e.d,1,t),t}static FromXYZAxesToRef(e,t,i,r){return U.FromValuesToRef(e._x,e._y,e._z,0,t._x,t._y,t._z,0,i._x,i._y,i._z,0,0,0,0,1,r),r}static FromQuaternionToRef(e,t){const i=e._x*e._x,r=e._y*e._y,s=e._z*e._z,o=e._x*e._y,a=e._z*e._w,l=e._z*e._x,h=e._y*e._w,c=e._y*e._z,u=e._x*e._w;return t._m[0]=1-2*(r+s),t._m[1]=2*(o+a),t._m[2]=2*(l-h),t._m[3]=0,t._m[4]=2*(o-a),t._m[5]=1-2*(s+i),t._m[6]=2*(c+u),t._m[7]=0,t._m[8]=2*(l+h),t._m[9]=2*(c-u),t._m[10]=1-2*(r+i),t._m[11]=0,t._m[12]=0,t._m[13]=0,t._m[14]=0,t._m[15]=1,t.markAsUpdated(),t}}U._UpdateFlagSeed=0;U._IdentityReadOnly=U.Identity();Object.defineProperties(U.prototype,{dimension:{value:[4,4]},rank:{value:2}});class Ae{}Ae.Vector3=Ci.BuildTuple(11,v.Zero);Ae.Matrix=Ci.BuildTuple(2,U.Identity);Ae.Quaternion=Ci.BuildTuple(3,Re.Zero);class W{}W.Vector2=Ci.BuildTuple(3,me.Zero);W.Vector3=Ci.BuildTuple(13,v.Zero);W.Vector4=Ci.BuildTuple(3,Ke.Zero);W.Quaternion=Ci.BuildTuple(2,Re.Zero);W.Matrix=Ci.BuildTuple(8,U.Identity);ye("BABYLON.Vector2",me);ye("BABYLON.Vector3",v);ye("BABYLON.Vector4",Ke);ye("BABYLON.Matrix",U);const Sn=U.FromValues(1,0,0,0,0,1,0,0,0,0,.5,0,0,0,.5,1);class Za{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.particleSystems=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[]}static AddParser(e,t){this._BabylonFileParsers[e]=t}static GetParser(e){return this._BabylonFileParsers[e]?this._BabylonFileParsers[e]:null}static AddIndividualParser(e,t){this._IndividualBabylonFileParsers[e]=t}static GetIndividualParser(e){return this._IndividualBabylonFileParsers[e]?this._IndividualBabylonFileParsers[e]:null}static Parse(e,t,i,r){for(const s in this._BabylonFileParsers)Object.prototype.hasOwnProperty.call(this._BabylonFileParsers,s)&&this._BabylonFileParsers[s](e,t,i,r)}get environmentTexture(){return this._environmentTexture}set environmentTexture(e){this._environmentTexture=e}getNodes(){let e=[];return e=e.concat(this.meshes),e=e.concat(this.lights),e=e.concat(this.cameras),e=e.concat(this.transformNodes),this.skeletons.forEach(t=>e=e.concat(t.bones)),e}}Za._BabylonFileParsers={};Za._IndividualBabylonFileParsers={};function M(n,e,t,i){var r=arguments.length,s=r<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(s=(r<3?o(s):r>3?o(e,t,s):o(e,t))||s);return r>3&&s&&Object.defineProperty(e,t,s),s}const Cl={},jl={};function vy(n){const e=n.getClassName();return jl[e]||(jl[e]={}),jl[e]}function Iu(n){const e=n.getClassName();if(Cl[e])return Cl[e];Cl[e]={};const t=Cl[e];let i=n,r=e;for(;r;){const s=jl[r];for(const l in s)t[l]=s[l];let o,a=!1;do{if(o=Object.getPrototypeOf(i),!o.getClassName){a=!0;break}if(o.getClassName()!==r)break;i=o}while(o);if(a)break;r=o.getClassName(),i=o}return t}function Br(n,e){return(t,i)=>{const r=vy(t);r[i]||(r[i]={type:n,sourceName:e})}}function Ey(n,e=null){return(t,i)=>{const r=e||"_"+i;Object.defineProperty(t,i,{get:function(){return this[r]},set:function(s){typeof this.equals=="function"&&this.equals(s)||this[r]!==s&&(this[r]=s,t[n].apply(this))},enumerable:!0,configurable:!0})}}function ae(n,e=null){return Ey(n,e)}function V(n){return Br(0,n)}function Tt(n){return Br(1,n)}function sr(n){return Br(2,n)}function ja(n){return Br(3,n)}function a0(n){return Br(4,n)}function mn(n){return Br(5,n)}function Ty(n){return Br(6,n)}function xy(n){return Br(7,n)}function l0(n){return Br(8,n)}function Cy(n){return Br(9,n)}function Ry(n){return Br(10,n)}function h0(n){return Br(12,n)}function pn(n,e,t,i){const r=t.value;t.value=(...s)=>{let o=r;if(typeof _native<"u"&&_native[e]){const a=_native[e];i?o=(...l)=>i(...l)?a(...l):r(...l):o=a}return n[e]=o,o(...s)}}pn.filter=function(n){return(e,t,i)=>pn(e,t,i,n)};class Ye{static Sign(e){return e=+e,e===0||isNaN(e)?e:e>0?1:-1}static Log2(e){return Math.log(e)*Math.LOG2E}static ILog2(e){if(Math.log2)return Math.floor(Math.log2(e));if(e<0)return NaN;if(e===0)return-1/0;let t=0;if(e<1){for(;e<1;)t++,e=e*2;t=-t}else if(e>1)for(;e>1;)t++,e=Math.floor(e/2);return t}static Repeat(e,t){return e-Math.floor(e/t)*t}static Normalize(e,t,i){return(e-t)/(i-t)}static Denormalize(e,t,i){return e*(i-t)+t}static DeltaAngle(e,t){let i=Ye.Repeat(t-e,360);return i>180&&(i-=360),i}static PingPong(e,t){const i=Ye.Repeat(e,t*2);return t-Math.abs(i-t)}static SmoothStep(e,t,i){let r=Ye.Clamp(i);return r=-2*r*r*r+3*r*r,t*r+e*(1-r)}static MoveTowards(e,t,i){let r=0;return Math.abs(t-e)<=i?r=t:r=e+Ye.Sign(t-e)*i,r}static MoveTowardsAngle(e,t,i){const r=Ye.DeltaAngle(e,t);let s=0;return-i<r&&r<i?s=t:(t=e+r,s=Ye.MoveTowards(e,t,i)),s}static LerpAngle(e,t,i){let r=Ye.Repeat(t-e,360);return r>180&&(r-=360),e+r*si(i)}static InverseLerp(e,t,i){let r=0;return e!=t?r=si((i-e)/(t-e)):r=0,r}static Hermite(e,t,i,r,s){const o=s*s,a=s*o,l=2*a-3*o+1,h=-2*a+3*o,c=a-2*o+s,u=a-o;return e*l+i*h+t*c+r*u}static Hermite1stDerivative(e,t,i,r,s){const o=s*s;return(o-s)*6*e+(3*o-4*s+1)*t+(-o+s)*6*i+(3*o-2*s)*r}static RangeToPercent(e,t,i){return(e-t)/(i-t)}static PercentToRange(e,t,i){return(i-t)*e+t}static HCF(e,t){const i=e%t;return i===0?t:Ye.HCF(t,i)}}Ye.TwoPi=Math.PI*2;Ye.WithinEpsilon=Mi;Ye.ToHex=Yr;Ye.Clamp=si;Ye.Lerp=n0;Ye.RandomRange=jt;Ye.NormalizeRadians=o0;function To(n){return Math.pow(n,Zl)}function xo(n){return n<=.04045?.0773993808*n:Math.pow(.947867299*(n+.055),2.4)}function Co(n){return Math.pow(n,Yl)}function Ro(n){return n<=.0031308?12.92*n:1.055*Math.pow(n,.41666)-.055}class De{constructor(e=0,t=0,i=0){this.r=e,this.g=t,this.b=i}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"}getClassName(){return"Color3"}getHashCode(){let e=this.r*255|0;return e=e*397^(this.g*255|0),e=e*397^(this.b*255|0),e}toArray(e,t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,this}fromArray(e,t=0){return De.FromArrayToRef(e,t,this),this}toColor4(e=1){return new $e(this.r,this.g,this.b,e)}asArray(){return[this.r,this.g,this.b]}toLuminance(){return this.r*.3+this.g*.59+this.b*.11}multiply(e){return new this.constructor(this.r*e.r,this.g*e.g,this.b*e.b)}multiplyToRef(e,t){return t.r=this.r*e.r,t.g=this.g*e.g,t.b=this.b*e.b,t}multiplyInPlace(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyByFloats(e,t,i){return new this.constructor(this.r*e,this.g*t,this.b*i)}divide(e){throw new ReferenceError("Can not divide a color")}divideToRef(e,t){throw new ReferenceError("Can not divide a color")}divideInPlace(e){throw new ReferenceError("Can not divide a color")}minimizeInPlace(e){return this.minimizeInPlaceFromFloats(e.r,e.g,e.b)}maximizeInPlace(e){return this.maximizeInPlaceFromFloats(e.r,e.g,e.b)}minimizeInPlaceFromFloats(e,t,i){return this.r=Math.min(e,this.r),this.g=Math.min(t,this.g),this.b=Math.min(i,this.b),this}maximizeInPlaceFromFloats(e,t,i){return this.r=Math.max(e,this.r),this.g=Math.max(t,this.g),this.b=Math.max(i,this.b),this}floorToRef(e){throw new ReferenceError("Can not floor a color")}floor(){throw new ReferenceError("Can not floor a color")}fractToRef(e){throw new ReferenceError("Can not fract a color")}fract(){throw new ReferenceError("Can not fract a color")}equals(e){return e&&this.r===e.r&&this.g===e.g&&this.b===e.b}equalsFloats(e,t,i){return this.equalsToFloats(e,t,i)}equalsToFloats(e,t,i){return this.r===e&&this.g===t&&this.b===i}equalsWithEpsilon(e,t=xt){return Ye.WithinEpsilon(this.r,e.r,t)&&Ye.WithinEpsilon(this.g,e.g,t)&&Ye.WithinEpsilon(this.b,e.b,t)}negate(){throw new ReferenceError("Can not negate a color")}negateInPlace(){throw new ReferenceError("Can not negate a color")}negateToRef(e){throw new ReferenceError("Can not negate a color")}scale(e){return new this.constructor(this.r*e,this.g*e,this.b*e)}scaleInPlace(e){return this.r*=e,this.g*=e,this.b*=e,this}scaleToRef(e,t){return t.r=this.r*e,t.g=this.g*e,t.b=this.b*e,t}scaleAndAddToRef(e,t){return t.r+=this.r*e,t.g+=this.g*e,t.b+=this.b*e,t}clampToRef(e=0,t=1,i){return i.r=si(this.r,e,t),i.g=si(this.g,e,t),i.b=si(this.b,e,t),i}add(e){return new this.constructor(this.r+e.r,this.g+e.g,this.b+e.b)}addInPlace(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addInPlaceFromFloats(e,t,i){return this.r+=e,this.g+=t,this.b+=i,this}addToRef(e,t){return t.r=this.r+e.r,t.g=this.g+e.g,t.b=this.b+e.b,t}subtract(e){return new this.constructor(this.r-e.r,this.g-e.g,this.b-e.b)}subtractToRef(e,t){return t.r=this.r-e.r,t.g=this.g-e.g,t.b=this.b-e.b,t}subtractInPlace(e){return this.r-=e.r,this.g-=e.g,this.b-=e.b,this}subtractFromFloats(e,t,i){return new this.constructor(this.r-e,this.g-t,this.b-i)}subtractFromFloatsToRef(e,t,i,r){return r.copyFromFloats(this.r-e,this.g-t,this.b-i)}clone(){return new this.constructor(this.r,this.g,this.b)}copyFrom(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copyFromFloats(e,t,i){return this.r=e,this.g=t,this.b=i,this}set(e,t,i){return this.copyFromFloats(e,t,i)}setAll(e){return this.r=this.g=this.b=e,this}toHexString(){const e=Math.round(this.r*255),t=Math.round(this.g*255),i=Math.round(this.b*255);return"#"+Yr(e)+Yr(t)+Yr(i)}toHSV(){const e=new this.constructor;return this.toHSVToRef(e),e}toHSVToRef(e){const t=this.r,i=this.g,r=this.b,s=Math.max(t,i,r),o=Math.min(t,i,r);let a=0,l=0;const h=s,c=s-o;s!==0&&(l=c/s),s!=o&&(s==t?(a=(i-r)/c,i<r&&(a+=6)):s==i?a=(r-t)/c+2:s==r&&(a=(t-i)/c+4),a*=60),e.r=a,e.g=l,e.b=h}toLinearSpace(e=!1){const t=new this.constructor;return this.toLinearSpaceToRef(t,e),t}toLinearSpaceToRef(e,t=!1){return t?(e.r=xo(this.r),e.g=xo(this.g),e.b=xo(this.b)):(e.r=To(this.r),e.g=To(this.g),e.b=To(this.b)),this}toGammaSpace(e=!1){const t=new this.constructor;return this.toGammaSpaceToRef(t,e),t}toGammaSpaceToRef(e,t=!1){return t?(e.r=Ro(this.r),e.g=Ro(this.g),e.b=Ro(this.b)):(e.r=Co(this.r),e.g=Co(this.g),e.b=Co(this.b)),this}static HSVtoRGBToRef(e,t,i,r){const s=i*t,o=e/60,a=s*(1-Math.abs(o%2-1));let l=0,h=0,c=0;o>=0&&o<=1?(l=s,h=a):o>=1&&o<=2?(l=a,h=s):o>=2&&o<=3?(h=s,c=a):o>=3&&o<=4?(h=a,c=s):o>=4&&o<=5?(l=a,c=s):o>=5&&o<=6&&(l=s,c=a);const u=i-s;r.set(l+u,h+u,c+u)}static FromHSV(e,t,i){const r=new De(0,0,0);return De.HSVtoRGBToRef(e,t,i,r),r}static FromHexString(e){if(e.substring(0,1)!=="#"||e.length!==7)return new De(0,0,0);const t=parseInt(e.substring(1,3),16),i=parseInt(e.substring(3,5),16),r=parseInt(e.substring(5,7),16);return De.FromInts(t,i,r)}static FromArray(e,t=0){return new De(e[t],e[t+1],e[t+2])}static FromArrayToRef(e,t=0,i){i.r=e[t],i.g=e[t+1],i.b=e[t+2]}static FromInts(e,t,i){return new De(e/255,t/255,i/255)}static Lerp(e,t,i){const r=new De(0,0,0);return De.LerpToRef(e,t,i,r),r}static LerpToRef(e,t,i,r){r.r=e.r+(t.r-e.r)*i,r.g=e.g+(t.g-e.g)*i,r.b=e.b+(t.b-e.b)*i}static Hermite(e,t,i,r,s){const o=s*s,a=s*o,l=2*a-3*o+1,h=-2*a+3*o,c=a-2*o+s,u=a-o,d=e.r*l+i.r*h+t.r*c+r.r*u,f=e.g*l+i.g*h+t.g*c+r.g*u,p=e.b*l+i.b*h+t.b*c+r.b*u;return new De(d,f,p)}static Hermite1stDerivative(e,t,i,r,s){const o=De.Black();return this.Hermite1stDerivativeToRef(e,t,i,r,s,o),o}static Hermite1stDerivativeToRef(e,t,i,r,s,o){const a=s*s;o.r=(a-s)*6*e.r+(3*a-4*s+1)*t.r+(-a+s)*6*i.r+(3*a-2*s)*r.r,o.g=(a-s)*6*e.g+(3*a-4*s+1)*t.g+(-a+s)*6*i.g+(3*a-2*s)*r.g,o.b=(a-s)*6*e.b+(3*a-4*s+1)*t.b+(-a+s)*6*i.b+(3*a-2*s)*r.b}static Red(){return new De(1,0,0)}static Green(){return new De(0,1,0)}static Blue(){return new De(0,0,1)}static Black(){return new De(0,0,0)}static get BlackReadOnly(){return De._BlackReadOnly}static White(){return new De(1,1,1)}static Purple(){return new De(.5,0,.5)}static Magenta(){return new De(1,0,1)}static Yellow(){return new De(1,1,0)}static Gray(){return new De(.5,.5,.5)}static Teal(){return new De(0,1,1)}static Random(){return new De(Math.random(),Math.random(),Math.random())}}De._BlackReadOnly=De.Black();Object.defineProperties(De.prototype,{dimension:{value:[3]},rank:{value:1}});class $e{constructor(e=0,t=0,i=0,r=1){this.r=e,this.g=t,this.b=i,this.a=r}asArray(){return[this.r,this.g,this.b,this.a]}toArray(e,t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e[t+3]=this.a,this}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this.a=e[t+3],this}equals(e){return e&&this.r===e.r&&this.g===e.g&&this.b===e.b&&this.a===e.a}add(e){return new this.constructor(this.r+e.r,this.g+e.g,this.b+e.b,this.a+e.a)}addToRef(e,t){return t.r=this.r+e.r,t.g=this.g+e.g,t.b=this.b+e.b,t.a=this.a+e.a,t}addInPlace(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this.a+=e.a,this}addInPlaceFromFloats(e,t,i,r){return this.r+=e,this.g+=t,this.b+=i,this.a+=r,this}subtract(e){return new this.constructor(this.r-e.r,this.g-e.g,this.b-e.b,this.a-e.a)}subtractToRef(e,t){return t.r=this.r-e.r,t.g=this.g-e.g,t.b=this.b-e.b,t.a=this.a-e.a,t}subtractInPlace(e){return this.r-=e.r,this.g-=e.g,this.b-=e.b,this.a-=e.a,this}subtractFromFloats(e,t,i,r){return new this.constructor(this.r-e,this.g-t,this.b-i,this.a-r)}subtractFromFloatsToRef(e,t,i,r,s){return s.r=this.r-e,s.g=this.g-t,s.b=this.b-i,s.a=this.a-r,s}scale(e){return new this.constructor(this.r*e,this.g*e,this.b*e,this.a*e)}scaleInPlace(e){return this.r*=e,this.g*=e,this.b*=e,this.a*=e,this}scaleToRef(e,t){return t.r=this.r*e,t.g=this.g*e,t.b=this.b*e,t.a=this.a*e,t}scaleAndAddToRef(e,t){return t.r+=this.r*e,t.g+=this.g*e,t.b+=this.b*e,t.a+=this.a*e,t}clampToRef(e=0,t=1,i){return i.r=si(this.r,e,t),i.g=si(this.g,e,t),i.b=si(this.b,e,t),i.a=si(this.a,e,t),i}multiply(e){return new this.constructor(this.r*e.r,this.g*e.g,this.b*e.b,this.a*e.a)}multiplyToRef(e,t){return t.r=this.r*e.r,t.g=this.g*e.g,t.b=this.b*e.b,t.a=this.a*e.a,t}multiplyInPlace(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this.a*=e.a,this}multiplyByFloats(e,t,i,r){return new this.constructor(this.r*e,this.g*t,this.b*i,this.a*r)}divide(e){throw new ReferenceError("Can not divide a color")}divideToRef(e,t){throw new ReferenceError("Can not divide a color")}divideInPlace(e){throw new ReferenceError("Can not divide a color")}minimizeInPlace(e){return this.r=Math.min(this.r,e.r),this.g=Math.min(this.g,e.g),this.b=Math.min(this.b,e.b),this.a=Math.min(this.a,e.a),this}maximizeInPlace(e){return this.r=Math.max(this.r,e.r),this.g=Math.max(this.g,e.g),this.b=Math.max(this.b,e.b),this.a=Math.max(this.a,e.a),this}minimizeInPlaceFromFloats(e,t,i,r){return this.r=Math.min(e,this.r),this.g=Math.min(t,this.g),this.b=Math.min(i,this.b),this.a=Math.min(r,this.a),this}maximizeInPlaceFromFloats(e,t,i,r){return this.r=Math.max(e,this.r),this.g=Math.max(t,this.g),this.b=Math.max(i,this.b),this.a=Math.max(r,this.a),this}floorToRef(e){throw new ReferenceError("Can not floor a color")}floor(){throw new ReferenceError("Can not floor a color")}fractToRef(e){throw new ReferenceError("Can not fract a color")}fract(){throw new ReferenceError("Can not fract a color")}negate(){throw new ReferenceError("Can not negate a color")}negateInPlace(){throw new ReferenceError("Can not negate a color")}negateToRef(e){throw new ReferenceError("Can not negate a color")}equalsWithEpsilon(e,t=xt){return Ye.WithinEpsilon(this.r,e.r,t)&&Ye.WithinEpsilon(this.g,e.g,t)&&Ye.WithinEpsilon(this.b,e.b,t)&&Ye.WithinEpsilon(this.a,e.a,t)}equalsToFloats(e,t,i,r){return this.r===e&&this.g===t&&this.b===i&&this.a===r}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"}getClassName(){return"Color4"}getHashCode(){let e=this.r*255|0;return e=e*397^(this.g*255|0),e=e*397^(this.b*255|0),e=e*397^(this.a*255|0),e}clone(){return new this.constructor().copyFrom(this)}copyFrom(e){return this.r=e.r,this.g=e.g,this.b=e.b,this.a=e.a,this}copyFromFloats(e,t,i,r){return this.r=e,this.g=t,this.b=i,this.a=r,this}set(e,t,i,r){return this.copyFromFloats(e,t,i,r)}setAll(e){return this.r=this.g=this.b=this.a=e,this}toHexString(e=!1){const t=Math.round(this.r*255),i=Math.round(this.g*255),r=Math.round(this.b*255);if(e)return"#"+Yr(t)+Yr(i)+Yr(r);const s=Math.round(this.a*255);return"#"+Yr(t)+Yr(i)+Yr(r)+Yr(s)}toLinearSpace(e=!1){const t=new $e;return this.toLinearSpaceToRef(t,e),t}toLinearSpaceToRef(e,t=!1){return t?(e.r=xo(this.r),e.g=xo(this.g),e.b=xo(this.b)):(e.r=To(this.r),e.g=To(this.g),e.b=To(this.b)),e.a=this.a,this}toGammaSpace(e=!1){const t=new $e;return this.toGammaSpaceToRef(t,e),t}toGammaSpaceToRef(e,t=!1){return t?(e.r=Ro(this.r),e.g=Ro(this.g),e.b=Ro(this.b)):(e.r=Co(this.r),e.g=Co(this.g),e.b=Co(this.b)),e.a=this.a,this}static FromHexString(e){if(e.substring(0,1)!=="#"||e.length!==9&&e.length!==7)return new $e(0,0,0,0);const t=parseInt(e.substring(1,3),16),i=parseInt(e.substring(3,5),16),r=parseInt(e.substring(5,7),16),s=e.length===9?parseInt(e.substring(7,9),16):255;return $e.FromInts(t,i,r,s)}static Lerp(e,t,i){const r=new $e(0,0,0,0);return $e.LerpToRef(e,t,i,r),r}static LerpToRef(e,t,i,r){r.r=e.r+(t.r-e.r)*i,r.g=e.g+(t.g-e.g)*i,r.b=e.b+(t.b-e.b)*i,r.a=e.a+(t.a-e.a)*i}static Hermite(e,t,i,r,s){const o=s*s,a=s*o,l=2*a-3*o+1,h=-2*a+3*o,c=a-2*o+s,u=a-o,d=e.r*l+i.r*h+t.r*c+r.r*u,f=e.g*l+i.g*h+t.g*c+r.g*u,p=e.b*l+i.b*h+t.b*c+r.b*u,g=e.a*l+i.a*h+t.a*c+r.a*u;return new $e(d,f,p,g)}static Hermite1stDerivative(e,t,i,r,s){const o=new $e;return this.Hermite1stDerivativeToRef(e,t,i,r,s,o),o}static Hermite1stDerivativeToRef(e,t,i,r,s,o){const a=s*s;o.r=(a-s)*6*e.r+(3*a-4*s+1)*t.r+(-a+s)*6*i.r+(3*a-2*s)*r.r,o.g=(a-s)*6*e.g+(3*a-4*s+1)*t.g+(-a+s)*6*i.g+(3*a-2*s)*r.g,o.b=(a-s)*6*e.b+(3*a-4*s+1)*t.b+(-a+s)*6*i.b+(3*a-2*s)*r.b,o.a=(a-s)*6*e.a+(3*a-4*s+1)*t.a+(-a+s)*6*i.a+(3*a-2*s)*r.a}static FromColor3(e,t=1){return new $e(e.r,e.g,e.b,t)}static FromArray(e,t=0){return new $e(e[t],e[t+1],e[t+2],e[t+3])}static FromArrayToRef(e,t=0,i){i.r=e[t],i.g=e[t+1],i.b=e[t+2],i.a=e[t+3]}static FromInts(e,t,i,r){return new $e(e/255,t/255,i/255,r/255)}static CheckColors4(e,t){if(e.length===t*3){const i=[];for(let r=0;r<e.length;r+=3){const s=r/3*4;i[s]=e[r],i[s+1]=e[r+1],i[s+2]=e[r+2],i[s+3]=1}return i}return e}}Object.defineProperties($e.prototype,{dimension:{value:[4]},rank:{value:1}});class Qr{}Qr.Color3=Ci.BuildArray(3,De.Black);Qr.Color4=Ci.BuildArray(3,()=>new $e(0,0,0,0));ye("BABYLON.Color3",De);ye("BABYLON.Color4",$e);const ug=function(n,e,t,i={}){const r=n();it&&it.HasTags(e)&&it.AddTagsTo(r,it.GetTags(e,!0));const s=Iu(r),o={};for(const a in s){const l=s[a],h=e[a],c=l.type;if(h!=null&&(a!=="uniqueId"||Le.AllowLoadingUniqueId))switch(c){case 0:case 6:case 11:r[a]=h;break;case 1:i.cloneTexturesOnlyOnce&&o[h.uniqueId]?r[a]=o[h.uniqueId]:(r[a]=t||h.isRenderTarget?h:h.clone(),o[h.uniqueId]=r[a]);break;case 2:case 3:case 4:case 5:case 7:case 10:case 12:r[a]=t?h:h.clone();break}}return r};class Le{static AppendSerializedAnimations(e,t){if(e.animations){t.animations=[];for(let i=0;i<e.animations.length;i++){const r=e.animations[i];t.animations.push(r.serialize())}}}static Serialize(e,t){t||(t={}),it&&(t.tags=it.GetTags(e));const i=Iu(e);for(const r in i){const s=i[r],o=s.sourceName||r,a=s.type,l=e[r];if(l!=null&&(r!=="uniqueId"||Le.AllowLoadingUniqueId))switch(a){case 0:t[o]=l;break;case 1:t[o]=l.serialize();break;case 2:t[o]=l.asArray();break;case 3:t[o]=l.serialize();break;case 4:t[o]=l.asArray();break;case 5:t[o]=l.asArray();break;case 6:t[o]=l.id;break;case 7:t[o]=l.serialize();break;case 8:t[o]=l.asArray();break;case 9:t[o]=l.serialize();break;case 10:t[o]=l.asArray();break;case 11:t[o]=l.id;break;case 12:t[o]=l.asArray();break}}return t}static ParseProperties(e,t,i,r){r||(r="");const s=Iu(t);for(const o in s){const a=s[o],l=e[a.sourceName||o],h=a.type;if(l!=null&&(o!=="uniqueId"||Le.AllowLoadingUniqueId)){const c=t;switch(h){case 0:c[o]=l;break;case 1:i&&(c[o]=Le._TextureParser(l,i,r));break;case 2:c[o]=De.FromArray(l);break;case 3:c[o]=Le._FresnelParametersParser(l);break;case 4:c[o]=me.FromArray(l);break;case 5:c[o]=v.FromArray(l);break;case 6:i&&(c[o]=i.getLastMeshById(l));break;case 7:c[o]=Le._ColorCurvesParser(l);break;case 8:c[o]=$e.FromArray(l);break;case 9:c[o]=Le._ImageProcessingConfigurationParser(l);break;case 10:c[o]=Re.FromArray(l);break;case 11:i&&(c[o]=i.getCameraById(l));break;case 12:c[o]=U.FromArray(l);break}}}}static Parse(e,t,i,r=null){const s=e();return it&&it.AddTagsTo(s,t.tags),Le.ParseProperties(t,s,i,r),s}static Clone(e,t,i={}){return ug(e,t,!1,i)}static Instanciate(e,t){return ug(e,t,!0)}}Le.AllowLoadingUniqueId=!1;Le._ImageProcessingConfigurationParser=n=>{throw Ge("ImageProcessingConfiguration")};Le._FresnelParametersParser=n=>{throw Ge("FresnelParameters")};Le._ColorCurvesParser=n=>{throw Ge("ColorCurves")};Le._TextureParser=(n,e,t)=>{throw Ge("Texture")};function c0(n){n.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")}class Ht{constructor(){this._dirty=!0,this._tempColor=new $e(0,0,0,0),this._globalCurve=new $e(0,0,0,0),this._highlightsCurve=new $e(0,0,0,0),this._midtonesCurve=new $e(0,0,0,0),this._shadowsCurve=new $e(0,0,0,0),this._positiveCurve=new $e(0,0,0,0),this._negativeCurve=new $e(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}get globalHue(){return this._globalHue}set globalHue(e){this._globalHue=e,this._dirty=!0}get globalDensity(){return this._globalDensity}set globalDensity(e){this._globalDensity=e,this._dirty=!0}get globalSaturation(){return this._globalSaturation}set globalSaturation(e){this._globalSaturation=e,this._dirty=!0}get globalExposure(){return this._globalExposure}set globalExposure(e){this._globalExposure=e,this._dirty=!0}get highlightsHue(){return this._highlightsHue}set highlightsHue(e){this._highlightsHue=e,this._dirty=!0}get highlightsDensity(){return this._highlightsDensity}set highlightsDensity(e){this._highlightsDensity=e,this._dirty=!0}get highlightsSaturation(){return this._highlightsSaturation}set highlightsSaturation(e){this._highlightsSaturation=e,this._dirty=!0}get highlightsExposure(){return this._highlightsExposure}set highlightsExposure(e){this._highlightsExposure=e,this._dirty=!0}get midtonesHue(){return this._midtonesHue}set midtonesHue(e){this._midtonesHue=e,this._dirty=!0}get midtonesDensity(){return this._midtonesDensity}set midtonesDensity(e){this._midtonesDensity=e,this._dirty=!0}get midtonesSaturation(){return this._midtonesSaturation}set midtonesSaturation(e){this._midtonesSaturation=e,this._dirty=!0}get midtonesExposure(){return this._midtonesExposure}set midtonesExposure(e){this._midtonesExposure=e,this._dirty=!0}get shadowsHue(){return this._shadowsHue}set shadowsHue(e){this._shadowsHue=e,this._dirty=!0}get shadowsDensity(){return this._shadowsDensity}set shadowsDensity(e){this._shadowsDensity=e,this._dirty=!0}get shadowsSaturation(){return this._shadowsSaturation}set shadowsSaturation(e){this._shadowsSaturation=e,this._dirty=!0}get shadowsExposure(){return this._shadowsExposure}set shadowsExposure(e){this._shadowsExposure=e,this._dirty=!0}getClassName(){return"ColorCurves"}static Bind(e,t,i="vCameraColorCurvePositive",r="vCameraColorCurveNeutral",s="vCameraColorCurveNegative"){e._dirty&&(e._dirty=!1,e._getColorGradingDataToRef(e._globalHue,e._globalDensity,e._globalSaturation,e._globalExposure,e._globalCurve),e._getColorGradingDataToRef(e._highlightsHue,e._highlightsDensity,e._highlightsSaturation,e._highlightsExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._highlightsCurve),e._getColorGradingDataToRef(e._midtonesHue,e._midtonesDensity,e._midtonesSaturation,e._midtonesExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._midtonesCurve),e._getColorGradingDataToRef(e._shadowsHue,e._shadowsDensity,e._shadowsSaturation,e._shadowsExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._shadowsCurve),e._highlightsCurve.subtractToRef(e._midtonesCurve,e._positiveCurve),e._midtonesCurve.subtractToRef(e._shadowsCurve,e._negativeCurve)),t&&(t.setFloat4(i,e._positiveCurve.r,e._positiveCurve.g,e._positiveCurve.b,e._positiveCurve.a),t.setFloat4(r,e._midtonesCurve.r,e._midtonesCurve.g,e._midtonesCurve.b,e._midtonesCurve.a),t.setFloat4(s,e._negativeCurve.r,e._negativeCurve.g,e._negativeCurve.b,e._negativeCurve.a))}_getColorGradingDataToRef(e,t,i,r,s){e!=null&&(e=Ht._Clamp(e,0,360),t=Ht._Clamp(t,-100,100),i=Ht._Clamp(i,-100,100),r=Ht._Clamp(r,-100,100),t=Ht._ApplyColorGradingSliderNonlinear(t),t*=.5,r=Ht._ApplyColorGradingSliderNonlinear(r),t<0&&(t*=-1,e=(e+180)%360),Ht._FromHSBToRef(e,t,50+.25*r,s),s.scaleToRef(2,s),s.a=1+.01*i)}static _ApplyColorGradingSliderNonlinear(e){e/=100;let t=Math.abs(e);return t=Math.pow(t,2),e<0&&(t*=-1),t*=100,t}static _FromHSBToRef(e,t,i,r){let s=Ht._Clamp(e,0,360);const o=Ht._Clamp(t/100,0,1),a=Ht._Clamp(i/100,0,1);if(o===0)r.r=a,r.g=a,r.b=a;else{s/=60;const l=Math.floor(s),h=s-l,c=a*(1-o),u=a*(1-o*h),d=a*(1-o*(1-h));switch(l){case 0:r.r=a,r.g=d,r.b=c;break;case 1:r.r=u,r.g=a,r.b=c;break;case 2:r.r=c,r.g=a,r.b=d;break;case 3:r.r=c,r.g=u,r.b=a;break;case 4:r.r=d,r.g=c,r.b=a;break;default:r.r=a,r.g=c,r.b=u;break}}r.a=1}static _Clamp(e,t,i){return Math.min(Math.max(e,t),i)}clone(){return Le.Clone(()=>new Ht,this)}serialize(){return Le.Serialize(this)}static Parse(e){return Le.Parse(()=>new Ht,e,null,null)}}Ht.PrepareUniforms=c0;M([V()],Ht.prototype,"_globalHue",void 0);M([V()],Ht.prototype,"_globalDensity",void 0);M([V()],Ht.prototype,"_globalSaturation",void 0);M([V()],Ht.prototype,"_globalExposure",void 0);M([V()],Ht.prototype,"_highlightsHue",void 0);M([V()],Ht.prototype,"_highlightsDensity",void 0);M([V()],Ht.prototype,"_highlightsSaturation",void 0);M([V()],Ht.prototype,"_highlightsExposure",void 0);M([V()],Ht.prototype,"_midtonesHue",void 0);M([V()],Ht.prototype,"_midtonesDensity",void 0);M([V()],Ht.prototype,"_midtonesSaturation",void 0);M([V()],Ht.prototype,"_midtonesExposure",void 0);Le._ColorCurvesParser=Ht.Parse;function Sy(n,e){e.EXPOSURE&&n.push("exposureLinear"),e.CONTRAST&&n.push("contrast"),e.COLORGRADING&&n.push("colorTransformSettings"),(e.VIGNETTE||e.DITHER)&&n.push("vInverseScreenSize"),e.VIGNETTE&&(n.push("vignetteSettings1"),n.push("vignetteSettings2")),e.COLORCURVES&&c0(n),e.DITHER&&n.push("ditherIntensity")}function yy(n,e){e.COLORGRADING&&n.push("txColorTransform")}class nt{constructor(){this.colorCurves=new Ht,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=nt.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCenterX=0,this.vignetteCenterY=0,this.vignetteWeight=1.5,this.vignetteColor=new $e(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=nt.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._ditheringEnabled=!1,this._ditheringIntensity=1/255,this._skipFinalColorClamp=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.onUpdateParameters=new he}get colorCurvesEnabled(){return this._colorCurvesEnabled}set colorCurvesEnabled(e){this._colorCurvesEnabled!==e&&(this._colorCurvesEnabled=e,this._updateParameters())}get colorGradingTexture(){return this._colorGradingTexture}set colorGradingTexture(e){this._colorGradingTexture!==e&&(this._colorGradingTexture=e,this._updateParameters())}get colorGradingEnabled(){return this._colorGradingEnabled}set colorGradingEnabled(e){this._colorGradingEnabled!==e&&(this._colorGradingEnabled=e,this._updateParameters())}get colorGradingWithGreenDepth(){return this._colorGradingWithGreenDepth}set colorGradingWithGreenDepth(e){this._colorGradingWithGreenDepth!==e&&(this._colorGradingWithGreenDepth=e,this._updateParameters())}get colorGradingBGR(){return this._colorGradingBGR}set colorGradingBGR(e){this._colorGradingBGR!==e&&(this._colorGradingBGR=e,this._updateParameters())}get exposure(){return this._exposure}set exposure(e){this._exposure!==e&&(this._exposure=e,this._updateParameters())}get toneMappingEnabled(){return this._toneMappingEnabled}set toneMappingEnabled(e){this._toneMappingEnabled!==e&&(this._toneMappingEnabled=e,this._updateParameters())}get toneMappingType(){return this._toneMappingType}set toneMappingType(e){this._toneMappingType!==e&&(this._toneMappingType=e,this._updateParameters())}get contrast(){return this._contrast}set contrast(e){this._contrast!==e&&(this._contrast=e,this._updateParameters())}get vignetteCentreY(){return this.vignetteCenterY}set vignetteCentreY(e){this.vignetteCenterY=e}get vignetteCentreX(){return this.vignetteCenterX}set vignetteCentreX(e){this.vignetteCenterX=e}get vignetteBlendMode(){return this._vignetteBlendMode}set vignetteBlendMode(e){this._vignetteBlendMode!==e&&(this._vignetteBlendMode=e,this._updateParameters())}get vignetteEnabled(){return this._vignetteEnabled}set vignetteEnabled(e){this._vignetteEnabled!==e&&(this._vignetteEnabled=e,this._updateParameters())}get ditheringEnabled(){return this._ditheringEnabled}set ditheringEnabled(e){this._ditheringEnabled!==e&&(this._ditheringEnabled=e,this._updateParameters())}get ditheringIntensity(){return this._ditheringIntensity}set ditheringIntensity(e){this._ditheringIntensity!==e&&(this._ditheringIntensity=e,this._updateParameters())}get skipFinalColorClamp(){return this._skipFinalColorClamp}set skipFinalColorClamp(e){this._skipFinalColorClamp!==e&&(this._skipFinalColorClamp=e,this._updateParameters())}get applyByPostProcess(){return this._applyByPostProcess}set applyByPostProcess(e){this._applyByPostProcess!==e&&(this._applyByPostProcess=e,this._updateParameters())}get isEnabled(){return this._isEnabled}set isEnabled(e){this._isEnabled!==e&&(this._isEnabled=e,this._updateParameters())}_updateParameters(){this.onUpdateParameters.notifyObservers(this)}getClassName(){return"ImageProcessingConfiguration"}prepareDefines(e,t=!1){if(t!==this.applyByPostProcess||!this._isEnabled){e.VIGNETTE=!1,e.TONEMAPPING=!1,e.TONEMAPPING_ACES=!1,e.CONTRAST=!1,e.EXPOSURE=!1,e.COLORCURVES=!1,e.COLORGRADING=!1,e.COLORGRADING3D=!1,e.DITHER=!1,e.IMAGEPROCESSING=!1,e.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,e.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled;return}switch(e.VIGNETTE=this.vignetteEnabled,e.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===nt._VIGNETTEMODE_MULTIPLY,e.VIGNETTEBLENDMODEOPAQUE=!e.VIGNETTEBLENDMODEMULTIPLY,e.TONEMAPPING=this.toneMappingEnabled,this._toneMappingType){case nt.TONEMAPPING_ACES:e.TONEMAPPING_ACES=!0;break;default:e.TONEMAPPING_ACES=!1;break}e.CONTRAST=this.contrast!==1,e.EXPOSURE=this.exposure!==1,e.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,e.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,e.COLORGRADING?e.COLORGRADING3D=this.colorGradingTexture.is3D:e.COLORGRADING3D=!1,e.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,e.SAMPLER3DBGRMAP=this.colorGradingBGR,e.DITHER=this._ditheringEnabled,e.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,e.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,e.IMAGEPROCESSING=e.VIGNETTE||e.TONEMAPPING||e.CONTRAST||e.EXPOSURE||e.COLORCURVES||e.COLORGRADING||e.DITHER}isReady(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()}bind(e,t){if(this._colorCurvesEnabled&&this.colorCurves&&Ht.Bind(this.colorCurves,e),this._vignetteEnabled||this._ditheringEnabled){const i=1/e.getEngine().getRenderWidth(),r=1/e.getEngine().getRenderHeight();if(e.setFloat2("vInverseScreenSize",i,r),this._ditheringEnabled&&e.setFloat("ditherIntensity",.5*this._ditheringIntensity),this._vignetteEnabled){const s=t??r/i;let o=Math.tan(this.vignetteCameraFov*.5),a=o*s;const l=Math.sqrt(a*o);a=bu(a,l,this.vignetteStretch),o=bu(o,l,this.vignetteStretch),e.setFloat4("vignetteSettings1",a,o,-a*this.vignetteCenterX,-o*this.vignetteCenterY);const h=-2*this.vignetteWeight;e.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,h)}}if(e.setFloat("exposureLinear",this.exposure),e.setFloat("contrast",this.contrast),this.colorGradingTexture){e.setTexture("txColorTransform",this.colorGradingTexture);const i=this.colorGradingTexture.getSize().height;e.setFloat4("colorTransformSettings",(i-1)/i,.5/i,i,this.colorGradingTexture.level)}}clone(){return Le.Clone(()=>new nt,this)}serialize(){return Le.Serialize(this)}static Parse(e){const t=Le.Parse(()=>new nt,e,null,null);return e.vignetteCentreX!==void 0&&(t.vignetteCenterX=e.vignetteCentreX),e.vignetteCentreY!==void 0&&(t.vignetteCenterY=e.vignetteCentreY),t}static get VIGNETTEMODE_MULTIPLY(){return this._VIGNETTEMODE_MULTIPLY}static get VIGNETTEMODE_OPAQUE(){return this._VIGNETTEMODE_OPAQUE}}nt.TONEMAPPING_STANDARD=0;nt.TONEMAPPING_ACES=1;nt.PrepareUniforms=Sy;nt.PrepareSamplers=yy;nt._VIGNETTEMODE_MULTIPLY=0;nt._VIGNETTEMODE_OPAQUE=1;M([xy()],nt.prototype,"colorCurves",void 0);M([V()],nt.prototype,"_colorCurvesEnabled",void 0);M([Tt("colorGradingTexture")],nt.prototype,"_colorGradingTexture",void 0);M([V()],nt.prototype,"_colorGradingEnabled",void 0);M([V()],nt.prototype,"_colorGradingWithGreenDepth",void 0);M([V()],nt.prototype,"_colorGradingBGR",void 0);M([V()],nt.prototype,"_exposure",void 0);M([V()],nt.prototype,"_toneMappingEnabled",void 0);M([V()],nt.prototype,"_toneMappingType",void 0);M([V()],nt.prototype,"_contrast",void 0);M([V()],nt.prototype,"vignetteStretch",void 0);M([V()],nt.prototype,"vignetteCenterX",void 0);M([V()],nt.prototype,"vignetteCenterY",void 0);M([V()],nt.prototype,"vignetteWeight",void 0);M([l0()],nt.prototype,"vignetteColor",void 0);M([V()],nt.prototype,"vignetteCameraFov",void 0);M([V()],nt.prototype,"_vignetteBlendMode",void 0);M([V()],nt.prototype,"_vignetteEnabled",void 0);M([V()],nt.prototype,"_ditheringEnabled",void 0);M([V()],nt.prototype,"_ditheringIntensity",void 0);M([V()],nt.prototype,"_skipFinalColorClamp",void 0);M([V()],nt.prototype,"_applyByPostProcess",void 0);M([V()],nt.prototype,"_isEnabled",void 0);Le._ImageProcessingConfigurationParser=nt.Parse;Oe.prototype.createUniformBuffer=function(n,e){const t=this._gl.createBuffer();if(!t)throw new Error("Unable to create uniform buffer");const i=new Ta(t);return this.bindUniformBuffer(i),n instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,n,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(n),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),i.references=1,i};Oe.prototype.createDynamicUniformBuffer=function(n,e){const t=this._gl.createBuffer();if(!t)throw new Error("Unable to create dynamic uniform buffer");const i=new Ta(t);return this.bindUniformBuffer(i),n instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,n,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(n),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),i.references=1,i};Oe.prototype.updateUniformBuffer=function(n,e,t,i){this.bindUniformBuffer(n),t===void 0&&(t=0),i===void 0?e instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,t,e):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,t,new Float32Array(e)):e instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,e.subarray(t,t+i)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(e).subarray(t,t+i)),this.bindUniformBuffer(null)};Oe.prototype.bindUniformBuffer=function(n){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,n?n.underlyingResource:null)};Oe.prototype.bindUniformBufferBase=function(n,e,t){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,e,n?n.underlyingResource:null)};Oe.prototype.bindUniformBlock=function(n,e,t){const i=n.program,r=this._gl.getUniformBlockIndex(i,e);r!==4294967295&&this._gl.uniformBlockBinding(i,r,t)};class Ie{constructor(e,t,i,r,s=!1){this._valueCache={},this._engine=e,this._noUBO=!e.supportsUniformBuffers||s,this._dynamic=i,this._name=r??"no-name",this._data=t||[],this._uniformLocations={},this._uniformSizes={},this._uniformArraySizes={},this._uniformLocationPointer=0,this._needSync=!1,this._engine._features.trackUbosInFrame&&(this._buffers=[],this._bufferIndex=-1,this._createBufferOnWrite=!1,this._currentFrameId=0),this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateFloatArray=this._updateFloatArrayForEffect,this.updateArray=this._updateArrayForEffect,this.updateIntArray=this._updateIntArrayForEffect,this.updateUIntArray=this._updateUIntArrayForEffect,this.updateMatrix=this._updateMatrixForEffect,this.updateMatrices=this._updateMatricesForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect,this.updateDirectColor4=this._updateDirectColor4ForEffect,this.updateInt=this._updateIntForEffect,this.updateInt2=this._updateInt2ForEffect,this.updateInt3=this._updateInt3ForEffect,this.updateInt4=this._updateInt4ForEffect,this.updateUInt=this._updateUIntForEffect,this.updateUInt2=this._updateUInt2ForEffect,this.updateUInt3=this._updateUInt3ForEffect,this.updateUInt4=this._updateUInt4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateFloatArray=this._updateFloatArrayForUniform,this.updateArray=this._updateArrayForUniform,this.updateIntArray=this._updateIntArrayForUniform,this.updateUIntArray=this._updateUIntArrayForUniform,this.updateMatrix=this._updateMatrixForUniform,this.updateMatrices=this._updateMatricesForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform,this.updateDirectColor4=this._updateDirectColor4ForUniform,this.updateInt=this._updateIntForUniform,this.updateInt2=this._updateInt2ForUniform,this.updateInt3=this._updateInt3ForUniform,this.updateInt4=this._updateInt4ForUniform,this.updateUInt=this._updateUIntForUniform,this.updateUInt2=this._updateUInt2ForUniform,this.updateUInt3=this._updateUInt3ForUniform,this.updateUInt4=this._updateUInt4ForUniform)}get useUbo(){return!this._noUBO}get isSync(){return!this._needSync}isDynamic(){return this._dynamic!==void 0}getData(){return this._bufferData}getBuffer(){return this._buffer}_fillAlignment(e){let t;if(e<=2?t=e:t=4,this._uniformLocationPointer%t!==0){const i=this._uniformLocationPointer;this._uniformLocationPointer+=t-this._uniformLocationPointer%t;const r=this._uniformLocationPointer-i;for(let s=0;s<r;s++)this._data.push(0)}}addUniform(e,t,i=0){if(this._noUBO||this._uniformLocations[e]!==void 0)return;let r;if(i>0){if(t instanceof Array)throw"addUniform should not be use with Array in UBO: "+e;if(this._fillAlignment(4),this._uniformArraySizes[e]={strideSize:t,arraySize:i},t==16)t=t*i;else{const s=(4-t)*i;t=t*i+s}r=[];for(let s=0;s<t;s++)r.push(0)}else{if(t instanceof Array)r=t,t=r.length;else{t=t,r=[];for(let s=0;s<t;s++)r.push(0)}this._fillAlignment(t)}this._uniformSizes[e]=t,this._uniformLocations[e]=this._uniformLocationPointer,this._uniformLocationPointer+=t;for(let s=0;s<t;s++)this._data.push(r[s]);this._needSync=!0}addMatrix(e,t){this.addUniform(e,Array.prototype.slice.call(t.asArray()))}addFloat2(e,t,i){const r=[t,i];this.addUniform(e,r)}addFloat3(e,t,i,r){const s=[t,i,r];this.addUniform(e,s)}addColor3(e,t){const i=[t.r,t.g,t.b];this.addUniform(e,i)}addColor4(e,t,i){const r=[t.r,t.g,t.b,i];this.addUniform(e,r)}addVector3(e,t){const i=[t.x,t.y,t.z];this.addUniform(e,i)}addMatrix3x3(e){this.addUniform(e,12)}addMatrix2x2(e){this.addUniform(e,8)}create(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)}_getNames(){const e=[];let t=0;for(const i in this._uniformLocations)if(e.push(i),++t===10)break;return e.join(",")}_rebuild(){this._noUBO||!this._bufferData||(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()):this._buffer=this._engine.createUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()),this._engine._features.trackUbosInFrame&&(this._buffers.push([this._buffer,this._engine._features.checkUbosContentBeforeUpload?this._bufferData.slice():void 0]),this._bufferIndex=this._buffers.length-1,this._createBufferOnWrite=!1))}_rebuildAfterContextLost(){this._engine._features.trackUbosInFrame&&(this._buffers=[],this._currentFrameId=0),this._rebuild()}get _numBuffers(){return this._buffers.length}get _indexBuffer(){return this._bufferIndex}get name(){return this._name}get currentEffect(){return this._currentEffect}_buffersEqual(e,t){for(let i=0;i<e.length;++i)if(e[i]!==t[i])return!1;return!0}_copyBuffer(e,t){for(let i=0;i<e.length;++i)t[i]=e[i]}update(){if(!this._noUBO){if(this.bindUniformBuffer(),!this._buffer){this.create();return}if(!this._dynamic&&!this._needSync){this._createBufferOnWrite=this._engine._features.trackUbosInFrame;return}if(this._buffers&&this._buffers.length>1&&this._buffers[this._bufferIndex][1])if(this._buffersEqual(this._bufferData,this._buffers[this._bufferIndex][1])){this._needSync=!1,this._createBufferOnWrite=this._engine._features.trackUbosInFrame;return}else this._copyBuffer(this._bufferData,this._buffers[this._bufferIndex][1]);this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._engine._features._collectUbosUpdatedInFrame&&(Ie._UpdatedUbosInFrame[this._name]||(Ie._UpdatedUbosInFrame[this._name]=0),Ie._UpdatedUbosInFrame[this._name]++),this._needSync=!1,this._createBufferOnWrite=this._engine._features.trackUbosInFrame}}_createNewBuffer(){this._bufferIndex+1<this._buffers.length?(this._bufferIndex++,this._buffer=this._buffers[this._bufferIndex][0],this._createBufferOnWrite=!1,this._needSync=!0):this._rebuild()}_checkNewFrame(){this._engine._features.trackUbosInFrame&&this._currentFrameId!==this._engine.frameId&&(this._currentFrameId=this._engine.frameId,this._createBufferOnWrite=!1,this._buffers&&this._buffers.length>0?(this._needSync=this._bufferIndex!==0,this._bufferIndex=0,this._buffer=this._buffers[this._bufferIndex][0]):this._bufferIndex=-1)}updateUniform(e,t,i){this._checkNewFrame();let r=this._uniformLocations[e];if(r===void 0){if(this._buffer){oe.Error("Cannot add an uniform after UBO has been created. uniformName="+e);return}this.addUniform(e,i),r=this._uniformLocations[e]}if(this._buffer||this.create(),this._dynamic)for(let s=0;s<i;s++)this._bufferData[r+s]=t[s];else{let s=!1;for(let o=0;o<i;o++)(i===16&&!this._engine._features.uniformBufferHardCheckMatrix||this._bufferData[r+o]!==Math.fround(t[o]))&&(s=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[r+o]=t[o]);this._needSync=this._needSync||s}}updateUniformArray(e,t,i){this._checkNewFrame();const r=this._uniformLocations[e];if(r===void 0){oe.Error("Cannot add an uniform Array dynamically. Please, add it using addUniform and make sure that uniform buffers are supported by the current engine.");return}this._buffer||this.create();const s=this._uniformArraySizes[e];if(this._dynamic)for(let o=0;o<i;o++)this._bufferData[r+o]=t[o];else{let o=!1,a=0,l=0;for(let h=0;h<i;h++)if(this._bufferData[r+l*4+a]!==ge.FloatRound(t[h])&&(o=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[r+l*4+a]=t[h]),a++,a===s.strideSize){for(;a<4;a++)this._bufferData[r+l*4+a]=0;a=0,l++}this._needSync=this._needSync||o}}_cacheMatrix(e,t){this._checkNewFrame();const i=this._valueCache[e],r=t.updateFlag;return i!==void 0&&i===r?!1:(this._valueCache[e]=r,!0)}_updateMatrix3x3ForUniform(e,t){for(let i=0;i<3;i++)Ie._TempBuffer[i*4]=t[i*3],Ie._TempBuffer[i*4+1]=t[i*3+1],Ie._TempBuffer[i*4+2]=t[i*3+2],Ie._TempBuffer[i*4+3]=0;this.updateUniform(e,Ie._TempBuffer,12)}_updateMatrix3x3ForEffect(e,t){this._currentEffect.setMatrix3x3(e,t)}_updateMatrix2x2ForEffect(e,t){this._currentEffect.setMatrix2x2(e,t)}_updateMatrix2x2ForUniform(e,t){for(let i=0;i<2;i++)Ie._TempBuffer[i*4]=t[i*2],Ie._TempBuffer[i*4+1]=t[i*2+1],Ie._TempBuffer[i*4+2]=0,Ie._TempBuffer[i*4+3]=0;this.updateUniform(e,Ie._TempBuffer,8)}_updateFloatForEffect(e,t){this._currentEffect.setFloat(e,t)}_updateFloatForUniform(e,t){Ie._TempBuffer[0]=t,this.updateUniform(e,Ie._TempBuffer,1)}_updateFloat2ForEffect(e,t,i,r=""){this._currentEffect.setFloat2(e+r,t,i)}_updateFloat2ForUniform(e,t,i){Ie._TempBuffer[0]=t,Ie._TempBuffer[1]=i,this.updateUniform(e,Ie._TempBuffer,2)}_updateFloat3ForEffect(e,t,i,r,s=""){this._currentEffect.setFloat3(e+s,t,i,r)}_updateFloat3ForUniform(e,t,i,r){Ie._TempBuffer[0]=t,Ie._TempBuffer[1]=i,Ie._TempBuffer[2]=r,this.updateUniform(e,Ie._TempBuffer,3)}_updateFloat4ForEffect(e,t,i,r,s,o=""){this._currentEffect.setFloat4(e+o,t,i,r,s)}_updateFloat4ForUniform(e,t,i,r,s){Ie._TempBuffer[0]=t,Ie._TempBuffer[1]=i,Ie._TempBuffer[2]=r,Ie._TempBuffer[3]=s,this.updateUniform(e,Ie._TempBuffer,4)}_updateFloatArrayForEffect(e,t){this._currentEffect.setFloatArray(e,t)}_updateFloatArrayForUniform(e,t){this.updateUniformArray(e,t,t.length)}_updateArrayForEffect(e,t){this._currentEffect.setArray(e,t)}_updateArrayForUniform(e,t){this.updateUniformArray(e,t,t.length)}_updateIntArrayForEffect(e,t){this._currentEffect.setIntArray(e,t)}_updateIntArrayForUniform(e,t){Ie._TempBufferInt32View.set(t),this.updateUniformArray(e,Ie._TempBuffer,t.length)}_updateUIntArrayForEffect(e,t){this._currentEffect.setUIntArray(e,t)}_updateUIntArrayForUniform(e,t){Ie._TempBufferUInt32View.set(t),this.updateUniformArray(e,Ie._TempBuffer,t.length)}_updateMatrixForEffect(e,t){this._currentEffect.setMatrix(e,t)}_updateMatrixForUniform(e,t){this._cacheMatrix(e,t)&&this.updateUniform(e,t.asArray(),16)}_updateMatricesForEffect(e,t){this._currentEffect.setMatrices(e,t)}_updateMatricesForUniform(e,t){this.updateUniform(e,t,t.length)}_updateVector3ForEffect(e,t){this._currentEffect.setVector3(e,t)}_updateVector3ForUniform(e,t){Ie._TempBuffer[0]=t.x,Ie._TempBuffer[1]=t.y,Ie._TempBuffer[2]=t.z,this.updateUniform(e,Ie._TempBuffer,3)}_updateVector4ForEffect(e,t){this._currentEffect.setVector4(e,t)}_updateVector4ForUniform(e,t){Ie._TempBuffer[0]=t.x,Ie._TempBuffer[1]=t.y,Ie._TempBuffer[2]=t.z,Ie._TempBuffer[3]=t.w,this.updateUniform(e,Ie._TempBuffer,4)}_updateColor3ForEffect(e,t,i=""){this._currentEffect.setColor3(e+i,t)}_updateColor3ForUniform(e,t){Ie._TempBuffer[0]=t.r,Ie._TempBuffer[1]=t.g,Ie._TempBuffer[2]=t.b,this.updateUniform(e,Ie._TempBuffer,3)}_updateColor4ForEffect(e,t,i,r=""){this._currentEffect.setColor4(e+r,t,i)}_updateDirectColor4ForEffect(e,t,i=""){this._currentEffect.setDirectColor4(e+i,t)}_updateColor4ForUniform(e,t,i){Ie._TempBuffer[0]=t.r,Ie._TempBuffer[1]=t.g,Ie._TempBuffer[2]=t.b,Ie._TempBuffer[3]=i,this.updateUniform(e,Ie._TempBuffer,4)}_updateDirectColor4ForUniform(e,t){Ie._TempBuffer[0]=t.r,Ie._TempBuffer[1]=t.g,Ie._TempBuffer[2]=t.b,Ie._TempBuffer[3]=t.a,this.updateUniform(e,Ie._TempBuffer,4)}_updateIntForEffect(e,t,i=""){this._currentEffect.setInt(e+i,t)}_updateIntForUniform(e,t){Ie._TempBufferInt32View[0]=t,this.updateUniform(e,Ie._TempBuffer,1)}_updateInt2ForEffect(e,t,i,r=""){this._currentEffect.setInt2(e+r,t,i)}_updateInt2ForUniform(e,t,i){Ie._TempBufferInt32View[0]=t,Ie._TempBufferInt32View[1]=i,this.updateUniform(e,Ie._TempBuffer,2)}_updateInt3ForEffect(e,t,i,r,s=""){this._currentEffect.setInt3(e+s,t,i,r)}_updateInt3ForUniform(e,t,i,r){Ie._TempBufferInt32View[0]=t,Ie._TempBufferInt32View[1]=i,Ie._TempBufferInt32View[2]=r,this.updateUniform(e,Ie._TempBuffer,3)}_updateInt4ForEffect(e,t,i,r,s,o=""){this._currentEffect.setInt4(e+o,t,i,r,s)}_updateInt4ForUniform(e,t,i,r,s){Ie._TempBufferInt32View[0]=t,Ie._TempBufferInt32View[1]=i,Ie._TempBufferInt32View[2]=r,Ie._TempBufferInt32View[3]=s,this.updateUniform(e,Ie._TempBuffer,4)}_updateUIntForEffect(e,t,i=""){this._currentEffect.setUInt(e+i,t)}_updateUIntForUniform(e,t){Ie._TempBufferUInt32View[0]=t,this.updateUniform(e,Ie._TempBuffer,1)}_updateUInt2ForEffect(e,t,i,r=""){this._currentEffect.setUInt2(e+r,t,i)}_updateUInt2ForUniform(e,t,i){Ie._TempBufferUInt32View[0]=t,Ie._TempBufferUInt32View[1]=i,this.updateUniform(e,Ie._TempBuffer,2)}_updateUInt3ForEffect(e,t,i,r,s=""){this._currentEffect.setUInt3(e+s,t,i,r)}_updateUInt3ForUniform(e,t,i,r){Ie._TempBufferUInt32View[0]=t,Ie._TempBufferUInt32View[1]=i,Ie._TempBufferUInt32View[2]=r,this.updateUniform(e,Ie._TempBuffer,3)}_updateUInt4ForEffect(e,t,i,r,s,o=""){this._currentEffect.setUInt4(e+o,t,i,r,s)}_updateUInt4ForUniform(e,t,i,r,s){Ie._TempBufferUInt32View[0]=t,Ie._TempBufferUInt32View[1]=i,Ie._TempBufferUInt32View[2]=r,Ie._TempBufferUInt32View[3]=s,this.updateUniform(e,Ie._TempBuffer,4)}setTexture(e,t){this._currentEffect.setTexture(e,t)}bindTexture(e,t){this._currentEffect._bindTexture(e,t)}updateUniformDirectly(e,t){this.updateUniform(e,t,t.length),this.update()}bindToEffect(e,t){this._currentEffect=e,this._currentEffectName=t}bindUniformBuffer(){!this._noUBO&&this._buffer&&this._currentEffect&&this._currentEffect.bindUniformBuffer(this._buffer,this._currentEffectName)}unbindEffect(){this._currentEffect=void 0,this._currentEffectName=void 0}setDataBuffer(e){if(!this._buffers)return this._buffer===e;for(let t=0;t<this._buffers.length;++t)if(this._buffers[t][0]===e)return this._bufferIndex=t,this._buffer=e,this._createBufferOnWrite=!1,this._currentEffect=void 0,!0;return!1}dispose(){if(this._noUBO)return;const e=this._engine._uniformBuffers,t=e.indexOf(this);if(t!==-1&&(e[t]=e[e.length-1],e.pop()),this._engine._features.trackUbosInFrame&&this._buffers)for(let i=0;i<this._buffers.length;++i){const r=this._buffers[i][0];this._engine._releaseBuffer(r)}else this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}}Ie._UpdatedUbosInFrame={};Ie._MAX_UNIFORM_SIZE=256;Ie._TempBuffer=new Float32Array(Ie._MAX_UNIFORM_SIZE);Ie._TempBufferInt32View=new Int32Array(Ie._TempBuffer.buffer);Ie._TempBufferUInt32View=new Uint32Array(Ie._TempBuffer.buffer);let mr=class{get isDisposed(){return this._isDisposed}constructor(n,e,t,i=0,r=!1,s=!1,o=!1,a,l){this._isAlreadyOwned=!1,this._isDisposed=!1,n&&n.getScene?this._engine=n.getScene().getEngine():this._engine=n,this._updatable=t,this._instanced=s,this._divisor=a||1,this._label=l,e instanceof qa?(this._data=null,this._buffer=e):(this._data=e,this._buffer=null),this.byteStride=o?i:i*Float32Array.BYTES_PER_ELEMENT,r||this.create()}createVertexBuffer(n,e,t,i,r,s=!1,o){const a=s?e:e*Float32Array.BYTES_PER_ELEMENT,l=i?s?i:i*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new b(this._engine,this,n,this._updatable,!0,l,r===void 0?this._instanced:r,a,t,void 0,void 0,!0,this._divisor||o)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(n=null){!n&&this._buffer||(n=n||this._data,n&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,n),this._data=n):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(n,this._label),this._data=n):this._buffer=this._engine.createVertexBuffer(n,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.capacity>0){this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.capacity,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.capacity,void 0,this._label);return}oe.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(n){this.create(n)}updateDirectly(n,e,t,i=!1){this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,n,i?e:e*Float32Array.BYTES_PER_ELEMENT,t?t*this.byteStride:void 0),e===0&&t===void 0?this._data=n:this._data=null)}_increaseReferences(){if(this._buffer){if(!this._isAlreadyOwned){this._isAlreadyOwned=!0;return}this._buffer.references++}}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}};class b{get isDisposed(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(e){const t=e!=0;this._instanceDivisor=e,t!==this._instanced&&(this._instanced=t,this._computeHashCode())}get _maxVerticesCount(){const e=this.getData();return e?Array.isArray(e)?e.length/(this.byteStride/4)-this.byteOffset/4:(e.byteLength-this.byteOffset)/this.byteStride:0}constructor(e,t,i,r,s,o,a,l,h,c,u=!1,d=!1,f=1,p=!1){this._isDisposed=!1;let g=!1;if(this.engine=e,typeof r=="object"&&r!==null?(g=r.updatable??!1,s=r.postponeInternalCreation,o=r.stride,a=r.instanced,l=r.offset,h=r.size,c=r.type,u=r.normalized??!1,d=r.useBytes??!1,f=r.divisor??1,p=r.takeBufferOwnership??!1,this._label=r.label):g=!!r,t instanceof mr?(this._buffer=t,this._ownsBuffer=p):(this._buffer=new mr(e,t,g,o,s,a,d,f,this._label),this._ownsBuffer=!0),this.uniqueId=b._Counter++,this._kind=i,c===void 0){const x=this.getData();this.type=x?b.GetDataType(x):b.FLOAT}else this.type=c;const m=b.GetTypeByteLength(this.type);d?(this._size=h||(o?o/m:b.DeduceStride(i)),this.byteStride=o||this._buffer.byteStride||this._size*m,this.byteOffset=l||0):(this._size=h||o||b.DeduceStride(i),this.byteStride=o?o*m:this._buffer.byteStride||this._size*m,this.byteOffset=(l||0)*m),this.normalized=u,this._instanced=a!==void 0?a:!1,this._instanceDivisor=a?f:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120<<0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var e;(e=this._buffer)==null||e._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(e,t){const i=this.getData();return i?b.GetFloatData(i,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,e,t):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/b.GetTypeByteLength(this.type)}getOffset(){return this.byteOffset/b.GetTypeByteLength(this.type)}getSize(e=!1){return e?this._size*b.GetTypeByteLength(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(e){this._buffer.create(e),this._alignBuffer()}update(e){this._buffer.update(e),this._alignBuffer()}updateDirectly(e,t,i=!1){this._buffer.updateDirectly(e,t,void 0,i),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(e,t){b.ForEach(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,e,this.normalized,t)}_alignBuffer(){}static DeduceStride(e){switch(e){case b.UVKind:case b.UV2Kind:case b.UV3Kind:case b.UV4Kind:case b.UV5Kind:case b.UV6Kind:return 2;case b.NormalKind:case b.PositionKind:return 3;case b.ColorKind:case b.ColorInstanceKind:case b.MatricesIndicesKind:case b.MatricesIndicesExtraKind:case b.MatricesWeightsKind:case b.MatricesWeightsExtraKind:case b.TangentKind:return 4;default:throw new Error("Invalid kind '"+e+"'")}}static GetDataType(e){return e instanceof Int8Array?b.BYTE:e instanceof Uint8Array?b.UNSIGNED_BYTE:e instanceof Int16Array?b.SHORT:e instanceof Uint16Array?b.UNSIGNED_SHORT:e instanceof Int32Array?b.INT:e instanceof Uint32Array?b.UNSIGNED_INT:b.FLOAT}static GetTypeByteLength(e){switch(e){case b.BYTE:case b.UNSIGNED_BYTE:return 1;case b.SHORT:case b.UNSIGNED_SHORT:return 2;case b.INT:case b.UNSIGNED_INT:case b.FLOAT:return 4;default:throw new Error(`Invalid type '${e}'`)}}static ForEach(e,t,i,r,s,o,a,l){if(e instanceof Array){let h=t/4;const c=i/4;for(let u=0;u<o;u+=r){for(let d=0;d<r;d++)l(e[h+d],u+d);h+=c}}else{const h=e instanceof ArrayBuffer?new DataView(e):new DataView(e.buffer,e.byteOffset,e.byteLength),c=b.GetTypeByteLength(s);for(let u=0;u<o;u+=r){let d=t;for(let f=0;f<r;f++){const p=b._GetFloatValue(h,s,d,a);l(p,u+f),d+=c}t+=i}}}static _GetFloatValue(e,t,i,r){switch(t){case b.BYTE:{let s=e.getInt8(i);return r&&(s=Math.max(s/127,-1)),s}case b.UNSIGNED_BYTE:{let s=e.getUint8(i);return r&&(s=s/255),s}case b.SHORT:{let s=e.getInt16(i,!0);return r&&(s=Math.max(s/32767,-1)),s}case b.UNSIGNED_SHORT:{let s=e.getUint16(i,!0);return r&&(s=s/65535),s}case b.INT:return e.getInt32(i,!0);case b.UNSIGNED_INT:return e.getUint32(i,!0);case b.FLOAT:return e.getFloat32(i,!0);default:throw new Error(`Invalid component type ${t}`)}}static GetFloatData(e,t,i,r,s,o,a,l){const h=t*b.GetTypeByteLength(i),c=a*t;if(i!==b.FLOAT||s!==h){const u=new Float32Array(c);return b.ForEach(e,r,s,t,i,c,o,(d,f)=>u[f]=d),u}if(!(e instanceof Array||e instanceof Float32Array)||r!==0||e.length!==c)if(e instanceof Array){const u=r/4;return e.slice(u,u+c)}else{if(e instanceof ArrayBuffer)return new Float32Array(e,r,c);{let u=e.byteOffset+r;if(l){const f=new Float32Array(c),p=new Float32Array(e.buffer,u,c);return f.set(p),f}const d=u%4;return d&&(u=Math.max(0,u-d)),new Float32Array(e.buffer,u,c)}}return l?e.slice():e}}b._Counter=0;b.BYTE=5120;b.UNSIGNED_BYTE=5121;b.SHORT=5122;b.UNSIGNED_SHORT=5123;b.INT=5124;b.UNSIGNED_INT=5125;b.FLOAT=5126;b.PositionKind="position";b.NormalKind="normal";b.TangentKind="tangent";b.UVKind="uv";b.UV2Kind="uv2";b.UV3Kind="uv3";b.UV4Kind="uv4";b.UV5Kind="uv5";b.UV6Kind="uv6";b.ColorKind="color";b.ColorInstanceKind="instanceColor";b.MatricesIndicesKind="matricesIndices";b.MatricesWeightsKind="matricesWeights";b.MatricesIndicesExtraKind="matricesIndicesExtra";b.MatricesWeightsExtraKind="matricesWeightsExtra";class Ts{constructor(){this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshFaceId=-1,this.subMeshId=0,this.pickedSprite=null,this.thinInstanceIndex=-1,this.ray=null,this.originMesh=null,this.aimTransform=null,this.gripTransform=null}getNormal(e=!1,t=!0){if(!this.pickedMesh||t&&!this.pickedMesh.isVerticesDataPresent(b.NormalKind))return null;let i=this.pickedMesh.getIndices();(i==null?void 0:i.length)===0&&(i=null);let r;const s=W.Vector3[0],o=W.Vector3[1],a=W.Vector3[2];if(t){const h=this.pickedMesh.getVerticesData(b.NormalKind);let c=i?v.FromArrayToRef(h,i[this.faceId*3]*3,s):s.copyFromFloats(h[this.faceId*3*3],h[this.faceId*3*3+1],h[this.faceId*3*3+2]),u=i?v.FromArrayToRef(h,i[this.faceId*3+1]*3,o):o.copyFromFloats(h[(this.faceId*3+1)*3],h[(this.faceId*3+1)*3+1],h[(this.faceId*3+1)*3+2]),d=i?v.FromArrayToRef(h,i[this.faceId*3+2]*3,a):a.copyFromFloats(h[(this.faceId*3+2)*3],h[(this.faceId*3+2)*3+1],h[(this.faceId*3+2)*3+2]);c=c.scale(this.bu),u=u.scale(this.bv),d=d.scale(1-this.bu-this.bv),r=new v(c.x+u.x+d.x,c.y+u.y+d.y,c.z+u.z+d.z)}else{const h=this.pickedMesh.getVerticesData(b.PositionKind),c=i?v.FromArrayToRef(h,i[this.faceId*3]*3,s):s.copyFromFloats(h[this.faceId*3*3],h[this.faceId*3*3+1],h[this.faceId*3*3+2]),u=i?v.FromArrayToRef(h,i[this.faceId*3+1]*3,o):o.copyFromFloats(h[(this.faceId*3+1)*3],h[(this.faceId*3+1)*3+1],h[(this.faceId*3+1)*3+2]),d=i?v.FromArrayToRef(h,i[this.faceId*3+2]*3,a):a.copyFromFloats(h[(this.faceId*3+2)*3],h[(this.faceId*3+2)*3+1],h[(this.faceId*3+2)*3+2]),f=c.subtract(u),p=d.subtract(u);r=v.Cross(f,p)}const l=(h,c)=>{let u=h.getWorldMatrix();h.nonUniformScaling&&(W.Matrix[0].copyFrom(u),u=W.Matrix[0],u.setTranslationFromFloats(0,0,0),u.invert(),u.transposeToRef(W.Matrix[1]),u=W.Matrix[1]),v.TransformNormalToRef(c,u,c)};if(e&&l(this.pickedMesh,r),this.ray){const h=W.Vector3[0].copyFrom(r);e||l(this.pickedMesh,h),v.Dot(h,this.ray.direction)>0&&r.negateInPlace()}return r.normalize(),r}getTextureCoordinates(e=b.UVKind){if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(e))return null;const t=this.pickedMesh.getIndices();if(!t)return null;const i=this.pickedMesh.getVerticesData(e);if(!i)return null;let r=me.FromArray(i,t[this.faceId*3]*2),s=me.FromArray(i,t[this.faceId*3+1]*2),o=me.FromArray(i,t[this.faceId*3+2]*2);return r=r.scale(this.bu),s=s.scale(this.bv),o=o.scale(1-this.bu-this.bv),new me(r.x+s.x+o.x,r.y+s.y+o.y)}}class Si{constructor(e,t,i,r,s,o){this.source=e,this.pointerX=t,this.pointerY=i,this.meshUnderPointer=r,this.sourceEvent=s,this.additionalData=o}static CreateNew(e,t,i){const r=e.getScene();return new Si(e,r.pointerX,r.pointerY,r.meshUnderPointer||e,t,i)}static CreateNewFromSprite(e,t,i,r){return new Si(e,t.pointerX,t.pointerY,t.meshUnderPointer,i,r)}static CreateNewFromScene(e,t){return new Si(null,e.pointerX,e.pointerY,e.meshUnderPointer,t)}static CreateNewFromPrimitive(e,t,i,r){return new Si(e,t.x,t.y,null,i,r)}}class Au{constructor(e){this._vertexBuffers={},this._scene=e}_prepareBuffers(){if(this._vertexBuffers[b.PositionKind])return;const e=[];e.push(1,1),e.push(-1,1),e.push(-1,-1),e.push(1,-1),this._vertexBuffers[b.PositionKind]=new b(this._scene.getEngine(),e,b.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const e=[];e.push(0),e.push(1),e.push(2),e.push(0),e.push(2),e.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(e)}_rebuild(){const e=this._vertexBuffers[b.PositionKind];e&&(e._rebuild(),this._buildIndexBuffer())}_prepareFrame(e=null,t=null){const i=this._scene.activeCamera;return!i||(t=t||i._postProcesses.filter(r=>r!=null),!t||t.length===0||!this._scene.postProcessesEnabled)?!1:(t[0].activate(i,e,t!=null),!0)}directRender(e,t=null,i=!1,r=0,s=0,o=!1){var a;const l=this._scene.getEngine();for(let h=0;h<e.length;h++){h<e.length-1?e[h+1].activate(this._scene.activeCamera,t==null?void 0:t.texture):(t?l.bindFramebuffer(t,r,void 0,void 0,i,s):o||l.restoreDefaultFramebuffer(),(a=l._debugInsertMarker)==null||a.call(l,`post process ${e[h].name} output`));const c=e[h],u=c.apply();u&&(c.onBeforeRenderObservable.notifyObservers(u),this._prepareBuffers(),l.bindBuffers(this._vertexBuffers,this._indexBuffer,u),l.drawElementsType(0,0,6),c.onAfterRenderObservable.notifyObservers(u))}l.setDepthBuffer(!0),l.setDepthWrite(!0)}_finalizeFrame(e,t,i,r,s=!1){var o;const a=this._scene.activeCamera;if(!a||(r=r||a._postProcesses.filter(h=>h!=null),r.length===0||!this._scene.postProcessesEnabled))return;const l=this._scene.getEngine();for(let h=0,c=r.length;h<c;h++){const u=r[h];if(h<c-1?u._outputTexture=r[h+1].activate(a,t==null?void 0:t.texture):(t?(l.bindFramebuffer(t,i,void 0,void 0,s),u._outputTexture=t):(l.restoreDefaultFramebuffer(),u._outputTexture=null),(o=l._debugInsertMarker)==null||o.call(l,`post process ${r[h].name} output`)),e)break;const d=u.apply();d&&(u.onBeforeRenderObservable.notifyObservers(d),this._prepareBuffers(),l.bindBuffers(this._vertexBuffers,this._indexBuffer,d),l.drawElementsType(0,0,6),u.onAfterRenderObservable.notifyObservers(d))}l.setDepthBuffer(!0),l.setDepthWrite(!0),l.setAlphaMode(0)}dispose(){const e=this._vertexBuffers[b.PositionKind];e&&(e.dispose(),this._vertexBuffers[b.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}class qr{set opaqueSortCompareFn(e){e?this._opaqueSortCompareFn=e:this._opaqueSortCompareFn=qr.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(e){e?this._alphaTestSortCompareFn=e:this._alphaTestSortCompareFn=qr.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(e){e?this._transparentSortCompareFn=e:this._transparentSortCompareFn=qr.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(e,t,i=null,r=null,s=null){this.index=e,this._opaqueSubMeshes=new Vi(256),this._transparentSubMeshes=new Vi(256),this._alphaTestSubMeshes=new Vi(256),this._depthOnlySubMeshes=new Vi(256),this._particleSystems=new Vi(256),this._spriteManagers=new Vi(256),this._empty=!0,this._edgesRenderers=new In(16),this._scene=t,this.opaqueSortCompareFn=i,this.alphaTestSortCompareFn=r,this.transparentSortCompareFn=s}render(e,t,i,r){if(e){e(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);return}const s=this._scene.getEngine();this._depthOnlySubMeshes.length!==0&&(s.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),s.setColorWrite(!0)),this._opaqueSubMeshes.length!==0&&this._renderOpaque(this._opaqueSubMeshes),this._alphaTestSubMeshes.length!==0&&this._renderAlphaTest(this._alphaTestSubMeshes);const o=s.getStencilBuffer();if(s.setStencilBuffer(!1),t&&this._renderSprites(),i&&this._renderParticles(r),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),this._transparentSubMeshes.length!==0||this._scene.useOrderIndependentTransparency){if(s.setStencilBuffer(o),this._scene.useOrderIndependentTransparency){const a=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);a.length&&this._renderTransparent(a)}else this._renderTransparent(this._transparentSubMeshes);s.setAlphaMode(0)}if(s.setStencilBuffer(!1),this._edgesRenderers.length){for(let a=0;a<this._edgesRenderers.length;a++)this._edgesRenderers.data[a].render();s.setAlphaMode(0)}s.setStencilBuffer(o)}_renderOpaqueSorted(e){qr._RenderSorted(e,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(e){qr._RenderSorted(e,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(e){qr._RenderSorted(e,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(e,t,i,r){let s=0,o;const a=i?i.globalPosition:qr._ZeroVector;if(r)for(;s<e.length;s++)o=e.data[s],o._alphaIndex=o.getMesh().alphaIndex,o._distanceToCamera=v.Distance(o.getBoundingInfo().boundingSphere.centerWorld,a);const l=e.length===e.data.length?e.data:e.data.slice(0,e.length);t&&l.sort(t);const h=l[0].getMesh().getScene();for(s=0;s<l.length;s++)if(o=l[s],!(h._activeMeshesFrozenButKeepClipping&&!o.isInFrustum(h._frustumPlanes))){if(r){const c=o.getMaterial();if(c&&c.needDepthPrePass){const u=c.getScene().getEngine();u.setColorWrite(!1),u.setAlphaMode(0),o.render(!1),u.setColorWrite(!0)}}o.render(r)}}static defaultTransparentSortCompare(e,t){return e._alphaIndex>t._alphaIndex?1:e._alphaIndex<t._alphaIndex?-1:qr.backToFrontSortCompare(e,t)}static backToFrontSortCompare(e,t){return e._distanceToCamera<t._distanceToCamera?1:e._distanceToCamera>t._distanceToCamera?-1:0}static frontToBackSortCompare(e,t){return e._distanceToCamera<t._distanceToCamera?-1:e._distanceToCamera>t._distanceToCamera?1:0}static PainterSortCompare(e,t){const i=e.getMesh(),r=t.getMesh();return i.material&&r.material?i.material.uniqueId-r.material.uniqueId:i.uniqueId-r.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(e,t,i){t===void 0&&(t=e.getMesh()),i===void 0&&(i=e.getMaterial()),i!=null&&(i.needAlphaBlendingForMesh(t)?this._transparentSubMeshes.push(e):i.needAlphaTesting()?(i.needDepthPrePass&&this._depthOnlySubMeshes.push(e),this._alphaTestSubMeshes.push(e)):(i.needDepthPrePass&&this._depthOnlySubMeshes.push(e),this._opaqueSubMeshes.push(e)),t._renderingGroup=this,t._edgesRenderer&&t._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(t._edgesRenderer),this._empty=!1)}dispatchSprites(e){this._spriteManagers.push(e),this._empty=!1}dispatchParticles(e){this._particleSystems.push(e),this._empty=!1}_renderParticles(e){if(this._particleSystems.length===0)return;const t=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let i=0;i<this._particleSystems.length;i++){const r=this._particleSystems.data[i];if((t&&t.layerMask&r.layerMask)===0)continue;const s=r.emitter;(!s.position||!e||e.indexOf(s)!==-1)&&this._scene._activeParticles.addCount(r.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||this._spriteManagers.length===0)return;const e=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let t=0;t<this._spriteManagers.length;t++){const i=this._spriteManagers.data[t];(e&&e.layerMask&i.layerMask)!==0&&i.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}qr._ZeroVector=v.Zero();class by{}class Li{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(e){e!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=e,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const e of this._scene.meshes)if(e.subMeshes)for(const t of e.subMeshes)t._wasDispatched=!1;if(this._scene.spriteManagers)for(const e of this._scene.spriteManagers)e._wasDispatched=!1;for(const e of this._scene.particleSystems)e._wasDispatched=!1}constructor(e){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new by,this._maintainStateBetweenFrames=!1,this._scene=e;for(let t=Li.MIN_RENDERINGGROUPS;t<Li.MAX_RENDERINGGROUPS;t++)this._autoClearDepthStencil[t]={autoClear:!0,depth:!0,stencil:!0}}getRenderingGroup(e){const t=e||0;return this._prepareRenderingGroup(t),this._renderingGroups[t]}_clearDepthStencilBuffer(e=!0,t=!0){this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,e,t),this._depthStencilBufferAlreadyCleaned=!0)}render(e,t,i,r){const s=this._renderingGroupInfo;if(s.scene=this._scene,s.camera=this._scene.activeCamera,this._scene.spriteManagers&&r)for(let o=0;o<this._scene.spriteManagers.length;o++){const a=this._scene.spriteManagers[o];this.dispatchSprites(a)}for(let o=Li.MIN_RENDERINGGROUPS;o<Li.MAX_RENDERINGGROUPS;o++){this._depthStencilBufferAlreadyCleaned=o===Li.MIN_RENDERINGGROUPS;const a=this._renderingGroups[o];if(!a||a._empty)continue;const l=1<<o;if(s.renderingGroupId=o,this._scene.onBeforeRenderingGroupObservable.notifyObservers(s,l),Li.AUTOCLEAR){const h=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(o):this._autoClearDepthStencil[o];h&&h.autoClear&&this._clearDepthStencilBuffer(h.depth,h.stencil)}for(const h of this._scene._beforeRenderingGroupDrawStage)h.action(o);a.render(e,r,i,t);for(const h of this._scene._afterRenderingGroupDrawStage)h.action(o);this._scene.onAfterRenderingGroupObservable.notifyObservers(s,l)}}reset(){if(!this.maintainStateBetweenFrames)for(let e=Li.MIN_RENDERINGGROUPS;e<Li.MAX_RENDERINGGROUPS;e++){const t=this._renderingGroups[e];t&&t.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let e=Li.MIN_RENDERINGGROUPS;e<Li.MAX_RENDERINGGROUPS;e++){const t=this._renderingGroups[e];t&&t.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let e=Li.MIN_RENDERINGGROUPS;e<Li.MAX_RENDERINGGROUPS;e++){const t=this._renderingGroups[e];t&&t.dispose()}}_prepareRenderingGroup(e){this._renderingGroups[e]===void 0&&(this._renderingGroups[e]=new qr(e,this._scene,this._customOpaqueSortCompareFn[e],this._customAlphaTestSortCompareFn[e],this._customTransparentSortCompareFn[e]))}dispatchSprites(e){this.maintainStateBetweenFrames&&e._wasDispatched||(e._wasDispatched=!0,this.getRenderingGroup(e.renderingGroupId).dispatchSprites(e))}dispatchParticles(e){this.maintainStateBetweenFrames&&e._wasDispatched||(e._wasDispatched=!0,this.getRenderingGroup(e.renderingGroupId).dispatchParticles(e))}dispatch(e,t,i){t===void 0&&(t=e.getMesh()),!(this.maintainStateBetweenFrames&&e._wasDispatched)&&(e._wasDispatched=!0,this.getRenderingGroup(t.renderingGroupId).dispatch(e,t,i))}setRenderingOrder(e,t=null,i=null,r=null){if(this._customOpaqueSortCompareFn[e]=t,this._customAlphaTestSortCompareFn[e]=i,this._customTransparentSortCompareFn[e]=r,this._renderingGroups[e]){const s=this._renderingGroups[e];s.opaqueSortCompareFn=this._customOpaqueSortCompareFn[e],s.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[e],s.transparentSortCompareFn=this._customTransparentSortCompareFn[e]}}setRenderingAutoClearDepthStencil(e,t,i=!0,r=!0){this._autoClearDepthStencil[e]={autoClear:t,depth:i,stencil:r}}getAutoClearDepthStencilSetup(e){return this._autoClearDepthStencil[e]}}Li.MAX_RENDERINGGROUPS=4;Li.MIN_RENDERINGGROUPS=0;Li.AUTOCLEAR=!0;class ze{}ze.NAME_EFFECTLAYER="EffectLayer";ze.NAME_LAYER="Layer";ze.NAME_LENSFLARESYSTEM="LensFlareSystem";ze.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer";ze.NAME_PARTICLESYSTEM="ParticleSystem";ze.NAME_GAMEPAD="Gamepad";ze.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue";ze.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer";ze.NAME_PREPASSRENDERER="PrePassRenderer";ze.NAME_DEPTHRENDERER="DepthRenderer";ze.NAME_DEPTHPEELINGRENDERER="DepthPeelingRenderer";ze.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager";ze.NAME_SPRITE="Sprite";ze.NAME_SUBSURFACE="SubSurface";ze.NAME_OUTLINERENDERER="Outline";ze.NAME_PROCEDURALTEXTURE="ProceduralTexture";ze.NAME_SHADOWGENERATOR="ShadowGenerator";ze.NAME_OCTREE="Octree";ze.NAME_PHYSICSENGINE="PhysicsEngine";ze.NAME_AUDIO="Audio";ze.NAME_FLUIDRENDERER="FluidRenderer";ze.STEP_ISREADYFORMESH_EFFECTLAYER=0;ze.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0;ze.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0;ze.STEP_PREACTIVEMESH_BOUNDINGBOXRENDERER=0;ze.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1;ze.STEP_BEFORECAMERADRAW_PREPASS=0;ze.STEP_BEFORECAMERADRAW_EFFECTLAYER=1;ze.STEP_BEFORECAMERADRAW_LAYER=2;ze.STEP_BEFORERENDERTARGETDRAW_PREPASS=0;ze.STEP_BEFORERENDERTARGETDRAW_LAYER=1;ze.STEP_BEFORERENDERINGMESH_PREPASS=0;ze.STEP_BEFORERENDERINGMESH_OUTLINE=1;ze.STEP_AFTERRENDERINGMESH_PREPASS=0;ze.STEP_AFTERRENDERINGMESH_OUTLINE=1;ze.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0;ze.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1;ze.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0;ze.STEP_BEFORECAMERAUPDATE_GAMEPAD=1;ze.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0;ze.STEP_BEFORECLEAR_PREPASS=1;ze.STEP_BEFORERENDERTARGETCLEAR_PREPASS=0;ze.STEP_AFTERRENDERTARGETDRAW_PREPASS=0;ze.STEP_AFTERRENDERTARGETDRAW_LAYER=1;ze.STEP_AFTERCAMERADRAW_PREPASS=0;ze.STEP_AFTERCAMERADRAW_EFFECTLAYER=1;ze.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=2;ze.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=3;ze.STEP_AFTERCAMERADRAW_LAYER=4;ze.STEP_AFTERCAMERADRAW_FLUIDRENDERER=5;ze.STEP_AFTERCAMERAPOSTPROCESS_LAYER=0;ze.STEP_AFTERRENDERTARGETPOSTPROCESS_LAYER=0;ze.STEP_AFTERRENDER_AUDIO=0;ze.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=0;ze.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1;ze.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=2;ze.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3;ze.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0;ze.STEP_GATHERACTIVECAMERARENDERTARGETS_FLUIDRENDERER=1;ze.STEP_POINTERMOVE_SPRITE=0;ze.STEP_POINTERDOWN_SPRITE=0;ze.STEP_POINTERUP_SPRITE=0;class ti extends Array{constructor(e){super(...e)}static Create(){return Object.create(ti.prototype)}registerStep(e,t,i){let r=0,s=Number.MAX_VALUE;for(;r<this.length&&(s=this[r].index,!(e<s));r++);this.splice(r,0,{index:e,component:t,action:i.bind(t)})}clear(){this.length=0}}class dt{}dt.POINTERDOWN=1;dt.POINTERUP=2;dt.POINTERMOVE=4;dt.POINTERWHEEL=8;dt.POINTERPICK=16;dt.POINTERTAP=32;dt.POINTERDOUBLETAP=64;class u0{constructor(e,t){this.type=e,this.event=t}}class Iy extends u0{constructor(e,t,i,r){super(e,t),this.ray=null,this.originalPickingInfo=null,this.skipOnPointerObservable=!1,this.localPosition=new me(i,r)}}class Ps extends u0{get pickInfo(){return this._pickInfo||this._generatePickInfo(),this._pickInfo}constructor(e,t,i,r=null){super(e,t),this._pickInfo=i,this._inputManager=r}_generatePickInfo(){this._inputManager&&(this._pickInfo=this._inputManager._pickMove(this.event),this._inputManager._setRayOnPointerInfo(this._pickInfo,this.event),this._inputManager=null)}}class yr{constructor(){this.hoverCursor="",this.actions=[],this.isRecursive=!1}static get HasTriggers(){for(const e in yr.Triggers)if(Object.prototype.hasOwnProperty.call(yr.Triggers,e))return!0;return!1}static get HasPickTriggers(){for(const e in yr.Triggers)if(Object.prototype.hasOwnProperty.call(yr.Triggers,e)){const t=parseInt(e);if(t>=1&&t<=7)return!0}return!1}static HasSpecificTrigger(e){for(const t in yr.Triggers)if(Object.prototype.hasOwnProperty.call(yr.Triggers,t)&&parseInt(t)===e)return!0;return!1}}yr.Triggers={};class ch{}ch.KEYDOWN=1;ch.KEYUP=2;class Mu{constructor(e,t){this.type=e,this.event=t}}class dg extends Mu{get skipOnPointerObservable(){return this.skipOnKeyboardObservable}set skipOnPointerObservable(e){this.skipOnKeyboardObservable=e}constructor(e,t){super(e,t),this.type=e,this.event=t,this.skipOnKeyboardObservable=!1}}var Pe;(function(n){n[n.Generic=0]="Generic",n[n.Keyboard=1]="Keyboard",n[n.Mouse=2]="Mouse",n[n.Touch=3]="Touch",n[n.DualShock=4]="DualShock",n[n.Xbox=5]="Xbox",n[n.Switch=6]="Switch",n[n.DualSense=7]="DualSense"})(Pe||(Pe={}));var ke;(function(n){n[n.Horizontal=0]="Horizontal",n[n.Vertical=1]="Vertical",n[n.LeftClick=2]="LeftClick",n[n.MiddleClick=3]="MiddleClick",n[n.RightClick=4]="RightClick",n[n.BrowserBack=5]="BrowserBack",n[n.BrowserForward=6]="BrowserForward",n[n.MouseWheelX=7]="MouseWheelX",n[n.MouseWheelY=8]="MouseWheelY",n[n.MouseWheelZ=9]="MouseWheelZ",n[n.Move=12]="Move"})(ke||(ke={}));var uh;(function(n){n[n.Horizontal=0]="Horizontal",n[n.Vertical=1]="Vertical",n[n.LeftClick=2]="LeftClick",n[n.MiddleClick=3]="MiddleClick",n[n.RightClick=4]="RightClick",n[n.BrowserBack=5]="BrowserBack",n[n.BrowserForward=6]="BrowserForward",n[n.MouseWheelX=7]="MouseWheelX",n[n.MouseWheelY=8]="MouseWheelY",n[n.MouseWheelZ=9]="MouseWheelZ",n[n.DeltaHorizontal=10]="DeltaHorizontal",n[n.DeltaVertical=11]="DeltaVertical"})(uh||(uh={}));var fg;(function(n){n[n.Cross=0]="Cross",n[n.Circle=1]="Circle",n[n.Square=2]="Square",n[n.Triangle=3]="Triangle",n[n.L1=4]="L1",n[n.R1=5]="R1",n[n.L2=6]="L2",n[n.R2=7]="R2",n[n.Share=8]="Share",n[n.Options=9]="Options",n[n.L3=10]="L3",n[n.R3=11]="R3",n[n.DPadUp=12]="DPadUp",n[n.DPadDown=13]="DPadDown",n[n.DPadLeft=14]="DPadLeft",n[n.DPadRight=15]="DPadRight",n[n.Home=16]="Home",n[n.TouchPad=17]="TouchPad",n[n.LStickXAxis=18]="LStickXAxis",n[n.LStickYAxis=19]="LStickYAxis",n[n.RStickXAxis=20]="RStickXAxis",n[n.RStickYAxis=21]="RStickYAxis"})(fg||(fg={}));var pg;(function(n){n[n.Cross=0]="Cross",n[n.Circle=1]="Circle",n[n.Square=2]="Square",n[n.Triangle=3]="Triangle",n[n.L1=4]="L1",n[n.R1=5]="R1",n[n.L2=6]="L2",n[n.R2=7]="R2",n[n.Create=8]="Create",n[n.Options=9]="Options",n[n.L3=10]="L3",n[n.R3=11]="R3",n[n.DPadUp=12]="DPadUp",n[n.DPadDown=13]="DPadDown",n[n.DPadLeft=14]="DPadLeft",n[n.DPadRight=15]="DPadRight",n[n.Home=16]="Home",n[n.TouchPad=17]="TouchPad",n[n.LStickXAxis=18]="LStickXAxis",n[n.LStickYAxis=19]="LStickYAxis",n[n.RStickXAxis=20]="RStickXAxis",n[n.RStickYAxis=21]="RStickYAxis"})(pg||(pg={}));var gg;(function(n){n[n.A=0]="A",n[n.B=1]="B",n[n.X=2]="X",n[n.Y=3]="Y",n[n.LB=4]="LB",n[n.RB=5]="RB",n[n.LT=6]="LT",n[n.RT=7]="RT",n[n.Back=8]="Back",n[n.Start=9]="Start",n[n.LS=10]="LS",n[n.RS=11]="RS",n[n.DPadUp=12]="DPadUp",n[n.DPadDown=13]="DPadDown",n[n.DPadLeft=14]="DPadLeft",n[n.DPadRight=15]="DPadRight",n[n.Home=16]="Home",n[n.LStickXAxis=17]="LStickXAxis",n[n.LStickYAxis=18]="LStickYAxis",n[n.RStickXAxis=19]="RStickXAxis",n[n.RStickYAxis=20]="RStickYAxis"})(gg||(gg={}));var mg;(function(n){n[n.B=0]="B",n[n.A=1]="A",n[n.Y=2]="Y",n[n.X=3]="X",n[n.L=4]="L",n[n.R=5]="R",n[n.ZL=6]="ZL",n[n.ZR=7]="ZR",n[n.Minus=8]="Minus",n[n.Plus=9]="Plus",n[n.LS=10]="LS",n[n.RS=11]="RS",n[n.DPadUp=12]="DPadUp",n[n.DPadDown=13]="DPadDown",n[n.DPadLeft=14]="DPadLeft",n[n.DPadRight=15]="DPadRight",n[n.Home=16]="Home",n[n.Capture=17]="Capture",n[n.LStickXAxis=18]="LStickXAxis",n[n.LStickYAxis=19]="LStickYAxis",n[n.RStickXAxis=20]="RStickXAxis",n[n.RStickYAxis=21]="RStickYAxis"})(mg||(mg={}));var _g;(function(n){n[n.PointerMove=0]="PointerMove",n[n.PointerDown=1]="PointerDown",n[n.PointerUp=2]="PointerUp"})(_g||(_g={}));class zh{}zh.DOM_DELTA_PIXEL=0;zh.DOM_DELTA_LINE=1;zh.DOM_DELTA_PAGE=2;class An{static CreateDeviceEvent(e,t,i,r,s,o,a){switch(e){case Pe.Keyboard:return this._CreateKeyboardEvent(i,r,s,o);case Pe.Mouse:if(i===ke.MouseWheelX||i===ke.MouseWheelY||i===ke.MouseWheelZ)return this._CreateWheelEvent(e,t,i,r,s,o);case Pe.Touch:return this._CreatePointerEvent(e,t,i,r,s,o,a);default:throw`Unable to generate event for device ${Pe[e]}`}}static _CreatePointerEvent(e,t,i,r,s,o,a){const l=this._CreateMouseEvent(e,t,i,r,s,o);e===Pe.Mouse?(l.deviceType=Pe.Mouse,l.pointerId=1,l.pointerType="mouse"):(l.deviceType=Pe.Touch,l.pointerId=a??t,l.pointerType="touch");let h=0;return h+=s.pollInput(e,t,ke.LeftClick),h+=s.pollInput(e,t,ke.RightClick)*2,h+=s.pollInput(e,t,ke.MiddleClick)*4,l.buttons=h,i===ke.Move?l.type="pointermove":i>=ke.LeftClick&&i<=ke.RightClick&&(l.type=r===1?"pointerdown":"pointerup",l.button=i-2),l}static _CreateWheelEvent(e,t,i,r,s,o){const a=this._CreateMouseEvent(e,t,i,r,s,o);switch(a.pointerId=1,a.type="wheel",a.deltaMode=zh.DOM_DELTA_PIXEL,a.deltaX=0,a.deltaY=0,a.deltaZ=0,i){case ke.MouseWheelX:a.deltaX=r;break;case ke.MouseWheelY:a.deltaY=r;break;case ke.MouseWheelZ:a.deltaZ=r;break}return a}static _CreateMouseEvent(e,t,i,r,s,o){const a=this._CreateEvent(o),l=s.pollInput(e,t,ke.Horizontal),h=s.pollInput(e,t,ke.Vertical);return o?(a.movementX=0,a.movementY=0,a.offsetX=a.movementX-o.getBoundingClientRect().x,a.offsetY=a.movementY-o.getBoundingClientRect().y):(a.movementX=s.pollInput(e,t,uh.DeltaHorizontal),a.movementY=s.pollInput(e,t,uh.DeltaVertical),a.offsetX=0,a.offsetY=0),this._CheckNonCharacterKeys(a,s),a.clientX=l,a.clientY=h,a.x=l,a.y=h,a.deviceType=e,a.deviceSlot=t,a.inputIndex=i,a}static _CreateKeyboardEvent(e,t,i,r){const s=this._CreateEvent(r);return this._CheckNonCharacterKeys(s,i),s.deviceType=Pe.Keyboard,s.deviceSlot=0,s.inputIndex=e,s.type=t===1?"keydown":"keyup",s.key=String.fromCharCode(e),s.keyCode=e,s}static _CheckNonCharacterKeys(e,t){const i=t.isDeviceAvailable(Pe.Keyboard),r=i&&t.pollInput(Pe.Keyboard,0,18)===1,s=i&&t.pollInput(Pe.Keyboard,0,17)===1,o=i&&(t.pollInput(Pe.Keyboard,0,91)===1||t.pollInput(Pe.Keyboard,0,92)===1||t.pollInput(Pe.Keyboard,0,93)===1),a=i&&t.pollInput(Pe.Keyboard,0,16)===1;e.altKey=r,e.ctrlKey=s,e.metaKey=o,e.shiftKey=a}static _CreateEvent(e){const t={};return t.preventDefault=()=>{},t.target=e,t}}class Ay{constructor(e,t,i){this._nativeInput=_native.DeviceInputSystem?new _native.DeviceInputSystem(e,t,(r,s,o,a)=>{const l=An.CreateDeviceEvent(r,s,o,a,this);i(r,s,l)}):this._createDummyNativeInput()}pollInput(e,t,i){return this._nativeInput.pollInput(e,t,i)}isDeviceAvailable(e){return e===Pe.Mouse||e===Pe.Touch}dispose(){this._nativeInput.dispose()}_createDummyNativeInput(){return{pollInput:()=>0,isDeviceAvailable:()=>!1,dispose:()=>{}}}}const vg=255,Eg=Object.keys(ke).length/2;class My{constructor(e,t,i,r){this._inputs=[],this._keyboardActive=!1,this._pointerActive=!1,this._usingSafari=ge.IsSafari(),this._usingMacOS=aa()&&/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform),this._keyboardDownEvent=s=>{},this._keyboardUpEvent=s=>{},this._keyboardBlurEvent=s=>{},this._pointerMoveEvent=s=>{},this._pointerDownEvent=s=>{},this._pointerUpEvent=s=>{},this._pointerCancelEvent=s=>{},this._pointerWheelEvent=s=>{},this._pointerBlurEvent=s=>{},this._pointerMacOSChromeOutEvent=s=>{},this._eventsAttached=!1,this._mouseId=-1,this._isUsingFirefox=aa()&&navigator.userAgent&&navigator.userAgent.indexOf("Firefox")!==-1,this._isUsingChromium=aa()&&navigator.userAgent&&navigator.userAgent.indexOf("Chrome")!==-1,this._maxTouchPoints=0,this._pointerInputClearObserver=null,this._gamepadConnectedEvent=s=>{},this._gamepadDisconnectedEvent=s=>{},this._eventPrefix=ge.GetPointerPrefix(e),this._engine=e,this._onDeviceConnected=t,this._onDeviceDisconnected=i,this._onInputChanged=r,this._mouseId=this._isUsingFirefox?0:1,this._enableEvents(),this._usingMacOS&&(this._metaKeys=[]),this._engine._onEngineViewChanged||(this._engine._onEngineViewChanged=()=>{this._enableEvents()})}pollInput(e,t,i){const r=this._inputs[e][t];if(!r)throw`Unable to find device ${Pe[e]}`;e>=Pe.DualShock&&e<=Pe.DualSense&&this._updateDevice(e,t,i);const s=r[i];if(s===void 0)throw`Unable to find input ${i} for device ${Pe[e]} in slot ${t}`;return i===ke.Move&&ge.Warn("Unable to provide information for PointerInput.Move.  Try using PointerInput.Horizontal or PointerInput.Vertical for move data."),s}isDeviceAvailable(e){return this._inputs[e]!==void 0}dispose(){this._onDeviceConnected=()=>{},this._onDeviceDisconnected=()=>{},this._onInputChanged=()=>{},delete this._engine._onEngineViewChanged,this._elementToAttachTo&&this._disableEvents()}_enableEvents(){const e=this==null?void 0:this._engine.getInputElement();if(e&&(!this._eventsAttached||this._elementToAttachTo!==e)){if(this._disableEvents(),this._inputs){for(const t of this._inputs)if(t)for(const i in t){const r=+i,s=t[r];if(s)for(let o=0;o<s.length;o++)s[o]=0}}this._elementToAttachTo=e,this._elementToAttachTo.tabIndex=this._elementToAttachTo.tabIndex!==-1?this._elementToAttachTo.tabIndex:this._engine.canvasTabIndex,this._handleKeyActions(),this._handlePointerActions(),this._handleGamepadActions(),this._eventsAttached=!0,this._checkForConnectedDevices()}}_disableEvents(){this._elementToAttachTo&&(this._elementToAttachTo.removeEventListener("blur",this._keyboardBlurEvent),this._elementToAttachTo.removeEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.removeEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.removeEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.removeEventListener(this._wheelEventName,this._pointerWheelEvent),this._usingMacOS&&this._isUsingChromium&&this._elementToAttachTo.removeEventListener("lostpointercapture",this._pointerMacOSChromeOutEvent),window.removeEventListener("gamepadconnected",this._gamepadConnectedEvent),window.removeEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)),this._pointerInputClearObserver&&this._engine.onEndFrameObservable.remove(this._pointerInputClearObserver),this._eventsAttached=!1}_checkForConnectedDevices(){if(navigator.getGamepads){const e=navigator.getGamepads();for(const t of e)t&&this._addGamePad(t)}typeof matchMedia=="function"&&matchMedia("(pointer:fine)").matches&&this._addPointerDevice(Pe.Mouse,0,0,0)}_addGamePad(e){const t=this._getGamepadDeviceType(e.id),i=e.index;this._gamepads=this._gamepads||new Array(e.index+1),this._registerDevice(t,i,e.buttons.length+e.axes.length),this._gamepads[i]=t}_addPointerDevice(e,t,i,r){this._pointerActive||(this._pointerActive=!0),this._registerDevice(e,t,Eg);const s=this._inputs[e][t];s[0]=i,s[1]=r}_registerDevice(e,t,i){if(t===void 0)throw`Unable to register device ${Pe[e]} to undefined slot.`;if(this._inputs[e]||(this._inputs[e]={}),!this._inputs[e][t]){const r=new Array(i);r.fill(0),this._inputs[e][t]=r,this._onDeviceConnected(e,t)}}_unregisterDevice(e,t){this._inputs[e][t]&&(delete this._inputs[e][t],this._onDeviceDisconnected(e,t))}_handleKeyActions(){this._keyboardDownEvent=e=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(Pe.Keyboard,0,vg));const t=this._inputs[Pe.Keyboard][0];if(t){t[e.keyCode]=1;const i=e;i.inputIndex=e.keyCode,this._usingMacOS&&e.metaKey&&e.key!=="Meta"&&(this._metaKeys.includes(e.keyCode)||this._metaKeys.push(e.keyCode)),this._onInputChanged(Pe.Keyboard,0,i)}},this._keyboardUpEvent=e=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(Pe.Keyboard,0,vg));const t=this._inputs[Pe.Keyboard][0];if(t){t[e.keyCode]=0;const i=e;if(i.inputIndex=e.keyCode,this._usingMacOS&&e.key==="Meta"&&this._metaKeys.length>0){for(const r of this._metaKeys){const s=An.CreateDeviceEvent(Pe.Keyboard,0,r,0,this,this._elementToAttachTo);t[r]=0,this._onInputChanged(Pe.Keyboard,0,s)}this._metaKeys.splice(0,this._metaKeys.length)}this._onInputChanged(Pe.Keyboard,0,i)}},this._keyboardBlurEvent=()=>{if(this._keyboardActive){const e=this._inputs[Pe.Keyboard][0];for(let t=0;t<e.length;t++)if(e[t]!==0){e[t]=0;const i=An.CreateDeviceEvent(Pe.Keyboard,0,t,0,this,this._elementToAttachTo);this._onInputChanged(Pe.Keyboard,0,i)}this._usingMacOS&&this._metaKeys.splice(0,this._metaKeys.length)}},this._elementToAttachTo.addEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.addEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.addEventListener("blur",this._keyboardBlurEvent)}_handlePointerActions(){this._maxTouchPoints=aa()&&navigator.maxTouchPoints||2,this._activeTouchIds||(this._activeTouchIds=new Array(this._maxTouchPoints));for(let i=0;i<this._maxTouchPoints;i++)this._activeTouchIds[i]=-1;this._pointerMoveEvent=i=>{const r=this._getPointerType(i);let s=r===Pe.Mouse?0:this._activeTouchIds.indexOf(i.pointerId);if(r===Pe.Touch&&s===-1){const a=this._activeTouchIds.indexOf(-1);if(a>=0)s=a,this._activeTouchIds[a]=i.pointerId,this._onDeviceConnected(r,s);else{ge.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);return}}this._inputs[r]||(this._inputs[r]={}),this._inputs[r][s]||this._addPointerDevice(r,s,i.clientX,i.clientY);const o=this._inputs[r][s];if(o){const a=i;a.inputIndex=ke.Move,o[ke.Horizontal]=i.clientX,o[ke.Vertical]=i.clientY,r===Pe.Touch&&o[ke.LeftClick]===0&&(o[ke.LeftClick]=1),i.pointerId===void 0&&(i.pointerId=this._mouseId),this._onInputChanged(r,s,a),!this._usingSafari&&i.button!==-1&&(a.inputIndex=i.button+2,o[i.button+2]=o[i.button+2]?0:1,this._onInputChanged(r,s,a))}},this._pointerDownEvent=i=>{const r=this._getPointerType(i);let s=r===Pe.Mouse?0:i.pointerId;if(r===Pe.Touch){const a=this._activeTouchIds.indexOf(-1);if(a>=0)s=a,this._activeTouchIds[a]=i.pointerId;else{ge.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);return}}this._inputs[r]||(this._inputs[r]={}),this._inputs[r][s]?r===Pe.Touch&&this._onDeviceConnected(r,s):this._addPointerDevice(r,s,i.clientX,i.clientY);const o=this._inputs[r][s];if(o){const a=o[ke.Horizontal],l=o[ke.Vertical];if(r===Pe.Mouse){if(i.pointerId===void 0&&(i.pointerId=this._mouseId),!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(this._mouseId)}catch{}}else if(i.pointerId&&!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(i.pointerId)}catch{}o[ke.Horizontal]=i.clientX,o[ke.Vertical]=i.clientY,o[i.button+2]=1;const h=i;h.inputIndex=i.button+2,this._onInputChanged(r,s,h),(a!==i.clientX||l!==i.clientY)&&(h.inputIndex=ke.Move,this._onInputChanged(r,s,h))}},this._pointerUpEvent=i=>{var r,s,o,a,l;const h=this._getPointerType(i),c=h===Pe.Mouse?0:this._activeTouchIds.indexOf(i.pointerId);if(h===Pe.Touch){if(c===-1)return;this._activeTouchIds[c]=-1}const u=(r=this._inputs[h])==null?void 0:r[c];if(u&&u[i.button+2]!==0){const d=u[ke.Horizontal],f=u[ke.Vertical];u[ke.Horizontal]=i.clientX,u[ke.Vertical]=i.clientY,u[i.button+2]=0;const p=i;i.pointerId===void 0&&(i.pointerId=this._mouseId),(d!==i.clientX||f!==i.clientY)&&(p.inputIndex=ke.Move,this._onInputChanged(h,c,p)),p.inputIndex=i.button+2,h===Pe.Mouse&&this._mouseId>=0&&(o=(s=this._elementToAttachTo).hasPointerCapture)!=null&&o.call(s,this._mouseId)?this._elementToAttachTo.releasePointerCapture(this._mouseId):i.pointerId&&(l=(a=this._elementToAttachTo).hasPointerCapture)!=null&&l.call(a,i.pointerId)&&this._elementToAttachTo.releasePointerCapture(i.pointerId),this._onInputChanged(h,c,p),h===Pe.Touch&&this._onDeviceDisconnected(h,c)}},this._pointerCancelEvent=i=>{var r,s,o,a;if(i.pointerType==="mouse"){const l=this._inputs[Pe.Mouse][0];this._mouseId>=0&&(s=(r=this._elementToAttachTo).hasPointerCapture)!=null&&s.call(r,this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let h=ke.LeftClick;h<=ke.BrowserForward;h++)if(l[h]===1){l[h]=0;const c=An.CreateDeviceEvent(Pe.Mouse,0,h,0,this,this._elementToAttachTo);this._onInputChanged(Pe.Mouse,0,c)}}else{const l=this._activeTouchIds.indexOf(i.pointerId);if(l===-1)return;(a=(o=this._elementToAttachTo).hasPointerCapture)!=null&&a.call(o,i.pointerId)&&this._elementToAttachTo.releasePointerCapture(i.pointerId),this._inputs[Pe.Touch][l][ke.LeftClick]=0;const h=An.CreateDeviceEvent(Pe.Touch,l,ke.LeftClick,0,this,this._elementToAttachTo,i.pointerId);this._onInputChanged(Pe.Touch,l,h),this._activeTouchIds[l]=-1,this._onDeviceDisconnected(Pe.Touch,l)}},this._wheelEventName="onwheel"in document.createElement("div")?"wheel":document.onmousewheel!==void 0?"mousewheel":"DOMMouseScroll";let e=!1;const t=function(){};try{const i=Object.defineProperty({},"passive",{get:function(){e=!0}});this._elementToAttachTo.addEventListener("test",t,i),this._elementToAttachTo.removeEventListener("test",t,i)}catch{}this._pointerBlurEvent=()=>{var i,r,s,o,a;if(this.isDeviceAvailable(Pe.Mouse)){const l=this._inputs[Pe.Mouse][0];this._mouseId>=0&&(r=(i=this._elementToAttachTo).hasPointerCapture)!=null&&r.call(i,this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let h=ke.LeftClick;h<=ke.BrowserForward;h++)if(l[h]===1){l[h]=0;const c=An.CreateDeviceEvent(Pe.Mouse,0,h,0,this,this._elementToAttachTo);this._onInputChanged(Pe.Mouse,0,c)}}if(this.isDeviceAvailable(Pe.Touch)){const l=this._inputs[Pe.Touch];for(let h=0;h<this._activeTouchIds.length;h++){const c=this._activeTouchIds[h];if((o=(s=this._elementToAttachTo).hasPointerCapture)!=null&&o.call(s,c)&&this._elementToAttachTo.releasePointerCapture(c),c!==-1&&((a=l[h])==null?void 0:a[ke.LeftClick])===1){l[h][ke.LeftClick]=0;const u=An.CreateDeviceEvent(Pe.Touch,h,ke.LeftClick,0,this,this._elementToAttachTo,c);this._onInputChanged(Pe.Touch,h,u),this._activeTouchIds[h]=-1,this._onDeviceDisconnected(Pe.Touch,h)}}}},this._pointerWheelEvent=i=>{const r=Pe.Mouse,s=0;this._inputs[r]||(this._inputs[r]=[]),this._inputs[r][s]||(this._pointerActive=!0,this._registerDevice(r,s,Eg));const o=this._inputs[r][s];if(o){o[ke.MouseWheelX]=i.deltaX||0,o[ke.MouseWheelY]=i.deltaY||i.wheelDelta||0,o[ke.MouseWheelZ]=i.deltaZ||0;const a=i;i.pointerId===void 0&&(i.pointerId=this._mouseId),o[ke.MouseWheelX]!==0&&(a.inputIndex=ke.MouseWheelX,this._onInputChanged(r,s,a)),o[ke.MouseWheelY]!==0&&(a.inputIndex=ke.MouseWheelY,this._onInputChanged(r,s,a)),o[ke.MouseWheelZ]!==0&&(a.inputIndex=ke.MouseWheelZ,this._onInputChanged(r,s,a))}},this._usingMacOS&&this._isUsingChromium&&(this._pointerMacOSChromeOutEvent=i=>{i.buttons>1&&this._pointerCancelEvent(i)},this._elementToAttachTo.addEventListener("lostpointercapture",this._pointerMacOSChromeOutEvent)),this._elementToAttachTo.addEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.addEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.addEventListener(this._wheelEventName,this._pointerWheelEvent,e?{passive:!1}:!1),this._pointerInputClearObserver=this._engine.onEndFrameObservable.add(()=>{if(this.isDeviceAvailable(Pe.Mouse)){const i=this._inputs[Pe.Mouse][0];i[ke.MouseWheelX]=0,i[ke.MouseWheelY]=0,i[ke.MouseWheelZ]=0}})}_handleGamepadActions(){this._gamepadConnectedEvent=e=>{this._addGamePad(e.gamepad)},this._gamepadDisconnectedEvent=e=>{if(this._gamepads){const t=this._getGamepadDeviceType(e.gamepad.id),i=e.gamepad.index;this._unregisterDevice(t,i),delete this._gamepads[i]}},window.addEventListener("gamepadconnected",this._gamepadConnectedEvent),window.addEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)}_updateDevice(e,t,i){const r=navigator.getGamepads()[t];if(r&&e===this._gamepads[t]){const s=this._inputs[e][t];i>=r.buttons.length?s[i]=r.axes[i-r.buttons.length].valueOf():s[i]=r.buttons[i].value}}_getGamepadDeviceType(e){return e.indexOf("054c")!==-1?e.indexOf("0ce6")!==-1?Pe.DualSense:Pe.DualShock:e.indexOf("Xbox One")!==-1||e.search("Xbox 360")!==-1||e.search("xinput")!==-1?Pe.Xbox:e.indexOf("057e")!==-1?Pe.Switch:Pe.Generic}_getPointerType(e){let t=Pe.Mouse;return(e.pointerType==="touch"||e.pointerType==="pen"||e.touches)&&(t=Pe.Touch),t}}class Tg{constructor(e,t,i=0){this.deviceType=t,this.deviceSlot=i,this.onInputChangedObservable=new he,this._deviceInputSystem=e}getInput(e){return this._deviceInputSystem.pollInput(this.deviceType,this.deviceSlot,e)}}class Py{constructor(e){this._registeredManagers=new Array,this._refCount=0,this.registerManager=o=>{for(let a=0;a<this._devices.length;a++){const l=this._devices[a];for(const h in l){const c=+h;o._addDevice(new Tg(this._deviceInputSystem,a,c))}}this._registeredManagers.push(o)},this.unregisterManager=o=>{const a=this._registeredManagers.indexOf(o);a>-1&&this._registeredManagers.splice(a,1)};const t=Object.keys(Pe).length/2;this._devices=new Array(t);const i=(o,a)=>{this._devices[o]||(this._devices[o]=new Array),this._devices[o][a]||(this._devices[o][a]=a);for(const l of this._registeredManagers){const h=new Tg(this._deviceInputSystem,o,a);l._addDevice(h)}},r=(o,a)=>{var l;(l=this._devices[o])!=null&&l[a]&&delete this._devices[o][a];for(const h of this._registeredManagers)h._removeDevice(o,a)},s=(o,a,l)=>{if(l)for(const h of this._registeredManagers)h._onInputChanged(o,a,l)};typeof _native<"u"?this._deviceInputSystem=new Ay(i,r,s):this._deviceInputSystem=new My(e,i,r,s)}dispose(){this._deviceInputSystem.dispose()}}class Oy{getDeviceSource(e,t){if(t===void 0){if(this._firstDevice[e]===void 0)return null;t=this._firstDevice[e]}return!this._devices[e]||this._devices[e][t]===void 0?null:this._devices[e][t]}getDeviceSources(e){return this._devices[e]?this._devices[e].filter(t=>!!t):[]}constructor(e){const t=Object.keys(Pe).length/2;this._devices=new Array(t),this._firstDevice=new Array(t),this._engine=e,this._engine._deviceSourceManager||(this._engine._deviceSourceManager=new Py(e)),this._engine._deviceSourceManager._refCount++,this.onDeviceConnectedObservable=new he(i=>{for(const r of this._devices)if(r)for(const s of r)s&&this.onDeviceConnectedObservable.notifyObserver(i,s)}),this.onDeviceDisconnectedObservable=new he,this._engine._deviceSourceManager.registerManager(this),this._onDisposeObserver=e.onDisposeObservable.add(()=>{this.dispose()})}dispose(){this.onDeviceConnectedObservable.clear(),this.onDeviceDisconnectedObservable.clear(),this._engine._deviceSourceManager&&(this._engine._deviceSourceManager.unregisterManager(this),--this._engine._deviceSourceManager._refCount<1&&(this._engine._deviceSourceManager.dispose(),delete this._engine._deviceSourceManager)),this._engine.onDisposeObservable.remove(this._onDisposeObserver)}_addDevice(e){this._devices[e.deviceType]||(this._devices[e.deviceType]=new Array),this._devices[e.deviceType][e.deviceSlot]||(this._devices[e.deviceType][e.deviceSlot]=e,this._updateFirstDevices(e.deviceType)),this.onDeviceConnectedObservable.notifyObservers(e)}_removeDevice(e,t){var i,r;const s=(i=this._devices[e])==null?void 0:i[t];this.onDeviceDisconnectedObservable.notifyObservers(s),(r=this._devices[e])!=null&&r[t]&&delete this._devices[e][t],this._updateFirstDevices(e)}_onInputChanged(e,t,i){var r,s;(s=(r=this._devices[e])==null?void 0:r[t])==null||s.onInputChangedObservable.notifyObservers(i)}_updateFirstDevices(e){switch(e){case Pe.Keyboard:case Pe.Mouse:this._firstDevice[e]=0;break;case Pe.Touch:case Pe.DualSense:case Pe.DualShock:case Pe.Xbox:case Pe.Switch:case Pe.Generic:{delete this._firstDevice[e];const t=this._devices[e];if(t){for(let i=0;i<t.length;i++)if(t[i]){this._firstDevice[e]=i;break}}break}}}}class xg{constructor(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}get singleClick(){return this._singleClick}get doubleClick(){return this._doubleClick}get hasSwiped(){return this._hasSwiped}get ignore(){return this._ignore}set singleClick(e){this._singleClick=e}set doubleClick(e){this._doubleClick=e}set hasSwiped(e){this._hasSwiped=e}set ignore(e){this._ignore=e}}class ri{constructor(e){this._alreadyAttached=!1,this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._totalPointersPressed=0,this._doubleClickOccured=!1,this._isSwiping=!1,this._swipeButtonPressed=-1,this._skipPointerTap=!1,this._isMultiTouchGesture=!1,this._pointerX=0,this._pointerY=0,this._startingPointerPosition=new me(0,0),this._previousStartingPointerPosition=new me(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._pointerCaptures={},this._meshUnderPointerId={},this._movePointerInfo=null,this._cameraObserverCount=0,this._delayedClicks=[null,null,null,null,null],this._deviceSourceManager=null,this._scene=e||rt.LastCreatedScene,this._scene}get meshUnderPointer(){return this._movePointerInfo&&(this._movePointerInfo._generatePickInfo(),this._movePointerInfo=null),this._pointerOverMesh}getMeshUnderPointerByPointerId(e){return this._meshUnderPointerId[e]||null}get unTranslatedPointer(){return new me(this._unTranslatedPointerX,this._unTranslatedPointerY)}get pointerX(){return this._pointerX}set pointerX(e){this._pointerX=e}get pointerY(){return this._pointerY}set pointerY(e){this._pointerY=e}_updatePointerPosition(e){const t=this._scene.getEngine().getInputElementClientRect();t&&(this._pointerX=e.clientX-t.left,this._pointerY=e.clientY-t.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)}_processPointerMove(e,t){const i=this._scene,r=i.getEngine(),s=r.getInputElement();s&&(s.tabIndex=r.canvasTabIndex,i.doNotHandleCursors||(s.style.cursor=i.defaultCursor)),this._setCursorAndPointerOverMesh(e,t,i);for(const l of i._pointerMoveStage){e=e||this._pickMove(t);const h=!!(e!=null&&e.pickedMesh);e=l.action(this._unTranslatedPointerX,this._unTranslatedPointerY,e,h,s)}const o=t.inputIndex>=ke.MouseWheelX&&t.inputIndex<=ke.MouseWheelZ?dt.POINTERWHEEL:dt.POINTERMOVE;i.onPointerMove&&(e=e||this._pickMove(t),i.onPointerMove(t,e,o));let a;e?(a=new Ps(o,t,e),this._setRayOnPointerInfo(e,t)):(a=new Ps(o,t,null,this),this._movePointerInfo=a),i.onPointerObservable.hasObservers()&&i.onPointerObservable.notifyObservers(a,o)}_setRayOnPointerInfo(e,t){const i=this._scene;e&&i._pickingAvailable&&(e.ray||(e.ray=i.createPickingRay(t.offsetX,t.offsetY,U.Identity(),i.activeCamera)))}_addCameraPointerObserver(e,t){return this._cameraObserverCount++,this._scene.onPointerObservable.add(e,t)}_removeCameraPointerObserver(e){return this._cameraObserverCount--,this._scene.onPointerObservable.remove(e)}_checkForPicking(){return!!(this._scene.onPointerObservable.observers.length>this._cameraObserverCount||this._scene.onPointerPick)}_checkPrePointerObservable(e,t,i){const r=this._scene,s=new Iy(i,t,this._unTranslatedPointerX,this._unTranslatedPointerY);return e&&(s.originalPickingInfo=e,s.ray=e.ray,t.pointerType==="xr-near"&&e.originMesh&&(s.nearInteractionPickingInfo=e)),r.onPrePointerObservable.notifyObservers(s,i),!!s.skipOnPointerObservable}_pickMove(e){const t=this._scene,i=t.pick(this._unTranslatedPointerX,this._unTranslatedPointerY,t.pointerMovePredicate,t.pointerMoveFastCheck,t.cameraToUseForPointers,t.pointerMoveTrianglePredicate);return this._setCursorAndPointerOverMesh(i,e,t),i}_setCursorAndPointerOverMesh(e,t,i){const r=i.getEngine().getInputElement();if(e!=null&&e.pickedMesh){if(this.setPointerOverMesh(e.pickedMesh,t.pointerId,e,t),!i.doNotHandleCursors&&r&&this._pointerOverMesh){const s=this._pointerOverMesh._getActionManagerForTrigger();s&&s.hasPointerTriggers&&(r.style.cursor=s.hoverCursor||i.hoverCursor)}}else this.setPointerOverMesh(null,t.pointerId,e,t)}simulatePointerMove(e,t){const i=new PointerEvent("pointermove",t);i.inputIndex=ke.Move,!this._checkPrePointerObservable(e,i,dt.POINTERMOVE)&&this._processPointerMove(e,i)}simulatePointerDown(e,t){const i=new PointerEvent("pointerdown",t);i.inputIndex=i.button+2,!this._checkPrePointerObservable(e,i,dt.POINTERDOWN)&&this._processPointerDown(e,i)}_processPointerDown(e,t){const i=this._scene;if(e!=null&&e.pickedMesh){this._pickedDownMesh=e.pickedMesh;const o=e.pickedMesh._getActionManagerForTrigger();if(o){if(o.hasPickTriggers)switch(o.processTrigger(5,Si.CreateNew(e.pickedMesh,t,e)),t.button){case 0:o.processTrigger(2,Si.CreateNew(e.pickedMesh,t,e));break;case 1:o.processTrigger(4,Si.CreateNew(e.pickedMesh,t,e));break;case 2:o.processTrigger(3,Si.CreateNew(e.pickedMesh,t,e));break}o.hasSpecificTrigger(8)&&window.setTimeout(()=>{const a=i.pick(this._unTranslatedPointerX,this._unTranslatedPointerY,l=>l.isPickable&&l.isVisible&&l.isReady()&&l.actionManager&&l.actionManager.hasSpecificTrigger(8)&&l===this._pickedDownMesh,!1,i.cameraToUseForPointers);a!=null&&a.pickedMesh&&o&&this._totalPointersPressed!==0&&Date.now()-this._startingPointerTime>ri.LongPressDelay&&!this._isPointerSwiping()&&(this._startingPointerTime=0,o.processTrigger(8,Si.CreateNew(a.pickedMesh,t)))},ri.LongPressDelay)}}else for(const o of i._pointerDownStage)e=o.action(this._unTranslatedPointerX,this._unTranslatedPointerY,e,t,!1);let r;const s=dt.POINTERDOWN;e?(i.onPointerDown&&i.onPointerDown(t,e,s),r=new Ps(s,t,e),this._setRayOnPointerInfo(e,t)):r=new Ps(s,t,null,this),i.onPointerObservable.hasObservers()&&i.onPointerObservable.notifyObservers(r,s)}_isPointerSwiping(){return this._isSwiping}simulatePointerUp(e,t,i){const r=new PointerEvent("pointerup",t);r.inputIndex=ke.Move;const s=new xg;i?s.doubleClick=!0:s.singleClick=!0,!this._checkPrePointerObservable(e,r,dt.POINTERUP)&&this._processPointerUp(e,r,s)}_processPointerUp(e,t,i){const r=this._scene;if(e!=null&&e.pickedMesh){if(this._pickedUpMesh=e.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(r.onPointerPick&&r.onPointerPick(t,e),i.singleClick&&!i.ignore&&r.onPointerObservable.observers.length>this._cameraObserverCount)){const o=dt.POINTERPICK,a=new Ps(o,t,e);this._setRayOnPointerInfo(e,t),r.onPointerObservable.notifyObservers(a,o)}const s=e.pickedMesh._getActionManagerForTrigger();if(s&&!i.ignore){s.processTrigger(7,Si.CreateNew(e.pickedMesh,t,e)),!i.hasSwiped&&i.singleClick&&s.processTrigger(1,Si.CreateNew(e.pickedMesh,t,e));const o=e.pickedMesh._getActionManagerForTrigger(6);i.doubleClick&&o&&o.processTrigger(6,Si.CreateNew(e.pickedMesh,t,e))}}else if(!i.ignore)for(const s of r._pointerUpStage)e=s.action(this._unTranslatedPointerX,this._unTranslatedPointerY,e,t,i.doubleClick);if(this._pickedDownMesh&&this._pickedDownMesh!==this._pickedUpMesh){const s=this._pickedDownMesh._getActionManagerForTrigger(16);s&&s.processTrigger(16,Si.CreateNew(this._pickedDownMesh,t))}if(!i.ignore){const s=new Ps(dt.POINTERUP,t,e);if(this._setRayOnPointerInfo(e,t),r.onPointerObservable.notifyObservers(s,dt.POINTERUP),r.onPointerUp&&r.onPointerUp(t,e,dt.POINTERUP),!i.hasSwiped&&!this._skipPointerTap&&!this._isMultiTouchGesture){let o=0;if(i.singleClick?o=dt.POINTERTAP:i.doubleClick&&(o=dt.POINTERDOUBLETAP),o){const a=new Ps(o,t,e);r.onPointerObservable.hasObservers()&&r.onPointerObservable.hasSpecificMask(o)&&r.onPointerObservable.notifyObservers(a,o)}}}}isPointerCaptured(e=0){return this._pointerCaptures[e]}attachControl(e=!0,t=!0,i=!0,r=null){const s=this._scene,o=s.getEngine();r||(r=o.getInputElement()),this._alreadyAttached&&this.detachControl(),r&&(this._alreadyAttachedTo=r),this._deviceSourceManager=new Oy(o),this._initActionManager=a=>{if(!this._meshPickProceed){const l=s.skipPointerUpPicking||s._registeredActions===0&&!this._checkForPicking()&&!s.onPointerUp?null:s.pick(this._unTranslatedPointerX,this._unTranslatedPointerY,s.pointerUpPredicate,s.pointerUpFastCheck,s.cameraToUseForPointers,s.pointerUpTrianglePredicate);this._currentPickResult=l,l&&(a=l.hit&&l.pickedMesh?l.pickedMesh._getActionManagerForTrigger():null),this._meshPickProceed=!0}return a},this._delayedSimpleClick=(a,l,h)=>{if((Date.now()-this._previousStartingPointerTime>ri.DoubleClickDelay&&!this._doubleClickOccured||a!==this._previousButtonPressed)&&(this._doubleClickOccured=!1,l.singleClick=!0,l.ignore=!1,this._delayedClicks[a])){const c=this._delayedClicks[a].evt,u=dt.POINTERTAP,d=new Ps(u,c,this._currentPickResult);s.onPointerObservable.hasObservers()&&s.onPointerObservable.hasSpecificMask(u)&&s.onPointerObservable.notifyObservers(d,u),this._delayedClicks[a]=null}},this._initClickEvent=(a,l,h,c)=>{var u,d;const f=new xg;this._currentPickResult=null;let p=null,g=a.hasSpecificMask(dt.POINTERPICK)||l.hasSpecificMask(dt.POINTERPICK)||a.hasSpecificMask(dt.POINTERTAP)||l.hasSpecificMask(dt.POINTERTAP)||a.hasSpecificMask(dt.POINTERDOUBLETAP)||l.hasSpecificMask(dt.POINTERDOUBLETAP);!g&&yr&&(p=this._initActionManager(p,f),p&&(g=p.hasPickTriggers));let m=!1;if(g){const x=h.button;if(f.hasSwiped=this._isPointerSwiping(),!f.hasSwiped){let E=!ri.ExclusiveDoubleClickMode;if(E||(E=!a.hasSpecificMask(dt.POINTERDOUBLETAP)&&!l.hasSpecificMask(dt.POINTERDOUBLETAP),E&&!yr.HasSpecificTrigger(6)&&(p=this._initActionManager(p,f),p&&(E=!p.hasSpecificTrigger(6)))),E)(Date.now()-this._previousStartingPointerTime>ri.DoubleClickDelay||x!==this._previousButtonPressed)&&(f.singleClick=!0,c(f,this._currentPickResult),m=!0);else{const C={evt:h,clickInfo:f,timeoutId:window.setTimeout(this._delayedSimpleClick.bind(this,x,f,c),ri.DoubleClickDelay)};this._delayedClicks[x]=C}let R=a.hasSpecificMask(dt.POINTERDOUBLETAP)||l.hasSpecificMask(dt.POINTERDOUBLETAP);!R&&yr.HasSpecificTrigger(6)&&(p=this._initActionManager(p,f),p&&(R=p.hasSpecificTrigger(6))),R&&(x===this._previousButtonPressed&&Date.now()-this._previousStartingPointerTime<ri.DoubleClickDelay&&!this._doubleClickOccured?(!f.hasSwiped&&!this._isPointerSwiping()?(this._previousStartingPointerTime=0,this._doubleClickOccured=!0,f.doubleClick=!0,f.ignore=!1,ri.ExclusiveDoubleClickMode&&this._delayedClicks[x]&&(clearTimeout((u=this._delayedClicks[x])==null?void 0:u.timeoutId),this._delayedClicks[x]=null),c(f,this._currentPickResult)):(this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=x,ri.ExclusiveDoubleClickMode?(this._delayedClicks[x]&&(clearTimeout((d=this._delayedClicks[x])==null?void 0:d.timeoutId),this._delayedClicks[x]=null),c(f,this._previousPickResult)):c(f,this._currentPickResult)),m=!0):(this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=x))}}m||c(f,this._currentPickResult)},this._onPointerMove=a=>{if(this._updatePointerPosition(a),!this._isSwiping&&this._swipeButtonPressed!==-1&&(this._isSwiping=Math.abs(this._startingPointerPosition.x-this._pointerX)>ri.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>ri.DragMovementThreshold),o.isPointerLock&&o._verifyPointerLock(),this._checkPrePointerObservable(null,a,a.inputIndex>=ke.MouseWheelX&&a.inputIndex<=ke.MouseWheelZ?dt.POINTERWHEEL:dt.POINTERMOVE)||!s.cameraToUseForPointers&&!s.activeCamera)return;if(s.skipPointerMovePicking){this._processPointerMove(new Ts,a);return}s.pointerMovePredicate||(s.pointerMovePredicate=h=>h.isPickable&&h.isVisible&&h.isReady()&&h.isEnabled()&&(h.enablePointerMoveEvents||s.constantlyUpdateMeshUnderPointer||h._getActionManagerForTrigger()!==null)&&(!s.cameraToUseForPointers||(s.cameraToUseForPointers.layerMask&h.layerMask)!==0));const l=s._registeredActions>0||s.constantlyUpdateMeshUnderPointer?this._pickMove(a):null;this._processPointerMove(l,a)},this._onPointerDown=a=>{var l;if(this._totalPointersPressed++,this._pickedDownMesh=null,this._meshPickProceed=!1,ri.ExclusiveDoubleClickMode){for(let c=0;c<this._delayedClicks.length;c++)if(this._delayedClicks[c])if(a.button===c)clearTimeout((l=this._delayedClicks[c])==null?void 0:l.timeoutId);else{const u=this._delayedClicks[c].clickInfo;this._doubleClickOccured=!1,u.singleClick=!0,u.ignore=!1;const d=this._delayedClicks[c].evt,f=dt.POINTERTAP,p=new Ps(f,d,this._currentPickResult);s.onPointerObservable.hasObservers()&&s.onPointerObservable.hasSpecificMask(f)&&s.onPointerObservable.notifyObservers(p,f),this._delayedClicks[c]=null}}if(this._updatePointerPosition(a),this._swipeButtonPressed===-1&&(this._swipeButtonPressed=a.button),s.preventDefaultOnPointerDown&&r&&(a.preventDefault(),r.focus()),this._startingPointerPosition.x=this._pointerX,this._startingPointerPosition.y=this._pointerY,this._startingPointerTime=Date.now(),this._checkPrePointerObservable(null,a,dt.POINTERDOWN)||!s.cameraToUseForPointers&&!s.activeCamera)return;this._pointerCaptures[a.pointerId]=!0,s.pointerDownPredicate||(s.pointerDownPredicate=c=>c.isPickable&&c.isVisible&&c.isReady()&&c.isEnabled()&&(!s.cameraToUseForPointers||(s.cameraToUseForPointers.layerMask&c.layerMask)!==0)),this._pickedDownMesh=null;let h;s.skipPointerDownPicking||s._registeredActions===0&&!this._checkForPicking()&&!s.onPointerDown?h=new Ts:h=s.pick(this._unTranslatedPointerX,this._unTranslatedPointerY,s.pointerDownPredicate,s.pointerDownFastCheck,s.cameraToUseForPointers,s.pointerDownTrianglePredicate),this._processPointerDown(h,a)},this._onPointerUp=a=>{this._totalPointersPressed!==0&&(this._totalPointersPressed--,this._pickedUpMesh=null,this._meshPickProceed=!1,this._updatePointerPosition(a),s.preventDefaultOnPointerUp&&r&&(a.preventDefault(),r.focus()),this._initClickEvent(s.onPrePointerObservable,s.onPointerObservable,a,(l,h)=>{if(s.onPrePointerObservable.hasObservers()&&(this._skipPointerTap=!1,!l.ignore)){if(this._checkPrePointerObservable(null,a,dt.POINTERUP)){this._swipeButtonPressed===a.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1),a.buttons===0&&(this._pointerCaptures[a.pointerId]=!1);return}l.hasSwiped||(l.singleClick&&s.onPrePointerObservable.hasSpecificMask(dt.POINTERTAP)&&this._checkPrePointerObservable(null,a,dt.POINTERTAP)&&(this._skipPointerTap=!0),l.doubleClick&&s.onPrePointerObservable.hasSpecificMask(dt.POINTERDOUBLETAP)&&this._checkPrePointerObservable(null,a,dt.POINTERDOUBLETAP)&&(this._skipPointerTap=!0))}if(!this._pointerCaptures[a.pointerId]){this._swipeButtonPressed===a.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1);return}a.buttons===0&&(this._pointerCaptures[a.pointerId]=!1),!(!s.cameraToUseForPointers&&!s.activeCamera)&&(s.pointerUpPredicate||(s.pointerUpPredicate=c=>c.isPickable&&c.isVisible&&c.isReady()&&c.isEnabled()&&(!s.cameraToUseForPointers||(s.cameraToUseForPointers.layerMask&c.layerMask)!==0)),!this._meshPickProceed&&(yr&&yr.HasTriggers||this._checkForPicking()||s.onPointerUp)&&this._initActionManager(null,l),h||(h=this._currentPickResult),this._processPointerUp(h,a,l),this._previousPickResult=this._currentPickResult,this._swipeButtonPressed===a.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1))}))},this._onKeyDown=a=>{const l=ch.KEYDOWN;if(s.onPreKeyboardObservable.hasObservers()){const h=new dg(l,a);if(s.onPreKeyboardObservable.notifyObservers(h,l),h.skipOnKeyboardObservable)return}if(s.onKeyboardObservable.hasObservers()){const h=new Mu(l,a);s.onKeyboardObservable.notifyObservers(h,l)}s.actionManager&&s.actionManager.processTrigger(14,Si.CreateNewFromScene(s,a))},this._onKeyUp=a=>{const l=ch.KEYUP;if(s.onPreKeyboardObservable.hasObservers()){const h=new dg(l,a);if(s.onPreKeyboardObservable.notifyObservers(h,l),h.skipOnKeyboardObservable)return}if(s.onKeyboardObservable.hasObservers()){const h=new Mu(l,a);s.onKeyboardObservable.notifyObservers(h,l)}s.actionManager&&s.actionManager.processTrigger(15,Si.CreateNewFromScene(s,a))},this._deviceSourceManager.onDeviceConnectedObservable.add(a=>{a.deviceType===Pe.Mouse?a.onInputChangedObservable.add(l=>{l.inputIndex===ke.LeftClick||l.inputIndex===ke.MiddleClick||l.inputIndex===ke.RightClick||l.inputIndex===ke.BrowserBack||l.inputIndex===ke.BrowserForward?t&&a.getInput(l.inputIndex)===1?this._onPointerDown(l):e&&a.getInput(l.inputIndex)===0&&this._onPointerUp(l):i&&(l.inputIndex===ke.Move?this._onPointerMove(l):(l.inputIndex===ke.MouseWheelX||l.inputIndex===ke.MouseWheelY||l.inputIndex===ke.MouseWheelZ)&&this._onPointerMove(l))}):a.deviceType===Pe.Touch?a.onInputChangedObservable.add(l=>{l.inputIndex===ke.LeftClick&&(t&&a.getInput(l.inputIndex)===1?(this._onPointerDown(l),this._totalPointersPressed>1&&(this._isMultiTouchGesture=!0)):e&&a.getInput(l.inputIndex)===0&&(this._onPointerUp(l),this._totalPointersPressed===0&&(this._isMultiTouchGesture=!1))),i&&l.inputIndex===ke.Move&&this._onPointerMove(l)}):a.deviceType===Pe.Keyboard&&a.onInputChangedObservable.add(l=>{l.type==="keydown"?this._onKeyDown(l):l.type==="keyup"&&this._onKeyUp(l)})}),this._alreadyAttached=!0}detachControl(){this._alreadyAttached&&(this._deviceSourceManager.dispose(),this._deviceSourceManager=null,this._alreadyAttachedTo&&!this._scene.doNotHandleCursors&&(this._alreadyAttachedTo.style.cursor=this._scene.defaultCursor),this._alreadyAttached=!1,this._alreadyAttachedTo=null)}setPointerOverMesh(e,t=0,i,r){if(this._meshUnderPointerId[t]===e&&(!e||!e._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting))return;const s=this._meshUnderPointerId[t];let o;s&&(o=s._getActionManagerForTrigger(10),o&&o.processTrigger(10,Si.CreateNew(s,r,{pointerId:t}))),e?(this._meshUnderPointerId[t]=e,this._pointerOverMesh=e,o=e._getActionManagerForTrigger(9),o&&o.processTrigger(9,Si.CreateNew(e,r,{pointerId:t,pickResult:i}))):(delete this._meshUnderPointerId[t],this._pointerOverMesh=null)}getPointerOverMesh(){return this.meshUnderPointer}_invalidateMesh(e){this._pointerOverMesh===e&&(this._pointerOverMesh=null),this._pickedDownMesh===e&&(this._pickedDownMesh=null),this._pickedUpMesh===e&&(this._pickedUpMesh=null);for(const t in this._meshUnderPointerId)this._meshUnderPointerId[t]===e&&delete this._meshUnderPointerId[t]}}ri.DragMovementThreshold=10;ri.LongPressDelay=500;ri.DoubleClickDelay=300;ri.ExclusiveDoubleClickMode=!1;class _s{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(e,t){_s.Enabled&&(this._current+=e,t&&this._fetchResult())}beginMonitoring(){_s.Enabled&&(this._startMonitoringTime=hr.Now)}endMonitoring(e=!0){if(!_s.Enabled)return;e&&this.fetchNewFrame();const t=hr.Now;this._current=t-this._startMonitoringTime,e&&this._fetchResult()}endFrame(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const e=hr.Now;e-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=e,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}_s.Enabled=!0;class Zr{constructor(e,t,i,r){this.normal=new v(e,t,i),this.d=r}asArray(){return[this.normal.x,this.normal.y,this.normal.z,this.d]}clone(){return new Zr(this.normal.x,this.normal.y,this.normal.z,this.d)}getClassName(){return"Plane"}getHashCode(){let e=this.normal.getHashCode();return e=e*397^(this.d|0),e}normalize(){const e=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z);let t=0;return e!==0&&(t=1/e),this.normal.x*=t,this.normal.y*=t,this.normal.z*=t,this.d*=t,this}transform(e){const t=Zr._TmpMatrix;e.invertToRef(t);const i=t.m,r=this.normal.x,s=this.normal.y,o=this.normal.z,a=this.d,l=r*i[0]+s*i[1]+o*i[2]+a*i[3],h=r*i[4]+s*i[5]+o*i[6]+a*i[7],c=r*i[8]+s*i[9]+o*i[10]+a*i[11],u=r*i[12]+s*i[13]+o*i[14]+a*i[15];return new Zr(l,h,c,u)}dotCoordinate(e){return this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z+this.d}copyFromPoints(e,t,i){const r=t.x-e.x,s=t.y-e.y,o=t.z-e.z,a=i.x-e.x,l=i.y-e.y,h=i.z-e.z,c=s*h-o*l,u=o*a-r*h,d=r*l-s*a,f=Math.sqrt(c*c+u*u+d*d);let p;return f!==0?p=1/f:p=0,this.normal.x=c*p,this.normal.y=u*p,this.normal.z=d*p,this.d=-(this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z),this}isFrontFacingTo(e,t){return v.Dot(this.normal,e)<=t}signedDistanceTo(e){return v.Dot(e,this.normal)+this.d}static FromArray(e){return new Zr(e[0],e[1],e[2],e[3])}static FromPoints(e,t,i){const r=new Zr(0,0,0,0);return r.copyFromPoints(e,t,i),r}static FromPositionAndNormal(e,t){const i=new Zr(0,0,0,0);return this.FromPositionAndNormalToRef(e,t,i)}static FromPositionAndNormalToRef(e,t,i){return i.normal.copyFrom(t),i.normal.normalize(),i.d=-e.dot(i.normal),i}static SignedDistanceToPlaneFromPositionAndNormal(e,t,i){const r=-(t.x*e.x+t.y*e.y+t.z*e.z);return v.Dot(i,t)+r}}Zr._TmpMatrix=U.Identity();class Nr{static GetPlanes(e){const t=[];for(let i=0;i<6;i++)t.push(new Zr(0,0,0,0));return Nr.GetPlanesToRef(e,t),t}static GetNearPlaneToRef(e,t){const i=e.m;t.normal.x=i[3]+i[2],t.normal.y=i[7]+i[6],t.normal.z=i[11]+i[10],t.d=i[15]+i[14],t.normalize()}static GetFarPlaneToRef(e,t){const i=e.m;t.normal.x=i[3]-i[2],t.normal.y=i[7]-i[6],t.normal.z=i[11]-i[10],t.d=i[15]-i[14],t.normalize()}static GetLeftPlaneToRef(e,t){const i=e.m;t.normal.x=i[3]+i[0],t.normal.y=i[7]+i[4],t.normal.z=i[11]+i[8],t.d=i[15]+i[12],t.normalize()}static GetRightPlaneToRef(e,t){const i=e.m;t.normal.x=i[3]-i[0],t.normal.y=i[7]-i[4],t.normal.z=i[11]-i[8],t.d=i[15]-i[12],t.normalize()}static GetTopPlaneToRef(e,t){const i=e.m;t.normal.x=i[3]-i[1],t.normal.y=i[7]-i[5],t.normal.z=i[11]-i[9],t.d=i[15]-i[13],t.normalize()}static GetBottomPlaneToRef(e,t){const i=e.m;t.normal.x=i[3]+i[1],t.normal.y=i[7]+i[5],t.normal.z=i[11]+i[9],t.d=i[15]+i[13],t.normalize()}static GetPlanesToRef(e,t){Nr.GetNearPlaneToRef(e,t[0]),Nr.GetFarPlaneToRef(e,t[1]),Nr.GetLeftPlaneToRef(e,t[2]),Nr.GetRightPlaneToRef(e,t[3]),Nr.GetTopPlaneToRef(e,t[4]),Nr.GetBottomPlaneToRef(e,t[5])}static IsPointInFrustum(e,t){for(let i=0;i<6;i++)if(t[i].dotCoordinate(e)<0)return!1;return!0}}class gd{static get UniqueId(){const e=this._UniqueIdCounter;return this._UniqueIdCounter++,e}}gd._UniqueIdCounter=1;class mt{static CompareLightsPriority(e,t){return e.shadowEnabled!==t.shadowEnabled?(t.shadowEnabled?1:0)-(e.shadowEnabled?1:0):t.renderPriority-e.renderPriority}}mt.FALLOFF_DEFAULT=0;mt.FALLOFF_PHYSICAL=1;mt.FALLOFF_GLTF=2;mt.FALLOFF_STANDARD=3;mt.LIGHTMAP_DEFAULT=0;mt.LIGHTMAP_SPECULAR=1;mt.LIGHTMAP_SHADOWSONLY=2;mt.INTENSITYMODE_AUTOMATIC=0;mt.INTENSITYMODE_LUMINOUSPOWER=1;mt.INTENSITYMODE_LUMINOUSINTENSITY=2;mt.INTENSITYMODE_ILLUMINANCE=3;mt.INTENSITYMODE_LUMINANCE=4;mt.LIGHTTYPEID_POINTLIGHT=0;mt.LIGHTTYPEID_DIRECTIONALLIGHT=1;mt.LIGHTTYPEID_SPOTLIGHT=2;mt.LIGHTTYPEID_HEMISPHERICLIGHT=3;class Dy{constructor(){this.pointerDownFastCheck=!1,this.pointerUpFastCheck=!1,this.pointerMoveFastCheck=!1,this.skipPointerMovePicking=!1,this.skipPointerDownPicking=!1,this.skipPointerUpPicking=!1}}var vs;(function(n){n[n.BackwardCompatible=0]="BackwardCompatible",n[n.Intermediate=1]="Intermediate",n[n.Aggressive=2]="Aggressive"})(vs||(vs={}));class Pt extends Za{static DefaultMaterialFactory(e){throw Ge("StandardMaterial")}static CollisionCoordinatorFactory(){throw Ge("DefaultCollisionCoordinator")}get environmentTexture(){return this._environmentTexture}set environmentTexture(e){this._environmentTexture!==e&&(this._environmentTexture=e,this.markAllMaterialsAsDirty(1))}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}get performancePriority(){return this._performancePriority}set performancePriority(e){if(e!==this._performancePriority){switch(this._performancePriority=e,e){case vs.BackwardCompatible:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.skipPointerMovePicking=!1,this.autoClear=!0;break;case vs.Intermediate:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.skipPointerMovePicking=!0,this.autoClear=!1;break;case vs.Aggressive:this.skipFrustumClipping=!0,this._renderingManager.maintainStateBetweenFrames=!0,this.skipPointerMovePicking=!0,this.autoClear=!1;break}this.onScenePerformancePriorityChangedObservable.notifyObservers(e)}}set forceWireframe(e){this._forceWireframe!==e&&(this._forceWireframe=e,this.markAllMaterialsAsDirty(16))}get forceWireframe(){return this._forceWireframe}set skipFrustumClipping(e){this._skipFrustumClipping!==e&&(this._skipFrustumClipping=e)}get skipFrustumClipping(){return this._skipFrustumClipping}set forcePointsCloud(e){this._forcePointsCloud!==e&&(this._forcePointsCloud=e,this.markAllMaterialsAsDirty(16))}get forcePointsCloud(){return this._forcePointsCloud}get animationPropertiesOverride(){return this._animationPropertiesOverride}set animationPropertiesOverride(e){this._animationPropertiesOverride=e}set onDispose(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)}set beforeRender(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),e&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e))}set afterRender(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),e&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(e))}set beforeCameraRender(e){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(e)}set afterCameraRender(e){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(e)}get pointerDownPredicate(){return this._pointerPickingConfiguration.pointerDownPredicate}set pointerDownPredicate(e){this._pointerPickingConfiguration.pointerDownPredicate=e}get pointerUpPredicate(){return this._pointerPickingConfiguration.pointerUpPredicate}set pointerUpPredicate(e){this._pointerPickingConfiguration.pointerUpPredicate=e}get pointerMovePredicate(){return this._pointerPickingConfiguration.pointerMovePredicate}set pointerMovePredicate(e){this._pointerPickingConfiguration.pointerMovePredicate=e}get pointerDownFastCheck(){return this._pointerPickingConfiguration.pointerDownFastCheck}set pointerDownFastCheck(e){this._pointerPickingConfiguration.pointerDownFastCheck=e}get pointerUpFastCheck(){return this._pointerPickingConfiguration.pointerUpFastCheck}set pointerUpFastCheck(e){this._pointerPickingConfiguration.pointerUpFastCheck=e}get pointerMoveFastCheck(){return this._pointerPickingConfiguration.pointerMoveFastCheck}set pointerMoveFastCheck(e){this._pointerPickingConfiguration.pointerMoveFastCheck=e}get skipPointerMovePicking(){return this._pointerPickingConfiguration.skipPointerMovePicking}set skipPointerMovePicking(e){this._pointerPickingConfiguration.skipPointerMovePicking=e}get skipPointerDownPicking(){return this._pointerPickingConfiguration.skipPointerDownPicking}set skipPointerDownPicking(e){this._pointerPickingConfiguration.skipPointerDownPicking=e}get skipPointerUpPicking(){return this._pointerPickingConfiguration.skipPointerUpPicking}set skipPointerUpPicking(e){this._pointerPickingConfiguration.skipPointerUpPicking=e}get unTranslatedPointer(){return this._inputManager.unTranslatedPointer}static get DragMovementThreshold(){return ri.DragMovementThreshold}static set DragMovementThreshold(e){ri.DragMovementThreshold=e}static get LongPressDelay(){return ri.LongPressDelay}static set LongPressDelay(e){ri.LongPressDelay=e}static get DoubleClickDelay(){return ri.DoubleClickDelay}static set DoubleClickDelay(e){ri.DoubleClickDelay=e}static get ExclusiveDoubleClickMode(){return ri.ExclusiveDoubleClickMode}static set ExclusiveDoubleClickMode(e){ri.ExclusiveDoubleClickMode=e}bindEyePosition(e,t="vEyePosition",i=!1){const r=this._forcedViewPosition?this._forcedViewPosition:this._mirroredCameraPosition?this._mirroredCameraPosition:this.activeCamera.globalPosition,s=this.useRightHandedSystem===(this._mirroredCameraPosition!=null);return W.Vector4[0].set(r.x,r.y,r.z,s?-1:1),e&&(i?e.setFloat3(t,W.Vector4[0].x,W.Vector4[0].y,W.Vector4[0].z):e.setVector4(t,W.Vector4[0])),W.Vector4[0]}finalizeSceneUbo(){const e=this.getSceneUniformBuffer(),t=this.bindEyePosition(null);return e.updateFloat4("vEyePosition",t.x,t.y,t.z,t.w),e.update(),e}set useRightHandedSystem(e){this._useRightHandedSystem!==e&&(this._useRightHandedSystem=e,this.markAllMaterialsAsDirty(16))}get useRightHandedSystem(){return this._useRightHandedSystem}setStepId(e){this._currentStepId=e}getStepId(){return this._currentStepId}getInternalStep(){return this._currentInternalStep}set fogEnabled(e){this._fogEnabled!==e&&(this._fogEnabled=e,this.markAllMaterialsAsDirty(16))}get fogEnabled(){return this._fogEnabled}set fogMode(e){this._fogMode!==e&&(this._fogMode=e,this.markAllMaterialsAsDirty(16))}get fogMode(){return this._fogMode}get prePass(){return!!this.prePassRenderer&&this.prePassRenderer.defaultRT.enabled}set shadowsEnabled(e){this._shadowsEnabled!==e&&(this._shadowsEnabled=e,this.markAllMaterialsAsDirty(2))}get shadowsEnabled(){return this._shadowsEnabled}set lightsEnabled(e){this._lightsEnabled!==e&&(this._lightsEnabled=e,this.markAllMaterialsAsDirty(2))}get lightsEnabled(){return this._lightsEnabled}get activeCameras(){return this._activeCameras}set activeCameras(e){this._unObserveActiveCameras&&(this._unObserveActiveCameras(),this._unObserveActiveCameras=null),e&&(this._unObserveActiveCameras=s0(e,()=>{this.onActiveCamerasChanged.notifyObservers(this)})),this._activeCameras=e}get activeCamera(){return this._activeCamera}set activeCamera(e){e!==this._activeCamera&&(this._activeCamera=e,this.onActiveCameraChanged.notifyObservers(this))}get defaultMaterial(){return this._defaultMaterial||(this._defaultMaterial=Pt.DefaultMaterialFactory(this)),this._defaultMaterial}set defaultMaterial(e){this._defaultMaterial=e}set texturesEnabled(e){this._texturesEnabled!==e&&(this._texturesEnabled=e,this.markAllMaterialsAsDirty(1))}get texturesEnabled(){return this._texturesEnabled}set skeletonsEnabled(e){this._skeletonsEnabled!==e&&(this._skeletonsEnabled=e,this.markAllMaterialsAsDirty(8))}get skeletonsEnabled(){return this._skeletonsEnabled}get collisionCoordinator(){return this._collisionCoordinator||(this._collisionCoordinator=Pt.CollisionCoordinatorFactory(),this._collisionCoordinator.init(this)),this._collisionCoordinator}get renderingManager(){return this._renderingManager}get frustumPlanes(){return this._frustumPlanes}_registerTransientComponents(){if(this._transientComponents.length>0){for(const e of this._transientComponents)e.register();this._transientComponents.length=0}}_addComponent(e){this._components.push(e),this._transientComponents.push(e);const t=e;t.addFromContainer&&t.serialize&&this._serializableComponents.push(t)}_getComponent(e){for(const t of this._components)if(t.name===e)return t;return null}constructor(e,t){super(),this._inputManager=new ri(this),this.cameraToUseForPointers=null,this._isScene=!0,this._blockEntityCollection=!1,this.autoClear=!0,this.autoClearDepthAndStencil=!0,this.clearColor=new $e(.2,.2,.3,1),this.ambientColor=new De(0,0,0),this.environmentIntensity=1,this._performancePriority=vs.BackwardCompatible,this.onScenePerformancePriorityChangedObservable=new he,this._forceWireframe=!1,this._skipFrustumClipping=!1,this._forcePointsCloud=!1,this.animationsEnabled=!0,this._animationPropertiesOverride=null,this.useConstantAnimationDeltaTime=!1,this.constantlyUpdateMeshUnderPointer=!1,this.hoverCursor="pointer",this.defaultCursor="",this.doNotHandleCursors=!1,this.preventDefaultOnPointerDown=!0,this.preventDefaultOnPointerUp=!0,this.metadata=null,this.reservedDataStore=null,this.disableOfflineSupportExceptionRules=[],this.onDisposeObservable=new he,this._onDisposeObserver=null,this.onBeforeRenderObservable=new he,this._onBeforeRenderObserver=null,this.onAfterRenderObservable=new he,this.onAfterRenderCameraObservable=new he,this._onAfterRenderObserver=null,this.onBeforeAnimationsObservable=new he,this.onAfterAnimationsObservable=new he,this.onBeforeDrawPhaseObservable=new he,this.onAfterDrawPhaseObservable=new he,this.onReadyObservable=new he,this.onBeforeCameraRenderObservable=new he,this._onBeforeCameraRenderObserver=null,this.onAfterCameraRenderObservable=new he,this._onAfterCameraRenderObserver=null,this.onBeforeActiveMeshesEvaluationObservable=new he,this.onAfterActiveMeshesEvaluationObservable=new he,this.onBeforeParticlesRenderingObservable=new he,this.onAfterParticlesRenderingObservable=new he,this.onDataLoadedObservable=new he,this.onNewCameraAddedObservable=new he,this.onCameraRemovedObservable=new he,this.onNewLightAddedObservable=new he,this.onLightRemovedObservable=new he,this.onNewGeometryAddedObservable=new he,this.onGeometryRemovedObservable=new he,this.onNewTransformNodeAddedObservable=new he,this.onTransformNodeRemovedObservable=new he,this.onNewMeshAddedObservable=new he,this.onMeshRemovedObservable=new he,this.onNewSkeletonAddedObservable=new he,this.onSkeletonRemovedObservable=new he,this.onNewMaterialAddedObservable=new he,this.onNewMultiMaterialAddedObservable=new he,this.onMaterialRemovedObservable=new he,this.onMultiMaterialRemovedObservable=new he,this.onNewTextureAddedObservable=new he,this.onTextureRemovedObservable=new he,this.onBeforeRenderTargetsRenderObservable=new he,this.onAfterRenderTargetsRenderObservable=new he,this.onBeforeStepObservable=new he,this.onAfterStepObservable=new he,this.onActiveCameraChanged=new he,this.onActiveCamerasChanged=new he,this.onBeforeRenderingGroupObservable=new he,this.onAfterRenderingGroupObservable=new he,this.onMeshImportedObservable=new he,this.onAnimationFileImportedObservable=new he,this._registeredForLateAnimationBindings=new In(256),this._pointerPickingConfiguration=new Dy,this.onPrePointerObservable=new he,this.onPointerObservable=new he,this.onPreKeyboardObservable=new he,this.onKeyboardObservable=new he,this._useRightHandedSystem=!1,this._timeAccumulator=0,this._currentStepId=0,this._currentInternalStep=0,this._fogEnabled=!0,this._fogMode=Pt.FOGMODE_NONE,this.fogColor=new De(.2,.2,.3),this.fogDensity=.1,this.fogStart=0,this.fogEnd=1e3,this.needsPreviousWorldMatrices=!1,this._shadowsEnabled=!0,this._lightsEnabled=!0,this._unObserveActiveCameras=null,this._texturesEnabled=!0,this.physicsEnabled=!0,this.particlesEnabled=!0,this.spritesEnabled=!0,this._skeletonsEnabled=!0,this.lensFlaresEnabled=!0,this.collisionsEnabled=!0,this.gravity=new v(0,-9.807,0),this.postProcessesEnabled=!0,this.renderTargetsEnabled=!0,this.dumpNextRenderTargets=!1,this.customRenderTargets=[],this.importedMeshesFiles=[],this.probesEnabled=!0,this._meshesForIntersections=new In(256),this.proceduralTexturesEnabled=!0,this._totalVertices=new _s,this._activeIndices=new _s,this._activeParticles=new _s,this._activeBones=new _s,this._animationTime=0,this.animationTimeScale=1,this._renderId=0,this._frameId=0,this._executeWhenReadyTimeoutId=null,this._intermediateRendering=!1,this._defaultFrameBufferCleared=!1,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1,this._toBeDisposed=new Array(256),this._activeRequests=new Array,this._pendingData=new Array,this._isDisposed=!1,this.dispatchAllSubMeshesOfActiveMeshes=!1,this._activeMeshes=new Vi(256),this._processedMaterials=new Vi(256),this._renderTargets=new In(256),this._materialsRenderTargets=new In(256),this._activeParticleSystems=new Vi(256),this._activeSkeletons=new In(32),this._softwareSkinnedMeshes=new In(32),this._activeAnimatables=new Array,this._transformMatrix=U.Zero(),this.requireLightSorting=!1,this._components=[],this._serializableComponents=[],this._transientComponents=[],this._beforeCameraUpdateStage=ti.Create(),this._beforeClearStage=ti.Create(),this._beforeRenderTargetClearStage=ti.Create(),this._gatherRenderTargetsStage=ti.Create(),this._gatherActiveCameraRenderTargetsStage=ti.Create(),this._isReadyForMeshStage=ti.Create(),this._beforeEvaluateActiveMeshStage=ti.Create(),this._evaluateSubMeshStage=ti.Create(),this._preActiveMeshStage=ti.Create(),this._cameraDrawRenderTargetStage=ti.Create(),this._beforeCameraDrawStage=ti.Create(),this._beforeRenderTargetDrawStage=ti.Create(),this._beforeRenderingGroupDrawStage=ti.Create(),this._beforeRenderingMeshStage=ti.Create(),this._afterRenderingMeshStage=ti.Create(),this._afterRenderingGroupDrawStage=ti.Create(),this._afterCameraDrawStage=ti.Create(),this._afterCameraPostProcessStage=ti.Create(),this._afterRenderTargetDrawStage=ti.Create(),this._afterRenderTargetPostProcessStage=ti.Create(),this._afterRenderStage=ti.Create(),this._pointerMoveStage=ti.Create(),this._pointerDownStage=ti.Create(),this._pointerUpStage=ti.Create(),this._geometriesByUniqueId=null,this._defaultMeshCandidates={data:[],length:0},this._defaultSubMeshCandidates={data:[],length:0},this._preventFreeActiveMeshesAndRenderingGroups=!1,this._activeMeshesFrozen=!1,this._activeMeshesFrozenButKeepClipping=!1,this._skipEvaluateActiveMeshesCompletely=!1,this._allowPostProcessClearColor=!0,this.getDeterministicFrameTime=()=>this._engine.getTimeStep(),this._registeredActions=0,this._blockMaterialDirtyMechanism=!1,this._perfCollector=null,this.activeCameras=[];const i={useGeometryUniqueIdsMap:!0,useMaterialMeshMap:!0,useClonedMeshMap:!0,virtual:!1,...t};e=this._engine=e||rt.LastCreatedEngine,i.virtual?e._virtualScenes.push(this):(rt._LastCreatedScene=this,e.scenes.push(this)),this._uid=null,this._renderingManager=new Li(this),Au&&(this.postProcessManager=new Au(this)),Ai()&&this.attachControl(),this._createUbo(),nt&&(this._imageProcessingConfiguration=new nt),this.setDefaultCandidateProviders(),i.useGeometryUniqueIdsMap&&(this._geometriesByUniqueId={}),this.useMaterialMeshMap=i.useMaterialMeshMap,this.useClonedMeshMap=i.useClonedMeshMap,(!t||!t.virtual)&&e.onNewSceneAddedObservable.notifyObservers(this)}getClassName(){return"Scene"}_getDefaultMeshCandidates(){return this._defaultMeshCandidates.data=this.meshes,this._defaultMeshCandidates.length=this.meshes.length,this._defaultMeshCandidates}_getDefaultSubMeshCandidates(e){return this._defaultSubMeshCandidates.data=e.subMeshes,this._defaultSubMeshCandidates.length=e.subMeshes.length,this._defaultSubMeshCandidates}setDefaultCandidateProviders(){this.getActiveMeshCandidates=()=>this._getDefaultMeshCandidates(),this.getActiveSubMeshCandidates=e=>this._getDefaultSubMeshCandidates(e),this.getIntersectingSubMeshCandidates=(e,t)=>this._getDefaultSubMeshCandidates(e),this.getCollidingSubMeshCandidates=(e,t)=>this._getDefaultSubMeshCandidates(e)}get meshUnderPointer(){return this._inputManager.meshUnderPointer}get pointerX(){return this._inputManager.pointerX}set pointerX(e){this._inputManager.pointerX=e}get pointerY(){return this._inputManager.pointerY}set pointerY(e){this._inputManager.pointerY=e}getCachedMaterial(){return this._cachedMaterial}getCachedEffect(){return this._cachedEffect}getCachedVisibility(){return this._cachedVisibility}isCachedMaterialInvalid(e,t,i=1){return this._cachedEffect!==t||this._cachedMaterial!==e||this._cachedVisibility!==i}getEngine(){return this._engine}getTotalVertices(){return this._totalVertices.current}get totalVerticesPerfCounter(){return this._totalVertices}getActiveIndices(){return this._activeIndices.current}get totalActiveIndicesPerfCounter(){return this._activeIndices}getActiveParticles(){return this._activeParticles.current}get activeParticlesPerfCounter(){return this._activeParticles}getActiveBones(){return this._activeBones.current}get activeBonesPerfCounter(){return this._activeBones}getActiveMeshes(){return this._activeMeshes}getAnimationRatio(){return this._animationRatio!==void 0?this._animationRatio:1}getRenderId(){return this._renderId}getFrameId(){return this._frameId}incrementRenderId(){this._renderId++}_createUbo(){this.setSceneUniformBuffer(this.createSceneUniformBuffer())}simulatePointerMove(e,t){return this._inputManager.simulatePointerMove(e,t),this}simulatePointerDown(e,t){return this._inputManager.simulatePointerDown(e,t),this}simulatePointerUp(e,t,i){return this._inputManager.simulatePointerUp(e,t,i),this}isPointerCaptured(e=0){return this._inputManager.isPointerCaptured(e)}attachControl(e=!0,t=!0,i=!0){this._inputManager.attachControl(e,t,i)}detachControl(){this._inputManager.detachControl()}isReady(e=!0){var t,i;if(this._isDisposed)return!1;let r;const s=this.getEngine(),o=s.currentRenderPassId;s.currentRenderPassId=((t=this.activeCamera)==null?void 0:t.renderPassId)??o;let a=!0;for(this._pendingData.length>0&&(a=!1),(i=this.prePassRenderer)==null||i.update(),this.useOrderIndependentTransparency&&this.depthPeelingRenderer&&a&&(a=this.depthPeelingRenderer.isReady()),e&&(this._processedMaterials.reset(),this._materialsRenderTargets.reset()),r=0;r<this.meshes.length;r++){const l=this.meshes[r];if(!l.subMeshes||l.subMeshes.length===0)continue;if(!l.isReady(!0)){a=!1;continue}const h=l.hasThinInstances||l.getClassName()==="InstancedMesh"||l.getClassName()==="InstancedLinesMesh"||s.getCaps().instancedArrays&&l.instances.length>0;for(const u of this._isReadyForMeshStage)u.action(l,h)||(a=!1);if(!e)continue;const c=l.material||this.defaultMaterial;if(c)if(c._storeEffectOnSubMeshes)for(const u of l.subMeshes){const d=u.getMaterial();d&&d.hasRenderTargetTextures&&d.getRenderTargetTextures!=null&&this._processedMaterials.indexOf(d)===-1&&(this._processedMaterials.push(d),this._materialsRenderTargets.concatWithNoDuplicate(d.getRenderTargetTextures()))}else c.hasRenderTargetTextures&&c.getRenderTargetTextures!=null&&this._processedMaterials.indexOf(c)===-1&&(this._processedMaterials.push(c),this._materialsRenderTargets.concatWithNoDuplicate(c.getRenderTargetTextures()))}if(e)for(r=0;r<this._materialsRenderTargets.length;++r)this._materialsRenderTargets.data[r].isReadyForRendering()||(a=!1);for(r=0;r<this.geometries.length;r++)this.geometries[r].delayLoadState===2&&(a=!1);if(this.activeCameras&&this.activeCameras.length>0)for(const l of this.activeCameras)l.isReady(!0)||(a=!1);else this.activeCamera&&(this.activeCamera.isReady(!0)||(a=!1));for(const l of this.particleSystems)l.isReady()||(a=!1);if(this.layers)for(const l of this.layers)l.isReady()||(a=!1);return s.areAllEffectsReady()||(a=!1),s.currentRenderPassId=o,a}resetCachedMaterial(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null}registerBeforeRender(e){this.onBeforeRenderObservable.add(e)}unregisterBeforeRender(e){this.onBeforeRenderObservable.removeCallback(e)}registerAfterRender(e){this.onAfterRenderObservable.add(e)}unregisterAfterRender(e){this.onAfterRenderObservable.removeCallback(e)}_executeOnceBeforeRender(e){const t=()=>{e(),setTimeout(()=>{this.unregisterBeforeRender(t)})};this.registerBeforeRender(t)}executeOnceBeforeRender(e,t){t!==void 0?setTimeout(()=>{this._executeOnceBeforeRender(e)},t):this._executeOnceBeforeRender(e)}addPendingData(e){this._pendingData.push(e)}removePendingData(e){const t=this.isLoading,i=this._pendingData.indexOf(e);i!==-1&&this._pendingData.splice(i,1),t&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)}getWaitingItemsCount(){return this._pendingData.length}get isLoading(){return this._pendingData.length>0}executeWhenReady(e,t=!1){this.onReadyObservable.addOnce(e),this._executeWhenReadyTimeoutId===null&&this._checkIsReady(t)}whenReadyAsync(e=!1){return new Promise(t=>{this.executeWhenReady(()=>{t()},e)})}_checkIsReady(e=!1){if(this._registerTransientComponents(),this.isReady(e)){this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),this._executeWhenReadyTimeoutId=null;return}if(this._isDisposed){this.onReadyObservable.clear(),this._executeWhenReadyTimeoutId=null;return}this._executeWhenReadyTimeoutId=setTimeout(()=>{this.incrementRenderId(),this._checkIsReady(e)},100)}get animatables(){return this._activeAnimatables}resetLastAnimationTimeFrame(){this._animationTimeLast=hr.Now}getViewMatrix(){return this._viewMatrix}getProjectionMatrix(){return this._projectionMatrix}getTransformMatrix(){return this._transformMatrix}setTransformMatrix(e,t,i,r){!i&&!r&&this._multiviewSceneUbo&&(this._multiviewSceneUbo.dispose(),this._multiviewSceneUbo=null),!(this._viewUpdateFlag===e.updateFlag&&this._projectionUpdateFlag===t.updateFlag)&&(this._viewUpdateFlag=e.updateFlag,this._projectionUpdateFlag=t.updateFlag,this._viewMatrix=e,this._projectionMatrix=t,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?Nr.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=Nr.GetPlanes(this._transformMatrix),this._multiviewSceneUbo&&this._multiviewSceneUbo.useUbo?this._updateMultiviewUbo(i,r):this._sceneUbo.useUbo&&(this._sceneUbo.updateMatrix("viewProjection",this._transformMatrix),this._sceneUbo.updateMatrix("view",this._viewMatrix),this._sceneUbo.updateMatrix("projection",this._projectionMatrix)))}getSceneUniformBuffer(){return this._multiviewSceneUbo?this._multiviewSceneUbo:this._sceneUbo}createSceneUniformBuffer(e){const t=new Ie(this._engine,void 0,!1,e??"scene");return t.addUniform("viewProjection",16),t.addUniform("view",16),t.addUniform("projection",16),t.addUniform("vEyePosition",4),t}setSceneUniformBuffer(e){this._sceneUbo=e,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1}getUniqueId(){return gd.UniqueId}addMesh(e,t=!1){this._blockEntityCollection||(this.meshes.push(e),e._resyncLightSources(),e.parent||e._addToSceneRootNodes(),this.onNewMeshAddedObservable.notifyObservers(e),t&&e.getChildMeshes().forEach(i=>{this.addMesh(i)}))}removeMesh(e,t=!1){const i=this.meshes.indexOf(e);return i!==-1&&(this.meshes[i]=this.meshes[this.meshes.length-1],this.meshes.pop(),e.parent||e._removeFromSceneRootNodes()),this._inputManager._invalidateMesh(e),this.onMeshRemovedObservable.notifyObservers(e),t&&e.getChildMeshes().forEach(r=>{this.removeMesh(r)}),i}addTransformNode(e){this._blockEntityCollection||e.getScene()===this&&e._indexInSceneTransformNodesArray!==-1||(e._indexInSceneTransformNodesArray=this.transformNodes.length,this.transformNodes.push(e),e.parent||e._addToSceneRootNodes(),this.onNewTransformNodeAddedObservable.notifyObservers(e))}removeTransformNode(e){const t=e._indexInSceneTransformNodesArray;if(t!==-1){if(t!==this.transformNodes.length-1){const i=this.transformNodes[this.transformNodes.length-1];this.transformNodes[t]=i,i._indexInSceneTransformNodesArray=t}e._indexInSceneTransformNodesArray=-1,this.transformNodes.pop(),e.parent||e._removeFromSceneRootNodes()}return this.onTransformNodeRemovedObservable.notifyObservers(e),t}removeSkeleton(e){const t=this.skeletons.indexOf(e);return t!==-1&&(this.skeletons.splice(t,1),this.onSkeletonRemovedObservable.notifyObservers(e),this._executeActiveContainerCleanup(this._activeSkeletons)),t}removeMorphTargetManager(e){const t=this.morphTargetManagers.indexOf(e);return t!==-1&&this.morphTargetManagers.splice(t,1),t}removeLight(e){const t=this.lights.indexOf(e);if(t!==-1){for(const i of this.meshes)i._removeLightSource(e,!1);this.lights.splice(t,1),this.sortLightsByPriority(),e.parent||e._removeFromSceneRootNodes()}return this.onLightRemovedObservable.notifyObservers(e),t}removeCamera(e){const t=this.cameras.indexOf(e);if(t!==-1&&(this.cameras.splice(t,1),e.parent||e._removeFromSceneRootNodes()),this.activeCameras){const i=this.activeCameras.indexOf(e);i!==-1&&this.activeCameras.splice(i,1)}return this.activeCamera===e&&(this.cameras.length>0?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(e),t}removeParticleSystem(e){const t=this.particleSystems.indexOf(e);return t!==-1&&(this.particleSystems.splice(t,1),this._executeActiveContainerCleanup(this._activeParticleSystems)),t}removeAnimation(e){const t=this.animations.indexOf(e);return t!==-1&&this.animations.splice(t,1),t}stopAnimation(e,t,i){}removeAnimationGroup(e){const t=this.animationGroups.indexOf(e);return t!==-1&&this.animationGroups.splice(t,1),t}removeMultiMaterial(e){const t=this.multiMaterials.indexOf(e);return t!==-1&&this.multiMaterials.splice(t,1),this.onMultiMaterialRemovedObservable.notifyObservers(e),t}removeMaterial(e){const t=e._indexInSceneMaterialArray;if(t!==-1&&t<this.materials.length){if(t!==this.materials.length-1){const i=this.materials[this.materials.length-1];this.materials[t]=i,i._indexInSceneMaterialArray=t}e._indexInSceneMaterialArray=-1,this.materials.pop()}return this.onMaterialRemovedObservable.notifyObservers(e),t}removeActionManager(e){const t=this.actionManagers.indexOf(e);return t!==-1&&this.actionManagers.splice(t,1),t}removeTexture(e){const t=this.textures.indexOf(e);return t!==-1&&this.textures.splice(t,1),this.onTextureRemovedObservable.notifyObservers(e),t}addLight(e){if(!this._blockEntityCollection){this.lights.push(e),this.sortLightsByPriority(),e.parent||e._addToSceneRootNodes();for(const t of this.meshes)t.lightSources.indexOf(e)===-1&&(t.lightSources.push(e),t._resyncLightSources());this.onNewLightAddedObservable.notifyObservers(e)}}sortLightsByPriority(){this.requireLightSorting&&this.lights.sort(mt.CompareLightsPriority)}addCamera(e){this._blockEntityCollection||(this.cameras.push(e),this.onNewCameraAddedObservable.notifyObservers(e),e.parent||e._addToSceneRootNodes())}addSkeleton(e){this._blockEntityCollection||(this.skeletons.push(e),this.onNewSkeletonAddedObservable.notifyObservers(e))}addParticleSystem(e){this._blockEntityCollection||this.particleSystems.push(e)}addAnimation(e){this._blockEntityCollection||this.animations.push(e)}addAnimationGroup(e){this._blockEntityCollection||this.animationGroups.push(e)}addMultiMaterial(e){this._blockEntityCollection||(this.multiMaterials.push(e),this.onNewMultiMaterialAddedObservable.notifyObservers(e))}addMaterial(e){this._blockEntityCollection||e.getScene()===this&&e._indexInSceneMaterialArray!==-1||(e._indexInSceneMaterialArray=this.materials.length,this.materials.push(e),this.onNewMaterialAddedObservable.notifyObservers(e))}addMorphTargetManager(e){this._blockEntityCollection||this.morphTargetManagers.push(e)}addGeometry(e){this._blockEntityCollection||(this._geometriesByUniqueId&&(this._geometriesByUniqueId[e.uniqueId]=this.geometries.length),this.geometries.push(e))}addActionManager(e){this.actionManagers.push(e)}addTexture(e){this._blockEntityCollection||(this.textures.push(e),this.onNewTextureAddedObservable.notifyObservers(e))}switchActiveCamera(e,t=!0){this._engine.getInputElement()&&(this.activeCamera&&this.activeCamera.detachControl(),this.activeCamera=e,t&&e.attachControl())}setActiveCameraById(e){const t=this.getCameraById(e);return t?(this.activeCamera=t,t):null}setActiveCameraByName(e){const t=this.getCameraByName(e);return t?(this.activeCamera=t,t):null}getAnimationGroupByName(e){for(let t=0;t<this.animationGroups.length;t++)if(this.animationGroups[t].name===e)return this.animationGroups[t];return null}_getMaterial(e,t){for(let i=0;i<this.materials.length;i++){const r=this.materials[i];if(t(r))return r}if(e)for(let i=0;i<this.multiMaterials.length;i++){const r=this.multiMaterials[i];if(t(r))return r}return null}getMaterialByUniqueID(e,t=!1){return this._getMaterial(t,i=>i.uniqueId===e)}getMaterialById(e,t=!1){return this._getMaterial(t,i=>i.id===e)}getMaterialByName(e,t=!1){return this._getMaterial(t,i=>i.name===e)}getLastMaterialById(e,t=!1){for(let i=this.materials.length-1;i>=0;i--)if(this.materials[i].id===e)return this.materials[i];if(t){for(let i=this.multiMaterials.length-1;i>=0;i--)if(this.multiMaterials[i].id===e)return this.multiMaterials[i]}return null}getTextureByUniqueId(e){for(let t=0;t<this.textures.length;t++)if(this.textures[t].uniqueId===e)return this.textures[t];return null}getTextureByName(e){for(let t=0;t<this.textures.length;t++)if(this.textures[t].name===e)return this.textures[t];return null}getCameraById(e){for(let t=0;t<this.cameras.length;t++)if(this.cameras[t].id===e)return this.cameras[t];return null}getCameraByUniqueId(e){for(let t=0;t<this.cameras.length;t++)if(this.cameras[t].uniqueId===e)return this.cameras[t];return null}getCameraByName(e){for(let t=0;t<this.cameras.length;t++)if(this.cameras[t].name===e)return this.cameras[t];return null}getBoneById(e){for(let t=0;t<this.skeletons.length;t++){const i=this.skeletons[t];for(let r=0;r<i.bones.length;r++)if(i.bones[r].id===e)return i.bones[r]}return null}getBoneByName(e){for(let t=0;t<this.skeletons.length;t++){const i=this.skeletons[t];for(let r=0;r<i.bones.length;r++)if(i.bones[r].name===e)return i.bones[r]}return null}getLightByName(e){for(let t=0;t<this.lights.length;t++)if(this.lights[t].name===e)return this.lights[t];return null}getLightById(e){for(let t=0;t<this.lights.length;t++)if(this.lights[t].id===e)return this.lights[t];return null}getLightByUniqueId(e){for(let t=0;t<this.lights.length;t++)if(this.lights[t].uniqueId===e)return this.lights[t];return null}getParticleSystemById(e){for(let t=0;t<this.particleSystems.length;t++)if(this.particleSystems[t].id===e)return this.particleSystems[t];return null}getGeometryById(e){for(let t=0;t<this.geometries.length;t++)if(this.geometries[t].id===e)return this.geometries[t];return null}_getGeometryByUniqueId(e){if(this._geometriesByUniqueId){const t=this._geometriesByUniqueId[e];if(t!==void 0)return this.geometries[t]}else for(let t=0;t<this.geometries.length;t++)if(this.geometries[t].uniqueId===e)return this.geometries[t];return null}pushGeometry(e,t){return!t&&this._getGeometryByUniqueId(e.uniqueId)?!1:(this.addGeometry(e),this.onNewGeometryAddedObservable.notifyObservers(e),!0)}removeGeometry(e){let t;if(this._geometriesByUniqueId){if(t=this._geometriesByUniqueId[e.uniqueId],t===void 0)return!1}else if(t=this.geometries.indexOf(e),t<0)return!1;if(t!==this.geometries.length-1){const i=this.geometries[this.geometries.length-1];i&&(this.geometries[t]=i,this._geometriesByUniqueId&&(this._geometriesByUniqueId[i.uniqueId]=t))}return this._geometriesByUniqueId&&(this._geometriesByUniqueId[e.uniqueId]=void 0),this.geometries.pop(),this.onGeometryRemovedObservable.notifyObservers(e),!0}getGeometries(){return this.geometries}getMeshById(e){for(let t=0;t<this.meshes.length;t++)if(this.meshes[t].id===e)return this.meshes[t];return null}getMeshesById(e){return this.meshes.filter(function(t){return t.id===e})}getTransformNodeById(e){for(let t=0;t<this.transformNodes.length;t++)if(this.transformNodes[t].id===e)return this.transformNodes[t];return null}getTransformNodeByUniqueId(e){for(let t=0;t<this.transformNodes.length;t++)if(this.transformNodes[t].uniqueId===e)return this.transformNodes[t];return null}getTransformNodesById(e){return this.transformNodes.filter(function(t){return t.id===e})}getMeshByUniqueId(e){for(let t=0;t<this.meshes.length;t++)if(this.meshes[t].uniqueId===e)return this.meshes[t];return null}getLastMeshById(e){for(let t=this.meshes.length-1;t>=0;t--)if(this.meshes[t].id===e)return this.meshes[t];return null}getLastTransformNodeById(e){for(let t=this.transformNodes.length-1;t>=0;t--)if(this.transformNodes[t].id===e)return this.transformNodes[t];return null}getLastEntryById(e){let t;for(t=this.meshes.length-1;t>=0;t--)if(this.meshes[t].id===e)return this.meshes[t];for(t=this.transformNodes.length-1;t>=0;t--)if(this.transformNodes[t].id===e)return this.transformNodes[t];for(t=this.cameras.length-1;t>=0;t--)if(this.cameras[t].id===e)return this.cameras[t];for(t=this.lights.length-1;t>=0;t--)if(this.lights[t].id===e)return this.lights[t];return null}getNodeById(e){const t=this.getMeshById(e);if(t)return t;const i=this.getTransformNodeById(e);if(i)return i;const r=this.getLightById(e);if(r)return r;const s=this.getCameraById(e);return s||this.getBoneById(e)||null}getNodeByName(e){const t=this.getMeshByName(e);if(t)return t;const i=this.getTransformNodeByName(e);if(i)return i;const r=this.getLightByName(e);if(r)return r;const s=this.getCameraByName(e);return s||this.getBoneByName(e)||null}getMeshByName(e){for(let t=0;t<this.meshes.length;t++)if(this.meshes[t].name===e)return this.meshes[t];return null}getTransformNodeByName(e){for(let t=0;t<this.transformNodes.length;t++)if(this.transformNodes[t].name===e)return this.transformNodes[t];return null}getLastSkeletonById(e){for(let t=this.skeletons.length-1;t>=0;t--)if(this.skeletons[t].id===e)return this.skeletons[t];return null}getSkeletonByUniqueId(e){for(let t=0;t<this.skeletons.length;t++)if(this.skeletons[t].uniqueId===e)return this.skeletons[t];return null}getSkeletonById(e){for(let t=0;t<this.skeletons.length;t++)if(this.skeletons[t].id===e)return this.skeletons[t];return null}getSkeletonByName(e){for(let t=0;t<this.skeletons.length;t++)if(this.skeletons[t].name===e)return this.skeletons[t];return null}getMorphTargetManagerById(e){for(let t=0;t<this.morphTargetManagers.length;t++)if(this.morphTargetManagers[t].uniqueId===e)return this.morphTargetManagers[t];return null}getMorphTargetById(e){for(let t=0;t<this.morphTargetManagers.length;++t){const i=this.morphTargetManagers[t];for(let r=0;r<i.numTargets;++r){const s=i.getTarget(r);if(s.id===e)return s}}return null}getMorphTargetByName(e){for(let t=0;t<this.morphTargetManagers.length;++t){const i=this.morphTargetManagers[t];for(let r=0;r<i.numTargets;++r){const s=i.getTarget(r);if(s.name===e)return s}}return null}getPostProcessByName(e){for(let t=0;t<this.postProcesses.length;++t){const i=this.postProcesses[t];if(i.name===e)return i}return null}isActiveMesh(e){return this._activeMeshes.indexOf(e)!==-1}get uid(){return this._uid||(this._uid=ge.RandomId()),this._uid}addExternalData(e,t){return this._externalData||(this._externalData=new cg),this._externalData.add(e,t)}getExternalData(e){return this._externalData?this._externalData.get(e):null}getOrAddExternalDataWithFactory(e,t){return this._externalData||(this._externalData=new cg),this._externalData.getOrAddWithFactory(e,t)}removeExternalData(e){return this._externalData.remove(e)}_evaluateSubMesh(e,t,i,r){if(r||e.isInFrustum(this._frustumPlanes)){for(const o of this._evaluateSubMeshStage)o.action(t,e);const s=e.getMaterial();s!=null&&(s.hasRenderTargetTextures&&s.getRenderTargetTextures!=null&&this._processedMaterials.indexOf(s)===-1&&(this._processedMaterials.push(s),this._materialsRenderTargets.concatWithNoDuplicate(s.getRenderTargetTextures())),this._renderingManager.dispatch(e,t,s))}}freeProcessedMaterials(){this._processedMaterials.dispose()}get blockfreeActiveMeshesAndRenderingGroups(){return this._preventFreeActiveMeshesAndRenderingGroups}set blockfreeActiveMeshesAndRenderingGroups(e){this._preventFreeActiveMeshesAndRenderingGroups!==e&&(e&&(this.freeActiveMeshes(),this.freeRenderingGroups()),this._preventFreeActiveMeshesAndRenderingGroups=e)}freeActiveMeshes(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._activeMeshes.dispose(),this.activeCamera&&this.activeCamera._activeMeshes&&this.activeCamera._activeMeshes.dispose(),this.activeCameras))for(let e=0;e<this.activeCameras.length;e++){const t=this.activeCameras[e];t&&t._activeMeshes&&t._activeMeshes.dispose()}}freeRenderingGroups(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._renderingManager&&this._renderingManager.freeRenderingGroups(),this.textures))for(let e=0;e<this.textures.length;e++){const t=this.textures[e];t&&t.renderList&&t.freeRenderingGroups()}}_isInIntermediateRendering(){return this._intermediateRendering}freezeActiveMeshes(e=!1,t,i,r=!0,s=!1){return this.executeWhenReady(()=>{if(!this.activeCamera){i&&i("No active camera found");return}if(this._frustumPlanes||this.updateTransformMatrix(),this._evaluateActiveMeshes(),this._activeMeshesFrozen=!0,this._activeMeshesFrozenButKeepClipping=s,this._skipEvaluateActiveMeshesCompletely=e,r)for(let o=0;o<this._activeMeshes.length;o++)this._activeMeshes.data[o]._freeze();t&&t()}),this}unfreezeActiveMeshes(){for(let e=0;e<this.meshes.length;e++){const t=this.meshes[e];t._internalAbstractMeshDataInfo&&(t._internalAbstractMeshDataInfo._isActive=!1)}for(let e=0;e<this._activeMeshes.length;e++)this._activeMeshes.data[e]._unFreeze();return this._activeMeshesFrozen=!1,this}_executeActiveContainerCleanup(e){!(this._engine.snapshotRendering&&this._engine.snapshotRenderingMode===1)&&this._activeMeshesFrozen&&this._activeMeshes.length||this.onBeforeRenderObservable.addOnce(()=>e.dispose())}_evaluateActiveMeshes(){var e;if(this._engine.snapshotRendering&&this._engine.snapshotRenderingMode===1){this._activeMeshes.length>0&&((e=this.activeCamera)==null||e._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset());return}if(this._activeMeshesFrozen&&this._activeMeshes.length){if(!this._skipEvaluateActiveMeshesCompletely){const r=this._activeMeshes.length;for(let s=0;s<r;s++)this._activeMeshes.data[s].computeWorldMatrix()}if(this._activeParticleSystems){const r=this._activeParticleSystems.length;for(let s=0;s<r;s++)this._activeParticleSystems.data[s].animate()}this._renderingManager.resetSprites();return}if(!this.activeCamera)return;this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset(),this._materialsRenderTargets.reset();for(const r of this._beforeEvaluateActiveMeshStage)r.action();const t=this.getActiveMeshCandidates(),i=t.length;for(let r=0;r<i;r++){const s=t.data[r];if(s._internalAbstractMeshDataInfo._currentLODIsUpToDate=!1,s.isBlocked||(this._totalVertices.addCount(s.getTotalVertices(),!1),!s.isReady()||!s.isEnabled()||s.scaling.hasAZeroComponent))continue;s.computeWorldMatrix(),s.actionManager&&s.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(s);let o=this.customLODSelector?this.customLODSelector(s,this.activeCamera):s.getLOD(this.activeCamera);if(s._internalAbstractMeshDataInfo._currentLOD=o,s._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0,o!=null&&(o!==s&&o.billboardMode!==0&&o.computeWorldMatrix(),s._preActivate(),s.isVisible&&s.visibility>0&&s.layerMask&this.activeCamera.layerMask&&(this._skipFrustumClipping||s.alwaysSelectAsActiveMesh||s.isInFrustum(this._frustumPlanes)))){this._activeMeshes.push(s),this.activeCamera._activeMeshes.push(s),o!==s&&o._activate(this._renderId,!1);for(const a of this._preActiveMeshStage)a.action(s);s._activate(this._renderId,!1)&&(s.isAnInstance?s._internalAbstractMeshDataInfo._actAsRegularMesh&&(o=s):o._internalAbstractMeshDataInfo._onlyForInstances=!1,o._internalAbstractMeshDataInfo._isActive=!0,this._activeMesh(s,o)),s._postActivate()}}if(this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(let r=0;r<this.particleSystems.length;r++){const s=this.particleSystems[r];if(!s.isStarted()||!s.emitter)continue;const o=s.emitter;(!o.position||o.isEnabled())&&(this._activeParticleSystems.push(s),s.animate(),this._renderingManager.dispatchParticles(s))}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}_activeMesh(e,t){this._skeletonsEnabled&&t.skeleton!==null&&t.skeleton!==void 0&&(this._activeSkeletons.pushNoDuplicate(t.skeleton)&&(t.skeleton.prepare(),this._activeBones.addCount(t.skeleton.bones.length,!1)),t.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(t));let i=e.hasInstances||e.isAnInstance||this.dispatchAllSubMeshesOfActiveMeshes||this._skipFrustumClipping||t.alwaysSelectAsActiveMesh;if(t&&t.subMeshes&&t.subMeshes.length>0){const r=this.getActiveSubMeshCandidates(t),s=r.length;i=i||s===1;for(let o=0;o<s;o++){const a=r.data[o];this._evaluateSubMesh(a,t,e,i)}}}updateTransformMatrix(e){const t=this.activeCamera;if(t)if(t._renderingMultiview){const i=t._rigCameras[0],r=t._rigCameras[1];this.setTransformMatrix(i.getViewMatrix(),i.getProjectionMatrix(e),r.getViewMatrix(),r.getProjectionMatrix(e))}else this.setTransformMatrix(t.getViewMatrix(),t.getProjectionMatrix(e))}_bindFrameBuffer(e,t=!0){e&&e._multiviewTexture?e._multiviewTexture._bindFrameBuffer():e&&e.outputRenderTarget?e.outputRenderTarget._bindFrameBuffer():this._engine._currentFrameBufferIsDefaultFrameBuffer()||this._engine.restoreDefaultFramebuffer(),t&&this._clearFrameBuffer(e)}_clearFrameBuffer(e){if(!(e&&e._multiviewTexture))if(e&&e.outputRenderTarget&&!e._renderingMultiview){const t=e.outputRenderTarget;t.onClearObservable.hasObservers()?t.onClearObservable.notifyObservers(this._engine):!t.skipInitialClear&&!e.isRightCamera&&(this.autoClear&&this._engine.clear(t.clearColor||this.clearColor,!t._cleared,!0,!0),t._cleared=!0)}else this._defaultFrameBufferCleared?this._engine.clear(null,!1,!0,!0):(this._defaultFrameBufferCleared=!0,this._clear())}_renderForCamera(e,t,i=!0){var r;if(e&&e._skipRendering)return;const s=this._engine;if(this._activeCamera=e,!this.activeCamera)throw new Error("Active camera not set");if(s.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,!this.prePass&&i){let a=!0;e._renderingMultiview&&e.outputRenderTarget&&(a=e.outputRenderTarget.skipInitialClear,this.autoClear&&(this._defaultFrameBufferCleared=!1,e.outputRenderTarget.skipInitialClear=!1)),this._bindFrameBuffer(this._activeCamera),e._renderingMultiview&&e.outputRenderTarget&&(e.outputRenderTarget.skipInitialClear=a)}this.updateTransformMatrix(),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(let a=0;a<this._softwareSkinnedMeshes.length;a++){const l=this._softwareSkinnedMeshes.data[a];l.applySkeleton(l.skeleton)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),this._renderTargets.concatWithNoDuplicate(this._materialsRenderTargets),e.customRenderTargets&&e.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(e.customRenderTargets),t&&t.customRenderTargets&&t.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(t.customRenderTargets),this.environmentTexture&&this.environmentTexture.isRenderTarget&&this._renderTargets.pushNoDuplicate(this.environmentTexture);for(const a of this._gatherActiveCameraRenderTargetsStage)a.action(this._renderTargets);let o=!1;if(this.renderTargetsEnabled){if(this._intermediateRendering=!0,this._renderTargets.length>0){ge.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(let a=0;a<this._renderTargets.length;a++){const l=this._renderTargets.data[a];if(l._shouldRender()){this._renderId++;const h=l.activeCamera&&l.activeCamera!==this.activeCamera;l.render(h,this.dumpNextRenderTargets),o=!0}}ge.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._renderId++}for(const a of this._cameraDrawRenderTargetStage)o=a.action(this.activeCamera)||o;this._intermediateRendering=!1}this._engine.currentRenderPassId=((r=e.outputRenderTarget)==null?void 0:r.renderPassId)??e.renderPassId??0,o&&!this.prePass&&(this._bindFrameBuffer(this._activeCamera,!1),this.updateTransformMatrix()),this.onAfterRenderTargetsRenderObservable.notifyObservers(this),this.postProcessManager&&!e._multiviewTexture&&!this.prePass&&this.postProcessManager._prepareFrame();for(const a of this._beforeCameraDrawStage)a.action(this.activeCamera);this.onBeforeDrawPhaseObservable.notifyObservers(this),s.snapshotRendering&&s.snapshotRenderingMode===1&&this.finalizeSceneUbo(),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this);for(const a of this._afterCameraDrawStage)a.action(this.activeCamera);if(this.postProcessManager&&!e._multiviewTexture){const a=e.outputRenderTarget?e.outputRenderTarget.renderTarget:void 0;this.postProcessManager._finalizeFrame(e.isIntermediate,a)}for(const a of this._afterCameraPostProcessStage)a.action(this.activeCamera);this._renderTargets.reset(),this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)}_processSubCameras(e,t=!0){if(e.cameraRigMode===0||e._renderingMultiview){e._renderingMultiview&&!this._multiviewSceneUbo&&this._createMultiviewUbo(),this._renderForCamera(e,void 0,t),this.onAfterRenderCameraObservable.notifyObservers(e);return}if(e._useMultiviewToSingleView)this._renderMultiviewToSingleView(e);else{this.onBeforeCameraRenderObservable.notifyObservers(e);for(let i=0;i<e._rigCameras.length;i++)this._renderForCamera(e._rigCameras[i],e)}this._activeCamera=e,this.updateTransformMatrix(),this.onAfterRenderCameraObservable.notifyObservers(e)}_checkIntersections(){for(let e=0;e<this._meshesForIntersections.length;e++){const t=this._meshesForIntersections.data[e];if(t.actionManager)for(let i=0;t.actionManager&&i<t.actionManager.actions.length;i++){const r=t.actionManager.actions[i];if(r.trigger===12||r.trigger===13){const s=r.getTriggerParameter(),o=s.mesh?s.mesh:s,a=o.intersectsMesh(t,s.usePreciseIntersection),l=t._intersectionsInProgress.indexOf(o);a&&l===-1?r.trigger===12?(r._executeCurrent(Si.CreateNew(t,void 0,o)),t._intersectionsInProgress.push(o)):r.trigger===13&&t._intersectionsInProgress.push(o):!a&&l>-1&&(r.trigger===13&&r._executeCurrent(Si.CreateNew(t,void 0,o)),(!t.actionManager.hasSpecificTrigger(13,h=>{const c=h.mesh?h.mesh:h;return o===c})||r.trigger===13)&&t._intersectionsInProgress.splice(l,1))}}}}_advancePhysicsEngineStep(e){}_animate(e){}animate(){if(this._engine.isDeterministicLockStep()){let e=Math.max(Pt.MinDeltaTime,Math.min(this._engine.getDeltaTime(),Pt.MaxDeltaTime))+this._timeAccumulator;const t=this._engine.getTimeStep(),i=1e3/t/1e3;let r=0;const s=this._engine.getLockstepMaxSteps();let o=Math.floor(e/t);for(o=Math.min(o,s);e>0&&r<o;)this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=t*i,this._animate(t),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(t),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,r++,e-=t;this._timeAccumulator=e<0?0:e}else{const e=this.useConstantAnimationDeltaTime?16:Math.max(Pt.MinDeltaTime,Math.min(this._engine.getDeltaTime(),Pt.MaxDeltaTime));this._animationRatio=e*(60/1e3),this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(e)}}_clear(){(this.autoClearDepthAndStencil||this.autoClear)&&this._engine.clear(this.clearColor,this.autoClear||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil)}_checkCameraRenderTarget(e){var t;if(e!=null&&e.outputRenderTarget&&!(e!=null&&e.isRigCamera)&&(e.outputRenderTarget._cleared=!1),(t=e==null?void 0:e.rigCameras)!=null&&t.length)for(let i=0;i<e.rigCameras.length;++i){const r=e.rigCameras[i].outputRenderTarget;r&&(r._cleared=!1)}}resetDrawCache(e){if(this.meshes)for(const t of this.meshes)t.resetDrawCache(e)}render(e=!0,t=!1){var i,r;if(this.isDisposed)return;this.onReadyObservable.hasObservers()&&this._executeWhenReadyTimeoutId===null&&this._checkIsReady(),this._frameId++,this._defaultFrameBufferCleared=!1,this._checkCameraRenderTarget(this.activeCamera),(i=this.activeCameras)!=null&&i.length&&this.activeCameras.forEach(this._checkCameraRenderTarget),this._registerTransientComponents(),this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(11),t||this.animate();for(const a of this._beforeCameraUpdateStage)a.action();if(e){if(this.activeCameras&&this.activeCameras.length>0)for(let a=0;a<this.activeCameras.length;a++){const l=this.activeCameras[a];if(l.update(),l.cameraRigMode!==0)for(let h=0;h<l._rigCameras.length;h++)l._rigCameras[h].update()}else if(this.activeCamera&&(this.activeCamera.update(),this.activeCamera.cameraRigMode!==0))for(let a=0;a<this.activeCamera._rigCameras.length;a++)this.activeCamera._rigCameras[a].update()}this.onBeforeRenderObservable.notifyObservers(this);const s=this.getEngine();this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);const o=(r=this.activeCameras)!=null&&r.length?this.activeCameras[0]:this.activeCamera;if(this.renderTargetsEnabled){ge.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!0;for(let a=0;a<this.customRenderTargets.length;a++){const l=this.customRenderTargets[a];if(l._shouldRender()){if(this._renderId++,this.activeCamera=l.activeCamera||this.activeCamera,!this.activeCamera)throw new Error("Active camera not set");s.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),l.render(o!==this.activeCamera,this.dumpNextRenderTargets)}}ge.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!1,this._renderId++}this._engine.currentRenderPassId=(o==null?void 0:o.renderPassId)??0,this.activeCamera=o,this._activeCamera&&this._activeCamera.cameraRigMode!==22&&!this.prePass&&this._bindFrameBuffer(this._activeCamera,!1),this.onAfterRenderTargetsRenderObservable.notifyObservers(this);for(const a of this._beforeClearStage)a.action();this._clearFrameBuffer(this.activeCamera);for(const a of this._gatherRenderTargetsStage)a.action(this._renderTargets);if(this.activeCameras&&this.activeCameras.length>0)for(let a=0;a<this.activeCameras.length;a++)this._processSubCameras(this.activeCameras[a],a>0);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera,!!this.activeCamera.outputRenderTarget)}this._checkIntersections();for(const a of this._afterRenderStage)a.action();if(this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this),this._toBeDisposed.length){for(let a=0;a<this._toBeDisposed.length;a++){const l=this._toBeDisposed[a];l&&l.dispose()}this._toBeDisposed.length=0}this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0),this._engine.restoreDefaultFramebuffer()}freezeMaterials(){for(let e=0;e<this.materials.length;e++)this.materials[e].freeze()}unfreezeMaterials(){for(let e=0;e<this.materials.length;e++)this.materials[e].unfreeze()}dispose(){if(this.isDisposed)return;this.beforeRender=null,this.afterRender=null,this.metadata=null,this.skeletons.length=0,this.morphTargetManagers.length=0,this._transientComponents.length=0,this._isReadyForMeshStage.clear(),this._beforeEvaluateActiveMeshStage.clear(),this._evaluateSubMeshStage.clear(),this._preActiveMeshStage.clear(),this._cameraDrawRenderTargetStage.clear(),this._beforeCameraDrawStage.clear(),this._beforeRenderTargetDrawStage.clear(),this._beforeRenderingGroupDrawStage.clear(),this._beforeRenderingMeshStage.clear(),this._afterRenderingMeshStage.clear(),this._afterRenderingGroupDrawStage.clear(),this._afterCameraDrawStage.clear(),this._afterRenderTargetDrawStage.clear(),this._afterRenderStage.clear(),this._beforeCameraUpdateStage.clear(),this._beforeClearStage.clear(),this._gatherRenderTargetsStage.clear(),this._gatherActiveCameraRenderTargetsStage.clear(),this._pointerMoveStage.clear(),this._pointerDownStage.clear(),this._pointerUpStage.clear(),this.importedMeshesFiles=[],this.stopAllAnimations&&(this._activeAnimatables.forEach(r=>{r.onAnimationEndObservable.clear(),r.onAnimationEnd=null}),this.stopAllAnimations()),this.resetCachedMaterial(),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this.activeCameras=null,this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._materialsRenderTargets.dispose(),this._registeredForLateAnimationBindings.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed.length=0;const e=this._activeRequests.slice();for(const r of e)r.abort();this._activeRequests.length=0;try{this.onDisposeObservable.notifyObservers(this)}catch(r){oe.Error("An error occurred while calling onDisposeObservable!",r)}if(this.detachControl(),this._engine.getInputElement())for(let r=0;r<this.cameras.length;r++)this.cameras[r].detachControl();this._disposeList(this.animationGroups),this._disposeList(this.lights),this._disposeList(this.meshes,r=>r.dispose(!0)),this._disposeList(this.transformNodes,r=>r.dispose(!0));const t=this.cameras;this._disposeList(t),this._defaultMaterial&&this._defaultMaterial.dispose(),this._disposeList(this.multiMaterials),this._disposeList(this.materials),this._disposeList(this.particleSystems),this._disposeList(this.postProcesses),this._disposeList(this.textures),this._disposeList(this.morphTargetManagers),this._sceneUbo.dispose(),this._multiviewSceneUbo&&this._multiviewSceneUbo.dispose(),this.postProcessManager.dispose(),this._disposeList(this._components);let i=this._engine.scenes.indexOf(this);i>-1&&this._engine.scenes.splice(i,1),rt._LastCreatedScene===this&&(this._engine.scenes.length>0?rt._LastCreatedScene=this._engine.scenes[this._engine.scenes.length-1]:rt._LastCreatedScene=null),i=this._engine._virtualScenes.indexOf(this),i>-1&&this._engine._virtualScenes.splice(i,1),this._engine.wipeCaches(!0),this.onDisposeObservable.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderTargetsRenderObservable.clear(),this.onAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.onBeforeRenderingGroupObservable.clear(),this.onAfterRenderingGroupObservable.clear(),this.onMeshImportedObservable.clear(),this.onBeforeCameraRenderObservable.clear(),this.onAfterCameraRenderObservable.clear(),this.onAfterRenderCameraObservable.clear(),this.onReadyObservable.clear(),this.onNewCameraAddedObservable.clear(),this.onCameraRemovedObservable.clear(),this.onNewLightAddedObservable.clear(),this.onLightRemovedObservable.clear(),this.onNewGeometryAddedObservable.clear(),this.onGeometryRemovedObservable.clear(),this.onNewTransformNodeAddedObservable.clear(),this.onTransformNodeRemovedObservable.clear(),this.onNewMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onNewSkeletonAddedObservable.clear(),this.onSkeletonRemovedObservable.clear(),this.onNewMaterialAddedObservable.clear(),this.onNewMultiMaterialAddedObservable.clear(),this.onMaterialRemovedObservable.clear(),this.onMultiMaterialRemovedObservable.clear(),this.onNewTextureAddedObservable.clear(),this.onTextureRemovedObservable.clear(),this.onPrePointerObservable.clear(),this.onPointerObservable.clear(),this.onPreKeyboardObservable.clear(),this.onKeyboardObservable.clear(),this.onActiveCameraChanged.clear(),this.onScenePerformancePriorityChangedObservable.clear(),this._isDisposed=!0}_disposeList(e,t){const i=e.slice(0);t=t??(r=>r.dispose());for(const r of i)t(r);e.length=0}get isDisposed(){return this._isDisposed}clearCachedVertexData(){for(let e=0;e<this.meshes.length;e++){const t=this.meshes[e].geometry;t&&t.clearCachedData()}}cleanCachedTextureBuffer(){for(const e of this.textures)e._buffer&&(e._buffer=null)}getWorldExtends(e){const t=new v(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),i=new v(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return e=e||(()=>!0),this.meshes.filter(e).forEach(r=>{if(r.computeWorldMatrix(!0),!r.subMeshes||r.subMeshes.length===0||r.infiniteDistance)return;const s=r.getBoundingInfo(),o=s.boundingBox.minimumWorld,a=s.boundingBox.maximumWorld;v.CheckExtends(o,t,i),v.CheckExtends(a,t,i)}),{min:t,max:i}}createPickingRay(e,t,i,r,s=!1){throw Ge("Ray")}createPickingRayToRef(e,t,i,r,s,o=!1,a=!1){throw Ge("Ray")}createPickingRayInCameraSpace(e,t,i){throw Ge("Ray")}createPickingRayInCameraSpaceToRef(e,t,i,r){throw Ge("Ray")}get _pickingAvailable(){return!1}pick(e,t,i,r,s,o){const a=Ge("Ray",!0);return a&&oe.Warn(a),new Ts}pickWithBoundingInfo(e,t,i,r,s){const o=Ge("Ray",!0);return o&&oe.Warn(o),new Ts}pickWithRay(e,t,i,r){throw Ge("Ray")}multiPick(e,t,i,r,s){throw Ge("Ray")}multiPickWithRay(e,t,i){throw Ge("Ray")}setPointerOverMesh(e,t,i){this._inputManager.setPointerOverMesh(e,t,i)}getPointerOverMesh(){return this._inputManager.getPointerOverMesh()}_rebuildGeometries(){for(const e of this.geometries)e._rebuild();for(const e of this.meshes)e._rebuild();this.postProcessManager&&this.postProcessManager._rebuild();for(const e of this._components)e.rebuild();for(const e of this.particleSystems)e.rebuild();if(this.spriteManagers)for(const e of this.spriteManagers)e.rebuild()}_rebuildTextures(){for(const e of this.textures)e._rebuild(!0);this.markAllMaterialsAsDirty(1)}_getByTags(e,t,i){if(t===void 0)return e;const r=[];for(const s in e){const o=e[s];it&&it.MatchesQuery(o,t)&&(!i||i(o))&&r.push(o)}return r}getMeshesByTags(e,t){return this._getByTags(this.meshes,e,t)}getCamerasByTags(e,t){return this._getByTags(this.cameras,e,t)}getLightsByTags(e,t){return this._getByTags(this.lights,e,t)}getMaterialByTags(e,t){return this._getByTags(this.materials,e,t).concat(this._getByTags(this.multiMaterials,e,t))}getTransformNodesByTags(e,t){return this._getByTags(this.transformNodes,e,t)}setRenderingOrder(e,t=null,i=null,r=null){this._renderingManager.setRenderingOrder(e,t,i,r)}setRenderingAutoClearDepthStencil(e,t,i=!0,r=!0){this._renderingManager.setRenderingAutoClearDepthStencil(e,t,i,r)}getAutoClearDepthStencilSetup(e){return this._renderingManager.getAutoClearDepthStencilSetup(e)}_forceBlockMaterialDirtyMechanism(e){this._blockMaterialDirtyMechanism=e}get blockMaterialDirtyMechanism(){return this._blockMaterialDirtyMechanism}set blockMaterialDirtyMechanism(e){this._blockMaterialDirtyMechanism!==e&&(this._blockMaterialDirtyMechanism=e,e||this.markAllMaterialsAsDirty(63))}markAllMaterialsAsDirty(e,t){if(!this._blockMaterialDirtyMechanism)for(const i of this.materials)t&&!t(i)||i.markAsDirty(e)}_loadFile(e,t,i,r,s,o,a){const l=fn(e,t,i,r?this.offlineProvider:void 0,s,o,a);return this._activeRequests.push(l),l.onCompleteObservable.add(h=>{this._activeRequests.splice(this._activeRequests.indexOf(h),1)}),l}_loadFileAsync(e,t,i,r,s){return new Promise((o,a)=>{this._loadFile(e,l=>{o(l)},t,i,r,(l,h)=>{a(h)},s)})}_requestFile(e,t,i,r,s,o,a){const l=dd(e,t,i,r?this.offlineProvider:void 0,s,o,a);return this._activeRequests.push(l),l.onCompleteObservable.add(h=>{this._activeRequests.splice(this._activeRequests.indexOf(h),1)}),l}_requestFileAsync(e,t,i,r,s){return new Promise((o,a)=>{this._requestFile(e,l=>{o(l)},t,i,r,l=>{a(l)},s)})}_readFile(e,t,i,r,s){const o=xa(e,t,i,r,s);return this._activeRequests.push(o),o.onCompleteObservable.add(a=>{this._activeRequests.splice(this._activeRequests.indexOf(a),1)}),o}_readFileAsync(e,t,i){return new Promise((r,s)=>{this._readFile(e,o=>{r(o)},t,i,o=>{s(o)})})}getPerfCollector(){throw Ge("performanceViewerSceneExtension")}setActiveCameraByID(e){return this.setActiveCameraById(e)}getMaterialByID(e){return this.getMaterialById(e)}getLastMaterialByID(e){return this.getLastMaterialById(e)}getTextureByUniqueID(e){return this.getTextureByUniqueId(e)}getCameraByID(e){return this.getCameraById(e)}getCameraByUniqueID(e){return this.getCameraByUniqueId(e)}getBoneByID(e){return this.getBoneById(e)}getLightByID(e){return this.getLightById(e)}getLightByUniqueID(e){return this.getLightByUniqueId(e)}getParticleSystemByID(e){return this.getParticleSystemById(e)}getGeometryByID(e){return this.getGeometryById(e)}getMeshByID(e){return this.getMeshById(e)}getMeshByUniqueID(e){return this.getMeshByUniqueId(e)}getLastMeshByID(e){return this.getLastMeshById(e)}getMeshesByID(e){return this.getMeshesById(e)}getTransformNodeByID(e){return this.getTransformNodeById(e)}getTransformNodeByUniqueID(e){return this.getTransformNodeByUniqueId(e)}getTransformNodesByID(e){return this.getTransformNodesById(e)}getNodeByID(e){return this.getNodeById(e)}getLastEntryByID(e){return this.getLastEntryById(e)}getLastSkeletonByID(e){return this.getLastSkeletonById(e)}}Pt.FOGMODE_NONE=0;Pt.FOGMODE_EXP=1;Pt.FOGMODE_EXP2=2;Pt.FOGMODE_LINEAR=3;Pt.MinDeltaTime=1;Pt.MaxDeltaTime=1e3;class Ny{constructor(e=30){this._enabled=!0,this._rollingFrameTime=new Fy(e)}sampleFrame(e=hr.Now){if(this._enabled){if(this._lastFrameTimeMs!=null){const t=e-this._lastFrameTimeMs;this._rollingFrameTime.add(t)}this._lastFrameTimeMs=e}}get averageFrameTime(){return this._rollingFrameTime.average}get averageFrameTimeVariance(){return this._rollingFrameTime.variance}get instantaneousFrameTime(){return this._rollingFrameTime.history(0)}get averageFPS(){return 1e3/this._rollingFrameTime.average}get instantaneousFPS(){const e=this._rollingFrameTime.history(0);return e===0?0:1e3/e}get isSaturated(){return this._rollingFrameTime.isSaturated()}enable(){this._enabled=!0}disable(){this._enabled=!1,this._lastFrameTimeMs=null}get isEnabled(){return this._enabled}reset(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()}}class Fy{constructor(e){this._samples=new Array(e),this.reset()}add(e){let t;if(this.isSaturated()){const i=this._samples[this._pos];t=i-this.average,this.average-=t/(this._sampleCount-1),this._m2-=t*(i-this.average)}else this._sampleCount++;t=e-this.average,this.average+=t/this._sampleCount,this._m2+=t*(e-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[this._pos]=e,this._pos++,this._pos%=this._samples.length}history(e){if(e>=this._sampleCount||e>=this._samples.length)return 0;const t=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(t-e)]}isSaturated(){return this._sampleCount>=this._samples.length}reset(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0}_wrapPosition(e){const t=this._samples.length;return(e%t+t)%t}}Oe.prototype.setAlphaConstants=function(n,e,t,i){this._alphaState.setAlphaBlendConstants(n,e,t,i)};Oe.prototype.setAlphaMode=function(n,e=!1){if(this._alphaMode===n){if(!e){const t=n===0;this.depthCullingState.depthMask!==t&&(this.depthCullingState.depthMask=t)}return}switch(n){case 0:this._alphaState.alphaBlend=!1;break;case 7:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 8:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 2:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 6:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 1:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 3:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 4:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 5:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 9:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case 10:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 11:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 12:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 13:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE_MINUS_DST_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 14:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 15:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 16:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 17:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break}e||(this.depthCullingState.depthMask=n===0),this._alphaMode=n};Oe.prototype.getAlphaMode=function(){return this._alphaMode};Oe.prototype.setAlphaEquation=function(n){if(this._alphaEquation!==n){switch(n){case 0:this._alphaState.setAlphaEquationParameters(32774,32774);break;case 1:this._alphaState.setAlphaEquationParameters(32778,32778);break;case 2:this._alphaState.setAlphaEquationParameters(32779,32779);break;case 3:this._alphaState.setAlphaEquationParameters(32776,32776);break;case 4:this._alphaState.setAlphaEquationParameters(32775,32775);break;case 5:this._alphaState.setAlphaEquationParameters(32775,32774);break}this._alphaEquation=n}};Oe.prototype.getAlphaEquation=function(){return this._alphaEquation};function Ly(n,e,t=!1,i){switch(n){case 3:{const s=e instanceof ArrayBuffer?new Int8Array(e):new Int8Array(e);return i&&s.set(new Int8Array(i)),s}case 0:{const s=e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e);return i&&s.set(new Uint8Array(i)),s}case 4:{const s=e instanceof ArrayBuffer?new Int16Array(e):new Int16Array(t?e/2:e);return i&&s.set(new Int16Array(i)),s}case 5:case 8:case 9:case 10:case 2:{const s=e instanceof ArrayBuffer?new Uint16Array(e):new Uint16Array(t?e/2:e);return i&&s.set(new Uint16Array(i)),s}case 6:{const s=e instanceof ArrayBuffer?new Int32Array(e):new Int32Array(t?e/4:e);return i&&s.set(new Int32Array(i)),s}case 7:case 11:case 12:case 13:case 14:case 15:{const s=e instanceof ArrayBuffer?new Uint32Array(e):new Uint32Array(t?e/4:e);return i&&s.set(new Uint32Array(i)),s}case 1:{const s=e instanceof ArrayBuffer?new Float32Array(e):new Float32Array(t?e/4:e);return i&&s.set(new Float32Array(i)),s}}const r=e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e);return i&&r.set(new Uint8Array(i)),r}Oe.prototype._readTexturePixelsSync=function(n,e,t,i=-1,r=0,s=null,o=!0,a=!1,l=0,h=0){var c,u;const d=this._gl;if(!d)throw new Error("Engine does not have gl rendering context.");if(!this._dummyFramebuffer){const p=d.createFramebuffer();if(!p)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=p}d.bindFramebuffer(d.FRAMEBUFFER,this._dummyFramebuffer),i>-1?d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_CUBE_MAP_POSITIVE_X+i,(c=n._hardwareTexture)==null?void 0:c.underlyingResource,r):d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,(u=n._hardwareTexture)==null?void 0:u.underlyingResource,r);let f=n.type!==void 0?this._getWebGLTextureType(n.type):d.UNSIGNED_BYTE;if(a)s||(s=Ly(n.type,4*e*t));else switch(f){case d.UNSIGNED_BYTE:s||(s=new Uint8Array(4*e*t)),f=d.UNSIGNED_BYTE;break;default:s||(s=new Float32Array(4*e*t)),f=d.FLOAT;break}return o&&this.flushFramebuffer(),d.readPixels(l,h,e,t,d.RGBA,f,s),d.bindFramebuffer(d.FRAMEBUFFER,this._currentFramebuffer),s};Oe.prototype._readTexturePixels=function(n,e,t,i=-1,r=0,s=null,o=!0,a=!1,l=0,h=0){return Promise.resolve(this._readTexturePixelsSync(n,e,t,i,r,s,o,a,l,h))};Oe.prototype.updateDynamicIndexBuffer=function(n,e,t=0){this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(n);let i;n.is32Bits?i=e instanceof Uint32Array?e:new Uint32Array(e):i=e instanceof Uint16Array?e:new Uint16Array(e),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,i,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()};Oe.prototype.updateDynamicVertexBuffer=function(n,e,t,i){this.bindArrayBuffer(n),t===void 0&&(t=0);const r=e.byteLength||e.length;i===void 0||i>=r&&t===0?e instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,t,new Float32Array(e)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,t,e):e instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,new Float32Array(e).subarray(t,t+i)):(e instanceof ArrayBuffer?e=new Uint8Array(e,t,i):e=new Uint8Array(e.buffer,e.byteOffset+t,i),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,e)),this._resetVertexBufferBinding()};class se extends Oe{static get NpmPackage(){return Oe.NpmPackage}static get Version(){return Oe.Version}static get Instances(){return rt.Instances}static get LastCreatedEngine(){return rt.LastCreatedEngine}static get LastCreatedScene(){return rt.LastCreatedScene}_createImageBitmapFromSource(e,t){return new Promise((i,r)=>{const s=new Image;s.onload=()=>{s.decode().then(()=>{this.createImageBitmap(s,t).then(o=>{i(o)})})},s.onerror=()=>{r(`Error loading image ${s.src}`)},s.src=e})}createImageBitmap(e,t){return createImageBitmap(e,t)}resizeImageBitmap(e,t,i){const r=this.createCanvas(t,i).getContext("2d");if(!r)throw new Error("Unable to get 2d context for resizeImageBitmap");return r.drawImage(e,0,0),r.getImageData(0,0,t,i).data}static MarkAllMaterialsAsDirty(e,t){for(let i=0;i<se.Instances.length;i++){const r=se.Instances[i];for(let s=0;s<r.scenes.length;s++)r.scenes[s].markAllMaterialsAsDirty(e,t)}}static DefaultLoadingScreenFactory(e){throw Ge("LoadingScreen")}get _supportsHardwareTextureRescaling(){return!!se._RescalePostProcessFactory}get performanceMonitor(){return this._performanceMonitor}get compatibilityMode(){return this._compatibilityMode}set compatibilityMode(e){this._compatibilityMode=!0}getInputElement(){return this._renderingCanvas}constructor(e,t,i,r=!1){if(super(e,t,i,r),this.enableOfflineSupport=!1,this.disableManifestCheck=!1,this.disableContextMenu=!0,this.scenes=[],this._virtualScenes=new Array,this.onNewSceneAddedObservable=new he,this.postProcesses=[],this.isPointerLock=!1,this.onResizeObservable=new he,this.onCanvasBlurObservable=new he,this.onCanvasFocusObservable=new he,this.onCanvasPointerOutObservable=new he,this.onBeginFrameObservable=new he,this.customAnimationFrameRequester=null,this.onEndFrameObservable=new he,this.onBeforeShaderCompilationObservable=new he,this.onAfterShaderCompilationObservable=new he,this._deterministicLockstep=!1,this._lockstepMaxSteps=4,this._timeStep=1/60,this._fps=60,this._deltaTime=0,this._drawCalls=new _s,this.canvasTabIndex=1,this.disablePerformanceMonitorInBackground=!1,this._performanceMonitor=new Ny,this._compatibilityMode=!0,this.currentRenderPassId=0,this._renderPassNames=["main"],se.Instances.push(this),!!e&&(this._features.supportRenderPasses=!0,i=this._creationOptions,e.getContext)){const s=e;this._sharedInit(s)}}_initGLContext(){super._initGLContext(),this._rescalePostProcess=null}_sharedInit(e){super._sharedInit(e),this._onCanvasFocus=()=>{this.onCanvasFocusObservable.notifyObservers(this)},this._onCanvasBlur=()=>{this.onCanvasBlurObservable.notifyObservers(this)},this._onCanvasContextMenu=i=>{this.disableContextMenu&&i.preventDefault()},e.addEventListener("focus",this._onCanvasFocus),e.addEventListener("blur",this._onCanvasBlur),e.addEventListener("contextmenu",this._onCanvasContextMenu),this._onBlur=()=>{this.disablePerformanceMonitorInBackground&&this._performanceMonitor.disable(),this._windowIsBackground=!0},this._onFocus=()=>{this.disablePerformanceMonitorInBackground&&this._performanceMonitor.enable(),this._windowIsBackground=!1},this._onCanvasPointerOut=i=>{document.elementFromPoint(i.clientX,i.clientY)!==e&&this.onCanvasPointerOutObservable.notifyObservers(i)};const t=this.getHostWindow();t&&typeof t.addEventListener=="function"&&(t.addEventListener("blur",this._onBlur),t.addEventListener("focus",this._onFocus)),e.addEventListener("pointerout",this._onCanvasPointerOut),this._creationOptions.doNotHandleTouchAction||this._disableTouchAction(),!se.audioEngine&&this._creationOptions.audioEngine&&se.AudioEngineFactory&&(se.audioEngine=se.AudioEngineFactory(this.getRenderingCanvas(),this.getAudioContext(),this.getAudioDestination())),da()&&(this._onFullscreenChange=()=>{this.isFullscreen=!!document.fullscreenElement,this.isFullscreen&&this._pointerLockRequested&&e&&se._RequestPointerlock(e)},document.addEventListener("fullscreenchange",this._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",this._onFullscreenChange,!1),this._onPointerLockChange=()=>{this.isPointerLock=document.pointerLockElement===e},document.addEventListener("pointerlockchange",this._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",this._onPointerLockChange,!1)),this.enableOfflineSupport=se.OfflineProviderFactory!==void 0,this._deterministicLockstep=!!this._creationOptions.deterministicLockstep,this._lockstepMaxSteps=this._creationOptions.lockstepMaxSteps||0,this._timeStep=this._creationOptions.timeStep||1/60}_verifyPointerLock(){var e;(e=this._onPointerLockChange)==null||e.call(this)}getAspectRatio(e,t=!1){const i=e.viewport;return this.getRenderWidth(t)*i.width/(this.getRenderHeight(t)*i.height)}getScreenAspectRatio(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)}getRenderingCanvasClientRect(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null}getInputElementClientRect(){return this._renderingCanvas?this.getInputElement().getBoundingClientRect():null}isDeterministicLockStep(){return this._deterministicLockstep}getLockstepMaxSteps(){return this._lockstepMaxSteps}getTimeStep(){return this._timeStep*1e3}generateMipMapsForCubemap(e,t=!0){if(e.generateMipMaps){const i=this._gl;this._bindTextureDirectly(i.TEXTURE_CUBE_MAP,e,!0),i.generateMipmap(i.TEXTURE_CUBE_MAP),t&&this._bindTextureDirectly(i.TEXTURE_CUBE_MAP,null)}}getDepthWrite(){return this._depthCullingState.depthMask}setDepthWrite(e){this._depthCullingState.depthMask=e}getStencilBuffer(){return this._stencilState.stencilTest}setStencilBuffer(e){this._stencilState.stencilTest=e}getStencilMask(){return this._stencilState.stencilMask}setStencilMask(e){this._stencilState.stencilMask=e}getStencilFunction(){return this._stencilState.stencilFunc}getStencilFunctionReference(){return this._stencilState.stencilFuncRef}getStencilFunctionMask(){return this._stencilState.stencilFuncMask}setStencilFunction(e){this._stencilState.stencilFunc=e}setStencilFunctionReference(e){this._stencilState.stencilFuncRef=e}setStencilFunctionMask(e){this._stencilState.stencilFuncMask=e}getStencilOperationFail(){return this._stencilState.stencilOpStencilFail}getStencilOperationDepthFail(){return this._stencilState.stencilOpDepthFail}getStencilOperationPass(){return this._stencilState.stencilOpStencilDepthPass}setStencilOperationFail(e){this._stencilState.stencilOpStencilFail=e}setStencilOperationDepthFail(e){this._stencilState.stencilOpDepthFail=e}setStencilOperationPass(e){this._stencilState.stencilOpStencilDepthPass=e}setDitheringState(e){e?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)}setRasterizerState(e){e?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)}getDepthFunction(){return this._depthCullingState.depthFunc}setDepthFunction(e){this._depthCullingState.depthFunc=e}setDepthFunctionToGreater(){this.setDepthFunction(516)}setDepthFunctionToGreaterOrEqual(){this.setDepthFunction(518)}setDepthFunctionToLess(){this.setDepthFunction(513)}setDepthFunctionToLessOrEqual(){this.setDepthFunction(515)}cacheStencilState(){this._cachedStencilBuffer=this.getStencilBuffer(),this._cachedStencilFunction=this.getStencilFunction(),this._cachedStencilMask=this.getStencilMask(),this._cachedStencilOperationPass=this.getStencilOperationPass(),this._cachedStencilOperationFail=this.getStencilOperationFail(),this._cachedStencilOperationDepthFail=this.getStencilOperationDepthFail(),this._cachedStencilReference=this.getStencilFunctionReference()}restoreStencilState(){this.setStencilFunction(this._cachedStencilFunction),this.setStencilMask(this._cachedStencilMask),this.setStencilBuffer(this._cachedStencilBuffer),this.setStencilOperationPass(this._cachedStencilOperationPass),this.setStencilOperationFail(this._cachedStencilOperationFail),this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail),this.setStencilFunctionReference(this._cachedStencilReference)}setDirectViewport(e,t,i,r){const s=this._cachedViewport;return this._cachedViewport=null,this._viewport(e,t,i,r),s}scissorClear(e,t,i,r,s){this.enableScissor(e,t,i,r),this.clear(s,!0,!0,!0),this.disableScissor()}enableScissor(e,t,i,r){const s=this._gl;s.enable(s.SCISSOR_TEST),s.scissor(e,t,i,r)}disableScissor(){const e=this._gl;e.disable(e.SCISSOR_TEST)}_reportDrawCall(e=1){this._drawCalls.addCount(e,!1)}_loadFileAsync(e,t,i){return new Promise((r,s)=>{this._loadFile(e,o=>{r(o)},void 0,t,i,(o,a)=>{s(a)})})}getVertexShaderSource(e){const t=this._gl.getAttachedShaders(e);return t?this._gl.getShaderSource(t[0]):null}getFragmentShaderSource(e){const t=this._gl.getAttachedShaders(e);return t?this._gl.getShaderSource(t[1]):null}setDepthStencilTexture(e,t,i,r){e!==void 0&&(t&&(this._boundUniforms[e]=t),!i||!i.depthStencilTexture?this._setTexture(e,null,void 0,void 0,r):this._setTexture(e,i,!1,!0,r))}setTextureFromPostProcess(e,t,i){let r=null;t&&(t._forcedOutputTexture?r=t._forcedOutputTexture:t._textures.data[t._currentRenderTextureInd]&&(r=t._textures.data[t._currentRenderTextureInd])),this._bindTexture(e,(r==null?void 0:r.texture)??null,i)}setTextureFromPostProcessOutput(e,t,i){var r;this._bindTexture(e,((r=t==null?void 0:t._outputTexture)==null?void 0:r.texture)??null,i)}set framebufferDimensionsObject(e){this._framebufferDimensionsObject=e,this._framebufferDimensionsObject&&this.onResizeObservable.notifyObservers(this)}_rebuildBuffers(){for(const e of this.scenes)e.resetCachedMaterial(),e._rebuildGeometries();for(const e of this._virtualScenes)e.resetCachedMaterial(),e._rebuildGeometries();super._rebuildBuffers()}_rebuildTextures(){for(const e of this.scenes)e._rebuildTextures();for(const e of this._virtualScenes)e._rebuildTextures();super._rebuildTextures()}_renderFrame(){for(let e=0;e<this._activeRenderLoops.length;e++){const t=this._activeRenderLoops[e];t()}}_cancelFrame(){if(this.customAnimationFrameRequester){if(this._frameHandler!==0){this._frameHandler=0;const{cancelAnimationFrame:e}=this.customAnimationFrameRequester;e&&e(this.customAnimationFrameRequester.requestID)}}else super._cancelFrame()}_renderLoop(){if(this._frameHandler=0,!this._contextWasLost){let e=!0;(this.isDisposed||!this.renderEvenInBackground&&this._windowIsBackground)&&(e=!1),e&&(this.beginFrame(),this._renderViews()||this._renderFrame(),this.endFrame())}this._frameHandler===0&&(this.customAnimationFrameRequester?(this.customAnimationFrameRequester.requestID=this._queueNewFrame(this.customAnimationFrameRequester.renderFunction||this._boundRenderFunction,this.customAnimationFrameRequester),this._frameHandler=this.customAnimationFrameRequester.requestID):this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}_renderViews(){return!1}switchFullscreen(e){this.isFullscreen?this.exitFullscreen():this.enterFullscreen(e)}enterFullscreen(e){this.isFullscreen||(this._pointerLockRequested=e,this._renderingCanvas&&se._RequestFullscreen(this._renderingCanvas))}exitFullscreen(){this.isFullscreen&&se._ExitFullscreen()}enterPointerlock(){this._renderingCanvas&&se._RequestPointerlock(this._renderingCanvas)}exitPointerlock(){se._ExitPointerlock()}beginFrame(){this._measureFps(),this.onBeginFrameObservable.notifyObservers(this),super.beginFrame()}endFrame(){super.endFrame(),this.onEndFrameObservable.notifyObservers(this)}setSize(e,t,i=!1){if(!this._renderingCanvas||!super.setSize(e,t,i))return!1;if(this.scenes){for(let r=0;r<this.scenes.length;r++){const s=this.scenes[r];for(let o=0;o<s.cameras.length;o++){const a=s.cameras[o];a._currentRenderId=0}}this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this)}return!0}_deletePipelineContext(e){const t=e;t&&t.program&&t.transformFeedback&&(this.deleteTransformFeedback(t.transformFeedback),t.transformFeedback=null),super._deletePipelineContext(e)}createShaderProgram(e,t,i,r,s,o=null){s=s||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);const a=super.createShaderProgram(e,t,i,r,s,o);return this.onAfterShaderCompilationObservable.notifyObservers(this),a}_createShaderProgram(e,t,i,r,s=null){const o=r.createProgram();if(e.program=o,!o)throw new Error("Unable to create program");if(r.attachShader(o,t),r.attachShader(o,i),this.webGLVersion>1&&s){const a=this.createTransformFeedback();this.bindTransformFeedback(a),this.setTranformFeedbackVaryings(o,s),e.transformFeedback=a}return r.linkProgram(o),this.webGLVersion>1&&s&&this.bindTransformFeedback(null),e.context=r,e.vertexShader=t,e.fragmentShader=i,e.isParallelCompiled||this._finalizePipelineContext(e),o}_releaseTexture(e){super._releaseTexture(e)}_releaseRenderTargetWrapper(e){super._releaseRenderTargetWrapper(e),this.scenes.forEach(t=>{t.postProcesses.forEach(i=>{i._outputTexture===e&&(i._outputTexture=null)}),t.cameras.forEach(i=>{i._postProcesses.forEach(r=>{r&&r._outputTexture===e&&(r._outputTexture=null)})})})}getRenderPassNames(){return this._renderPassNames}getCurrentRenderPassName(){return this._renderPassNames[this.currentRenderPassId]}createRenderPassId(e){const t=++se._RenderPassIdCounter;return this._renderPassNames[t]=e??"NONAME",t}releaseRenderPassId(e){this._renderPassNames[e]=void 0;for(let t=0;t<this.scenes.length;++t){const i=this.scenes[t];for(let r=0;r<i.meshes.length;++r){const s=i.meshes[r];if(s.subMeshes)for(let o=0;o<s.subMeshes.length;++o)s.subMeshes[o]._removeDrawWrapper(e)}}}_rescaleTexture(e,t,i,r,s){this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);const o=this.createRenderTargetTexture({width:t.width,height:t.height},{generateMipMaps:!1,type:0,samplingMode:2,generateDepthBuffer:!1,generateStencilBuffer:!1});!this._rescalePostProcess&&se._RescalePostProcessFactory&&(this._rescalePostProcess=se._RescalePostProcessFactory(this)),this._rescalePostProcess&&(this._rescalePostProcess.externalTextureSamplerBinding=!0,this._rescalePostProcess.getEffect().executeWhenCompiled(()=>{this._rescalePostProcess.onApply=function(l){l._bindTexture("textureSampler",e)};let a=i;a||(a=this.scenes[this.scenes.length-1]),a.postProcessManager.directRender([this._rescalePostProcess],o,!0),this._bindTextureDirectly(this._gl.TEXTURE_2D,t,!0),this._gl.copyTexImage2D(this._gl.TEXTURE_2D,0,r,0,0,t.width,t.height,0),this.unBindFramebuffer(o),o.dispose(),s&&s()}))}getFps(){return this._fps}getDeltaTime(){return this._deltaTime}_measureFps(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0}wrapWebGLTexture(e,t=!1,i=3,r=0,s=0){const o=new Q_(e,this._gl),a=new ur(this,Dt.Unknown,!0);return a._hardwareTexture=o,a.baseWidth=r,a.baseHeight=s,a.width=r,a.height=s,a.isReady=!0,a.useMipMaps=t,this.updateTextureSamplingMode(i,a),a}_uploadImageToTexture(e,t,i=0,r=0){const s=this._gl,o=this._getWebGLTextureType(e.type),a=this._getInternalFormat(e.format),l=this._getRGBABufferInternalSizedFormat(e.type,a),h=e.isCube?s.TEXTURE_CUBE_MAP:s.TEXTURE_2D;this._bindTextureDirectly(h,e,!0),this._unpackFlipY(e.invertY);let c=s.TEXTURE_2D;e.isCube&&(c=s.TEXTURE_CUBE_MAP_POSITIVE_X+i),s.texImage2D(c,r,l,a,o,t),this._bindTextureDirectly(h,null,!0)}updateTextureComparisonFunction(e,t){if(this.webGLVersion===1){oe.Error("WebGL 1 does not support texture comparison.");return}const i=this._gl;e.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,e,!0),t===0?(i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_COMPARE_FUNC,515),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_COMPARE_MODE,i.NONE)):(i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_COMPARE_FUNC,t),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_COMPARE_MODE,i.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,e,!0),t===0?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_COMPARE_FUNC,515),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_COMPARE_MODE,i.NONE)):(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_COMPARE_FUNC,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_COMPARE_MODE,i.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),e._comparisonFunction=t}createInstancesBuffer(e){const t=this._gl.createBuffer();if(!t)throw new Error("Unable to create instance buffer");const i=new Ta(t);return i.capacity=e,this.bindArrayBuffer(i),this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.DYNAMIC_DRAW),i.references=1,i}deleteInstancesBuffer(e){this._gl.deleteBuffer(e)}_clientWaitAsync(e,t=0,i=10){const r=this._gl;return new Promise((s,o)=>{const a=()=>{const l=r.clientWaitSync(e,t,0);if(l==r.WAIT_FAILED){o();return}if(l==r.TIMEOUT_EXPIRED){setTimeout(a,i);return}s()};a()})}_readPixelsAsync(e,t,i,r,s,o,a){if(this._webGLVersion<2)throw new Error("_readPixelsAsync only work on WebGL2+");const l=this._gl,h=l.createBuffer();l.bindBuffer(l.PIXEL_PACK_BUFFER,h),l.bufferData(l.PIXEL_PACK_BUFFER,a.byteLength,l.STREAM_READ),l.readPixels(e,t,i,r,s,o,0),l.bindBuffer(l.PIXEL_PACK_BUFFER,null);const c=l.fenceSync(l.SYNC_GPU_COMMANDS_COMPLETE,0);return c?(l.flush(),this._clientWaitAsync(c,0,10).then(()=>(l.deleteSync(c),l.bindBuffer(l.PIXEL_PACK_BUFFER,h),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,a),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),l.deleteBuffer(h),a))):null}dispose(){for(this.hideLoadingUI(),this.onNewSceneAddedObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(this._rescalePostProcess&&this._rescalePostProcess.dispose();this.scenes.length;)this.scenes[0].dispose();for(;this._virtualScenes.length;)this._virtualScenes[0].dispose();rt.Instances.length===1&&se.audioEngine&&(se.audioEngine.dispose(),se.audioEngine=null);const e=this.getHostWindow();e&&typeof e.removeEventListener=="function"&&(e.removeEventListener("blur",this._onBlur),e.removeEventListener("focus",this._onFocus)),this._renderingCanvas&&(this._renderingCanvas.removeEventListener("focus",this._onCanvasFocus),this._renderingCanvas.removeEventListener("blur",this._onCanvasBlur),this._renderingCanvas.removeEventListener("pointerout",this._onCanvasPointerOut),this._renderingCanvas.removeEventListener("contextmenu",this._onCanvasContextMenu)),da()&&(document.removeEventListener("fullscreenchange",this._onFullscreenChange),document.removeEventListener("mozfullscreenchange",this._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",this._onFullscreenChange),document.removeEventListener("msfullscreenchange",this._onFullscreenChange),document.removeEventListener("pointerlockchange",this._onPointerLockChange),document.removeEventListener("mspointerlockchange",this._onPointerLockChange),document.removeEventListener("mozpointerlockchange",this._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",this._onPointerLockChange)),super.dispose();const t=rt.Instances.indexOf(this);t>=0&&rt.Instances.splice(t,1),se.Instances.length||rt.OnEnginesDisposedObservable.notifyObservers(this),this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear()}_disableTouchAction(){!this._renderingCanvas||!this._renderingCanvas.setAttribute||(this._renderingCanvas.setAttribute("touch-action","none"),this._renderingCanvas.style.touchAction="none",this._renderingCanvas.style.webkitTapHighlightColor="transparent")}displayLoadingUI(){if(!Ai())return;const e=this.loadingScreen;e&&e.displayLoadingUI()}hideLoadingUI(){if(!Ai())return;const e=this._loadingScreen;e&&e.hideLoadingUI()}get loadingScreen(){return!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=se.DefaultLoadingScreenFactory(this._renderingCanvas)),this._loadingScreen}set loadingScreen(e){this._loadingScreen=e}set loadingUIText(e){this.loadingScreen.loadingUIText=e}set loadingUIBackgroundColor(e){this.loadingScreen.loadingUIBackgroundColor=e}createVideoElement(e){return document.createElement("video")}static _RequestPointerlock(e){if(e.requestPointerLock){const t=e.requestPointerLock();t instanceof Promise?t.then(()=>{e.focus()}).catch(()=>{}):e.focus()}}static _ExitPointerlock(){document.exitPointerLock&&document.exitPointerLock()}static _RequestFullscreen(e){const t=e.requestFullscreen||e.webkitRequestFullscreen;t&&t.call(e)}static _ExitFullscreen(){const e=document;document.exitFullscreen?document.exitFullscreen():e.webkitCancelFullScreen&&e.webkitCancelFullScreen()}getFontOffset(e){const t=document.createElement("span");t.innerHTML="Hg",t.setAttribute("style",`font: ${e} !important`);const i=document.createElement("div");i.style.display="inline-block",i.style.width="1px",i.style.height="0px",i.style.verticalAlign="bottom";const r=document.createElement("div");r.style.whiteSpace="nowrap",r.appendChild(t),r.appendChild(i),document.body.appendChild(r);let s=0,o=0;try{o=i.getBoundingClientRect().top-t.getBoundingClientRect().top,i.style.verticalAlign="baseline",s=i.getBoundingClientRect().top-t.getBoundingClientRect().top}finally{document.body.removeChild(r)}return{ascent:s,height:o,descent:o-s}}}se.ALPHA_DISABLE=0;se.ALPHA_ADD=1;se.ALPHA_COMBINE=2;se.ALPHA_SUBTRACT=3;se.ALPHA_MULTIPLY=4;se.ALPHA_MAXIMIZED=5;se.ALPHA_ONEONE=6;se.ALPHA_PREMULTIPLIED=7;se.ALPHA_PREMULTIPLIED_PORTERDUFF=8;se.ALPHA_INTERPOLATE=9;se.ALPHA_SCREENMODE=10;se.DELAYLOADSTATE_NONE=0;se.DELAYLOADSTATE_LOADED=1;se.DELAYLOADSTATE_LOADING=2;se.DELAYLOADSTATE_NOTLOADED=4;se.NEVER=512;se.ALWAYS=519;se.LESS=513;se.EQUAL=514;se.LEQUAL=515;se.GREATER=516;se.GEQUAL=518;se.NOTEQUAL=517;se.KEEP=7680;se.REPLACE=7681;se.INCR=7682;se.DECR=7683;se.INVERT=5386;se.INCR_WRAP=34055;se.DECR_WRAP=34056;se.TEXTURE_CLAMP_ADDRESSMODE=0;se.TEXTURE_WRAP_ADDRESSMODE=1;se.TEXTURE_MIRROR_ADDRESSMODE=2;se.TEXTUREFORMAT_ALPHA=0;se.TEXTUREFORMAT_LUMINANCE=1;se.TEXTUREFORMAT_LUMINANCE_ALPHA=2;se.TEXTUREFORMAT_RGB=4;se.TEXTUREFORMAT_RGBA=5;se.TEXTUREFORMAT_RED=6;se.TEXTUREFORMAT_R=6;se.TEXTUREFORMAT_RG=7;se.TEXTUREFORMAT_RED_INTEGER=8;se.TEXTUREFORMAT_R_INTEGER=8;se.TEXTUREFORMAT_RG_INTEGER=9;se.TEXTUREFORMAT_RGB_INTEGER=10;se.TEXTUREFORMAT_RGBA_INTEGER=11;se.TEXTURETYPE_UNSIGNED_BYTE=0;se.TEXTURETYPE_UNSIGNED_INT=0;se.TEXTURETYPE_FLOAT=1;se.TEXTURETYPE_HALF_FLOAT=2;se.TEXTURETYPE_BYTE=3;se.TEXTURETYPE_SHORT=4;se.TEXTURETYPE_UNSIGNED_SHORT=5;se.TEXTURETYPE_INT=6;se.TEXTURETYPE_UNSIGNED_INTEGER=7;se.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8;se.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9;se.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10;se.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11;se.TEXTURETYPE_UNSIGNED_INT_24_8=12;se.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13;se.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14;se.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15;se.TEXTURE_NEAREST_SAMPLINGMODE=1;se.TEXTURE_BILINEAR_SAMPLINGMODE=2;se.TEXTURE_TRILINEAR_SAMPLINGMODE=3;se.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8;se.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11;se.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3;se.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4;se.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5;se.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6;se.TEXTURE_NEAREST_LINEAR=7;se.TEXTURE_NEAREST_NEAREST=1;se.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9;se.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10;se.TEXTURE_LINEAR_LINEAR=2;se.TEXTURE_LINEAR_NEAREST=12;se.TEXTURE_EXPLICIT_MODE=0;se.TEXTURE_SPHERICAL_MODE=1;se.TEXTURE_PLANAR_MODE=2;se.TEXTURE_CUBIC_MODE=3;se.TEXTURE_PROJECTION_MODE=4;se.TEXTURE_SKYBOX_MODE=5;se.TEXTURE_INVCUBIC_MODE=6;se.TEXTURE_EQUIRECTANGULAR_MODE=7;se.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8;se.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9;se.SCALEMODE_FLOOR=1;se.SCALEMODE_NEAREST=2;se.SCALEMODE_CEILING=3;se._RescalePostProcessFactory=null;se._RenderPassIdCounter=0;function dh(n,e,t){try{const i=n.next();i.done?e(i):i.value?i.value.then(()=>{i.value=void 0,e(i)},t):e(i)}catch(i){t(i)}}function wy(n=25){let e;return(t,i,r)=>{const s=performance.now();e===void 0||s-e>n?(e=s,setTimeout(()=>{dh(t,i,r)},0)):dh(t,i,r)}}function d0(n,e,t,i,r){const s=()=>{let o;const a=l=>{l.done?t(l.value):o===void 0?o=!0:s()};do o=void 0,!r||!r.aborted?e(n,a,i):i(new Error("Aborted")),o===void 0&&(o=!1);while(o)};s()}function md(n,e){let t;return d0(n,dh,i=>t=i,i=>{throw i},e),t}function f0(n,e,t){return new Promise((i,r)=>{d0(n,e,i,r,t)})}function Uy(n,e){return(...t)=>md(n(...t),e)}class Pu{constructor(e,t,i){this.bu=e,this.bv=t,this.distance=i,this.faceId=0,this.subMeshId=0}}class Bs{constructor(e,t,i){this.vectors=Ci.BuildArray(8,v.Zero),this.center=v.Zero(),this.centerWorld=v.Zero(),this.extendSize=v.Zero(),this.extendSizeWorld=v.Zero(),this.directions=Ci.BuildArray(3,v.Zero),this.vectorsWorld=Ci.BuildArray(8,v.Zero),this.minimumWorld=v.Zero(),this.maximumWorld=v.Zero(),this.minimum=v.Zero(),this.maximum=v.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(e,t,i)}reConstruct(e,t,i){const r=e.x,s=e.y,o=e.z,a=t.x,l=t.y,h=t.z,c=this.vectors;this.minimum.copyFromFloats(r,s,o),this.maximum.copyFromFloats(a,l,h),c[0].copyFromFloats(r,s,o),c[1].copyFromFloats(a,l,h),c[2].copyFromFloats(a,s,o),c[3].copyFromFloats(r,l,o),c[4].copyFromFloats(r,s,h),c[5].copyFromFloats(a,l,o),c[6].copyFromFloats(r,l,h),c[7].copyFromFloats(a,s,h),t.addToRef(e,this.center).scaleInPlace(.5),t.subtractToRef(e,this.extendSize).scaleInPlace(.5),this._worldMatrix=i||U.IdentityReadOnly,this._update(this._worldMatrix)}scale(e){const t=Bs._TmpVector3,i=this.maximum.subtractToRef(this.minimum,t[0]),r=i.length();i.normalizeFromLength(r);const s=r*e,o=i.scaleInPlace(s*.5),a=this.center.subtractToRef(o,t[1]),l=this.center.addToRef(o,t[2]);return this.reConstruct(a,l,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(e){const t=this.minimumWorld,i=this.maximumWorld,r=this.directions,s=this.vectorsWorld,o=this.vectors;if(e.isIdentity()){t.copyFrom(this.minimum),i.copyFrom(this.maximum);for(let a=0;a<8;++a)s[a].copyFrom(o[a]);this.extendSizeWorld.copyFrom(this.extendSize),this.centerWorld.copyFrom(this.center)}else{t.setAll(Number.MAX_VALUE),i.setAll(-Number.MAX_VALUE);for(let a=0;a<8;++a){const l=s[a];v.TransformCoordinatesToRef(o[a],e,l),t.minimizeInPlace(l),i.maximizeInPlace(l)}i.subtractToRef(t,this.extendSizeWorld).scaleInPlace(.5),i.addToRef(t,this.centerWorld).scaleInPlace(.5)}v.FromArrayToRef(e.m,0,r[0]),v.FromArrayToRef(e.m,4,r[1]),v.FromArrayToRef(e.m,8,r[2]),this._worldMatrix=e}isInFrustum(e){return Bs.IsInFrustum(this.vectorsWorld,e)}isCompletelyInFrustum(e){return Bs.IsCompletelyInFrustum(this.vectorsWorld,e)}intersectsPoint(e){const t=this.minimumWorld,i=this.maximumWorld,r=t.x,s=t.y,o=t.z,a=i.x,l=i.y,h=i.z,c=e.x,u=e.y,d=e.z,f=-xt;return!(a-c<f||f>c-r||l-u<f||f>u-s||h-d<f||f>d-o)}intersectsSphere(e){return Bs.IntersectsSphere(this.minimumWorld,this.maximumWorld,e.centerWorld,e.radiusWorld)}intersectsMinMax(e,t){const i=this.minimumWorld,r=this.maximumWorld,s=i.x,o=i.y,a=i.z,l=r.x,h=r.y,c=r.z,u=e.x,d=e.y,f=e.z,p=t.x,g=t.y,m=t.z;return!(l<u||s>p||h<d||o>g||c<f||a>m)}dispose(){var e,t;(e=this._drawWrapperFront)==null||e.dispose(),(t=this._drawWrapperBack)==null||t.dispose()}static Intersects(e,t){return e.intersectsMinMax(t.minimumWorld,t.maximumWorld)}static IntersectsSphere(e,t,i,r){const s=Bs._TmpVector3[0];return v.ClampToRef(i,e,t,s),v.DistanceSquared(i,s)<=r*r}static IsCompletelyInFrustum(e,t){for(let i=0;i<6;++i){const r=t[i];for(let s=0;s<8;++s)if(r.dotCoordinate(e[s])<0)return!1}return!0}static IsInFrustum(e,t){for(let i=0;i<6;++i){let r=!0;const s=t[i];for(let o=0;o<8;++o)if(s.dotCoordinate(e[o])>=0){r=!1;break}if(r)return!1}return!0}}Bs._TmpVector3=Ci.BuildArray(3,v.Zero);class Ln{constructor(e,t,i){this.center=v.Zero(),this.centerWorld=v.Zero(),this.minimum=v.Zero(),this.maximum=v.Zero(),this.reConstruct(e,t,i)}reConstruct(e,t,i){this.minimum.copyFrom(e),this.maximum.copyFrom(t);const r=v.Distance(e,t);t.addToRef(e,this.center).scaleInPlace(.5),this.radius=r*.5,this._update(i||U.IdentityReadOnly)}scale(e){const t=this.radius*e,i=Ln._TmpVector3,r=i[0].setAll(t),s=this.center.subtractToRef(r,i[1]),o=this.center.addToRef(r,i[2]);return this.reConstruct(s,o,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(e){if(e.isIdentity())this.centerWorld.copyFrom(this.center),this.radiusWorld=this.radius;else{v.TransformCoordinatesToRef(this.center,e,this.centerWorld);const t=Ln._TmpVector3[0];v.TransformNormalFromFloatsToRef(1,1,1,e,t),this.radiusWorld=Math.max(Math.abs(t.x),Math.abs(t.y),Math.abs(t.z))*this.radius}}isInFrustum(e){const t=this.centerWorld,i=this.radiusWorld;for(let r=0;r<6;r++)if(e[r].dotCoordinate(t)<=-i)return!1;return!0}isCenterInFrustum(e){const t=this.centerWorld;for(let i=0;i<6;i++)if(e[i].dotCoordinate(t)<0)return!1;return!0}intersectsPoint(e){const t=v.DistanceSquared(this.centerWorld,e);return!(this.radiusWorld*this.radiusWorld<t)}static Intersects(e,t){const i=v.DistanceSquared(e.centerWorld,t.centerWorld),r=e.radiusWorld+t.radiusWorld;return!(r*r<i)}static CreateFromCenterAndRadius(e,t,i){this._TmpVector3[0].copyFrom(e),this._TmpVector3[1].copyFromFloats(0,0,t),this._TmpVector3[2].copyFrom(e),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].subtractInPlace(this._TmpVector3[1]);const r=new Ln(this._TmpVector3[0],this._TmpVector3[2]);return i?r._worldMatrix=i:r._worldMatrix=U.Identity(),r}}Ln._TmpVector3=Ci.BuildArray(3,v.Zero);const Qc={min:0,max:0},Jc={min:0,max:0},Cg=(n,e,t)=>{const i=v.Dot(e.centerWorld,n),r=Math.abs(v.Dot(e.directions[0],n))*e.extendSize.x,s=Math.abs(v.Dot(e.directions[1],n))*e.extendSize.y,o=Math.abs(v.Dot(e.directions[2],n))*e.extendSize.z,a=r+s+o;t.min=i-a,t.max=i+a},or=(n,e,t)=>(Cg(n,e,Qc),Cg(n,t,Jc),!(Qc.min>Jc.max||Jc.min>Qc.max));class br{constructor(e,t,i){this._isLocked=!1,this.boundingBox=new Bs(e,t,i),this.boundingSphere=new Ln(e,t,i)}reConstruct(e,t,i){this.boundingBox.reConstruct(e,t,i),this.boundingSphere.reConstruct(e,t,i)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(e){this._isLocked=e}update(e){this._isLocked||(this.boundingBox._update(e),this.boundingSphere._update(e))}centerOn(e,t){const i=br._TmpVector3[0].copyFrom(e).subtractInPlace(t),r=br._TmpVector3[1].copyFrom(e).addInPlace(t);return this.boundingBox.reConstruct(i,r,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(i,r,this.boundingBox.getWorldMatrix()),this}encapsulate(e){const t=v.Minimize(this.minimum,e),i=v.Maximize(this.maximum,e);return this.reConstruct(t,i,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(e){const t=W.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(t);const i=W.Vector3[0];return v.TransformCoordinatesToRef(e.boundingBox.minimumWorld,t,i),this.encapsulate(i),v.TransformCoordinatesToRef(e.boundingBox.maximumWorld,t,i),this.encapsulate(i),this}scale(e){return this.boundingBox.scale(e),this.boundingSphere.scale(e),this}isInFrustum(e,t=0){return(t===2||t===3)&&this.boundingSphere.isCenterInFrustum(e)?!0:this.boundingSphere.isInFrustum(e)?t===1||t===3?!0:this.boundingBox.isInFrustum(e):!1}get diagonalLength(){const e=this.boundingBox;return e.maximumWorld.subtractToRef(e.minimumWorld,br._TmpVector3[0]).length()}isCompletelyInFrustum(e){return this.boundingBox.isCompletelyInFrustum(e)}_checkCollision(e){return e._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(e){return!(!this.boundingSphere.centerWorld||!this.boundingSphere.intersectsPoint(e)||!this.boundingBox.intersectsPoint(e))}intersects(e,t){if(!Ln.Intersects(this.boundingSphere,e.boundingSphere)||!Bs.Intersects(this.boundingBox,e.boundingBox))return!1;if(!t)return!0;const i=this.boundingBox,r=e.boundingBox;return!(!or(i.directions[0],i,r)||!or(i.directions[1],i,r)||!or(i.directions[2],i,r)||!or(r.directions[0],i,r)||!or(r.directions[1],i,r)||!or(r.directions[2],i,r)||!or(v.Cross(i.directions[0],r.directions[0]),i,r)||!or(v.Cross(i.directions[0],r.directions[1]),i,r)||!or(v.Cross(i.directions[0],r.directions[2]),i,r)||!or(v.Cross(i.directions[1],r.directions[0]),i,r)||!or(v.Cross(i.directions[1],r.directions[1]),i,r)||!or(v.Cross(i.directions[1],r.directions[2]),i,r)||!or(v.Cross(i.directions[2],r.directions[0]),i,r)||!or(v.Cross(i.directions[2],r.directions[1]),i,r)||!or(v.Cross(i.directions[2],r.directions[2]),i,r))}}br._TmpVector3=Ci.BuildArray(2,v.Zero);class Gh{static extractMinAndMaxIndexed(e,t,i,r,s,o){for(let a=i;a<i+r;a++){const l=t[a]*3,h=e[l],c=e[l+1],u=e[l+2];s.minimizeInPlaceFromFloats(h,c,u),o.maximizeInPlaceFromFloats(h,c,u)}}static extractMinAndMax(e,t,i,r,s,o){for(let a=t,l=t*r;a<t+i;a++,l+=r){const h=e[l],c=e[l+1],u=e[l+2];s.minimizeInPlaceFromFloats(h,c,u),o.maximizeInPlaceFromFloats(h,c,u)}}}M([pn.filter((...[n,e])=>!Array.isArray(n)&&!Array.isArray(e))],Gh,"extractMinAndMaxIndexed",null);M([pn.filter((...[n])=>!Array.isArray(n))],Gh,"extractMinAndMax",null);function Vy(n,e,t,i,r=null){const s=new v(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),o=new v(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return Gh.extractMinAndMaxIndexed(n,e,t,i,s,o),r&&(s.x-=s.x*r.x+r.y,s.y-=s.y*r.x+r.y,s.z-=s.z*r.x+r.y,o.x+=o.x*r.x+r.y,o.y+=o.y*r.x+r.y,o.z+=o.z*r.x+r.y),{minimum:s,maximum:o}}function Ra(n,e,t,i=null,r){const s=new v(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),o=new v(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return r||(r=3),Gh.extractMinAndMax(n,e,t,r,s,o),i&&(s.x-=s.x*i.x+i.y,s.y-=s.y*i.x+i.y,s.z-=s.z*i.x+i.y,o.x+=o.x*i.x+i.y,o.y+=o.y*i.x+i.y,o.z+=o.z*i.x+i.y),{minimum:s,maximum:o}}class Pi{get materialDefines(){var e;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:(e=this._getDrawWrapper())==null?void 0:e.defines}set materialDefines(e){const t=this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0);t.defines=e}_getDrawWrapper(e,t=!1){e=e??this._engine.currentRenderPassId;let i=this._drawWrappers[e];return!i&&t&&(this._drawWrappers[e]=i=new Ko(this._mesh.getScene().getEngine())),i}_removeDrawWrapper(e,t=!0){var i;t&&((i=this._drawWrappers[e])==null||i.dispose()),this._drawWrappers[e]=void 0}get effect(){var e;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:((e=this._getDrawWrapper())==null?void 0:e.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(e){this._mainDrawWrapperOverride=e}setEffect(e,t=null,i,r=!0){const s=this._drawWrapper;s.setEffect(e,t,r),i!==void 0&&(s.materialContext=i),e||(s.defines=null,s.materialContext=void 0)}resetDrawCache(e){if(this._drawWrappers)if(e!==void 0){this._removeDrawWrapper(e);return}else for(const t of this._drawWrappers)t==null||t.dispose();this._drawWrappers=[]}static AddToMesh(e,t,i,r,s,o,a,l=!0){return new Pi(e,t,i,r,s,o,a,l)}constructor(e,t,i,r,s,o,a,l=!0,h=!0){this.materialIndex=e,this.verticesStart=t,this.verticesCount=i,this.indexStart=r,this.indexCount=s,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=o,this._renderingMesh=a||o,h&&o.subMeshes.push(this),this._engine=this._mesh.getScene().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=o.subMeshes.length-1,l&&(this.refreshBoundingInfo(),o.computeWorldMatrix(!0))}get IsGlobal(){return this.verticesStart===0&&this.verticesCount===this._mesh.getTotalVertices()&&this.indexStart===0&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(e){return this._boundingInfo=e,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){return(this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null)||this._renderingMesh}getMaterial(e=!0){const t=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(t){if(this._isMultiMaterial(t)){const i=t.getSubMaterial(this.materialIndex);return this._currentMaterial!==i&&(this._currentMaterial=i,this.resetDrawCache()),i}}else return e?this._mesh.getScene().defaultMaterial:null;return t}_isMultiMaterial(e){return e.getSubMaterial!==void 0}refreshBoundingInfo(e=null){if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.geometry)return this;if(e||(e=this._renderingMesh.getVerticesData(b.PositionKind)),!e)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const t=this._renderingMesh.getIndices();let i;if(this.indexStart===0&&this.indexCount===t.length){const r=this._renderingMesh.getBoundingInfo();i={minimum:r.minimum.clone(),maximum:r.maximum.clone()}}else i=Vy(e,t,this.indexStart,this.indexCount,this._renderingMesh.geometry.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(i.minimum,i.maximum):this._boundingInfo=new br(i.minimum,i.maximum),this}_checkCollision(e){return this.getBoundingInfo()._checkCollision(e)}updateBoundingInfo(e){let t=this.getBoundingInfo();return t||(this.refreshBoundingInfo(),t=this.getBoundingInfo()),t&&t.update(e),this}isInFrustum(e){const t=this.getBoundingInfo();return t?t.isInFrustum(e,this._mesh.cullingStrategy):!1}isCompletelyInFrustum(e){const t=this.getBoundingInfo();return t?t.isCompletelyInFrustum(e):!1}render(e){return this._renderingMesh.render(this,e,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(e,t){if(!this._linesIndexBuffer){const i=[];for(let r=this.indexStart;r<this.indexStart+this.indexCount;r+=3)i.push(e[r],e[r+1],e[r+1],e[r+2],e[r+2],e[r]);this._linesIndexBuffer=t.createIndexBuffer(i),this._linesIndexCount=i.length}return this._linesIndexBuffer}canIntersects(e){const t=this.getBoundingInfo();return t?e.intersectsBox(t.boundingBox):!1}intersects(e,t,i,r,s){const o=this.getMaterial();if(!o)return null;let a=3,l=!1;switch(o.fillMode){case 3:case 5:case 6:case 8:return null;case 7:a=1,l=!0;break}return o.fillMode===4?i.length?this._intersectLines(e,t,i,this._mesh.intersectionThreshold,r):this._intersectUnIndexedLines(e,t,i,this._mesh.intersectionThreshold,r):!i.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(e,t,i,r,s):this._intersectTriangles(e,t,i,a,l,r,s)}_intersectLines(e,t,i,r,s){let o=null;for(let a=this.indexStart;a<this.indexStart+this.indexCount;a+=2){const l=t[i[a]],h=t[i[a+1]],c=e.intersectionSegment(l,h,r);if(!(c<0)&&(s||!o||c<o.distance)&&(o=new Pu(null,null,c),o.faceId=a/2,s))break}return o}_intersectUnIndexedLines(e,t,i,r,s){let o=null;for(let a=this.verticesStart;a<this.verticesStart+this.verticesCount;a+=2){const l=t[a],h=t[a+1],c=e.intersectionSegment(l,h,r);if(!(c<0)&&(s||!o||c<o.distance)&&(o=new Pu(null,null,c),o.faceId=a/2,s))break}return o}_intersectTriangles(e,t,i,r,s,o,a){let l=null,h=-1;for(let c=this.indexStart;c<this.indexStart+this.indexCount-(3-r);c+=r){h++;const u=i[c],d=i[c+1],f=i[c+2];if(s&&f===4294967295){c+=2;continue}const p=t[u],g=t[d],m=t[f];if(!p||!g||!m||a&&!a(p,g,m,e,u,d,f))continue;const x=e.intersectsTriangle(p,g,m);if(x){if(x.distance<0)continue;if((o||!l||x.distance<l.distance)&&(l=x,l.faceId=h,o))break}}return l}_intersectUnIndexedTriangles(e,t,i,r,s){let o=null;for(let a=this.verticesStart;a<this.verticesStart+this.verticesCount;a+=3){const l=t[a],h=t[a+1],c=t[a+2];if(s&&!s(l,h,c,e,-1,-1,-1))continue;const u=e.intersectsTriangle(l,h,c);if(u){if(u.distance<0)continue;if((r||!o||u.distance<o.distance)&&(o=u,o.faceId=a/3,r))break}}return o}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(e,t){const i=new Pi(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,e,t,!1);if(!this.IsGlobal){const r=this.getBoundingInfo();if(!r)return i;i._boundingInfo=new br(r.minimum,r.maximum)}return i}dispose(){this._linesIndexBuffer&&(this._mesh.getScene().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const e=this._mesh.subMeshes.indexOf(this);this._mesh.subMeshes.splice(e,1),this.resetDrawCache()}getClassName(){return"SubMesh"}static CreateFromIndices(e,t,i,r,s,o=!0){let a=Number.MAX_VALUE,l=-Number.MAX_VALUE;const h=(s||r).getIndices();for(let c=t;c<t+i;c++){const u=h[c];u<a&&(a=u),u>l&&(l=u)}return new Pi(e,a,l-a+1,t,i,r,s,o)}}class Ql{}class re{constructor(){this.uniqueId=0,this.metadata={},this._applyTo=Uy(this._applyToCoroutine.bind(this)),this.uniqueId=re._UniqueIDGenerator,re._UniqueIDGenerator++}set(e,t){switch(e.length||oe.Warn(`Setting vertex data kind '${t}' with an empty array`),t){case b.PositionKind:this.positions=e;break;case b.NormalKind:this.normals=e;break;case b.TangentKind:this.tangents=e;break;case b.UVKind:this.uvs=e;break;case b.UV2Kind:this.uvs2=e;break;case b.UV3Kind:this.uvs3=e;break;case b.UV4Kind:this.uvs4=e;break;case b.UV5Kind:this.uvs5=e;break;case b.UV6Kind:this.uvs6=e;break;case b.ColorKind:this.colors=e;break;case b.MatricesIndicesKind:this.matricesIndices=e;break;case b.MatricesWeightsKind:this.matricesWeights=e;break;case b.MatricesIndicesExtraKind:this.matricesIndicesExtra=e;break;case b.MatricesWeightsExtraKind:this.matricesWeightsExtra=e;break}}applyToMesh(e,t){return this._applyTo(e,t,!1),this}applyToGeometry(e,t){return this._applyTo(e,t,!1),this}updateMesh(e){return this._update(e),this}updateGeometry(e){return this._update(e),this}*_applyToCoroutine(e,t=!1,i){if(this.positions&&(e.setVerticesData(b.PositionKind,this.positions,t),i&&(yield)),this.normals&&(e.setVerticesData(b.NormalKind,this.normals,t),i&&(yield)),this.tangents&&(e.setVerticesData(b.TangentKind,this.tangents,t),i&&(yield)),this.uvs&&(e.setVerticesData(b.UVKind,this.uvs,t),i&&(yield)),this.uvs2&&(e.setVerticesData(b.UV2Kind,this.uvs2,t),i&&(yield)),this.uvs3&&(e.setVerticesData(b.UV3Kind,this.uvs3,t),i&&(yield)),this.uvs4&&(e.setVerticesData(b.UV4Kind,this.uvs4,t),i&&(yield)),this.uvs5&&(e.setVerticesData(b.UV5Kind,this.uvs5,t),i&&(yield)),this.uvs6&&(e.setVerticesData(b.UV6Kind,this.uvs6,t),i&&(yield)),this.colors&&(e.setVerticesData(b.ColorKind,this.colors,t),this.hasVertexAlpha&&e.hasVertexAlpha!==void 0&&(e.hasVertexAlpha=!0),i&&(yield)),this.matricesIndices&&(e.setVerticesData(b.MatricesIndicesKind,this.matricesIndices,t),i&&(yield)),this.matricesWeights&&(e.setVerticesData(b.MatricesWeightsKind,this.matricesWeights,t),i&&(yield)),this.matricesIndicesExtra&&(e.setVerticesData(b.MatricesIndicesExtraKind,this.matricesIndicesExtra,t),i&&(yield)),this.matricesWeightsExtra&&(e.setVerticesData(b.MatricesWeightsExtraKind,this.matricesWeightsExtra,t),i&&(yield)),this.indices?(e.setIndices(this.indices,null,t),i&&(yield)):e.setIndices([],null),e.subMeshes&&this.materialInfos&&this.materialInfos.length>1){const r=e;r.subMeshes=[];for(const s of this.materialInfos)new Pi(s.materialIndex,s.verticesStart,s.verticesCount,s.indexStart,s.indexCount,r)}return this}_update(e,t,i){return this.positions&&e.updateVerticesData(b.PositionKind,this.positions,t,i),this.normals&&e.updateVerticesData(b.NormalKind,this.normals,t,i),this.tangents&&e.updateVerticesData(b.TangentKind,this.tangents,t,i),this.uvs&&e.updateVerticesData(b.UVKind,this.uvs,t,i),this.uvs2&&e.updateVerticesData(b.UV2Kind,this.uvs2,t,i),this.uvs3&&e.updateVerticesData(b.UV3Kind,this.uvs3,t,i),this.uvs4&&e.updateVerticesData(b.UV4Kind,this.uvs4,t,i),this.uvs5&&e.updateVerticesData(b.UV5Kind,this.uvs5,t,i),this.uvs6&&e.updateVerticesData(b.UV6Kind,this.uvs6,t,i),this.colors&&e.updateVerticesData(b.ColorKind,this.colors,t,i),this.matricesIndices&&e.updateVerticesData(b.MatricesIndicesKind,this.matricesIndices,t,i),this.matricesWeights&&e.updateVerticesData(b.MatricesWeightsKind,this.matricesWeights,t,i),this.matricesIndicesExtra&&e.updateVerticesData(b.MatricesIndicesExtraKind,this.matricesIndicesExtra,t,i),this.matricesWeightsExtra&&e.updateVerticesData(b.MatricesWeightsExtraKind,this.matricesWeightsExtra,t,i),this.indices&&e.setIndices(this.indices,null),this}static _TransformVector3Coordinates(e,t,i=0,r=e.length){const s=W.Vector3[0],o=W.Vector3[1];for(let a=i;a<i+r;a+=3)v.FromArrayToRef(e,a,s),v.TransformCoordinatesToRef(s,t,o),e[a]=o.x,e[a+1]=o.y,e[a+2]=o.z}static _TransformVector3Normals(e,t,i=0,r=e.length){const s=W.Vector3[0],o=W.Vector3[1];for(let a=i;a<i+r;a+=3)v.FromArrayToRef(e,a,s),v.TransformNormalToRef(s,t,o),e[a]=o.x,e[a+1]=o.y,e[a+2]=o.z}static _TransformVector4Normals(e,t,i=0,r=e.length){const s=W.Vector4[0],o=W.Vector4[1];for(let a=i;a<i+r;a+=4)Ke.FromArrayToRef(e,a,s),Ke.TransformNormalToRef(s,t,o),e[a]=o.x,e[a+1]=o.y,e[a+2]=o.z,e[a+3]=o.w}static _FlipFaces(e,t=0,i=e.length){for(let r=t;r<t+i;r+=3){const s=e[r+1];e[r+1]=e[r+2],e[r+2]=s}}transform(e){const t=e.determinant()<0;return this.positions&&re._TransformVector3Coordinates(this.positions,e),this.normals&&re._TransformVector3Normals(this.normals,e),this.tangents&&re._TransformVector4Normals(this.tangents,e),t&&this.indices&&re._FlipFaces(this.indices),this}splitBasedOnMaterialID(){if(!this.materialInfos||this.materialInfos.length<2)return[this];const e=[];for(const t of this.materialInfos){const i=new re;if(this.positions&&(i.positions=this.positions.slice(t.verticesStart*3,(t.verticesCount+t.verticesStart)*3)),this.normals&&(i.normals=this.normals.slice(t.verticesStart*3,(t.verticesCount+t.verticesStart)*3)),this.tangents&&(i.tangents=this.tangents.slice(t.verticesStart*4,(t.verticesCount+t.verticesStart)*4)),this.colors&&(i.colors=this.colors.slice(t.verticesStart*4,(t.verticesCount+t.verticesStart)*4)),this.uvs&&(i.uvs=this.uvs.slice(t.verticesStart*2,(t.verticesCount+t.verticesStart)*2)),this.uvs2&&(i.uvs2=this.uvs2.slice(t.verticesStart*2,(t.verticesCount+t.verticesStart)*2)),this.uvs3&&(i.uvs3=this.uvs3.slice(t.verticesStart*2,(t.verticesCount+t.verticesStart)*2)),this.uvs4&&(i.uvs4=this.uvs4.slice(t.verticesStart*2,(t.verticesCount+t.verticesStart)*2)),this.uvs5&&(i.uvs5=this.uvs5.slice(t.verticesStart*2,(t.verticesCount+t.verticesStart)*2)),this.uvs6&&(i.uvs6=this.uvs6.slice(t.verticesStart*2,(t.verticesCount+t.verticesStart)*2)),this.matricesIndices&&(i.matricesIndices=this.matricesIndices.slice(t.verticesStart*4,(t.verticesCount+t.verticesStart)*4)),this.matricesIndicesExtra&&(i.matricesIndicesExtra=this.matricesIndicesExtra.slice(t.verticesStart*4,(t.verticesCount+t.verticesStart)*4)),this.matricesWeights&&(i.matricesWeights=this.matricesWeights.slice(t.verticesStart*4,(t.verticesCount+t.verticesStart)*4)),this.matricesWeightsExtra&&(i.matricesWeightsExtra=this.matricesWeightsExtra.slice(t.verticesStart*4,(t.verticesCount+t.verticesStart)*4)),this.indices){i.indices=[];for(let s=t.indexStart;s<t.indexStart+t.indexCount;s++)i.indices.push(this.indices[s]-t.verticesStart)}const r=new Ql;r.indexStart=0,r.indexCount=i.indices?i.indices.length:0,r.materialIndex=t.materialIndex,r.verticesStart=0,r.verticesCount=(i.positions?i.positions.length:0)/3,i.materialInfos=[r],e.push(i)}return e}merge(e,t=!1,i=!1,r=!1,s=!1){const o=Array.isArray(e)?e.map(a=>({vertexData:a})):[{vertexData:e}];return md(this._mergeCoroutine(void 0,o,t,!1,i,r,s))}*_mergeCoroutine(e,t,i=!1,r,s,o=!1,a=!1){var l,h;this._validate();let c=t.map(p=>p.vertexData),u=this;if(a)for(const p of c)p&&(p._validate(),!this.normals&&p.normals&&(this.normals=new Float32Array(this.positions.length)),!this.tangents&&p.tangents&&(this.tangents=new Float32Array(this.positions.length/3*4)),!this.uvs&&p.uvs&&(this.uvs=new Float32Array(this.positions.length/3*2)),!this.uvs2&&p.uvs2&&(this.uvs2=new Float32Array(this.positions.length/3*2)),!this.uvs3&&p.uvs3&&(this.uvs3=new Float32Array(this.positions.length/3*2)),!this.uvs4&&p.uvs4&&(this.uvs4=new Float32Array(this.positions.length/3*2)),!this.uvs5&&p.uvs5&&(this.uvs5=new Float32Array(this.positions.length/3*2)),!this.uvs6&&p.uvs6&&(this.uvs6=new Float32Array(this.positions.length/3*2)),!this.colors&&p.colors&&(this.colors=new Float32Array(this.positions.length/3*4),this.colors.fill(1)),!this.matricesIndices&&p.matricesIndices&&(this.matricesIndices=new Float32Array(this.positions.length/3*4)),!this.matricesWeights&&p.matricesWeights&&(this.matricesWeights=new Float32Array(this.positions.length/3*4)),!this.matricesIndicesExtra&&p.matricesIndicesExtra&&(this.matricesIndicesExtra=new Float32Array(this.positions.length/3*4)),!this.matricesWeightsExtra&&p.matricesWeightsExtra&&(this.matricesWeightsExtra=new Float32Array(this.positions.length/3*4)));for(const p of c)if(p){if(a)this.normals&&!p.normals&&(p.normals=new Float32Array(p.positions.length)),this.tangents&&!p.tangents&&(p.tangents=new Float32Array(p.positions.length/3*4)),this.uvs&&!p.uvs&&(p.uvs=new Float32Array(p.positions.length/3*2)),this.uvs2&&!p.uvs2&&(p.uvs2=new Float32Array(p.positions.length/3*2)),this.uvs3&&!p.uvs3&&(p.uvs3=new Float32Array(p.positions.length/3*2)),this.uvs4&&!p.uvs4&&(p.uvs4=new Float32Array(p.positions.length/3*2)),this.uvs5&&!p.uvs5&&(p.uvs5=new Float32Array(p.positions.length/3*2)),this.uvs6&&!p.uvs6&&(p.uvs6=new Float32Array(p.positions.length/3*2)),this.colors&&!p.colors&&(p.colors=new Float32Array(p.positions.length/3*4),p.colors.fill(1)),this.matricesIndices&&!p.matricesIndices&&(p.matricesIndices=new Float32Array(p.positions.length/3*4)),this.matricesWeights&&!p.matricesWeights&&(p.matricesWeights=new Float32Array(p.positions.length/3*4)),this.matricesIndicesExtra&&!p.matricesIndicesExtra&&(p.matricesIndicesExtra=new Float32Array(p.positions.length/3*4)),this.matricesWeightsExtra&&!p.matricesWeightsExtra&&(p.matricesWeightsExtra=new Float32Array(p.positions.length/3*4));else if(p._validate(),!this.normals!=!p.normals||!this.tangents!=!p.tangents||!this.uvs!=!p.uvs||!this.uvs2!=!p.uvs2||!this.uvs3!=!p.uvs3||!this.uvs4!=!p.uvs4||!this.uvs5!=!p.uvs5||!this.uvs6!=!p.uvs6||!this.colors!=!p.colors||!this.matricesIndices!=!p.matricesIndices||!this.matricesWeights!=!p.matricesWeights||!this.matricesIndicesExtra!=!p.matricesIndicesExtra||!this.matricesWeightsExtra!=!p.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes")}if(o){let p=0,g=0,m=0;const x=[];let E=null;const R=[];for(const _ of this.splitBasedOnMaterialID())R.push({vertexData:_,transform:e});for(const _ of t)if(_.vertexData)for(const T of _.vertexData.splitBasedOnMaterialID())R.push({vertexData:T,transform:_.transform});R.sort((_,T)=>{const y=_.vertexData.materialInfos?_.vertexData.materialInfos[0].materialIndex:0,P=T.vertexData.materialInfos?T.vertexData.materialInfos[0].materialIndex:0;return y>P?1:y===P?0:-1});for(const _ of R){const T=_.vertexData;if(T.materialInfos?p=T.materialInfos[0].materialIndex:p=0,E&&E.materialIndex===p)E.indexCount+=T.indices.length,E.verticesCount+=T.positions.length/3;else{const y=new Ql;y.materialIndex=p,y.indexStart=g,y.indexCount=T.indices.length,y.verticesStart=m,y.verticesCount=T.positions.length/3,x.push(y),E=y}g+=T.indices.length,m+=T.positions.length/3}const C=R.splice(0,1)[0];u=C.vertexData,e=C.transform,c=R.map(_=>_.vertexData),t=R,this.materialInfos=x}const d=c.reduce((p,g)=>{var m;return p+(((m=g.indices)==null?void 0:m.length)??0)},((l=u.indices)==null?void 0:l.length)??0);let f=s||c.some(p=>p.indices===u.indices)?(h=u.indices)==null?void 0:h.slice():u.indices;if(d>0){let p=(f==null?void 0:f.length)??0;if(f||(f=new Array(d)),f.length!==d){if(Array.isArray(f))f.length=d;else{const m=i||f instanceof Uint32Array?new Uint32Array(d):new Uint16Array(d);m.set(f),f=m}e&&e.determinant()<0&&re._FlipFaces(f,0,p)}let g=u.positions?u.positions.length/3:0;for(const{vertexData:m,transform:x}of t)if(m.indices){for(let E=0;E<m.indices.length;E++)f[p+E]=m.indices[E]+g;x&&x.determinant()<0&&re._FlipFaces(f,p,m.indices.length),g+=m.positions.length/3,p+=m.indices.length,r&&(yield)}}return this.indices=f,this.positions=re._MergeElement(b.PositionKind,u.positions,e,t.map(p=>[p.vertexData.positions,p.transform])),r&&(yield),u.normals&&(this.normals=re._MergeElement(b.NormalKind,u.normals,e,t.map(p=>[p.vertexData.normals,p.transform])),r&&(yield)),u.tangents&&(this.tangents=re._MergeElement(b.TangentKind,u.tangents,e,t.map(p=>[p.vertexData.tangents,p.transform])),r&&(yield)),u.uvs&&(this.uvs=re._MergeElement(b.UVKind,u.uvs,e,t.map(p=>[p.vertexData.uvs,p.transform])),r&&(yield)),u.uvs2&&(this.uvs2=re._MergeElement(b.UV2Kind,u.uvs2,e,t.map(p=>[p.vertexData.uvs2,p.transform])),r&&(yield)),u.uvs3&&(this.uvs3=re._MergeElement(b.UV3Kind,u.uvs3,e,t.map(p=>[p.vertexData.uvs3,p.transform])),r&&(yield)),u.uvs4&&(this.uvs4=re._MergeElement(b.UV4Kind,u.uvs4,e,t.map(p=>[p.vertexData.uvs4,p.transform])),r&&(yield)),u.uvs5&&(this.uvs5=re._MergeElement(b.UV5Kind,u.uvs5,e,t.map(p=>[p.vertexData.uvs5,p.transform])),r&&(yield)),u.uvs6&&(this.uvs6=re._MergeElement(b.UV6Kind,u.uvs6,e,t.map(p=>[p.vertexData.uvs6,p.transform])),r&&(yield)),u.colors&&(this.colors=re._MergeElement(b.ColorKind,u.colors,e,t.map(p=>[p.vertexData.colors,p.transform])),(u.hasVertexAlpha!==void 0||t.some(p=>p.vertexData.hasVertexAlpha!==void 0))&&(this.hasVertexAlpha=u.hasVertexAlpha||t.some(p=>p.vertexData.hasVertexAlpha)),r&&(yield)),u.matricesIndices&&(this.matricesIndices=re._MergeElement(b.MatricesIndicesKind,u.matricesIndices,e,t.map(p=>[p.vertexData.matricesIndices,p.transform])),r&&(yield)),u.matricesWeights&&(this.matricesWeights=re._MergeElement(b.MatricesWeightsKind,u.matricesWeights,e,t.map(p=>[p.vertexData.matricesWeights,p.transform])),r&&(yield)),u.matricesIndicesExtra&&(this.matricesIndicesExtra=re._MergeElement(b.MatricesIndicesExtraKind,u.matricesIndicesExtra,e,t.map(p=>[p.vertexData.matricesIndicesExtra,p.transform])),r&&(yield)),u.matricesWeightsExtra&&(this.matricesWeightsExtra=re._MergeElement(b.MatricesWeightsExtraKind,u.matricesWeightsExtra,e,t.map(p=>[p.vertexData.matricesWeightsExtra,p.transform]))),this}static _MergeElement(e,t,i,r){const s=r.filter(l=>l[0]!==null&&l[0]!==void 0);if(!t&&s.length==0)return t;if(!t)return this._MergeElement(e,s[0][0],s[0][1],s.slice(1));const o=s.reduce((l,h)=>l+h[0].length,t.length),a=e===b.PositionKind?re._TransformVector3Coordinates:e===b.NormalKind?re._TransformVector3Normals:e===b.TangentKind?re._TransformVector4Normals:()=>{};if(t instanceof Float32Array){const l=new Float32Array(o);l.set(t),i&&a(l,i,0,t.length);let h=t.length;for(const[c,u]of s)l.set(c,h),u&&a(l,u,h,c.length),h+=c.length;return l}else{const l=new Array(o);for(let c=0;c<t.length;c++)l[c]=t[c];i&&a(l,i,0,t.length);let h=t.length;for(const[c,u]of s){for(let d=0;d<c.length;d++)l[h+d]=c[d];u&&a(l,u,h,c.length),h+=c.length}return l}}_validate(){if(!this.positions)throw new Ho("Positions are required",kh.MeshInvalidPositionsError);const e=(r,s)=>{const o=b.DeduceStride(r);if(s.length%o!==0)throw new Error("The "+r+"s array count must be a multiple of "+o);return s.length/o},t=e(b.PositionKind,this.positions),i=(r,s)=>{const o=e(r,s);if(o!==t)throw new Error("The "+r+"s element count ("+o+") does not match the positions count ("+t+")")};this.normals&&i(b.NormalKind,this.normals),this.tangents&&i(b.TangentKind,this.tangents),this.uvs&&i(b.UVKind,this.uvs),this.uvs2&&i(b.UV2Kind,this.uvs2),this.uvs3&&i(b.UV3Kind,this.uvs3),this.uvs4&&i(b.UV4Kind,this.uvs4),this.uvs5&&i(b.UV5Kind,this.uvs5),this.uvs6&&i(b.UV6Kind,this.uvs6),this.colors&&i(b.ColorKind,this.colors),this.matricesIndices&&i(b.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&i(b.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&i(b.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&i(b.MatricesWeightsExtraKind,this.matricesWeightsExtra)}clone(){const e=this.serialize();return re.Parse(e)}serialize(){const e={};if(this.positions&&(e.positions=Array.from(this.positions)),this.normals&&(e.normals=Array.from(this.normals)),this.tangents&&(e.tangents=Array.from(this.tangents)),this.uvs&&(e.uvs=Array.from(this.uvs)),this.uvs2&&(e.uvs2=Array.from(this.uvs2)),this.uvs3&&(e.uvs3=Array.from(this.uvs3)),this.uvs4&&(e.uvs4=Array.from(this.uvs4)),this.uvs5&&(e.uvs5=Array.from(this.uvs5)),this.uvs6&&(e.uvs6=Array.from(this.uvs6)),this.colors&&(e.colors=Array.from(this.colors),e.hasVertexAlpha=this.hasVertexAlpha),this.matricesIndices&&(e.matricesIndices=Array.from(this.matricesIndices),e.matricesIndices._isExpanded=!0),this.matricesWeights&&(e.matricesWeights=Array.from(this.matricesWeights)),this.matricesIndicesExtra&&(e.matricesIndicesExtra=Array.from(this.matricesIndicesExtra),e.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(e.matricesWeightsExtra=Array.from(this.matricesWeightsExtra)),e.indices=Array.from(this.indices),this.materialInfos){e.materialInfos=[];for(const t of this.materialInfos){const i={indexStart:t.indexStart,indexCount:t.indexCount,materialIndex:t.materialIndex,verticesStart:t.verticesStart,verticesCount:t.verticesCount};e.materialInfos.push(i)}}return e}static ExtractFromMesh(e,t,i){return re._ExtractFrom(e,t,i)}static ExtractFromGeometry(e,t,i){return re._ExtractFrom(e,t,i)}static _ExtractFrom(e,t,i){const r=new re;return e.isVerticesDataPresent(b.PositionKind)&&(r.positions=e.getVerticesData(b.PositionKind,t,i)),e.isVerticesDataPresent(b.NormalKind)&&(r.normals=e.getVerticesData(b.NormalKind,t,i)),e.isVerticesDataPresent(b.TangentKind)&&(r.tangents=e.getVerticesData(b.TangentKind,t,i)),e.isVerticesDataPresent(b.UVKind)&&(r.uvs=e.getVerticesData(b.UVKind,t,i)),e.isVerticesDataPresent(b.UV2Kind)&&(r.uvs2=e.getVerticesData(b.UV2Kind,t,i)),e.isVerticesDataPresent(b.UV3Kind)&&(r.uvs3=e.getVerticesData(b.UV3Kind,t,i)),e.isVerticesDataPresent(b.UV4Kind)&&(r.uvs4=e.getVerticesData(b.UV4Kind,t,i)),e.isVerticesDataPresent(b.UV5Kind)&&(r.uvs5=e.getVerticesData(b.UV5Kind,t,i)),e.isVerticesDataPresent(b.UV6Kind)&&(r.uvs6=e.getVerticesData(b.UV6Kind,t,i)),e.isVerticesDataPresent(b.ColorKind)&&(r.colors=e.getVerticesData(b.ColorKind,t,i)),e.isVerticesDataPresent(b.MatricesIndicesKind)&&(r.matricesIndices=e.getVerticesData(b.MatricesIndicesKind,t,i)),e.isVerticesDataPresent(b.MatricesWeightsKind)&&(r.matricesWeights=e.getVerticesData(b.MatricesWeightsKind,t,i)),e.isVerticesDataPresent(b.MatricesIndicesExtraKind)&&(r.matricesIndicesExtra=e.getVerticesData(b.MatricesIndicesExtraKind,t,i)),e.isVerticesDataPresent(b.MatricesWeightsExtraKind)&&(r.matricesWeightsExtra=e.getVerticesData(b.MatricesWeightsExtraKind,t,i)),r.indices=e.getIndices(t,i),r}static CreateRibbon(e){throw Ge("ribbonBuilder")}static CreateBox(e){throw Ge("boxBuilder")}static CreateTiledBox(e){throw Ge("tiledBoxBuilder")}static CreateTiledPlane(e){throw Ge("tiledPlaneBuilder")}static CreateSphere(e){throw Ge("sphereBuilder")}static CreateCylinder(e){throw Ge("cylinderBuilder")}static CreateTorus(e){throw Ge("torusBuilder")}static CreateLineSystem(e){throw Ge("linesBuilder")}static CreateDashedLines(e){throw Ge("linesBuilder")}static CreateGround(e){throw Ge("groundBuilder")}static CreateTiledGround(e){throw Ge("groundBuilder")}static CreateGroundFromHeightMap(e){throw Ge("groundBuilder")}static CreatePlane(e){throw Ge("planeBuilder")}static CreateDisc(e){throw Ge("discBuilder")}static CreatePolygon(e,t,i,r,s,o,a){throw Ge("polygonBuilder")}static CreateIcoSphere(e){throw Ge("icoSphereBuilder")}static CreatePolyhedron(e){throw Ge("polyhedronBuilder")}static CreateCapsule(e={orientation:v.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6}){throw Ge("capsuleBuilder")}static CreateTorusKnot(e){throw Ge("torusKnotBuilder")}static ComputeNormals(e,t,i,r){let s=0,o=0,a=0,l=0,h=0,c=0,u=0,d=0,f=0,p=0,g=0,m=0,x=0,E=0,R=0,C=0,_=0,T=0,y=0,P=0,D=!1,F=!1,N=!1,G=!1,J=1,j=0,z=null;r&&(D=!!r.facetNormals,F=!!r.facetPositions,N=!!r.facetPartitioning,J=r.useRightHandedSystem===!0?-1:1,j=r.ratio||0,G=!!r.depthSort,z=r.distanceTo,G&&z===void 0&&(z=v.Zero()));let $=0,te=0,fe=0,Z=0;for(N&&r&&r.bbSize&&($=r.subDiv.X*j/r.bbSize.x,te=r.subDiv.Y*j/r.bbSize.y,fe=r.subDiv.Z*j/r.bbSize.z,Z=r.subDiv.max*r.subDiv.max,r.facetPartitioning.length=0),s=0;s<e.length;s++)i[s]=0;const L=t.length/3|0;for(s=0;s<L;s++){if(m=t[s*3]*3,x=m+1,E=m+2,R=t[s*3+1]*3,C=R+1,_=R+2,T=t[s*3+2]*3,y=T+1,P=T+2,o=e[m]-e[R],a=e[x]-e[C],l=e[E]-e[_],h=e[T]-e[R],c=e[y]-e[C],u=e[P]-e[_],d=J*(a*u-l*c),f=J*(l*h-o*u),p=J*(o*c-a*h),g=Math.sqrt(d*d+f*f+p*p),g=g===0?1:g,d/=g,f/=g,p/=g,D&&r&&(r.facetNormals[s].x=d,r.facetNormals[s].y=f,r.facetNormals[s].z=p),F&&r&&(r.facetPositions[s].x=(e[m]+e[R]+e[T])/3,r.facetPositions[s].y=(e[x]+e[C]+e[y])/3,r.facetPositions[s].z=(e[E]+e[_]+e[P])/3),N&&r){const w=Math.floor((r.facetPositions[s].x-r.bInfo.minimum.x*j)*$),H=Math.floor((r.facetPositions[s].y-r.bInfo.minimum.y*j)*te),de=Math.floor((r.facetPositions[s].z-r.bInfo.minimum.z*j)*fe),Te=Math.floor((e[m]-r.bInfo.minimum.x*j)*$),Ne=Math.floor((e[x]-r.bInfo.minimum.y*j)*te),Fe=Math.floor((e[E]-r.bInfo.minimum.z*j)*fe),ce=Math.floor((e[R]-r.bInfo.minimum.x*j)*$),ve=Math.floor((e[C]-r.bInfo.minimum.y*j)*te),Ue=Math.floor((e[_]-r.bInfo.minimum.z*j)*fe),Se=Math.floor((e[T]-r.bInfo.minimum.x*j)*$),ue=Math.floor((e[y]-r.bInfo.minimum.y*j)*te),Ze=Math.floor((e[P]-r.bInfo.minimum.z*j)*fe),_t=Te+r.subDiv.max*Ne+Z*Fe,vt=ce+r.subDiv.max*ve+Z*Ue,Ot=Se+r.subDiv.max*ue+Z*Ze,$t=w+r.subDiv.max*H+Z*de;r.facetPartitioning[$t]=r.facetPartitioning[$t]?r.facetPartitioning[$t]:new Array,r.facetPartitioning[_t]=r.facetPartitioning[_t]?r.facetPartitioning[_t]:new Array,r.facetPartitioning[vt]=r.facetPartitioning[vt]?r.facetPartitioning[vt]:new Array,r.facetPartitioning[Ot]=r.facetPartitioning[Ot]?r.facetPartitioning[Ot]:new Array,r.facetPartitioning[_t].push(s),vt!=_t&&r.facetPartitioning[vt].push(s),Ot==vt||Ot==_t||r.facetPartitioning[Ot].push(s),$t==_t||$t==vt||$t==Ot||r.facetPartitioning[$t].push(s)}if(G&&r&&r.facetPositions){const w=r.depthSortedFacets[s];w.ind=s*3,w.sqDistance=v.DistanceSquared(r.facetPositions[s],z)}i[m]+=d,i[x]+=f,i[E]+=p,i[R]+=d,i[C]+=f,i[_]+=p,i[T]+=d,i[y]+=f,i[P]+=p}for(s=0;s<i.length/3;s++)d=i[s*3],f=i[s*3+1],p=i[s*3+2],g=Math.sqrt(d*d+f*f+p*p),g=g===0?1:g,d/=g,f/=g,p/=g,i[s*3]=d,i[s*3+1]=f,i[s*3+2]=p}static _ComputeSides(e,t,i,r,s,o,a){const l=i.length,h=r.length;let c,u;switch(e=e||re.DEFAULTSIDE,e){case re.FRONTSIDE:break;case re.BACKSIDE:for(c=0;c<l;c+=3){const d=i[c];i[c]=i[c+2],i[c+2]=d}for(u=0;u<h;u++)r[u]=-r[u];break;case re.DOUBLESIDE:{const d=t.length,f=d/3;for(let m=0;m<d;m++)t[d+m]=t[m];for(c=0;c<l;c+=3)i[c+l]=i[c+2]+f,i[c+1+l]=i[c+1]+f,i[c+2+l]=i[c]+f;for(u=0;u<h;u++)r[h+u]=-r[u];const p=s.length;let g=0;for(g=0;g<p;g++)s[g+p]=s[g];for(o=o||new Ke(0,0,1,1),a=a||new Ke(0,0,1,1),g=0,c=0;c<p/2;c++)s[g]=o.x+(o.z-o.x)*s[g],s[g+1]=o.y+(o.w-o.y)*s[g+1],s[g+p]=a.x+(a.z-a.x)*s[g+p],s[g+p+1]=a.y+(a.w-a.y)*s[g+p+1],g+=2;break}}}static Parse(e){const t=new re,i=e.positions;i&&t.set(i,b.PositionKind);const r=e.normals;r&&t.set(r,b.NormalKind);const s=e.tangents;s&&t.set(s,b.TangentKind);const o=e.uvs;o&&t.set(o,b.UVKind);const a=e.uvs2;a&&t.set(a,b.UV2Kind);const l=e.uvs3;l&&t.set(l,b.UV3Kind);const h=e.uvs4;h&&t.set(h,b.UV4Kind);const c=e.uvs5;c&&t.set(c,b.UV5Kind);const u=e.uvs6;u&&t.set(u,b.UV6Kind);const d=e.colors;d&&(t.set($e.CheckColors4(d,i.length/3),b.ColorKind),e.hasVertexAlpha!==void 0&&(t.hasVertexAlpha=e.hasVertexAlpha));const f=e.matricesIndices;f&&t.set(f,b.MatricesIndicesKind);const p=e.matricesWeights;p&&t.set(p,b.MatricesWeightsKind);const g=e.indices;g&&(t.indices=g);const m=e.materialInfos;if(m){t.materialInfos=[];for(const x of m){const E=new Ql;E.indexCount=x.indexCount,E.indexStart=x.indexStart,E.verticesCount=x.verticesCount,E.verticesStart=x.verticesStart,E.materialIndex=x.materialIndex,t.materialInfos.push(E)}}return t}static ImportVertexData(e,t){const i=re.Parse(e);t.setAllVerticesData(i,e.updatable)}}re.FRONTSIDE=0;re.BACKSIDE=1;re.DOUBLESIDE=2;re.DEFAULTSIDE=0;re._UniqueIDGenerator=0;M([pn.filter((...[n])=>!Array.isArray(n))],re,"_TransformVector3Coordinates",null);M([pn.filter((...[n])=>!Array.isArray(n))],re,"_TransformVector3Normals",null);M([pn.filter((...[n])=>!Array.isArray(n))],re,"_TransformVector4Normals",null);M([pn.filter((...[n])=>!Array.isArray(n))],re,"_FlipFaces",null);class By{constructor(){this._doNotSerialize=!1,this._isDisposed=!1,this._sceneRootNodesIndex=-1,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._onEnabledStateChangedObservable=new he,this._onClonedObservable=new he}}let Oi=class Ou{static AddNodeConstructor(e,t){this._NodeConstructors[e]=t}static Construct(e,t,i,r){const s=this._NodeConstructors[e];return s?s(t,i,r):null}set accessibilityTag(e){this._accessibilityTag=e,this.onAccessibilityTagChangedObservable.notifyObservers(e)}get accessibilityTag(){return this._accessibilityTag}get doNotSerialize(){return this._nodeDataStorage._doNotSerialize?!0:this._parentNode?this._parentNode.doNotSerialize:!1}set doNotSerialize(e){this._nodeDataStorage._doNotSerialize=e}isDisposed(){return this._nodeDataStorage._isDisposed}set parent(e){if(this._parentNode===e)return;const t=this._parentNode;if(this._parentNode&&this._parentNode._children!==void 0&&this._parentNode._children!==null){const i=this._parentNode._children.indexOf(this);i!==-1&&this._parentNode._children.splice(i,1),!e&&!this._nodeDataStorage._isDisposed&&this._addToSceneRootNodes()}this._parentNode=e,this._parentNode&&((this._parentNode._children===void 0||this._parentNode._children===null)&&(this._parentNode._children=new Array),this._parentNode._children.push(this),t||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}get parent(){return this._parentNode}_serializeAsParent(e){e.parentId=this.uniqueId}_addToSceneRootNodes(){this._nodeDataStorage._sceneRootNodesIndex===-1&&(this._nodeDataStorage._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))}_removeFromSceneRootNodes(){if(this._nodeDataStorage._sceneRootNodesIndex!==-1){const e=this._scene.rootNodes,t=e.length-1;e[this._nodeDataStorage._sceneRootNodesIndex]=e[t],e[this._nodeDataStorage._sceneRootNodesIndex]._nodeDataStorage._sceneRootNodesIndex=this._nodeDataStorage._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._nodeDataStorage._sceneRootNodesIndex=-1}}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(e){this._animationPropertiesOverride=e}getClassName(){return"Node"}set onDispose(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)}get onEnabledStateChangedObservable(){return this._nodeDataStorage._onEnabledStateChangedObservable}get onClonedObservable(){return this._nodeDataStorage._onClonedObservable}constructor(e,t=null){this._isDirty=!1,this._nodeDataStorage=new By,this.state="",this.metadata=null,this.reservedDataStore=null,this._accessibilityTag=null,this.onAccessibilityTagChangedObservable=new he,this._parentContainer=null,this.animations=[],this._ranges={},this.onReady=null,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._waitingParentInstanceIndex=null,this._waitingParsedUniqueId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=U.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._animationPropertiesOverride=null,this._isNode=!0,this.onDisposeObservable=new he,this._onDisposeObserver=null,this._behaviors=new Array,this.name=e,this.id=e,this._scene=t||rt.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache()}getScene(){return this._scene}getEngine(){return this._scene.getEngine()}addBehavior(e,t=!1){return this._behaviors.indexOf(e)!==-1?this:(e.init(),this._scene.isLoading&&!t?this._scene.onDataLoadedObservable.addOnce(()=>{e.attach(this)}):e.attach(this),this._behaviors.push(e),this)}removeBehavior(e){const t=this._behaviors.indexOf(e);return t===-1?this:(this._behaviors[t].detach(),this._behaviors.splice(t,1),this)}get behaviors(){return this._behaviors}getBehaviorByName(e){for(const t of this._behaviors)if(t.name===e)return t;return null}getWorldMatrix(){return this._currentRenderId!==this._scene.getRenderId()&&this.computeWorldMatrix(),this._worldMatrix}_getWorldMatrixDeterminant(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant}get worldMatrixFromCache(){return this._worldMatrix}_initCache(){this._cache={},this._cache.parent=void 0}updateCache(e){!e&&this.isSynchronized()||(this._cache.parent=this.parent,this._updateCache())}_getActionManagerForTrigger(e,t=!0){return this.parent?this.parent._getActionManagerForTrigger(e,!1):null}_updateCache(e){}_isSynchronized(){return!0}_markSyncedWithParent(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)}isSynchronizedWithParent(){return this._parentNode?this._parentNode._isDirty||this._parentUpdateId!==this._parentNode._childUpdateId?!1:this._parentNode.isSynchronized():!0}isSynchronized(){return this._cache.parent!==this._parentNode?(this._cache.parent=this._parentNode,!1):this._parentNode&&!this.isSynchronizedWithParent()?!1:this._isSynchronized()}isReady(e=!1){return this._nodeDataStorage._isReady}markAsDirty(e){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this}isEnabled(e=!0){return e===!1?this._nodeDataStorage._isEnabled:this._nodeDataStorage._isEnabled?this._nodeDataStorage._isParentEnabled:!1}_syncParentEnabledState(){this._nodeDataStorage._isParentEnabled=this._parentNode?this._parentNode.isEnabled():!0,this._children&&this._children.forEach(e=>{e._syncParentEnabledState()})}setEnabled(e){this._nodeDataStorage._isEnabled!==e&&(this._nodeDataStorage._isEnabled=e,this._syncParentEnabledState(),this._nodeDataStorage._onEnabledStateChangedObservable.notifyObservers(e))}isDescendantOf(e){return this.parent?this.parent===e?!0:this.parent.isDescendantOf(e):!1}_getDescendants(e,t=!1,i){if(this._children)for(let r=0;r<this._children.length;r++){const s=this._children[r];(!i||i(s))&&e.push(s),t||s._getDescendants(e,!1,i)}}getDescendants(e,t){const i=[];return this._getDescendants(i,e,t),i}getChildMeshes(e,t){const i=[];return this._getDescendants(i,e,r=>(!t||t(r))&&r.cullingStrategy!==void 0),i}getChildren(e,t=!0){return this.getDescendants(t,e)}_setReady(e){if(e!==this._nodeDataStorage._isReady){if(!e){this._nodeDataStorage._isReady=!1;return}this.onReady&&this.onReady(this),this._nodeDataStorage._isReady=!0}}getAnimationByName(e){for(let t=0;t<this.animations.length;t++){const i=this.animations[t];if(i.name===e)return i}return null}createAnimationRange(e,t,i){if(!this._ranges[e]){this._ranges[e]=Ou._AnimationRangeFactory(e,t,i);for(let r=0,s=this.animations.length;r<s;r++)this.animations[r]&&this.animations[r].createRange(e,t,i)}}deleteAnimationRange(e,t=!0){for(let i=0,r=this.animations.length;i<r;i++)this.animations[i]&&this.animations[i].deleteRange(e,t);this._ranges[e]=null}getAnimationRange(e){return this._ranges[e]||null}clone(e,t,i){const r=Le.Clone(()=>new Ou(e,this.getScene()),this);if(t&&(r.parent=t),!i){const s=this.getDescendants(!0);for(let o=0;o<s.length;o++){const a=s[o];a.clone(e+"."+a.name,r)}}return r}getAnimationRanges(){const e=[];let t;for(t in this._ranges)e.push(this._ranges[t]);return e}beginAnimation(e,t,i,r){const s=this.getAnimationRange(e);return s?this._scene.beginAnimation(this,s.from,s.to,t,i,r):null}serializeAnimationRanges(){const e=[];for(const t in this._ranges){const i=this._ranges[t];if(!i)continue;const r={};r.name=t,r.from=i.from,r.to=i.to,e.push(r)}return e}computeWorldMatrix(e){return this._worldMatrix||(this._worldMatrix=U.Identity()),this._worldMatrix}dispose(e,t=!1){if(this._nodeDataStorage._isDisposed=!0,!e){const i=this.getDescendants(!0);for(const r of i)r.dispose(e,t)}this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onEnabledStateChangedObservable.clear(),this.onClonedObservable.clear();for(const i of this._behaviors)i.detach();this._behaviors.length=0,this.metadata=null}static ParseAnimationRanges(e,t,i){if(t.ranges)for(let r=0;r<t.ranges.length;r++){const s=t.ranges[r];e.createAnimationRange(s.name,s.from,s.to)}}getHierarchyBoundingVectors(e=!0,t=null){this.getScene().incrementRenderId(),this.computeWorldMatrix(!0);let i,r;const s=this;if(s.getBoundingInfo&&s.subMeshes){const o=s.getBoundingInfo();i=o.boundingBox.minimumWorld.clone(),r=o.boundingBox.maximumWorld.clone()}else i=new v(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),r=new v(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(e){const o=this.getDescendants(!1);for(const a of o){const l=a;if(l.computeWorldMatrix(!0),t&&!t(l)||!l.getBoundingInfo||l.getTotalVertices()===0)continue;const h=l.getBoundingInfo().boundingBox,c=h.minimumWorld,u=h.maximumWorld;v.CheckExtends(c,i,r),v.CheckExtends(u,i,r)}}return{min:i,max:r}}};Oi._AnimationRangeFactory=(n,e,t)=>{throw Ge("AnimationRange")};Oi._NodeConstructors={};M([V()],Oi.prototype,"name",void 0);M([V()],Oi.prototype,"id",void 0);M([V()],Oi.prototype,"uniqueId",void 0);M([V()],Oi.prototype,"state",void 0);M([V()],Oi.prototype,"metadata",void 0);var ht;(function(n){n[n.LOCAL=0]="LOCAL",n[n.WORLD=1]="WORLD",n[n.BONE=2]="BONE"})(ht||(ht={}));class Qa{}Qa.X=new v(1,0,0);Qa.Y=new v(0,1,0);Qa.Z=new v(0,0,1);var Rg;(function(n){n[n.X=0]="X",n[n.Y=1]="Y",n[n.Z=2]="Z"})(Rg||(Rg={}));const ky=U.Compose(v.One(),Re.FromEulerAngles(0,Math.PI,0),v.Zero());class He extends Oi{get billboardMode(){return this._billboardMode}set billboardMode(e){this._billboardMode!==e&&(this._billboardMode=e,this._cache.useBillboardPosition=(this._billboardMode&He.BILLBOARDMODE_USE_POSITION)!==0,this._computeUseBillboardPath())}get preserveParentRotationForBillboard(){return this._preserveParentRotationForBillboard}set preserveParentRotationForBillboard(e){e!==this._preserveParentRotationForBillboard&&(this._preserveParentRotationForBillboard=e,this._computeUseBillboardPath())}_computeUseBillboardPath(){this._cache.useBillboardPath=this._billboardMode!==He.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}get infiniteDistance(){return this._infiniteDistance}set infiniteDistance(e){this._infiniteDistance!==e&&(this._infiniteDistance=e)}constructor(e,t=null,i=!0){super(e,t),this._forward=new v(0,0,1),this._up=new v(0,1,0),this._right=new v(1,0,0),this._position=v.Zero(),this._rotation=v.Zero(),this._rotationQuaternion=null,this._scaling=v.One(),this._transformToBoneReferal=null,this._isAbsoluteSynced=!1,this._billboardMode=He.BILLBOARDMODE_NONE,this._preserveParentRotationForBillboard=!1,this.scalingDeterminant=1,this._infiniteDistance=!1,this.ignoreNonUniformScaling=!1,this.reIntegrateRotationIntoRotationQuaternion=!1,this._poseMatrix=null,this._localMatrix=U.Zero(),this._usePivotMatrix=!1,this._absolutePosition=v.Zero(),this._absoluteScaling=v.Zero(),this._absoluteRotationQuaternion=Re.Identity(),this._pivotMatrix=U.Identity(),this._postMultiplyPivotMatrix=!1,this._isWorldMatrixFrozen=!1,this._indexInSceneTransformNodesArray=-1,this.onAfterWorldMatrixUpdateObservable=new he,this._nonUniformScaling=!1,i&&this.getScene().addTransformNode(this)}getClassName(){return"TransformNode"}get position(){return this._position}set position(e){this._position=e,this._isDirty=!0}isUsingPivotMatrix(){return this._usePivotMatrix}isUsingPostMultiplyPivotMatrix(){return this._postMultiplyPivotMatrix}get rotation(){return this._rotation}set rotation(e){this._rotation=e,this._rotationQuaternion=null,this._isDirty=!0}get scaling(){return this._scaling}set scaling(e){this._scaling=e,this._isDirty=!0}get rotationQuaternion(){return this._rotationQuaternion}set rotationQuaternion(e){this._rotationQuaternion=e,e&&this._rotation.setAll(0),this._isDirty=!0}get forward(){return v.TransformNormalFromFloatsToRef(0,0,this.getScene().useRightHandedSystem?-1:1,this.getWorldMatrix(),this._forward),this._forward.normalize()}get up(){return v.TransformNormalFromFloatsToRef(0,1,0,this.getWorldMatrix(),this._up),this._up.normalize()}get right(){return v.TransformNormalFromFloatsToRef(this.getScene().useRightHandedSystem?-1:1,0,0,this.getWorldMatrix(),this._right),this._right.normalize()}updatePoseMatrix(e){return this._poseMatrix?(this._poseMatrix.copyFrom(e),this):(this._poseMatrix=e.clone(),this)}getPoseMatrix(){return this._poseMatrix||(this._poseMatrix=U.Identity()),this._poseMatrix}_isSynchronized(){const e=this._cache;return!(this._billboardMode!==e.billboardMode||this._billboardMode!==He.BILLBOARDMODE_NONE||e.pivotMatrixUpdated||this._infiniteDistance||this._position._isDirty||this._scaling._isDirty||this._rotationQuaternion&&this._rotationQuaternion._isDirty||this._rotation._isDirty)}_initCache(){super._initCache();const e=this._cache;e.localMatrixUpdated=!1,e.billboardMode=-1,e.infiniteDistance=!1,e.useBillboardPosition=!1,e.useBillboardPath=!1}get absolutePosition(){return this.getAbsolutePosition()}get absoluteScaling(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling}get absoluteRotationQuaternion(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion}setPreTransformMatrix(e){return this.setPivotMatrix(e,!1)}setPivotMatrix(e,t=!0){return this._pivotMatrix.copyFrom(e),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=t,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=U.Invert(this._pivotMatrix)),this}getPivotMatrix(){return this._pivotMatrix}instantiateHierarchy(e=null,t,i){const r=this.clone("Clone of "+(this.name||this.id),e||this.parent,!0);r&&i&&i(this,r);for(const s of this.getChildTransformNodes(!0))s.instantiateHierarchy(r,t,i);return r}freezeWorldMatrix(e=null,t=!1){return e?t?(this._rotation.setAll(0),this._rotationQuaternion=this._rotationQuaternion||Re.Identity(),e.decompose(this._scaling,this._rotationQuaternion,this._position),this.computeWorldMatrix(!0)):(this._worldMatrix=e,this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._afterComputeWorldMatrix()):(this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this}unfreezeWorldMatrix(){return this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0),this}get isWorldMatrixFrozen(){return this._isWorldMatrixFrozen}getAbsolutePosition(){return this.computeWorldMatrix(),this._absolutePosition}setAbsolutePosition(e){if(!e)return this;let t,i,r;if(e.x===void 0){if(arguments.length<3)return this;t=arguments[0],i=arguments[1],r=arguments[2]}else t=e.x,i=e.y,r=e.z;if(this.parent){const s=W.Matrix[0];this.parent.getWorldMatrix().invertToRef(s),v.TransformCoordinatesFromFloatsToRef(t,i,r,s,this.position)}else this.position.x=t,this.position.y=i,this.position.z=r;return this._absolutePosition.copyFrom(e),this}setPositionWithLocalVector(e){return this.computeWorldMatrix(),this.position=v.TransformNormal(e,this._localMatrix),this}getPositionExpressedInLocalSpace(){this.computeWorldMatrix();const e=W.Matrix[0];return this._localMatrix.invertToRef(e),v.TransformNormal(this.position,e)}locallyTranslate(e){return this.computeWorldMatrix(!0),this.position=v.TransformCoordinates(e,this._localMatrix),this}lookAt(e,t=0,i=0,r=0,s=ht.LOCAL){const o=He._LookAtVectorCache,a=s===ht.LOCAL?this.position:this.getAbsolutePosition();if(e.subtractToRef(a,o),this.setDirection(o,t,i,r),s===ht.WORLD&&this.parent)if(this.rotationQuaternion){const l=W.Matrix[0];this.rotationQuaternion.toRotationMatrix(l);const h=W.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(h),h.invert(),l.multiplyToRef(h,l),this.rotationQuaternion.fromRotationMatrix(l)}else{const l=W.Quaternion[0];Re.FromEulerVectorToRef(this.rotation,l);const h=W.Matrix[0];l.toRotationMatrix(h);const c=W.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(c),c.invert(),h.multiplyToRef(c,h),l.fromRotationMatrix(h),l.toEulerAnglesToRef(this.rotation)}return this}getDirection(e){const t=v.Zero();return this.getDirectionToRef(e,t),t}getDirectionToRef(e,t){return v.TransformNormalToRef(e,this.getWorldMatrix(),t),this}setDirection(e,t=0,i=0,r=0){const s=-Math.atan2(e.z,e.x)+Math.PI/2,o=Math.sqrt(e.x*e.x+e.z*e.z),a=-Math.atan2(e.y,o);return this.rotationQuaternion?Re.RotationYawPitchRollToRef(s+t,a+i,r,this.rotationQuaternion):(this.rotation.x=a+i,this.rotation.y=s+t,this.rotation.z=r),this}setPivotPoint(e,t=ht.LOCAL){this.getScene().getRenderId()==0&&this.computeWorldMatrix(!0);const i=this.getWorldMatrix();if(t==ht.WORLD){const r=W.Matrix[0];i.invertToRef(r),e=v.TransformCoordinates(e,r)}return this.setPivotMatrix(U.Translation(-e.x,-e.y,-e.z),!0)}getPivotPoint(){const e=v.Zero();return this.getPivotPointToRef(e),e}getPivotPointToRef(e){return e.x=-this._pivotMatrix.m[12],e.y=-this._pivotMatrix.m[13],e.z=-this._pivotMatrix.m[14],this}getAbsolutePivotPoint(){const e=v.Zero();return this.getAbsolutePivotPointToRef(e),e}getAbsolutePivotPointToRef(e){return this.getPivotPointToRef(e),v.TransformCoordinatesToRef(e,this.getWorldMatrix(),e),this}markAsDirty(e){if(this._isDirty)return this;if(this._children)for(const t of this._children)t.markAsDirty(e);return super.markAsDirty(e)}setParent(e,t=!1,i=!1){if(!e&&!this.parent)return this;const r=W.Quaternion[0],s=W.Vector3[0],o=W.Vector3[1],a=W.Matrix[1];U.IdentityToRef(a);const l=W.Matrix[0];this.computeWorldMatrix(!0);let h=this.rotationQuaternion;return h||(h=He._TmpRotation,Re.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,h)),U.ComposeToRef(this.scaling,h,this.position,l),this.parent&&l.multiplyToRef(this.parent.computeWorldMatrix(!0),l),e&&(e.computeWorldMatrix(!0).invertToRef(a),l.multiplyToRef(a,l)),l.decompose(o,r,s,t?this:void 0),this.rotationQuaternion?this.rotationQuaternion.copyFrom(r):r.toEulerAnglesToRef(this.rotation),this.scaling.copyFrom(o),this.position.copyFrom(s),this.parent=e,i&&this.setPivotMatrix(U.Identity()),this}get nonUniformScaling(){return this._nonUniformScaling}_updateNonUniformScalingState(e){return this._nonUniformScaling===e?!1:(this._nonUniformScaling=e,!0)}attachToBone(e,t){return this._currentParentWhenAttachingToBone=this.parent,this._transformToBoneReferal=t,this.parent=e,e.getSkeleton().prepare(!0),e.getFinalMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this}detachFromBone(e=!1){return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,e?this.parent=this._currentParentWhenAttachingToBone:this.parent=null,this):(e&&(this.parent=this._currentParentWhenAttachingToBone),this)}rotate(e,t,i){e.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.setAll(0));let r;if(!i||i===ht.LOCAL)r=Re.RotationAxisToRef(e,t,He._RotationAxisCache),this.rotationQuaternion.multiplyToRef(r,this.rotationQuaternion);else{if(this.parent){const s=this.parent.getWorldMatrix(),o=W.Matrix[0];s.invertToRef(o),e=v.TransformNormal(e,o),s.determinant()<0&&(t*=-1)}r=Re.RotationAxisToRef(e,t,He._RotationAxisCache),r.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}return this}rotateAround(e,t,i){t.normalize(),this.rotationQuaternion||(this.rotationQuaternion=Re.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.setAll(0));const r=W.Vector3[0],s=W.Vector3[1],o=W.Vector3[2],a=W.Quaternion[0],l=W.Matrix[0],h=W.Matrix[1],c=W.Matrix[2],u=W.Matrix[3];return e.subtractToRef(this.position,r),U.TranslationToRef(r.x,r.y,r.z,l),U.TranslationToRef(-r.x,-r.y,-r.z,h),U.RotationAxisToRef(t,i,c),h.multiplyToRef(c,u),u.multiplyToRef(l,u),u.decompose(s,a,o),this.position.addInPlace(o),a.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this}translate(e,t,i){const r=e.scale(t);if(!i||i===ht.LOCAL){const s=this.getPositionExpressedInLocalSpace().add(r);this.setPositionWithLocalVector(s)}else this.setAbsolutePosition(this.getAbsolutePosition().add(r));return this}addRotation(e,t,i){let r;this.rotationQuaternion?r=this.rotationQuaternion:(r=W.Quaternion[1],Re.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,r));const s=W.Quaternion[0];return Re.RotationYawPitchRollToRef(t,e,i,s),r.multiplyInPlace(s),this.rotationQuaternion||r.toEulerAnglesToRef(this.rotation),this}_getEffectiveParent(){return this.parent}isWorldMatrixCameraDependent(){return this._infiniteDistance&&!this.parent||this._billboardMode!==He.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}computeWorldMatrix(e=!1,t=null){if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;const i=this.getScene().getRenderId();if(!this._isDirty&&!e&&(this._currentRenderId===i||this.isSynchronized()))return this._currentRenderId=i,this._worldMatrix;t=t||this.getScene().activeCamera,this._updateCache();const r=this._cache;r.pivotMatrixUpdated=!1,r.billboardMode=this.billboardMode,r.infiniteDistance=this.infiniteDistance,r.parent=this._parentNode,this._currentRenderId=i,this._childUpdateId+=1,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;const s=this._getEffectiveParent(),o=He._TmpScaling;let a=this._position;if(this._infiniteDistance&&!this.parent&&t){const h=t.getWorldMatrix(),c=new v(h.m[12],h.m[13],h.m[14]);a=He._TmpTranslation,a.copyFromFloats(this._position.x+c.x,this._position.y+c.y,this._position.z+c.z)}o.copyFromFloats(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant);let l;if(this._rotationQuaternion?(this._rotationQuaternion._isDirty=!1,l=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion&&this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(Re.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.copyFromFloats(0,0,0))):(l=He._TmpRotation,Re.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,l)),this._usePivotMatrix){const h=W.Matrix[1];U.ScalingToRef(o.x,o.y,o.z,h);const c=W.Matrix[0];l.toRotationMatrix(c),this._pivotMatrix.multiplyToRef(h,W.Matrix[4]),W.Matrix[4].multiplyToRef(c,this._localMatrix),this._postMultiplyPivotMatrix&&this._localMatrix.multiplyToRef(this._pivotMatrixInverse,this._localMatrix),this._localMatrix.addTranslationFromFloats(a.x,a.y,a.z)}else U.ComposeToRef(o,l,a,this._localMatrix);if(s&&s.getWorldMatrix){if(e&&s.computeWorldMatrix(e),r.useBillboardPath){if(this._transformToBoneReferal){const d=this.parent;d.getSkeleton().prepare(),d.getFinalMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),W.Matrix[7])}else W.Matrix[7].copyFrom(s.getWorldMatrix());const h=W.Vector3[5],c=W.Vector3[6],u=W.Quaternion[0];W.Matrix[7].decompose(c,u,h),U.ScalingToRef(c.x,c.y,c.z,W.Matrix[7]),W.Matrix[7].setTranslation(h),He.BillboardUseParentOrientation&&(this._position.applyRotationQuaternionToRef(u,h),this._localMatrix.setTranslation(h)),this._localMatrix.multiplyToRef(W.Matrix[7],this._worldMatrix)}else if(this._transformToBoneReferal){const h=this.parent;h.getSkeleton().prepare(),this._localMatrix.multiplyToRef(h.getFinalMatrix(),W.Matrix[6]),W.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)}else this._localMatrix.multiplyToRef(s.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.copyFrom(this._localMatrix);if(r.useBillboardPath&&t&&this.billboardMode&&!r.useBillboardPosition){const h=W.Vector3[0];if(this._worldMatrix.getTranslationToRef(h),W.Matrix[1].copyFrom(t.getViewMatrix()),this._scene.useRightHandedSystem&&W.Matrix[1].multiplyToRef(ky,W.Matrix[1]),W.Matrix[1].setTranslationFromFloats(0,0,0),W.Matrix[1].invertToRef(W.Matrix[0]),(this.billboardMode&He.BILLBOARDMODE_ALL)!==He.BILLBOARDMODE_ALL){W.Matrix[0].decompose(void 0,W.Quaternion[0],void 0);const c=W.Vector3[1];W.Quaternion[0].toEulerAnglesToRef(c),(this.billboardMode&He.BILLBOARDMODE_X)!==He.BILLBOARDMODE_X&&(c.x=0),(this.billboardMode&He.BILLBOARDMODE_Y)!==He.BILLBOARDMODE_Y&&(c.y=0),(this.billboardMode&He.BILLBOARDMODE_Z)!==He.BILLBOARDMODE_Z&&(c.z=0),U.RotationYawPitchRollToRef(c.y,c.x,c.z,W.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(W.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(W.Vector3[0])}else if(r.useBillboardPath&&t&&r.useBillboardPosition){const h=W.Vector3[0];this._worldMatrix.getTranslationToRef(h);const c=t.globalPosition;this._worldMatrix.invertToRef(W.Matrix[1]);const u=W.Vector3[1];v.TransformCoordinatesToRef(c,W.Matrix[1],u),u.normalize();const d=-Math.atan2(u.z,u.x)+Math.PI/2,f=Math.sqrt(u.x*u.x+u.z*u.z),p=-Math.atan2(u.y,f);if(Re.RotationYawPitchRollToRef(d,p,0,W.Quaternion[0]),(this.billboardMode&He.BILLBOARDMODE_ALL)!==He.BILLBOARDMODE_ALL){const g=W.Vector3[1];W.Quaternion[0].toEulerAnglesToRef(g),(this.billboardMode&He.BILLBOARDMODE_X)!==He.BILLBOARDMODE_X&&(g.x=0),(this.billboardMode&He.BILLBOARDMODE_Y)!==He.BILLBOARDMODE_Y&&(g.y=0),(this.billboardMode&He.BILLBOARDMODE_Z)!==He.BILLBOARDMODE_Z&&(g.z=0),U.RotationYawPitchRollToRef(g.y,g.x,g.z,W.Matrix[0])}else U.FromQuaternionToRef(W.Quaternion[0],W.Matrix[0]);this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(W.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(W.Vector3[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):s&&s._nonUniformScaling?this._updateNonUniformScalingState(s._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=U.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix}resetLocalMatrix(e=!0){if(this.computeWorldMatrix(),e){const t=this.getChildren();for(let i=0;i<t.length;++i){const r=t[i];if(r){r.computeWorldMatrix();const s=W.Matrix[0];r._localMatrix.multiplyToRef(this._localMatrix,s);const o=W.Quaternion[0];s.decompose(r.scaling,o,r.position),r.rotationQuaternion?r.rotationQuaternion.copyFrom(o):o.toEulerAnglesToRef(r.rotation)}}}this.scaling.copyFromFloats(1,1,1),this.position.copyFromFloats(0,0,0),this.rotation.copyFromFloats(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=Re.Identity()),this._worldMatrix=U.Identity()}_afterComputeWorldMatrix(){}registerAfterWorldMatrixUpdate(e){return this.onAfterWorldMatrixUpdateObservable.add(e),this}unregisterAfterWorldMatrixUpdate(e){return this.onAfterWorldMatrixUpdateObservable.removeCallback(e),this}getPositionInCameraSpace(e=null){return e||(e=this.getScene().activeCamera),v.TransformCoordinates(this.getAbsolutePosition(),e.getViewMatrix())}getDistanceToCamera(e=null){return e||(e=this.getScene().activeCamera),this.getAbsolutePosition().subtract(e.globalPosition).length()}clone(e,t,i){const r=Le.Clone(()=>new He(e,this.getScene()),this);if(r.name=e,r.id=e,t&&(r.parent=t),!i){const s=this.getDescendants(!0);for(let o=0;o<s.length;o++){const a=s[o];a.clone&&a.clone(e+"."+a.name,r)}}return r}serialize(e){const t=Le.Serialize(this,e);return t.type=this.getClassName(),t.uniqueId=this.uniqueId,this.parent&&this.parent._serializeAsParent(t),t.localMatrix=this.getPivotMatrix().asArray(),t.isEnabled=this.isEnabled(),Le.AppendSerializedAnimations(this,t),t.ranges=this.serializeAnimationRanges(),t}static Parse(e,t,i){const r=Le.Parse(()=>new He(e.name,t),e,t,i);if(e.localMatrix?r.setPreTransformMatrix(U.FromArray(e.localMatrix)):e.pivotMatrix&&r.setPivotMatrix(U.FromArray(e.pivotMatrix)),r.setEnabled(e.isEnabled),r._waitingParsedUniqueId=e.uniqueId,e.parentId!==void 0&&(r._waitingParentId=e.parentId),e.parentInstanceIndex!==void 0&&(r._waitingParentInstanceIndex=e.parentInstanceIndex),e.animations){for(let s=0;s<e.animations.length;s++){const o=e.animations[s],a=Er("BABYLON.Animation");a&&r.animations.push(a.Parse(o))}Oi.ParseAnimationRanges(r,e,t)}return e.autoAnimate&&t.beginAnimation(r,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),r}getChildTransformNodes(e,t){const i=[];return this._getDescendants(i,e,r=>(!t||t(r))&&r instanceof He),i}dispose(e,t=!1){if(this.getScene().stopAnimation(this),this.getScene().removeTransformNode(this),this._parentContainer){const i=this._parentContainer.transformNodes.indexOf(this);i>-1&&this._parentContainer.transformNodes.splice(i,1),this._parentContainer=null}if(this.onAfterWorldMatrixUpdateObservable.clear(),e){const i=this.getChildTransformNodes(!0);for(const r of i)r.parent=null,r.computeWorldMatrix(!0)}super.dispose(e,t)}normalizeToUnitCube(e=!0,t=!1,i){let r=null,s=null;t&&(this.rotationQuaternion?(s=this.rotationQuaternion.clone(),this.rotationQuaternion.copyFromFloats(0,0,0,1)):this.rotation&&(r=this.rotation.clone(),this.rotation.copyFromFloats(0,0,0)));const o=this.getHierarchyBoundingVectors(e,i),a=o.max.subtract(o.min),l=Math.max(a.x,a.y,a.z);if(l===0)return this;const h=1/l;return this.scaling.scaleInPlace(h),t&&(this.rotationQuaternion&&s?this.rotationQuaternion.copyFrom(s):this.rotation&&r&&this.rotation.copyFrom(r)),this}_syncAbsoluteScalingAndRotation(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)}}He.BILLBOARDMODE_NONE=0;He.BILLBOARDMODE_X=1;He.BILLBOARDMODE_Y=2;He.BILLBOARDMODE_Z=4;He.BILLBOARDMODE_ALL=7;He.BILLBOARDMODE_USE_POSITION=128;He.BillboardUseParentOrientation=!1;He._TmpRotation=Re.Zero();He._TmpScaling=v.Zero();He._TmpTranslation=v.Zero();He._LookAtVectorCache=new v(0,0,0);He._RotationAxisCache=new Re;M([mn("position")],He.prototype,"_position",void 0);M([mn("rotation")],He.prototype,"_rotation",void 0);M([Ry("rotationQuaternion")],He.prototype,"_rotationQuaternion",void 0);M([mn("scaling")],He.prototype,"_scaling",void 0);M([V("billboardMode")],He.prototype,"_billboardMode",void 0);M([V()],He.prototype,"scalingDeterminant",void 0);M([V("infiniteDistance")],He.prototype,"_infiniteDistance",void 0);M([V()],He.prototype,"ignoreNonUniformScaling",void 0);M([V()],He.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0);class zy{constructor(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new v(0,0,0),this._diffPositionForCollisions=new v(0,0,0),this._collisionResponse=!0}}class Gy{constructor(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=v.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1}}class Wy{constructor(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new Gy,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=null,this._currentLODIsUpToDate=!1,this._collisionRetryCount=3,this._morphTargetManager=null,this._renderingGroupId=0,this._bakedVertexAnimationManager=null,this._material=null,this._positions=null,this._pointerOverDisableMeshTesting=!1,this._meshCollisionData=new zy,this._enableDistantPicking=!1,this._rawBoundingInfo=null}}class nr extends He{static get BILLBOARDMODE_NONE(){return He.BILLBOARDMODE_NONE}static get BILLBOARDMODE_X(){return He.BILLBOARDMODE_X}static get BILLBOARDMODE_Y(){return He.BILLBOARDMODE_Y}static get BILLBOARDMODE_Z(){return He.BILLBOARDMODE_Z}static get BILLBOARDMODE_ALL(){return He.BILLBOARDMODE_ALL}static get BILLBOARDMODE_USE_POSITION(){return He.BILLBOARDMODE_USE_POSITION}get facetNb(){return this._internalAbstractMeshDataInfo._facetData.facetNb}get partitioningSubdivisions(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions}set partitioningSubdivisions(e){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=e}get partitioningBBoxRatio(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio}set partitioningBBoxRatio(e){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=e}get mustDepthSortFacets(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort}set mustDepthSortFacets(e){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=e}get facetDepthSortFrom(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom}set facetDepthSortFrom(e){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=e}get collisionRetryCount(){return this._internalAbstractMeshDataInfo._collisionRetryCount}set collisionRetryCount(e){this._internalAbstractMeshDataInfo._collisionRetryCount=e}get isFacetDataEnabled(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled}get morphTargetManager(){return this._internalAbstractMeshDataInfo._morphTargetManager}set morphTargetManager(e){this._internalAbstractMeshDataInfo._morphTargetManager!==e&&(this._internalAbstractMeshDataInfo._morphTargetManager=e,this._syncGeometryWithMorphTargetManager())}get bakedVertexAnimationManager(){return this._internalAbstractMeshDataInfo._bakedVertexAnimationManager}set bakedVertexAnimationManager(e){this._internalAbstractMeshDataInfo._bakedVertexAnimationManager!==e&&(this._internalAbstractMeshDataInfo._bakedVertexAnimationManager=e,this._markSubMeshesAsAttributesDirty())}_syncGeometryWithMorphTargetManager(){}_updateNonUniformScalingState(e){return super._updateNonUniformScalingState(e)?(this._markSubMeshesAsMiscDirty(),!0):!1}get rawBoundingInfo(){return this._internalAbstractMeshDataInfo._rawBoundingInfo}set rawBoundingInfo(e){this._internalAbstractMeshDataInfo._rawBoundingInfo=e}set onCollide(e){this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver=this.onCollideObservable.add(e)}set onCollisionPositionChange(e){this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(e)}get visibility(){return this._internalAbstractMeshDataInfo._visibility}set visibility(e){if(this._internalAbstractMeshDataInfo._visibility===e)return;const t=this._internalAbstractMeshDataInfo._visibility;this._internalAbstractMeshDataInfo._visibility=e,(t===1&&e!==1||t!==1&&e===1)&&this._markSubMeshesAsDirty(i=>{i.markAsMiscDirty(),i.markAsPrePassDirty()})}get pointerOverDisableMeshTesting(){return this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting}set pointerOverDisableMeshTesting(e){this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting=e}get renderingGroupId(){return this._internalAbstractMeshDataInfo._renderingGroupId}set renderingGroupId(e){this._internalAbstractMeshDataInfo._renderingGroupId=e}get material(){return this._internalAbstractMeshDataInfo._material}set material(e){this._internalAbstractMeshDataInfo._material!==e&&(this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._material=e,e&&e.meshMap&&(e.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.subMeshes&&(this.resetDrawCache(),this._unBindEffect()))}getMaterialForRenderPass(e){var t;return(t=this._internalAbstractMeshDataInfo._materialForRenderPass)==null?void 0:t[e]}setMaterialForRenderPass(e,t){this.resetDrawCache(e),this._internalAbstractMeshDataInfo._materialForRenderPass||(this._internalAbstractMeshDataInfo._materialForRenderPass=[]),this._internalAbstractMeshDataInfo._materialForRenderPass[e]=t}get receiveShadows(){return this._internalAbstractMeshDataInfo._receiveShadows}set receiveShadows(e){this._internalAbstractMeshDataInfo._receiveShadows!==e&&(this._internalAbstractMeshDataInfo._receiveShadows=e,this._markSubMeshesAsLightDirty())}get hasVertexAlpha(){return this._internalAbstractMeshDataInfo._hasVertexAlpha}set hasVertexAlpha(e){this._internalAbstractMeshDataInfo._hasVertexAlpha!==e&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=e,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())}get useVertexColors(){return this._internalAbstractMeshDataInfo._useVertexColors}set useVertexColors(e){this._internalAbstractMeshDataInfo._useVertexColors!==e&&(this._internalAbstractMeshDataInfo._useVertexColors=e,this._markSubMeshesAsAttributesDirty())}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(e){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==e&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=e,this._markSubMeshesAsAttributesDirty())}get numBoneInfluencers(){return this._internalAbstractMeshDataInfo._numBoneInfluencers}set numBoneInfluencers(e){this._internalAbstractMeshDataInfo._numBoneInfluencers!==e&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=e,this._markSubMeshesAsAttributesDirty())}get applyFog(){return this._internalAbstractMeshDataInfo._applyFog}set applyFog(e){this._internalAbstractMeshDataInfo._applyFog!==e&&(this._internalAbstractMeshDataInfo._applyFog=e,this._markSubMeshesAsMiscDirty())}get enableDistantPicking(){return this._internalAbstractMeshDataInfo._enableDistantPicking}set enableDistantPicking(e){this._internalAbstractMeshDataInfo._enableDistantPicking=e}get layerMask(){return this._internalAbstractMeshDataInfo._layerMask}set layerMask(e){e!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=e,this._resyncLightSources())}get collisionMask(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask}set collisionMask(e){this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask=isNaN(e)?-1:e}get collisionResponse(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse}set collisionResponse(e){this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse=e}get collisionGroup(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup}set collisionGroup(e){this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup=isNaN(e)?-1:e}get surroundingMeshes(){return this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes}set surroundingMeshes(e){this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes=e}get lightSources(){return this._lightSources}get _positions(){return null}set skeleton(e){const t=this._internalAbstractMeshDataInfo._skeleton;t&&t.needInitialSkinMatrix&&t._unregisterMeshWithPoseMatrix(this),e&&e.needInitialSkinMatrix&&e._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=e,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()}get skeleton(){return this._internalAbstractMeshDataInfo._skeleton}constructor(e,t=null){switch(super(e,t,!1),this._internalAbstractMeshDataInfo=new Wy,this._waitingMaterialId=null,this.cullingStrategy=nr.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY,this.onCollideObservable=new he,this.onCollisionPositionChangeObservable=new he,this.onMaterialChangedObservable=new he,this.definedFacingForward=!0,this._occlusionQuery=null,this._renderingGroup=null,this.alphaIndex=Number.MAX_VALUE,this.isVisible=!0,this.isPickable=!0,this.isNearPickable=!1,this.isNearGrabbable=!1,this.showSubMeshesBoundingBox=!1,this.isBlocker=!1,this.enablePointerMoveEvents=!1,this.outlineColor=De.Red(),this.outlineWidth=.02,this.overlayColor=De.Red(),this.overlayAlpha=.5,this.useOctreeForRenderingSelection=!0,this.useOctreeForPicking=!0,this.useOctreeForCollisions=!0,this.alwaysSelectAsActiveMesh=!1,this.doNotSyncBoundingInfo=!1,this.actionManager=null,this.ellipsoid=new v(.5,1,.5),this.ellipsoidOffset=new v(0,0,0),this.edgesWidth=1,this.edgesColor=new $e(1,0,0,1),this._edgesRenderer=null,this._masterMesh=null,this._boundingInfo=null,this._boundingInfoIsDirty=!0,this._renderId=0,this._intersectionsInProgress=new Array,this._unIndexed=!1,this._lightSources=new Array,this._waitingData={lods:null,actions:null,freezeWorldMatrix:null},this._bonesTransformMatrices=null,this._transformMatrixTexture=null,this.onRebuildObservable=new he,this._onCollisionPositionChange=(i,r,s=null)=>{r.subtractToRef(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,this._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),this._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions.length()>se.CollisionsEpsilon&&this.position.addInPlace(this._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),s&&this.onCollideObservable.notifyObservers(s),this.onCollisionPositionChangeObservable.notifyObservers(this.position)},t=this.getScene(),t.addMesh(this),this._resyncLightSources(),this._uniformBuffer=new Ie(this.getScene().getEngine(),void 0,void 0,e,!this.getScene().getEngine().isWebGPU),this._buildUniformLayout(),t.performancePriority){case vs.Aggressive:this.doNotSyncBoundingInfo=!0;case vs.Intermediate:this.alwaysSelectAsActiveMesh=!0,this.isPickable=!1;break}}_buildUniformLayout(){this._uniformBuffer.addUniform("world",16),this._uniformBuffer.addUniform("visibility",1),this._uniformBuffer.create()}transferToEffect(e){const t=this._uniformBuffer;t.updateMatrix("world",e),t.updateFloat("visibility",this._internalAbstractMeshDataInfo._visibility),t.update()}getMeshUniformBuffer(){return this._uniformBuffer}getClassName(){return"AbstractMesh"}toString(e){let t="Name: "+this.name+", isInstance: "+(this.getClassName()!=="InstancedMesh"?"YES":"NO");t+=", # of submeshes: "+(this.subMeshes?this.subMeshes.length:0);const i=this._internalAbstractMeshDataInfo._skeleton;return i&&(t+=", skeleton: "+i.name),e&&(t+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],t+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.freezeWorldMatrix?"YES":"NO")),t}_getEffectiveParent(){return this._masterMesh&&this.billboardMode!==He.BILLBOARDMODE_NONE?this._masterMesh:super._getEffectiveParent()}_getActionManagerForTrigger(e,t=!0){if(this.actionManager&&(t||this.actionManager.isRecursive))if(e){if(this.actionManager.hasSpecificTrigger(e))return this.actionManager}else return this.actionManager;return this.parent?this.parent._getActionManagerForTrigger(e,!1):null}_rebuild(e=!1){if(this.onRebuildObservable.notifyObservers(this),this._occlusionQuery!==null&&(this._occlusionQuery=null),!!this.subMeshes){for(const t of this.subMeshes)t._rebuild();this.resetDrawCache()}}_resyncLightSources(){this._lightSources.length=0;for(const e of this.getScene().lights)e.isEnabled()&&e.canAffectMesh(this)&&this._lightSources.push(e);this._markSubMeshesAsLightDirty()}_resyncLightSource(e){const t=e.isEnabled()&&e.canAffectMesh(this),i=this._lightSources.indexOf(e);let r=!1;if(i===-1){if(!t)return;this._lightSources.push(e)}else{if(t)return;r=!0,this._lightSources.splice(i,1)}this._markSubMeshesAsLightDirty(r)}_unBindEffect(){for(const e of this.subMeshes)e.setEffect(null)}_removeLightSource(e,t){const i=this._lightSources.indexOf(e);i!==-1&&(this._lightSources.splice(i,1),this._markSubMeshesAsLightDirty(t))}_markSubMeshesAsDirty(e){if(this.subMeshes)for(const t of this.subMeshes)for(let i=0;i<t._drawWrappers.length;++i){const r=t._drawWrappers[i];!r||!r.defines||!r.defines.markAllAsDirty||e(r.defines)}}_markSubMeshesAsLightDirty(e=!1){this._markSubMeshesAsDirty(t=>t.markAsLightDirty(e))}_markSubMeshesAsAttributesDirty(){this._markSubMeshesAsDirty(e=>e.markAsAttributesDirty())}_markSubMeshesAsMiscDirty(){this._markSubMeshesAsDirty(e=>e.markAsMiscDirty())}markAsDirty(e){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this}resetDrawCache(e){if(this.subMeshes)for(const t of this.subMeshes)t.resetDrawCache(e)}get isBlocked(){return!1}getLOD(e){return this}getTotalVertices(){return 0}getTotalIndices(){return 0}getIndices(){return null}getVerticesData(e){return null}setVerticesData(e,t,i,r){return this}updateVerticesData(e,t,i,r){return this}setIndices(e,t){return this}isVerticesDataPresent(e){return!1}getBoundingInfo(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfoIsDirty&&(this._boundingInfoIsDirty=!1,this._updateBoundingInfo()),this._boundingInfo)}getRawBoundingInfo(){return this.rawBoundingInfo??this.getBoundingInfo()}setBoundingInfo(e){return this._boundingInfo=e,this}get hasBoundingInfo(){return this._boundingInfo!==null}buildBoundingInfo(e,t,i){return this._boundingInfo=new br(e,t,i),this._boundingInfo}normalizeToUnitCube(e=!0,t=!1,i){return super.normalizeToUnitCube(e,t,i)}get useBones(){return this.skeleton&&this.getScene().skeletonsEnabled&&this.isVerticesDataPresent(b.MatricesIndicesKind)&&this.isVerticesDataPresent(b.MatricesWeightsKind)}_preActivate(){}_preActivateForIntermediateRendering(e){}_activate(e,t){return this._renderId=e,!0}_postActivate(){}_freeze(){}_unFreeze(){}getWorldMatrix(){return this._masterMesh&&this.billboardMode===He.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():super.getWorldMatrix()}_getWorldMatrixDeterminant(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():super._getWorldMatrixDeterminant()}get isAnInstance(){return!1}get hasInstances(){return!1}get hasThinInstances(){return!1}movePOV(e,t,i){return this.position.addInPlace(this.calcMovePOV(e,t,i)),this}calcMovePOV(e,t,i){const r=new U;(this.rotationQuaternion?this.rotationQuaternion:Re.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(r);const s=v.Zero(),o=this.definedFacingForward?-1:1;return v.TransformCoordinatesFromFloatsToRef(e*o,t,i*o,r,s),s}rotatePOV(e,t,i){return this.rotation.addInPlace(this.calcRotatePOV(e,t,i)),this}calcRotatePOV(e,t,i){const r=this.definedFacingForward?1:-1;return new v(e*r,t,i*r)}refreshBoundingInfo(e=!1,t=!1){return this._boundingInfo&&this._boundingInfo.isLocked?this:(this._refreshBoundingInfo(this._getPositionData(e,t),null),this)}_refreshBoundingInfo(e,t){if(e){const i=Ra(e,0,this.getTotalVertices(),t);this._boundingInfo?this._boundingInfo.reConstruct(i.minimum,i.maximum):this._boundingInfo=new br(i.minimum,i.maximum)}if(this.subMeshes)for(let i=0;i<this.subMeshes.length;i++)this.subMeshes[i].refreshBoundingInfo(e);this._updateBoundingInfo()}_getData(e=!1,t=!1,i,r=b.PositionKind){if(i=i??this.getVerticesData(r).slice(),i&&t&&this.morphTargetManager){let s=0,o=0;for(let a=0;a<i.length;a++){let l=i[a];for(let h=0;h<this.morphTargetManager.numTargets;h++){const c=this.morphTargetManager.getTarget(h),u=c.influence;if(u!==0){let d=null;switch(r){case b.PositionKind:d=c.getPositions();break;case b.NormalKind:d=c.getNormals();break;case b.TangentKind:d=c.getTangents();break;case b.UVKind:d=c.getUVs();break}d&&(l+=(d[a]-i[a])*u)}}if(i[a]=l,s++,r===b.PositionKind&&this._positions&&s===3){s=0;const h=o*3;this._positions[o++].copyFromFloats(i[h],i[h+1],i[h+2])}}}if(i&&e&&this.skeleton){const s=this.getVerticesData(b.MatricesIndicesKind),o=this.getVerticesData(b.MatricesWeightsKind);if(o&&s){const a=this.numBoneInfluencers>4,l=a?this.getVerticesData(b.MatricesIndicesExtraKind):null,h=a?this.getVerticesData(b.MatricesWeightsExtraKind):null,c=this.skeleton.getTransformMatrices(this),u=W.Vector3[0],d=W.Matrix[0],f=W.Matrix[1];let p=0;for(let g=0;g<i.length;g+=3,p+=4){d.reset();let m,x;for(m=0;m<4;m++)x=o[p+m],x>0&&(U.FromFloat32ArrayToRefScaled(c,Math.floor(s[p+m]*16),x,f),d.addToSelf(f));if(a)for(m=0;m<4;m++)x=h[p+m],x>0&&(U.FromFloat32ArrayToRefScaled(c,Math.floor(l[p+m]*16),x,f),d.addToSelf(f));r===b.NormalKind?v.TransformNormalFromFloatsToRef(i[g],i[g+1],i[g+2],d,u):v.TransformCoordinatesFromFloatsToRef(i[g],i[g+1],i[g+2],d,u),u.toArray(i,g),r===b.PositionKind&&this._positions&&this._positions[g/3].copyFrom(u)}}}return i}getNormalsData(e=!1,t=!1){return this._getData(e,t,null,b.NormalKind)}getPositionData(e=!1,t=!1,i){return this._getData(e,t,i,b.PositionKind)}_getPositionData(e,t){var i;let r=this.getVerticesData(b.PositionKind);if(this._internalAbstractMeshDataInfo._positions&&(this._internalAbstractMeshDataInfo._positions=null),r&&(e&&this.skeleton||t&&this.morphTargetManager)){if(r=r.slice(),this._generatePointsArray(),this._positions){const s=this._positions;this._internalAbstractMeshDataInfo._positions=new Array(s.length);for(let o=0;o<s.length;o++)this._internalAbstractMeshDataInfo._positions[o]=((i=s[o])==null?void 0:i.clone())||new v}return this.getPositionData(e,t,r)}return r}_updateBoundingInfo(){return this._boundingInfo?this._boundingInfo.update(this.worldMatrixFromCache):this._boundingInfo=new br(v.Zero(),v.Zero(),this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}_updateSubMeshesBoundingInfo(e){if(!this.subMeshes)return this;const t=this.subMeshes.length;for(let i=0;i<t;i++){const r=this.subMeshes[i];(t>1||!r.IsGlobal)&&r.updateBoundingInfo(e)}return this}_afterComputeWorldMatrix(){this.doNotSyncBoundingInfo||(this._boundingInfoIsDirty=!0)}isInFrustum(e){return this.getBoundingInfo().isInFrustum(e,this.cullingStrategy)}isCompletelyInFrustum(e){return this.getBoundingInfo().isCompletelyInFrustum(e)}intersectsMesh(e,t=!1,i){const r=this.getBoundingInfo(),s=e.getBoundingInfo();if(r.intersects(s,t))return!0;if(i){for(const o of this.getChildMeshes())if(o.intersectsMesh(e,t,!0))return!0}return!1}intersectsPoint(e){return this.getBoundingInfo().intersectsPoint(e)}get checkCollisions(){return this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions}set checkCollisions(e){this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions=e}get collider(){return this._internalAbstractMeshDataInfo._meshCollisionData._collider}moveWithCollisions(e){this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions);const t=this.getScene().collisionCoordinator;return this._internalAbstractMeshDataInfo._meshCollisionData._collider||(this._internalAbstractMeshDataInfo._meshCollisionData._collider=t.createCollider()),this._internalAbstractMeshDataInfo._meshCollisionData._collider._radius=this.ellipsoid,t.getNewPosition(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,e,this._internalAbstractMeshDataInfo._meshCollisionData._collider,this.collisionRetryCount,this,this._onCollisionPositionChange,this.uniqueId),this}_collideForSubMesh(e,t,i){var r;if(this._generatePointsArray(),!this._positions)return this;if(!e._lastColliderWorldVertices||!e._lastColliderTransformMatrix.equals(t)){e._lastColliderTransformMatrix=t.clone(),e._lastColliderWorldVertices=[],e._trianglePlanes=[];const s=e.verticesStart,o=e.verticesStart+e.verticesCount;for(let a=s;a<o;a++)e._lastColliderWorldVertices.push(v.TransformCoordinates(this._positions[a],t))}return i._collide(e._trianglePlanes,e._lastColliderWorldVertices,this.getIndices(),e.indexStart,e.indexStart+e.indexCount,e.verticesStart,!!e.getMaterial(),this,this._shouldConvertRHS(),((r=e.getMaterial())==null?void 0:r.fillMode)===7),this}_processCollisionsForSubMeshes(e,t){const i=this._scene.getCollidingSubMeshCandidates(this,e),r=i.length;for(let s=0;s<r;s++){const o=i.data[s];r>1&&!o._checkCollision(e)||this._collideForSubMesh(o,t,e)}return this}_shouldConvertRHS(){return!1}_checkCollision(e){if(!this.getBoundingInfo()._checkCollision(e))return this;const t=W.Matrix[0],i=W.Matrix[1];return U.ScalingToRef(1/e._radius.x,1/e._radius.y,1/e._radius.z,t),this.worldMatrixFromCache.multiplyToRef(t,i),this._processCollisionsForSubMeshes(e,i),this}_generatePointsArray(){return!1}intersects(e,t,i,r=!1,s,o=!1){const a=new Ts,l=this.getClassName(),h=l==="InstancedLinesMesh"||l==="LinesMesh"||l==="GreasedLineMesh"?this.intersectionThreshold:0,c=this.getBoundingInfo();if(!this.subMeshes||!o&&(!e.intersectsSphere(c.boundingSphere,h)||!e.intersectsBox(c.boundingBox,h)))return a;if(r)return a.hit=!o,a.pickedMesh=o?null:this,a.distance=o?0:v.Distance(e.origin,c.boundingSphere.center),a.subMeshId=0,a;if(!this._generatePointsArray())return a;let u=null;const d=this._scene.getIntersectingSubMeshCandidates(this,e),f=d.length;let p=!1;for(let g=0;g<f;g++){const m=d.data[g].getMaterial();if(m&&(m.fillMode==7||m.fillMode==0||m.fillMode==1||m.fillMode==2||m.fillMode==4)){p=!0;break}}if(!p)return a.hit=!0,a.pickedMesh=this,a.distance=v.Distance(e.origin,c.boundingSphere.center),a.subMeshId=-1,a;for(let g=0;g<f;g++){const m=d.data[g];if(f>1&&!o&&!m.canIntersects(e))continue;const x=m.intersects(e,this._positions,this.getIndices(),t,i);if(x&&(t||!u||x.distance<u.distance)&&(u=x,u.subMeshId=g,t))break}if(u){const g=s??this.getWorldMatrix(),m=W.Vector3[0],x=W.Vector3[1];v.TransformCoordinatesToRef(e.origin,g,m),e.direction.scaleToRef(u.distance,x);const E=v.TransformNormal(x,g).addInPlace(m);return a.hit=!0,a.distance=v.Distance(m,E),a.pickedPoint=E,a.pickedMesh=this,a.bu=u.bu||0,a.bv=u.bv||0,a.subMeshFaceId=u.faceId,a.faceId=u.faceId+d.data[u.subMeshId].indexStart/(this.getClassName().indexOf("LinesMesh")!==-1?2:3),a.subMeshId=u.subMeshId,a}return a}clone(e,t,i){return null}releaseSubMeshes(){if(this.subMeshes)for(;this.subMeshes.length;)this.subMeshes[0].dispose();else this.subMeshes=[];return this}dispose(e,t=!1){let i;const r=this.getScene();for(this._scene.useMaterialMeshMap&&this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),r.freeActiveMeshes(),r.freeRenderingGroups(),r.renderingManager.maintainStateBetweenFrames&&r.renderingManager.restoreDispachedFlags(),this.actionManager!==void 0&&this.actionManager!==null&&(this._scene.meshes.some(o=>o!==this&&o.actionManager===this.actionManager)||this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),i=0;i<this._intersectionsInProgress.length;i++){const o=this._intersectionsInProgress[i],a=o._intersectionsInProgress.indexOf(this);o._intersectionsInProgress.splice(a,1)}this._intersectionsInProgress.length=0,r.lights.forEach(o=>{let a=o.includedOnlyMeshes.indexOf(this);a!==-1&&o.includedOnlyMeshes.splice(a,1),a=o.excludedMeshes.indexOf(this),a!==-1&&o.excludedMeshes.splice(a,1);const l=o.getShadowGenerators();if(l){const h=l.values();for(let c=h.next();c.done!==!0;c=h.next()){const u=c.value.getShadowMap();u&&u.renderList&&(a=u.renderList.indexOf(this),a!==-1&&u.renderList.splice(a,1))}}}),(this.getClassName()!=="InstancedMesh"||this.getClassName()!=="InstancedLinesMesh")&&this.releaseSubMeshes();const s=r.getEngine();if(this._occlusionQuery!==null&&(this.isOcclusionQueryInProgress=!1,s.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),s.wipeCaches(),r.removeMesh(this),this._parentContainer){const o=this._parentContainer.meshes.indexOf(this);o>-1&&this._parentContainer.meshes.splice(o,1),this._parentContainer=null}if(t&&this.material&&(this.material.getClassName()==="MultiMaterial"?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!e)for(i=0;i<r.particleSystems.length;i++)r.particleSystems[i].emitter===this&&(r.particleSystems[i].dispose(),i--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this._uniformBuffer.dispose(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),super.dispose(e,t)}addChild(e,t=!1){return e.setParent(this,t),this}removeChild(e,t=!1){return e.setParent(null,t),this}_initFacetData(){const e=this._internalAbstractMeshDataInfo._facetData;e.facetNormals||(e.facetNormals=[]),e.facetPositions||(e.facetPositions=[]),e.facetPartitioning||(e.facetPartitioning=new Array),e.facetNb=this.getIndices().length/3|0,e.partitioningSubdivisions=e.partitioningSubdivisions?e.partitioningSubdivisions:10,e.partitioningBBoxRatio=e.partitioningBBoxRatio?e.partitioningBBoxRatio:1.01;for(let t=0;t<e.facetNb;t++)e.facetNormals[t]=v.Zero(),e.facetPositions[t]=v.Zero();return e.facetDataEnabled=!0,this}updateFacetData(){const e=this._internalAbstractMeshDataInfo._facetData;e.facetDataEnabled||this._initFacetData();const t=this.getVerticesData(b.PositionKind),i=this.getIndices(),r=this.getVerticesData(b.NormalKind),s=this.getBoundingInfo();if(e.facetDepthSort&&!e.facetDepthSortEnabled){if(e.facetDepthSortEnabled=!0,i instanceof Uint16Array)e.depthSortedIndices=new Uint16Array(i);else if(i instanceof Uint32Array)e.depthSortedIndices=new Uint32Array(i);else{let a=!1;for(let l=0;l<i.length;l++)if(i[l]>65535){a=!0;break}a?e.depthSortedIndices=new Uint32Array(i):e.depthSortedIndices=new Uint16Array(i)}if(e.facetDepthSortFunction=function(a,l){return l.sqDistance-a.sqDistance},!e.facetDepthSortFrom){const a=this.getScene().activeCamera;e.facetDepthSortFrom=a?a.position:v.Zero()}e.depthSortedFacets=[];for(let a=0;a<e.facetNb;a++){const l={ind:a*3,sqDistance:0};e.depthSortedFacets.push(l)}e.invertedMatrix=U.Identity(),e.facetDepthSortOrigin=v.Zero()}e.bbSize.x=s.maximum.x-s.minimum.x>xt?s.maximum.x-s.minimum.x:xt,e.bbSize.y=s.maximum.y-s.minimum.y>xt?s.maximum.y-s.minimum.y:xt,e.bbSize.z=s.maximum.z-s.minimum.z>xt?s.maximum.z-s.minimum.z:xt;let o=e.bbSize.x>e.bbSize.y?e.bbSize.x:e.bbSize.y;if(o=o>e.bbSize.z?o:e.bbSize.z,e.subDiv.max=e.partitioningSubdivisions,e.subDiv.X=Math.floor(e.subDiv.max*e.bbSize.x/o),e.subDiv.Y=Math.floor(e.subDiv.max*e.bbSize.y/o),e.subDiv.Z=Math.floor(e.subDiv.max*e.bbSize.z/o),e.subDiv.X=e.subDiv.X<1?1:e.subDiv.X,e.subDiv.Y=e.subDiv.Y<1?1:e.subDiv.Y,e.subDiv.Z=e.subDiv.Z<1?1:e.subDiv.Z,e.facetParameters.facetNormals=this.getFacetLocalNormals(),e.facetParameters.facetPositions=this.getFacetLocalPositions(),e.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),e.facetParameters.bInfo=s,e.facetParameters.bbSize=e.bbSize,e.facetParameters.subDiv=e.subDiv,e.facetParameters.ratio=this.partitioningBBoxRatio,e.facetParameters.depthSort=e.facetDepthSort,e.facetDepthSort&&e.facetDepthSortEnabled&&(this.computeWorldMatrix(!0),this._worldMatrix.invertToRef(e.invertedMatrix),v.TransformCoordinatesToRef(e.facetDepthSortFrom,e.invertedMatrix,e.facetDepthSortOrigin),e.facetParameters.distanceTo=e.facetDepthSortOrigin),e.facetParameters.depthSortedFacets=e.depthSortedFacets,r&&re.ComputeNormals(t,i,r,e.facetParameters),e.facetDepthSort&&e.facetDepthSortEnabled){e.depthSortedFacets.sort(e.facetDepthSortFunction);const a=e.depthSortedIndices.length/3|0;for(let l=0;l<a;l++){const h=e.depthSortedFacets[l].ind;e.depthSortedIndices[l*3]=i[h],e.depthSortedIndices[l*3+1]=i[h+1],e.depthSortedIndices[l*3+2]=i[h+2]}this.updateIndices(e.depthSortedIndices,void 0,!0)}return this}getFacetLocalNormals(){const e=this._internalAbstractMeshDataInfo._facetData;return e.facetNormals||this.updateFacetData(),e.facetNormals}getFacetLocalPositions(){const e=this._internalAbstractMeshDataInfo._facetData;return e.facetPositions||this.updateFacetData(),e.facetPositions}getFacetLocalPartitioning(){const e=this._internalAbstractMeshDataInfo._facetData;return e.facetPartitioning||this.updateFacetData(),e.facetPartitioning}getFacetPosition(e){const t=v.Zero();return this.getFacetPositionToRef(e,t),t}getFacetPositionToRef(e,t){const i=this.getFacetLocalPositions()[e],r=this.getWorldMatrix();return v.TransformCoordinatesToRef(i,r,t),this}getFacetNormal(e){const t=v.Zero();return this.getFacetNormalToRef(e,t),t}getFacetNormalToRef(e,t){const i=this.getFacetLocalNormals()[e];return v.TransformNormalToRef(i,this.getWorldMatrix(),t),this}getFacetsAtLocalCoordinates(e,t,i){const r=this.getBoundingInfo(),s=this._internalAbstractMeshDataInfo._facetData,o=Math.floor((e-r.minimum.x*s.partitioningBBoxRatio)*s.subDiv.X*s.partitioningBBoxRatio/s.bbSize.x),a=Math.floor((t-r.minimum.y*s.partitioningBBoxRatio)*s.subDiv.Y*s.partitioningBBoxRatio/s.bbSize.y),l=Math.floor((i-r.minimum.z*s.partitioningBBoxRatio)*s.subDiv.Z*s.partitioningBBoxRatio/s.bbSize.z);return o<0||o>s.subDiv.max||a<0||a>s.subDiv.max||l<0||l>s.subDiv.max?null:s.facetPartitioning[o+s.subDiv.max*a+s.subDiv.max*s.subDiv.max*l]}getClosestFacetAtCoordinates(e,t,i,r,s=!1,o=!0){const a=this.getWorldMatrix(),l=W.Matrix[5];a.invertToRef(l);const h=W.Vector3[8];v.TransformCoordinatesFromFloatsToRef(e,t,i,l,h);const c=this.getClosestFacetAtLocalCoordinates(h.x,h.y,h.z,r,s,o);return r&&v.TransformCoordinatesFromFloatsToRef(r.x,r.y,r.z,a,r),c}getClosestFacetAtLocalCoordinates(e,t,i,r,s=!1,o=!0){let a=null,l=0,h=0,c=0,u=0,d=0,f=0,p=0,g=0;const m=this.getFacetLocalPositions(),x=this.getFacetLocalNormals(),E=this.getFacetsAtLocalCoordinates(e,t,i);if(!E)return null;let R=Number.MAX_VALUE,C=R,_,T,y;for(let P=0;P<E.length;P++)_=E[P],T=x[_],y=m[_],u=(e-y.x)*T.x+(t-y.y)*T.y+(i-y.z)*T.z,(!s||s&&o&&u>=0||s&&!o&&u<=0)&&(u=T.x*y.x+T.y*y.y+T.z*y.z,d=-(T.x*e+T.y*t+T.z*i-u)/(T.x*T.x+T.y*T.y+T.z*T.z),f=e+T.x*d,p=t+T.y*d,g=i+T.z*d,l=f-e,h=p-t,c=g-i,C=l*l+h*h+c*c,C<R&&(R=C,a=_,r&&(r.x=f,r.y=p,r.z=g)));return a}getFacetDataParameters(){return this._internalAbstractMeshDataInfo._facetData.facetParameters}disableFacetData(){const e=this._internalAbstractMeshDataInfo._facetData;return e.facetDataEnabled&&(e.facetDataEnabled=!1,e.facetPositions=[],e.facetNormals=[],e.facetPartitioning=new Array,e.facetParameters=null,e.depthSortedIndices=new Uint32Array(0)),this}updateIndices(e,t,i=!1){return this}createNormals(e){const t=this.getVerticesData(b.PositionKind),i=this.getIndices();let r;return this.isVerticesDataPresent(b.NormalKind)?r=this.getVerticesData(b.NormalKind):r=[],re.ComputeNormals(t,i,r,{useRightHandedSystem:this.getScene().useRightHandedSystem}),this.setVerticesData(b.NormalKind,r,e),this}alignWithNormal(e,t){t||(t=Qa.Y);const i=W.Vector3[0],r=W.Vector3[1];return v.CrossToRef(t,e,r),v.CrossToRef(e,r,i),this.rotationQuaternion?Re.RotationQuaternionFromAxisToRef(i,e,r,this.rotationQuaternion):v.RotationFromAxisToRef(i,e,r,this.rotation),this}_checkOcclusionQuery(){return!1}disableEdgesRendering(){throw Ge("EdgesRenderer")}enableEdgesRendering(e,t,i){throw Ge("EdgesRenderer")}getConnectedParticleSystems(){return this._scene.particleSystems.filter(e=>e.emitter===this)}}nr.OCCLUSION_TYPE_NONE=0;nr.OCCLUSION_TYPE_OPTIMISTIC=1;nr.OCCLUSION_TYPE_STRICT=2;nr.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0;nr.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1;nr.CULLINGSTRATEGY_STANDARD=0;nr.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1;nr.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2;nr.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3;ye("BABYLON.AbstractMesh",nr);Object.defineProperty(nr.prototype,"decalMap",{get:function(){return this._decalMap},set:function(n){this._decalMap=n},enumerable:!0,configurable:!0});class ar{static get ForceFullSceneLoadingForIncremental(){return ar._ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(e){ar._ForceFullSceneLoadingForIncremental=e}static get ShowLoadingScreen(){return ar._ShowLoadingScreen}static set ShowLoadingScreen(e){ar._ShowLoadingScreen=e}static get loggingLevel(){return ar._LoggingLevel}static set loggingLevel(e){ar._LoggingLevel=e}static get CleanBoneMatrixWeights(){return ar._CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(e){ar._CleanBoneMatrixWeights=e}}ar._ForceFullSceneLoadingForIncremental=!1;ar._ShowLoadingScreen=!0;ar._CleanBoneMatrixWeights=!1;ar._LoggingLevel=0;class st{}st.UseOpenGLOrientationForUV=!1;let ls=class uo{get boundingBias(){return this._boundingBias}set boundingBias(e){this._boundingBias?this._boundingBias.copyFrom(e):this._boundingBias=e.clone(),this._updateBoundingInfo(!0,null)}static CreateGeometryForMesh(e){const t=new uo(uo.RandomId(),e.getScene());return t.applyToMesh(e),t}get meshes(){return this._meshes}constructor(e,t,i,r=!1,s=null){this.delayLoadState=0,this._totalVertices=0,this._isDisposed=!1,this._indexBufferIsUpdatable=!1,this._positionsCache=[],this._parentContainer=null,this.useBoundingInfoFromGeometry=!1,this._scene=t||rt.LastCreatedScene,this._scene&&(this.id=e,this.uniqueId=this._scene.getUniqueId(),this._engine=this._scene.getEngine(),this._meshes=[],this._vertexBuffers={},this._indices=[],this._updatable=r,i?this.setAllVerticesData(i,r):this._totalVertices=0,this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),s&&(this.applyToMesh(s),s.computeWorldMatrix(!0)))}get extend(){return this._extend}getScene(){return this._scene}getEngine(){return this._engine}isReady(){return this.delayLoadState===1||this.delayLoadState===0}get doNotSerialize(){for(let e=0;e<this._meshes.length;e++)if(!this._meshes[e].doNotSerialize)return!1;return!0}_rebuild(){this._vertexArrayObjects&&(this._vertexArrayObjects={}),this._meshes.length!==0&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer"));const e=new Set;for(const t in this._vertexBuffers)e.add(this._vertexBuffers[t].getWrapperBuffer());e.forEach(t=>{t._rebuild()})}setAllVerticesData(e,t){e.applyToGeometry(this,t),this._notifyUpdate()}setVerticesData(e,t,i=!1,r){i&&Array.isArray(t)&&(t=new Float32Array(t));const s=new b(this._engine,t,e,{updatable:i,postponeInternalCreation:this._meshes.length===0,stride:r,label:"Geometry_"+this.id+"_"+e});this.setVerticesBuffer(s)}removeVerticesData(e){this._vertexBuffers[e]&&(this._vertexBuffers[e].dispose(),delete this._vertexBuffers[e]),this._vertexArrayObjects&&this._disposeVertexArrayObjects()}setVerticesBuffer(e,t=null,i=!0){const r=e.getKind();this._vertexBuffers[r]&&i&&this._vertexBuffers[r].dispose(),e._buffer&&e._buffer._increaseReferences(),this._vertexBuffers[r]=e;const s=this._meshes,o=s.length;if(r===b.PositionKind){this._totalVertices=t??e._maxVerticesCount,this._updateExtend(e.getFloatData(this._totalVertices)),this._resetPointsArrayCache();const a=this._extend&&this._extend.minimum||new v(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),l=this._extend&&this._extend.maximum||new v(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);for(let h=0;h<o;h++){const c=s[h];c.buildBoundingInfo(a,l),c._createGlobalSubMesh(c.isUnIndexed),c.computeWorldMatrix(!0),c.synchronizeInstances()}}this._notifyUpdate(r)}updateVerticesDataDirectly(e,t,i,r=!1){const s=this.getVertexBuffer(e);s&&(s.updateDirectly(t,i,r),this._notifyUpdate(e))}updateVerticesData(e,t,i=!1){const r=this.getVertexBuffer(e);r&&(r.update(t),e===b.PositionKind&&this._updateBoundingInfo(i,t),this._notifyUpdate(e))}_updateBoundingInfo(e,t){if(e&&this._updateExtend(t),this._resetPointsArrayCache(),e){const i=this._meshes;for(const r of i){r.hasBoundingInfo?r.getBoundingInfo().reConstruct(this._extend.minimum,this._extend.maximum):r.buildBoundingInfo(this._extend.minimum,this._extend.maximum);const s=r.subMeshes;for(const o of s)o.refreshBoundingInfo()}}}_bind(e,t,i,r){if(!e)return;t===void 0&&(t=this._indexBuffer);const s=this.getVertexBuffers();if(!s)return;if(t!=this._indexBuffer||!this._vertexArrayObjects&&!r){this._engine.bindBuffers(s,t,e,i);return}const o=r||this._vertexArrayObjects;o[e.key]||(o[e.key]=this._engine.recordVertexArrayObject(s,t,e,i)),this._engine.bindVertexArrayObject(o[e.key],t)}getTotalVertices(){return this.isReady()?this._totalVertices:0}getVerticesData(e,t,i){const r=this.getVertexBuffer(e);return r?r.getFloatData(this._totalVertices,i||t&&this._meshes.length!==1):null}isVertexBufferUpdatable(e){const t=this._vertexBuffers[e];return t?t.isUpdatable():!1}getVertexBuffer(e){return this.isReady()?this._vertexBuffers[e]:null}getVertexBuffers(){return this.isReady()?this._vertexBuffers:null}isVerticesDataPresent(e){return this._vertexBuffers?this._vertexBuffers[e]!==void 0:this._delayInfo?this._delayInfo.indexOf(e)!==-1:!1}getVerticesDataKinds(){const e=[];let t;if(!this._vertexBuffers&&this._delayInfo)for(t in this._delayInfo)e.push(t);else for(t in this._vertexBuffers)e.push(t);return e}updateIndices(e,t,i=!1){if(this._indexBuffer)if(!this._indexBufferIsUpdatable)this.setIndices(e,null,!0);else{const r=e.length!==this._indices.length;if(i||(this._indices=e.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,e,t),r)for(const s of this._meshes)s._createGlobalSubMesh(!0)}}setIndexBuffer(e,t,i){this._indices=[],this._indexBufferIsUpdatable=!1,this._indexBuffer=e,this._totalVertices=t,this._totalIndices=i,e.is32Bits||(e.is32Bits=this._totalIndices>65535);for(const r of this._meshes)r._createGlobalSubMesh(!0),r.synchronizeInstances();this._notifyUpdate()}setIndices(e,t=null,i=!1){this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=e,this._indexBufferIsUpdatable=i,this._meshes.length!==0&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,i,"Geometry_"+this.id+"_IndexBuffer")),t!=null&&(this._totalVertices=t);for(const r of this._meshes)r._createGlobalSubMesh(!0),r.synchronizeInstances();this._notifyUpdate()}getTotalIndices(){return this.isReady()?this._totalIndices!==void 0?this._totalIndices:this._indices.length:0}getIndices(e,t){if(!this.isReady())return null;const i=this._indices;return!t&&(!e||this._meshes.length===1)?i:i.slice()}getIndexBuffer(){return this.isReady()?this._indexBuffer:null}_releaseVertexArrayObject(e=null){!e||!this._vertexArrayObjects||this._vertexArrayObjects[e.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[e.key]),delete this._vertexArrayObjects[e.key])}releaseForMesh(e,t){const i=this._meshes,r=i.indexOf(e);r!==-1&&(i.splice(r,1),this._vertexArrayObjects&&e._invalidateInstanceVertexArrayObject(),e._geometry=null,i.length===0&&t&&this.dispose())}applyToMesh(e){if(e._geometry===this)return;const t=e._geometry;t&&t.releaseForMesh(e),this._vertexArrayObjects&&e._invalidateInstanceVertexArrayObject();const i=this._meshes;e._geometry=this,e._internalAbstractMeshDataInfo._positions=null,this._scene.pushGeometry(this),i.push(e),this.isReady()?this._applyToMesh(e):this._boundingInfo&&e.setBoundingInfo(this._boundingInfo)}_updateExtend(e=null){if(this.useBoundingInfoFromGeometry&&this._boundingInfo)this._extend={minimum:this._boundingInfo.minimum.clone(),maximum:this._boundingInfo.maximum.clone()};else{if(!e&&(e=this.getVerticesData(b.PositionKind),!e))return;this._extend=Ra(e,0,this._totalVertices,this.boundingBias,3)}}_applyToMesh(e){const t=this._meshes.length;for(const i in this._vertexBuffers)t===1&&this._vertexBuffers[i].create(),i===b.PositionKind&&(this._extend||this._updateExtend(),e.buildBoundingInfo(this._extend.minimum,this._extend.maximum),e._createGlobalSubMesh(e.isUnIndexed),e._updateBoundingInfo());t===1&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer")),e._syncGeometryWithMorphTargetManager(),e.synchronizeInstances()}_notifyUpdate(e){this.onGeometryUpdated&&this.onGeometryUpdated(this,e),this._vertexArrayObjects&&this._disposeVertexArrayObjects();for(const t of this._meshes)t._markSubMeshesAsAttributesDirty()}load(e,t){if(this.delayLoadState!==2){if(this.isReady()){t&&t();return}this.delayLoadState=2,this._queueLoad(e,t)}}_queueLoad(e,t){this.delayLoadingFile&&(e.addPendingData(this),e._loadFile(this.delayLoadingFile,i=>{if(!this._delayLoadingFunction)return;this._delayLoadingFunction(JSON.parse(i),this),this.delayLoadState=1,this._delayInfo=[],e.removePendingData(this);const r=this._meshes,s=r.length;for(let o=0;o<s;o++)this._applyToMesh(r[o]);t&&t()},void 0,!0))}toLeftHanded(){const e=this.getIndices(!1);if(e!=null&&e.length>0){for(let r=0;r<e.length;r+=3){const s=e[r+0];e[r+0]=e[r+2],e[r+2]=s}this.setIndices(e)}const t=this.getVerticesData(b.PositionKind,!1);if(t!=null&&t.length>0){for(let r=0;r<t.length;r+=3)t[r+2]=-t[r+2];this.setVerticesData(b.PositionKind,t,!1)}const i=this.getVerticesData(b.NormalKind,!1);if(i!=null&&i.length>0){for(let r=0;r<i.length;r+=3)i[r+2]=-i[r+2];this.setVerticesData(b.NormalKind,i,!1)}}_resetPointsArrayCache(){this._positions=null}_generatePointsArray(){if(this._positions)return!0;const e=this.getVerticesData(b.PositionKind);if(!e||e.length===0)return!1;for(let t=this._positionsCache.length*3,i=this._positionsCache.length;t<e.length;t+=3,++i)this._positionsCache[i]=v.FromArray(e,t);for(let t=0,i=0;t<e.length;t+=3,++i)this._positionsCache[i].set(e[0+t],e[1+t],e[2+t]);return this._positionsCache.length=e.length/3,this._positions=this._positionsCache,!0}isDisposed(){return this._isDisposed}_disposeVertexArrayObjects(){if(this._vertexArrayObjects){for(const i in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[i]);this._vertexArrayObjects={};const e=this._meshes,t=e.length;for(let i=0;i<t;i++)e[i]._invalidateInstanceVertexArrayObject()}}dispose(){const e=this._meshes,t=e.length;let i;for(i=0;i<t;i++)this.releaseForMesh(e[i]);this._meshes.length=0,this._disposeVertexArrayObjects();for(const r in this._vertexBuffers)this._vertexBuffers[r].dispose();if(this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=0,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._parentContainer){const r=this._parentContainer.geometries.indexOf(this);r>-1&&this._parentContainer.geometries.splice(r,1),this._parentContainer=null}this._isDisposed=!0}copy(e){const t=new re;t.indices=[];const i=this.getIndices();if(i)for(let l=0;l<i.length;l++)t.indices.push(i[l]);let r=!1,s=!1,o;for(o in this._vertexBuffers){const l=this.getVerticesData(o);if(l&&(l instanceof Float32Array?t.set(new Float32Array(l),o):t.set(l.slice(0),o),!s)){const h=this.getVertexBuffer(o);h&&(r=h.isUpdatable(),s=!r)}}const a=new uo(e,this._scene,t,r);a.delayLoadState=this.delayLoadState,a.delayLoadingFile=this.delayLoadingFile,a._delayLoadingFunction=this._delayLoadingFunction;for(o in this._delayInfo)a._delayInfo=a._delayInfo||[],a._delayInfo.push(o);return a._boundingInfo=new br(this._extend.minimum,this._extend.maximum),a}serialize(){const e={};return e.id=this.id,e.uniqueId=this.uniqueId,e.updatable=this._updatable,it&&it.HasTags(this)&&(e.tags=it.GetTags(this)),e}_toNumberArray(e){return Array.isArray(e)?e:Array.prototype.slice.call(e)}clearCachedData(){this._indices=[],this._resetPointsArrayCache();for(const e in this._vertexBuffers)Object.prototype.hasOwnProperty.call(this._vertexBuffers,e)&&(this._vertexBuffers[e]._buffer._data=null)}serializeVerticeData(){const e=this.serialize();return this.isVerticesDataPresent(b.PositionKind)&&(e.positions=this._toNumberArray(this.getVerticesData(b.PositionKind)),this.isVertexBufferUpdatable(b.PositionKind)&&(e.positions._updatable=!0)),this.isVerticesDataPresent(b.NormalKind)&&(e.normals=this._toNumberArray(this.getVerticesData(b.NormalKind)),this.isVertexBufferUpdatable(b.NormalKind)&&(e.normals._updatable=!0)),this.isVerticesDataPresent(b.TangentKind)&&(e.tangents=this._toNumberArray(this.getVerticesData(b.TangentKind)),this.isVertexBufferUpdatable(b.TangentKind)&&(e.tangents._updatable=!0)),this.isVerticesDataPresent(b.UVKind)&&(e.uvs=this._toNumberArray(this.getVerticesData(b.UVKind)),this.isVertexBufferUpdatable(b.UVKind)&&(e.uvs._updatable=!0)),this.isVerticesDataPresent(b.UV2Kind)&&(e.uvs2=this._toNumberArray(this.getVerticesData(b.UV2Kind)),this.isVertexBufferUpdatable(b.UV2Kind)&&(e.uvs2._updatable=!0)),this.isVerticesDataPresent(b.UV3Kind)&&(e.uvs3=this._toNumberArray(this.getVerticesData(b.UV3Kind)),this.isVertexBufferUpdatable(b.UV3Kind)&&(e.uvs3._updatable=!0)),this.isVerticesDataPresent(b.UV4Kind)&&(e.uvs4=this._toNumberArray(this.getVerticesData(b.UV4Kind)),this.isVertexBufferUpdatable(b.UV4Kind)&&(e.uvs4._updatable=!0)),this.isVerticesDataPresent(b.UV5Kind)&&(e.uvs5=this._toNumberArray(this.getVerticesData(b.UV5Kind)),this.isVertexBufferUpdatable(b.UV5Kind)&&(e.uvs5._updatable=!0)),this.isVerticesDataPresent(b.UV6Kind)&&(e.uvs6=this._toNumberArray(this.getVerticesData(b.UV6Kind)),this.isVertexBufferUpdatable(b.UV6Kind)&&(e.uvs6._updatable=!0)),this.isVerticesDataPresent(b.ColorKind)&&(e.colors=this._toNumberArray(this.getVerticesData(b.ColorKind)),this.isVertexBufferUpdatable(b.ColorKind)&&(e.colors._updatable=!0)),this.isVerticesDataPresent(b.MatricesIndicesKind)&&(e.matricesIndices=this._toNumberArray(this.getVerticesData(b.MatricesIndicesKind)),e.matricesIndices._isExpanded=!0,this.isVertexBufferUpdatable(b.MatricesIndicesKind)&&(e.matricesIndices._updatable=!0)),this.isVerticesDataPresent(b.MatricesWeightsKind)&&(e.matricesWeights=this._toNumberArray(this.getVerticesData(b.MatricesWeightsKind)),this.isVertexBufferUpdatable(b.MatricesWeightsKind)&&(e.matricesWeights._updatable=!0)),e.indices=this._toNumberArray(this.getIndices()),e}static ExtractFromMesh(e,t){const i=e._geometry;return i?i.copy(t):null}static RandomId(){return ge.RandomId()}static _GetGeometryByLoadedUniqueId(e,t){for(let i=0;i<t.geometries.length;i++)if(t.geometries[i]._loadedUniqueId===e)return t.geometries[i];return null}static _ImportGeometry(e,t){const i=t.getScene(),r=e.geometryUniqueId,s=e.geometryId;if(r||s){const o=r?this._GetGeometryByLoadedUniqueId(r,i):i.getGeometryById(s);o&&o.applyToMesh(t)}else if(e instanceof ArrayBuffer){const o=t._binaryInfo;if(o.positionsAttrDesc&&o.positionsAttrDesc.count>0){const a=new Float32Array(e,o.positionsAttrDesc.offset,o.positionsAttrDesc.count);t.setVerticesData(b.PositionKind,a,!1)}if(o.normalsAttrDesc&&o.normalsAttrDesc.count>0){const a=new Float32Array(e,o.normalsAttrDesc.offset,o.normalsAttrDesc.count);t.setVerticesData(b.NormalKind,a,!1)}if(o.tangetsAttrDesc&&o.tangetsAttrDesc.count>0){const a=new Float32Array(e,o.tangetsAttrDesc.offset,o.tangetsAttrDesc.count);t.setVerticesData(b.TangentKind,a,!1)}if(o.uvsAttrDesc&&o.uvsAttrDesc.count>0){const a=new Float32Array(e,o.uvsAttrDesc.offset,o.uvsAttrDesc.count);if(st.UseOpenGLOrientationForUV)for(let l=1;l<a.length;l+=2)a[l]=1-a[l];t.setVerticesData(b.UVKind,a,!1)}if(o.uvs2AttrDesc&&o.uvs2AttrDesc.count>0){const a=new Float32Array(e,o.uvs2AttrDesc.offset,o.uvs2AttrDesc.count);if(st.UseOpenGLOrientationForUV)for(let l=1;l<a.length;l+=2)a[l]=1-a[l];t.setVerticesData(b.UV2Kind,a,!1)}if(o.uvs3AttrDesc&&o.uvs3AttrDesc.count>0){const a=new Float32Array(e,o.uvs3AttrDesc.offset,o.uvs3AttrDesc.count);if(st.UseOpenGLOrientationForUV)for(let l=1;l<a.length;l+=2)a[l]=1-a[l];t.setVerticesData(b.UV3Kind,a,!1)}if(o.uvs4AttrDesc&&o.uvs4AttrDesc.count>0){const a=new Float32Array(e,o.uvs4AttrDesc.offset,o.uvs4AttrDesc.count);if(st.UseOpenGLOrientationForUV)for(let l=1;l<a.length;l+=2)a[l]=1-a[l];t.setVerticesData(b.UV4Kind,a,!1)}if(o.uvs5AttrDesc&&o.uvs5AttrDesc.count>0){const a=new Float32Array(e,o.uvs5AttrDesc.offset,o.uvs5AttrDesc.count);if(st.UseOpenGLOrientationForUV)for(let l=1;l<a.length;l+=2)a[l]=1-a[l];t.setVerticesData(b.UV5Kind,a,!1)}if(o.uvs6AttrDesc&&o.uvs6AttrDesc.count>0){const a=new Float32Array(e,o.uvs6AttrDesc.offset,o.uvs6AttrDesc.count);if(st.UseOpenGLOrientationForUV)for(let l=1;l<a.length;l+=2)a[l]=1-a[l];t.setVerticesData(b.UV6Kind,a,!1)}if(o.colorsAttrDesc&&o.colorsAttrDesc.count>0){const a=new Float32Array(e,o.colorsAttrDesc.offset,o.colorsAttrDesc.count);t.setVerticesData(b.ColorKind,a,!1,o.colorsAttrDesc.stride)}if(o.matricesIndicesAttrDesc&&o.matricesIndicesAttrDesc.count>0){const a=new Int32Array(e,o.matricesIndicesAttrDesc.offset,o.matricesIndicesAttrDesc.count),l=[];for(let h=0;h<a.length;h++){const c=a[h];l.push(c&255),l.push((c&65280)>>8),l.push((c&16711680)>>16),l.push(c>>24&255)}t.setVerticesData(b.MatricesIndicesKind,l,!1)}if(o.matricesIndicesExtraAttrDesc&&o.matricesIndicesExtraAttrDesc.count>0){const a=new Int32Array(e,o.matricesIndicesExtraAttrDesc.offset,o.matricesIndicesExtraAttrDesc.count),l=[];for(let h=0;h<a.length;h++){const c=a[h];l.push(c&255),l.push((c&65280)>>8),l.push((c&16711680)>>16),l.push(c>>24&255)}t.setVerticesData(b.MatricesIndicesExtraKind,l,!1)}if(o.matricesWeightsAttrDesc&&o.matricesWeightsAttrDesc.count>0){const a=new Float32Array(e,o.matricesWeightsAttrDesc.offset,o.matricesWeightsAttrDesc.count);t.setVerticesData(b.MatricesWeightsKind,a,!1)}if(o.indicesAttrDesc&&o.indicesAttrDesc.count>0){const a=new Int32Array(e,o.indicesAttrDesc.offset,o.indicesAttrDesc.count);t.setIndices(a,null)}if(o.subMeshesAttrDesc&&o.subMeshesAttrDesc.count>0){const a=new Int32Array(e,o.subMeshesAttrDesc.offset,o.subMeshesAttrDesc.count*5);t.subMeshes=[];for(let l=0;l<o.subMeshesAttrDesc.count;l++){const h=a[l*5+0],c=a[l*5+1],u=a[l*5+2],d=a[l*5+3],f=a[l*5+4];Pi.AddToMesh(h,c,u,d,f,t)}}}else if(e.positions&&e.normals&&e.indices){if(t.setVerticesData(b.PositionKind,e.positions,e.positions._updatable),t.setVerticesData(b.NormalKind,e.normals,e.normals._updatable),e.tangents&&t.setVerticesData(b.TangentKind,e.tangents,e.tangents._updatable),e.uvs&&t.setVerticesData(b.UVKind,e.uvs,e.uvs._updatable),e.uvs2&&t.setVerticesData(b.UV2Kind,e.uvs2,e.uvs2._updatable),e.uvs3&&t.setVerticesData(b.UV3Kind,e.uvs3,e.uvs3._updatable),e.uvs4&&t.setVerticesData(b.UV4Kind,e.uvs4,e.uvs4._updatable),e.uvs5&&t.setVerticesData(b.UV5Kind,e.uvs5,e.uvs5._updatable),e.uvs6&&t.setVerticesData(b.UV6Kind,e.uvs6,e.uvs6._updatable),e.colors&&t.setVerticesData(b.ColorKind,$e.CheckColors4(e.colors,e.positions.length/3),e.colors._updatable),e.matricesIndices)if(e.matricesIndices._isExpanded)delete e.matricesIndices._isExpanded,t.setVerticesData(b.MatricesIndicesKind,e.matricesIndices,e.matricesIndices._updatable);else{const o=[];for(let a=0;a<e.matricesIndices.length;a++){const l=e.matricesIndices[a];o.push(l&255),o.push((l&65280)>>8),o.push((l&16711680)>>16),o.push(l>>24&255)}t.setVerticesData(b.MatricesIndicesKind,o,e.matricesIndices._updatable)}if(e.matricesIndicesExtra)if(e.matricesIndicesExtra._isExpanded)delete e.matricesIndices._isExpanded,t.setVerticesData(b.MatricesIndicesExtraKind,e.matricesIndicesExtra,e.matricesIndicesExtra._updatable);else{const o=[];for(let a=0;a<e.matricesIndicesExtra.length;a++){const l=e.matricesIndicesExtra[a];o.push(l&255),o.push((l&65280)>>8),o.push((l&16711680)>>16),o.push(l>>24&255)}t.setVerticesData(b.MatricesIndicesExtraKind,o,e.matricesIndicesExtra._updatable)}e.matricesWeights&&(uo._CleanMatricesWeights(e,t),t.setVerticesData(b.MatricesWeightsKind,e.matricesWeights,e.matricesWeights._updatable)),e.matricesWeightsExtra&&t.setVerticesData(b.MatricesWeightsExtraKind,e.matricesWeightsExtra,e.matricesWeights._updatable),t.setIndices(e.indices,null)}if(e.subMeshes){t.subMeshes=[];for(let o=0;o<e.subMeshes.length;o++){const a=e.subMeshes[o];Pi.AddToMesh(a.materialIndex,a.verticesStart,a.verticesCount,a.indexStart,a.indexCount,t)}}t._shouldGenerateFlatShading&&(t.convertToFlatShadedMesh(),t._shouldGenerateFlatShading=!1),t.computeWorldMatrix(!0),i.onMeshImportedObservable.notifyObservers(t)}static _CleanMatricesWeights(e,t){if(!ar.CleanBoneMatrixWeights)return;let i=0;if(e.skeletonId>-1){const c=t.getScene().getLastSkeletonById(e.skeletonId);if(!c)return;i=c.bones.length}else return;const r=t.getVerticesData(b.MatricesIndicesKind),s=t.getVerticesData(b.MatricesIndicesExtraKind),o=e.matricesWeights,a=e.matricesWeightsExtra,l=e.numBoneInfluencer,h=o.length;for(let c=0;c<h;c+=4){let u=0,d=-1;for(let f=0;f<4;f++){const p=o[c+f];u+=p,p<.001&&d<0&&(d=f)}if(a)for(let f=0;f<4;f++){const p=a[c+f];u+=p,p<.001&&d<0&&(d=f+4)}if((d<0||d>l-1)&&(d=l-1),u>.001){const f=1/u;for(let p=0;p<4;p++)o[c+p]*=f;if(a)for(let p=0;p<4;p++)a[c+p]*=f}else d>=4?(a[c+d-4]=1-u,s[c+d-4]=i):(o[c+d]=1-u,r[c+d]=i)}t.setVerticesData(b.MatricesIndicesKind,r),e.matricesWeightsExtra&&t.setVerticesData(b.MatricesIndicesExtraKind,s)}static Parse(e,t,i){const r=new uo(e.id,t,void 0,e.updatable);return r._loadedUniqueId=e.uniqueId,it&&it.AddTagsTo(r,e.tags),e.delayLoadingFile?(r.delayLoadState=4,r.delayLoadingFile=i+e.delayLoadingFile,r._boundingInfo=new br(v.FromArray(e.boundingBoxMinimum),v.FromArray(e.boundingBoxMaximum)),r._delayInfo=[],e.hasUVs&&r._delayInfo.push(b.UVKind),e.hasUVs2&&r._delayInfo.push(b.UV2Kind),e.hasUVs3&&r._delayInfo.push(b.UV3Kind),e.hasUVs4&&r._delayInfo.push(b.UV4Kind),e.hasUVs5&&r._delayInfo.push(b.UV5Kind),e.hasUVs6&&r._delayInfo.push(b.UV6Kind),e.hasColors&&r._delayInfo.push(b.ColorKind),e.hasMatricesIndices&&r._delayInfo.push(b.MatricesIndicesKind),e.hasMatricesWeights&&r._delayInfo.push(b.MatricesWeightsKind),r._delayLoadingFunction=re.ImportVertexData):re.ImportVertexData(e,r),t.pushGeometry(r,!0),r}};`${ge._DefaultCdnUrl}`,`${ge._DefaultCdnUrl}`,`${ge._DefaultCdnUrl}`;`${ge._DefaultCdnUrl}`;class Sa{constructor(e,t,i,r){this.x=e,this.y=t,this.width=i,this.height=r}toGlobal(e,t){return new Sa(this.x*e,this.y*t,this.width*e,this.height*t)}toGlobalToRef(e,t,i){return i.x=this.x*e,i.y=this.y*t,i.width=this.width*e,i.height=this.height*t,this}clone(){return new Sa(this.x,this.y,this.width,this.height)}}class Je extends Oi{get position(){return this._position}set position(e){this._position=e}set upVector(e){this._upVector=e}get upVector(){return this._upVector}get screenArea(){let e=0,t=0;if(this.mode===Je.PERSPECTIVE_CAMERA)this.fovMode===Je.FOVMODE_VERTICAL_FIXED?(t=this.minZ*2*Math.tan(this.fov/2),e=this.getEngine().getAspectRatio(this)*t):(e=this.minZ*2*Math.tan(this.fov/2),t=e/this.getEngine().getAspectRatio(this));else{const i=this.getEngine().getRenderWidth()/2,r=this.getEngine().getRenderHeight()/2;e=(this.orthoRight??i)-(this.orthoLeft??-i),t=(this.orthoTop??r)-(this.orthoBottom??-r)}return e*t}set orthoLeft(e){this._orthoLeft=e;for(const t of this._rigCameras)t.orthoLeft=e}get orthoLeft(){return this._orthoLeft}set orthoRight(e){this._orthoRight=e;for(const t of this._rigCameras)t.orthoRight=e}get orthoRight(){return this._orthoRight}set orthoBottom(e){this._orthoBottom=e;for(const t of this._rigCameras)t.orthoBottom=e}get orthoBottom(){return this._orthoBottom}set orthoTop(e){this._orthoTop=e;for(const t of this._rigCameras)t.orthoTop=e}get orthoTop(){return this._orthoTop}set mode(e){this._mode=e;for(const t of this._rigCameras)t.mode=e}get mode(){return this._mode}get hasMoved(){return this._hasMoved}constructor(e,t,i,r=!0){super(e,i),this._position=v.Zero(),this._upVector=v.Up(),this.oblique=null,this._orthoLeft=null,this._orthoRight=null,this._orthoBottom=null,this._orthoTop=null,this.fov=.8,this.projectionPlaneTilt=0,this.minZ=1,this.maxZ=1e4,this.inertia=.9,this._mode=Je.PERSPECTIVE_CAMERA,this.isIntermediate=!1,this.viewport=new Sa(0,0,1,1),this.layerMask=268435455,this.fovMode=Je.FOVMODE_VERTICAL_FIXED,this.cameraRigMode=Je.RIG_MODE_NONE,this.customRenderTargets=[],this.outputRenderTarget=null,this.onViewMatrixChangedObservable=new he,this.onProjectionMatrixChangedObservable=new he,this.onAfterCheckInputsObservable=new he,this.onRestoreStateObservable=new he,this.isRigCamera=!1,this._hasMoved=!1,this._rigCameras=new Array,this._skipRendering=!1,this._projectionMatrix=new U,this._postProcesses=new Array,this._activeMeshes=new Vi(256),this._globalPosition=v.Zero(),this._computedViewMatrix=U.Identity(),this._doNotComputeProjectionMatrix=!1,this._transformMatrix=U.Zero(),this._refreshFrustumPlanes=!0,this._absoluteRotation=Re.Identity(),this._isCamera=!0,this._isLeftCamera=!1,this._isRightCamera=!1,this.getScene().addCamera(this),r&&!this.getScene().activeCamera&&(this.getScene().activeCamera=this),this.position=t,this.renderPassId=this.getScene().getEngine().createRenderPassId(`Camera ${e}`)}storeState(){return this._stateStored=!0,this._storedFov=this.fov,this}_restoreStateValues(){return this._stateStored?(this.fov=this._storedFov,!0):!1}restoreState(){return this._restoreStateValues()?(this.onRestoreStateObservable.notifyObservers(this),!0):!1}getClassName(){return"Camera"}toString(e){let t="Name: "+this.name;if(t+=", type: "+this.getClassName(),this.animations)for(let i=0;i<this.animations.length;i++)t+=", animation[0]: "+this.animations[i].toString(e);return t}applyVerticalCorrection(){const e=this.absoluteRotation.toEulerAngles();this.projectionPlaneTilt=this._scene.useRightHandedSystem?-e.x:e.x}get globalPosition(){return this._globalPosition}getActiveMeshes(){return this._activeMeshes}isActiveMesh(e){return this._activeMeshes.indexOf(e)!==-1}isReady(e=!1){if(e){for(const t of this._postProcesses)if(t&&!t.isReady())return!1}return super.isReady(e)}_initCache(){super._initCache(),this._cache.position=new v(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new v(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.minZ=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.obliqueAngle=void 0,this._cache.obliqueLength=void 0,this._cache.obliqueOffset=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0}_updateCache(e){e||super._updateCache(),this._cache.position.copyFrom(this.position),this._cache.upVector.copyFrom(this.upVector)}_isSynchronized(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()}_isSynchronizedViewMatrix(){return super._isSynchronized()?this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent():!1}_isSynchronizedProjectionMatrix(){let e=this._cache.mode===this.mode&&this._cache.minZ===this.minZ&&this._cache.maxZ===this.maxZ;if(!e)return!1;const t=this.getEngine();return this.mode===Je.PERSPECTIVE_CAMERA?e=this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===t.getAspectRatio(this)&&this._cache.projectionPlaneTilt===this.projectionPlaneTilt:(e=this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===t.getRenderWidth()&&this._cache.renderHeight===t.getRenderHeight(),this.oblique&&(e=e&&this._cache.obliqueAngle===this.oblique.angle&&this._cache.obliqueLength===this.oblique.length&&this._cache.obliqueOffset===this.oblique.offset)),e}attachControl(e,t){}detachControl(e){}update(){this._hasMoved=!1,this._checkInputs(),this.cameraRigMode!==Je.RIG_MODE_NONE&&this._updateRigCameras(),this.getViewMatrix(),this.getProjectionMatrix()}_checkInputs(){this.onAfterCheckInputsObservable.notifyObservers(this)}get rigCameras(){return this._rigCameras}get rigPostProcess(){return this._rigPostProcess}_getFirstPostProcess(){for(let e=0;e<this._postProcesses.length;e++)if(this._postProcesses[e]!==null)return this._postProcesses[e];return null}_cascadePostProcessesToRigCams(){const e=this._getFirstPostProcess();e&&e.markTextureDirty();for(let t=0,i=this._rigCameras.length;t<i;t++){const r=this._rigCameras[t],s=r._rigPostProcess;s?(s.getEffectName()==="pass"&&(r.isIntermediate=this._postProcesses.length===0),r._postProcesses=this._postProcesses.slice(0).concat(s),s.markTextureDirty()):r._postProcesses=this._postProcesses.slice(0)}}attachPostProcess(e,t=null){return!e.isReusable()&&this._postProcesses.indexOf(e)>-1?(oe.Error("You're trying to reuse a post process not defined as reusable."),0):(t==null||t<0?this._postProcesses.push(e):this._postProcesses[t]===null?this._postProcesses[t]=e:this._postProcesses.splice(t,0,e),this._cascadePostProcessesToRigCams(),this._scene.prePassRenderer&&this._scene.prePassRenderer.markAsDirty(),this._postProcesses.indexOf(e))}detachPostProcess(e){const t=this._postProcesses.indexOf(e);t!==-1&&(this._postProcesses[t]=null),this._scene.prePassRenderer&&this._scene.prePassRenderer.markAsDirty(),this._cascadePostProcessesToRigCams()}getWorldMatrix(){return this._isSynchronizedViewMatrix()?this._worldMatrix:(this.getViewMatrix(),this._worldMatrix)}_getViewMatrix(){return U.Identity()}getViewMatrix(e){return!e&&this._isSynchronizedViewMatrix()?this._computedViewMatrix:(this._hasMoved=!0,this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.getScene().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix),this._computedViewMatrix)}freezeProjectionMatrix(e){this._doNotComputeProjectionMatrix=!0,e!==void 0&&(this._projectionMatrix=e)}unfreezeProjectionMatrix(){this._doNotComputeProjectionMatrix=!1}getProjectionMatrix(e){var t,i,r;if(this._doNotComputeProjectionMatrix||!e&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.minZ=this.minZ,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;const s=this.getEngine(),o=this.getScene(),a=s.useReverseDepthBuffer;if(this.mode===Je.PERSPECTIVE_CAMERA){this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=s.getAspectRatio(this),this._cache.projectionPlaneTilt=this.projectionPlaneTilt,this.minZ<=0&&(this.minZ=.1);let l;o.useRightHandedSystem?l=U.PerspectiveFovRHToRef:l=U.PerspectiveFovLHToRef,l(this.fov,s.getAspectRatio(this),a?this.maxZ:this.minZ,a?this.minZ:this.maxZ,this._projectionMatrix,this.fovMode===Je.FOVMODE_VERTICAL_FIXED,s.isNDCHalfZRange,this.projectionPlaneTilt,a)}else{const l=s.getRenderWidth()/2,h=s.getRenderHeight()/2;o.useRightHandedSystem?this.oblique?U.ObliqueOffCenterRHToRef(this.orthoLeft??-l,this.orthoRight??l,this.orthoBottom??-h,this.orthoTop??h,a?this.maxZ:this.minZ,a?this.minZ:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,s.isNDCHalfZRange):U.OrthoOffCenterRHToRef(this.orthoLeft??-l,this.orthoRight??l,this.orthoBottom??-h,this.orthoTop??h,a?this.maxZ:this.minZ,a?this.minZ:this.maxZ,this._projectionMatrix,s.isNDCHalfZRange):this.oblique?U.ObliqueOffCenterLHToRef(this.orthoLeft??-l,this.orthoRight??l,this.orthoBottom??-h,this.orthoTop??h,a?this.maxZ:this.minZ,a?this.minZ:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,s.isNDCHalfZRange):U.OrthoOffCenterLHToRef(this.orthoLeft??-l,this.orthoRight??l,this.orthoBottom??-h,this.orthoTop??h,a?this.maxZ:this.minZ,a?this.minZ:this.maxZ,this._projectionMatrix,s.isNDCHalfZRange),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.obliqueAngle=(t=this.oblique)==null?void 0:t.angle,this._cache.obliqueLength=(i=this.oblique)==null?void 0:i.length,this._cache.obliqueOffset=(r=this.oblique)==null?void 0:r.offset,this._cache.renderWidth=s.getRenderWidth(),this._cache.renderHeight=s.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix}getTransformationMatrix(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix}_computeObliqueDistance(e){const t=this,i=this;return(t.radius||(i.target?v.Distance(this.position,i.target):this.position.length()))+e}_updateFrustumPlanes(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?Nr.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=Nr.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)}isInFrustum(e,t=!1){if(this._updateFrustumPlanes(),t&&this.rigCameras.length>0){let i=!1;return this.rigCameras.forEach(r=>{r._updateFrustumPlanes(),i=i||e.isInFrustum(r._frustumPlanes)}),i}else return e.isInFrustum(this._frustumPlanes)}isCompletelyInFrustum(e){return this._updateFrustumPlanes(),e.isCompletelyInFrustum(this._frustumPlanes)}getForwardRay(e=100,t,i){throw Ge("Ray")}getForwardRayToRef(e,t=100,i,r){throw Ge("Ray")}dispose(e,t=!1){for(this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.getScene().stopAnimation(this),this.getScene().removeCamera(this);this._rigCameras.length>0;){const r=this._rigCameras.pop();r&&r.dispose()}if(this._parentContainer){const r=this._parentContainer.cameras.indexOf(this);r>-1&&this._parentContainer.cameras.splice(r,1),this._parentContainer=null}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses.length=0;else if(this.cameraRigMode!==Je.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses.length=0;else{let r=this._postProcesses.length;for(;--r>=0;){const s=this._postProcesses[r];s&&s.dispose(this)}}let i=this.customRenderTargets.length;for(;--i>=0;)this.customRenderTargets[i].dispose();this.customRenderTargets.length=0,this._activeMeshes.dispose(),this.getScene().getEngine().releaseRenderPassId(this.renderPassId),super.dispose(e,t)}get isLeftCamera(){return this._isLeftCamera}get isRightCamera(){return this._isRightCamera}get leftCamera(){return this._rigCameras.length<1?null:this._rigCameras[0]}get rightCamera(){return this._rigCameras.length<2?null:this._rigCameras[1]}getLeftTarget(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()}getRightTarget(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()}setCameraRigMode(e,t){if(this.cameraRigMode!==e){for(;this._rigCameras.length>0;){const i=this._rigCameras.pop();i&&i.dispose()}if(this.cameraRigMode=e,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=t.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=ge.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==Je.RIG_MODE_NONE){const i=this.createRigCamera(this.name+"_L",0);i&&(i._isLeftCamera=!0);const r=this.createRigCamera(this.name+"_R",1);r&&(r._isRightCamera=!0),i&&r&&(this._rigCameras.push(i),this._rigCameras.push(r))}this._setRigMode(t),this._cascadePostProcessesToRigCams(),this.update()}}_setRigMode(e){}_getVRProjectionMatrix(){return U.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.minZ,this.maxZ,this._cameraRigParams.vrWorkMatrix,!0,this.getEngine().isNDCHalfZRange),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix}setCameraRigParameter(e,t){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[e]=t,e==="interaxialDistance"&&(this._cameraRigParams.stereoHalfAngle=ge.ToRadians(t/.0637))}createRigCamera(e,t){return null}_updateRigCameras(){for(let e=0;e<this._rigCameras.length;e++)this._rigCameras[e].minZ=this.minZ,this._rigCameras[e].maxZ=this.maxZ,this._rigCameras[e].fov=this.fov,this._rigCameras[e].upVector.copyFrom(this.upVector);this.cameraRigMode===Je.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)}_setupInputs(){}serialize(){const e=Le.Serialize(this);return e.uniqueId=this.uniqueId,e.type=this.getClassName(),this.parent&&this.parent._serializeAsParent(e),this.inputs&&this.inputs.serialize(e),Le.AppendSerializedAnimations(this,e),e.ranges=this.serializeAnimationRanges(),e.isEnabled=this.isEnabled(),e}clone(e,t=null){const i=Le.Clone(Je.GetConstructorFromName(this.getClassName(),e,this.getScene(),this.interaxialDistance,this.isStereoscopicSideBySide),this);return i.name=e,i.parent=t,this.onClonedObservable.notifyObservers(i),i}getDirection(e){const t=v.Zero();return this.getDirectionToRef(e,t),t}get absoluteRotation(){return this.getWorldMatrix().decompose(void 0,this._absoluteRotation),this._absoluteRotation}getDirectionToRef(e,t){v.TransformNormalToRef(e,this.getWorldMatrix(),t)}static GetConstructorFromName(e,t,i,r=0,s=!0){return Oi.Construct(e,t,i,{interaxial_distance:r,isStereoscopicSideBySide:s})||(()=>Je._CreateDefaultParsedCamera(t,i))}computeWorldMatrix(){return this.getWorldMatrix()}static Parse(e,t){const i=e.type,r=Je.GetConstructorFromName(i,e.name,t,e.interaxial_distance,e.isStereoscopicSideBySide),s=Le.Parse(r,e,t);if(e.parentId!==void 0&&(s._waitingParentId=e.parentId),e.parentInstanceIndex!==void 0&&(s._waitingParentInstanceIndex=e.parentInstanceIndex),s.inputs&&(s.inputs.parse(e),s._setupInputs()),e.upVector&&(s.upVector=v.FromArray(e.upVector)),s.setPosition&&(s.position.copyFromFloats(0,0,0),s.setPosition(v.FromArray(e.position))),e.target&&s.setTarget&&s.setTarget(v.FromArray(e.target)),e.cameraRigMode){const o=e.interaxial_distance?{interaxialDistance:e.interaxial_distance}:{};s.setCameraRigMode(e.cameraRigMode,o)}if(e.animations){for(let o=0;o<e.animations.length;o++){const a=e.animations[o],l=Er("BABYLON.Animation");l&&s.animations.push(l.Parse(a))}Oi.ParseAnimationRanges(s,e,t)}return e.autoAnimate&&t.beginAnimation(s,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),e.isEnabled!==void 0&&s.setEnabled(e.isEnabled),s}_calculateHandednessMultiplier(){let e=this.getScene().useRightHandedSystem?-1:1;return this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(e*=-1),e}}Je._CreateDefaultParsedCamera=(n,e)=>{throw Ge("UniversalCamera")};Je.PERSPECTIVE_CAMERA=0;Je.ORTHOGRAPHIC_CAMERA=1;Je.FOVMODE_VERTICAL_FIXED=0;Je.FOVMODE_HORIZONTAL_FIXED=1;Je.RIG_MODE_NONE=0;Je.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10;Je.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11;Je.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12;Je.RIG_MODE_STEREOSCOPIC_OVERUNDER=13;Je.RIG_MODE_STEREOSCOPIC_INTERLACED=14;Je.RIG_MODE_VR=20;Je.RIG_MODE_CUSTOM=22;Je.ForceAttachControlToAlwaysPreventDefault=!1;M([mn("position")],Je.prototype,"_position",void 0);M([mn("upVector")],Je.prototype,"_upVector",void 0);M([V()],Je.prototype,"orthoLeft",null);M([V()],Je.prototype,"orthoRight",null);M([V()],Je.prototype,"orthoBottom",null);M([V()],Je.prototype,"orthoTop",null);M([V()],Je.prototype,"fov",void 0);M([V()],Je.prototype,"projectionPlaneTilt",void 0);M([V()],Je.prototype,"minZ",void 0);M([V()],Je.prototype,"maxZ",void 0);M([V()],Je.prototype,"inertia",void 0);M([V()],Je.prototype,"mode",null);M([V()],Je.prototype,"layerMask",void 0);M([V()],Je.prototype,"fovMode",void 0);M([V()],Je.prototype,"cameraRigMode",void 0);M([V()],Je.prototype,"interaxialDistance",void 0);M([V()],Je.prototype,"isStereoscopicSideBySide",void 0);class Ks{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(e){this._func=e}get funcRef(){return this._funcRef}set funcRef(e){this._funcRef=e}get funcMask(){return this._funcMask}set funcMask(e){this._funcMask=e}get opStencilFail(){return this._opStencilFail}set opStencilFail(e){this._opStencilFail=e}get opDepthFail(){return this._opDepthFail}set opDepthFail(e){this._opDepthFail=e}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(e){this._opStencilDepthPass=e}get mask(){return this._mask}set mask(e){this._mask=e}get enabled(){return this._enabled}set enabled(e){this._enabled=e}getClassName(){return"MaterialStencilState"}copyTo(e){Le.Clone(()=>e,this)}serialize(){return Le.Serialize(this)}parse(e,t,i){Le.Parse(()=>this,e,t,i)}}M([V()],Ks.prototype,"func",null);M([V()],Ks.prototype,"funcRef",null);M([V()],Ks.prototype,"funcMask",null);M([V()],Ks.prototype,"opStencilFail",null);M([V()],Ks.prototype,"opDepthFail",null);M([V()],Ks.prototype,"opStencilDepthPass",null);M([V()],Ks.prototype,"mask",null);M([V()],Ks.prototype,"enabled",null);var yi;(function(n){n[n.Created=1]="Created",n[n.Disposed=2]="Disposed",n[n.GetDefineNames=4]="GetDefineNames",n[n.PrepareUniformBuffer=8]="PrepareUniformBuffer",n[n.IsReadyForSubMesh=16]="IsReadyForSubMesh",n[n.PrepareDefines=32]="PrepareDefines",n[n.BindForSubMesh=64]="BindForSubMesh",n[n.PrepareEffect=128]="PrepareEffect",n[n.GetAnimatables=256]="GetAnimatables",n[n.GetActiveTextures=512]="GetActiveTextures",n[n.HasTexture=1024]="HasTexture",n[n.FillRenderTargetTextures=2048]="FillRenderTargetTextures",n[n.HasRenderTargetTextures=4096]="HasRenderTargetTextures",n[n.HardBindForSubMesh=8192]="HardBindForSubMesh"})(yi||(yi={}));function Wh(n){n.indexOf("vClipPlane")===-1&&n.push("vClipPlane"),n.indexOf("vClipPlane2")===-1&&n.push("vClipPlane2"),n.indexOf("vClipPlane3")===-1&&n.push("vClipPlane3"),n.indexOf("vClipPlane4")===-1&&n.push("vClipPlane4"),n.indexOf("vClipPlane5")===-1&&n.push("vClipPlane5"),n.indexOf("vClipPlane6")===-1&&n.push("vClipPlane6")}function Xy(n,e,t){const i=!!(n.clipPlane??e.clipPlane),r=!!(n.clipPlane2??e.clipPlane2),s=!!(n.clipPlane3??e.clipPlane3),o=!!(n.clipPlane4??e.clipPlane4),a=!!(n.clipPlane5??e.clipPlane5),l=!!(n.clipPlane6??e.clipPlane6);i&&t.push("#define CLIPPLANE"),r&&t.push("#define CLIPPLANE2"),s&&t.push("#define CLIPPLANE3"),o&&t.push("#define CLIPPLANE4"),a&&t.push("#define CLIPPLANE5"),l&&t.push("#define CLIPPLANE6")}function Hy(n,e,t){let i=!1;const r=!!(n.clipPlane??e.clipPlane),s=!!(n.clipPlane2??e.clipPlane2),o=!!(n.clipPlane3??e.clipPlane3),a=!!(n.clipPlane4??e.clipPlane4),l=!!(n.clipPlane5??e.clipPlane5),h=!!(n.clipPlane6??e.clipPlane6);return t.CLIPPLANE!==r&&(t.CLIPPLANE=r,i=!0),t.CLIPPLANE2!==s&&(t.CLIPPLANE2=s,i=!0),t.CLIPPLANE3!==o&&(t.CLIPPLANE3=o,i=!0),t.CLIPPLANE4!==a&&(t.CLIPPLANE4=a,i=!0),t.CLIPPLANE5!==l&&(t.CLIPPLANE5=l,i=!0),t.CLIPPLANE6!==h&&(t.CLIPPLANE6=h,i=!0),i}function Xh(n,e,t){let i=e.clipPlane??t.clipPlane;ro(n,"vClipPlane",i),i=e.clipPlane2??t.clipPlane2,ro(n,"vClipPlane2",i),i=e.clipPlane3??t.clipPlane3,ro(n,"vClipPlane3",i),i=e.clipPlane4??t.clipPlane4,ro(n,"vClipPlane4",i),i=e.clipPlane5??t.clipPlane5,ro(n,"vClipPlane5",i),i=e.clipPlane6??t.clipPlane6,ro(n,"vClipPlane6",i)}function ro(n,e,t){t&&n.setFloat4(e,t.normal.x,t.normal.y,t.normal.z,t.d)}const Sg=De.Black();function Hh(n,e,t){if(!n||n.LOGARITHMICDEPTH||n.indexOf&&n.indexOf("LOGARITHMICDEPTH")>=0){const i=t.activeCamera;i.mode===1&&oe.Error("Logarithmic depth is not compatible with orthographic cameras!",20),e.setFloat("logarithmicDepthConstant",2/(Math.log(i.maxZ+1)/Math.LN2))}}function Kh(n,e,t,i=!1){t&&n.fogEnabled&&(!e||e.applyFog)&&n.fogMode!==0&&(t.setFloat4("vFogInfos",n.fogMode,n.fogStart,n.fogEnd,n.fogDensity),i?(n.fogColor.toLinearSpaceToRef(Sg,n.getEngine().useExactSrgbConversions),t.setColor3("vFogColor",Sg)):t.setColor3("vFogColor",n.fogColor))}function p0(n,e,t){const i=t.NUM_MORPH_INFLUENCERS;if(i>0&&rt.LastCreatedEngine){const r=rt.LastCreatedEngine.getCaps().maxVertexAttribs,s=e.morphTargetManager;if(s!=null&&s.isUsingTextureForTargets)return;const o=s&&s.supportsNormals&&t.NORMAL,a=s&&s.supportsTangents&&t.TANGENT,l=s&&s.supportsUVs&&t.UV1;for(let h=0;h<i;h++)n.push("position"+h),o&&n.push("normal"+h),a&&n.push("tangent"+h),l&&n.push("uv_"+h),n.length>r&&oe.Error("Cannot add more vertex attributes for mesh "+e.name)}}function g0(n,e=!1){n.push("world0"),n.push("world1"),n.push("world2"),n.push("world3"),e&&(n.push("previousWorld0"),n.push("previousWorld1"),n.push("previousWorld2"),n.push("previousWorld3"))}function _d(n,e){const t=n.morphTargetManager;!n||!t||e.setFloatArray("morphTargetInfluences",t.influences)}function m0(n,e){e.bindToEffect(n,"Scene")}function wt(n,e,t){e._needUVs=!0,e[t]=!0,n.optimizeUVAllocation&&n.getTextureMatrix().isIdentityAs3x2()?(e[t+"DIRECTUV"]=n.coordinatesIndex+1,e["MAINUV"+(n.coordinatesIndex+1)]=!0):e[t+"DIRECTUV"]=0}function At(n,e,t){const i=n.getTextureMatrix();e.updateMatrix(t+"Matrix",i)}function vd(n,e,t){t.BAKED_VERTEX_ANIMATION_TEXTURE&&t.INSTANCES&&n.push("bakedVertexAnimationSettingsInstanced")}function Ky(n,e){return e.set(n),e}function Ed(n,e,t){if(!(!e||!n)&&(n.computeBonesUsingShaders&&e._bonesComputationForcedToCPU&&(n.computeBonesUsingShaders=!1),n.useBones&&n.computeBonesUsingShaders&&n.skeleton)){const i=n.skeleton;if(i.isUsingTextureForMatrices&&e.getUniformIndex("boneTextureWidth")>-1){const r=i.getTransformMatrixTexture(n);e.setTexture("boneSampler",r),e.setFloat("boneTextureWidth",4*(i.bones.length+1))}else{const r=i.getTransformMatrices(n);r&&(e.setMatrices("mBones",r),t&&n.getScene().prePassRenderer&&n.getScene().prePassRenderer.getIndex(2)&&(t.previousBones[n.uniqueId]||(t.previousBones[n.uniqueId]=r.slice()),e.setMatrices("mPreviousBones",t.previousBones[n.uniqueId]),Ky(r,t.previousBones[n.uniqueId])))}}}function qy(n,e,t,i,r,s=!0){n._bindLight(e,t,i,r,s)}function _0(n,e,t,i,r=4){const s=Math.min(e.lightSources.length,r);for(let o=0;o<s;o++){const a=e.lightSources[o];qy(a,o,n,t,typeof i=="boolean"?i:i.SPECULARTERM,e.receiveShadows)}}function v0(n,e,t,i){t.NUM_BONE_INFLUENCERS>0&&(i.addCPUSkinningFallback(0,e),n.push("matricesIndices"),n.push("matricesWeights"),t.NUM_BONE_INFLUENCERS>4&&(n.push("matricesIndicesExtra"),n.push("matricesWeightsExtra")))}function Td(n,e){(e.INSTANCES||e.THIN_INSTANCES)&&g0(n,!!e.PREPASS_VELOCITY),e.INSTANCESCOLOR&&n.push("instanceColor")}function E0(n,e,t=4,i=0){let r=0;for(let s=0;s<t&&n["LIGHT"+s];s++)s>0&&(r=i+s,e.addFallback(r,"LIGHT"+s)),n.SHADOWS||(n["SHADOW"+s]&&e.addFallback(i,"SHADOW"+s),n["SHADOWPCF"+s]&&e.addFallback(i,"SHADOWPCF"+s),n["SHADOWPCSS"+s]&&e.addFallback(i,"SHADOWPCSS"+s),n["SHADOWPOISSON"+s]&&e.addFallback(i,"SHADOWPOISSON"+s),n["SHADOWESM"+s]&&e.addFallback(i,"SHADOWESM"+s),n["SHADOWCLOSEESM"+s]&&e.addFallback(i,"SHADOWCLOSEESM"+s));return r++}function Yy(n,e){return e.fogEnabled&&n.applyFog&&e.fogMode!==0}function xd(n,e,t,i,r,s,o,a=!1){o._areMiscDirty&&(o.LOGARITHMICDEPTH=t,o.POINTSIZE=i,o.FOG=r&&Yy(n,e),o.NONUNIFORMSCALING=n.nonUniformScaling,o.ALPHATEST=s,o.DECAL_AFTER_DETAIL=a)}function T0(n,e,t,i,r=4,s=!1){if(!t._areLightsDirty)return t._needNormals;let o=0;const a={needNormals:t._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(n.lightsEnabled&&!s){for(const h of e.lightSources)if(Zy(n,e,h,o,t,i,a),o++,o===r)break}t.SPECULARTERM=a.specularEnabled,t.SHADOWS=a.shadowEnabled;for(let h=o;h<r;h++)t["LIGHT"+h]!==void 0&&(t["LIGHT"+h]=!1,t["HEMILIGHT"+h]=!1,t["POINTLIGHT"+h]=!1,t["DIRLIGHT"+h]=!1,t["SPOTLIGHT"+h]=!1,t["SHADOW"+h]=!1,t["SHADOWCSM"+h]=!1,t["SHADOWCSMDEBUG"+h]=!1,t["SHADOWCSMNUM_CASCADES"+h]=!1,t["SHADOWCSMUSESHADOWMAXZ"+h]=!1,t["SHADOWCSMNOBLEND"+h]=!1,t["SHADOWCSM_RIGHTHANDED"+h]=!1,t["SHADOWPCF"+h]=!1,t["SHADOWPCSS"+h]=!1,t["SHADOWPOISSON"+h]=!1,t["SHADOWESM"+h]=!1,t["SHADOWCLOSEESM"+h]=!1,t["SHADOWCUBE"+h]=!1,t["SHADOWLOWQUALITY"+h]=!1,t["SHADOWMEDIUMQUALITY"+h]=!1);const l=n.getEngine().getCaps();return t.SHADOWFLOAT===void 0&&(a.needRebuild=!0),t.SHADOWFLOAT=a.shadowEnabled&&(l.textureFloatRender&&l.textureFloatLinearFiltering||l.textureHalfFloatRender&&l.textureHalfFloatLinearFiltering),t.LIGHTMAPEXCLUDED=a.lightmapMode,a.needRebuild&&t.rebuild(),a.needNormals}function Zy(n,e,t,i,r,s,o){switch(o.needNormals=!0,r["LIGHT"+i]===void 0&&(o.needRebuild=!0),r["LIGHT"+i]=!0,r["SPOTLIGHT"+i]=!1,r["HEMILIGHT"+i]=!1,r["POINTLIGHT"+i]=!1,r["DIRLIGHT"+i]=!1,t.prepareLightSpecificDefines(r,i),r["LIGHT_FALLOFF_PHYSICAL"+i]=!1,r["LIGHT_FALLOFF_GLTF"+i]=!1,r["LIGHT_FALLOFF_STANDARD"+i]=!1,t.falloffType){case mt.FALLOFF_GLTF:r["LIGHT_FALLOFF_GLTF"+i]=!0;break;case mt.FALLOFF_PHYSICAL:r["LIGHT_FALLOFF_PHYSICAL"+i]=!0;break;case mt.FALLOFF_STANDARD:r["LIGHT_FALLOFF_STANDARD"+i]=!0;break}if(s&&!t.specular.equalsFloats(0,0,0)&&(o.specularEnabled=!0),r["SHADOW"+i]=!1,r["SHADOWCSM"+i]=!1,r["SHADOWCSMDEBUG"+i]=!1,r["SHADOWCSMNUM_CASCADES"+i]=!1,r["SHADOWCSMUSESHADOWMAXZ"+i]=!1,r["SHADOWCSMNOBLEND"+i]=!1,r["SHADOWCSM_RIGHTHANDED"+i]=!1,r["SHADOWPCF"+i]=!1,r["SHADOWPCSS"+i]=!1,r["SHADOWPOISSON"+i]=!1,r["SHADOWESM"+i]=!1,r["SHADOWCLOSEESM"+i]=!1,r["SHADOWCUBE"+i]=!1,r["SHADOWLOWQUALITY"+i]=!1,r["SHADOWMEDIUMQUALITY"+i]=!1,e&&e.receiveShadows&&n.shadowsEnabled&&t.shadowEnabled){const a=t.getShadowGenerator(n.activeCamera)??t.getShadowGenerator();if(a){const l=a.getShadowMap();l&&l.renderList&&l.renderList.length>0&&(o.shadowEnabled=!0,a.prepareDefines(r,i))}}t.lightmapMode!=mt.LIGHTMAP_DEFAULT?(o.lightmapMode=!0,r["LIGHTMAPEXCLUDED"+i]=!0,r["LIGHTMAPNOSPECULAR"+i]=t.lightmapMode==mt.LIGHTMAP_SHADOWSONLY):(r["LIGHTMAPEXCLUDED"+i]=!1,r["LIGHTMAPNOSPECULAR"+i]=!1)}function Cd(n,e,t,i,r,s=null,o=!1){let a=$y(n,i);s!==!1&&(a=Hy(t,n,i)),i.DEPTHPREPASS!==!e.getColorWrite()&&(i.DEPTHPREPASS=!i.DEPTHPREPASS,a=!0),i.INSTANCES!==r&&(i.INSTANCES=r,a=!0),i.THIN_INSTANCES!==o&&(i.THIN_INSTANCES=o,a=!0),a&&i.markAsUnprocessed()}function jy(n,e){if(n.useBones&&n.computeBonesUsingShaders&&n.skeleton){e.NUM_BONE_INFLUENCERS=n.numBoneInfluencers;const t=e.BONETEXTURE!==void 0;if(n.skeleton.isUsingTextureForMatrices&&t)e.BONETEXTURE=!0;else{e.BonesPerMesh=n.skeleton.bones.length+1,e.BONETEXTURE=t?!1:void 0;const i=n.getScene().prePassRenderer;if(i&&i.enabled){const r=i.excludedSkinnedMesh.indexOf(n)===-1;e.BONES_VELOCITY_ENABLED=r}}}else e.NUM_BONE_INFLUENCERS=0,e.BonesPerMesh=0,e.BONETEXTURE!==void 0&&(e.BONETEXTURE=!1)}function Qy(n,e){const t=n.morphTargetManager;t?(e.MORPHTARGETS_UV=t.supportsUVs&&e.UV1,e.MORPHTARGETS_TANGENT=t.supportsTangents&&e.TANGENT,e.MORPHTARGETS_NORMAL=t.supportsNormals&&e.NORMAL,e.NUM_MORPH_INFLUENCERS=t.numMaxInfluencers||t.numInfluencers,e.MORPHTARGETS=e.NUM_MORPH_INFLUENCERS>0,e.MORPHTARGETS_TEXTURE=t.isUsingTextureForTargets):(e.MORPHTARGETS_UV=!1,e.MORPHTARGETS_TANGENT=!1,e.MORPHTARGETS_NORMAL=!1,e.MORPHTARGETS=!1,e.NUM_MORPH_INFLUENCERS=0)}function Jy(n,e){const t=n.bakedVertexAnimationManager;e.BAKED_VERTEX_ANIMATION_TEXTURE=!!(t&&t.isEnabled)}function Rd(n,e,t,i,r=!1,s=!0,o=!0){if(!e._areAttributesDirty&&e._needNormals===e._normals&&e._needUVs===e._uvs)return!1;e._normals=e._needNormals,e._uvs=e._needUVs,e.NORMAL=e._needNormals&&n.isVerticesDataPresent("normal"),e._needNormals&&n.isVerticesDataPresent("tangent")&&(e.TANGENT=!0);for(let a=1;a<=6;++a)e["UV"+a]=e._needUVs?n.isVerticesDataPresent(`uv${a===1?"":a}`):!1;if(t){const a=n.useVertexColors&&n.isVerticesDataPresent("color");e.VERTEXCOLOR=a,e.VERTEXALPHA=n.hasVertexAlpha&&a&&s}return n.isVerticesDataPresent("instanceColor")&&(n.hasInstances||n.hasThinInstances)&&(e.INSTANCESCOLOR=!0),i&&jy(n,e),r&&Qy(n,e),o&&Jy(n,e),!0}function x0(n,e){if(n.activeCamera){const t=e.MULTIVIEW;e.MULTIVIEW=n.activeCamera.outputRenderTarget!==null&&n.activeCamera.outputRenderTarget.getViewCount()>1,e.MULTIVIEW!=t&&e.markAsUnprocessed()}}function C0(n,e,t){const i=e.ORDER_INDEPENDENT_TRANSPARENCY,r=e.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;e.ORDER_INDEPENDENT_TRANSPARENCY=n.useOrderIndependentTransparency&&t,e.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!n.getEngine().getCaps().textureFloatLinearFiltering,(i!==e.ORDER_INDEPENDENT_TRANSPARENCY||r!==e.ORDER_INDEPENDENT_TRANSPARENCY_16BITS)&&e.markAsUnprocessed()}function R0(n,e,t){const i=e.PREPASS;if(!e._arePrePassDirty)return;const r=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"}];if(n.prePassRenderer&&n.prePassRenderer.enabled&&t){e.PREPASS=!0,e.SCENE_MRT_COUNT=n.prePassRenderer.mrtCount,e.PREPASS_NORMAL_WORLDSPACE=n.prePassRenderer.generateNormalsInWorldSpace;for(let s=0;s<r.length;s++){const o=n.prePassRenderer.getIndex(r[s].type);o!==-1?(e[r[s].define]=!0,e[r[s].index]=o):e[r[s].define]=!1}}else{e.PREPASS=!1;for(let s=0;s<r.length;s++)e[r[s].define]=!1}e.PREPASS!=i&&(e.markAsUnprocessed(),e.markAsImageProcessingDirty())}function $y(n,e){let t=!1;if(n.activeCamera){const i=e.CAMERA_ORTHOGRAPHIC?1:0,r=e.CAMERA_PERSPECTIVE?1:0,s=n.activeCamera.mode===1?1:0,o=n.activeCamera.mode===0?1:0;(i^s||r^o)&&(e.CAMERA_ORTHOGRAPHIC=s===1,e.CAMERA_PERSPECTIVE=o===1,t=!0)}return t}function eb(n,e,t,i,r=null,s=!1){r&&r.push("Light"+n),!s&&(e.push("vLightData"+n,"vLightDiffuse"+n,"vLightSpecular"+n,"vLightDirection"+n,"vLightFalloff"+n,"vLightGround"+n,"lightMatrix"+n,"shadowsInfo"+n,"depthValues"+n),t.push("shadowSampler"+n),t.push("depthSampler"+n),e.push("viewFrustumZ"+n,"cascadeBlendFactor"+n,"lightSizeUVCorrection"+n,"depthCorrection"+n,"penumbraDarkness"+n,"frustumLengths"+n),i&&(t.push("projectionLightSampler"+n),e.push("textureProjectionMatrix"+n)))}function Sd(n,e,t,i=4){let r,s=null;if(n.uniformsNames){const o=n;r=o.uniformsNames,s=o.uniformBuffersNames,e=o.samplers,t=o.defines,i=o.maxSimultaneousLights||0}else r=n,e||(e=[]);for(let o=0;o<i&&t["LIGHT"+o];o++)eb(o,r,e,t["PROJECTEDLIGHTTEXTURE"+o],s);t.NUM_MORPH_INFLUENCERS&&(r.push("morphTargetInfluences"),r.push("morphTargetCount")),t.BAKED_VERTEX_ANIMATION_TEXTURE&&(r.push("bakedVertexAnimationSettings"),r.push("bakedVertexAnimationTextureSizeInverted"),r.push("bakedVertexAnimationTime"),e.push("bakedVertexAnimationTexture"))}class ie{get canRenderToMRT(){return!1}set alpha(e){if(this._alpha===e)return;const t=this._alpha;this._alpha=e,(t===1||e===1)&&this.markAsDirty(ie.MiscDirtyFlag+ie.PrePassDirtyFlag)}get alpha(){return this._alpha}set backFaceCulling(e){this._backFaceCulling!==e&&(this._backFaceCulling=e,this.markAsDirty(ie.TextureDirtyFlag))}get backFaceCulling(){return this._backFaceCulling}set cullBackFaces(e){this._cullBackFaces!==e&&(this._cullBackFaces=e,this.markAsDirty(ie.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(e){this._blockDirtyMechanism!==e&&(this._blockDirtyMechanism=e,e||this.markDirty())}atomicMaterialsUpdate(e){this.blockDirtyMechanism=!0;try{e(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new he),this._onBindObservable}set onBind(e){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(e)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new he),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new he),this._onEffectCreatedObservable}set alphaMode(e){this._alphaMode!==e&&(this._alphaMode=e,this.markAsDirty(ie.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(e){this._needDepthPrePass!==e&&(this._needDepthPrePass=e,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(e){this._fogEnabled!==e&&(this._fogEnabled=e,this.markAsDirty(ie.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case ie.WireFrameFillMode:case ie.LineListDrawMode:case ie.LineLoopDrawMode:case ie.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(e){this.fillMode=e?ie.WireFrameFillMode:ie.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case ie.PointFillMode:case ie.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(e){this.fillMode=e?ie.PointFillMode:ie.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(e){this._fillMode!==e&&(this._fillMode=e,this.markAsDirty(ie.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(e){const t=this.getScene().getEngine().getCaps().fragmentDepthSupported;e&&!t&&oe.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=e&&t,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(e){this._drawWrapper=e}constructor(e,t,i){this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.onDisposeObservable=new he,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.stencil=new Ks,this._useUBO=!1,this._fillMode=ie.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._forceAlphaTest=!1,this._transparencyMode=null,this.name=e;const r=t||rt.LastCreatedScene;r&&(this._scene=r,this._dirtyCallbacks={},this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[63]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=e||ge.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new Ko(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._scene.useRightHandedSystem?this.sideOrientation=ie.ClockWiseSideOrientation:this.sideOrientation=ie.CounterClockWiseSideOrientation,this._uniformBuffer=new Ie(this._scene.getEngine(),void 0,void 0,e),this._useUBO=this.getScene().getEngine().supportsUniformBuffers,i||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),ie.OnEventObservable.notifyObservers(this,yi.Created))}toString(e){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.markDirty(),this.checkReadyOnlyOnce=!0}unfreeze(){this.markDirty(),this.checkReadyOnlyOnce=!1}isReady(e,t){return!0}isReadyForSubMesh(e,t,i){const r=t.materialDefines;return r?(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=r,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh):!1}getEffect(){return this._drawWrapper.effect}getScene(){return this._scene}get transparencyMode(){return this._transparencyMode}set transparencyMode(e){this._transparencyMode!==e&&(this._transparencyMode=e,this._forceAlphaTest=e===ie.MATERIAL_ALPHATESTANDBLEND,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _disableAlphaBlending(){return this._transparencyMode===ie.MATERIAL_OPAQUE||this._transparencyMode===ie.MATERIAL_ALPHATEST}needAlphaBlending(){return this._disableAlphaBlending?!1:this.alpha<1}needAlphaBlendingForMesh(e){return e.visibility<1?!0:this._disableAlphaBlending?!1:e.hasVertexAlpha||this.needAlphaBlending()}needAlphaTesting(){return!!this._forceAlphaTest}_shouldTurnAlphaTestOn(e){return!this.needAlphaBlendingForMesh(e)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}markDirty(e=!1){const t=this.getScene().meshes;for(const i of t)if(i.subMeshes){for(const r of i.subMeshes)if(r.getMaterial()===this)for(const s of r._drawWrappers)s&&this._materialContext===s.materialContext&&(s._wasPreviouslyReady=!1,s._wasPreviouslyUsingInstances=null,s._forceRebindOnNextCall=e)}e&&this.markAsDirty(ie.AllDirtyFlag)}_preBind(e,t=null){const i=this._scene.getEngine(),r=(t??this.sideOrientation)===ie.ClockWiseSideOrientation;return i.enableEffect(e||this._getDrawWrapper()),i.setState(this.backFaceCulling,this.zOffset,!1,r,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.stencil,this.zOffsetUnits),r}bind(e,t){}buildUniformLayout(){const e=this._uniformBuffer;this._eventInfo.ubo=e,this._callbackPluginEventGeneric(yi.PrepareUniformBuffer,this._eventInfo),e.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(e,t,i){const r=i._drawWrapper;this._eventInfo.subMesh=i,this._callbackPluginEventBindForSubMesh(this._eventInfo),r._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(e){}bindView(e){this._useUBO?this._needToBindSceneUbo=!0:e.setMatrix("view",this.getScene().getViewMatrix())}bindViewProjection(e){this._useUBO?this._needToBindSceneUbo=!0:(e.setMatrix("viewProjection",this.getScene().getTransformMatrix()),e.setMatrix("projection",this.getScene().getProjectionMatrix()))}bindEyePosition(e,t){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(e,t)}_afterBind(e,t=null,i){if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&t&&(this._needToBindSceneUbo=!1,m0(t,this.getScene().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),e?this._scene._cachedVisibility=e.visibility:this._scene._cachedVisibility=1,this._onBindObservable&&e&&this._onBindObservable.notifyObservers(e),this.disableDepthWrite){const r=this._scene.getEngine();this._cachedDepthWriteState=r.getDepthWrite(),r.setDepthWrite(!1)}if(this.disableColorWrite){const r=this._scene.getEngine();this._cachedColorWriteState=r.getColorWrite(),r.setColorWrite(!1)}if(this.depthFunction!==0){const r=this._scene.getEngine();this._cachedDepthFunctionState=r.getDepthFunction()||0,r.setDepthFunction(this.depthFunction)}}unbind(){this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),this.depthFunction!==0&&this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState),this.disableDepthWrite&&this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState),this.disableColorWrite&&this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(yi.GetAnimatables,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(yi.GetActiveTextures,this._eventInfo),this._eventInfo.activeTextures}hasTexture(e){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=e,this._callbackPluginEventGeneric(yi.HasTexture,this._eventInfo),this._eventInfo.hasTexture}clone(e){return null}_clonePlugins(e,t){const i={};if(this._serializePlugins(i),ie._ParsePlugins(i,e,this._scene,t),this.pluginManager)for(const r of this.pluginManager._plugins){const s=e.pluginManager.getPlugin(r.name);s&&r.copyTo(s)}}getBindedMeshes(){if(this.meshMap){const e=[];for(const t in this.meshMap){const i=this.meshMap[t];i&&e.push(i)}return e}else return this._scene.meshes.filter(e=>e.material===this)}forceCompilation(e,t,i,r){const s={clipPlane:!1,useInstances:!1,...i},o=this.getScene(),a=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const l=()=>{if(!this._scene||!this._scene.getEngine())return;const h=o.clipPlane;if(s.clipPlane&&(o.clipPlane=new Zr(0,0,0,1)),this._storeEffectOnSubMeshes){let c=!0,u=null;if(e.subMeshes){const d=new Pi(0,0,0,0,0,e,void 0,!1,!1);d.materialDefines&&(d.materialDefines._renderId=-1),this.isReadyForSubMesh(e,d,s.useInstances)||(d.effect&&d.effect.getCompilationError()&&d.effect.allFallbacksProcessed()?u=d.effect.getCompilationError():(c=!1,setTimeout(l,16)))}c&&(this.allowShaderHotSwapping=a,u&&r&&r(u),t&&t(this))}else this.isReady()?(this.allowShaderHotSwapping=a,t&&t(this)):setTimeout(l,16);s.clipPlane&&(o.clipPlane=h)};l()}forceCompilationAsync(e,t){return new Promise((i,r)=>{this.forceCompilation(e,()=>{i()},t,s=>{r(s)})})}markAsDirty(e){this.getScene().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(ie._DirtyCallbackArray.length=0,e&ie.TextureDirtyFlag&&ie._DirtyCallbackArray.push(ie._TextureDirtyCallBack),e&ie.LightDirtyFlag&&ie._DirtyCallbackArray.push(ie._LightsDirtyCallBack),e&ie.FresnelDirtyFlag&&ie._DirtyCallbackArray.push(ie._FresnelDirtyCallBack),e&ie.AttributesDirtyFlag&&ie._DirtyCallbackArray.push(ie._AttributeDirtyCallBack),e&ie.MiscDirtyFlag&&ie._DirtyCallbackArray.push(ie._MiscDirtyCallBack),e&ie.PrePassDirtyFlag&&ie._DirtyCallbackArray.push(ie._PrePassDirtyCallBack),ie._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(ie._RunDirtyCallBacks),this.getScene().resetCachedMaterial())}resetDrawCache(){const e=this.getScene().meshes;for(const t of e)if(t.subMeshes)for(const i of t.subMeshes)i.getMaterial()===this&&i.resetDrawCache()}_markAllSubMeshesAsDirty(e){if(this.getScene().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const t=this.getScene().meshes;for(const i of t)if(i.subMeshes){for(const r of i.subMeshes)if(r.getMaterial(!1)===this)for(const s of r._drawWrappers)!s||!s.defines||!s.defines.markAllAsDirty||this._materialContext===s.materialContext&&e(s.defines)}}_markScenePrePassDirty(){if(this.getScene().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const e=this.getScene().enablePrePassRenderer();e&&e.markAsDirty()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(ie._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(ie._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(ie._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(ie._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(ie._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(ie._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(ie._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(ie._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(ie._MiscDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(ie._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(this._scene.performancePriority!==vs.BackwardCompatible){this.checkReadyOnlyOnce=!0;const e=this._scene.onScenePerformancePriorityChangedObservable.addOnce(()=>{this.checkReadyOnlyOnce=!1});this.onDisposeObservable.add(()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(e)})}}setPrePassRenderer(e){return!1}dispose(e,t,i){const r=this.getScene();if(r.stopAnimation(this),r.freeProcessedMaterials(),r.removeMaterial(this),this._eventInfo.forceDisposeTextures=t,this._callbackPluginEventGeneric(yi.Disposed,this._eventInfo),this._parentContainer){const s=this._parentContainer.materials.indexOf(this);s>-1&&this._parentContainer.materials.splice(s,1),this._parentContainer=null}if(i!==!0)if(this.meshMap)for(const s in this.meshMap){const o=this.meshMap[s];o&&(o.material=null,this.releaseVertexArrayObject(o,e))}else{const s=r.meshes;for(const o of s)o.material===this&&!o.sourceMesh&&(o.material=null,this.releaseVertexArrayObject(o,e))}this._uniformBuffer.dispose(),e&&this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}releaseVertexArrayObject(e,t){const i=e.geometry;if(i)if(this._storeEffectOnSubMeshes){if(e.subMeshes)for(const r of e.subMeshes)i._releaseVertexArrayObject(r.effect),t&&r.effect&&r.effect.dispose()}else i._releaseVertexArrayObject(this._drawWrapper.effect)}serialize(){const e=Le.Serialize(this);return e.stencil=this.stencil.serialize(),e.uniqueId=this.uniqueId,this._serializePlugins(e),e}_serializePlugins(e){if(e.plugins={},this.pluginManager)for(const t of this.pluginManager._plugins)e.plugins[t.getClassName()]=t.serialize()}static Parse(e,t,i){if(!e.customType)e.customType="BABYLON.StandardMaterial";else if(e.customType==="BABYLON.PBRMaterial"&&e.overloadedAlbedo&&(e.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return oe.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null;const r=ge.Instantiate(e.customType).Parse(e,t,i);return r._loadedUniqueId=e.uniqueId,r}static _ParsePlugins(e,t,i,r){var s;if(e.plugins)for(const o in e.plugins){const a=e.plugins[o];let l=(s=t.pluginManager)==null?void 0:s.getPlugin(a.name);if(!l){const h=ge.Instantiate("BABYLON."+o);h&&(l=new h(t))}l==null||l.parse(a,i,r)}}}ie.TriangleFillMode=0;ie.WireFrameFillMode=1;ie.PointFillMode=2;ie.PointListDrawMode=3;ie.LineListDrawMode=4;ie.LineLoopDrawMode=5;ie.LineStripDrawMode=6;ie.TriangleStripDrawMode=7;ie.TriangleFanDrawMode=8;ie.ClockWiseSideOrientation=0;ie.CounterClockWiseSideOrientation=1;ie.TextureDirtyFlag=1;ie.LightDirtyFlag=2;ie.FresnelDirtyFlag=4;ie.AttributesDirtyFlag=8;ie.MiscDirtyFlag=16;ie.PrePassDirtyFlag=32;ie.AllDirtyFlag=63;ie.MATERIAL_OPAQUE=0;ie.MATERIAL_ALPHATEST=1;ie.MATERIAL_ALPHABLEND=2;ie.MATERIAL_ALPHATESTANDBLEND=3;ie.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0;ie.MATERIAL_NORMALBLENDMETHOD_RNM=1;ie.OnEventObservable=new he;ie._AllDirtyCallBack=n=>n.markAllAsDirty();ie._ImageProcessingDirtyCallBack=n=>n.markAsImageProcessingDirty();ie._TextureDirtyCallBack=n=>n.markAsTexturesDirty();ie._FresnelDirtyCallBack=n=>n.markAsFresnelDirty();ie._MiscDirtyCallBack=n=>n.markAsMiscDirty();ie._PrePassDirtyCallBack=n=>n.markAsPrePassDirty();ie._LightsDirtyCallBack=n=>n.markAsLightDirty();ie._AttributeDirtyCallBack=n=>n.markAsAttributesDirty();ie._FresnelAndMiscDirtyCallBack=n=>{ie._FresnelDirtyCallBack(n),ie._MiscDirtyCallBack(n)};ie._TextureAndMiscDirtyCallBack=n=>{ie._TextureDirtyCallBack(n),ie._MiscDirtyCallBack(n)};ie._DirtyCallbackArray=[];ie._RunDirtyCallBacks=n=>{for(const e of ie._DirtyCallbackArray)e(n)};M([V()],ie.prototype,"id",void 0);M([V()],ie.prototype,"uniqueId",void 0);M([V()],ie.prototype,"name",void 0);M([V()],ie.prototype,"metadata",void 0);M([V()],ie.prototype,"checkReadyOnEveryCall",void 0);M([V()],ie.prototype,"checkReadyOnlyOnce",void 0);M([V()],ie.prototype,"state",void 0);M([V("alpha")],ie.prototype,"_alpha",void 0);M([V("backFaceCulling")],ie.prototype,"_backFaceCulling",void 0);M([V("cullBackFaces")],ie.prototype,"_cullBackFaces",void 0);M([V()],ie.prototype,"sideOrientation",void 0);M([V("alphaMode")],ie.prototype,"_alphaMode",void 0);M([V()],ie.prototype,"_needDepthPrePass",void 0);M([V()],ie.prototype,"disableDepthWrite",void 0);M([V()],ie.prototype,"disableColorWrite",void 0);M([V()],ie.prototype,"forceDepthWrite",void 0);M([V()],ie.prototype,"depthFunction",void 0);M([V()],ie.prototype,"separateCullingPass",void 0);M([V("fogEnabled")],ie.prototype,"_fogEnabled",void 0);M([V()],ie.prototype,"pointSize",void 0);M([V()],ie.prototype,"zOffset",void 0);M([V()],ie.prototype,"zOffsetUnits",void 0);M([V()],ie.prototype,"pointsCloud",null);M([V()],ie.prototype,"fillMode",null);M([V()],ie.prototype,"useLogarithmicDepth",null);M([V()],ie.prototype,"transparencyMode",null);class Fo extends ie{get subMaterials(){return this._subMaterials}set subMaterials(e){this._subMaterials=e,this._hookArray(e)}getChildren(){return this.subMaterials}constructor(e,t){super(e,t,!0),this._waitingSubMaterialsUniqueIds=[],this.getScene().addMultiMaterial(this),this.subMaterials=[],this._storeEffectOnSubMeshes=!0}_hookArray(e){const t=e.push;e.push=(...r)=>{const s=t.apply(e,r);return this._markAllSubMeshesAsTexturesDirty(),s};const i=e.splice;e.splice=(r,s)=>{const o=i.apply(e,[r,s]);return this._markAllSubMeshesAsTexturesDirty(),o}}getSubMaterial(e){return e<0||e>=this.subMaterials.length?this.getScene().defaultMaterial:this.subMaterials[e]}getActiveTextures(){return super.getActiveTextures().concat(...this.subMaterials.map(e=>e?e.getActiveTextures():[]))}hasTexture(e){var t;if(super.hasTexture(e))return!0;for(let i=0;i<this.subMaterials.length;i++)if((t=this.subMaterials[i])!=null&&t.hasTexture(e))return!0;return!1}getClassName(){return"MultiMaterial"}isReadyForSubMesh(e,t,i){for(let r=0;r<this.subMaterials.length;r++){const s=this.subMaterials[r];if(s){if(s._storeEffectOnSubMeshes){if(!s.isReadyForSubMesh(e,t,i))return!1;continue}if(!s.isReady(e))return!1}}return!0}clone(e,t){const i=new Fo(e,this.getScene());for(let r=0;r<this.subMaterials.length;r++){let s=null;const o=this.subMaterials[r];t&&o?s=o.clone(e+"-"+o.name):s=this.subMaterials[r],i.subMaterials.push(s)}return i}serialize(){const e={};e.name=this.name,e.id=this.id,e.uniqueId=this.uniqueId,it&&(e.tags=it.GetTags(this)),e.materialsUniqueIds=[],e.materials=[];for(let t=0;t<this.subMaterials.length;t++){const i=this.subMaterials[t];i?(e.materialsUniqueIds.push(i.uniqueId),e.materials.push(i.id)):(e.materialsUniqueIds.push(null),e.materials.push(null))}return e}dispose(e,t,i){const r=this.getScene();if(!r)return;if(i)for(let o=0;o<this.subMaterials.length;o++){const a=this.subMaterials[o];a&&a.dispose(e,t)}const s=r.multiMaterials.indexOf(this);s>=0&&r.multiMaterials.splice(s,1),super.dispose(e,t)}static ParseMultiMaterial(e,t){const i=new Fo(e.name,t);return i.id=e.id,i._loadedUniqueId=e.uniqueId,it&&it.AddTagsTo(i,e.tags),e.materialsUniqueIds?i._waitingSubMaterialsUniqueIds=e.materialsUniqueIds:e.materials.forEach(r=>i.subMaterials.push(t.getLastMaterialById(r))),i}}ye("BABYLON.MultiMaterial",Fo);class tb{constructor(e,t){this.distanceOrScreenCoverage=e,this.mesh=t}}class S0{}class ib{constructor(){this.visibleInstances={},this.batchCache=new yg,this.batchCacheReplacementModeInFrozenMode=new yg,this.instancesBufferSize=32*16*4}}class yg{constructor(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=[],this.hardwareInstancedRendering=[]}}class rb{constructor(){this.instancesCount=0,this.matrixBuffer=null,this.previousMatrixBuffer=null,this.matrixBufferSize=32*16,this.matrixData=null,this.boundingVectors=[],this.worldMatrices=null}}class sb{constructor(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._useLODScreenCoverage=!1,this._effectiveMaterial=null,this._forcedInstanceCount=0,this._overrideRenderingFillMode=null}}class k extends nr{static _GetDefaultSideOrientation(e){return e||k.FRONTSIDE}get useLODScreenCoverage(){return this._internalMeshDataInfo._useLODScreenCoverage}set useLODScreenCoverage(e){this._internalMeshDataInfo._useLODScreenCoverage=e,this._sortLODLevels()}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(e){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==e&&(e&&this._internalMeshDataInfo._sourcePositions&&(this.setVerticesData(b.PositionKind,this._internalMeshDataInfo._sourcePositions,!0),this._internalMeshDataInfo._sourceNormals&&this.setVerticesData(b.NormalKind,this._internalMeshDataInfo._sourceNormals,!0),this._internalMeshDataInfo._sourcePositions=null,this._internalMeshDataInfo._sourceNormals=null),this._internalAbstractMeshDataInfo._computeBonesUsingShaders=e,this._markSubMeshesAsAttributesDirty())}get onBeforeRenderObservable(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new he),this._internalMeshDataInfo._onBeforeRenderObservable}get onBeforeBindObservable(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new he),this._internalMeshDataInfo._onBeforeBindObservable}get onAfterRenderObservable(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new he),this._internalMeshDataInfo._onAfterRenderObservable}get onBetweenPassObservable(){return this._internalMeshDataInfo._onBetweenPassObservable||(this._internalMeshDataInfo._onBetweenPassObservable=new he),this._internalMeshDataInfo._onBetweenPassObservable}get onBeforeDrawObservable(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new he),this._internalMeshDataInfo._onBeforeDrawObservable}set onBeforeDraw(e){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(e)}get hasInstances(){return this.instances.length>0}get hasThinInstances(){return(this.forcedInstanceCount||this._thinInstanceDataStorage.instancesCount||0)>0}get forcedInstanceCount(){return this._internalMeshDataInfo._forcedInstanceCount}set forcedInstanceCount(e){this._internalMeshDataInfo._forcedInstanceCount=e}get overrideRenderingFillMode(){return this._internalMeshDataInfo._overrideRenderingFillMode}set overrideRenderingFillMode(e){this._internalMeshDataInfo._overrideRenderingFillMode=e}get source(){return this._internalMeshDataInfo._source}get cloneMeshMap(){return this._internalMeshDataInfo.meshMap}get isUnIndexed(){return this._unIndexed}set isUnIndexed(e){this._unIndexed!==e&&(this._unIndexed=e,this._markSubMeshesAsAttributesDirty())}get worldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesData}get previousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesPreviousData}get manualUpdateOfWorldMatrixInstancedBuffer(){return this._instanceDataStorage.manualUpdate}set manualUpdateOfWorldMatrixInstancedBuffer(e){this._instanceDataStorage.manualUpdate=e}get manualUpdateOfPreviousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.previousManualUpdate}set manualUpdateOfPreviousWorldMatrixInstancedBuffer(e){this._instanceDataStorage.previousManualUpdate=e}get forceWorldMatrixInstancedBufferUpdate(){return this._instanceDataStorage.forceMatrixUpdates}set forceWorldMatrixInstancedBufferUpdate(e){this._instanceDataStorage.forceMatrixUpdates=e}constructor(e,t=null,i=null,r=null,s,o=!0){if(super(e,t),this._internalMeshDataInfo=new sb,this.delayLoadState=0,this.instances=[],this._creationDataStorage=null,this._geometry=null,this._instanceDataStorage=new ib,this._thinInstanceDataStorage=new rb,this._shouldGenerateFlatShading=!1,this._originalBuilderSideOrientation=k.DEFAULTSIDE,this.overrideMaterialSideOrientation=null,this.ignoreCameraMaxZ=!1,t=this.getScene(),this._onBeforeDraw=(a,l,h)=>{a&&h&&(this._uniformBuffer?this.transferToEffect(l):h.bindOnlyWorldMatrix(l))},r){if(r._geometry&&r._geometry.applyToMesh(this),Vn.DeepCopy(r,this,["name","material","skeleton","instances","parent","uniqueId","source","metadata","morphTargetManager","hasInstances","worldMatrixInstancedBuffer","previousWorldMatrixInstancedBuffer","hasLODLevels","geometry","isBlocked","areNormalsFrozen","facetNb","isFacetDataEnabled","lightSources","useBones","isAnInstance","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","isWorldMatrixFrozen","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","cloneMeshMap","hasBoundingInfo","physicsBody","physicsImpostor"],["_poseMatrix"]),this._internalMeshDataInfo._source=r,t.useClonedMeshMap&&(r._internalMeshDataInfo.meshMap||(r._internalMeshDataInfo.meshMap={}),r._internalMeshDataInfo.meshMap[this.uniqueId]=this),this._originalBuilderSideOrientation=r._originalBuilderSideOrientation,this._creationDataStorage=r._creationDataStorage,r._ranges){const a=r._ranges;for(const l in a)Object.prototype.hasOwnProperty.call(a,l)&&a[l]&&this.createAnimationRange(l,a[l].from,a[l].to)}if(r.metadata&&r.metadata.clone?this.metadata=r.metadata.clone():this.metadata=r.metadata,this._internalMetadata=r._internalMetadata,it&&it.HasTags(r)&&it.AddTagsTo(this,it.GetTags(r,!0)),this.setEnabled(r.isEnabled(!1)),this.parent=r.parent,this.setPivotMatrix(r.getPivotMatrix(),this._postMultiplyPivotMatrix),this.id=e+"."+r.id,this.material=r.material,!s){const a=r.getDescendants(!0);for(let l=0;l<a.length;l++){const h=a[l];h.clone&&h.clone(e+"."+h.name,this)}}if(r.morphTargetManager&&(this.morphTargetManager=r.morphTargetManager),t.getPhysicsEngine){const a=t.getPhysicsEngine();if(o&&a)if(a.getPluginVersion()===1){const l=a.getImpostorForPhysicsObject(r);l&&(this.physicsImpostor=l.clone(this))}else a.getPluginVersion()===2&&r.physicsBody&&r.physicsBody.clone(this)}for(let a=0;a<t.particleSystems.length;a++){const l=t.particleSystems[a];l.emitter===r&&l.clone(l.name,this)}this.skeleton=r.skeleton,this.refreshBoundingInfo(!0,!0),this.computeWorldMatrix(!0)}i!==null&&(this.parent=i),this._instanceDataStorage.hardwareInstancedRendering=this.getEngine().getCaps().instancedArrays,this._internalMeshDataInfo._onMeshReadyObserverAdded=a=>{a.unregisterOnNextCall=!0,this.isReady(!0)?this.onMeshReadyObservable.notifyObservers(this):this._internalMeshDataInfo._checkReadinessObserver||(this._internalMeshDataInfo._checkReadinessObserver=this._scene.onBeforeRenderObservable.add(()=>{this.isReady(!0)&&(this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),this._internalMeshDataInfo._checkReadinessObserver=null,this.onMeshReadyObservable.notifyObservers(this))}))},this.onMeshReadyObservable=new he(this._internalMeshDataInfo._onMeshReadyObserverAdded),r&&r.onClonedObservable.notifyObservers(this)}instantiateHierarchy(e=null,t,i){const r=this.getTotalVertices()===0||t&&t.doNotInstantiate&&(t.doNotInstantiate===!0||t.doNotInstantiate(this))?this.clone("Clone of "+(this.name||this.id),e||this.parent,!0):this.createInstance("instance of "+(this.name||this.id));r.parent=e||this.parent,r.position=this.position.clone(),r.scaling=this.scaling.clone(),this.rotationQuaternion?r.rotationQuaternion=this.rotationQuaternion.clone():r.rotation=this.rotation.clone(),i&&i(this,r);for(const s of this.getChildTransformNodes(!0))s.getClassName()==="InstancedMesh"&&r.getClassName()==="Mesh"&&s.sourceMesh===this?s.instantiateHierarchy(r,{doNotInstantiate:t&&t.doNotInstantiate||!1,newSourcedMesh:r},i):s.instantiateHierarchy(r,t,i);return r}getClassName(){return"Mesh"}get _isMesh(){return!0}toString(e){let t=super.toString(e);if(t+=", n vertices: "+this.getTotalVertices(),t+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(let i=0;i<this.animations.length;i++)t+=", animation[0]: "+this.animations[i].toString(e);if(e)if(this._geometry){const i=this.getIndices(),r=this.getVerticesData(b.PositionKind);r&&i&&(t+=", flat shading: "+(r.length/3===i.length?"YES":"NO"))}else t+=", flat shading: UNKNOWN";return t}_unBindEffect(){super._unBindEffect();for(const e of this.instances)e._unBindEffect()}get hasLODLevels(){return this._internalMeshDataInfo._LODLevels.length>0}getLODLevels(){return this._internalMeshDataInfo._LODLevels}_sortLODLevels(){const e=this._internalMeshDataInfo._useLODScreenCoverage?-1:1;this._internalMeshDataInfo._LODLevels.sort((t,i)=>t.distanceOrScreenCoverage<i.distanceOrScreenCoverage?e:t.distanceOrScreenCoverage>i.distanceOrScreenCoverage?-e:0)}addLODLevel(e,t){if(t&&t._masterMesh)return oe.Warn("You cannot use a mesh as LOD level twice"),this;const i=new tb(e,t);return this._internalMeshDataInfo._LODLevels.push(i),t&&(t._masterMesh=this),this._sortLODLevels(),this}getLODLevelAtDistance(e){const t=this._internalMeshDataInfo;for(let i=0;i<t._LODLevels.length;i++){const r=t._LODLevels[i];if(r.distanceOrScreenCoverage===e)return r.mesh}return null}removeLODLevel(e){const t=this._internalMeshDataInfo;for(let i=0;i<t._LODLevels.length;i++)t._LODLevels[i].mesh===e&&(t._LODLevels.splice(i,1),e&&(e._masterMesh=null));return this._sortLODLevels(),this}getLOD(e,t){const i=this._internalMeshDataInfo;if(!i._LODLevels||i._LODLevels.length===0)return this;const r=t||this.getBoundingInfo().boundingSphere,s=e.mode===Je.ORTHOGRAPHIC_CAMERA?e.minZ:r.centerWorld.subtract(e.globalPosition).length();let o=s,a=1;if(i._useLODScreenCoverage){const l=e.screenArea;let h=r.radiusWorld*e.minZ/s;h=h*h*Math.PI,o=h/l,a=-1}if(a*i._LODLevels[i._LODLevels.length-1].distanceOrScreenCoverage>a*o)return this.onLODLevelSelection&&this.onLODLevelSelection(o,this,this),this;for(let l=0;l<i._LODLevels.length;l++){const h=i._LODLevels[l];if(a*h.distanceOrScreenCoverage<a*o){if(h.mesh){if(h.mesh.delayLoadState===4)return h.mesh._checkDelayState(),this;if(h.mesh.delayLoadState===2)return this;h.mesh._preActivate(),h.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)}return this.onLODLevelSelection&&this.onLODLevelSelection(o,this,h.mesh),h.mesh}}return this.onLODLevelSelection&&this.onLODLevelSelection(o,this,this),this}get geometry(){return this._geometry}getTotalVertices(){return this._geometry===null||this._geometry===void 0?0:this._geometry.getTotalVertices()}getVerticesData(e,t,i,r){var s,o;if(!this._geometry)return null;let a=r||(o=(s=this._userInstancedBuffersStorage)==null?void 0:s.vertexBuffers[e])==null?void 0:o.getFloatData(this.instances.length+1,i||t&&this._geometry.meshes.length!==1);return a||(a=this._geometry.getVerticesData(e,t,i)),a}getVertexBuffer(e,t){var i;return this._geometry?(t||(i=this._userInstancedBuffersStorage)==null?void 0:i.vertexBuffers[e])??this._geometry.getVertexBuffer(e):null}isVerticesDataPresent(e,t){var i;return this._geometry?!t&&((i=this._userInstancedBuffersStorage)==null?void 0:i.vertexBuffers[e])!==void 0||this._geometry.isVerticesDataPresent(e):this._delayInfo?this._delayInfo.indexOf(e)!==-1:!1}isVertexBufferUpdatable(e,t){var i;if(!this._geometry)return this._delayInfo?this._delayInfo.indexOf(e)!==-1:!1;if(!t){const r=(i=this._userInstancedBuffersStorage)==null?void 0:i.vertexBuffers[e];if(r)return r.isUpdatable()}return this._geometry.isVertexBufferUpdatable(e)}getVerticesDataKinds(e){if(!this._geometry){const i=[];return this._delayInfo&&this._delayInfo.forEach(function(r){i.push(r)}),i}const t=this._geometry.getVerticesDataKinds();if(!e&&this._userInstancedBuffersStorage)for(const i in this._userInstancedBuffersStorage.vertexBuffers)t.indexOf(i)===-1&&t.push(i);return t}getTotalIndices(){return this._geometry?this._geometry.getTotalIndices():0}getIndices(e,t){return this._geometry?this._geometry.getIndices(e,t):[]}get isBlocked(){return this._masterMesh!==null&&this._masterMesh!==void 0}isReady(e=!1,t=!1){var i,r,s,o,a;if(this.delayLoadState===2||!super.isReady(e))return!1;if(!this.subMeshes||this.subMeshes.length===0||!e)return!0;const l=this.getEngine(),h=this.getScene(),c=t||l.getCaps().instancedArrays&&(this.instances.length>0||this.hasThinInstances);this.computeWorldMatrix();const u=this.material||h.defaultMaterial;if(u){if(u._storeEffectOnSubMeshes)for(const f of this.subMeshes){const p=f.getMaterial();if(p){if(p._storeEffectOnSubMeshes){if(!p.isReadyForSubMesh(this,f,c))return!1}else if(!p.isReady(this,c))return!1}}else if(!u.isReady(this,c))return!1}const d=l.currentRenderPassId;for(const f of this.lightSources){const p=f.getShadowGenerators();if(!p)continue;const g=p.values();for(let m=g.next();m.done!==!0;m=g.next()){const x=m.value;if(x&&(!((i=x.getShadowMap())!=null&&i.renderList)||(r=x.getShadowMap())!=null&&r.renderList&&((o=(s=x.getShadowMap())==null?void 0:s.renderList)==null?void 0:o.indexOf(this))!==-1)){const E=x.getShadowMap().renderPassIds??[l.currentRenderPassId];for(let R=0;R<E.length;++R){l.currentRenderPassId=E[R];for(const C of this.subMeshes)if(!x.isReady(C,c,((a=C.getMaterial())==null?void 0:a.needAlphaBlendingForMesh(this))??!1))return l.currentRenderPassId=d,!1}l.currentRenderPassId=d}}}for(const f of this._internalMeshDataInfo._LODLevels)if(f.mesh&&!f.mesh.isReady(c))return!1;return!0}get areNormalsFrozen(){return this._internalMeshDataInfo._areNormalsFrozen}freezeNormals(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this}unfreezeNormals(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this}set overridenInstanceCount(e){this._instanceDataStorage.overridenInstanceCount=e}_preActivate(){const e=this._internalMeshDataInfo,t=this.getScene().getRenderId();return e._preActivateId===t?this:(e._preActivateId=t,this._instanceDataStorage.visibleInstances=null,this)}_preActivateForIntermediateRendering(e){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=e),this}_registerInstanceForRenderId(e,t){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:t,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[t]||(this._instanceDataStorage.previousRenderId!==void 0&&this._instanceDataStorage.isFrozen&&(this._instanceDataStorage.visibleInstances[this._instanceDataStorage.previousRenderId]=null),this._instanceDataStorage.previousRenderId=t,this._instanceDataStorage.visibleInstances[t]=new Array),this._instanceDataStorage.visibleInstances[t].push(e),this}_afterComputeWorldMatrix(){super._afterComputeWorldMatrix(),this.hasThinInstances&&(this.doNotSyncBoundingInfo||this.thinInstanceRefreshBoundingInfo(!1))}_postActivate(){this.edgesShareWithInstances&&this.edgesRenderer&&this.edgesRenderer.isEnabled&&this._renderingGroup&&(this._renderingGroup._edgesRenderers.pushNoDuplicate(this.edgesRenderer),this.edgesRenderer.customInstances.push(this.getWorldMatrix()))}refreshBoundingInfo(e=!1,t=!1){if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;const i=this.geometry?this.geometry.boundingBias:null;return this._refreshBoundingInfo(this._getPositionData(e,t),i),this}_createGlobalSubMesh(e){const t=this.getTotalVertices();if(!t||!this.getIndices())return null;if(this.subMeshes&&this.subMeshes.length>0){const i=this.getIndices();if(!i)return null;const r=i.length;let s=!1;if(e)s=!0;else for(const o of this.subMeshes){if(o.indexStart+o.indexCount>r){s=!0;break}if(o.verticesStart+o.verticesCount>t){s=!0;break}}if(!s)return this.subMeshes[0]}return this.releaseSubMeshes(),new Pi(0,0,t,0,this.getTotalIndices(),this)}subdivide(e){if(e<1)return;const t=this.getTotalIndices();let i=t/e|0,r=0;for(;i%3!==0;)i++;this.releaseSubMeshes();for(let s=0;s<e&&!(r>=t);s++)Pi.CreateFromIndices(0,r,s===e-1?t-r:i,this,void 0,!1),r+=i;this.refreshBoundingInfo(),this.synchronizeInstances()}setVerticesData(e,t,i=!1,r){if(this._geometry)this._geometry.setVerticesData(e,t,i,r);else{const s=new re;s.set(t,e);const o=this.getScene();new ls(ls.RandomId(),o,s,i,this)}return this}removeVerticesData(e){this._geometry&&this._geometry.removeVerticesData(e)}markVerticesDataAsUpdatable(e,t=!0){const i=this.getVertexBuffer(e);!i||i.isUpdatable()===t||this.setVerticesData(e,this.getVerticesData(e),t)}setVerticesBuffer(e,t=!0){return this._geometry||(this._geometry=ls.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(e,null,t),this}updateVerticesData(e,t,i,r){return this._geometry?(r?(this.makeGeometryUnique(),this.updateVerticesData(e,t,i,!1)):this._geometry.updateVerticesData(e,t,i),this):this}updateMeshPositions(e,t=!0){const i=this.getVerticesData(b.PositionKind);if(!i)return this;if(e(i),this.updateVerticesData(b.PositionKind,i,!1,!1),t){const r=this.getIndices(),s=this.getVerticesData(b.NormalKind);if(!s)return this;re.ComputeNormals(i,r,s),this.updateVerticesData(b.NormalKind,s,!1,!1)}return this}makeGeometryUnique(){if(!this._geometry)return this;if(this._geometry.meshes.length===1)return this;const e=this._geometry,t=this._geometry.copy(ls.RandomId());return e.releaseForMesh(this,!0),t.applyToMesh(this),this}setIndexBuffer(e,t,i){let r=this._geometry;r||(r=new ls(ls.RandomId(),this.getScene(),void 0,void 0,this)),r.setIndexBuffer(e,t,i)}setIndices(e,t=null,i=!1){if(this._geometry)this._geometry.setIndices(e,t,i);else{const r=new re;r.indices=e;const s=this.getScene();new ls(ls.RandomId(),s,r,i,this)}return this}updateIndices(e,t,i=!1){return this._geometry?(this._geometry.updateIndices(e,t,i),this):this}toLeftHanded(){return this._geometry?(this._geometry.toLeftHanded(),this):this}_bind(e,t,i,r=!0){if(!this._geometry)return this;const s=this.getScene().getEngine();this.morphTargetManager&&this.morphTargetManager.isUsingTextureForTargets&&this.morphTargetManager._bind(t);let o;if(this._unIndexed)o=null;else switch(this._getRenderingFillMode(i)){case ie.PointFillMode:o=null;break;case ie.WireFrameFillMode:o=e._getLinesIndexBuffer(this.getIndices(),s);break;default:case ie.TriangleFillMode:o=this._geometry.getIndexBuffer();break}return!r||!this._userInstancedBuffersStorage||this.hasThinInstances?this._geometry._bind(t,o):this._geometry._bind(t,o,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects),this}_draw(e,t,i){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);const r=this.getScene().getEngine();return this._unIndexed||t==ie.PointFillMode?r.drawArraysType(t,e.verticesStart,e.verticesCount,this.forcedInstanceCount||i):t==ie.WireFrameFillMode?r.drawElementsType(t,0,e._linesIndexCount,this.forcedInstanceCount||i):r.drawElementsType(t,e.indexStart,e.indexCount,this.forcedInstanceCount||i),this}registerBeforeRender(e){return this.onBeforeRenderObservable.add(e),this}unregisterBeforeRender(e){return this.onBeforeRenderObservable.removeCallback(e),this}registerAfterRender(e){return this.onAfterRenderObservable.add(e),this}unregisterAfterRender(e){return this.onAfterRenderObservable.removeCallback(e),this}_getInstancesRenderList(e,t=!1){if(this._instanceDataStorage.isFrozen){if(t)return this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.hardwareInstancedRendering[e]=!1,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.renderSelf[e]=!0,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode;if(this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch}const i=this.getScene(),r=i._isInIntermediateRendering(),s=r?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,o=this._instanceDataStorage.batchCache;if(o.mustReturn=!1,o.renderSelf[e]=t||!s&&this.isEnabled()&&this.isVisible,o.visibleInstances[e]=null,this._instanceDataStorage.visibleInstances&&!t){const a=this._instanceDataStorage.visibleInstances,l=i.getRenderId(),h=r?a.intermediateDefaultRenderId:a.defaultRenderId;o.visibleInstances[e]=a[l],!o.visibleInstances[e]&&h&&(o.visibleInstances[e]=a[h])}return o.hardwareInstancedRendering[e]=!t&&this._instanceDataStorage.hardwareInstancedRendering&&o.visibleInstances[e]!==null&&o.visibleInstances[e]!==void 0,this._instanceDataStorage.previousBatch=o,o}_renderWithInstances(e,t,i,r,s){var o;const a=i.visibleInstances[e._id],l=a?a.length:0,h=this._instanceDataStorage,c=h.instancesBufferSize;let u=h.instancesBuffer,d=h.instancesPreviousBuffer;const f=(l+1)*16*4;for(;h.instancesBufferSize<f;)h.instancesBufferSize*=2;(!h.instancesData||c!=h.instancesBufferSize)&&(h.instancesData=new Float32Array(h.instancesBufferSize/4)),(this._scene.needsPreviousWorldMatrices&&!h.instancesPreviousData||c!=h.instancesBufferSize)&&(h.instancesPreviousData=new Float32Array(h.instancesBufferSize/4));let p=0,g=0;const m=i.renderSelf[e._id],x=!u||c!==h.instancesBufferSize||this._scene.needsPreviousWorldMatrices&&!h.instancesPreviousBuffer;if(!this._instanceDataStorage.manualUpdate&&(!h.isFrozen||x)){const E=this.getWorldMatrix();if(m&&(this._scene.needsPreviousWorldMatrices&&(h.masterMeshPreviousWorldMatrix?(h.masterMeshPreviousWorldMatrix.copyToArray(h.instancesPreviousData,p),h.masterMeshPreviousWorldMatrix.copyFrom(E)):(h.masterMeshPreviousWorldMatrix=E.clone(),h.masterMeshPreviousWorldMatrix.copyToArray(h.instancesPreviousData,p))),E.copyToArray(h.instancesData,p),p+=16,g++),a){if(k.INSTANCEDMESH_SORT_TRANSPARENT&&this._scene.activeCamera&&(o=e.getMaterial())!=null&&o.needAlphaBlendingForMesh(e.getRenderingMesh())){const R=this._scene.activeCamera.globalPosition;for(let C=0;C<a.length;C++){const _=a[C];_._distanceToCamera=v.Distance(_.getBoundingInfo().boundingSphere.centerWorld,R)}a.sort((C,_)=>C._distanceToCamera>_._distanceToCamera?-1:C._distanceToCamera<_._distanceToCamera?1:0)}for(let R=0;R<a.length;R++){const C=a[R],_=C.getWorldMatrix();_.copyToArray(h.instancesData,p),this._scene.needsPreviousWorldMatrices&&(C._previousWorldMatrix?(C._previousWorldMatrix.copyToArray(h.instancesPreviousData,p),C._previousWorldMatrix.copyFrom(_)):(C._previousWorldMatrix=_.clone(),C._previousWorldMatrix.copyToArray(h.instancesPreviousData,p))),p+=16,g++}}}else g=(m?1:0)+l;return x?(u&&u.dispose(),d&&d.dispose(),u=new mr(s,h.instancesData,!0,16,!1,!0),h.instancesBuffer=u,this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this._userInstancedBuffersStorage.vertexBuffers.world0=u.createVertexBuffer("world0",0,4),this._userInstancedBuffersStorage.vertexBuffers.world1=u.createVertexBuffer("world1",4,4),this._userInstancedBuffersStorage.vertexBuffers.world2=u.createVertexBuffer("world2",8,4),this._userInstancedBuffersStorage.vertexBuffers.world3=u.createVertexBuffer("world3",12,4),this._scene.needsPreviousWorldMatrices&&(d=new mr(s,h.instancesPreviousData,!0,16,!1,!0),h.instancesPreviousBuffer=d,this._userInstancedBuffersStorage.vertexBuffers.previousWorld0=d.createVertexBuffer("previousWorld0",0,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld1=d.createVertexBuffer("previousWorld1",4,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld2=d.createVertexBuffer("previousWorld2",8,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld3=d.createVertexBuffer("previousWorld3",12,4)),this._invalidateInstanceVertexArrayObject()):(!this._instanceDataStorage.isFrozen||this._instanceDataStorage.forceMatrixUpdates)&&(u.updateDirectly(h.instancesData,0,g),this._scene.needsPreviousWorldMatrices&&(!this._instanceDataStorage.manualUpdate||this._instanceDataStorage.previousManualUpdate)&&d.updateDirectly(h.instancesPreviousData,0,g)),this._processInstancedBuffers(a,m),this.getScene()._activeIndices.addCount(e.indexCount*g,!1),s._currentDrawContext&&(s._currentDrawContext.useInstancing=!0),this._bind(e,r,t),this._draw(e,t,g),this._scene.needsPreviousWorldMatrices&&!x&&this._instanceDataStorage.manualUpdate&&(!this._instanceDataStorage.isFrozen||this._instanceDataStorage.forceMatrixUpdates)&&!this._instanceDataStorage.previousManualUpdate&&d.updateDirectly(h.instancesData,0,g),s.unbindInstanceAttributes(),this}_renderWithThinInstances(e,t,i,r){var s;const o=((s=this._thinInstanceDataStorage)==null?void 0:s.instancesCount)??0;this.getScene()._activeIndices.addCount(e.indexCount*o,!1),r._currentDrawContext&&(r._currentDrawContext.useInstancing=!0),this._bind(e,i,t),this._draw(e,t,o),this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&this._thinInstanceDataStorage.matrixData&&(this._thinInstanceDataStorage.previousMatrixBuffer?this._thinInstanceDataStorage.previousMatrixBuffer.updateDirectly(this._thinInstanceDataStorage.matrixData,0,o):this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.matrixData,!1)),r.unbindInstanceAttributes()}_processInstancedBuffers(e,t){}_processRendering(e,t,i,r,s,o,a,l){const h=this.getScene(),c=h.getEngine();if(r=this._getRenderingFillMode(r),o&&t.getRenderingMesh().hasThinInstances)return this._renderWithThinInstances(t,r,i,c),this;if(o)this._renderWithInstances(t,r,s,i,c);else{c._currentDrawContext&&(c._currentDrawContext.useInstancing=!1);let u=0;s.renderSelf[t._id]&&(a&&a(!1,e.getWorldMatrix(),l),u++,this._draw(t,r,this._instanceDataStorage.overridenInstanceCount));const d=s.visibleInstances[t._id];if(d){const f=d.length;u+=f;for(let p=0;p<f;p++){const g=d[p].getWorldMatrix();a&&a(!0,g,l),this._draw(t,r)}}h._activeIndices.addCount(t.indexCount*u,!1)}return this}_rebuild(e=!1){if(this._instanceDataStorage.instancesBuffer&&(e&&this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),this._userInstancedBuffersStorage){for(const t in this._userInstancedBuffersStorage.vertexBuffers){const i=this._userInstancedBuffersStorage.vertexBuffers[t];i&&(e&&i.dispose(),this._userInstancedBuffersStorage.vertexBuffers[t]=null)}this._userInstancedBuffersStorage.vertexArrayObjects&&(this._userInstancedBuffersStorage.vertexArrayObjects={})}this._internalMeshDataInfo._effectiveMaterial=null,super._rebuild(e)}_freeze(){if(this.subMeshes){for(let e=0;e<this.subMeshes.length;e++)this._getInstancesRenderList(e);this._internalMeshDataInfo._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}}_unFreeze(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null}renderWithRenderPassId(e,t,i,r,s=!0){const o=this._scene.getEngine(),a=o.currentRenderPassId;if(e!==void 0&&(o.currentRenderPassId=e),r)(!s||s&&r.isInFrustum(this._scene._frustumPlanes))&&this.render(r,!!t,i);else for(let l=0;l<this.subMeshes.length;l++){const h=this.subMeshes[l];(!s||s&&h.isInFrustum(this._scene._frustumPlanes))&&this.render(h,!!t,i)}return e!==void 0&&(o.currentRenderPassId=a),this}render(e,t,i){var r,s;const o=this.getScene();this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1;const a=((r=o.activeCameras)==null?void 0:r.length)??0;if((a>1&&o.activeCamera===o.activeCameras[0]||a<=1)&&this._checkOcclusionQuery()&&!this._occlusionDataStorage.forceRenderingWhenOccluded)return this;const l=this._getInstancesRenderList(e._id,!!i);if(l.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const h=o.getEngine();let c=0,u=null;this.ignoreCameraMaxZ&&o.activeCamera&&!o._isInIntermediateRendering()&&(c=o.activeCamera.maxZ,u=o.activeCamera,o.activeCamera.maxZ=0,o.updateTransformMatrix(!0)),this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);const d=e.getRenderingMesh(),f=l.hardwareInstancedRendering[e._id]||d.hasThinInstances||!!this._userInstancedBuffersStorage&&!e.getMesh()._internalAbstractMeshDataInfo._actAsRegularMesh,p=this._instanceDataStorage,g=e.getMaterial();if(!g)return u&&(u.maxZ=c,o.updateTransformMatrix(!0)),this;if(!p.isFrozen||!this._internalMeshDataInfo._effectiveMaterial||this._internalMeshDataInfo._effectiveMaterial!==g){if(g._storeEffectOnSubMeshes){if(!g.isReadyForSubMesh(this,e,f))return u&&(u.maxZ=c,o.updateTransformMatrix(!0)),this}else if(!g.isReady(this,f))return u&&(u.maxZ=c,o.updateTransformMatrix(!0)),this;this._internalMeshDataInfo._effectiveMaterial=g}else if(g._storeEffectOnSubMeshes&&!((s=e._drawWrapper)!=null&&s._wasPreviouslyReady)||!g._storeEffectOnSubMeshes&&!g._getDrawWrapper()._wasPreviouslyReady)return u&&(u.maxZ=c,o.updateTransformMatrix(!0)),this;t&&h.setAlphaMode(this._internalMeshDataInfo._effectiveMaterial.alphaMode);let m;this._internalMeshDataInfo._effectiveMaterial._storeEffectOnSubMeshes?m=e._drawWrapper:m=this._internalMeshDataInfo._effectiveMaterial._getDrawWrapper();const x=(m==null?void 0:m.effect)??null;for(const P of o._beforeRenderingMeshStage)P.action(this,e,l,x);if(!m||!x)return u&&(u.maxZ=c,o.updateTransformMatrix(!0)),this;const E=i||this;let R;if(!p.isFrozen&&(this._internalMeshDataInfo._effectiveMaterial.backFaceCulling||this.overrideMaterialSideOrientation!==null||this._internalMeshDataInfo._effectiveMaterial.twoSidedLighting)){const P=E._getWorldMatrixDeterminant();R=this.overrideMaterialSideOrientation,R==null&&(R=this._internalMeshDataInfo._effectiveMaterial.sideOrientation),P<0&&(R=R===ie.ClockWiseSideOrientation?ie.CounterClockWiseSideOrientation:ie.ClockWiseSideOrientation),p.sideOrientation=R}else R=p.sideOrientation;const C=this._internalMeshDataInfo._effectiveMaterial._preBind(m,R);this._internalMeshDataInfo._effectiveMaterial.forceDepthWrite&&h.setDepthWrite(!0);const _=this._internalMeshDataInfo._effectiveMaterial,T=_.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),f||this._bind(e,x,T,!1);const y=E.getWorldMatrix();_._storeEffectOnSubMeshes?_.bindForSubMesh(y,this,e):_.bind(y,this),!_.backFaceCulling&&_.separateCullingPass&&(h.setState(!0,_.zOffset,!1,!C,_.cullBackFaces,_.stencil,_.zOffsetUnits),this._processRendering(this,e,x,T,l,f,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),h.setState(!0,_.zOffset,!1,C,_.cullBackFaces,_.stencil,_.zOffsetUnits),this._internalMeshDataInfo._onBetweenPassObservable&&this._internalMeshDataInfo._onBetweenPassObservable.notifyObservers(e)),this._processRendering(this,e,x,T,l,f,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),this._internalMeshDataInfo._effectiveMaterial.unbind();for(const P of o._afterRenderingMeshStage)P.action(this,e,l,x);return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),u&&(u.maxZ=c,o.updateTransformMatrix(!0)),o.performancePriority===vs.Aggressive&&!p.isFrozen&&this._freeze(),this}cleanMatrixWeights(){this.isVerticesDataPresent(b.MatricesWeightsKind)&&(this.isVerticesDataPresent(b.MatricesWeightsExtraKind)?this._normalizeSkinWeightsAndExtra():this._normalizeSkinFourWeights())}_normalizeSkinFourWeights(){const e=this.getVerticesData(b.MatricesWeightsKind),t=e.length;for(let i=0;i<t;i+=4){const r=e[i]+e[i+1]+e[i+2]+e[i+3];if(r===0)e[i]=1;else{const s=1/r;e[i]*=s,e[i+1]*=s,e[i+2]*=s,e[i+3]*=s}}this.setVerticesData(b.MatricesWeightsKind,e)}_normalizeSkinWeightsAndExtra(){const e=this.getVerticesData(b.MatricesWeightsExtraKind),t=this.getVerticesData(b.MatricesWeightsKind),i=t.length;for(let r=0;r<i;r+=4){let s=t[r]+t[r+1]+t[r+2]+t[r+3];if(s+=e[r]+e[r+1]+e[r+2]+e[r+3],s===0)t[r]=1;else{const o=1/s;t[r]*=o,t[r+1]*=o,t[r+2]*=o,t[r+3]*=o,e[r]*=o,e[r+1]*=o,e[r+2]*=o,e[r+3]*=o}}this.setVerticesData(b.MatricesWeightsKind,t),this.setVerticesData(b.MatricesWeightsKind,e)}validateSkinning(){const e=this.getVerticesData(b.MatricesWeightsExtraKind),t=this.getVerticesData(b.MatricesWeightsKind);if(t===null||this.skeleton==null)return{skinned:!1,valid:!0,report:"not skinned"};const i=t.length;let r=0,s=0,o=0,a=0;const l=e===null?4:8,h=[];for(let m=0;m<=l;m++)h[m]=0;const c=.001;for(let m=0;m<i;m+=4){let x=t[m],E=x,R=E===0?0:1;for(let C=1;C<l;C++){const _=C<4?t[m+C]:e[m+C-4];_>x&&r++,_!==0&&R++,E+=_,x=_}if(h[R]++,R>o&&(o=R),E===0)s++;else{const C=1/E;let _=0;for(let T=0;T<l;T++)T<4?_+=Math.abs(t[m+T]-t[m+T]*C):_+=Math.abs(e[m+T-4]-e[m+T-4]*C);_>c&&a++}}const u=this.skeleton.bones.length,d=this.getVerticesData(b.MatricesIndicesKind),f=this.getVerticesData(b.MatricesIndicesExtraKind);let p=0;for(let m=0;m<i;m+=4)for(let x=0;x<l;x++){const E=x<4?d[m+x]:f[m+x-4];(E>=u||E<0)&&p++}const g="Number of Weights = "+i/4+`
Maximum influences = `+o+`
Missing Weights = `+s+`
Not Sorted = `+r+`
Not Normalized = `+a+`
WeightCounts = [`+h+`]
Number of bones = `+u+`
Bad Bone Indices = `+p;return{skinned:!0,valid:s===0&&a===0&&p===0,report:g}}_checkDelayState(){const e=this.getScene();return this._geometry?this._geometry.load(e):this.delayLoadState===4&&(this.delayLoadState=2,this._queueLoad(e)),this}_queueLoad(e){e.addPendingData(this);const t=this.delayLoadingFile.indexOf(".babylonbinarymeshdata")!==-1;return ge.LoadFile(this.delayLoadingFile,i=>{i instanceof ArrayBuffer?this._delayLoadingFunction(i,this):this._delayLoadingFunction(JSON.parse(i),this),this.instances.forEach(r=>{r.refreshBoundingInfo(),r._syncSubMeshes()}),this.delayLoadState=1,e.removePendingData(this)},()=>{},e.offlineProvider,t),this}isInFrustum(e){return this.delayLoadState===2||!super.isInFrustum(e)?!1:(this._checkDelayState(),!0)}setMaterialById(e){const t=this.getScene().materials;let i;for(i=t.length-1;i>-1;i--)if(t[i].id===e)return this.material=t[i],this;const r=this.getScene().multiMaterials;for(i=r.length-1;i>-1;i--)if(r[i].id===e)return this.material=r[i],this;return this}getAnimatables(){const e=[];return this.material&&e.push(this.material),this.skeleton&&e.push(this.skeleton),e}bakeTransformIntoVertices(e){if(!this.isVerticesDataPresent(b.PositionKind))return this;const t=this.subMeshes.splice(0);this._resetPointsArrayCache();let i=this.getVerticesData(b.PositionKind);const r=v.Zero();let s;for(s=0;s<i.length;s+=3)v.TransformCoordinatesFromFloatsToRef(i[s],i[s+1],i[s+2],e,r).toArray(i,s);if(this.setVerticesData(b.PositionKind,i,this.getVertexBuffer(b.PositionKind).isUpdatable()),this.isVerticesDataPresent(b.NormalKind)){for(i=this.getVerticesData(b.NormalKind),s=0;s<i.length;s+=3)v.TransformNormalFromFloatsToRef(i[s],i[s+1],i[s+2],e,r).normalize().toArray(i,s);this.setVerticesData(b.NormalKind,i,this.getVertexBuffer(b.NormalKind).isUpdatable())}if(this.isVerticesDataPresent(b.TangentKind)){for(i=this.getVerticesData(b.TangentKind),s=0;s<i.length;s+=4)v.TransformNormalFromFloatsToRef(i[s],i[s+1],i[s+2],e,r).normalize().toArray(i,s);this.setVerticesData(b.TangentKind,i,this.getVertexBuffer(b.TangentKind).isUpdatable())}return e.determinant()<0&&this.flipFaces(),this.releaseSubMeshes(),this.subMeshes=t,this}bakeCurrentTransformIntoVertices(e=!0){return this.bakeTransformIntoVertices(this.computeWorldMatrix(!0)),this.resetLocalMatrix(e),this}get _positions(){return this._internalAbstractMeshDataInfo._positions?this._internalAbstractMeshDataInfo._positions:this._geometry?this._geometry._positions:null}_resetPointsArrayCache(){return this._geometry&&this._geometry._resetPointsArrayCache(),this}_generatePointsArray(){return this._geometry?this._geometry._generatePointsArray():!1}clone(e="",t=null,i,r=!0){return new k(e,this.getScene(),t,this,i,r)}dispose(e,t=!1){this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);const i=this._internalMeshDataInfo;if(i._onBeforeDrawObservable&&i._onBeforeDrawObservable.clear(),i._onBeforeBindObservable&&i._onBeforeBindObservable.clear(),i._onBeforeRenderObservable&&i._onBeforeRenderObservable.clear(),i._onAfterRenderObservable&&i._onAfterRenderObservable.clear(),i._onBetweenPassObservable&&i._onBetweenPassObservable.clear(),this._scene.useClonedMeshMap){if(i.meshMap)for(const r in i.meshMap){const s=i.meshMap[r];s&&(s._internalMeshDataInfo._source=null,i.meshMap[r]=void 0)}i._source&&i._source._internalMeshDataInfo.meshMap&&(i._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else{const r=this.getScene().meshes;for(const s of r){const o=s;o._internalMeshDataInfo&&o._internalMeshDataInfo._source&&o._internalMeshDataInfo._source===this&&(o._internalMeshDataInfo._source=null)}}i._source=null,this._instanceDataStorage.visibleInstances={},this._disposeInstanceSpecificData(),this._disposeThinInstanceSpecificData(),this._internalMeshDataInfo._checkReadinessObserver&&this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),super.dispose(e,t)}_disposeInstanceSpecificData(){}_disposeThinInstanceSpecificData(){}_invalidateInstanceVertexArrayObject(){}applyDisplacementMap(e,t,i,r,s,o,a=!1,l){const h=this.getScene(),c=u=>{const d=u.width,f=u.height,p=this.getEngine().createCanvas(d,f).getContext("2d");p.drawImage(u,0,0);const g=p.getImageData(0,0,d,f).data;this.applyDisplacementMapFromBuffer(g,d,f,t,i,s,o,a),r&&r(this)};return ge.LoadImage(e,c,l||(()=>{}),h.offlineProvider),this}applyDisplacementMapFromBuffer(e,t,i,r,s,o,a,l=!1){if(!this.isVerticesDataPresent(b.PositionKind)||!this.isVerticesDataPresent(b.NormalKind)||!this.isVerticesDataPresent(b.UVKind))return oe.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;const h=this.getVerticesData(b.PositionKind,!0,!0),c=this.getVerticesData(b.NormalKind),u=this.getVerticesData(b.UVKind);let d=v.Zero();const f=v.Zero(),p=me.Zero();o=o||me.Zero(),a=a||new me(1,1);for(let g=0;g<h.length;g+=3){v.FromArrayToRef(h,g,d),v.FromArrayToRef(c,g,f),me.FromArrayToRef(u,g/3*2,p);const m=Math.abs(p.x*a.x+o.x%1)*(t-1)%t|0,x=Math.abs(p.y*a.y+o.y%1)*(i-1)%i|0,E=(m+x*t)*4,R=e[E]/255,C=e[E+1]/255,_=e[E+2]/255,T=R*.3+C*.59+_*.11;f.normalize(),f.scaleInPlace(r+(s-r)*T),d=d.add(f),d.toArray(h,g)}return re.ComputeNormals(h,this.getIndices(),c),l?(this.setVerticesData(b.PositionKind,h),this.setVerticesData(b.NormalKind,c),this.setVerticesData(b.UVKind,u)):(this.updateVerticesData(b.PositionKind,h),this.updateVerticesData(b.NormalKind,c)),this}_getFlattenedNormals(e,t){const i=new Float32Array(e.length*3);let r=0;const s=this.overrideMaterialSideOrientation===(this._scene.useRightHandedSystem?1:0);for(let o=0;o<e.length;o+=3){const a=v.FromArray(t,e[o]*3),l=v.FromArray(t,e[o+1]*3),h=v.FromArray(t,e[o+2]*3),c=a.subtract(l),u=h.subtract(l),d=v.Normalize(v.Cross(c,u));s&&d.scaleInPlace(-1);for(let f=0;f<3;f++)i[r++]=d.x,i[r++]=d.y,i[r++]=d.z}return i}_convertToUnIndexedMesh(e=!1){const t=this.getVerticesDataKinds(),i=this.getIndices(),r={},s=(a,l)=>{const h=new Float32Array(i.length*l);let c=0;for(let u=0;u<i.length;u++)for(let d=0;d<l;d++)h[c++]=a[i[u]*l+d];return h},o=this.geometry?this.subMeshes.slice(0):[];for(const a of t)r[a]=this.getVerticesData(a);for(const a of t){const l=this.getVertexBuffer(a),h=l.getStrideSize();if(e&&a===b.NormalKind){const c=this._getFlattenedNormals(i,r[b.PositionKind]);this.setVerticesData(b.NormalKind,c,l.isUpdatable(),h)}else this.setVerticesData(a,s(r[a],h),l.isUpdatable(),h)}if(this.morphTargetManager){for(let a=0;a<this.morphTargetManager.numTargets;a++){const l=this.morphTargetManager.getTarget(a),h=l.getPositions();l.setPositions(s(h,3));const c=l.getNormals();c&&l.setNormals(e?this._getFlattenedNormals(i,h):s(c,3));const u=l.getTangents();u&&l.setTangents(s(u,3));const d=l.getUVs();d&&l.setUVs(s(d,2))}this.morphTargetManager.synchronize()}for(let a=0;a<i.length;a++)i[a]=a;this.setIndices(i),this._unIndexed=!0,this.releaseSubMeshes();for(const a of o)Pi.AddToMesh(a.materialIndex,a.indexStart,a.indexCount,a.indexStart,a.indexCount,this);return this.synchronizeInstances(),this}convertToFlatShadedMesh(){return this._convertToUnIndexedMesh(!0)}convertToUnIndexedMesh(){return this._convertToUnIndexedMesh()}flipFaces(e=!1){const t=re.ExtractFromMesh(this);let i;if(e&&this.isVerticesDataPresent(b.NormalKind)&&t.normals)for(i=0;i<t.normals.length;i++)t.normals[i]*=-1;if(t.indices){let r;for(i=0;i<t.indices.length;i+=3)r=t.indices[i+1],t.indices[i+1]=t.indices[i+2],t.indices[i+2]=r}return t.applyToMesh(this,this.isVertexBufferUpdatable(b.PositionKind)),this}increaseVertices(e=1){const t=re.ExtractFromMesh(this),i=t.indices&&!Array.isArray(t.indices)&&Array.from?Array.from(t.indices):t.indices,r=t.positions&&!Array.isArray(t.positions)&&Array.from?Array.from(t.positions):t.positions,s=t.uvs&&!Array.isArray(t.uvs)&&Array.from?Array.from(t.uvs):t.uvs,o=t.normals&&!Array.isArray(t.normals)&&Array.from?Array.from(t.normals):t.normals;if(!i||!r)oe.Warn("Couldn't increase number of vertices : VertexData must contain at least indices and positions");else{t.indices=i,t.positions=r,s&&(t.uvs=s),o&&(t.normals=o);const a=e+1,l=new Array;for(let _=0;_<a+1;_++)l[_]=new Array;let h,c;const u=new v(0,0,0),d=new v(0,0,0),f=new me(0,0),p=new Array,g=new Array,m=new Array;let x,E=r.length,R;s&&(R=s.length);let C;o&&(C=o.length);for(let _=0;_<i.length;_+=3){g[0]=i[_],g[1]=i[_+1],g[2]=i[_+2];for(let T=0;T<3;T++)if(h=g[T],c=g[(T+1)%3],m[h]===void 0&&m[c]===void 0?(m[h]=new Array,m[c]=new Array):(m[h]===void 0&&(m[h]=new Array),m[c]===void 0&&(m[c]=new Array)),m[h][c]===void 0&&m[c][h]===void 0){m[h][c]=[],u.x=(r[3*c]-r[3*h])/a,u.y=(r[3*c+1]-r[3*h+1])/a,u.z=(r[3*c+2]-r[3*h+2])/a,o&&(d.x=(o[3*c]-o[3*h])/a,d.y=(o[3*c+1]-o[3*h+1])/a,d.z=(o[3*c+2]-o[3*h+2])/a),s&&(f.x=(s[2*c]-s[2*h])/a,f.y=(s[2*c+1]-s[2*h+1])/a),m[h][c].push(h);for(let y=1;y<a;y++)m[h][c].push(r.length/3),r[E++]=r[3*h]+y*u.x,r[E++]=r[3*h+1]+y*u.y,r[E++]=r[3*h+2]+y*u.z,o&&(o[C++]=o[3*h]+y*d.x,o[C++]=o[3*h+1]+y*d.y,o[C++]=o[3*h+2]+y*d.z),s&&(s[R++]=s[2*h]+y*f.x,s[R++]=s[2*h+1]+y*f.y);m[h][c].push(c),m[c][h]=new Array,x=m[h][c].length;for(let y=0;y<x;y++)m[c][h][y]=m[h][c][x-1-y]}l[0][0]=i[_],l[1][0]=m[i[_]][i[_+1]][1],l[1][1]=m[i[_]][i[_+2]][1];for(let T=2;T<a;T++){l[T][0]=m[i[_]][i[_+1]][T],l[T][T]=m[i[_]][i[_+2]][T],u.x=(r[3*l[T][T]]-r[3*l[T][0]])/T,u.y=(r[3*l[T][T]+1]-r[3*l[T][0]+1])/T,u.z=(r[3*l[T][T]+2]-r[3*l[T][0]+2])/T,o&&(d.x=(o[3*l[T][T]]-o[3*l[T][0]])/T,d.y=(o[3*l[T][T]+1]-o[3*l[T][0]+1])/T,d.z=(o[3*l[T][T]+2]-o[3*l[T][0]+2])/T),s&&(f.x=(s[2*l[T][T]]-s[2*l[T][0]])/T,f.y=(s[2*l[T][T]+1]-s[2*l[T][0]+1])/T);for(let y=1;y<T;y++)l[T][y]=r.length/3,r[E++]=r[3*l[T][0]]+y*u.x,r[E++]=r[3*l[T][0]+1]+y*u.y,r[E++]=r[3*l[T][0]+2]+y*u.z,o&&(o[C++]=o[3*l[T][0]]+y*d.x,o[C++]=o[3*l[T][0]+1]+y*d.y,o[C++]=o[3*l[T][0]+2]+y*d.z),s&&(s[R++]=s[2*l[T][0]]+y*f.x,s[R++]=s[2*l[T][0]+1]+y*f.y)}l[a]=m[i[_+1]][i[_+2]],p.push(l[0][0],l[1][0],l[1][1]);for(let T=1;T<a;T++){let y;for(y=0;y<T;y++)p.push(l[T][y],l[T+1][y],l[T+1][y+1]),p.push(l[T][y],l[T+1][y+1],l[T][y+1]);p.push(l[T][y],l[T+1][y],l[T+1][y+1])}}t.indices=p,t.applyToMesh(this,this.isVertexBufferUpdatable(b.PositionKind))}}forceSharedVertices(){const e=re.ExtractFromMesh(this),t=e.uvs,i=e.indices,r=e.positions,s=e.colors,o=e.matricesIndices,a=e.matricesWeights,l=e.matricesIndicesExtra,h=e.matricesWeightsExtra;if(i===void 0||r===void 0||i===null||r===null)oe.Warn("VertexData contains empty entries");else{const c=new Array,u=new Array,d=new Array,f=new Array,p=new Array,g=new Array,m=new Array,x=new Array;let E=new Array,R=0;const C={};let _,T;for(let P=0;P<i.length;P+=3){T=[i[P],i[P+1],i[P+2]],E=[];for(let D=0;D<3;D++){E[D]="";for(let F=0;F<3;F++)Math.abs(r[3*T[D]+F])<1e-8&&(r[3*T[D]+F]=0),E[D]+=r[3*T[D]+F]+"|"}if(!(E[0]==E[1]||E[0]==E[2]||E[1]==E[2]))for(let D=0;D<3;D++){if(_=C[E[D]],_===void 0){C[E[D]]=R,_=R++;for(let F=0;F<3;F++)c.push(r[3*T[D]+F]);if(s!=null)for(let F=0;F<4;F++)f.push(s[4*T[D]+F]);if(t!=null)for(let F=0;F<2;F++)d.push(t[2*T[D]+F]);if(o!=null)for(let F=0;F<4;F++)p.push(o[4*T[D]+F]);if(a!=null)for(let F=0;F<4;F++)g.push(a[4*T[D]+F]);if(l!=null)for(let F=0;F<4;F++)m.push(l[4*T[D]+F]);if(h!=null)for(let F=0;F<4;F++)x.push(h[4*T[D]+F])}u.push(_)}}const y=new Array;re.ComputeNormals(c,u,y),e.positions=c,e.indices=u,e.normals=y,t!=null&&(e.uvs=d),s!=null&&(e.colors=f),o!=null&&(e.matricesIndices=p),a!=null&&(e.matricesWeights=g),l!=null&&(e.matricesIndicesExtra=m),a!=null&&(e.matricesWeightsExtra=x),e.applyToMesh(this,this.isVertexBufferUpdatable(b.PositionKind))}}static _instancedMeshFactory(e,t){throw Ge("InstancedMesh")}static _PhysicsImpostorParser(e,t,i){throw Ge("PhysicsImpostor")}createInstance(e){return k._instancedMeshFactory(e,this)}synchronizeInstances(){for(let e=0;e<this.instances.length;e++)this.instances[e]._syncSubMeshes();return this}optimizeIndices(e){const t=this.getIndices(),i=this.getVerticesData(b.PositionKind);if(!i||!t)return this;const r=[];for(let o=0;o<i.length;o=o+3)r.push(v.FromArray(i,o));const s=[];return Dr.SyncAsyncForLoop(r.length,40,o=>{const a=r.length-1-o,l=r[a];for(let h=0;h<a;++h){const c=r[h];if(l.equals(c)){s[a]=h;break}}},()=>{for(let a=0;a<t.length;++a)t[a]=s[t[a]]||t[a];const o=this.subMeshes.slice(0);this.setIndices(t),this.subMeshes=o,e&&e(this)}),this}serialize(e={}){e.name=this.name,e.id=this.id,e.uniqueId=this.uniqueId,e.type=this.getClassName(),it&&it.HasTags(this)&&(e.tags=it.GetTags(this)),e.position=this.position.asArray(),this.rotationQuaternion?e.rotationQuaternion=this.rotationQuaternion.asArray():this.rotation&&(e.rotation=this.rotation.asArray()),e.scaling=this.scaling.asArray(),this._postMultiplyPivotMatrix?e.pivotMatrix=this.getPivotMatrix().asArray():e.localMatrix=this.getPivotMatrix().asArray(),e.isEnabled=this.isEnabled(!1),e.isVisible=this.isVisible,e.infiniteDistance=this.infiniteDistance,e.pickable=this.isPickable,e.receiveShadows=this.receiveShadows,e.billboardMode=this.billboardMode,e.visibility=this.visibility,e.alwaysSelectAsActiveMesh=this.alwaysSelectAsActiveMesh,e.checkCollisions=this.checkCollisions,e.ellipsoid=this.ellipsoid.asArray(),e.ellipsoidOffset=this.ellipsoidOffset.asArray(),e.doNotSyncBoundingInfo=this.doNotSyncBoundingInfo,e.isBlocker=this.isBlocker,e.overrideMaterialSideOrientation=this.overrideMaterialSideOrientation,this.parent&&this.parent._serializeAsParent(e),e.isUnIndexed=this.isUnIndexed;const t=this._geometry;if(t&&this.subMeshes){e.geometryUniqueId=t.uniqueId,e.geometryId=t.id,e.subMeshes=[];for(let i=0;i<this.subMeshes.length;i++){const r=this.subMeshes[i];e.subMeshes.push({materialIndex:r.materialIndex,verticesStart:r.verticesStart,verticesCount:r.verticesCount,indexStart:r.indexStart,indexCount:r.indexCount})}}if(this.material?this.material.doNotSerialize||(e.materialUniqueId=this.material.uniqueId,e.materialId=this.material.id):(this.material=null,e.materialUniqueId=this._scene.defaultMaterial.uniqueId,e.materialId=this._scene.defaultMaterial.id),this.morphTargetManager&&(e.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(e.skeletonId=this.skeleton.id,e.numBoneInfluencers=this.numBoneInfluencers),this.getScene()._getComponent(ze.NAME_PHYSICSENGINE)){const i=this.getPhysicsImpostor();i&&(e.physicsMass=i.getParam("mass"),e.physicsFriction=i.getParam("friction"),e.physicsRestitution=i.getParam("mass"),e.physicsImpostor=i.type)}this.metadata&&(e.metadata=this.metadata),e.instances=[];for(let i=0;i<this.instances.length;i++){const r=this.instances[i];if(r.doNotSerialize)continue;const s={name:r.name,id:r.id,isEnabled:r.isEnabled(!1),isVisible:r.isVisible,isPickable:r.isPickable,checkCollisions:r.checkCollisions,position:r.position.asArray(),scaling:r.scaling.asArray()};if(r.parent&&r.parent._serializeAsParent(s),r.rotationQuaternion?s.rotationQuaternion=r.rotationQuaternion.asArray():r.rotation&&(s.rotation=r.rotation.asArray()),this.getScene()._getComponent(ze.NAME_PHYSICSENGINE)){const o=r.getPhysicsImpostor();o&&(s.physicsMass=o.getParam("mass"),s.physicsFriction=o.getParam("friction"),s.physicsRestitution=o.getParam("mass"),s.physicsImpostor=o.type)}r.metadata&&(s.metadata=r.metadata),r.actionManager&&(s.actions=r.actionManager.serialize(r.name)),e.instances.push(s),Le.AppendSerializedAnimations(r,s),s.ranges=r.serializeAnimationRanges()}if(this._thinInstanceDataStorage.instancesCount&&this._thinInstanceDataStorage.matrixData&&(e.thinInstances={instancesCount:this._thinInstanceDataStorage.instancesCount,matrixData:Array.from(this._thinInstanceDataStorage.matrixData),matrixBufferSize:this._thinInstanceDataStorage.matrixBufferSize,enablePicking:this.thinInstanceEnablePicking},this._userThinInstanceBuffersStorage)){const i={data:{},sizes:{},strides:{}};for(const r in this._userThinInstanceBuffersStorage.data)i.data[r]=Array.from(this._userThinInstanceBuffersStorage.data[r]),i.sizes[r]=this._userThinInstanceBuffersStorage.sizes[r],i.strides[r]=this._userThinInstanceBuffersStorage.strides[r];e.thinInstances.userThinInstance=i}return Le.AppendSerializedAnimations(this,e),e.ranges=this.serializeAnimationRanges(),e.layerMask=this.layerMask,e.alphaIndex=this.alphaIndex,e.hasVertexAlpha=this.hasVertexAlpha,e.overlayAlpha=this.overlayAlpha,e.overlayColor=this.overlayColor.asArray(),e.renderOverlay=this.renderOverlay,e.applyFog=this.applyFog,this.actionManager&&(e.actions=this.actionManager.serialize(this.name)),e}_syncGeometryWithMorphTargetManager(){if(!this.geometry)return;this._markSubMeshesAsAttributesDirty();const e=this._internalAbstractMeshDataInfo._morphTargetManager;if(e&&e.vertexCount){if(e.vertexCount!==this.getTotalVertices()){oe.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),this.morphTargetManager=null;return}if(e.isUsingTextureForTargets)return;for(let t=0;t<e.numInfluencers;t++){const i=e.getActiveTarget(t),r=i.getPositions();if(!r){oe.Error("Invalid morph target. Target must have positions.");return}this.geometry.setVerticesData(b.PositionKind+t,r,!1,3);const s=i.getNormals();s&&this.geometry.setVerticesData(b.NormalKind+t,s,!1,3);const o=i.getTangents();o&&this.geometry.setVerticesData(b.TangentKind+t,o,!1,3);const a=i.getUVs();a&&this.geometry.setVerticesData(b.UVKind+"_"+t,a,!1,2)}}else{let t=0;for(;this.geometry.isVerticesDataPresent(b.PositionKind+t);)this.geometry.removeVerticesData(b.PositionKind+t),this.geometry.isVerticesDataPresent(b.NormalKind+t)&&this.geometry.removeVerticesData(b.NormalKind+t),this.geometry.isVerticesDataPresent(b.TangentKind+t)&&this.geometry.removeVerticesData(b.TangentKind+t),this.geometry.isVerticesDataPresent(b.UVKind+t)&&this.geometry.removeVerticesData(b.UVKind+"_"+t),t++}}static Parse(e,t,i){let r;if(e.type&&e.type==="LinesMesh"?r=k._LinesMeshParser(e,t):e.type&&e.type==="GroundMesh"?r=k._GroundMeshParser(e,t):e.type&&e.type==="GoldbergMesh"?r=k._GoldbergMeshParser(e,t):e.type&&e.type==="GreasedLineMesh"?r=k._GreasedLineMeshParser(e,t):e.type&&e.type==="TrailMesh"?r=k._TrailMeshParser(e,t):r=new k(e.name,t),r.id=e.id,r._waitingParsedUniqueId=e.uniqueId,it&&it.AddTagsTo(r,e.tags),r.position=v.FromArray(e.position),e.metadata!==void 0&&(r.metadata=e.metadata),e.rotationQuaternion?r.rotationQuaternion=Re.FromArray(e.rotationQuaternion):e.rotation&&(r.rotation=v.FromArray(e.rotation)),r.scaling=v.FromArray(e.scaling),e.localMatrix?r.setPreTransformMatrix(U.FromArray(e.localMatrix)):e.pivotMatrix&&r.setPivotMatrix(U.FromArray(e.pivotMatrix)),r.setEnabled(e.isEnabled),r.isVisible=e.isVisible,r.infiniteDistance=e.infiniteDistance,r.alwaysSelectAsActiveMesh=!!e.alwaysSelectAsActiveMesh,r.showBoundingBox=e.showBoundingBox,r.showSubMeshesBoundingBox=e.showSubMeshesBoundingBox,e.applyFog!==void 0&&(r.applyFog=e.applyFog),e.pickable!==void 0&&(r.isPickable=e.pickable),e.alphaIndex!==void 0&&(r.alphaIndex=e.alphaIndex),r.receiveShadows=e.receiveShadows,e.billboardMode!==void 0&&(r.billboardMode=e.billboardMode),e.visibility!==void 0&&(r.visibility=e.visibility),r.checkCollisions=e.checkCollisions,r.doNotSyncBoundingInfo=!!e.doNotSyncBoundingInfo,e.ellipsoid&&(r.ellipsoid=v.FromArray(e.ellipsoid)),e.ellipsoidOffset&&(r.ellipsoidOffset=v.FromArray(e.ellipsoidOffset)),e.overrideMaterialSideOrientation!==void 0&&(r.overrideMaterialSideOrientation=e.overrideMaterialSideOrientation),e.isBlocker!==void 0&&(r.isBlocker=e.isBlocker),r._shouldGenerateFlatShading=e.useFlatShading,e.freezeWorldMatrix&&(r._waitingData.freezeWorldMatrix=e.freezeWorldMatrix),e.parentId!==void 0&&(r._waitingParentId=e.parentId),e.parentInstanceIndex!==void 0&&(r._waitingParentInstanceIndex=e.parentInstanceIndex),e.actions!==void 0&&(r._waitingData.actions=e.actions),e.overlayAlpha!==void 0&&(r.overlayAlpha=e.overlayAlpha),e.overlayColor!==void 0&&(r.overlayColor=De.FromArray(e.overlayColor)),e.renderOverlay!==void 0&&(r.renderOverlay=e.renderOverlay),r.isUnIndexed=!!e.isUnIndexed,r.hasVertexAlpha=e.hasVertexAlpha,e.delayLoadingFile?(r.delayLoadState=4,r.delayLoadingFile=i+e.delayLoadingFile,r.buildBoundingInfo(v.FromArray(e.boundingBoxMinimum),v.FromArray(e.boundingBoxMaximum)),e._binaryInfo&&(r._binaryInfo=e._binaryInfo),r._delayInfo=[],e.hasUVs&&r._delayInfo.push(b.UVKind),e.hasUVs2&&r._delayInfo.push(b.UV2Kind),e.hasUVs3&&r._delayInfo.push(b.UV3Kind),e.hasUVs4&&r._delayInfo.push(b.UV4Kind),e.hasUVs5&&r._delayInfo.push(b.UV5Kind),e.hasUVs6&&r._delayInfo.push(b.UV6Kind),e.hasColors&&r._delayInfo.push(b.ColorKind),e.hasMatricesIndices&&r._delayInfo.push(b.MatricesIndicesKind),e.hasMatricesWeights&&r._delayInfo.push(b.MatricesWeightsKind),r._delayLoadingFunction=ls._ImportGeometry,ar.ForceFullSceneLoadingForIncremental&&r._checkDelayState()):ls._ImportGeometry(e,r),e.materialUniqueId?r._waitingMaterialId=e.materialUniqueId:e.materialId&&(r._waitingMaterialId=e.materialId),e.morphTargetManagerId>-1&&(r.morphTargetManager=t.getMorphTargetManagerById(e.morphTargetManagerId)),e.skeletonId!==void 0&&e.skeletonId!==null&&(r.skeleton=t.getLastSkeletonById(e.skeletonId),e.numBoneInfluencers&&(r.numBoneInfluencers=e.numBoneInfluencers)),e.animations){for(let s=0;s<e.animations.length;s++){const o=e.animations[s],a=Er("BABYLON.Animation");a&&r.animations.push(a.Parse(o))}Oi.ParseAnimationRanges(r,e,t)}if(e.autoAnimate&&t.beginAnimation(r,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),e.layerMask&&!isNaN(e.layerMask)?r.layerMask=Math.abs(parseInt(e.layerMask)):r.layerMask=268435455,e.physicsImpostor&&k._PhysicsImpostorParser(t,r,e),e.lodMeshIds&&(r._waitingData.lods={ids:e.lodMeshIds,distances:e.lodDistances?e.lodDistances:null,coverages:e.lodCoverages?e.lodCoverages:null}),e.instances)for(let s=0;s<e.instances.length;s++){const o=e.instances[s],a=r.createInstance(o.name);if(o.id&&(a.id=o.id),it&&(o.tags?it.AddTagsTo(a,o.tags):it.AddTagsTo(a,e.tags)),a.position=v.FromArray(o.position),o.metadata!==void 0&&(a.metadata=o.metadata),o.parentId!==void 0&&(a._waitingParentId=o.parentId),o.parentInstanceIndex!==void 0&&(a._waitingParentInstanceIndex=o.parentInstanceIndex),o.isEnabled!==void 0&&o.isEnabled!==null&&a.setEnabled(o.isEnabled),o.isVisible!==void 0&&o.isVisible!==null&&(a.isVisible=o.isVisible),o.isPickable!==void 0&&o.isPickable!==null&&(a.isPickable=o.isPickable),o.rotationQuaternion?a.rotationQuaternion=Re.FromArray(o.rotationQuaternion):o.rotation&&(a.rotation=v.FromArray(o.rotation)),a.scaling=v.FromArray(o.scaling),o.checkCollisions!=null&&o.checkCollisions!=null&&(a.checkCollisions=o.checkCollisions),o.pickable!=null&&o.pickable!=null&&(a.isPickable=o.pickable),o.showBoundingBox!=null&&o.showBoundingBox!=null&&(a.showBoundingBox=o.showBoundingBox),o.showSubMeshesBoundingBox!=null&&o.showSubMeshesBoundingBox!=null&&(a.showSubMeshesBoundingBox=o.showSubMeshesBoundingBox),o.alphaIndex!=null&&o.showSubMeshesBoundingBox!=null&&(a.alphaIndex=o.alphaIndex),o.physicsImpostor&&k._PhysicsImpostorParser(t,a,o),o.actions!==void 0&&(a._waitingData.actions=o.actions),o.animations){for(let l=0;l<o.animations.length;l++){const h=o.animations[l],c=Er("BABYLON.Animation");c&&a.animations.push(c.Parse(h))}Oi.ParseAnimationRanges(a,o,t),o.autoAnimate&&t.beginAnimation(a,o.autoAnimateFrom,o.autoAnimateTo,o.autoAnimateLoop,o.autoAnimateSpeed||1)}}if(e.thinInstances){const s=e.thinInstances;if(r.thinInstanceEnablePicking=!!s.enablePicking,s.matrixData?(r.thinInstanceSetBuffer("matrix",new Float32Array(s.matrixData),16,!1),r._thinInstanceDataStorage.matrixBufferSize=s.matrixBufferSize,r._thinInstanceDataStorage.instancesCount=s.instancesCount):r._thinInstanceDataStorage.matrixBufferSize=s.matrixBufferSize,e.thinInstances.userThinInstance){const o=e.thinInstances.userThinInstance;for(const a in o.data)r.thinInstanceSetBuffer(a,new Float32Array(o.data[a]),o.strides[a],!1),r._userThinInstanceBuffersStorage.sizes[a]=o.sizes[a]}}return r}setPositionsForCPUSkinning(){const e=this._internalMeshDataInfo;if(!e._sourcePositions){const t=this.getVerticesData(b.PositionKind);if(!t)return e._sourcePositions;e._sourcePositions=new Float32Array(t),this.isVertexBufferUpdatable(b.PositionKind)||this.setVerticesData(b.PositionKind,t,!0)}return e._sourcePositions}setNormalsForCPUSkinning(){const e=this._internalMeshDataInfo;if(!e._sourceNormals){const t=this.getVerticesData(b.NormalKind);if(!t)return e._sourceNormals;e._sourceNormals=new Float32Array(t),this.isVertexBufferUpdatable(b.NormalKind)||this.setVerticesData(b.NormalKind,t,!0)}return e._sourceNormals}applySkeleton(e){if(!this.geometry)return this;if(this.geometry._softwareSkinningFrameId==this.getScene().getFrameId())return this;if(this.geometry._softwareSkinningFrameId=this.getScene().getFrameId(),!this.isVerticesDataPresent(b.PositionKind))return this;if(!this.isVerticesDataPresent(b.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(b.MatricesWeightsKind))return this;const t=this.isVerticesDataPresent(b.NormalKind),i=this._internalMeshDataInfo;if(!i._sourcePositions){const x=this.subMeshes.slice();this.setPositionsForCPUSkinning(),this.subMeshes=x}t&&!i._sourceNormals&&this.setNormalsForCPUSkinning();let r=this.getVerticesData(b.PositionKind);if(!r)return this;r instanceof Float32Array||(r=new Float32Array(r));let s=this.getVerticesData(b.NormalKind);if(t){if(!s)return this;s instanceof Float32Array||(s=new Float32Array(s))}const o=this.getVerticesData(b.MatricesIndicesKind),a=this.getVerticesData(b.MatricesWeightsKind);if(!a||!o)return this;const l=this.numBoneInfluencers>4,h=l?this.getVerticesData(b.MatricesIndicesExtraKind):null,c=l?this.getVerticesData(b.MatricesWeightsExtraKind):null,u=e.getTransformMatrices(this),d=v.Zero(),f=new U,p=new U;let g=0,m;for(let x=0;x<r.length;x+=3,g+=4){let E;for(m=0;m<4;m++)E=a[g+m],E>0&&(U.FromFloat32ArrayToRefScaled(u,Math.floor(o[g+m]*16),E,p),f.addToSelf(p));if(l)for(m=0;m<4;m++)E=c[g+m],E>0&&(U.FromFloat32ArrayToRefScaled(u,Math.floor(h[g+m]*16),E,p),f.addToSelf(p));v.TransformCoordinatesFromFloatsToRef(i._sourcePositions[x],i._sourcePositions[x+1],i._sourcePositions[x+2],f,d),d.toArray(r,x),t&&(v.TransformNormalFromFloatsToRef(i._sourceNormals[x],i._sourceNormals[x+1],i._sourceNormals[x+2],f,d),d.toArray(s,x)),f.reset()}return this.updateVerticesData(b.PositionKind,r),t&&this.updateVerticesData(b.NormalKind,s),this}static MinMax(e){let t=null,i=null;return e.forEach(function(r){const s=r.getBoundingInfo().boundingBox;!t||!i?(t=s.minimumWorld,i=s.maximumWorld):(t.minimizeInPlace(s.minimumWorld),i.maximizeInPlace(s.maximumWorld))}),!t||!i?{min:v.Zero(),max:v.Zero()}:{min:t,max:i}}static Center(e){const t=e instanceof Array?k.MinMax(e):e;return v.Center(t.min,t.max)}static MergeMeshes(e,t=!0,i,r,s,o){return md(k._MergeMeshesCoroutine(e,t,i,r,s,o,!1))}static MergeMeshesAsync(e,t=!0,i,r,s,o){return f0(k._MergeMeshesCoroutine(e,t,i,r,s,o,!0),wy())}static*_MergeMeshesCoroutine(e,t=!0,i,r,s,o,a){if(e=e.filter(Boolean),e.length===0)return null;let l;if(!i){let y=0;for(l=0;l<e.length;l++)if(y+=e[l].getTotalVertices(),y>=65536)return oe.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}o&&(s=!1);const h=new Array,c=new Array,u=new Array,d=e[0].overrideMaterialSideOrientation;for(l=0;l<e.length;l++){const y=e[l];if(y.isAnInstance)return oe.Warn("Cannot merge instance meshes."),null;if(d!==y.overrideMaterialSideOrientation)return oe.Warn("Cannot merge meshes with different overrideMaterialSideOrientation values."),null;if(s&&u.push(y.getTotalIndices()),o)if(y.material){const P=y.material;if(P instanceof Fo){for(let D=0;D<P.subMaterials.length;D++)h.indexOf(P.subMaterials[D])<0&&h.push(P.subMaterials[D]);for(let D=0;D<y.subMeshes.length;D++)c.push(h.indexOf(P.subMaterials[y.subMeshes[D].materialIndex])),u.push(y.subMeshes[D].indexCount)}else{h.indexOf(P)<0&&h.push(P);for(let D=0;D<y.subMeshes.length;D++)c.push(h.indexOf(P)),u.push(y.subMeshes[D].indexCount)}}else for(let P=0;P<y.subMeshes.length;P++)c.push(0),u.push(y.subMeshes[P].indexCount)}const f=e[0],p=y=>{const P=y.computeWorldMatrix(!0);return{vertexData:re.ExtractFromMesh(y,!1,!1),transform:P}},{vertexData:g,transform:m}=p(f);a&&(yield);const x=new Array(e.length-1);for(let y=1;y<e.length;y++)x[y-1]=p(e[y]),a&&(yield);const E=g._mergeCoroutine(m,x,i,a,!t);let R=E.next();for(;!R.done;)a&&(yield),R=E.next();const C=R.value;r||(r=new k(f.name+"_merged",f.getScene()));const _=C._applyToCoroutine(r,void 0,a);let T=_.next();for(;!T.done;)a&&(yield),T=_.next();if(r.checkCollisions=f.checkCollisions,r.overrideMaterialSideOrientation=f.overrideMaterialSideOrientation,t)for(l=0;l<e.length;l++)e[l].dispose();if(s||o){r.releaseSubMeshes(),l=0;let y=0;for(;l<u.length;)Pi.CreateFromIndices(0,y,u[l],r,void 0,!1),y+=u[l],l++;for(const P of r.subMeshes)P.refreshBoundingInfo();r.computeWorldMatrix(!0)}if(o){const y=new Fo(f.name+"_merged",f.getScene());y.subMaterials=h;for(let P=0;P<r.subMeshes.length;P++)r.subMeshes[P].materialIndex=c[P];r.material=y}else r.material=f.material;return r}addInstance(e){e._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(e)}removeInstance(e){const t=e._indexInSourceMeshInstanceArray;if(t!=-1){if(t!==this.instances.length-1){const i=this.instances[this.instances.length-1];this.instances[t]=i,i._indexInSourceMeshInstanceArray=t}e._indexInSourceMeshInstanceArray=-1,this.instances.pop()}}_shouldConvertRHS(){return this.overrideMaterialSideOrientation===ie.CounterClockWiseSideOrientation}_getRenderingFillMode(e){const t=this.getScene();return t.forcePointsCloud?ie.PointFillMode:t.forceWireframe?ie.WireFrameFillMode:this.overrideRenderingFillMode??e}setMaterialByID(e){return this.setMaterialById(e)}static CreateRibbon(e,t,i,r,s,o,a,l,h){throw new Error("Import MeshBuilder to populate this function")}static CreateDisc(e,t,i,r,s,o){throw new Error("Import MeshBuilder to populate this function")}static CreateBox(e,t,i,r,s){throw new Error("Import MeshBuilder to populate this function")}static CreateSphere(e,t,i,r,s,o){throw new Error("Import MeshBuilder to populate this function")}static CreateHemisphere(e,t,i,r){throw new Error("Import MeshBuilder to populate this function")}static CreateCylinder(e,t,i,r,s,o,a,l,h){throw new Error("Import MeshBuilder to populate this function")}static CreateTorus(e,t,i,r,s,o,a){throw new Error("Import MeshBuilder to populate this function")}static CreateTorusKnot(e,t,i,r,s,o,a,l,h,c){throw new Error("Import MeshBuilder to populate this function")}static CreateLines(e,t,i,r,s){throw new Error("Import MeshBuilder to populate this function")}static CreateDashedLines(e,t,i,r,s,o,a,l){throw new Error("Import MeshBuilder to populate this function")}static CreatePolygon(e,t,i,r,s,o,a){throw new Error("Import MeshBuilder to populate this function")}static ExtrudePolygon(e,t,i,r,s,o,a,l){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShape(e,t,i,r,s,o,a,l,h,c){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShapeCustom(e,t,i,r,s,o,a,l,h,c,u,d){throw new Error("Import MeshBuilder to populate this function")}static CreateLathe(e,t,i,r,s,o,a){throw new Error("Import MeshBuilder to populate this function")}static CreatePlane(e,t,i,r,s){throw new Error("Import MeshBuilder to populate this function")}static CreateGround(e,t,i,r,s,o){throw new Error("Import MeshBuilder to populate this function")}static CreateTiledGround(e,t,i,r,s,o,a,l,h){throw new Error("Import MeshBuilder to populate this function")}static CreateGroundFromHeightMap(e,t,i,r,s,o,a,l,h,c,u){throw new Error("Import MeshBuilder to populate this function")}static CreateTube(e,t,i,r,s,o,a,l,h,c){throw new Error("Import MeshBuilder to populate this function")}static CreatePolyhedron(e,t,i){throw new Error("Import MeshBuilder to populate this function")}static CreateIcoSphere(e,t,i){throw new Error("Import MeshBuilder to populate this function")}static CreateDecal(e,t,i,r,s,o){throw new Error("Import MeshBuilder to populate this function")}static CreateCapsule(e,t,i){throw new Error("Import MeshBuilder to populate this function")}static ExtendToGoldberg(e){throw new Error("Import MeshBuilder to populate this function")}}k.FRONTSIDE=re.FRONTSIDE;k.BACKSIDE=re.BACKSIDE;k.DOUBLESIDE=re.DOUBLESIDE;k.DEFAULTSIDE=re.DEFAULTSIDE;k.NO_CAP=0;k.CAP_START=1;k.CAP_END=2;k.CAP_ALL=3;k.NO_FLIP=0;k.FLIP_TILE=1;k.ROTATE_TILE=2;k.FLIP_ROW=3;k.ROTATE_ROW=4;k.FLIP_N_ROTATE_TILE=5;k.FLIP_N_ROTATE_ROW=6;k.CENTER=0;k.LEFT=1;k.RIGHT=2;k.TOP=3;k.BOTTOM=4;k.INSTANCEDMESH_SORT_TRANSPARENT=!1;k._GroundMeshParser=(n,e)=>{throw Ge("GroundMesh")};k._GoldbergMeshParser=(n,e)=>{throw Ge("GoldbergMesh")};k._LinesMeshParser=(n,e)=>{throw Ge("LinesMesh")};k._GreasedLineMeshParser=(n,e)=>{throw Ge("GreasedLineMesh")};k._GreasedLineRibbonMeshParser=(n,e)=>{throw Ge("GreasedLineRibbonMesh")};k._TrailMeshParser=(n,e)=>{throw Ge("TrailMesh")};ye("BABYLON.Mesh",k);let Rl=0;class ya{constructor(e,t,i,r){this.pos=e,this.normal=t,this.uv=i,this.vertColor=r}clone(){var e,t;return new ya(this.pos.clone(),this.normal.clone(),(e=this.uv)==null?void 0:e.clone(),(t=this.vertColor)==null?void 0:t.clone())}flip(){this.normal=this.normal.scale(-1)}interpolate(e,t){return new ya(v.Lerp(this.pos,e.pos,t),v.Lerp(this.normal,e.normal,t),this.uv&&e.uv?me.Lerp(this.uv,e.uv,t):void 0,this.vertColor&&e.vertColor?$e.Lerp(this.vertColor,e.vertColor,t):void 0)}}class On{constructor(e,t){this.normal=e,this.w=t}static FromPoints(e,t,i){const r=i.subtract(e),s=t.subtract(e);if(r.lengthSquared()===0||s.lengthSquared()===0)return null;const o=v.Normalize(v.Cross(r,s));return new On(o,v.Dot(o,e))}clone(){return new On(this.normal.clone(),this.w)}flip(){this.normal.scaleInPlace(-1),this.w=-this.w}splitPolygon(e,t,i,r,s){let o=0;const a=[];let l,h;for(l=0;l<e.vertices.length;l++){h=v.Dot(this.normal,e.vertices[l].pos)-this.w;const c=h<-On.EPSILON?2:h>On.EPSILON?1:0;o|=c,a.push(c)}switch(o){case 0:(v.Dot(this.normal,e.plane.normal)>0?t:i).push(e);break;case 1:r.push(e);break;case 2:s.push(e);break;case 3:{const c=[],u=[];for(l=0;l<e.vertices.length;l++){const f=(l+1)%e.vertices.length,p=a[l],g=a[f],m=e.vertices[l],x=e.vertices[f];if(p!==2&&c.push(m),p!==1&&u.push(p!==2?m.clone():m),(p|g)===3){h=(this.w-v.Dot(this.normal,m.pos))/v.Dot(this.normal,x.pos.subtract(m.pos));const E=m.interpolate(x,h);c.push(E),u.push(E.clone())}}let d;c.length>=3&&(d=new Lo(c,e.shared),d.plane&&r.push(d)),u.length>=3&&(d=new Lo(u,e.shared),d.plane&&s.push(d));break}}}}On.EPSILON=1e-5;class Lo{constructor(e,t){this.vertices=e,this.shared=t,this.plane=On.FromPoints(e[0].pos,e[1].pos,e[2].pos)}clone(){const e=this.vertices.map(t=>t.clone());return new Lo(e,this.shared)}flip(){this.vertices.reverse().map(e=>{e.flip()}),this.plane.flip()}}let Ar=class Jl{constructor(e){this._plane=null,this._front=null,this._back=null,this._polygons=new Array,e&&this.build(e)}clone(){const e=new Jl;return e._plane=this._plane&&this._plane.clone(),e._front=this._front&&this._front.clone(),e._back=this._back&&this._back.clone(),e._polygons=this._polygons.map(t=>t.clone()),e}invert(){for(let t=0;t<this._polygons.length;t++)this._polygons[t].flip();this._plane&&this._plane.flip(),this._front&&this._front.invert(),this._back&&this._back.invert();const e=this._front;this._front=this._back,this._back=e}clipPolygons(e){if(!this._plane)return e.slice();let t=[],i=[];for(let r=0;r<e.length;r++)this._plane.splitPolygon(e[r],t,i,t,i);return this._front&&(t=this._front.clipPolygons(t)),this._back?i=this._back.clipPolygons(i):i=[],t.concat(i)}clipTo(e){this._polygons=e.clipPolygons(this._polygons),this._front&&this._front.clipTo(e),this._back&&this._back.clipTo(e)}allPolygons(){let e=this._polygons.slice();return this._front&&(e=e.concat(this._front.allPolygons())),this._back&&(e=e.concat(this._back.allPolygons())),e}build(e){if(!e.length)return;this._plane||(this._plane=e[0].plane.clone());const t=[],i=[];for(let r=0;r<e.length;r++)this._plane.splitPolygon(e[r],this._polygons,this._polygons,t,i);t.length&&(this._front||(this._front=new Jl),this._front.build(t)),i.length&&(this._back||(this._back=new Jl),this._back.build(i))}};class cs{constructor(){this._polygons=new Array}static FromVertexData(e){let t,i,r;const s=[],o=e.indices,a=e.positions,l=e.normals,h=e.uvs,c=e.colors;if(!o||!a)throw"BABYLON.CSG: VertexData must at least contain positions and indices";for(let d=0;d<o.length;d+=3){r=[];for(let f=0;f<3;f++){const p=d+f,g=o[p],m=l?v.FromArray(l,g*3):v.Zero(),x=h?me.FromArray(h,g*2):void 0,E=c?$e.FromArray(c,g*4):void 0,R=v.FromArray(a,g*3);t=new ya(R,m,x,E),r.push(t)}i=new Lo(r,{subMeshId:0,meshId:Rl,materialIndex:0}),i.plane&&s.push(i)}const u=cs._FromPolygons(s);return u.matrix=U.Identity(),u.position=v.Zero(),u.rotation=v.Zero(),u.scaling=v.One(),u.rotationQuaternion=Re.Identity(),Rl++,u}static FromMesh(e,t=!1){let i,r,s,o,a,l,h;const c=[];let u,d,f,p=null,g,m=!1;if(e instanceof k)e.computeWorldMatrix(!0),u=e.getWorldMatrix(),d=e.position.clone(),f=e.rotation.clone(),e.rotationQuaternion&&(p=e.rotationQuaternion.clone()),g=e.scaling.clone(),e.material&&t&&(m=e.material.sideOrientation===0);else throw"BABYLON.CSG: Wrong Mesh type, must be BABYLON.Mesh";const x=e.getIndices(),E=e.getVerticesData(b.PositionKind),R=e.getVerticesData(b.NormalKind),C=e.getVerticesData(b.UVKind),_=e.getVerticesData(b.ColorKind),T=e.subMeshes;for(let P=0,D=T.length;P<D;P++)for(let F=T[P].indexStart,N=T[P].indexCount+T[P].indexStart;F<N;F+=3){h=[];for(let G=0;G<3;G++){const J=G===0?F+G:m?F+3-G:F+G,j=new v(R[x[J]*3],R[x[J]*3+1],R[x[J]*3+2]);C&&(s=new me(C[x[J]*2],C[x[J]*2+1])),_&&(a=new $e(_[x[J]*4],_[x[J]*4+1],_[x[J]*4+2],_[x[J]*4+3]));const z=new v(E[x[J]*3],E[x[J]*3+1],E[x[J]*3+2]);o=v.TransformCoordinates(z,u),r=v.TransformNormal(j,u),i=new ya(o,r,s,a),h.push(i)}l=new Lo(h,{subMeshId:P,meshId:Rl,materialIndex:T[P].materialIndex}),l.plane&&c.push(l)}const y=cs._FromPolygons(c);return y.matrix=t?U.Identity():u,y.position=t?v.Zero():d,y.rotation=t?v.Zero():f,y.scaling=t?v.One():g,y.rotationQuaternion=t&&p?Re.Identity():p,Rl++,y}static _FromPolygons(e){const t=new cs;return t._polygons=e,t}clone(){const e=new cs;return e._polygons=this._polygons.map(t=>t.clone()),e.copyTransformAttributes(this),e}union(e){const t=new Ar(this.clone()._polygons),i=new Ar(e.clone()._polygons);return t.clipTo(i),i.clipTo(t),i.invert(),i.clipTo(t),i.invert(),t.build(i.allPolygons()),cs._FromPolygons(t.allPolygons()).copyTransformAttributes(this)}unionInPlace(e){const t=new Ar(this._polygons),i=new Ar(e._polygons);t.clipTo(i),i.clipTo(t),i.invert(),i.clipTo(t),i.invert(),t.build(i.allPolygons()),this._polygons=t.allPolygons()}subtract(e){const t=new Ar(this.clone()._polygons),i=new Ar(e.clone()._polygons);return t.invert(),t.clipTo(i),i.clipTo(t),i.invert(),i.clipTo(t),i.invert(),t.build(i.allPolygons()),t.invert(),cs._FromPolygons(t.allPolygons()).copyTransformAttributes(this)}subtractInPlace(e){const t=new Ar(this._polygons),i=new Ar(e._polygons);t.invert(),t.clipTo(i),i.clipTo(t),i.invert(),i.clipTo(t),i.invert(),t.build(i.allPolygons()),t.invert(),this._polygons=t.allPolygons()}intersect(e){const t=new Ar(this.clone()._polygons),i=new Ar(e.clone()._polygons);return t.invert(),i.clipTo(t),i.invert(),t.clipTo(i),i.clipTo(t),t.build(i.allPolygons()),t.invert(),cs._FromPolygons(t.allPolygons()).copyTransformAttributes(this)}intersectInPlace(e){const t=new Ar(this._polygons),i=new Ar(e._polygons);t.invert(),i.clipTo(t),i.invert(),t.clipTo(i),i.clipTo(t),t.build(i.allPolygons()),t.invert(),this._polygons=t.allPolygons()}inverse(){const e=this.clone();return e.inverseInPlace(),e}inverseInPlace(){this._polygons.map(e=>{e.flip()})}copyTransformAttributes(e){return this.matrix=e.matrix,this.position=e.position,this.rotation=e.rotation,this.scaling=e.scaling,this.rotationQuaternion=e.rotationQuaternion,this}toVertexData(e=null,t=null){const i=this.matrix.clone();i.invert();const r=this._polygons,s=[],o=[],a=[];let l=null,h=null;const c=v.Zero(),u=v.Zero(),d=me.Zero(),f=new $e(0,0,0,0),p=[0,0,0],g={};let m;for(let E=0,R=r.length;E<R;E++){const C=r[E];e&&e(C);for(let _=2,T=C.vertices.length;_<T;_++){p[0]=0,p[1]=_-1,p[2]=_;for(let y=0;y<3;y++){c.copyFrom(C.vertices[p[y]].pos),u.copyFrom(C.vertices[p[y]].normal),C.vertices[p[y]].uv&&(l||(l=[]),d.copyFrom(C.vertices[p[y]].uv)),C.vertices[p[y]].vertColor&&(h||(h=[]),f.copyFrom(C.vertices[p[y]].vertColor));const P=v.TransformCoordinates(c,i),D=v.TransformNormal(u,i);m=g[P.x+","+P.y+","+P.z];let F=!1;l&&!(l[m*2]===d.x||l[m*2+1]===d.y)&&(F=!0);let N=!1;h&&!(h[m*4]===f.r||h[m*4+1]===f.g||h[m*4+2]===f.b||h[m*4+3]===f.a)&&(N=!0),(!(typeof m<"u"&&a[m*3]===D.x&&a[m*3+1]===D.y&&a[m*3+2]===D.z)||F||N)&&(s.push(P.x,P.y,P.z),l&&l.push(d.x,d.y),a.push(u.x,u.y,u.z),h&&h.push(f.r,f.g,f.b,f.a),m=g[P.x+","+P.y+","+P.z]=s.length/3-1),o.push(m),t&&t()}}}const x=new re;return x.positions=s,x.normals=a,l&&(x.uvs=l),h&&(x.colors=h),x.indices=o,x}buildMeshGeometry(e,t,i){const r=new k(e,t),s=this._polygons;let o=0;const a={};let l;if(i&&s.sort((h,c)=>h.shared.meshId===c.shared.meshId?h.shared.subMeshId-c.shared.subMeshId:h.shared.meshId-c.shared.meshId),this.toVertexData(h=>{a[h.shared.meshId]||(a[h.shared.meshId]={}),a[h.shared.meshId][h.shared.subMeshId]||(a[h.shared.meshId][h.shared.subMeshId]={indexStart:1/0,indexEnd:-1/0,materialIndex:h.shared.materialIndex}),l=a[h.shared.meshId][h.shared.subMeshId]},()=>{l.indexStart=Math.min(o,l.indexStart),l.indexEnd=Math.max(o,l.indexEnd),o++}).applyToMesh(r),i){let h=0,c;r.subMeshes=[];for(const u in a){c=-1;for(const d in a[u])l=a[u][d],Pi.CreateFromIndices(l.materialIndex+h,l.indexStart,l.indexEnd-l.indexStart+1,r),c=Math.max(l.materialIndex,c);h+=++c}}return r}toMesh(e,t=null,i,r){const s=this.buildMeshGeometry(e,i,r);return s.material=t,s.position.copyFrom(this.position),s.rotation.copyFrom(this.rotation),this.rotationQuaternion&&(s.rotationQuaternion=this.rotationQuaternion.clone()),s.scaling.copyFrom(this.scaling),s.computeWorldMatrix(!0),s}}class Rr{constructor(e,t){this.width=e,this.height=t}toString(){return`{W: ${this.width}, H: ${this.height}}`}getClassName(){return"Size"}getHashCode(){let e=this.width|0;return e=e*397^(this.height|0),e}copyFrom(e){this.width=e.width,this.height=e.height}copyFromFloats(e,t){return this.width=e,this.height=t,this}set(e,t){return this.copyFromFloats(e,t)}multiplyByFloats(e,t){return new Rr(this.width*e,this.height*t)}clone(){return new Rr(this.width,this.height)}equals(e){return e?this.width===e.width&&this.height===e.height:!1}get surface(){return this.width*this.height}static Zero(){return new Rr(0,0)}add(e){return new Rr(this.width+e.width,this.height+e.height)}subtract(e){return new Rr(this.width-e.width,this.height-e.height)}scale(e){return new Rr(this.width*e,this.height*e)}static Lerp(e,t,i){const r=e.width+(t.width-e.width)*i,s=e.height+(t.height-e.height)*i;return new Rr(r,s)}}class yd{get wrapU(){return this._wrapU}set wrapU(e){this._wrapU=e}get wrapV(){return this._wrapV}set wrapV(e){this._wrapV=e}get coordinatesMode(){return 0}get isCube(){return this._texture?this._texture.isCube:!1}set isCube(e){this._texture&&(this._texture.isCube=e)}get is3D(){return this._texture?this._texture.is3D:!1}set is3D(e){this._texture&&(this._texture.is3D=e)}get is2DArray(){return this._texture?this._texture.is2DArray:!1}set is2DArray(e){this._texture&&(this._texture.is2DArray=e)}getClassName(){return"ThinTexture"}static _IsRenderTargetWrapper(e){return(e==null?void 0:e._shareDepth)!==void 0}constructor(e){this._wrapU=1,this._wrapV=1,this.wrapR=1,this.anisotropicFilteringLevel=4,this.delayLoadState=0,this._texture=null,this._engine=null,this._cachedSize=Rr.Zero(),this._cachedBaseSize=Rr.Zero(),this._initialSamplingMode=2,this._texture=yd._IsRenderTargetWrapper(e)?e.texture:e,this._texture&&(this._engine=this._texture.getEngine())}isReady(){return this.delayLoadState===4?(this.delayLoad(),!1):this._texture?this._texture.isReady:!1}delayLoad(){}getInternalTexture(){return this._texture}getSize(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize}getBaseSize(){return!this.isReady()||!this._texture?(this._cachedBaseSize.width=0,this._cachedBaseSize.height=0,this._cachedBaseSize):this._texture._size?(this._cachedBaseSize.width=this._texture._size,this._cachedBaseSize.height=this._texture._size,this._cachedBaseSize):(this._cachedBaseSize.width=this._texture.baseWidth,this._cachedBaseSize.height=this._texture.baseHeight,this._cachedBaseSize)}get samplingMode(){return this._texture?this._texture.samplingMode:this._initialSamplingMode}updateSamplingMode(e){this._texture&&this._engine&&this._engine.updateTextureSamplingMode(e,this._texture)}releaseInternalTexture(){this._texture&&(this._texture.dispose(),this._texture=null)}dispose(){this._texture&&(this.releaseInternalTexture(),this._engine=null)}}class yt extends yd{set hasAlpha(e){this._hasAlpha!==e&&(this._hasAlpha=e,this._scene&&this._scene.markAllMaterialsAsDirty(1,t=>t.hasTexture(this)))}get hasAlpha(){return this._hasAlpha}set getAlphaFromRGB(e){this._getAlphaFromRGB!==e&&(this._getAlphaFromRGB=e,this._scene&&this._scene.markAllMaterialsAsDirty(1,t=>t.hasTexture(this)))}get getAlphaFromRGB(){return this._getAlphaFromRGB}set coordinatesIndex(e){this._coordinatesIndex!==e&&(this._coordinatesIndex=e,this._scene&&this._scene.markAllMaterialsAsDirty(1,t=>t.hasTexture(this)))}get coordinatesIndex(){return this._coordinatesIndex}set coordinatesMode(e){this._coordinatesMode!==e&&(this._coordinatesMode=e,this._scene&&this._scene.markAllMaterialsAsDirty(1,t=>t.hasTexture(this)))}get coordinatesMode(){return this._coordinatesMode}get wrapU(){return this._wrapU}set wrapU(e){this._wrapU=e}get wrapV(){return this._wrapV}set wrapV(e){this._wrapV=e}get isCube(){return this._texture?this._texture.isCube:this._isCube}set isCube(e){this._texture?this._texture.isCube=e:this._isCube=e}get is3D(){return this._texture?this._texture.is3D:!1}set is3D(e){this._texture&&(this._texture.is3D=e)}get is2DArray(){return this._texture?this._texture.is2DArray:!1}set is2DArray(e){this._texture&&(this._texture.is2DArray=e)}get gammaSpace(){if(this._texture)this._texture._gammaSpace===null&&(this._texture._gammaSpace=this._gammaSpace);else return this._gammaSpace;return this._texture._gammaSpace&&!this._texture._useSRGBBuffer}set gammaSpace(e){var t;if(this._texture){if(this._texture._gammaSpace===e)return;this._texture._gammaSpace=e}else{if(this._gammaSpace===e)return;this._gammaSpace=e}(t=this.getScene())==null||t.markAllMaterialsAsDirty(1,i=>i.hasTexture(this))}get isRGBD(){return this._texture!=null&&this._texture._isRGBD}set isRGBD(e){var t;e!==this.isRGBD&&(this._texture&&(this._texture._isRGBD=e),(t=this.getScene())==null||t.markAllMaterialsAsDirty(1,i=>i.hasTexture(this)))}get noMipmap(){return!1}get lodGenerationOffset(){return this._texture?this._texture._lodGenerationOffset:0}set lodGenerationOffset(e){this._texture&&(this._texture._lodGenerationOffset=e)}get lodGenerationScale(){return this._texture?this._texture._lodGenerationScale:0}set lodGenerationScale(e){this._texture&&(this._texture._lodGenerationScale=e)}get linearSpecularLOD(){return this._texture?this._texture._linearSpecularLOD:!1}set linearSpecularLOD(e){this._texture&&(this._texture._linearSpecularLOD=e)}get irradianceTexture(){return this._texture?this._texture._irradianceTexture:null}set irradianceTexture(e){this._texture&&(this._texture._irradianceTexture=e)}get uid(){return this._uid||(this._uid=pd()),this._uid}toString(){return this.name}getClassName(){return"BaseTexture"}set onDispose(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)}get isBlocking(){return!0}get loadingError(){return this._loadingError}get errorObject(){return this._errorObject}constructor(e,t=null){super(null),this.metadata=null,this.reservedDataStore=null,this._hasAlpha=!1,this._getAlphaFromRGB=!1,this.level=1,this._coordinatesIndex=0,this.optimizeUVAllocation=!0,this._coordinatesMode=0,this.wrapR=1,this.anisotropicFilteringLevel=yt.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,this._isCube=!1,this._gammaSpace=!0,this.invertZ=!1,this.lodLevelInAlpha=!1,this.isRenderTarget=!1,this._prefiltered=!1,this._forceSerialize=!1,this.animations=[],this.onDisposeObservable=new he,this._onDisposeObserver=null,this._scene=null,this._uid=null,this._parentContainer=null,this._loadingError=!1,e?yt._IsScene(e)?this._scene=e:this._engine=e:this._scene=rt.LastCreatedScene,this._scene&&(this.uniqueId=this._scene.getUniqueId(),this._scene.addTexture(this),this._engine=this._scene.getEngine()),this._texture=t,this._uid=null}getScene(){return this._scene}_getEngine(){return this._engine}checkTransformsAreIdentical(e){return e!==null}getTextureMatrix(){return U.IdentityReadOnly}getReflectionTextureMatrix(){return U.IdentityReadOnly}getRefractionTextureMatrix(){return this.getReflectionTextureMatrix()}isReadyOrNotBlocking(){return!this.isBlocking||this.isReady()||this.loadingError}scale(e){}get canRescale(){return!1}_getFromCache(e,t,i,r,s,o){const a=this._getEngine();if(!a)return null;const l=a._getUseSRGBBuffer(!!s,t),h=a.getLoadedTexturesCache();for(let c=0;c<h.length;c++){const u=h[c];if((s===void 0||l===u._useSRGBBuffer)&&(r===void 0||r===u.invertY)&&u.url===e&&u.generateMipMaps===!t&&(!i||i===u.samplingMode)&&(o===void 0||o===u.isCube))return u.incrementReferences(),u}return null}_rebuild(e=!1){}clone(){return null}get textureType(){return this._texture&&this._texture.type!==void 0?this._texture.type:0}get textureFormat(){return this._texture&&this._texture.format!==void 0?this._texture.format:5}_markAllSubMeshesAsTexturesDirty(){const e=this.getScene();e&&e.markAllMaterialsAsDirty(1)}readPixels(e=0,t=0,i=null,r=!0,s=!1,o=0,a=0,l=Number.MAX_VALUE,h=Number.MAX_VALUE){if(!this._texture)return null;const c=this._getEngine();if(!c)return null;const u=this.getSize();let d=u.width,f=u.height;t!==0&&(d=d/Math.pow(2,t),f=f/Math.pow(2,t),d=Math.round(d),f=Math.round(f)),l=Math.min(d,l),h=Math.min(f,h);try{return this._texture.isCube?c._readTexturePixels(this._texture,l,h,e,t,i,r,s,o,a):c._readTexturePixels(this._texture,l,h,-1,t,i,r,s,o,a)}catch{return null}}_readPixelsSync(e=0,t=0,i=null,r=!0,s=!1){if(!this._texture)return null;const o=this.getSize();let a=o.width,l=o.height;const h=this._getEngine();if(!h)return null;t!=0&&(a=a/Math.pow(2,t),l=l/Math.pow(2,t),a=Math.round(a),l=Math.round(l));try{return this._texture.isCube?h._readTexturePixelsSync(this._texture,a,l,e,t,i,r,s):h._readTexturePixelsSync(this._texture,a,l,-1,t,i,r,s)}catch{return null}}get _lodTextureHigh(){return this._texture?this._texture._lodTextureHigh:null}get _lodTextureMid(){return this._texture?this._texture._lodTextureMid:null}get _lodTextureLow(){return this._texture?this._texture._lodTextureLow:null}dispose(){if(this._scene){this._scene.stopAnimation&&this._scene.stopAnimation(this),this._scene.removePendingData(this);const e=this._scene.textures.indexOf(this);if(e>=0&&this._scene.textures.splice(e,1),this._scene.onTextureRemovedObservable.notifyObservers(this),this._scene=null,this._parentContainer){const t=this._parentContainer.textures.indexOf(this);t>-1&&this._parentContainer.textures.splice(t,1),this._parentContainer=null}}this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.metadata=null,super.dispose()}serialize(e=!1){if(!this.name&&!e)return null;const t=Le.Serialize(this);return Le.AppendSerializedAnimations(this,t),t}static WhenAllReady(e,t){let i=e.length;if(i===0){t();return}for(let r=0;r<e.length;r++){const s=e[r];if(s.isReady())--i===0&&t();else{const o=s.onLoadObservable;o?o.addOnce(()=>{--i===0&&t()}):--i===0&&t()}}}static _IsScene(e){return e.getClassName()==="Scene"}}yt.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4;M([V()],yt.prototype,"uniqueId",void 0);M([V()],yt.prototype,"name",void 0);M([V()],yt.prototype,"metadata",void 0);M([V("hasAlpha")],yt.prototype,"_hasAlpha",void 0);M([V("getAlphaFromRGB")],yt.prototype,"_getAlphaFromRGB",void 0);M([V()],yt.prototype,"level",void 0);M([V("coordinatesIndex")],yt.prototype,"_coordinatesIndex",void 0);M([V()],yt.prototype,"optimizeUVAllocation",void 0);M([V("coordinatesMode")],yt.prototype,"_coordinatesMode",void 0);M([V()],yt.prototype,"wrapU",null);M([V()],yt.prototype,"wrapV",null);M([V()],yt.prototype,"wrapR",void 0);M([V()],yt.prototype,"anisotropicFilteringLevel",void 0);M([V()],yt.prototype,"isCube",null);M([V()],yt.prototype,"is3D",null);M([V()],yt.prototype,"is2DArray",null);M([V()],yt.prototype,"gammaSpace",null);M([V()],yt.prototype,"invertZ",void 0);M([V()],yt.prototype,"lodLevelInAlpha",void 0);M([V()],yt.prototype,"lodGenerationOffset",null);M([V()],yt.prototype,"lodGenerationScale",null);M([V()],yt.prototype,"linearSpecularLOD",null);M([Tt()],yt.prototype,"irradianceTexture",null);M([V()],yt.prototype,"isRenderTarget",void 0);function y0(n,e,t=!1){const i=e.width,r=e.height;if(n instanceof Float32Array){let l=n.byteLength/n.BYTES_PER_ELEMENT;const h=new Uint8Array(l);for(;--l>=0;){let c=n[l];c<0?c=0:c>1&&(c=1),h[l]=c*255}n=h}const s=document.createElement("canvas");s.width=i,s.height=r;const o=s.getContext("2d");if(!o)return null;const a=o.createImageData(i,r);if(a.data.set(n),o.putImageData(a,0,0),t){const l=document.createElement("canvas");l.width=i,l.height=r;const h=l.getContext("2d");return h?(h.translate(0,r),h.scale(1,-1),h.drawImage(s,0,0),l.toDataURL("image/png")):null}return s.toDataURL("image/png")}function nb(n,e=0,t=0){const i=n.getInternalTexture();if(!i)return null;const r=n._readPixelsSync(e,t);return r?y0(r,n.getSize(),i.invertY):null}async function ob(n,e=0,t=0){const i=n.getInternalTexture();if(!i)return null;const r=await n.readPixels(e,t);return r?y0(r,n.getSize(),i.invertY):null}class le extends yt{static _CreateVideoTexture(e,t,i,r=!1,s=!1,o=le.TRILINEAR_SAMPLINGMODE,a={},l,h=5){throw Ge("VideoTexture")}get noMipmap(){return this._noMipmap}get mimeType(){return this._mimeType}set isBlocking(e){this._isBlocking=e}get isBlocking(){return this._isBlocking}get invertY(){return this._invertY}constructor(e,t,i,r,s=le.TRILINEAR_SAMPLINGMODE,o=null,a=null,l=null,h=!1,c,u,d,f,p){super(t),this.url=null,this.uOffset=0,this.vOffset=0,this.uScale=1,this.vScale=1,this.uAng=0,this.vAng=0,this.wAng=0,this.uRotationCenter=.5,this.vRotationCenter=.5,this.wRotationCenter=.5,this.homogeneousRotationInUVTransform=!1,this.inspectableCustomProperties=null,this._noMipmap=!1,this._invertY=!1,this._rowGenerationMatrix=null,this._cachedTextureMatrix=null,this._projectionModeMatrix=null,this._t0=null,this._t1=null,this._t2=null,this._cachedUOffset=-1,this._cachedVOffset=-1,this._cachedUScale=0,this._cachedVScale=0,this._cachedUAng=-1,this._cachedVAng=-1,this._cachedWAng=-1,this._cachedReflectionProjectionMatrixId=-1,this._cachedURotationCenter=-1,this._cachedVRotationCenter=-1,this._cachedWRotationCenter=-1,this._cachedHomogeneousRotationInUVTransform=!1,this._cachedReflectionTextureMatrix=null,this._cachedReflectionUOffset=-1,this._cachedReflectionVOffset=-1,this._cachedReflectionUScale=0,this._cachedReflectionVScale=0,this._cachedReflectionCoordinatesMode=-1,this._buffer=null,this._deleteBuffer=!1,this._format=null,this._delayedOnLoad=null,this._delayedOnError=null,this.onLoadObservable=new he,this._isBlocking=!0,this.name=e||"",this.url=e;let g,m=!1,x=null,E=!0;typeof i=="object"&&i!==null?(g=i.noMipmap??!1,r=i.invertY??!st.UseOpenGLOrientationForUV,s=i.samplingMode??le.TRILINEAR_SAMPLINGMODE,o=i.onLoad??null,a=i.onError??null,l=i.buffer??null,h=i.deleteBuffer??!1,c=i.format,u=i.mimeType,d=i.loaderOptions,f=i.creationFlags,m=i.useSRGBBuffer??!1,x=i.internalTexture??null,E=i.gammaSpace??E):g=!!i,this._gammaSpace=E,this._noMipmap=g,this._invertY=r===void 0?!st.UseOpenGLOrientationForUV:r,this._initialSamplingMode=s,this._buffer=l,this._deleteBuffer=h,this._mimeType=u,this._loaderOptions=d,this._creationFlags=f,this._useSRGBBuffer=m,this._forcedExtension=p,c&&(this._format=c);const R=this.getScene(),C=this._getEngine();if(!C)return;C.onBeforeTextureInitObservable.notifyObservers(this);const _=()=>{this._texture&&(this._texture._invertVScale&&(this.vScale*=-1,this.vOffset+=1),this._texture._cachedWrapU!==null&&(this.wrapU=this._texture._cachedWrapU,this._texture._cachedWrapU=null),this._texture._cachedWrapV!==null&&(this.wrapV=this._texture._cachedWrapV,this._texture._cachedWrapV=null),this._texture._cachedWrapR!==null&&(this.wrapR=this._texture._cachedWrapR,this._texture._cachedWrapR=null)),this.onLoadObservable.hasObservers()&&this.onLoadObservable.notifyObservers(this),o&&o(),!this.isBlocking&&R&&R.resetCachedMaterial()},T=(y,P)=>{this._loadingError=!0,this._errorObject={message:y,exception:P},a&&a(y,P),le.OnTextureLoadErrorObservable.notifyObservers(this)};if(!this.url&&!x){this._delayedOnLoad=_,this._delayedOnError=T;return}if(this._texture=x??this._getFromCache(this.url,g,s,this._invertY,m,this.isCube),this._texture)if(this._texture.isReady)ah.SetImmediate(()=>_());else{const y=this._texture.onLoadedObservable.add(_);this._texture.onErrorObservable.add(P=>{var D;T(P.message,P.exception),(D=this._texture)==null||D.onLoadedObservable.remove(y)})}else if(!R||!R.useDelayedTextureLoading){try{this._texture=C.createTexture(this.url,g,this._invertY,R,s,_,T,this._buffer,void 0,this._format,this._forcedExtension,u,d,f,m)}catch(y){throw T("error loading",y),y}h&&(this._buffer=null)}else this.delayLoadState=4,this._delayedOnLoad=_,this._delayedOnError=T}updateURL(e,t=null,i,r){this.url&&(this.releaseInternalTexture(),this.getScene().markAllMaterialsAsDirty(1,s=>s.hasTexture(this))),(!this.name||this.name.startsWith("data:"))&&(this.name=e),this.url=e,this._buffer=t,this._forcedExtension=r,this.delayLoadState=4,i&&(this._delayedOnLoad=i),this.delayLoad()}delayLoad(){if(this.delayLoadState!==4)return;const e=this.getScene();e&&(this.delayLoadState=1,this._texture=this._getFromCache(this.url,this._noMipmap,this.samplingMode,this._invertY,this._useSRGBBuffer,this.isCube),this._texture?this._delayedOnLoad&&(this._texture.isReady?ah.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=e.getEngine().createTexture(this.url,this._noMipmap,this._invertY,e,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format,this._forcedExtension,this._mimeType,this._loaderOptions,this._creationFlags,this._useSRGBBuffer),this._deleteBuffer&&(this._buffer=null)),this._delayedOnLoad=null,this._delayedOnError=null)}_prepareRowForTextureGeneration(e,t,i,r){e*=this._cachedUScale,t*=this._cachedVScale,e-=this.uRotationCenter*this._cachedUScale,t-=this.vRotationCenter*this._cachedVScale,i-=this.wRotationCenter,v.TransformCoordinatesFromFloatsToRef(e,t,i,this._rowGenerationMatrix,r),r.x+=this.uRotationCenter*this._cachedUScale+this._cachedUOffset,r.y+=this.vRotationCenter*this._cachedVScale+this._cachedVOffset,r.z+=this.wRotationCenter}checkTransformsAreIdentical(e){return e!==null&&this.uOffset===e.uOffset&&this.vOffset===e.vOffset&&this.uScale===e.uScale&&this.vScale===e.vScale&&this.uAng===e.uAng&&this.vAng===e.vAng&&this.wAng===e.wAng}getTextureMatrix(e=1){if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale*e===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng&&this.uRotationCenter===this._cachedURotationCenter&&this.vRotationCenter===this._cachedVRotationCenter&&this.wRotationCenter===this._cachedWRotationCenter&&this.homogeneousRotationInUVTransform===this._cachedHomogeneousRotationInUVTransform)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale*e,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedURotationCenter=this.uRotationCenter,this._cachedVRotationCenter=this.vRotationCenter,this._cachedWRotationCenter=this.wRotationCenter,this._cachedHomogeneousRotationInUVTransform=this.homogeneousRotationInUVTransform,(!this._cachedTextureMatrix||!this._rowGenerationMatrix)&&(this._cachedTextureMatrix=U.Zero(),this._rowGenerationMatrix=new U,this._t0=v.Zero(),this._t1=v.Zero(),this._t2=v.Zero()),U.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this.homogeneousRotationInUVTransform?(U.TranslationToRef(-this._cachedURotationCenter,-this._cachedVRotationCenter,-this._cachedWRotationCenter,W.Matrix[0]),U.TranslationToRef(this._cachedURotationCenter,this._cachedVRotationCenter,this._cachedWRotationCenter,W.Matrix[1]),U.ScalingToRef(this._cachedUScale,this._cachedVScale,0,W.Matrix[2]),U.TranslationToRef(this._cachedUOffset,this._cachedVOffset,0,W.Matrix[3]),W.Matrix[0].multiplyToRef(this._rowGenerationMatrix,this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(W.Matrix[1],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(W.Matrix[2],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(W.Matrix[3],this._cachedTextureMatrix),this._cachedTextureMatrix.setRowFromFloats(2,this._cachedTextureMatrix.m[12],this._cachedTextureMatrix.m[13],this._cachedTextureMatrix.m[14],1)):(this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.subtractInPlace(this._t0),this._t2.subtractInPlace(this._t0),U.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix));const t=this.getScene();return t?(this.optimizeUVAllocation&&t.markAllMaterialsAsDirty(1,i=>i.hasTexture(this)),this._cachedTextureMatrix):this._cachedTextureMatrix}getReflectionTextureMatrix(){const e=this.getScene();if(!e)return this._cachedReflectionTextureMatrix;if(this.uOffset===this._cachedReflectionUOffset&&this.vOffset===this._cachedReflectionVOffset&&this.uScale===this._cachedReflectionUScale&&this.vScale===this._cachedReflectionVScale&&this.coordinatesMode===this._cachedReflectionCoordinatesMode)if(this.coordinatesMode===le.PROJECTION_MODE){if(this._cachedReflectionProjectionMatrixId===e.getProjectionMatrix().updateFlag)return this._cachedReflectionTextureMatrix}else return this._cachedReflectionTextureMatrix;this._cachedReflectionTextureMatrix||(this._cachedReflectionTextureMatrix=U.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=U.Zero());const t=this._cachedReflectionCoordinatesMode!==this.coordinatesMode;switch(this._cachedReflectionUOffset=this.uOffset,this._cachedReflectionVOffset=this.vOffset,this._cachedReflectionUScale=this.uScale,this._cachedReflectionVScale=this.vScale,this._cachedReflectionCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case le.PLANAR_MODE:{U.IdentityToRef(this._cachedReflectionTextureMatrix),this._cachedReflectionTextureMatrix[0]=this.uScale,this._cachedReflectionTextureMatrix[5]=this.vScale,this._cachedReflectionTextureMatrix[12]=this.uOffset,this._cachedReflectionTextureMatrix[13]=this.vOffset;break}case le.PROJECTION_MODE:{U.FromValuesToRef(.5,0,0,0,0,-.5,0,0,0,0,0,0,.5,.5,1,1,this._projectionModeMatrix);const i=e.getProjectionMatrix();this._cachedReflectionProjectionMatrixId=i.updateFlag,i.multiplyToRef(this._projectionModeMatrix,this._cachedReflectionTextureMatrix);break}default:U.IdentityToRef(this._cachedReflectionTextureMatrix);break}return t&&e.markAllMaterialsAsDirty(1,i=>i.hasTexture(this)),this._cachedReflectionTextureMatrix}clone(){const e={noMipmap:this._noMipmap,invertY:this._invertY,samplingMode:this.samplingMode,onLoad:void 0,onError:void 0,buffer:this._texture?this._texture._buffer:void 0,deleteBuffer:this._deleteBuffer,format:this.textureFormat,mimeType:this.mimeType,loaderOptions:this._loaderOptions,creationFlags:this._creationFlags,useSRGBBuffer:this._useSRGBBuffer};return Le.Clone(()=>new le(this._texture?this._texture.url:null,this.getScene(),e),this)}serialize(){var e;const t=this.name;le.SerializeBuffers||this.name.startsWith("data:")&&(this.name=""),this.name.startsWith("data:")&&this.url===this.name&&(this.url="");const i=super.serialize(le._SerializeInternalTextureUniqueId);return i?((le.SerializeBuffers||le.ForceSerializeBuffers)&&(typeof this._buffer=="string"&&this._buffer.substr(0,5)==="data:"?(i.base64String=this._buffer,i.name=i.name.replace("data:","")):this.url&&this.url.startsWith("data:")&&this._buffer instanceof Uint8Array?i.base64String="data:image/png;base64,"+Z_(this._buffer):(le.ForceSerializeBuffers||this.url&&this.url.startsWith("blob:")||this._forceSerialize)&&(i.base64String=!this._engine||this._engine._features.supportSyncTextureRead?nb(this):ob(this))),i.invertY=this._invertY,i.samplingMode=this.samplingMode,i._creationFlags=this._creationFlags,i._useSRGBBuffer=this._useSRGBBuffer,le._SerializeInternalTextureUniqueId&&(i.internalTextureUniqueId=((e=this._texture)==null?void 0:e.uniqueId)??void 0),i.noMipmap=this._noMipmap,this.name=t,i):null}getClassName(){return"Texture"}dispose(){super.dispose(),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null,this._buffer=null}static Parse(e,t,i){if(e.customType){const a=ga.Instantiate(e.customType).Parse(e,t,i);return e.samplingMode&&a.updateSamplingMode&&a._samplingMode&&a._samplingMode!==e.samplingMode&&a.updateSamplingMode(e.samplingMode),a}if(e.isCube&&!e.isRenderTarget)return le._CubeTextureParser(e,t,i);const r=e.internalTextureUniqueId!==void 0;if(!e.name&&!e.isRenderTarget&&!r)return null;let s;if(r){const a=t.getEngine().getLoadedTexturesCache();for(const l of a)if(l.uniqueId===e.internalTextureUniqueId){s=l;break}}const o=a=>{var l;if(a&&a._texture&&(a._texture._cachedWrapU=null,a._texture._cachedWrapV=null,a._texture._cachedWrapR=null),e.samplingMode){const h=e.samplingMode;a&&a.samplingMode!==h&&a.updateSamplingMode(h)}if(a&&e.animations)for(let h=0;h<e.animations.length;h++){const c=e.animations[h],u=Er("BABYLON.Animation");u&&a.animations.push(u.Parse(c))}r&&!s&&((l=a==null?void 0:a._texture)==null||l._setUniqueId(e.internalTextureUniqueId))};return Le.Parse(()=>{let a=!0;if(e.noMipmap&&(a=!1),e.mirrorPlane){const l=le._CreateMirror(e.name,e.renderTargetSize,t,a);return l._waitingRenderList=e.renderList,l.mirrorPlane=Zr.FromArray(e.mirrorPlane),o(l),l}else if(e.isRenderTarget){let l=null;if(e.isCube){if(t.reflectionProbes)for(let h=0;h<t.reflectionProbes.length;h++){const c=t.reflectionProbes[h];if(c.name===e.name)return c.cubeTexture}}else l=le._CreateRenderTargetTexture(e.name,e.renderTargetSize,t,a,e._creationFlags??0),l._waitingRenderList=e.renderList;return o(l),l}else if(e.isVideo){const l=le._CreateVideoTexture(i+(e.url||e.name),i+(e.src||e.url),t,a,e.invertY,e.samplingMode,e.settings||{});return o(l),l}else{let l;if(e.base64String&&!s)l=le.CreateFromBase64String(e.base64String,e.base64String,t,!a,e.invertY,e.samplingMode,()=>{o(l)},e._creationFlags??0,e._useSRGBBuffer??!1),l.name=e.name;else{let h;e.name&&(e.name.indexOf("://")>0||e.name.startsWith("data:"))?h=e.name:h=i+e.name,e.url&&(e.url.startsWith("data:")||le.UseSerializedUrlIfAny)&&(h=e.url);const c={noMipmap:!a,invertY:e.invertY,samplingMode:e.samplingMode,onLoad:()=>{o(l)},internalTexture:s};l=new le(h,t,c)}return l}},e,t)}static CreateFromBase64String(e,t,i,r,s,o=le.TRILINEAR_SAMPLINGMODE,a=null,l=null,h=5,c){return new le("data:"+t,i,r,s,o,a,l,e,!1,h,void 0,void 0,c)}static LoadFromDataString(e,t,i,r=!1,s,o=!0,a=le.TRILINEAR_SAMPLINGMODE,l=null,h=null,c=5,u){return e.substr(0,5)!=="data:"&&(e="data:"+e),new le(e,i,s,o,a,l,h,t,r,c,void 0,void 0,u)}}le.SerializeBuffers=!0;le.ForceSerializeBuffers=!1;le.OnTextureLoadErrorObservable=new he;le._SerializeInternalTextureUniqueId=!1;le._CubeTextureParser=(n,e,t)=>{throw Ge("CubeTexture")};le._CreateMirror=(n,e,t,i)=>{throw Ge("MirrorTexture")};le._CreateRenderTargetTexture=(n,e,t,i,r)=>{throw Ge("RenderTargetTexture")};le.NEAREST_SAMPLINGMODE=1;le.NEAREST_NEAREST_MIPLINEAR=8;le.BILINEAR_SAMPLINGMODE=2;le.LINEAR_LINEAR_MIPNEAREST=11;le.TRILINEAR_SAMPLINGMODE=3;le.LINEAR_LINEAR_MIPLINEAR=3;le.NEAREST_NEAREST_MIPNEAREST=4;le.NEAREST_LINEAR_MIPNEAREST=5;le.NEAREST_LINEAR_MIPLINEAR=6;le.NEAREST_LINEAR=7;le.NEAREST_NEAREST=1;le.LINEAR_NEAREST_MIPNEAREST=9;le.LINEAR_NEAREST_MIPLINEAR=10;le.LINEAR_LINEAR=2;le.LINEAR_NEAREST=12;le.EXPLICIT_MODE=0;le.SPHERICAL_MODE=1;le.PLANAR_MODE=2;le.CUBIC_MODE=3;le.PROJECTION_MODE=4;le.SKYBOX_MODE=5;le.INVCUBIC_MODE=6;le.EQUIRECTANGULAR_MODE=7;le.FIXED_EQUIRECTANGULAR_MODE=8;le.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9;le.CLAMP_ADDRESSMODE=0;le.WRAP_ADDRESSMODE=1;le.MIRROR_ADDRESSMODE=2;le.UseSerializedUrlIfAny=!1;M([V()],le.prototype,"url",void 0);M([V()],le.prototype,"uOffset",void 0);M([V()],le.prototype,"vOffset",void 0);M([V()],le.prototype,"uScale",void 0);M([V()],le.prototype,"vScale",void 0);M([V()],le.prototype,"uAng",void 0);M([V()],le.prototype,"vAng",void 0);M([V()],le.prototype,"wAng",void 0);M([V()],le.prototype,"uRotationCenter",void 0);M([V()],le.prototype,"vRotationCenter",void 0);M([V()],le.prototype,"wRotationCenter",void 0);M([V()],le.prototype,"homogeneousRotationInUVTransform",void 0);M([V()],le.prototype,"isBlocking",null);ye("BABYLON.Texture",le);Le._TextureParser=le.Parse;class bd{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(e,t){this._defines[e]||(e<this._currentRank&&(this._currentRank=e),e>this._maxRank&&(this._maxRank=e),this._defines[e]=new Array),this._defines[e].push(t)}addCPUSkinningFallback(e,t){this._mesh=t,e<this._currentRank&&(this._currentRank=e),e>this._maxRank&&(this._maxRank=e)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(e,t){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,e=e.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),t._bonesComputationForcedToCPU=!0;const i=this._mesh.getScene();for(let r=0;r<i.meshes.length;r++){const s=i.meshes[r];if(!s.material){!this._mesh.material&&s.computeBonesUsingShaders&&s.numBoneInfluencers>0&&(s.computeBonesUsingShaders=!1);continue}if(!(!s.computeBonesUsingShaders||s.numBoneInfluencers===0)){if(s.material.getEffect()===t)s.computeBonesUsingShaders=!1;else if(s.subMeshes){for(const o of s.subMeshes)if(o.effect===t){s.computeBonesUsingShaders=!1;break}}}}}else{const i=this._defines[this._currentRank];if(i)for(let r=0;r<i.length;r++)e=e.replace("#define "+i[r],"");this._currentRank++}return e}}class qh extends ie{constructor(e,t,i=!0){super(e,t),this._normalMatrix=new U,this._storeEffectOnSubMeshes=i}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(e,t){return e?!this._storeEffectOnSubMeshes||!e.subMeshes||e.subMeshes.length===0?!0:this.isReadyForSubMesh(e,e.subMeshes[0],t):!1}_isReadyForSubMesh(e){const t=e.materialDefines;return!!(!this.checkReadyOnEveryCall&&e.effect&&t&&t._renderId===this.getScene().getRenderId())}bindOnlyWorldMatrix(e){this._activeEffect.setMatrix("world",e)}bindOnlyNormalMatrix(e){this._activeEffect.setMatrix("normalMatrix",e)}bind(e,t){t&&this.bindForSubMesh(e,t,t.subMeshes[0])}_afterBind(e,t=null,i){super._afterBind(e,t,i),this.getScene()._cachedEffect=t,i?i._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(e,t,i,r=1){return i._drawWrapper._forceRebindOnNextCall||e.isCachedMaterialInvalid(this,t,r)}dispose(e,t,i){this._activeEffect=void 0,super.dispose(e,t,i)}}const $c={effect:null,subMesh:null};class Hs extends qh{constructor(e,t,i,r={},s=!0){super(e,t,s),this._textures={},this._textureArrays={},this._externalTextures={},this._floats={},this._ints={},this._uints={},this._floatsArrays={},this._colors3={},this._colors3Arrays={},this._colors4={},this._colors4Arrays={},this._vectors2={},this._vectors3={},this._vectors4={},this._quaternions={},this._quaternionsArrays={},this._matrices={},this._matrixArrays={},this._matrices3x3={},this._matrices2x2={},this._vectors2Arrays={},this._vectors3Arrays={},this._vectors4Arrays={},this._uniformBuffers={},this._textureSamplers={},this._storageBuffers={},this._cachedWorldViewMatrix=new U,this._cachedWorldViewProjectionMatrix=new U,this._multiview=!1,this._materialHelperNeedsPreviousMatrices=!1,this._shaderPath=i,this._options={needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","normal","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],externalTextures:[],samplerObjects:[],storageBuffers:[],defines:[],useClipPlane:!1,...r}}get shaderPath(){return this._shaderPath}set shaderPath(e){this._shaderPath=e}get options(){return this._options}get isMultiview(){return this._multiview}getClassName(){return"ShaderMaterial"}needAlphaBlending(){return this.alpha<1||this._options.needAlphaBlending}needAlphaTesting(){return this._options.needAlphaTesting}_checkUniform(e){this._options.uniforms.indexOf(e)===-1&&this._options.uniforms.push(e)}setTexture(e,t){return this._options.samplers.indexOf(e)===-1&&this._options.samplers.push(e),this._textures[e]=t,this}setTextureArray(e,t){return this._options.samplers.indexOf(e)===-1&&this._options.samplers.push(e),this._checkUniform(e),this._textureArrays[e]=t,this}setExternalTexture(e,t){return this._options.externalTextures.indexOf(e)===-1&&this._options.externalTextures.push(e),this._externalTextures[e]=t,this}setFloat(e,t){return this._checkUniform(e),this._floats[e]=t,this}setInt(e,t){return this._checkUniform(e),this._ints[e]=t,this}setUInt(e,t){return this._checkUniform(e),this._uints[e]=t,this}setFloats(e,t){return this._checkUniform(e),this._floatsArrays[e]=t,this}setColor3(e,t){return this._checkUniform(e),this._colors3[e]=t,this}setColor3Array(e,t){return this._checkUniform(e),this._colors3Arrays[e]=t.reduce((i,r)=>(r.toArray(i,i.length),i),[]),this}setColor4(e,t){return this._checkUniform(e),this._colors4[e]=t,this}setColor4Array(e,t){return this._checkUniform(e),this._colors4Arrays[e]=t.reduce((i,r)=>(r.toArray(i,i.length),i),[]),this}setVector2(e,t){return this._checkUniform(e),this._vectors2[e]=t,this}setVector3(e,t){return this._checkUniform(e),this._vectors3[e]=t,this}setVector4(e,t){return this._checkUniform(e),this._vectors4[e]=t,this}setQuaternion(e,t){return this._checkUniform(e),this._quaternions[e]=t,this}setQuaternionArray(e,t){return this._checkUniform(e),this._quaternionsArrays[e]=t.reduce((i,r)=>(r.toArray(i,i.length),i),[]),this}setMatrix(e,t){return this._checkUniform(e),this._matrices[e]=t,this}setMatrices(e,t){this._checkUniform(e);const i=new Float32Array(t.length*16);for(let r=0;r<t.length;r++)t[r].copyToArray(i,r*16);return this._matrixArrays[e]=i,this}setMatrix3x3(e,t){return this._checkUniform(e),this._matrices3x3[e]=t,this}setMatrix2x2(e,t){return this._checkUniform(e),this._matrices2x2[e]=t,this}setArray2(e,t){return this._checkUniform(e),this._vectors2Arrays[e]=t,this}setArray3(e,t){return this._checkUniform(e),this._vectors3Arrays[e]=t,this}setArray4(e,t){return this._checkUniform(e),this._vectors4Arrays[e]=t,this}setUniformBuffer(e,t){return this._options.uniformBuffers.indexOf(e)===-1&&this._options.uniformBuffers.push(e),this._uniformBuffers[e]=t,this}setTextureSampler(e,t){return this._options.samplerObjects.indexOf(e)===-1&&this._options.samplerObjects.push(e),this._textureSamplers[e]=t,this}setStorageBuffer(e,t){return this._options.storageBuffers.indexOf(e)===-1&&this._options.storageBuffers.push(e),this._storageBuffers[e]=t,this}setDefine(e,t){const i=e.trimEnd()+" ",r=this.options.defines.findIndex(s=>s===e||s.startsWith(i));return r>=0&&this.options.defines.splice(r,1),(typeof t!="boolean"||t)&&this.options.defines.push(i+t),this}isReadyForSubMesh(e,t,i){return this.isReady(e,i,t)}isReady(e,t,i){const r=i&&this._storeEffectOnSubMeshes;if(this.isFrozen){const _=r?i._drawWrapper:this._drawWrapper;if(_.effect&&_._wasPreviouslyReady&&_._wasPreviouslyUsingInstances===t)return!0}const s=this.getScene(),o=s.getEngine(),a=[],l=[],h=new bd;let c=this._shaderPath,u=this._options.uniforms,d=this._options.uniformBuffers,f=this._options.samplers;o.getCaps().multiview&&s.activeCamera&&s.activeCamera.outputRenderTarget&&s.activeCamera.outputRenderTarget.getViewCount()>1&&(this._multiview=!0,a.push("#define MULTIVIEW"),u.indexOf("viewProjection")!==-1&&u.indexOf("viewProjectionR")===-1&&u.push("viewProjectionR"));for(let _=0;_<this._options.defines.length;_++){const T=this._options.defines[_].indexOf("#define")===0?this._options.defines[_]:`#define ${this._options.defines[_]}`;a.push(T)}for(let _=0;_<this._options.attributes.length;_++)l.push(this._options.attributes[_]);if(e&&e.isVerticesDataPresent(b.ColorKind)&&(l.indexOf(b.ColorKind)===-1&&l.push(b.ColorKind),a.push("#define VERTEXCOLOR")),t&&(a.push("#define INSTANCES"),g0(l,this._materialHelperNeedsPreviousMatrices),e!=null&&e.hasThinInstances&&(a.push("#define THIN_INSTANCES"),e&&e.isVerticesDataPresent(b.ColorInstanceKind)&&(l.push(b.ColorInstanceKind),a.push("#define INSTANCESCOLOR")))),e&&e.useBones&&e.computeBonesUsingShaders&&e.skeleton){l.push(b.MatricesIndicesKind),l.push(b.MatricesWeightsKind),e.numBoneInfluencers>4&&(l.push(b.MatricesIndicesExtraKind),l.push(b.MatricesWeightsExtraKind));const _=e.skeleton;a.push("#define NUM_BONE_INFLUENCERS "+e.numBoneInfluencers),h.addCPUSkinningFallback(0,e),_.isUsingTextureForMatrices?(a.push("#define BONETEXTURE"),u.indexOf("boneTextureWidth")===-1&&u.push("boneTextureWidth"),this._options.samplers.indexOf("boneSampler")===-1&&this._options.samplers.push("boneSampler")):(a.push("#define BonesPerMesh "+(_.bones.length+1)),u.indexOf("mBones")===-1&&u.push("mBones"))}else a.push("#define NUM_BONE_INFLUENCERS 0");let p=0;const g=e?e.morphTargetManager:null;if(g){const _=g.supportsUVs&&a.indexOf("#define UV1")!==-1,T=g.supportsTangents&&a.indexOf("#define TANGENT")!==-1,y=g.supportsNormals&&a.indexOf("#define NORMAL")!==-1;p=g.numMaxInfluencers||g.numInfluencers,_&&a.push("#define MORPHTARGETS_UV"),T&&a.push("#define MORPHTARGETS_TANGENT"),y&&a.push("#define MORPHTARGETS_NORMAL"),p>0&&a.push("#define MORPHTARGETS"),g.isUsingTextureForTargets&&(a.push("#define MORPHTARGETS_TEXTURE"),u.indexOf("morphTargetTextureIndices")===-1&&u.push("morphTargetTextureIndices"),this._options.samplers.indexOf("morphTargets")===-1&&this._options.samplers.push("morphTargets")),a.push("#define NUM_MORPH_INFLUENCERS "+p);for(let P=0;P<p;P++)l.push(b.PositionKind+P),y&&l.push(b.NormalKind+P),T&&l.push(b.TangentKind+P),_&&l.push(b.UVKind+"_"+P);p>0&&(u=u.slice(),u.push("morphTargetInfluences"),u.push("morphTargetCount"),u.push("morphTargetTextureInfo"),u.push("morphTargetTextureIndices"))}else a.push("#define NUM_MORPH_INFLUENCERS 0");if(e){const _=e.bakedVertexAnimationManager;_&&_.isEnabled&&(a.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),u.indexOf("bakedVertexAnimationSettings")===-1&&u.push("bakedVertexAnimationSettings"),u.indexOf("bakedVertexAnimationTextureSizeInverted")===-1&&u.push("bakedVertexAnimationTextureSizeInverted"),u.indexOf("bakedVertexAnimationTime")===-1&&u.push("bakedVertexAnimationTime"),this._options.samplers.indexOf("bakedVertexAnimationTexture")===-1&&this._options.samplers.push("bakedVertexAnimationTexture")),vd(l,e,a)}for(const _ in this._textures)if(!this._textures[_].isReady())return!1;e&&this._shouldTurnAlphaTestOn(e)&&a.push("#define ALPHATEST"),this._options.useClipPlane!==!1&&(Wh(u),Xy(this,s,a)),s.fogEnabled&&e!=null&&e.applyFog&&s.fogMode!==Pt.FOGMODE_NONE&&(a.push("#define FOG"),u.indexOf("view")===-1&&u.push("view"),u.indexOf("vFogInfos")===-1&&u.push("vFogInfos"),u.indexOf("vFogColor")===-1&&u.push("vFogColor")),this._useLogarithmicDepth&&(a.push("#define LOGARITHMICDEPTH"),u.indexOf("logarithmicDepthConstant")===-1&&u.push("logarithmicDepthConstant")),this.customShaderNameResolve&&(u=u.slice(),d=d.slice(),f=f.slice(),c=this.customShaderNameResolve(this.name,u,d,f,a,l));const m=r?i._getDrawWrapper(void 0,!0):this._drawWrapper,x=(m==null?void 0:m.effect)??null,E=(m==null?void 0:m.defines)??null,R=a.join(`
`);let C=x;return E!==R&&(C=o.createEffect(c,{attributes:l,uniformsNames:u,uniformBuffersNames:d,samplers:f,defines:R,fallbacks:h,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousMorphTargets:p},shaderLanguage:this._options.shaderLanguage},o),r?i.setEffect(C,R,this._materialContext):m&&m.setEffect(C,R),this._onEffectCreatedObservable&&($c.effect=C,$c.subMesh=i??(e==null?void 0:e.subMeshes[0])??null,this._onEffectCreatedObservable.notifyObservers($c))),m._wasPreviouslyUsingInstances=!!t,C!=null&&C.isReady()?(x!==C&&s.resetCachedMaterial(),m._wasPreviouslyReady=!0,!0):!1}bindOnlyWorldMatrix(e,t){const i=this.getScene(),r=t??this.getEffect();r&&(this._options.uniforms.indexOf("world")!==-1&&r.setMatrix("world",e),this._options.uniforms.indexOf("worldView")!==-1&&(e.multiplyToRef(i.getViewMatrix(),this._cachedWorldViewMatrix),r.setMatrix("worldView",this._cachedWorldViewMatrix)),this._options.uniforms.indexOf("worldViewProjection")!==-1&&(e.multiplyToRef(i.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),r.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)),this._options.uniforms.indexOf("view")!==-1&&r.setMatrix("view",i.getViewMatrix()))}bindForSubMesh(e,t,i){var r;this.bind(e,t,(r=i._drawWrapperOverride)==null?void 0:r.effect,i)}bind(e,t,i,r){var s;const o=r&&this._storeEffectOnSubMeshes,a=i??(o?r.effect:this.getEffect());if(!a)return;const l=this.getScene();this._activeEffect=a,this.bindOnlyWorldMatrix(e,i);const h=this._options.uniformBuffers;let c=!1;if(a&&h&&h.length>0&&l.getEngine().supportsUniformBuffers)for(let d=0;d<h.length;++d)switch(h[d]){case"Mesh":t&&(t.getMeshUniformBuffer().bindToEffect(a,"Mesh"),t.transferToEffect(e));break;case"Scene":m0(a,l.getSceneUniformBuffer()),l.finalizeSceneUbo(),c=!0;break}const u=t&&o?this._mustRebind(l,a,r,t.visibility):l.getCachedMaterial()!==this;if(a&&u){!c&&this._options.uniforms.indexOf("view")!==-1&&a.setMatrix("view",l.getViewMatrix()),!c&&this._options.uniforms.indexOf("projection")!==-1&&a.setMatrix("projection",l.getProjectionMatrix()),!c&&this._options.uniforms.indexOf("viewProjection")!==-1&&(a.setMatrix("viewProjection",l.getTransformMatrix()),this._multiview&&a.setMatrix("viewProjectionR",l._transformMatrixR)),l.activeCamera&&this._options.uniforms.indexOf("cameraPosition")!==-1&&a.setVector3("cameraPosition",l.activeCamera.globalPosition),Ed(t,a),Xh(a,this,l),this._useLogarithmicDepth&&Hh(o?r.materialDefines:a.defines,a,l),t&&Kh(l,t,a);let d;for(d in this._textures)a.setTexture(d,this._textures[d]);for(d in this._textureArrays)a.setTextureArray(d,this._textureArrays[d]);for(d in this._externalTextures)a.setExternalTexture(d,this._externalTextures[d]);for(d in this._ints)a.setInt(d,this._ints[d]);for(d in this._uints)a.setUInt(d,this._uints[d]);for(d in this._floats)a.setFloat(d,this._floats[d]);for(d in this._floatsArrays)a.setArray(d,this._floatsArrays[d]);for(d in this._colors3)a.setColor3(d,this._colors3[d]);for(d in this._colors3Arrays)a.setArray3(d,this._colors3Arrays[d]);for(d in this._colors4){const f=this._colors4[d];a.setFloat4(d,f.r,f.g,f.b,f.a)}for(d in this._colors4Arrays)a.setArray4(d,this._colors4Arrays[d]);for(d in this._vectors2)a.setVector2(d,this._vectors2[d]);for(d in this._vectors3)a.setVector3(d,this._vectors3[d]);for(d in this._vectors4)a.setVector4(d,this._vectors4[d]);for(d in this._quaternions)a.setQuaternion(d,this._quaternions[d]);for(d in this._matrices)a.setMatrix(d,this._matrices[d]);for(d in this._matrixArrays)a.setMatrices(d,this._matrixArrays[d]);for(d in this._matrices3x3)a.setMatrix3x3(d,this._matrices3x3[d]);for(d in this._matrices2x2)a.setMatrix2x2(d,this._matrices2x2[d]);for(d in this._vectors2Arrays)a.setArray2(d,this._vectors2Arrays[d]);for(d in this._vectors3Arrays)a.setArray3(d,this._vectors3Arrays[d]);for(d in this._vectors4Arrays)a.setArray4(d,this._vectors4Arrays[d]);for(d in this._quaternionsArrays)a.setArray4(d,this._quaternionsArrays[d]);for(d in this._uniformBuffers){const f=this._uniformBuffers[d].getBuffer();f&&a.bindUniformBuffer(f,d)}for(d in this._textureSamplers)a.setTextureSampler(d,this._textureSamplers[d]);for(d in this._storageBuffers)a.setStorageBuffer(d,this._storageBuffers[d])}if(a&&t&&(u||!this.isFrozen)){const d=t.morphTargetManager;d&&d.numInfluencers>0&&_d(t,a);const f=t.bakedVertexAnimationManager;if(f&&f.isEnabled){const p=o?r._drawWrapper:this._drawWrapper;(s=t.bakedVertexAnimationManager)==null||s.bind(a,!!p._wasPreviouslyUsingInstances)}}this._afterBind(t,a,r)}getActiveTextures(){const e=super.getActiveTextures();for(const t in this._textures)e.push(this._textures[t]);for(const t in this._textureArrays){const i=this._textureArrays[t];for(let r=0;r<i.length;r++)e.push(i[r])}return e}hasTexture(e){if(super.hasTexture(e))return!0;for(const t in this._textures)if(this._textures[t]===e)return!0;for(const t in this._textureArrays){const i=this._textureArrays[t];for(let r=0;r<i.length;r++)if(i[r]===e)return!0}return!1}clone(e){const t=Le.Clone(()=>new Hs(e,this.getScene(),this._shaderPath,this._options,this._storeEffectOnSubMeshes),this);t.name=e,t.id=e,typeof t._shaderPath=="object"&&(t._shaderPath={...t._shaderPath}),this._options={...this._options},Object.keys(this._options).forEach(i=>{const r=this._options[i];Array.isArray(r)&&(this._options[i]=r.slice(0))}),this.stencil.copyTo(t.stencil);for(const i in this._textures)t.setTexture(i,this._textures[i]);for(const i in this._textureArrays)t.setTextureArray(i,this._textureArrays[i]);for(const i in this._externalTextures)t.setExternalTexture(i,this._externalTextures[i]);for(const i in this._ints)t.setInt(i,this._ints[i]);for(const i in this._uints)t.setUInt(i,this._uints[i]);for(const i in this._floats)t.setFloat(i,this._floats[i]);for(const i in this._floatsArrays)t.setFloats(i,this._floatsArrays[i]);for(const i in this._colors3)t.setColor3(i,this._colors3[i]);for(const i in this._colors3Arrays)t._colors3Arrays[i]=this._colors3Arrays[i];for(const i in this._colors4)t.setColor4(i,this._colors4[i]);for(const i in this._colors4Arrays)t._colors4Arrays[i]=this._colors4Arrays[i];for(const i in this._vectors2)t.setVector2(i,this._vectors2[i]);for(const i in this._vectors3)t.setVector3(i,this._vectors3[i]);for(const i in this._vectors4)t.setVector4(i,this._vectors4[i]);for(const i in this._quaternions)t.setQuaternion(i,this._quaternions[i]);for(const i in this._quaternionsArrays)t._quaternionsArrays[i]=this._quaternionsArrays[i];for(const i in this._matrices)t.setMatrix(i,this._matrices[i]);for(const i in this._matrixArrays)t._matrixArrays[i]=this._matrixArrays[i].slice();for(const i in this._matrices3x3)t.setMatrix3x3(i,this._matrices3x3[i]);for(const i in this._matrices2x2)t.setMatrix2x2(i,this._matrices2x2[i]);for(const i in this._vectors2Arrays)t.setArray2(i,this._vectors2Arrays[i]);for(const i in this._vectors3Arrays)t.setArray3(i,this._vectors3Arrays[i]);for(const i in this._vectors4Arrays)t.setArray4(i,this._vectors4Arrays[i]);for(const i in this._uniformBuffers)t.setUniformBuffer(i,this._uniformBuffers[i]);for(const i in this._textureSamplers)t.setTextureSampler(i,this._textureSamplers[i]);for(const i in this._storageBuffers)t.setStorageBuffer(i,this._storageBuffers[i]);return t}dispose(e,t,i){if(t){let r;for(r in this._textures)this._textures[r].dispose();for(r in this._textureArrays){const s=this._textureArrays[r];for(let o=0;o<s.length;o++)s[o].dispose()}}this._textures={},super.dispose(e,t,i)}serialize(){const e=Le.Serialize(this);e.customType="BABYLON.ShaderMaterial",e.uniqueId=this.uniqueId,e.options=this._options,e.shaderPath=this._shaderPath,e.storeEffectOnSubMeshes=this._storeEffectOnSubMeshes;let t;e.stencil=this.stencil.serialize(),e.textures={};for(t in this._textures)e.textures[t]=this._textures[t].serialize();e.textureArrays={};for(t in this._textureArrays){e.textureArrays[t]=[];const i=this._textureArrays[t];for(let r=0;r<i.length;r++)e.textureArrays[t].push(i[r].serialize())}e.ints={};for(t in this._ints)e.ints[t]=this._ints[t];e.uints={};for(t in this._uints)e.uints[t]=this._uints[t];e.floats={};for(t in this._floats)e.floats[t]=this._floats[t];e.floatsArrays={};for(t in this._floatsArrays)e.floatsArrays[t]=this._floatsArrays[t];e.colors3={};for(t in this._colors3)e.colors3[t]=this._colors3[t].asArray();e.colors3Arrays={};for(t in this._colors3Arrays)e.colors3Arrays[t]=this._colors3Arrays[t];e.colors4={};for(t in this._colors4)e.colors4[t]=this._colors4[t].asArray();e.colors4Arrays={};for(t in this._colors4Arrays)e.colors4Arrays[t]=this._colors4Arrays[t];e.vectors2={};for(t in this._vectors2)e.vectors2[t]=this._vectors2[t].asArray();e.vectors3={};for(t in this._vectors3)e.vectors3[t]=this._vectors3[t].asArray();e.vectors4={};for(t in this._vectors4)e.vectors4[t]=this._vectors4[t].asArray();e.quaternions={};for(t in this._quaternions)e.quaternions[t]=this._quaternions[t].asArray();e.matrices={};for(t in this._matrices)e.matrices[t]=this._matrices[t].asArray();e.matrixArray={};for(t in this._matrixArrays)e.matrixArray[t]=this._matrixArrays[t];e.matrices3x3={};for(t in this._matrices3x3)e.matrices3x3[t]=this._matrices3x3[t];e.matrices2x2={};for(t in this._matrices2x2)e.matrices2x2[t]=this._matrices2x2[t];e.vectors2Arrays={};for(t in this._vectors2Arrays)e.vectors2Arrays[t]=this._vectors2Arrays[t];e.vectors3Arrays={};for(t in this._vectors3Arrays)e.vectors3Arrays[t]=this._vectors3Arrays[t];e.vectors4Arrays={};for(t in this._vectors4Arrays)e.vectors4Arrays[t]=this._vectors4Arrays[t];e.quaternionsArrays={};for(t in this._quaternionsArrays)e.quaternionsArrays[t]=this._quaternionsArrays[t];return e}static Parse(e,t,i){const r=Le.Parse(()=>new Hs(e.name,t,e.shaderPath,e.options,e.storeEffectOnSubMeshes),e,t,i);let s;e.stencil&&r.stencil.parse(e.stencil,t,i);for(s in e.textures)r.setTexture(s,le.Parse(e.textures[s],t,i));for(s in e.textureArrays){const o=e.textureArrays[s],a=[];for(let l=0;l<o.length;l++)a.push(le.Parse(o[l],t,i));r.setTextureArray(s,a)}for(s in e.ints)r.setInt(s,e.ints[s]);for(s in e.uints)r.setUInt(s,e.uints[s]);for(s in e.floats)r.setFloat(s,e.floats[s]);for(s in e.floatsArrays)r.setFloats(s,e.floatsArrays[s]);for(s in e.colors3)r.setColor3(s,De.FromArray(e.colors3[s]));for(s in e.colors3Arrays){const o=e.colors3Arrays[s].reduce((a,l,h)=>(h%3===0?a.push([l]):a[a.length-1].push(l),a),[]).map(a=>De.FromArray(a));r.setColor3Array(s,o)}for(s in e.colors4)r.setColor4(s,$e.FromArray(e.colors4[s]));for(s in e.colors4Arrays){const o=e.colors4Arrays[s].reduce((a,l,h)=>(h%4===0?a.push([l]):a[a.length-1].push(l),a),[]).map(a=>$e.FromArray(a));r.setColor4Array(s,o)}for(s in e.vectors2)r.setVector2(s,me.FromArray(e.vectors2[s]));for(s in e.vectors3)r.setVector3(s,v.FromArray(e.vectors3[s]));for(s in e.vectors4)r.setVector4(s,Ke.FromArray(e.vectors4[s]));for(s in e.quaternions)r.setQuaternion(s,Re.FromArray(e.quaternions[s]));for(s in e.matrices)r.setMatrix(s,U.FromArray(e.matrices[s]));for(s in e.matrixArray)r._matrixArrays[s]=new Float32Array(e.matrixArray[s]);for(s in e.matrices3x3)r.setMatrix3x3(s,e.matrices3x3[s]);for(s in e.matrices2x2)r.setMatrix2x2(s,e.matrices2x2[s]);for(s in e.vectors2Arrays)r.setArray2(s,e.vectors2Arrays[s]);for(s in e.vectors3Arrays)r.setArray3(s,e.vectors3Arrays[s]);for(s in e.vectors4Arrays)r.setArray4(s,e.vectors4Arrays[s]);for(s in e.quaternionsArrays)r.setArray4(s,e.quaternionsArrays[s]);return r}static ParseFromFileAsync(e,t,i,r=""){return new Promise((s,o)=>{const a=new Ei;a.addEventListener("readystatechange",()=>{if(a.readyState==4)if(a.status==200){const l=JSON.parse(a.responseText),h=this.Parse(l,i||rt.LastCreatedScene,r);e&&(h.name=e),s(h)}else o("Unable to load the ShaderMaterial")}),a.open("GET",t),a.send()})}static ParseFromSnippetAsync(e,t,i=""){return new Promise((r,s)=>{const o=new Ei;o.addEventListener("readystatechange",()=>{if(o.readyState==4)if(o.status==200){const a=JSON.parse(JSON.parse(o.responseText).jsonPayload),l=JSON.parse(a.shaderMaterial),h=this.Parse(l,t||rt.LastCreatedScene,i);h.snippetId=e,r(h)}else s("Unable to load the snippet "+e)}),o.open("GET",this.SnippetUrl+"/"+e.replace(/#/g,"/")),o.send()})}}Hs.SnippetUrl="https://snippet.babylonjs.com";Hs.CreateFromSnippetAsync=Hs.ParseFromSnippetAsync;ye("BABYLON.ShaderMaterial",Hs);class ab{get depthStencilTexture(){return this._depthStencilTexture}get depthStencilTextureWithStencil(){return this._depthStencilTextureWithStencil}get isCube(){return this._isCube}get isMulti(){return this._isMulti}get is2DArray(){return this.layers>0}get size(){return this.width}get width(){return this._size.width||this._size}get height(){return this._size.height||this._size}get layers(){return this._size.layers||0}get texture(){var e;return((e=this._textures)==null?void 0:e[0])??null}get textures(){return this._textures}get faceIndices(){return this._faceIndices}get layerIndices(){return this._layerIndices}get samples(){return this._samples}setSamples(e,t=!0,i=!1){if(this.samples===e&&!i)return e;const r=this._isMulti?this._engine.updateMultipleRenderTargetTextureSampleCount(this,e,t):this._engine.updateRenderTargetTextureSampleCount(this,e);return this._samples=e,r}constructor(e,t,i,r,s){this._textures=null,this._faceIndices=null,this._layerIndices=null,this._samples=1,this._attachments=null,this._generateStencilBuffer=!1,this._generateDepthBuffer=!1,this._depthStencilTextureWithStencil=!1,this._isMulti=e,this._isCube=t,this._size=i,this._engine=r,this._depthStencilTexture=null,this.label=s}setTextures(e){Array.isArray(e)?this._textures=e:e?this._textures=[e]:this._textures=null}setTexture(e,t=0,i=!0){this._textures||(this._textures=[]),this._textures[t]!==e&&(this._textures[t]&&i&&this._textures[t].dispose(),this._textures[t]=e)}setLayerAndFaceIndices(e,t){this._layerIndices=e,this._faceIndices=t}setLayerAndFaceIndex(e=0,t,i){this._layerIndices||(this._layerIndices=[]),this._faceIndices||(this._faceIndices=[]),t!==void 0&&t>=0&&(this._layerIndices[e]=t),i!==void 0&&i>=0&&(this._faceIndices[e]=i)}createDepthStencilTexture(e=0,t=!0,i=!1,r=1,s=14,o){var a;return(a=this._depthStencilTexture)==null||a.dispose(),this._depthStencilTextureWithStencil=i,this._depthStencilTextureLabel=o,this._depthStencilTexture=this._engine.createDepthStencilTexture(this._size,{bilinearFiltering:t,comparisonFunction:e,generateStencil:i,isCube:this._isCube,samples:r,depthTextureFormat:s,label:o},this),this._depthStencilTexture}_shareDepth(e){this._depthStencilTexture&&(e._depthStencilTexture&&e._depthStencilTexture.dispose(),e._depthStencilTexture=this._depthStencilTexture,this._depthStencilTexture.incrementReferences())}_swapAndDie(e){this.texture&&this.texture._swapAndDie(e),this._textures=null,this.dispose(!0)}_cloneRenderTargetWrapper(){var e,t,i,r,s;let o=null;if(this._isMulti){const a=this.textures;if(a&&a.length>0){let l=!1,h=a.length,c=-1;const u=a[a.length-1]._source;(u===Dt.Depth||u===Dt.DepthStencil)&&(l=!0,c=a[a.length-1].format,h--);const d=[],f=[],p=[],g=[],m=[],x=[],E=[],R={};for(let T=0;T<h;++T){const y=a[T];d.push(y.samplingMode),f.push(y.type),p.push(y.format),R[y.uniqueId]!==void 0?(g.push(-1),E.push(0)):(R[y.uniqueId]=T,y.is2DArray?(g.push(35866),E.push(y.depth)):y.isCube?(g.push(34067),E.push(0)):y.is3D?(g.push(32879),E.push(y.depth)):(g.push(3553),E.push(0))),this._faceIndices&&m.push(this._faceIndices[T]??0),this._layerIndices&&x.push(this._layerIndices[T]??0)}const C={samplingModes:d,generateMipMaps:a[0].generateMipMaps,generateDepthBuffer:this._generateDepthBuffer,generateStencilBuffer:this._generateStencilBuffer,generateDepthTexture:l,depthTextureFormat:c,types:f,formats:p,textureCount:h,targetTypes:g,faceIndex:m,layerIndex:x,layerCounts:E,label:this.label},_={width:this.width,height:this.height};o=this._engine.createMultipleRenderTarget(_,C);for(let T=0;T<h;++T){if(g[T]!==-1)continue;const y=R[a[T].uniqueId];o.setTexture(o.textures[y],T)}}}else{const a={};if(a.generateDepthBuffer=this._generateDepthBuffer,a.generateMipMaps=((e=this.texture)==null?void 0:e.generateMipMaps)??!1,a.generateStencilBuffer=this._generateStencilBuffer,a.samplingMode=(t=this.texture)==null?void 0:t.samplingMode,a.type=(i=this.texture)==null?void 0:i.type,a.format=(r=this.texture)==null?void 0:r.format,a.noColorAttachment=!this._textures,a.label=this.label,this.isCube)o=this._engine.createRenderTargetCubeTexture(this.width,a);else{const l={width:this.width,height:this.height,layers:this.is2DArray?(s=this.texture)==null?void 0:s.depth:void 0};o=this._engine.createRenderTargetTexture(l,a)}o.texture&&(o.texture.isReady=!0)}return o}_swapRenderTargetWrapper(e){if(this._textures&&e._textures)for(let t=0;t<this._textures.length;++t)this._textures[t]._swapAndDie(e._textures[t],!1),e._textures[t].isReady=!0;this._depthStencilTexture&&e._depthStencilTexture&&(this._depthStencilTexture._swapAndDie(e._depthStencilTexture),e._depthStencilTexture.isReady=!0),this._textures=null,this._depthStencilTexture=null}_rebuild(){const e=this._cloneRenderTargetWrapper();if(e){if(this._depthStencilTexture){const t=this._depthStencilTexture.samplingMode,i=this._depthStencilTexture.format,r=t===2||t===3||t===11;e.createDepthStencilTexture(this._depthStencilTexture._comparisonFunction,r,this._depthStencilTextureWithStencil,this._depthStencilTexture.samples,i,this._depthStencilTextureLabel)}this.samples>1&&e.setSamples(this.samples),e._swapRenderTargetWrapper(this),e.dispose()}}releaseTextures(){var e;if(this._textures)for(let t=0;t<((e=this._textures)==null?void 0:e.length);++t)this._textures[t].dispose();this._textures=null}dispose(e=!1){var t;e||((t=this._depthStencilTexture)==null||t.dispose(),this._depthStencilTexture=null,this.releaseTextures()),this._engine._releaseRenderTargetWrapper(this)}}class lb extends ab{constructor(e,t,i,r,s){super(e,t,i,r),this._framebuffer=null,this._depthStencilBuffer=null,this._MSAAFramebuffer=null,this._colorTextureArray=null,this._depthStencilTextureArray=null,this._disposeOnlyFramebuffers=!1,this._currentLOD=0,this._context=s}_cloneRenderTargetWrapper(){let e=null;return this._colorTextureArray&&this._depthStencilTextureArray?(e=this._engine.createMultiviewRenderTargetTexture(this.width,this.height),e.texture.isReady=!0):e=super._cloneRenderTargetWrapper(),e}_swapRenderTargetWrapper(e){super._swapRenderTargetWrapper(e),e._framebuffer=this._framebuffer,e._depthStencilBuffer=this._depthStencilBuffer,e._MSAAFramebuffer=this._MSAAFramebuffer,e._colorTextureArray=this._colorTextureArray,e._depthStencilTextureArray=this._depthStencilTextureArray,this._framebuffer=this._depthStencilBuffer=this._MSAAFramebuffer=this._colorTextureArray=this._depthStencilTextureArray=null}createDepthStencilTexture(e=0,t=!0,i=!1,r=1,s=14,o){if(this._depthStencilBuffer){const a=this._engine._currentFramebuffer,l=this._context;this._engine._bindUnboundFramebuffer(this._framebuffer),l.framebufferRenderbuffer(l.FRAMEBUFFER,l.DEPTH_STENCIL_ATTACHMENT,l.RENDERBUFFER,null),l.framebufferRenderbuffer(l.FRAMEBUFFER,l.DEPTH_ATTACHMENT,l.RENDERBUFFER,null),l.framebufferRenderbuffer(l.FRAMEBUFFER,l.STENCIL_ATTACHMENT,l.RENDERBUFFER,null),this._engine._bindUnboundFramebuffer(a),l.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null}return super.createDepthStencilTexture(e,t,i,r,s,o)}_shareDepth(e){super._shareDepth(e);const t=this._context,i=this._depthStencilBuffer,r=e._MSAAFramebuffer||e._framebuffer;e._depthStencilBuffer&&e._depthStencilBuffer!==i&&t.deleteRenderbuffer(e._depthStencilBuffer),e._depthStencilBuffer=i;const s=e._generateStencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;this._engine._bindUnboundFramebuffer(r),t.framebufferRenderbuffer(t.FRAMEBUFFER,s,t.RENDERBUFFER,i),this._engine._bindUnboundFramebuffer(null)}_bindTextureRenderTarget(e,t=0,i,r=0){var s,o;if(!e._hardwareTexture)return;const a=this._framebuffer,l=this._engine._currentFramebuffer;if(this._engine._bindUnboundFramebuffer(a),this._engine.webGLVersion>1){const h=this._context,c=h["COLOR_ATTACHMENT"+t];e.is2DArray||e.is3D?(i=i??((s=this.layerIndices)==null?void 0:s[t])??0,h.framebufferTextureLayer(h.FRAMEBUFFER,c,e._hardwareTexture.underlyingResource,r,i)):e.isCube?(i=i??((o=this.faceIndices)==null?void 0:o[t])??0,h.framebufferTexture2D(h.FRAMEBUFFER,c,h.TEXTURE_CUBE_MAP_POSITIVE_X+i,e._hardwareTexture.underlyingResource,r)):h.framebufferTexture2D(h.FRAMEBUFFER,c,h.TEXTURE_2D,e._hardwareTexture.underlyingResource,r)}else{const h=this._context,c=h["COLOR_ATTACHMENT"+t+"_WEBGL"],u=i!==void 0?h.TEXTURE_CUBE_MAP_POSITIVE_X+i:h.TEXTURE_2D;h.framebufferTexture2D(h.FRAMEBUFFER,c,u,e._hardwareTexture.underlyingResource,r)}this._engine._bindUnboundFramebuffer(l)}setTexture(e,t=0,i=!0){super.setTexture(e,t,i),this._bindTextureRenderTarget(e,t)}setLayerAndFaceIndices(e,t){var i;if(super.setLayerAndFaceIndices(e,t),!this.textures||!this.layerIndices||!this.faceIndices)return;const r=((i=this._attachments)==null?void 0:i.length)??this.textures.length;for(let s=0;s<r;s++){const o=this.textures[s];o&&(o.is2DArray||o.is3D?this._bindTextureRenderTarget(o,s,this.layerIndices[s]):o.isCube?this._bindTextureRenderTarget(o,s,this.faceIndices[s]):this._bindTextureRenderTarget(o,s))}}setLayerAndFaceIndex(e=0,t,i){if(super.setLayerAndFaceIndex(e,t,i),!this.textures||!this.layerIndices||!this.faceIndices)return;const r=this.textures[e];r.is2DArray||r.is3D?this._bindTextureRenderTarget(this.textures[e],e,this.layerIndices[e]):r.isCube&&this._bindTextureRenderTarget(this.textures[e],e,this.faceIndices[e])}dispose(e=this._disposeOnlyFramebuffers){const t=this._context;e||(this._colorTextureArray&&(this._context.deleteTexture(this._colorTextureArray),this._colorTextureArray=null),this._depthStencilTextureArray&&(this._context.deleteTexture(this._depthStencilTextureArray),this._depthStencilTextureArray=null)),this._framebuffer&&(t.deleteFramebuffer(this._framebuffer),this._framebuffer=null),this._depthStencilBuffer&&(t.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null),this._MSAAFramebuffer&&(t.deleteFramebuffer(this._MSAAFramebuffer),this._MSAAFramebuffer=null),super.dispose(e)}}Oe.prototype._createHardwareRenderTargetWrapper=function(n,e,t){const i=new lb(n,e,t,this,this._gl);return this._renderTargetWrapperCache.push(i),i};Oe.prototype.createRenderTargetTexture=function(n,e){const t=this._createHardwareRenderTargetWrapper(!1,!1,n);let i=!0,r=!1,s=!1,o,a=1,l;e!==void 0&&typeof e=="object"&&(i=e.generateDepthBuffer??!0,r=!!e.generateStencilBuffer,s=!!e.noColorAttachment,o=e.colorAttachment,a=e.samples??1,l=e.label);const h=o||(s?null:this._createInternalTexture(n,e,!0,Dt.RenderTarget)),c=n.width||n,u=n.height||n,d=this._currentFramebuffer,f=this._gl,p=f.createFramebuffer();return this._bindUnboundFramebuffer(p),t._depthStencilBuffer=this._setupFramebufferDepthAttachments(r,i,c,u),h&&!h.is2DArray&&f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,h._hardwareTexture.underlyingResource,0),this._bindUnboundFramebuffer(d),t.label=l??"RenderTargetWrapper",t._framebuffer=p,t._generateDepthBuffer=i,t._generateStencilBuffer=r,t.setTextures(h),this.updateRenderTargetTextureSampleCount(t,a),t};Oe.prototype.createDepthStencilTexture=function(n,e,t){if(e.isCube){const i=n.width||n;return this._createDepthStencilCubeTexture(i,e)}else return this._createDepthStencilTexture(n,e,t)};Oe.prototype._createDepthStencilTexture=function(n,e){const t=this._gl,i=n.layers||0,r=i!==0?t.TEXTURE_2D_ARRAY:t.TEXTURE_2D,s=new ur(this,Dt.DepthStencil);if(s.label=e.label,!this._caps.depthTextureExtension)return oe.Error("Depth texture is not supported by your browser or hardware."),s;const o={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...e};if(this._bindTextureDirectly(r,s,!0),this._setupDepthStencilTexture(s,n,o.generateStencil,o.comparisonFunction===0?!1:o.bilinearFiltering,o.comparisonFunction,o.samples),o.depthTextureFormat!==void 0){if(o.depthTextureFormat!==15&&o.depthTextureFormat!==16&&o.depthTextureFormat!==17&&o.depthTextureFormat!==13&&o.depthTextureFormat!==14&&o.depthTextureFormat!==18)return oe.Error("Depth texture format is not supported."),s;s.format=o.depthTextureFormat}else s.format=o.generateStencil?13:16;const a=s.format===17||s.format===13||s.format===18;let l=t.UNSIGNED_INT;s.format===15?l=t.UNSIGNED_SHORT:s.format===17||s.format===13?l=t.UNSIGNED_INT_24_8:s.format===14?l=t.FLOAT:s.format===18&&(l=t.FLOAT_32_UNSIGNED_INT_24_8_REV);const h=a?t.DEPTH_STENCIL:t.DEPTH_COMPONENT;let c=h;return this.webGLVersion>1&&(s.format===15?c=t.DEPTH_COMPONENT16:s.format===16?c=t.DEPTH_COMPONENT24:s.format===17||s.format===13?c=t.DEPTH24_STENCIL8:s.format===14?c=t.DEPTH_COMPONENT32F:s.format===18&&(c=t.DEPTH32F_STENCIL8)),s.is2DArray?t.texImage3D(r,0,c,s.width,s.height,i,0,h,l,null):t.texImage2D(r,0,c,s.width,s.height,0,h,l,null),this._bindTextureDirectly(r,null),this._internalTexturesCache.push(s),s};Oe.prototype.updateRenderTargetTextureSampleCount=function(n,e){if(this.webGLVersion<2||!n||!n.texture)return 1;if(n.samples===e)return e;const t=this._gl;e=Math.min(e,this.getCaps().maxMSAASamples),n._depthStencilBuffer&&(t.deleteRenderbuffer(n._depthStencilBuffer),n._depthStencilBuffer=null),n._MSAAFramebuffer&&(t.deleteFramebuffer(n._MSAAFramebuffer),n._MSAAFramebuffer=null);const i=n.texture._hardwareTexture;if(i.releaseMSAARenderBuffers(),e>1&&typeof t.renderbufferStorageMultisample=="function"){const r=t.createFramebuffer();if(!r)throw new Error("Unable to create multi sampled framebuffer");n._MSAAFramebuffer=r,this._bindUnboundFramebuffer(n._MSAAFramebuffer);const s=this._createRenderBuffer(n.texture.width,n.texture.height,e,-1,this._getRGBABufferInternalSizedFormat(n.texture.type,n.texture.format,n.texture._useSRGBBuffer),t.COLOR_ATTACHMENT0,!1);if(!s)throw new Error("Unable to create multi sampled framebuffer");i.addMSAARenderBuffer(s)}else this._bindUnboundFramebuffer(n._framebuffer);return n.texture.samples=e,n._samples=e,n._depthStencilBuffer=this._setupFramebufferDepthAttachments(n._generateStencilBuffer,n._generateDepthBuffer,n.texture.width,n.texture.height,e),this._bindUnboundFramebuffer(null),e};Oe.prototype.createRenderTargetCubeTexture=function(n,e){const t=this._createHardwareRenderTargetWrapper(!1,!0,n),i={generateMipMaps:!0,generateDepthBuffer:!0,generateStencilBuffer:!1,type:0,samplingMode:3,format:5,...e};i.generateStencilBuffer=i.generateDepthBuffer&&i.generateStencilBuffer,(i.type===1&&!this._caps.textureFloatLinearFiltering||i.type===2&&!this._caps.textureHalfFloatLinearFiltering)&&(i.samplingMode=1);const r=this._gl,s=new ur(this,Dt.RenderTarget);this._bindTextureDirectly(r.TEXTURE_CUBE_MAP,s,!0);const o=this._getSamplingParameters(i.samplingMode,i.generateMipMaps);i.type===1&&!this._caps.textureFloat&&(i.type=0,oe.Warn("Float textures are not supported. Cube render target forced to TEXTURETYPE_UNESIGNED_BYTE type")),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MAG_FILTER,o.mag),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MIN_FILTER,o.min),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE);for(let l=0;l<6;l++)r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+l,0,this._getRGBABufferInternalSizedFormat(i.type,i.format),n,n,0,this._getInternalFormat(i.format),this._getWebGLTextureType(i.type),null);const a=r.createFramebuffer();return this._bindUnboundFramebuffer(a),t._depthStencilBuffer=this._setupFramebufferDepthAttachments(i.generateStencilBuffer,i.generateDepthBuffer,n,n),i.generateMipMaps&&r.generateMipmap(r.TEXTURE_CUBE_MAP),this._bindTextureDirectly(r.TEXTURE_CUBE_MAP,null),this._bindUnboundFramebuffer(null),t._framebuffer=a,t._generateDepthBuffer=i.generateDepthBuffer,t._generateStencilBuffer=i.generateStencilBuffer,s.width=n,s.height=n,s.isReady=!0,s.isCube=!0,s.samples=1,s.generateMipMaps=i.generateMipMaps,s.samplingMode=i.samplingMode,s.type=i.type,s.format=i.format,this._internalTexturesCache.push(s),t.setTextures(s),t};const hb="postprocessVertexShader",cb=`attribute vec2 position;uniform vec2 scale;varying vec2 vUV;const vec2 madd=vec2(0.5,0.5);
#define CUSTOM_VERTEX_DEFINITIONS
void main(void) {
#define CUSTOM_VERTEX_MAIN_BEGIN
vUV=(position*madd+madd)*scale;gl_Position=vec4(position,0.0,1.0);
#define CUSTOM_VERTEX_MAIN_END
}`;Y.ShadersStore[hb]=cb;const eu={positions:[1,1,-1,1,-1,-1,1,-1],indices:[0,1,2,0,2,3]};class b0{constructor(e,t=eu){this._fullscreenViewport=new Sa(0,0,1,1);const i=t.positions??eu.positions,r=t.indices??eu.indices;this.engine=e,this._vertexBuffers={[b.PositionKind]:new b(e,i,b.PositionKind,!1,!1,2)},this._indexBuffer=e.createIndexBuffer(r),this._onContextRestoredObserver=e.onContextRestoredObservable.add(()=>{this._indexBuffer=e.createIndexBuffer(r);for(const s in this._vertexBuffers)this._vertexBuffers[s]._rebuild()})}setViewport(e=this._fullscreenViewport){this.engine.setViewport(e)}bindBuffers(e){this.engine.bindBuffers(this._vertexBuffers,this._indexBuffer,e)}applyEffectWrapper(e){this.engine.setState(!0),this.engine.depthCullingState.depthTest=!1,this.engine.stencilState.stencilTest=!1,this.engine.enableEffect(e._drawWrapper),this.bindBuffers(e.effect),e.onApplyObservable.notifyObservers({})}saveStates(){this._savedStateDepthTest=this.engine.depthCullingState.depthTest,this._savedStateStencilTest=this.engine.stencilState.stencilTest}restoreStates(){this.engine.depthCullingState.depthTest=this._savedStateDepthTest,this.engine.stencilState.stencilTest=this._savedStateStencilTest}draw(){this.engine.drawElementsType(0,0,6)}_isRenderTargetTexture(e){return e.renderTarget!==void 0}render(e,t=null){if(!e.effect.isReady())return;this.saveStates(),this.setViewport();const i=t===null?null:this._isRenderTargetTexture(t)?t.renderTarget:t;i&&this.engine.bindFramebuffer(i),this.applyEffectWrapper(e),this.draw(),i&&this.engine.unBindFramebuffer(i),this.restoreStates()}dispose(){const e=this._vertexBuffers[b.PositionKind];e&&(e.dispose(),delete this._vertexBuffers[b.PositionKind]),this._indexBuffer&&this.engine._releaseBuffer(this._indexBuffer),this._onContextRestoredObserver&&(this.engine.onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}}class I0{get effect(){return this._drawWrapper.effect}set effect(e){this._drawWrapper.effect=e}constructor(e){this.onApplyObservable=new he;let t;const i=e.uniformNames||[];e.vertexShader?t={fragmentSource:e.fragmentShader,vertexSource:e.vertexShader,spectorName:e.name||"effectWrapper"}:(i.push("scale"),t={fragmentSource:e.fragmentShader,vertex:"postprocess",spectorName:e.name||"effectWrapper"},this.onApplyObservable.add(()=>{this.effect.setFloat2("scale",1,1)}));const r=e.defines?e.defines.join(`
`):"";this._drawWrapper=new Ko(e.engine),e.useShaderStore?(t.fragment=t.fragmentSource,t.vertex||(t.vertex=t.vertexSource),delete t.fragmentSource,delete t.vertexSource,this.effect=e.engine.createEffect(t,e.attributeNames||["position"],i,e.samplerNames,r,void 0,e.onCompiled,void 0,void 0,e.shaderLanguage)):(this.effect=new Zi(t,e.attributeNames||["position"],i,e.samplerNames,e.engine,r,void 0,e.onCompiled,void 0,void 0,void 0,e.shaderLanguage),this._onContextRestoredObserver=e.engine.onContextRestoredObservable.add(()=>{this.effect._pipelineContext=null,this.effect._prepareEffect()}))}dispose(){this._onContextRestoredObserver&&(this.effect.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null),this.effect.dispose()}}const A0="passPixelShader",M0=`varying vec2 vUV;uniform sampler2D textureSampler;
#define CUSTOM_FRAGMENT_DEFINITIONS
void main(void) 
{gl_FragColor=texture2D(textureSampler,vUV);}`;Y.ShadersStore[A0]=M0;const bg={name:A0,shader:M0};class wi{static _CreateDumpRenderer(){if(!wi._DumpToolsEngine){let e,t=null;const i={preserveDrawingBuffer:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};try{e=new OffscreenCanvas(100,100),t=new Oe(e,!1,i)}catch{e=document.createElement("canvas"),t=new Oe(e,!1,i)}t.getCaps().parallelShaderCompile=void 0;const r=new b0(t),s=new I0({engine:t,name:bg.name,fragmentShader:bg.shader,samplerNames:["textureSampler"]});wi._DumpToolsEngine={canvas:e,engine:t,renderer:r,wrapper:s}}return wi._DumpToolsEngine}static async DumpFramebuffer(e,t,i,r,s="image/png",o,a){const l=await i.readPixels(0,0,e,t),h=new Uint8Array(l.buffer);wi.DumpData(e,t,h,r,s,o,!0,void 0,a)}static DumpDataAsync(e,t,i,r="image/png",s,o=!1,a=!1,l){return new Promise(h=>{wi.DumpData(e,t,i,c=>h(c),r,s,o,a,l)})}static DumpData(e,t,i,r,s="image/png",o,a=!1,l=!1,h){const c=wi._CreateDumpRenderer();if(c.engine.setSize(e,t,!0),i instanceof Float32Array){const d=new Uint8Array(i.length);let f=i.length;for(;f--;){const p=i[f];d[f]=Math.round(Ye.Clamp(p)*255)}i=d}const u=c.engine.createRawTexture(i,e,t,5,!1,!a,1);c.renderer.setViewport(),c.renderer.applyEffectWrapper(c.wrapper),c.wrapper.effect._bindTexture("textureSampler",u),c.renderer.draw(),l?ge.ToBlob(c.canvas,d=>{const f=new FileReader;f.onload=p=>{const g=p.target.result;r&&r(g)},f.readAsArrayBuffer(d)},s,h):ge.EncodeScreenshotCanvasData(c.canvas,r,s,o,h),u.dispose()}static Dispose(){wi._DumpToolsEngine&&(wi._DumpToolsEngine.wrapper.dispose(),wi._DumpToolsEngine.renderer.dispose(),wi._DumpToolsEngine.engine.dispose()),wi._DumpToolsEngine=null}}const ub=()=>{ge.DumpData=wi.DumpData,ge.DumpDataAsync=wi.DumpDataAsync,ge.DumpFramebuffer=wi.DumpFramebuffer};ub();class vr extends le{get renderList(){return this._renderList}set renderList(e){this._unObserveRenderList&&(this._unObserveRenderList(),this._unObserveRenderList=null),e&&(this._unObserveRenderList=s0(e,this._renderListHasChanged)),this._renderList=e}get postProcesses(){return this._postProcesses}get _prePassEnabled(){return!!this._prePassRenderTarget&&this._prePassRenderTarget.enabled}set onAfterUnbind(e){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(e)}set onBeforeRender(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e)}set onAfterRender(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(e)}set onClear(e){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver),this._onClearObserver=this.onClearObservable.add(e)}get renderPassIds(){return this._renderPassIds}get currentRefreshId(){return this._currentRefreshId}setMaterialForRendering(e,t){let i;Array.isArray(e)?i=e:i=[e];for(let r=0;r<i.length;++r)for(let s=0;s<this._renderPassIds.length;++s)i[r].setMaterialForRenderPass(this._renderPassIds[s],t!==void 0?Array.isArray(t)?t[s]:t:void 0)}get isMulti(){var e;return((e=this._renderTarget)==null?void 0:e.isMulti)??!1}get renderTargetOptions(){return this._renderTargetOptions}get renderTarget(){return this._renderTarget}_onRatioRescale(){this._sizeRatio&&this.resize(this._initialSizeParameter)}set boundingBoxSize(e){if(this._boundingBoxSize&&this._boundingBoxSize.equals(e))return;this._boundingBoxSize=e;const t=this.getScene();t&&t.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}get depthStencilTexture(){var e;return((e=this._renderTarget)==null?void 0:e._depthStencilTexture)??null}constructor(e,t,i,r=!1,s=!0,o=0,a=!1,l=le.TRILINEAR_SAMPLINGMODE,h=!0,c=!1,u=!1,d=5,f=!1,p,g,m=!1,x=!1){let E,R=!0;if(typeof r=="object"){const _=r;r=!!_.generateMipMaps,s=_.doNotChangeAspectRatio??!0,o=_.type??0,a=!!_.isCube,l=_.samplingMode??le.TRILINEAR_SAMPLINGMODE,h=_.generateDepthBuffer??!0,c=!!_.generateStencilBuffer,u=!!_.isMulti,d=_.format??5,f=!!_.delayAllocation,p=_.samples,g=_.creationFlags,m=!!_.noColorAttachment,x=!!_.useSRGBBuffer,E=_.colorAttachment,R=_.gammaSpace??R}if(super(null,i,!r,void 0,l,void 0,void 0,void 0,void 0,d),this._unObserveRenderList=null,this._renderListHasChanged=(_,T)=>{var y;const P=this._renderList?this._renderList.length:0;(T===0&&P>0||P===0)&&((y=this.getScene())==null||y.meshes.forEach(D=>{D._markSubMeshesAsLightDirty()}))},this.renderParticles=!0,this.renderSprites=!1,this.forceLayerMaskCheck=!1,this.ignoreCameraViewport=!1,this.onBeforeBindObservable=new he,this.onAfterUnbindObservable=new he,this.onBeforeRenderObservable=new he,this.onAfterRenderObservable=new he,this.onClearObservable=new he,this.onResizeObservable=new he,this._cleared=!1,this.skipInitialClear=!1,this._currentRefreshId=-1,this._refreshRate=1,this._samples=1,this._canRescale=!0,this._renderTarget=null,this.boundingBoxPosition=v.Zero(),i=this.getScene(),!i)return;const C=this.getScene().getEngine();this._gammaSpace=R,this._coordinatesMode=le.PROJECTION_MODE,this.renderList=[],this.name=e,this.isRenderTarget=!0,this._initialSizeParameter=t,this._renderPassIds=[],this._isCubeData=a,this._processSizeParameter(t),this.renderPassId=this._renderPassIds[0],this._resizeObserver=C.onResizeObservable.add(()=>{}),this._generateMipMaps=!!r,this._doNotChangeAspectRatio=s,this._renderingManager=new Li(i),this._renderingManager._useSceneAutoClearSetup=!0,!u&&(this._renderTargetOptions={generateMipMaps:r,type:o,format:this._format??void 0,samplingMode:this.samplingMode,generateDepthBuffer:h,generateStencilBuffer:c,samples:p,creationFlags:g,noColorAttachment:m,useSRGBBuffer:x,colorAttachment:E,label:this.name},this.samplingMode===le.NEAREST_SAMPLINGMODE&&(this.wrapU=le.CLAMP_ADDRESSMODE,this.wrapV=le.CLAMP_ADDRESSMODE),f||(a?(this._renderTarget=i.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions),this.coordinatesMode=le.INVCUBIC_MODE,this._textureMatrix=U.Identity()):this._renderTarget=i.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,p!==void 0&&(this.samples=p)))}createDepthStencilTexture(e=0,t=!0,i=!1,r=1,s=14){var o;(o=this._renderTarget)==null||o.createDepthStencilTexture(e,t,i,r,s)}_releaseRenderPassId(){if(this._scene){const e=this._scene.getEngine();for(let t=0;t<this._renderPassIds.length;++t)e.releaseRenderPassId(this._renderPassIds[t])}this._renderPassIds=[]}_createRenderPassId(){this._releaseRenderPassId();const e=this._scene.getEngine(),t=this._isCubeData?6:this.getRenderLayers()||1;for(let i=0;i<t;++i)this._renderPassIds[i]=e.createRenderPassId(`RenderTargetTexture - ${this.name}#${i}`)}_processSizeParameter(e,t=!0){if(e.ratio){this._sizeRatio=e.ratio;const i=this._getEngine();this._size={width:this._bestReflectionRenderTargetDimension(i.getRenderWidth(),this._sizeRatio),height:this._bestReflectionRenderTargetDimension(i.getRenderHeight(),this._sizeRatio)}}else this._size=e;t&&this._createRenderPassId()}get samples(){var e;return((e=this._renderTarget)==null?void 0:e.samples)??this._samples}set samples(e){this._renderTarget&&(this._samples=this._renderTarget.setSamples(e))}resetRefreshCounter(){this._currentRefreshId=-1}get refreshRate(){return this._refreshRate}set refreshRate(e){this._refreshRate=e,this.resetRefreshCounter()}addPostProcess(e){if(!this._postProcessManager){const t=this.getScene();if(!t)return;this._postProcessManager=new Au(t),this._postProcesses=new Array}this._postProcesses.push(e),this._postProcesses[0].autoClear=!1}clearPostProcesses(e=!1){if(this._postProcesses){if(e)for(const t of this._postProcesses)t.dispose();this._postProcesses=[]}}removePostProcess(e){if(!this._postProcesses)return;const t=this._postProcesses.indexOf(e);t!==-1&&(this._postProcesses.splice(t,1),this._postProcesses.length>0&&(this._postProcesses[0].autoClear=!1))}_shouldRender(){return this._currentRefreshId===-1?(this._currentRefreshId=1,!0):this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)}getRenderSize(){return this.getRenderWidth()}getRenderWidth(){return this._size.width?this._size.width:this._size}getRenderHeight(){return this._size.width?this._size.height:this._size}getRenderLayers(){return this._size.layers||0}disableRescaling(){this._canRescale=!1}get canRescale(){return this._canRescale}scale(e){const t=Math.max(1,this.getRenderSize()*e);this.resize(t)}getReflectionTextureMatrix(){return this.isCube?this._textureMatrix:super.getReflectionTextureMatrix()}resize(e){var t;const i=this.isCube;(t=this._renderTarget)==null||t.dispose(),this._renderTarget=null;const r=this.getScene();r&&(this._processSizeParameter(e,!1),i?this._renderTarget=r.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions):this._renderTarget=r.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,this._renderTargetOptions.samples!==void 0&&(this.samples=this._renderTargetOptions.samples),this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this))}render(e=!1,t=!1){this._render(e,t)}isReadyForRendering(){return this._render(!1,!1,!0)}_render(e=!1,t=!1,i=!1){const r=this.getScene();if(!r)return i;const s=r.getEngine();if(this.useCameraPostProcesses!==void 0&&(e=this.useCameraPostProcesses),this._waitingRenderList){if(!this.renderListPredicate){this.renderList=[];for(let c=0;c<this._waitingRenderList.length;c++){const u=this._waitingRenderList[c],d=r.getMeshById(u);d&&this.renderList.push(d)}}this._waitingRenderList=void 0}if(this.renderListPredicate){this.renderList?this.renderList.length=0:this.renderList=[];const c=this.getScene();if(!c)return i;const u=c.meshes;for(let d=0;d<u.length;d++){const f=u[d];this.renderListPredicate(f)&&this.renderList.push(f)}}const o=s.currentRenderPassId;this.onBeforeBindObservable.notifyObservers(this);const a=this.activeCamera??r.activeCamera,l=r.activeCamera;a&&(a!==r.activeCamera&&(r.setTransformMatrix(a.getViewMatrix(),a.getProjectionMatrix(!0)),r.activeCamera=a),s.setViewport(a.rigParent?a.rigParent.viewport:a.viewport,this.getRenderWidth(),this.getRenderHeight())),this._defaultRenderListPrepared=!1;let h=i;if(i){r.getViewMatrix()||r.updateTransformMatrix();const c=this.is2DArray?this.getRenderLayers():this.isCube?6:1;for(let u=0;u<c&&h;u++){let d=null;const f=this.renderList?this.renderList:r.getActiveMeshes().data,p=this.renderList?this.renderList.length:r.getActiveMeshes().length;s.currentRenderPassId=this._renderPassIds[u],this.onBeforeRenderObservable.notifyObservers(u),this.getCustomRenderList&&(d=this.getCustomRenderList(u,f,p)),d||(d=f),this._doNotChangeAspectRatio||r.updateTransformMatrix(!0);for(let g=0;g<d.length&&h;++g){const m=d[g];if(!(!m.isEnabled()||m.isBlocked||!m.isVisible||!m.subMeshes)){if(this.customIsReadyFunction){if(!this.customIsReadyFunction(m,this.refreshRate,i)){h=!1;continue}}else if(!m.isReady(!0)){h=!1;continue}}}this.onAfterRenderObservable.notifyObservers(u),(this.is2DArray||this.isCube)&&(r.incrementRenderId(),r.resetCachedMaterial())}}else if(this.is2DArray&&!this.isMulti)for(let c=0;c<this.getRenderLayers();c++)this._renderToTarget(0,e,t,c,a),r.incrementRenderId(),r.resetCachedMaterial();else if(this.isCube&&!this.isMulti)for(let c=0;c<6;c++)this._renderToTarget(c,e,t,void 0,a),r.incrementRenderId(),r.resetCachedMaterial();else this._renderToTarget(0,e,t,void 0,a);return this.onAfterUnbindObservable.notifyObservers(this),s.currentRenderPassId=o,l&&(r.activeCamera=l,this.activeCamera&&this.activeCamera!==r.activeCamera&&r.setTransformMatrix(r.activeCamera.getViewMatrix(),r.activeCamera.getProjectionMatrix(!0)),s.setViewport(r.activeCamera.viewport)),r.resetCachedMaterial(),h}_bestReflectionRenderTargetDimension(e,t){const i=e*t,r=se.NearestPOT(i+128*128/(128+i));return Math.min(se.FloorPOT(e),r)}_prepareRenderingManager(e,t,i,r){const s=this.getScene();if(!s)return;this._renderingManager.reset();const o=s.getRenderId();for(let a=0;a<t;a++){const l=e[a];if(l&&!l.isBlocked){if(this.customIsReadyFunction){if(!this.customIsReadyFunction(l,this.refreshRate,!1)){this.resetRefreshCounter();continue}}else if(!l.isReady(this.refreshRate===0)){this.resetRefreshCounter();continue}if(!l._internalAbstractMeshDataInfo._currentLODIsUpToDate&&s.activeCamera&&(l._internalAbstractMeshDataInfo._currentLOD=s.customLODSelector?s.customLODSelector(l,this.activeCamera||s.activeCamera):l.getLOD(this.activeCamera||s.activeCamera),l._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0),!l._internalAbstractMeshDataInfo._currentLOD)continue;let h=l._internalAbstractMeshDataInfo._currentLOD;h._preActivateForIntermediateRendering(o);let c;if(r&&i?c=(l.layerMask&i.layerMask)===0:c=!1,l.isEnabled()&&l.isVisible&&l.subMeshes&&!c&&(h!==l&&h._activate(o,!0),l._activate(o,!0)&&l.subMeshes.length)){l.isAnInstance?l._internalAbstractMeshDataInfo._actAsRegularMesh&&(h=l):h._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!1,h._internalAbstractMeshDataInfo._isActiveIntermediate=!0;for(let u=0;u<h.subMeshes.length;u++){const d=h.subMeshes[u];this._renderingManager.dispatch(d,h)}}}}for(let a=0;a<s.particleSystems.length;a++){const l=s.particleSystems[a],h=l.emitter;!l.isStarted()||!h||h.position&&!h.isEnabled()||this._renderingManager.dispatchParticles(l)}}_bindFrameBuffer(e=0,t=0){const i=this.getScene();if(!i)return;const r=i.getEngine();this._renderTarget&&r.bindFramebuffer(this._renderTarget,this.isCube?e:void 0,void 0,void 0,this.ignoreCameraViewport,0,t)}_unbindFrameBuffer(e,t){this._renderTarget&&e.unBindFramebuffer(this._renderTarget,this.isCube,()=>{this.onAfterRenderObservable.notifyObservers(t)})}_prepareFrame(e,t,i,r){this._postProcessManager?this._prePassEnabled||this._postProcessManager._prepareFrame(this._texture,this._postProcesses):(!r||!e.postProcessManager._prepareFrame(this._texture))&&this._bindFrameBuffer(t,i)}_renderToTarget(e,t,i,r=0,s=null){var o,a,l;const h=this.getScene();if(!h)return;const c=h.getEngine();if((o=c._debugPushGroup)==null||o.call(c,`render to face #${e} layer #${r}`,1),this._prepareFrame(h,e,r,t),this.is2DArray?(c.currentRenderPassId=this._renderPassIds[r],this.onBeforeRenderObservable.notifyObservers(r)):(c.currentRenderPassId=this._renderPassIds[e],this.onBeforeRenderObservable.notifyObservers(e)),c.snapshotRendering&&c.snapshotRenderingMode===1)this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(c):this.skipInitialClear||c.clear(this.clearColor||h.clearColor,!0,!0,!0);else{let u=null;const d=this.renderList?this.renderList:h.getActiveMeshes().data,f=this.renderList?this.renderList.length:h.getActiveMeshes().length;this.getCustomRenderList&&(u=this.getCustomRenderList(this.is2DArray?r:e,d,f)),u?this._prepareRenderingManager(u,u.length,s,this.forceLayerMaskCheck):(this._defaultRenderListPrepared||(this._prepareRenderingManager(d,f,s,!this.renderList||this.forceLayerMaskCheck),this._defaultRenderListPrepared=!0),u=d);for(const g of h._beforeRenderTargetClearStage)g.action(this,e,r);this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(c):this.skipInitialClear||c.clear(this.clearColor||h.clearColor,!0,!0,!0),this._doNotChangeAspectRatio||h.updateTransformMatrix(!0);for(const g of h._beforeRenderTargetDrawStage)g.action(this,e,r);this._renderingManager.render(this.customRenderFunction,u,this.renderParticles,this.renderSprites);for(const g of h._afterRenderTargetDrawStage)g.action(this,e,r);const p=((a=this._texture)==null?void 0:a.generateMipMaps)??!1;this._texture&&(this._texture.generateMipMaps=!1),this._postProcessManager?this._postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,e,this._postProcesses,this.ignoreCameraViewport):t&&h.postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,e);for(const g of h._afterRenderTargetPostProcessStage)g.action(this,e,r);this._texture&&(this._texture.generateMipMaps=p),this._doNotChangeAspectRatio||h.updateTransformMatrix(!0),i&&wi.DumpFramebuffer(this.getRenderWidth(),this.getRenderHeight(),c)}this._unbindFrameBuffer(c,e),this._texture&&this.isCube&&e===5&&c.generateMipMapsForCubemap(this._texture),(l=c._debugPopGroup)==null||l.call(c,1)}setRenderingOrder(e,t=null,i=null,r=null){this._renderingManager.setRenderingOrder(e,t,i,r)}setRenderingAutoClearDepthStencil(e,t){this._renderingManager.setRenderingAutoClearDepthStencil(e,t),this._renderingManager._useSceneAutoClearSetup=!1}clone(){const e=this.getSize(),t=new vr(this.name,e,this.getScene(),this._renderTargetOptions.generateMipMaps,this._doNotChangeAspectRatio,this._renderTargetOptions.type,this.isCube,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer,this._renderTargetOptions.generateStencilBuffer,void 0,this._renderTargetOptions.format,void 0,this._renderTargetOptions.samples);return t.hasAlpha=this.hasAlpha,t.level=this.level,t.coordinatesMode=this.coordinatesMode,this.renderList&&(t.renderList=this.renderList.slice(0)),t}serialize(){if(!this.name)return null;const e=super.serialize();if(e.renderTargetSize=this.getRenderSize(),e.renderList=[],this.renderList)for(let t=0;t<this.renderList.length;t++)e.renderList.push(this.renderList[t].id);return e}disposeFramebufferObjects(){var e;(e=this._renderTarget)==null||e.dispose(!0)}releaseInternalTexture(){var e;(e=this._renderTarget)==null||e.releaseTextures(),this._texture=null}dispose(){var e;this.onResizeObservable.clear(),this.onClearObservable.clear(),this.onAfterRenderObservable.clear(),this.onAfterUnbindObservable.clear(),this.onBeforeBindObservable.clear(),this.onBeforeRenderObservable.clear(),this._postProcessManager&&(this._postProcessManager.dispose(),this._postProcessManager=null),this._prePassRenderTarget&&this._prePassRenderTarget.dispose(),this._releaseRenderPassId(),this.clearPostProcesses(!0),this._resizeObserver&&(this.getScene().getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null),this.renderList=null;const t=this.getScene();if(!t)return;let i=t.customRenderTargets.indexOf(this);i>=0&&t.customRenderTargets.splice(i,1);for(const r of t.cameras)i=r.customRenderTargets.indexOf(this),i>=0&&r.customRenderTargets.splice(i,1);(e=this._renderTarget)==null||e.dispose(),this._renderTarget=null,this._texture=null,super.dispose()}_rebuild(){this.refreshRate===vr.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=vr.REFRESHRATE_RENDER_ONCE),this._postProcessManager&&this._postProcessManager._rebuild()}freeRenderingGroups(){this._renderingManager&&this._renderingManager.freeRenderingGroups()}getViewCount(){return 1}}vr.REFRESHRATE_RENDER_ONCE=0;vr.REFRESHRATE_RENDER_ONEVERYFRAME=1;vr.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2;le._CreateRenderTargetTexture=(n,e,t,i,r)=>new vr(n,e,t,i);class Mt{static RegisterShaderCodeProcessing(e,t){if(!t){delete Mt._CustomShaderCodeProcessing[e??""];return}Mt._CustomShaderCodeProcessing[e??""]=t}static _GetShaderCodeProcessing(e){return Mt._CustomShaderCodeProcessing[e]??Mt._CustomShaderCodeProcessing[""]}get samples(){return this._samples}set samples(e){this._samples=Math.min(e,this._engine.getCaps().maxMSAASamples),this._textures.forEach(t=>{t.setSamples(this._samples)})}getEffectName(){return this._fragmentUrl}set onActivate(e){this._onActivateObserver&&this.onActivateObservable.remove(this._onActivateObserver),e&&(this._onActivateObserver=this.onActivateObservable.add(e))}set onSizeChanged(e){this._onSizeChangedObserver&&this.onSizeChangedObservable.remove(this._onSizeChangedObserver),this._onSizeChangedObserver=this.onSizeChangedObservable.add(e)}set onApply(e){this._onApplyObserver&&this.onApplyObservable.remove(this._onApplyObserver),this._onApplyObserver=this.onApplyObservable.add(e)}set onBeforeRender(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e)}set onAfterRender(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(e)}get inputTexture(){return this._textures.data[this._currentRenderTextureInd]}set inputTexture(e){this._forcedOutputTexture=e}restoreDefaultInputTexture(){this._forcedOutputTexture&&(this._forcedOutputTexture=null,this.markTextureDirty())}getCamera(){return this._camera}get texelSize(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.texelSize:(this._forcedOutputTexture&&this._texelSize.copyFromFloats(1/this._forcedOutputTexture.width,1/this._forcedOutputTexture.height),this._texelSize)}constructor(e,t,i,r,s,o,a=1,l,h,c=null,u=0,d="postprocess",f,p=!1,g=5,m=Ti.GLSL){this._parentContainer=null,this.width=-1,this.height=-1,this.nodeMaterialSource=null,this._outputTexture=null,this.autoClear=!0,this.forceAutoClearInAlphaMode=!1,this.alphaMode=0,this.animations=[],this.enablePixelPerfectMode=!1,this.forceFullscreenViewport=!0,this.scaleMode=1,this.alwaysForcePOT=!1,this._samples=1,this.adaptScaleToCurrentViewport=!1,this._reusable=!1,this._renderId=0,this.externalTextureSamplerBinding=!1,this._textures=new Vi(2),this._textureCache=[],this._currentRenderTextureInd=0,this._scaleRatio=new me(1,1),this._texelSize=me.Zero(),this.onActivateObservable=new he,this.onSizeChangedObservable=new he,this.onApplyObservable=new he,this.onBeforeRenderObservable=new he,this.onAfterRenderObservable=new he,this.name=e;let x=1,E=null;if(i&&!Array.isArray(i)){const R=i;i=R.uniforms??null,r=R.samplers??null,x=R.size??1,o=R.camera??null,a=R.samplingMode??1,l=R.engine,h=R.reusable,c=R.defines??null,u=R.textureType??0,d=R.vertexUrl??"postprocess",f=R.indexParameters,p=R.blockCompilation??!1,g=R.textureFormat??5,m=R.shaderLanguage??Ti.GLSL,E=R.uniformBuffers??null}else s&&(typeof s=="number"?x=s:x={width:s.width,height:s.height});o!=null?(this._camera=o,this._scene=o.getScene(),o.attachPostProcess(this),this._engine=this._scene.getEngine(),this._scene.postProcesses.push(this),this.uniqueId=this._scene.getUniqueId()):l&&(this._engine=l,this._engine.postProcesses.push(this)),this._options=x,this.renderTargetSamplingMode=a||1,this._reusable=h||!1,this._textureType=u,this._textureFormat=g,this._shaderLanguage=m,this._samplers=r||[],this._samplers.push("textureSampler"),this._fragmentUrl=t,this._vertexUrl=d,this._parameters=i||[],this._parameters.push("scale"),this._uniformBuffers=E||[],this._indexParameters=f,this._drawWrapper=new Ko(this._engine),p||this.updateEffect(c)}getClassName(){return"PostProcess"}getEngine(){return this._engine}getEffect(){return this._drawWrapper.effect}shareOutputWith(e){return this._disposeTextures(),this._shareOutputWithPostProcess=e,this}useOwnOutput(){this._textures.length==0&&(this._textures=new Vi(2)),this._shareOutputWithPostProcess=null}updateEffect(e=null,t=null,i=null,r,s,o,a,l){const h=Mt._GetShaderCodeProcessing(this.name);if(h!=null&&h.defineCustomBindings){const c=(t==null?void 0:t.slice())??[];c.push(...this._parameters);const u=(i==null?void 0:i.slice())??[];u.push(...this._samplers),e=h.defineCustomBindings(this.name,e,c,u),t=c,i=u}this._postProcessDefines=e,this._drawWrapper.effect=this._engine.createEffect({vertex:a??this._vertexUrl,fragment:l??this._fragmentUrl},{attributes:["position"],uniformsNames:t||this._parameters,uniformBuffersNames:this._uniformBuffers,samplers:i||this._samplers,defines:e!==null?e:"",fallbacks:null,onCompiled:s??null,onError:o??null,indexParameters:r||this._indexParameters,processCodeAfterIncludes:h!=null&&h.processCodeAfterIncludes?(c,u)=>h.processCodeAfterIncludes(this.name,c,u):null,processFinalCode:h!=null&&h.processFinalCode?(c,u)=>h.processFinalCode(this.name,c,u):null,shaderLanguage:this._shaderLanguage},this._engine)}isReusable(){return this._reusable}markTextureDirty(){this.width=-1}_createRenderTargetTexture(e,t,i=0){for(let s=0;s<this._textureCache.length;s++)if(this._textureCache[s].texture.width===e.width&&this._textureCache[s].texture.height===e.height&&this._textureCache[s].postProcessChannel===i&&this._textureCache[s].texture._generateDepthBuffer===t.generateDepthBuffer&&this._textureCache[s].texture.samples===t.samples)return this._textureCache[s].texture;const r=this._engine.createRenderTargetTexture(e,t);return this._textureCache.push({texture:r,postProcessChannel:i,lastUsedRenderId:-1}),r}_flushTextureCache(){const e=this._renderId;for(let t=this._textureCache.length-1;t>=0;t--)if(e-this._textureCache[t].lastUsedRenderId>100){let i=!1;for(let r=0;r<this._textures.length;r++)if(this._textures.data[r]===this._textureCache[t].texture){i=!0;break}i||(this._textureCache[t].texture.dispose(),this._textureCache.splice(t,1))}}resize(e,t,i=null,r=!1,s=!1){this._textures.length>0&&this._textures.reset(),this.width=e,this.height=t;let o=null;if(i){for(let h=0;h<i._postProcesses.length;h++)if(i._postProcesses[h]!==null){o=i._postProcesses[h];break}}const a={width:this.width,height:this.height},l={generateMipMaps:r,generateDepthBuffer:s||o===this,generateStencilBuffer:(s||o===this)&&this._engine.isStencilEnable,samplingMode:this.renderTargetSamplingMode,type:this._textureType,format:this._textureFormat,samples:this._samples,label:"PostProcessRTT-"+this.name};this._textures.push(this._createRenderTargetTexture(a,l,0)),this._reusable&&this._textures.push(this._createRenderTargetTexture(a,l,1)),this._texelSize.copyFromFloats(1/this.width,1/this.height),this.onSizeChangedObservable.notifyObservers(this)}_getTarget(){let e;if(this._shareOutputWithPostProcess)e=this._shareOutputWithPostProcess.inputTexture;else if(this._forcedOutputTexture)e=this._forcedOutputTexture,this.width=this._forcedOutputTexture.width,this.height=this._forcedOutputTexture.height;else{e=this.inputTexture;let t;for(let i=0;i<this._textureCache.length;i++)if(this._textureCache[i].texture===e){t=this._textureCache[i];break}t&&(t.lastUsedRenderId=this._renderId)}return e}activate(e,t=null,i){var r,s;e=e||this._camera;const o=e.getScene(),a=o.getEngine(),l=a.getCaps().maxTextureSize,h=(t?t.width:this._engine.getRenderWidth(!0))*this._options|0,c=(t?t.height:this._engine.getRenderHeight(!0))*this._options|0;let u=this._options.width||h,d=this._options.height||c;const f=this.renderTargetSamplingMode!==7&&this.renderTargetSamplingMode!==1&&this.renderTargetSamplingMode!==2;let p=null;if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this.adaptScaleToCurrentViewport){const g=a.currentViewport;g&&(u*=g.width,d*=g.height)}(f||this.alwaysForcePOT)&&(this._options.width||(u=a.needPOTTextures?se.GetExponentOfTwo(u,l,this.scaleMode):u),this._options.height||(d=a.needPOTTextures?se.GetExponentOfTwo(d,l,this.scaleMode):d)),(this.width!==u||this.height!==d||!(p=this._getTarget()))&&this.resize(u,d,e,f,i),this._textures.forEach(g=>{g.samples!==this.samples&&this._engine.updateRenderTargetTextureSampleCount(g,this.samples)}),this._flushTextureCache(),this._renderId++}return p||(p=this._getTarget()),this.enablePixelPerfectMode?(this._scaleRatio.copyFromFloats(h/u,c/d),this._engine.bindFramebuffer(p,0,h,c,this.forceFullscreenViewport)):(this._scaleRatio.copyFromFloats(1,1),this._engine.bindFramebuffer(p,0,void 0,void 0,this.forceFullscreenViewport)),(s=(r=this._engine)._debugInsertMarker)==null||s.call(r,`post process ${this.name} input`),this.onActivateObservable.notifyObservers(e),this.autoClear&&(this.alphaMode===0||this.forceAutoClearInAlphaMode)&&this._engine.clear(this.clearColor?this.clearColor:o.clearColor,o._allowPostProcessClearColor,!0,!0),this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2),p}get isSupported(){return this._drawWrapper.effect.isSupported}get aspectRatio(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.aspectRatio:this._forcedOutputTexture?this._forcedOutputTexture.width/this._forcedOutputTexture.height:this.width/this.height}isReady(){var e;return((e=this._drawWrapper.effect)==null?void 0:e.isReady())??!1}apply(){var e,t,i;if(!((e=this._drawWrapper.effect)!=null&&e.isReady()))return null;this._engine.enableEffect(this._drawWrapper),this._engine.setState(!1),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this._engine.setAlphaMode(this.alphaMode),this.alphaConstants&&this.getEngine().setAlphaConstants(this.alphaConstants.r,this.alphaConstants.g,this.alphaConstants.b,this.alphaConstants.a);let r;return this._shareOutputWithPostProcess?r=this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?r=this._forcedOutputTexture:r=this.inputTexture,this.externalTextureSamplerBinding||this._drawWrapper.effect._bindTexture("textureSampler",r==null?void 0:r.texture),this._drawWrapper.effect.setVector2("scale",this._scaleRatio),this.onApplyObservable.notifyObservers(this._drawWrapper.effect),(i=(t=Mt._GetShaderCodeProcessing(this.name))==null?void 0:t.bindCustomBindings)==null||i.call(t,this.name,this._drawWrapper.effect),this._drawWrapper.effect}_disposeTextures(){if(this._shareOutputWithPostProcess||this._forcedOutputTexture){this._disposeTextureCache();return}this._disposeTextureCache(),this._textures.dispose()}_disposeTextureCache(){for(let e=this._textureCache.length-1;e>=0;e--)this._textureCache[e].texture.dispose();this._textureCache.length=0}setPrePassRenderer(e){return this._prePassEffectConfiguration?(this._prePassEffectConfiguration=e.addEffectConfiguration(this._prePassEffectConfiguration),this._prePassEffectConfiguration.enabled=!0,!0):!1}dispose(e){e=e||this._camera,this._disposeTextures();let t;if(this._scene&&(t=this._scene.postProcesses.indexOf(this),t!==-1&&this._scene.postProcesses.splice(t,1)),this._parentContainer){const i=this._parentContainer.postProcesses.indexOf(this);i>-1&&this._parentContainer.postProcesses.splice(i,1),this._parentContainer=null}if(t=this._engine.postProcesses.indexOf(this),t!==-1&&this._engine.postProcesses.splice(t,1),!!e){if(e.detachPostProcess(this),t=e._postProcesses.indexOf(this),t===0&&e._postProcesses.length>0){const i=this._camera._getFirstPostProcess();i&&i.markTextureDirty()}this.onActivateObservable.clear(),this.onAfterRenderObservable.clear(),this.onApplyObservable.clear(),this.onBeforeRenderObservable.clear(),this.onSizeChangedObservable.clear()}}serialize(){const e=Le.Serialize(this),t=this.getCamera()||this._scene&&this._scene.activeCamera;return e.customType="BABYLON."+this.getClassName(),e.cameraId=t?t.id:null,e.reusable=this._reusable,e.textureType=this._textureType,e.fragmentUrl=this._fragmentUrl,e.parameters=this._parameters,e.samplers=this._samplers,e.options=this._options,e.defines=this._postProcessDefines,e.textureFormat=this._textureFormat,e.vertexUrl=this._vertexUrl,e.indexParameters=this._indexParameters,e}clone(){const e=this.serialize();e._engine=this._engine,e.cameraId=null;const t=Mt.Parse(e,this._scene,"");return t?(t.onActivateObservable=this.onActivateObservable.clone(),t.onSizeChangedObservable=this.onSizeChangedObservable.clone(),t.onApplyObservable=this.onApplyObservable.clone(),t.onBeforeRenderObservable=this.onBeforeRenderObservable.clone(),t.onAfterRenderObservable=this.onAfterRenderObservable.clone(),t._prePassEffectConfiguration=this._prePassEffectConfiguration,t):null}static Parse(e,t,i){const r=Er(e.customType);if(!r||!r._Parse)return null;const s=t?t.getCameraById(e.cameraId):null;return r._Parse(e,s,t,i)}static _Parse(e,t,i,r){return Le.Parse(()=>new Mt(e.name,e.fragmentUrl,e.parameters,e.samplers,e.options,t,e.renderTargetSamplingMode,e._engine,e.reusable,e.defines,e.textureType,e.vertexUrl,e.indexParameters,!1,e.textureFormat),e,i,r)}}Mt._CustomShaderCodeProcessing={};M([V()],Mt.prototype,"uniqueId",void 0);M([V()],Mt.prototype,"name",void 0);M([V()],Mt.prototype,"width",void 0);M([V()],Mt.prototype,"height",void 0);M([V()],Mt.prototype,"renderTargetSamplingMode",void 0);M([l0()],Mt.prototype,"clearColor",void 0);M([V()],Mt.prototype,"autoClear",void 0);M([V()],Mt.prototype,"forceAutoClearInAlphaMode",void 0);M([V()],Mt.prototype,"alphaMode",void 0);M([V()],Mt.prototype,"alphaConstants",void 0);M([V()],Mt.prototype,"enablePixelPerfectMode",void 0);M([V()],Mt.prototype,"forceFullscreenViewport",void 0);M([V()],Mt.prototype,"scaleMode",void 0);M([V()],Mt.prototype,"alwaysForcePOT",void 0);M([V("samples")],Mt.prototype,"_samples",void 0);M([V()],Mt.prototype,"adaptScaleToCurrentViewport",void 0);ye("BABYLON.PostProcess",Mt);const db="bonesDeclaration",fb=`#if NUM_BONE_INFLUENCERS>0
attribute vec4 matricesIndices;attribute vec4 matricesWeights;
#if NUM_BONE_INFLUENCERS>4
attribute vec4 matricesIndicesExtra;attribute vec4 matricesWeightsExtra;
#endif
#ifndef BAKED_VERTEX_ANIMATION_TEXTURE
#ifdef BONETEXTURE
uniform highp sampler2D boneSampler;uniform float boneTextureWidth;
#else
uniform mat4 mBones[BonesPerMesh];
#endif
#ifdef BONES_VELOCITY_ENABLED
uniform mat4 mPreviousBones[BonesPerMesh];
#endif
#ifdef BONETEXTURE
#define inline
mat4 readMatrixFromRawSampler(sampler2D smp,float index)
{float offset=index *4.0;float dx=1.0/boneTextureWidth;vec4 m0=texture2D(smp,vec2(dx*(offset+0.5),0.));vec4 m1=texture2D(smp,vec2(dx*(offset+1.5),0.));vec4 m2=texture2D(smp,vec2(dx*(offset+2.5),0.));vec4 m3=texture2D(smp,vec2(dx*(offset+3.5),0.));return mat4(m0,m1,m2,m3);}
#endif
#endif
#endif
`;Y.IncludesShadersStore[db]=fb;const pb="bakedVertexAnimationDeclaration",gb=`#ifdef BAKED_VERTEX_ANIMATION_TEXTURE
uniform float bakedVertexAnimationTime;uniform vec2 bakedVertexAnimationTextureSizeInverted;uniform vec4 bakedVertexAnimationSettings;uniform sampler2D bakedVertexAnimationTexture;
#ifdef INSTANCES
attribute vec4 bakedVertexAnimationSettingsInstanced;
#endif
#define inline
mat4 readMatrixFromRawSamplerVAT(sampler2D smp,float index,float frame)
{float offset=index*4.0;float frameUV=(frame+0.5)*bakedVertexAnimationTextureSizeInverted.y;float dx=bakedVertexAnimationTextureSizeInverted.x;vec4 m0=texture2D(smp,vec2(dx*(offset+0.5),frameUV));vec4 m1=texture2D(smp,vec2(dx*(offset+1.5),frameUV));vec4 m2=texture2D(smp,vec2(dx*(offset+2.5),frameUV));vec4 m3=texture2D(smp,vec2(dx*(offset+3.5),frameUV));return mat4(m0,m1,m2,m3);}
#endif
`;Y.IncludesShadersStore[pb]=gb;const mb="morphTargetsVertexGlobalDeclaration",_b=`#ifdef MORPHTARGETS
uniform float morphTargetInfluences[NUM_MORPH_INFLUENCERS];
#ifdef MORPHTARGETS_TEXTURE 
uniform float morphTargetTextureIndices[NUM_MORPH_INFLUENCERS];uniform vec3 morphTargetTextureInfo;uniform highp sampler2DArray morphTargets;vec3 readVector3FromRawSampler(int targetIndex,float vertexIndex)
{ 
float y=floor(vertexIndex/morphTargetTextureInfo.y);float x=vertexIndex-y*morphTargetTextureInfo.y;vec3 textureUV=vec3((x+0.5)/morphTargetTextureInfo.y,(y+0.5)/morphTargetTextureInfo.z,morphTargetTextureIndices[targetIndex]);return texture(morphTargets,textureUV).xyz;}
#endif
#endif
`;Y.IncludesShadersStore[mb]=_b;const vb="morphTargetsVertexDeclaration",Eb=`#ifdef MORPHTARGETS
#ifndef MORPHTARGETS_TEXTURE
attribute vec3 position{X};
#ifdef MORPHTARGETS_NORMAL
attribute vec3 normal{X};
#endif
#ifdef MORPHTARGETS_TANGENT
attribute vec3 tangent{X};
#endif
#ifdef MORPHTARGETS_UV
attribute vec2 uv_{X};
#endif
#elif {X}==0
uniform int morphTargetCount;
#endif
#endif
`;Y.IncludesShadersStore[vb]=Eb;const Tb="instancesDeclaration",xb=`#ifdef INSTANCES
attribute vec4 world0;attribute vec4 world1;attribute vec4 world2;attribute vec4 world3;
#ifdef INSTANCESCOLOR
attribute vec4 instanceColor;
#endif
#if defined(THIN_INSTANCES) && !defined(WORLD_UBO)
uniform mat4 world;
#endif
#if defined(VELOCITY) || defined(PREPASS_VELOCITY)
attribute vec4 previousWorld0;attribute vec4 previousWorld1;attribute vec4 previousWorld2;attribute vec4 previousWorld3;
#ifdef THIN_INSTANCES
uniform mat4 previousWorld;
#endif
#endif
#else
#if !defined(WORLD_UBO)
uniform mat4 world;
#endif
#if defined(VELOCITY) || defined(PREPASS_VELOCITY)
uniform mat4 previousWorld;
#endif
#endif
`;Y.IncludesShadersStore[Tb]=xb;const Cb="morphTargetsVertexGlobal",Rb=`#ifdef MORPHTARGETS
#ifdef MORPHTARGETS_TEXTURE
float vertexID;
#endif
#endif
`;Y.IncludesShadersStore[Cb]=Rb;const Sb="morphTargetsVertex",yb=`#ifdef MORPHTARGETS
#ifdef MORPHTARGETS_TEXTURE
#if {X}==0
for (int i=0; i<NUM_MORPH_INFLUENCERS; i++) {if (i>=morphTargetCount) break;vertexID=float(gl_VertexID)*morphTargetTextureInfo.x;positionUpdated+=(readVector3FromRawSampler(i,vertexID)-position)*morphTargetInfluences[i];vertexID+=1.0;
#ifdef MORPHTARGETS_NORMAL
normalUpdated+=(readVector3FromRawSampler(i,vertexID) -normal)*morphTargetInfluences[i];vertexID+=1.0;
#endif
#ifdef MORPHTARGETS_UV
uvUpdated+=(readVector3FromRawSampler(i,vertexID).xy-uv)*morphTargetInfluences[i];vertexID+=1.0;
#endif
#ifdef MORPHTARGETS_TANGENT
tangentUpdated.xyz+=(readVector3FromRawSampler(i,vertexID) -tangent.xyz)*morphTargetInfluences[i];
#endif
}
#endif
#else
positionUpdated+=(position{X}-position)*morphTargetInfluences[{X}];
#ifdef MORPHTARGETS_NORMAL
normalUpdated+=(normal{X}-normal)*morphTargetInfluences[{X}];
#endif
#ifdef MORPHTARGETS_TANGENT
tangentUpdated.xyz+=(tangent{X}-tangent.xyz)*morphTargetInfluences[{X}];
#endif
#ifdef MORPHTARGETS_UV
uvUpdated+=(uv_{X}-uv)*morphTargetInfluences[{X}];
#endif
#endif
#endif
`;Y.IncludesShadersStore[Sb]=yb;const bb="instancesVertex",Ib=`#ifdef INSTANCES
mat4 finalWorld=mat4(world0,world1,world2,world3);
#if defined(PREPASS_VELOCITY) || defined(VELOCITY)
mat4 finalPreviousWorld=mat4(previousWorld0,previousWorld1,previousWorld2,previousWorld3);
#endif
#ifdef THIN_INSTANCES
finalWorld=world*finalWorld;
#if defined(PREPASS_VELOCITY) || defined(VELOCITY)
finalPreviousWorld=previousWorld*finalPreviousWorld;
#endif
#endif
#else
mat4 finalWorld=world;
#if defined(PREPASS_VELOCITY) || defined(VELOCITY)
mat4 finalPreviousWorld=previousWorld;
#endif
#endif
`;Y.IncludesShadersStore[bb]=Ib;const Ab="bonesVertex",Mb=`#ifndef BAKED_VERTEX_ANIMATION_TEXTURE
#if NUM_BONE_INFLUENCERS>0
mat4 influence;
#ifdef BONETEXTURE
influence=readMatrixFromRawSampler(boneSampler,matricesIndices[0])*matricesWeights[0];
#if NUM_BONE_INFLUENCERS>1
influence+=readMatrixFromRawSampler(boneSampler,matricesIndices[1])*matricesWeights[1];
#endif
#if NUM_BONE_INFLUENCERS>2
influence+=readMatrixFromRawSampler(boneSampler,matricesIndices[2])*matricesWeights[2];
#endif
#if NUM_BONE_INFLUENCERS>3
influence+=readMatrixFromRawSampler(boneSampler,matricesIndices[3])*matricesWeights[3];
#endif
#if NUM_BONE_INFLUENCERS>4
influence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[0])*matricesWeightsExtra[0];
#endif
#if NUM_BONE_INFLUENCERS>5
influence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[1])*matricesWeightsExtra[1];
#endif
#if NUM_BONE_INFLUENCERS>6
influence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[2])*matricesWeightsExtra[2];
#endif
#if NUM_BONE_INFLUENCERS>7
influence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[3])*matricesWeightsExtra[3];
#endif
#else
influence=mBones[int(matricesIndices[0])]*matricesWeights[0];
#if NUM_BONE_INFLUENCERS>1
influence+=mBones[int(matricesIndices[1])]*matricesWeights[1];
#endif
#if NUM_BONE_INFLUENCERS>2
influence+=mBones[int(matricesIndices[2])]*matricesWeights[2];
#endif
#if NUM_BONE_INFLUENCERS>3
influence+=mBones[int(matricesIndices[3])]*matricesWeights[3];
#endif
#if NUM_BONE_INFLUENCERS>4
influence+=mBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];
#endif
#if NUM_BONE_INFLUENCERS>5
influence+=mBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];
#endif
#if NUM_BONE_INFLUENCERS>6
influence+=mBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];
#endif
#if NUM_BONE_INFLUENCERS>7
influence+=mBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];
#endif
#endif
finalWorld=finalWorld*influence;
#endif
#endif
`;Y.IncludesShadersStore[Ab]=Mb;const Pb="bakedVertexAnimation",Ob=`#ifdef BAKED_VERTEX_ANIMATION_TEXTURE
{
#ifdef INSTANCES
#define BVASNAME bakedVertexAnimationSettingsInstanced
#else
#define BVASNAME bakedVertexAnimationSettings
#endif
float VATStartFrame=BVASNAME.x;float VATEndFrame=BVASNAME.y;float VATOffsetFrame=BVASNAME.z;float VATSpeed=BVASNAME.w;float totalFrames=VATEndFrame-VATStartFrame+1.0;float time=bakedVertexAnimationTime*VATSpeed/totalFrames;float frameCorrection=time<1.0 ? 0.0 : 1.0;float numOfFrames=totalFrames-frameCorrection;float VATFrameNum=fract(time)*numOfFrames;VATFrameNum=mod(VATFrameNum+VATOffsetFrame,numOfFrames);VATFrameNum=floor(VATFrameNum);VATFrameNum+=VATStartFrame+frameCorrection;mat4 VATInfluence;VATInfluence=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndices[0],VATFrameNum)*matricesWeights[0];
#if NUM_BONE_INFLUENCERS>1
VATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndices[1],VATFrameNum)*matricesWeights[1];
#endif
#if NUM_BONE_INFLUENCERS>2
VATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndices[2],VATFrameNum)*matricesWeights[2];
#endif
#if NUM_BONE_INFLUENCERS>3
VATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndices[3],VATFrameNum)*matricesWeights[3];
#endif
#if NUM_BONE_INFLUENCERS>4
VATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndicesExtra[0],VATFrameNum)*matricesWeightsExtra[0];
#endif
#if NUM_BONE_INFLUENCERS>5
VATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndicesExtra[1],VATFrameNum)*matricesWeightsExtra[1];
#endif
#if NUM_BONE_INFLUENCERS>6
VATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndicesExtra[2],VATFrameNum)*matricesWeightsExtra[2];
#endif
#if NUM_BONE_INFLUENCERS>7
VATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndicesExtra[3],VATFrameNum)*matricesWeightsExtra[3];
#endif
finalWorld=finalWorld*VATInfluence;}
#endif
`;Y.IncludesShadersStore[Pb]=Ob;const Db="meshUVSpaceRendererVertexShader",Nb=`precision highp float;attribute vec3 position;attribute vec3 normal;attribute vec2 uv;uniform mat4 projMatrix;varying vec2 vDecalTC;
#include<bonesDeclaration>
#include<bakedVertexAnimationDeclaration>
#include<morphTargetsVertexGlobalDeclaration>
#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]
#include<instancesDeclaration>
void main(void) {vec3 positionUpdated=position;vec3 normalUpdated=normal;
#include<morphTargetsVertexGlobal>
#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]
#include<instancesVertex>
#include<bonesVertex>
#include<bakedVertexAnimation>
vec4 worldPos=finalWorld*vec4(positionUpdated,1.0);mat3 normWorldSM=mat3(finalWorld);vec3 vNormalW;
#if defined(INSTANCES) && defined(THIN_INSTANCES)
vNormalW=normalUpdated/vec3(dot(normWorldSM[0],normWorldSM[0]),dot(normWorldSM[1],normWorldSM[1]),dot(normWorldSM[2],normWorldSM[2]));vNormalW=normalize(normWorldSM*vNormalW);
#else
#ifdef NONUNIFORMSCALING
normWorldSM=transposeMat3(inverseMat3(normWorldSM));
#endif
vNormalW=normalize(normWorldSM*normalUpdated);
#endif
vec3 normalView=normalize((projMatrix*vec4(vNormalW,0.0)).xyz);vec3 decalTC=(projMatrix*worldPos).xyz;vDecalTC=decalTC.xy;gl_Position=vec4(uv*2.0-1.0,normalView.z>0.0 ? 2. : decalTC.z,1.0);}`;Y.ShadersStore[Db]=Nb;const Fb="meshUVSpaceRendererPixelShader",Lb=`precision highp float;varying vec2 vDecalTC;uniform sampler2D textureSampler;void main(void) {if (vDecalTC.x<0. || vDecalTC.x>1. || vDecalTC.y<0. || vDecalTC.y>1.) {discard;}
gl_FragColor=texture2D(textureSampler,vDecalTC);}
`;Y.ShadersStore[Fb]=Lb;const wb="meshUVSpaceRendererMaskerVertexShader",Ub="attribute vec2 uv;varying vec2 vUV;void main(void) {gl_Position=vec4(vec2(uv.x,uv.y)*2.0-1.0,0.,1.0);vUV=uv;}";Y.ShadersStore[wb]=Ub;const Vb="meshUVSpaceRendererMaskerPixelShader",Bb=`varying vec2 vUV;void main(void) {gl_FragColor=vec4(1.0,1.0,1.0,1.0);}
`;Y.ShadersStore[Vb]=Bb;const kb="meshUVSpaceRendererFinaliserPixelShader",zb=`precision highp float;varying vec2 vUV;uniform sampler2D textureSampler;uniform sampler2D maskTextureSampler;uniform vec2 textureSize;void main() {vec4 mask=texture2D(maskTextureSampler,vUV).rgba;if (mask.r>0.5) {gl_FragColor=texture2D(textureSampler,vUV);} else {vec2 texelSize=4.0/textureSize;vec2 uv_p01=vUV+vec2(-1.0,0.0)*texelSize;vec2 uv_p21=vUV+vec2(1.0,0.0)*texelSize;vec2 uv_p10=vUV+vec2(0.0,-1.0)*texelSize;vec2 uv_p12=vUV+vec2(0.0,1.0)*texelSize;float mask_p01=texture2D(maskTextureSampler,uv_p01).r;float mask_p21=texture2D(maskTextureSampler,uv_p21).r;float mask_p10=texture2D(maskTextureSampler,uv_p10).r;float mask_p12=texture2D(maskTextureSampler,uv_p12).r;vec4 col=vec4(0.0,0.0,0.0,0.0);float total_weight=0.0;if (mask_p01>0.5) {col+=texture2D(textureSampler,uv_p01);total_weight+=1.0;}
if (mask_p21>0.5) {col+=texture2D(textureSampler,uv_p21);total_weight+=1.0;}
if (mask_p10>0.5) {col+=texture2D(textureSampler,uv_p10);total_weight+=1.0;}
if (mask_p12>0.5) {col+=texture2D(textureSampler,uv_p12);total_weight+=1.0;}
if (total_weight>0.0) {gl_FragColor=col/total_weight;} else {gl_FragColor=col;}}}
`;Y.ShadersStore[kb]=zb;const Gb="meshUVSpaceRendererFinaliserVertexShader",Wb=`precision highp float;attribute vec3 position;attribute vec2 uv;uniform mat4 worldViewProjection;varying vec2 vUV;void main() {gl_Position=worldViewProjection*vec4(position,1.0);vUV=uv;}
`;Y.ShadersStore[Gb]=Wb;k._GroundMeshParser=(n,e)=>Ja.Parse(n,e);class Ja extends k{constructor(e,t){super(e,t),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(e,t=32){this._subdivisionsX=e,this._subdivisionsY=e,this.subdivide(e);const i=this;i.createOrUpdateSubmeshesOctree&&i.createOrUpdateSubmeshesOctree(t)}getHeightAtCoordinates(e,t){const i=this.getWorldMatrix(),r=W.Matrix[5];i.invertToRef(r);const s=W.Vector3[8];if(v.TransformCoordinatesFromFloatsToRef(e,0,t,r,s),e=s.x,t=s.z,e<this._minX||e>=this._maxX||t<=this._minZ||t>this._maxZ)return this.position.y;(!this._heightQuads||this._heightQuads.length==0)&&(this._initHeightQuads(),this._computeHeightQuads());const o=this._getFacetAt(e,t),a=-(o.x*e+o.z*t+o.w)/o.y;return v.TransformCoordinatesFromFloatsToRef(0,a,0,i,s),s.y}getNormalAtCoordinates(e,t){const i=new v(0,1,0);return this.getNormalAtCoordinatesToRef(e,t,i),i}getNormalAtCoordinatesToRef(e,t,i){const r=this.getWorldMatrix(),s=W.Matrix[5];r.invertToRef(s);const o=W.Vector3[8];if(v.TransformCoordinatesFromFloatsToRef(e,0,t,s,o),e=o.x,t=o.z,e<this._minX||e>this._maxX||t<this._minZ||t>this._maxZ)return this;(!this._heightQuads||this._heightQuads.length==0)&&(this._initHeightQuads(),this._computeHeightQuads());const a=this._getFacetAt(e,t);return v.TransformNormalFromFloatsToRef(a.x,a.y,a.z,r,i),this}updateCoordinateHeights(){return(!this._heightQuads||this._heightQuads.length==0)&&this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(e,t){const i=Math.floor((e+this._maxX)*this._subdivisionsX/this._width),r=Math.floor(-(t+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),s=this._heightQuads[r*this._subdivisionsX+i];let o;return t<s.slope.x*e+s.slope.y?o=s.facet1:o=s.facet2,o}_initHeightQuads(){const e=this._subdivisionsX,t=this._subdivisionsY;this._heightQuads=new Array;for(let i=0;i<t;i++)for(let r=0;r<e;r++){const s={slope:me.Zero(),facet1:new Ke(0,0,0,0),facet2:new Ke(0,0,0,0)};this._heightQuads[i*e+r]=s}return this}_computeHeightQuads(){const e=this.getVerticesData(b.PositionKind);if(!e)return this;const t=W.Vector3[3],i=W.Vector3[2],r=W.Vector3[1],s=W.Vector3[0],o=W.Vector3[4],a=W.Vector3[5],l=W.Vector3[6],h=W.Vector3[7],c=W.Vector3[8];let u=0,d=0,f=0,p=0,g=0,m=0,x=0;const E=this._subdivisionsX,R=this._subdivisionsY;for(let C=0;C<R;C++)for(let _=0;_<E;_++){u=_*3,d=C*(E+1)*3,f=(C+1)*(E+1)*3,t.x=e[d+u],t.y=e[d+u+1],t.z=e[d+u+2],i.x=e[d+u+3],i.y=e[d+u+4],i.z=e[d+u+5],r.x=e[f+u],r.y=e[f+u+1],r.z=e[f+u+2],s.x=e[f+u+3],s.y=e[f+u+4],s.z=e[f+u+5],p=(s.z-t.z)/(s.x-t.x),g=t.z-p*t.x,i.subtractToRef(t,o),r.subtractToRef(t,a),s.subtractToRef(t,l),v.CrossToRef(l,a,h),v.CrossToRef(o,l,c),h.normalize(),c.normalize(),m=-(h.x*t.x+h.y*t.y+h.z*t.z),x=-(c.x*i.x+c.y*i.y+c.z*i.z);const T=this._heightQuads[C*E+_];T.slope.copyFromFloats(p,g),T.facet1.copyFromFloats(h.x,h.y,h.z,m),T.facet2.copyFromFloats(c.x,c.y,c.z,x)}return this}serialize(e){super.serialize(e),e.subdivisionsX=this._subdivisionsX,e.subdivisionsY=this._subdivisionsY,e.minX=this._minX,e.maxX=this._maxX,e.minZ=this._minZ,e.maxZ=this._maxZ,e.width=this._width,e.height=this._height}static Parse(e,t){const i=new Ja(e.name,t);return i._subdivisionsX=e.subdivisionsX||1,i._subdivisionsY=e.subdivisionsY||1,i._minX=e.minX,i._maxX=e.maxX,i._minZ=e.minZ,i._maxZ=e.maxZ,i._width=e.width,i._height=e.height,i}}k._GoldbergMeshParser=(n,e)=>Id.Parse(n,e);class Id extends k{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(e,t){return t===void 0?(e>this.goldbergData.nbUnsharedFaces-1&&(oe.Warn("Maximum number of unshared faces used"),e=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+e):(e>11&&(oe.Warn("Last pole used"),e=11),t>this.goldbergData.nbFacesAtPole-1&&(oe.Warn("Maximum number of faces at a pole used"),t=this.goldbergData.nbFacesAtPole-1),12+e*this.goldbergData.nbFacesAtPole+t)}_changeGoldbergFaceColors(e){for(let i=0;i<e.length;i++){const r=e[i][0],s=e[i][1],o=e[i][2];for(let a=r;a<s+1;a++)this.goldbergData.faceColors[a]=o}const t=[];for(let i=0;i<12;i++)for(let r=0;r<5;r++)t.push(this.goldbergData.faceColors[i].r,this.goldbergData.faceColors[i].g,this.goldbergData.faceColors[i].b,this.goldbergData.faceColors[i].a);for(let i=12;i<this.goldbergData.faceColors.length;i++)for(let r=0;r<6;r++)t.push(this.goldbergData.faceColors[i].r,this.goldbergData.faceColors[i].g,this.goldbergData.faceColors[i].b,this.goldbergData.faceColors[i].a);return t}setGoldbergFaceColors(e){const t=this._changeGoldbergFaceColors(e);this.setVerticesData(b.ColorKind,t)}updateGoldbergFaceColors(e){const t=this._changeGoldbergFaceColors(e);this.updateVerticesData(b.ColorKind,t)}_changeGoldbergFaceUVs(e){const t=this.getVerticesData(b.UVKind);for(let i=0;i<e.length;i++){const r=e[i][0],s=e[i][1],o=e[i][2],a=e[i][3],l=e[i][4],h=[],c=[];let u,d;for(let f=0;f<5;f++)u=o.x+a*Math.cos(l+f*Math.PI/2.5),d=o.y+a*Math.sin(l+f*Math.PI/2.5),u<0&&(u=0),u>1&&(u=1),h.push(u,d);for(let f=0;f<6;f++)u=o.x+a*Math.cos(l+f*Math.PI/3),d=o.y+a*Math.sin(l+f*Math.PI/3),u<0&&(u=0),u>1&&(u=1),c.push(u,d);for(let f=r;f<Math.min(12,s+1);f++)for(let p=0;p<5;p++)t[10*f+2*p]=h[2*p],t[10*f+2*p+1]=h[2*p+1];for(let f=Math.max(12,r);f<s+1;f++)for(let p=0;p<6;p++)t[12*f-24+2*p]=c[2*p],t[12*f-23+2*p]=c[2*p+1]}return t}setGoldbergFaceUVs(e){const t=this._changeGoldbergFaceUVs(e);this.setVerticesData(b.UVKind,t)}updateGoldbergFaceUVs(e){const t=this._changeGoldbergFaceUVs(e);this.updateVerticesData(b.UVKind,t)}placeOnGoldbergFaceAt(e,t,i){const r=v.RotationFromAxis(this.goldbergData.faceXaxis[t],this.goldbergData.faceYaxis[t],this.goldbergData.faceZaxis[t]);e.rotation=r,e.position=this.goldbergData.faceCenters[t].add(this.goldbergData.faceXaxis[t].scale(i.x)).add(this.goldbergData.faceYaxis[t].scale(i.y)).add(this.goldbergData.faceZaxis[t].scale(i.z))}serialize(e){super.serialize(e),e.type="GoldbergMesh";const t={};if(t.adjacentFaces=this.goldbergData.adjacentFaces,t.nbSharedFaces=this.goldbergData.nbSharedFaces,t.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,t.nbFaces=this.goldbergData.nbFaces,t.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){t.faceColors=[];for(const i of this.goldbergData.faceColors)t.faceColors.push(i.asArray())}if(this.goldbergData.faceCenters){t.faceCenters=[];for(const i of this.goldbergData.faceCenters)t.faceCenters.push(i.asArray())}if(this.goldbergData.faceZaxis){t.faceZaxis=[];for(const i of this.goldbergData.faceZaxis)t.faceZaxis.push(i.asArray())}if(this.goldbergData.faceYaxis){t.faceYaxis=[];for(const i of this.goldbergData.faceYaxis)t.faceYaxis.push(i.asArray())}if(this.goldbergData.faceXaxis){t.faceXaxis=[];for(const i of this.goldbergData.faceXaxis)t.faceXaxis.push(i.asArray())}e.goldbergData=t}static Parse(e,t){const i=e.goldbergData;i.faceColors=i.faceColors.map(s=>$e.FromArray(s)),i.faceCenters=i.faceCenters.map(s=>v.FromArray(s)),i.faceZaxis=i.faceZaxis.map(s=>v.FromArray(s)),i.faceXaxis=i.faceXaxis.map(s=>v.FromArray(s)),i.faceYaxis=i.faceYaxis.map(s=>v.FromArray(s));const r=new Id(e.name,t);return r.goldbergData=i,r}}k._TrailMeshParser=(n,e)=>fh.Parse(n,e);class fh extends k{constructor(e,t,i,r=1,s=60,o=!0){super(e,i),this._sectionPolygonPointsCount=4,this._running=!1,this._autoStart=o,this._generator=t,this.diameter=r,this._length=s,this._sectionVectors=[],this._sectionNormalVectors=[];for(let a=0;a<=this._sectionPolygonPointsCount;a++)this._sectionVectors[a]=v.Zero(),this._sectionNormalVectors[a]=v.Zero();this._createMesh()}getClassName(){return"TrailMesh"}_createMesh(){const e=new re,t=[],i=[],r=[],s=[];let o=v.Zero();this._generator instanceof nr&&this._generator.hasBoundingInfo?o=this._generator.getBoundingInfo().boundingBox.centerWorld:o=this._generator.absolutePosition;const a=2*Math.PI/this._sectionPolygonPointsCount;for(let l=0;l<=this._sectionPolygonPointsCount;l++){const h=l!==this._sectionPolygonPointsCount?l*a:0;t.push(o.x+Math.cos(h)*this.diameter,o.y+Math.sin(h)*this.diameter,o.z),s.push(l/this._sectionPolygonPointsCount,0)}for(let l=1;l<=this._length;l++){for(let c=0;c<=this._sectionPolygonPointsCount;c++){const u=c!==this._sectionPolygonPointsCount?c*a:0;t.push(o.x+Math.cos(u)*this.diameter,o.y+Math.sin(u)*this.diameter,o.z),s.push(c/this._sectionPolygonPointsCount,l/this._length)}const h=t.length/3-2*(this._sectionPolygonPointsCount+1);for(let c=0;c<=this._sectionPolygonPointsCount;c++)r.push(h+c,h+c+this._sectionPolygonPointsCount,h+c+this._sectionPolygonPointsCount+1),r.push(h+c,h+c+this._sectionPolygonPointsCount+1,h+c+1)}re.ComputeNormals(t,r,i),e.positions=t,e.normals=i,e.indices=r,e.uvs=s,e.applyToMesh(this,!0),this._autoStart&&this.start()}start(){this._running||(this._running=!0,this._beforeRenderObserver=this.getScene().onBeforeRenderObservable.add(()=>{this.update()}))}stop(){this._beforeRenderObserver&&this._running&&(this._running=!1,this.getScene().onBeforeRenderObservable.remove(this._beforeRenderObserver))}update(){const e=this.getVerticesData(b.PositionKind),t=this.getVerticesData(b.NormalKind),i=this._generator.getWorldMatrix();if(e&&t){for(let o=3*(this._sectionPolygonPointsCount+1);o<e.length;o++)e[o-3*(this._sectionPolygonPointsCount+1)]=e[o]-t[o]/this._length*this.diameter;for(let o=3*(this._sectionPolygonPointsCount+1);o<t.length;o++)t[o-3*(this._sectionPolygonPointsCount+1)]=t[o];const r=e.length-3*(this._sectionPolygonPointsCount+1),s=2*Math.PI/this._sectionPolygonPointsCount;for(let o=0;o<=this._sectionPolygonPointsCount;o++){const a=o!==this._sectionPolygonPointsCount?o*s:0;this._sectionVectors[o].copyFromFloats(Math.cos(a)*this.diameter,Math.sin(a)*this.diameter,0),this._sectionNormalVectors[o].copyFromFloats(Math.cos(a),Math.sin(a),0),v.TransformCoordinatesToRef(this._sectionVectors[o],i,this._sectionVectors[o]),v.TransformNormalToRef(this._sectionNormalVectors[o],i,this._sectionNormalVectors[o])}for(let o=0;o<=this._sectionPolygonPointsCount;o++)e[r+3*o]=this._sectionVectors[o].x,e[r+3*o+1]=this._sectionVectors[o].y,e[r+3*o+2]=this._sectionVectors[o].z,t[r+3*o]=this._sectionNormalVectors[o].x,t[r+3*o+1]=this._sectionNormalVectors[o].y,t[r+3*o+2]=this._sectionNormalVectors[o].z;this.updateVerticesData(b.PositionKind,e,!0,!1),this.updateVerticesData(b.NormalKind,t,!0,!1)}}clone(e="",t){return new fh(e,t??this._generator,this.getScene(),this.diameter,this._length,this._autoStart)}serialize(e){super.serialize(e),e.generatorId=this._generator.id}static Parse(e,t){const i=t.getLastMeshById(e.generatorId)??t.getLastTransformNodeById(e.generatorId);if(!i)throw new Error("TrailMesh: generator not found with ID "+e.generatorId);return new fh(e.name,i,t,e.diameter??e._diameter,e._length,e._autoStart)}}k._instancedMeshFactory=(n,e)=>{const t=new P0(n,e);if(e.instancedBuffers){t.instancedBuffers={};for(const i in e.instancedBuffers)t.instancedBuffers[i]=e.instancedBuffers[i]}return t};class P0 extends nr{constructor(e,t){super(e,t.getScene()),this._indexInSourceMeshInstanceArray=-1,this._distanceToCamera=0,t.addInstance(this),this._sourceMesh=t,this._unIndexed=t._unIndexed,this.position.copyFrom(t.position),this.rotation.copyFrom(t.rotation),this.scaling.copyFrom(t.scaling),t.rotationQuaternion&&(this.rotationQuaternion=t.rotationQuaternion.clone()),this.animations=t.animations.slice();for(const i of t.getAnimationRanges())i!=null&&this.createAnimationRange(i.name,i.from,i.to);this.infiniteDistance=t.infiniteDistance,this.setPivotMatrix(t.getPivotMatrix()),this.refreshBoundingInfo(!0,!0),this._syncSubMeshes()}getClassName(){return"InstancedMesh"}get lightSources(){return this._sourceMesh._lightSources}_resyncLightSources(){}_resyncLightSource(){}_removeLightSource(){}get receiveShadows(){return this._sourceMesh.receiveShadows}set receiveShadows(e){var t;((t=this._sourceMesh)==null?void 0:t.receiveShadows)!==e&&ge.Warn("Setting receiveShadows on an instanced mesh has no effect")}get material(){return this._sourceMesh.material}set material(e){var t;((t=this._sourceMesh)==null?void 0:t.material)!==e&&ge.Warn("Setting material on an instanced mesh has no effect")}get visibility(){return this._sourceMesh.visibility}set visibility(e){var t;((t=this._sourceMesh)==null?void 0:t.visibility)!==e&&ge.Warn("Setting visibility on an instanced mesh has no effect")}get skeleton(){return this._sourceMesh.skeleton}set skeleton(e){var t;((t=this._sourceMesh)==null?void 0:t.skeleton)!==e&&ge.Warn("Setting skeleton on an instanced mesh has no effect")}get renderingGroupId(){return this._sourceMesh.renderingGroupId}set renderingGroupId(e){!this._sourceMesh||e===this._sourceMesh.renderingGroupId||oe.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")}getTotalVertices(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0}getTotalIndices(){return this._sourceMesh.getTotalIndices()}get sourceMesh(){return this._sourceMesh}createInstance(e){return this._sourceMesh.createInstance(e)}isReady(e=!1){return this._sourceMesh.isReady(e,!0)}getVerticesData(e,t,i){return this._sourceMesh.getVerticesData(e,t,i)}setVerticesData(e,t,i,r){return this.sourceMesh&&this.sourceMesh.setVerticesData(e,t,i,r),this.sourceMesh}updateVerticesData(e,t,i,r){return this.sourceMesh&&this.sourceMesh.updateVerticesData(e,t,i,r),this.sourceMesh}setIndices(e,t=null){return this.sourceMesh&&this.sourceMesh.setIndices(e,t),this.sourceMesh}isVerticesDataPresent(e){return this._sourceMesh.isVerticesDataPresent(e)}getIndices(){return this._sourceMesh.getIndices()}get _positions(){return this._sourceMesh._positions}refreshBoundingInfo(e=!1,t=!1){if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;const i=this._sourceMesh.geometry?this._sourceMesh.geometry.boundingBias:null;return this._refreshBoundingInfo(this._sourceMesh._getPositionData(e,t),i),this}_preActivate(){return this._currentLOD&&this._currentLOD._preActivate(),this}_activate(e,t){if(super._activate(e,t),this._sourceMesh.subMeshes||oe.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>=0!=this._getWorldMatrixDeterminant()>=0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,e),t){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1}_postActivate(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)}getWorldMatrix(){if(this._currentLOD&&this._currentLOD.billboardMode!==He.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){this._billboardWorldMatrix||(this._billboardWorldMatrix=new U);const e=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,W.Vector3[7].copyFrom(this._currentLOD.position),this._currentLOD.position.set(0,0,0),this._billboardWorldMatrix.copyFrom(this._currentLOD.computeWorldMatrix(!0)),this._currentLOD.position.copyFrom(W.Vector3[7]),this._currentLOD._masterMesh=e,this._billboardWorldMatrix}return super.getWorldMatrix()}get isAnInstance(){return!0}getLOD(e){if(!e)return this;const t=this.sourceMesh.getLODLevels();if(!t||t.length===0)this._currentLOD=this.sourceMesh;else{const i=this.getBoundingInfo();this._currentLOD=this.sourceMesh.getLOD(e,i.boundingSphere)}return this._currentLOD}_preActivateForIntermediateRendering(e){return this.sourceMesh._preActivateForIntermediateRendering(e)}_syncSubMeshes(){if(this.releaseSubMeshes(),this._sourceMesh.subMeshes)for(let e=0;e<this._sourceMesh.subMeshes.length;e++)this._sourceMesh.subMeshes[e].clone(this,this._sourceMesh);return this}_generatePointsArray(){return this._sourceMesh._generatePointsArray()}_updateBoundingInfo(){return this.hasBoundingInfo?this.getBoundingInfo().update(this.worldMatrixFromCache):this.buildBoundingInfo(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}clone(e,t=null,i,r){const s=(r||this._sourceMesh).createInstance(e);if(Vn.DeepCopy(this,s,["name","subMeshes","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","isWorldMatrixFrozen","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","hasBoundingInfo"],[]),this.refreshBoundingInfo(),t&&(s.parent=t),!i)for(let o=0;o<this.getScene().meshes.length;o++){const a=this.getScene().meshes[o];a.parent===this&&a.clone(a.name,s)}return s.computeWorldMatrix(!0),this.onClonedObservable.notifyObservers(s),s}dispose(e,t=!1){this._sourceMesh.removeInstance(this),super.dispose(e,t)}_serializeAsParent(e){super._serializeAsParent(e),e.parentId=this._sourceMesh.uniqueId,e.parentInstanceIndex=this._indexInSourceMeshInstanceArray}instantiateHierarchy(e=null,t,i){const r=this.clone("Clone of "+(this.name||this.id),e||this.parent,!0,t&&t.newSourcedMesh);r&&i&&i(this,r);for(const s of this.getChildTransformNodes(!0))s.instantiateHierarchy(r,t,i);return r}}k.prototype.registerInstancedBuffer=function(n,e){var t,i;if((i=(t=this._userInstancedBuffersStorage)==null?void 0:t.vertexBuffers[n])==null||i.dispose(),!this.instancedBuffers){this.instancedBuffers={};for(const r of this.instances)r.instancedBuffers={}}this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this.instancedBuffers[n]=null,this._userInstancedBuffersStorage.strides[n]=e,this._userInstancedBuffersStorage.sizes[n]=e*32,this._userInstancedBuffersStorage.data[n]=new Float32Array(this._userInstancedBuffersStorage.sizes[n]),this._userInstancedBuffersStorage.vertexBuffers[n]=new b(this.getEngine(),this._userInstancedBuffersStorage.data[n],n,!0,!1,e,!0);for(const r of this.instances)r.instancedBuffers[n]=null;this._invalidateInstanceVertexArrayObject(),this._markSubMeshesAsAttributesDirty()};k.prototype._processInstancedBuffers=function(n,e){const t=n?n.length:0;for(const i in this.instancedBuffers){let r=this._userInstancedBuffersStorage.sizes[i];const s=this._userInstancedBuffersStorage.strides[i],o=(t+1)*s;for(;r<o;)r*=2;this._userInstancedBuffersStorage.data[i].length!=r&&(this._userInstancedBuffersStorage.data[i]=new Float32Array(r),this._userInstancedBuffersStorage.sizes[i]=r,this._userInstancedBuffersStorage.vertexBuffers[i]&&(this._userInstancedBuffersStorage.vertexBuffers[i].dispose(),this._userInstancedBuffersStorage.vertexBuffers[i]=null));const a=this._userInstancedBuffersStorage.data[i];let l=0;if(e){const h=this.instancedBuffers[i];h.toArray?h.toArray(a,l):h.copyToArray?h.copyToArray(a,l):a[l]=h,l+=s}for(let h=0;h<t;h++){const c=n[h].instancedBuffers[i];c.toArray?c.toArray(a,l):c.copyToArray?c.copyToArray(a,l):a[l]=c,l+=s}this._userInstancedBuffersStorage.vertexBuffers[i]?this._userInstancedBuffersStorage.vertexBuffers[i].updateDirectly(a,0):(this._userInstancedBuffersStorage.vertexBuffers[i]=new b(this.getEngine(),this._userInstancedBuffersStorage.data[i],i,!0,!1,s,!0),this._invalidateInstanceVertexArrayObject())}};k.prototype._invalidateInstanceVertexArrayObject=function(){if(!(!this._userInstancedBuffersStorage||this._userInstancedBuffersStorage.vertexArrayObjects===void 0)){for(const n in this._userInstancedBuffersStorage.vertexArrayObjects)this.getEngine().releaseVertexArrayObject(this._userInstancedBuffersStorage.vertexArrayObjects[n]);this._userInstancedBuffersStorage.vertexArrayObjects={}}};k.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(const n in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[n]&&this._userInstancedBuffersStorage.vertexBuffers[n].dispose();this._invalidateInstanceVertexArrayObject(),this.instancedBuffers={}};const Xb="clipPlaneFragmentDeclaration",Hb=`#ifdef CLIPPLANE
varying float fClipDistance;
#endif
#ifdef CLIPPLANE2
varying float fClipDistance2;
#endif
#ifdef CLIPPLANE3
varying float fClipDistance3;
#endif
#ifdef CLIPPLANE4
varying float fClipDistance4;
#endif
#ifdef CLIPPLANE5
varying float fClipDistance5;
#endif
#ifdef CLIPPLANE6
varying float fClipDistance6;
#endif
`;Y.IncludesShadersStore[Xb]=Hb;const Kb="fogFragmentDeclaration",qb=`#ifdef FOG
#define FOGMODE_NONE 0.
#define FOGMODE_EXP 1.
#define FOGMODE_EXP2 2.
#define FOGMODE_LINEAR 3.
#define E 2.71828
uniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()
{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)
{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}
else if (FOGMODE_EXP==vFogInfos.x)
{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}
else if (FOGMODE_EXP2==vFogInfos.x)
{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}
return clamp(fogCoeff,0.0,1.0);}
#endif
`;Y.IncludesShadersStore[Kb]=qb;const Yb="clipPlaneFragment",Zb=`#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)
if (false) {}
#endif
#ifdef CLIPPLANE
else if (fClipDistance>0.0)
{discard;}
#endif
#ifdef CLIPPLANE2
else if (fClipDistance2>0.0)
{discard;}
#endif
#ifdef CLIPPLANE3
else if (fClipDistance3>0.0)
{discard;}
#endif
#ifdef CLIPPLANE4
else if (fClipDistance4>0.0)
{discard;}
#endif
#ifdef CLIPPLANE5
else if (fClipDistance5>0.0)
{discard;}
#endif
#ifdef CLIPPLANE6
else if (fClipDistance6>0.0)
{discard;}
#endif
`;Y.IncludesShadersStore[Yb]=Zb;const jb="fogFragment",Qb=`#ifdef FOG
float fog=CalcFogFactor();
#ifdef PBR
fog=toLinearSpace(fog);
#endif
color.rgb=mix(vFogColor,color.rgb,fog);
#endif
`;Y.IncludesShadersStore[jb]=Qb;const Jb="colorPixelShader",$b=`#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)
#define VERTEXCOLOR
varying vec4 vColor;
#else
uniform vec4 color;
#endif
#include<clipPlaneFragmentDeclaration>
#include<fogFragmentDeclaration>
#define CUSTOM_FRAGMENT_DEFINITIONS
void main(void) {
#define CUSTOM_FRAGMENT_MAIN_BEGIN
#include<clipPlaneFragment>
#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)
gl_FragColor=vColor;
#else
gl_FragColor=color;
#endif
#include<fogFragment>(color,gl_FragColor)
#define CUSTOM_FRAGMENT_MAIN_END
}`;Y.ShadersStore[Jb]=$b;const eI="clipPlaneVertexDeclaration",tI=`#ifdef CLIPPLANE
uniform vec4 vClipPlane;varying float fClipDistance;
#endif
#ifdef CLIPPLANE2
uniform vec4 vClipPlane2;varying float fClipDistance2;
#endif
#ifdef CLIPPLANE3
uniform vec4 vClipPlane3;varying float fClipDistance3;
#endif
#ifdef CLIPPLANE4
uniform vec4 vClipPlane4;varying float fClipDistance4;
#endif
#ifdef CLIPPLANE5
uniform vec4 vClipPlane5;varying float fClipDistance5;
#endif
#ifdef CLIPPLANE6
uniform vec4 vClipPlane6;varying float fClipDistance6;
#endif
`;Y.IncludesShadersStore[eI]=tI;const iI="fogVertexDeclaration",rI=`#ifdef FOG
varying vec3 vFogDistance;
#endif
`;Y.IncludesShadersStore[iI]=rI;const sI="clipPlaneVertex",nI=`#ifdef CLIPPLANE
fClipDistance=dot(worldPos,vClipPlane);
#endif
#ifdef CLIPPLANE2
fClipDistance2=dot(worldPos,vClipPlane2);
#endif
#ifdef CLIPPLANE3
fClipDistance3=dot(worldPos,vClipPlane3);
#endif
#ifdef CLIPPLANE4
fClipDistance4=dot(worldPos,vClipPlane4);
#endif
#ifdef CLIPPLANE5
fClipDistance5=dot(worldPos,vClipPlane5);
#endif
#ifdef CLIPPLANE6
fClipDistance6=dot(worldPos,vClipPlane6);
#endif
`;Y.IncludesShadersStore[sI]=nI;const oI="fogVertex",aI=`#ifdef FOG
vFogDistance=(view*worldPos).xyz;
#endif
`;Y.IncludesShadersStore[oI]=aI;const lI="vertexColorMixing",hI=`#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)
vColor=vec4(1.0);
#ifdef VERTEXCOLOR
#ifdef VERTEXALPHA
vColor*=color;
#else
vColor.rgb*=color.rgb;
#endif
#endif
#ifdef INSTANCESCOLOR
vColor*=instanceColor;
#endif
#endif
`;Y.IncludesShadersStore[lI]=hI;const cI="colorVertexShader",uI=`attribute vec3 position;
#ifdef VERTEXCOLOR
attribute vec4 color;
#endif
#include<bonesDeclaration>
#include<bakedVertexAnimationDeclaration>
#include<clipPlaneVertexDeclaration>
#include<fogVertexDeclaration>
#ifdef FOG
uniform mat4 view;
#endif
#include<instancesDeclaration>
uniform mat4 viewProjection;
#ifdef MULTIVIEW
uniform mat4 viewProjectionR;
#endif
#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)
varying vec4 vColor;
#endif
#define CUSTOM_VERTEX_DEFINITIONS
void main(void) {
#define CUSTOM_VERTEX_MAIN_BEGIN
#include<instancesVertex>
#include<bonesVertex>
#include<bakedVertexAnimation>
vec4 worldPos=finalWorld*vec4(position,1.0);
#ifdef MULTIVIEW
if (gl_ViewID_OVR==0u) {gl_Position=viewProjection*worldPos;} else {gl_Position=viewProjectionR*worldPos;}
#else
gl_Position=viewProjection*worldPos;
#endif
#include<clipPlaneVertex>
#include<fogVertex>
#include<vertexColorMixing>
#define CUSTOM_VERTEX_MAIN_END
}`;Y.ShadersStore[cI]=uI;k._LinesMeshParser=(n,e)=>wo.Parse(n,e);class wo extends k{_isShaderMaterial(e){return e.getClassName()==="ShaderMaterial"}constructor(e,t=null,i=null,r=null,s,o,a,l){super(e,t,i,r,s),this.useVertexColor=o,this.useVertexAlpha=a,this.color=new De(1,1,1),this.alpha=1,r&&(this.color=r.color.clone(),this.alpha=r.alpha,this.useVertexColor=r.useVertexColor,this.useVertexAlpha=r.useVertexAlpha),this.intersectionThreshold=.1;const h=[],c={attributes:[b.PositionKind],uniforms:["world","viewProjection"],needAlphaBlending:!0,defines:h,useClipPlane:null};a===!1?c.needAlphaBlending=!1:c.defines.push("#define VERTEXALPHA"),o?(c.defines.push("#define VERTEXCOLOR"),c.attributes.push(b.ColorKind)):(c.uniforms.push("color"),this._color4=new $e),l?this.material=l:(this.material=new Hs("colorShader",this.getScene(),"color",c,!1),this.material.doNotSerialize=!0)}isReady(){return this._lineMaterial.isReady(this,!!this._userInstancedBuffersStorage||this.hasThinInstances)?super.isReady():!1}getClassName(){return"LinesMesh"}get material(){return this._lineMaterial}set material(e){this._lineMaterial=e,this._lineMaterial.fillMode=ie.LineListDrawMode}get checkCollisions(){return!1}set checkCollisions(e){}_bind(e,t){if(!this._geometry)return this;const i=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(!this._userInstancedBuffersStorage||this.hasThinInstances?this._geometry._bind(t,i):this._geometry._bind(t,i,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects),!this.useVertexColor&&this._isShaderMaterial(this._lineMaterial)){const{r,g:s,b:o}=this.color;this._color4.set(r,s,o,this.alpha),this._lineMaterial.setColor4("color",this._color4)}return this}_draw(e,t,i){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const r=this.getScene().getEngine();return this._unIndexed?r.drawArraysType(ie.LineListDrawMode,e.verticesStart,e.verticesCount,i):r.drawElementsType(ie.LineListDrawMode,e.indexStart,e.indexCount,i),this}dispose(e,t=!1,i){i||this._lineMaterial.dispose(!1,!1,!0),super.dispose(e)}clone(e,t=null,i){return new wo(e,this.getScene(),t,this,i)}createInstance(e){const t=new dI(e,this);if(this.instancedBuffers){t.instancedBuffers={};for(const i in this.instancedBuffers)t.instancedBuffers[i]=this.instancedBuffers[i]}return t}serialize(e){super.serialize(e),e.color=this.color.asArray(),e.alpha=this.alpha}static Parse(e,t){const i=new wo(e.name,t);return i.color=De.FromArray(e.color),i.alpha=e.alpha,i}}class dI extends P0{constructor(e,t){super(e,t),this.intersectionThreshold=t.intersectionThreshold}getClassName(){return"InstancedLinesMesh"}}function O0(n){let e=n.pathArray;const t=n.closeArray||!1,i=n.closePath||!1,r=n.invertUV||!1,s=Math.floor(e[0].length/2);let o=n.offset||s;o=o>s?s:Math.floor(o);const a=n.sideOrientation===0?0:n.sideOrientation||re.DEFAULTSIDE,l=n.uvs,h=n.colors,c=[],u=[],d=[],f=[],p=[],g=[],m=[],x=[];let E;const R=[],C=[];let _,T,y;if(e.length<2){const ue=[],Ze=[];for(T=0;T<e[0].length-o;T++)ue.push(e[0][T]),Ze.push(e[0][T+o]);e=[ue,Ze]}let P=0;const D=i?1:0;let F,N;E=e[0].length;let G,J;for(_=0;_<e.length;_++){for(m[_]=0,p[_]=[0],F=e[_],N=F.length,E=E<N?E:N,y=0;y<N;)c.push(F[y].x,F[y].y,F[y].z),y>0&&(G=F[y].subtract(F[y-1]).length(),J=G+m[_],p[_].push(J),m[_]=J),y++;i&&(y--,c.push(F[0].x,F[0].y,F[0].z),G=F[y].subtract(F[0]).length(),J=G+m[_],p[_].push(J),m[_]=J),R[_]=N+D,C[_]=P,P+=N+D}let j,z,$=null,te=null;for(T=0;T<E+D;T++){for(x[T]=0,g[T]=[0],_=0;_<e.length-1;_++)j=e[_],z=e[_+1],T===E?($=j[0],te=z[0]):($=j[T],te=z[T]),G=te.subtract($).length(),J=G+x[T],g[T].push(J),x[T]=J;t&&te&&$&&(j=e[_],z=e[0],T===E&&(te=z[0]),G=te.subtract($).length(),J=G+x[T],x[T]=J)}let fe,Z;if(l)for(_=0;_<l.length;_++)f.push(l[_].x,st.UseOpenGLOrientationForUV?1-l[_].y:l[_].y);else for(_=0;_<e.length;_++)for(T=0;T<E+D;T++)fe=m[_]!=0?p[_][T]/m[_]:0,Z=x[T]!=0?g[T][_]/x[T]:0,r?f.push(Z,fe):f.push(fe,st.UseOpenGLOrientationForUV?1-Z:Z);_=0;let L=0,w=R[_]-1,H=R[_+1]-1,de=w<H?w:H,Te=C[1]-C[0];const Ne=t?R.length:R.length-1;for(;L<=de&&_<Ne;)u.push(L,L+Te,L+1),u.push(L+Te+1,L+1,L+Te),L+=1,L===de&&(_++,_===R.length-1?(Te=C[0]-C[_],w=R[_]-1,H=R[0]-1):(Te=C[_+1]-C[_],w=R[_]-1,H=R[_+1]-1),L=C[_],de=w<H?w+L:H+L);if(re.ComputeNormals(c,u,d),i){let ue=0,Ze=0;for(_=0;_<e.length;_++)ue=C[_]*3,_+1<e.length?Ze=(C[_+1]-1)*3:Ze=d.length-3,d[ue]=(d[ue]+d[Ze])*.5,d[ue+1]=(d[ue+1]+d[Ze+1])*.5,d[ue+2]=(d[ue+2]+d[Ze+2])*.5,d[Ze]=d[ue],d[Ze+1]=d[ue+1],d[Ze+2]=d[ue+2]}re._ComputeSides(a,c,u,d,f,n.frontUVs,n.backUVs);let Fe=null;if(h){Fe=new Float32Array(h.length*4);for(let ue=0;ue<h.length;ue++)Fe[ue*4]=h[ue].r,Fe[ue*4+1]=h[ue].g,Fe[ue*4+2]=h[ue].b,Fe[ue*4+3]=h[ue].a}const ce=new re,ve=new Float32Array(c),Ue=new Float32Array(d),Se=new Float32Array(f);return ce.indices=u,ce.positions=ve,ce.normals=Ue,ce.uvs=Se,Fe&&ce.set(Fe,b.ColorKind),i&&(ce._idx=C),ce}function Uo(n,e,t=null){const i=e.pathArray,r=e.closeArray,s=e.closePath,o=k._GetDefaultSideOrientation(e.sideOrientation),a=e.instance,l=e.updatable;if(a){const h=W.Vector3[0].setAll(Number.MAX_VALUE),c=W.Vector3[1].setAll(-Number.MAX_VALUE),u=f=>{let p=i[0].length;const g=a;let m=0;const x=g._originalBuilderSideOrientation===k.DOUBLESIDE?2:1;for(let E=1;E<=x;++E)for(let R=0;R<i.length;++R){const C=i[R],_=C.length;p=p<_?p:_;for(let T=0;T<p;++T){const y=C[T];f[m]=y.x,f[m+1]=y.y,f[m+2]=y.z,h.minimizeInPlaceFromFloats(y.x,y.y,y.z),c.maximizeInPlaceFromFloats(y.x,y.y,y.z),m+=3}if(g._creationDataStorage&&g._creationDataStorage.closePath){const T=C[0];f[m]=T.x,f[m+1]=T.y,f[m+2]=T.z,m+=3}}},d=a.getVerticesData(b.PositionKind);if(u(d),a.hasBoundingInfo?a.getBoundingInfo().reConstruct(h,c,a._worldMatrix):a.buildBoundingInfo(h,c,a._worldMatrix),a.updateVerticesData(b.PositionKind,d,!1,!1),e.colors){const f=a.getVerticesData(b.ColorKind);for(let p=0,g=0;p<e.colors.length;p++,g+=4){const m=e.colors[p];f[g]=m.r,f[g+1]=m.g,f[g+2]=m.b,f[g+3]=m.a}a.updateVerticesData(b.ColorKind,f,!1,!1)}if(e.uvs){const f=a.getVerticesData(b.UVKind);for(let p=0;p<e.uvs.length;p++)f[p*2]=e.uvs[p].x,f[p*2+1]=st.UseOpenGLOrientationForUV?1-e.uvs[p].y:e.uvs[p].y;a.updateVerticesData(b.UVKind,f,!1,!1)}if(!a.areNormalsFrozen||a.isFacetDataEnabled){const f=a.getIndices(),p=a.getVerticesData(b.NormalKind),g=a.isFacetDataEnabled?a.getFacetDataParameters():null;if(re.ComputeNormals(d,f,p,g),a._creationDataStorage&&a._creationDataStorage.closePath){let m=0,x=0;for(let E=0;E<i.length;E++)m=a._creationDataStorage.idx[E]*3,E+1<i.length?x=(a._creationDataStorage.idx[E+1]-1)*3:x=p.length-3,p[m]=(p[m]+p[x])*.5,p[m+1]=(p[m+1]+p[x+1])*.5,p[m+2]=(p[m+2]+p[x+2])*.5,p[x]=p[m],p[x+1]=p[m+1],p[x+2]=p[m+2]}a.areNormalsFrozen||a.updateVerticesData(b.NormalKind,p,!1,!1)}return a}else{const h=new k(n,t);h._originalBuilderSideOrientation=o,h._creationDataStorage=new S0;const c=O0(e);return s&&(h._creationDataStorage.idx=c._idx),h._creationDataStorage.closePath=s,h._creationDataStorage.closeArray=r,c.applyToMesh(h,l),h}}re.CreateRibbon=O0;k.CreateRibbon=(n,e,t=!1,i,r,s,o=!1,a,l)=>Uo(n,{pathArray:e,closeArray:t,closePath:i,offset:r,updatable:o,sideOrientation:a,instance:l},s);function Ad(n){const e=[],t=[],i=[],r=[],s=n.radius||.5,o=n.tessellation||64,a=n.arc&&(n.arc<=0||n.arc>1)?1:n.arc||1,l=n.sideOrientation===0?0:n.sideOrientation||re.DEFAULTSIDE;e.push(0,0,0),r.push(.5,.5);const h=Math.PI*2*a,c=a===1?h/o:h/(o-1);let u=0;for(let p=0;p<o;p++){const g=Math.cos(u),m=Math.sin(u),x=(g+1)/2,E=(1-m)/2;e.push(s*g,s*m,0),r.push(x,st.UseOpenGLOrientationForUV?1-E:E),u+=c}a===1&&(e.push(e[3],e[4],e[5]),r.push(r[2],st.UseOpenGLOrientationForUV?1-r[3]:r[3]));const d=e.length/3;for(let p=1;p<d-1;p++)t.push(p+1,0,p);re.ComputeNormals(e,t,i),re._ComputeSides(l,e,t,i,r,n.frontUVs,n.backUVs);const f=new re;return f.indices=t,f.positions=e,f.normals=i,f.uvs=r,f}function D0(n,e={},t=null){const i=new k(n,t);return e.sideOrientation=k._GetDefaultSideOrientation(e.sideOrientation),i._originalBuilderSideOrientation=e.sideOrientation,Ad(e).applyToMesh(i,e.updatable),i}re.CreateDisc=Ad;k.CreateDisc=(n,e,t,i=null,r,s)=>D0(n,{radius:e,tessellation:t,sideOrientation:s,updatable:r},i);function Vs(n){const e=[],t=[],i=[],r=[];let s,o;const a=n.width||1,l=n.height||1,h=(n.subdivisionsX||n.subdivisions||1)|0,c=(n.subdivisionsY||n.subdivisions||1)|0;for(s=0;s<=c;s++)for(o=0;o<=h;o++){const d=new v(o*a/h-a/2,0,(c-s)*l/c-l/2),f=new v(0,1,0);t.push(d.x,d.y,d.z),i.push(f.x,f.y,f.z),r.push(o/h,st.UseOpenGLOrientationForUV?s/c:1-s/c)}for(s=0;s<c;s++)for(o=0;o<h;o++)e.push(o+1+(s+1)*(h+1)),e.push(o+1+s*(h+1)),e.push(o+s*(h+1)),e.push(o+(s+1)*(h+1)),e.push(o+1+(s+1)*(h+1)),e.push(o+s*(h+1));const u=new re;return u.indices=e,u.positions=t,u.normals=i,u.uvs=r,u}function N0(n){const e=n.xmin!==void 0&&n.xmin!==null?n.xmin:-1,t=n.zmin!==void 0&&n.zmin!==null?n.zmin:-1,i=n.xmax!==void 0&&n.xmax!==null?n.xmax:1,r=n.zmax!==void 0&&n.zmax!==null?n.zmax:1,s=n.subdivisions||{w:1,h:1},o=n.precision||{w:1,h:1},a=[],l=[],h=[],c=[];let u,d,f,p;s.h=s.h<1?1:s.h,s.w=s.w<1?1:s.w,o.w=o.w<1?1:o.w,o.h=o.h<1?1:o.h;const g={w:(i-e)/s.w,h:(r-t)/s.h};function m(E,R,C,_){const T=l.length/3,y=o.w+1;for(u=0;u<o.h;u++)for(d=0;d<o.w;d++){const F=[T+d+u*y,T+(d+1)+u*y,T+(d+1)+(u+1)*y,T+d+(u+1)*y];a.push(F[1]),a.push(F[2]),a.push(F[3]),a.push(F[0]),a.push(F[1]),a.push(F[3])}const P=v.Zero(),D=new v(0,1,0);for(u=0;u<=o.h;u++)for(P.z=u*(_-R)/o.h+R,d=0;d<=o.w;d++)P.x=d*(C-E)/o.w+E,P.y=0,l.push(P.x,P.y,P.z),h.push(D.x,D.y,D.z),c.push(d/o.w,u/o.h)}for(f=0;f<s.h;f++)for(p=0;p<s.w;p++)m(e+p*g.w,t+f*g.h,e+(p+1)*g.w,t+(f+1)*g.h);const x=new re;return x.indices=a,x.positions=l,x.normals=h,x.uvs=c,x}function F0(n){const e=[],t=[],i=[],r=[];let s,o;const a=n.colorFilter||new De(.3,.59,.11),l=n.alphaFilter||0;let h=!1;if(n.minHeight>n.maxHeight){h=!0;const u=n.maxHeight;n.maxHeight=n.minHeight,n.minHeight=u}for(s=0;s<=n.subdivisions;s++)for(o=0;o<=n.subdivisions;o++){const u=new v(o*n.width/n.subdivisions-n.width/2,0,(n.subdivisions-s)*n.height/n.subdivisions-n.height/2),d=(u.x+n.width/2)/n.width*(n.bufferWidth-1)|0,f=(1-(u.z+n.height/2)/n.height)*(n.bufferHeight-1)|0,p=(d+f*n.bufferWidth)*4;let g=n.buffer[p]/255,m=n.buffer[p+1]/255,x=n.buffer[p+2]/255;const E=n.buffer[p+3]/255;h&&(g=1-g,m=1-m,x=1-x);const R=g*a.r+m*a.g+x*a.b;E>=l?u.y=n.minHeight+(n.maxHeight-n.minHeight)*R:u.y=n.minHeight-xt,n.heightBuffer&&(n.heightBuffer[s*(n.subdivisions+1)+o]=u.y),t.push(u.x,u.y,u.z),i.push(0,0,0),r.push(o/n.subdivisions,1-s/n.subdivisions)}for(s=0;s<n.subdivisions;s++)for(o=0;o<n.subdivisions;o++){const u=o+1+(s+1)*(n.subdivisions+1),d=o+1+s*(n.subdivisions+1),f=o+s*(n.subdivisions+1),p=o+(s+1)*(n.subdivisions+1),g=t[u*3+1]>=n.minHeight,m=t[d*3+1]>=n.minHeight,x=t[f*3+1]>=n.minHeight;g&&m&&x&&(e.push(u),e.push(d),e.push(f)),t[p*3+1]>=n.minHeight&&g&&x&&(e.push(p),e.push(u),e.push(f))}re.ComputeNormals(t,e,i);const c=new re;return c.indices=e,c.positions=t,c.normals=i,c.uvs=r,c}function fI(n,e={},t){const i=new Ja(n,t);return i._setReady(!1),i._subdivisionsX=e.subdivisionsX||e.subdivisions||1,i._subdivisionsY=e.subdivisionsY||e.subdivisions||1,i._width=e.width||1,i._height=e.height||1,i._maxX=i._width/2,i._maxZ=i._height/2,i._minX=-i._maxX,i._minZ=-i._maxZ,Vs(e).applyToMesh(i,e.updatable),i._setReady(!0),i}function pI(n,e,t=null){const i=new k(n,t);return N0(e).applyToMesh(i,e.updatable),i}function gI(n,e,t={},i=null){const r=t.width||10,s=t.height||10,o=t.subdivisions||1,a=t.minHeight||0,l=t.maxHeight||1,h=t.colorFilter||new De(.3,.59,.11),c=t.alphaFilter||0,u=t.updatable,d=t.onReady;i=i||rt.LastCreatedScene;const f=new Ja(n,i);f._subdivisionsX=o,f._subdivisionsY=o,f._width=r,f._height=s,f._maxX=f._width/2,f._maxZ=f._height/2,f._minX=-f._maxX,f._minZ=-f._maxZ,f._setReady(!1);let p;t.passHeightBufferInCallback&&(p=new Float32Array((o+1)*(o+1)));const g=(m,x,E)=>{F0({width:r,height:s,subdivisions:o,minHeight:a,maxHeight:l,colorFilter:h,buffer:m,bufferWidth:x,bufferHeight:E,alphaFilter:c,heightBuffer:p}).applyToMesh(f,u),d&&d(f,p),f._setReady(!0)};if(typeof e=="string"){const m=x=>{const E=x.width,R=x.height;if(i.isDisposed)return;const C=i==null?void 0:i.getEngine().resizeImageBitmap(x,E,R);g(C,E,R)};ge.LoadImage(e,m,t.onError?t.onError:()=>{},i.offlineProvider)}else g(e.data,e.width,e.height);return f}re.CreateGround=Vs;re.CreateTiledGround=N0;re.CreateGroundFromHeightMap=F0;k.CreateGround=(n,e,t,i,r,s)=>fI(n,{width:e,height:t,subdivisions:i,updatable:s},r);k.CreateTiledGround=(n,e,t,i,r,s,o,a,l)=>pI(n,{xmin:e,zmin:t,xmax:i,zmax:r,subdivisions:s,precision:o,updatable:l},a);k.CreateGroundFromHeightMap=(n,e,t,i,r,s,o,a,l,h,c)=>gI(n,e,{width:t,height:i,subdivisions:r,minHeight:s,maxHeight:o,updatable:l,onReady:h,alphaFilter:c},a);function L0(n){let e=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const t=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],i=[];let r=[];const s=n.width||n.size||1,o=n.height||n.size||1,a=n.depth||n.size||1,l=n.wrap||!1;let h=n.topBaseAt===void 0?1:n.topBaseAt,c=n.bottomBaseAt===void 0?0:n.bottomBaseAt;h=(h+4)%4,c=(c+4)%4;const u=[2,0,3,1],d=[2,0,1,3];let f=u[h],p=d[c],g=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(l){e=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],g=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let T=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],y=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const P=[17,18,19,16],D=[22,23,20,21];for(;f>0;)T.unshift(T.pop()),P.unshift(P.pop()),f--;for(;p>0;)y.unshift(y.pop()),D.unshift(D.pop()),p--;T=T.flat(),y=y.flat(),g=g.concat(T).concat(y),e.push(P[0],P[2],P[3],P[0],P[1],P[2]),e.push(D[0],D[2],D[3],D[0],D[1],D[2])}const m=[s/2,o/2,a/2];r=g.reduce((T,y,P)=>T.concat(y*m[P%3]),[]);const x=n.sideOrientation===0?0:n.sideOrientation||re.DEFAULTSIDE,E=n.faceUV||new Array(6),R=n.faceColors,C=[];for(let T=0;T<6;T++)E[T]===void 0&&(E[T]=new Ke(0,0,1,1)),R&&R[T]===void 0&&(R[T]=new $e(1,1,1,1));for(let T=0;T<6;T++)if(i.push(E[T].z,st.UseOpenGLOrientationForUV?1-E[T].w:E[T].w),i.push(E[T].x,st.UseOpenGLOrientationForUV?1-E[T].w:E[T].w),i.push(E[T].x,st.UseOpenGLOrientationForUV?1-E[T].y:E[T].y),i.push(E[T].z,st.UseOpenGLOrientationForUV?1-E[T].y:E[T].y),R)for(let y=0;y<4;y++)C.push(R[T].r,R[T].g,R[T].b,R[T].a);re._ComputeSides(x,r,e,t,i,n.frontUVs,n.backUVs);const _=new re;if(_.indices=e,_.positions=r,_.normals=t,_.uvs=i,R){const T=x===re.DOUBLESIDE?C.concat(C):C;_.colors=T}return _}function mI(n){const e=n.width||n.size||1,t=n.height||n.size||1,i=n.depth||n.size||1,r=(n.widthSegments||n.segments||1)|0,s=(n.heightSegments||n.segments||1)|0,o=(n.depthSegments||n.segments||1)|0,a=new U,l=new U,h=new U,c=Vs({width:e,height:i,subdivisionsX:r,subdivisionsY:o});U.TranslationToRef(0,-t/2,0,l),U.RotationZToRef(Math.PI,a),a.multiplyToRef(l,h),c.transform(h);const u=Vs({width:e,height:i,subdivisionsX:r,subdivisionsY:o});U.TranslationToRef(0,t/2,0,h),u.transform(h);const d=Vs({width:t,height:i,subdivisionsX:s,subdivisionsY:o});U.TranslationToRef(-e/2,0,0,l),U.RotationZToRef(Math.PI/2,a),a.multiplyToRef(l,h),d.transform(h);const f=Vs({width:t,height:i,subdivisionsX:s,subdivisionsY:o});U.TranslationToRef(e/2,0,0,l),U.RotationZToRef(-Math.PI/2,a),a.multiplyToRef(l,h),f.transform(h);const p=Vs({width:e,height:t,subdivisionsX:r,subdivisionsY:s});U.TranslationToRef(0,0,-i/2,l),U.RotationXToRef(-Math.PI/2,a),a.multiplyToRef(l,h),p.transform(h);const g=Vs({width:e,height:t,subdivisionsX:r,subdivisionsY:s});return U.TranslationToRef(0,0,i/2,l),U.RotationXToRef(Math.PI/2,a),a.multiplyToRef(l,h),g.transform(h),c.merge([u,f,d,p,g],!0),c}function _I(n,e={},t=null){const i=new k(n,t);return e.sideOrientation=k._GetDefaultSideOrientation(e.sideOrientation),i._originalBuilderSideOrientation=e.sideOrientation,L0(e).applyToMesh(i,e.updatable),i}re.CreateBox=L0;k.CreateBox=(n,e,t=null,i,r)=>_I(n,{size:e,sideOrientation:r,updatable:i},t);function $l(n){const e=n.pattern||k.NO_FLIP,t=n.tileWidth||n.tileSize||1,i=n.tileHeight||n.tileSize||1,r=n.alignHorizontal||0,s=n.alignVertical||0,o=n.width||n.size||1,a=Math.floor(o/t);let l=o-a*t;const h=n.height||n.size||1,c=Math.floor(h/i);let u=h-c*i;const d=t*a/2,f=i*c/2;let p=0,g=0,m=0,x=0,E=0,R=0;if(l>0||u>0){switch(m=-d,x=-f,E=d,R=f,r){case k.CENTER:l/=2,m-=l,E+=l;break;case k.LEFT:E+=l,p=-l/2;break;case k.RIGHT:m-=l,p=l/2;break}switch(s){case k.CENTER:u/=2,x-=u,R+=u;break;case k.BOTTOM:R+=u,g=-u/2;break;case k.TOP:x-=u,g=u/2;break}}const C=[],_=[],T=[];T[0]=[0,0,1,0,1,1,0,1],T[1]=[0,0,1,0,1,1,0,1],(e===k.ROTATE_TILE||e===k.ROTATE_ROW)&&(T[1]=[1,1,0,1,0,0,1,0]),(e===k.FLIP_TILE||e===k.FLIP_ROW)&&(T[1]=[1,0,0,0,0,1,1,1]),(e===k.FLIP_N_ROTATE_TILE||e===k.FLIP_N_ROTATE_ROW)&&(T[1]=[0,1,1,1,1,0,0,0]);let y=[];const P=[],D=[];let F=0;for(let j=0;j<c;j++)for(let z=0;z<a;z++)C.push(-d+z*t+p,-f+j*i+g,0),C.push(-d+(z+1)*t+p,-f+j*i+g,0),C.push(-d+(z+1)*t+p,-f+(j+1)*i+g,0),C.push(-d+z*t+p,-f+(j+1)*i+g,0),D.push(F,F+1,F+3,F+1,F+2,F+3),e===k.FLIP_TILE||e===k.ROTATE_TILE||e===k.FLIP_N_ROTATE_TILE?y=y.concat(T[(z%2+j%2)%2]):e===k.FLIP_ROW||e===k.ROTATE_ROW||e===k.FLIP_N_ROTATE_ROW?y=y.concat(T[j%2]):y=y.concat(T[0]),P.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),_.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),F+=4;if(l>0||u>0){const j=u>0&&(s===k.CENTER||s===k.TOP),z=u>0&&(s===k.CENTER||s===k.BOTTOM),$=l>0&&(r===k.CENTER||r===k.RIGHT),te=l>0&&(r===k.CENTER||r===k.LEFT);let fe=[],Z,L,w,H;if(j&&$&&(C.push(m+p,x+g,0),C.push(-d+p,x+g,0),C.push(-d+p,x+u+g,0),C.push(m+p,x+u+g,0),D.push(F,F+1,F+3,F+1,F+2,F+3),F+=4,Z=1-l/t,L=1-u/i,w=1,H=1,fe=[Z,L,w,L,w,H,Z,H],e===k.ROTATE_ROW&&(fe=[1-Z,1-L,1-w,1-L,1-w,1-H,1-Z,1-H]),e===k.FLIP_ROW&&(fe=[1-Z,L,1-w,L,1-w,H,1-Z,H]),e===k.FLIP_N_ROTATE_ROW&&(fe=[Z,1-L,w,1-L,w,1-H,Z,1-H]),y=y.concat(fe),P.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),_.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),j&&te&&(C.push(d+p,x+g,0),C.push(E+p,x+g,0),C.push(E+p,x+u+g,0),C.push(d+p,x+u+g,0),D.push(F,F+1,F+3,F+1,F+2,F+3),F+=4,Z=0,L=1-u/i,w=l/t,H=1,fe=[Z,L,w,L,w,H,Z,H],(e===k.ROTATE_ROW||e===k.ROTATE_TILE&&a%2===0)&&(fe=[1-Z,1-L,1-w,1-L,1-w,1-H,1-Z,1-H]),(e===k.FLIP_ROW||e===k.FLIP_TILE&&a%2===0)&&(fe=[1-Z,L,1-w,L,1-w,H,1-Z,H]),(e===k.FLIP_N_ROTATE_ROW||e===k.FLIP_N_ROTATE_TILE&&a%2===0)&&(fe=[Z,1-L,w,1-L,w,1-H,Z,1-H]),y=y.concat(fe),P.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),_.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),z&&$&&(C.push(m+p,f+g,0),C.push(-d+p,f+g,0),C.push(-d+p,R+g,0),C.push(m+p,R+g,0),D.push(F,F+1,F+3,F+1,F+2,F+3),F+=4,Z=1-l/t,L=0,w=1,H=u/i,fe=[Z,L,w,L,w,H,Z,H],(e===k.ROTATE_ROW&&c%2===1||e===k.ROTATE_TILE&&c%1===0)&&(fe=[1-Z,1-L,1-w,1-L,1-w,1-H,1-Z,1-H]),(e===k.FLIP_ROW&&c%2===1||e===k.FLIP_TILE&&c%2===0)&&(fe=[1-Z,L,1-w,L,1-w,H,1-Z,H]),(e===k.FLIP_N_ROTATE_ROW&&c%2===1||e===k.FLIP_N_ROTATE_TILE&&c%2===0)&&(fe=[Z,1-L,w,1-L,w,1-H,Z,1-H]),y=y.concat(fe),P.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),_.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),z&&te&&(C.push(d+p,f+g,0),C.push(E+p,f+g,0),C.push(E+p,R+g,0),C.push(d+p,R+g,0),D.push(F,F+1,F+3,F+1,F+2,F+3),F+=4,Z=0,L=0,w=l/t,H=u/i,fe=[Z,L,w,L,w,H,Z,H],(e===k.ROTATE_ROW&&c%2===1||e===k.ROTATE_TILE&&(c+a)%2===1)&&(fe=[1-Z,1-L,1-w,1-L,1-w,1-H,1-Z,1-H]),(e===k.FLIP_ROW&&c%2===1||e===k.FLIP_TILE&&(c+a)%2===1)&&(fe=[1-Z,L,1-w,L,1-w,H,1-Z,H]),(e===k.FLIP_N_ROTATE_ROW&&c%2===1||e===k.FLIP_N_ROTATE_TILE&&(c+a)%2===1)&&(fe=[Z,1-L,w,1-L,w,1-H,Z,1-H]),y=y.concat(fe),P.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),_.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),j){const de=[];Z=0,L=1-u/i,w=1,H=1,de[0]=[Z,L,w,L,w,H,Z,H],de[1]=[Z,L,w,L,w,H,Z,H],(e===k.ROTATE_TILE||e===k.ROTATE_ROW)&&(de[1]=[1-Z,1-L,1-w,1-L,1-w,1-H,1-Z,1-H]),(e===k.FLIP_TILE||e===k.FLIP_ROW)&&(de[1]=[1-Z,L,1-w,L,1-w,H,1-Z,H]),(e===k.FLIP_N_ROTATE_TILE||e===k.FLIP_N_ROTATE_ROW)&&(de[1]=[Z,1-L,w,1-L,w,1-H,Z,1-H]);for(let Te=0;Te<a;Te++)C.push(-d+Te*t+p,x+g,0),C.push(-d+(Te+1)*t+p,x+g,0),C.push(-d+(Te+1)*t+p,x+u+g,0),C.push(-d+Te*t+p,x+u+g,0),D.push(F,F+1,F+3,F+1,F+2,F+3),F+=4,e===k.FLIP_TILE||e===k.ROTATE_TILE||e===k.FLIP_N_ROTATE_TILE?y=y.concat(de[(Te+1)%2]):e===k.FLIP_ROW||e===k.ROTATE_ROW||e===k.FLIP_N_ROTATE_ROW?y=y.concat(de[1]):y=y.concat(de[0]),P.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),_.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(z){const de=[];Z=0,L=0,w=1,H=u/i,de[0]=[Z,L,w,L,w,H,Z,H],de[1]=[Z,L,w,L,w,H,Z,H],(e===k.ROTATE_TILE||e===k.ROTATE_ROW)&&(de[1]=[1-Z,1-L,1-w,1-L,1-w,1-H,1-Z,1-H]),(e===k.FLIP_TILE||e===k.FLIP_ROW)&&(de[1]=[1-Z,L,1-w,L,1-w,H,1-Z,H]),(e===k.FLIP_N_ROTATE_TILE||e===k.FLIP_N_ROTATE_ROW)&&(de[1]=[Z,1-L,w,1-L,w,1-H,Z,1-H]);for(let Te=0;Te<a;Te++)C.push(-d+Te*t+p,R-u+g,0),C.push(-d+(Te+1)*t+p,R-u+g,0),C.push(-d+(Te+1)*t+p,R+g,0),C.push(-d+Te*t+p,R+g,0),D.push(F,F+1,F+3,F+1,F+2,F+3),F+=4,e===k.FLIP_TILE||e===k.ROTATE_TILE||e===k.FLIP_N_ROTATE_TILE?y=y.concat(de[(Te+c)%2]):e===k.FLIP_ROW||e===k.ROTATE_ROW||e===k.FLIP_N_ROTATE_ROW?y=y.concat(de[c%2]):y=y.concat(de[0]),P.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),_.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if($){const de=[];Z=1-l/t,L=0,w=1,H=1,de[0]=[Z,L,w,L,w,H,Z,H],de[1]=[Z,L,w,L,w,H,Z,H],(e===k.ROTATE_TILE||e===k.ROTATE_ROW)&&(de[1]=[1-Z,1-L,1-w,1-L,1-w,1-H,1-Z,1-H]),(e===k.FLIP_TILE||e===k.FLIP_ROW)&&(de[1]=[1-Z,L,1-w,L,1-w,H,1-Z,H]),(e===k.FLIP_N_ROTATE_TILE||e===k.FLIP_N_ROTATE_ROW)&&(de[1]=[Z,1-L,w,1-L,w,1-H,Z,1-H]);for(let Te=0;Te<c;Te++)C.push(m+p,-f+Te*i+g,0),C.push(m+l+p,-f+Te*i+g,0),C.push(m+l+p,-f+(Te+1)*i+g,0),C.push(m+p,-f+(Te+1)*i+g,0),D.push(F,F+1,F+3,F+1,F+2,F+3),F+=4,e===k.FLIP_TILE||e===k.ROTATE_TILE||e===k.FLIP_N_ROTATE_TILE?y=y.concat(de[(Te+1)%2]):e===k.FLIP_ROW||e===k.ROTATE_ROW||e===k.FLIP_N_ROTATE_ROW?y=y.concat(de[Te%2]):y=y.concat(de[0]),P.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),_.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(te){const de=[];Z=0,L=0,w=l/i,H=1,de[0]=[Z,L,w,L,w,H,Z,H],de[1]=[Z,L,w,L,w,H,Z,H],(e===k.ROTATE_TILE||e===k.ROTATE_ROW)&&(de[1]=[1-Z,1-L,1-w,1-L,1-w,1-H,1-Z,1-H]),(e===k.FLIP_TILE||e===k.FLIP_ROW)&&(de[1]=[1-Z,L,1-w,L,1-w,H,1-Z,H]),(e===k.FLIP_N_ROTATE_TILE||e===k.FLIP_N_ROTATE_ROW)&&(de[1]=[Z,1-L,w,1-L,w,1-H,Z,1-H]);for(let Te=0;Te<c;Te++)C.push(E-l+p,-f+Te*i+g,0),C.push(E+p,-f+Te*i+g,0),C.push(E+p,-f+(Te+1)*i+g,0),C.push(E-l+p,-f+(Te+1)*i+g,0),D.push(F,F+1,F+3,F+1,F+2,F+3),F+=4,e===k.FLIP_TILE||e===k.ROTATE_TILE||e===k.FLIP_N_ROTATE_TILE?y=y.concat(de[(Te+a)%2]):e===k.FLIP_ROW||e===k.ROTATE_ROW||e===k.FLIP_N_ROTATE_ROW?y=y.concat(de[Te%2]):y=y.concat(de[0]),P.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),_.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const N=n.sideOrientation===0?0:n.sideOrientation||re.DEFAULTSIDE;re._ComputeSides(N,C,D,_,y,n.frontUVs,n.backUVs);const G=new re;G.indices=D,G.positions=C,G.normals=_,G.uvs=y;const J=N===re.DOUBLESIDE?P.concat(P):P;return G.colors=J,G}re.CreateTiledPlane=$l;function vI(n){const e=n.faceUV||new Array(6),t=n.faceColors,i=n.pattern||k.NO_FLIP,r=n.width||n.size||1,s=n.height||n.size||1,o=n.depth||n.size||1,a=n.tileWidth||n.tileSize||1,l=n.tileHeight||n.tileSize||1,h=n.alignHorizontal||0,c=n.alignVertical||0,u=n.sideOrientation===0?0:n.sideOrientation||re.DEFAULTSIDE;for(let L=0;L<6;L++)e[L]===void 0&&(e[L]=new Ke(0,0,1,1)),t&&t[L]===void 0&&(t[L]=new $e(1,1,1,1));const d=r/2,f=s/2,p=o/2,g=[];for(let L=0;L<2;L++)g[L]=$l({pattern:i,tileWidth:a,tileHeight:l,width:r,height:s,alignVertical:c,alignHorizontal:h,sideOrientation:u});for(let L=2;L<4;L++)g[L]=$l({pattern:i,tileWidth:a,tileHeight:l,width:o,height:s,alignVertical:c,alignHorizontal:h,sideOrientation:u});let m=c;c===k.BOTTOM?m=k.TOP:c===k.TOP&&(m=k.BOTTOM);for(let L=4;L<6;L++)g[L]=$l({pattern:i,tileWidth:a,tileHeight:l,width:r,height:o,alignVertical:m,alignHorizontal:h,sideOrientation:u});let x=[],E=[],R=[],C=[];const _=[],T=[],y=[],P=[];let D=0,F=0;for(let L=0;L<6;L++){const w=g[L].positions.length;T[L]=[],y[L]=[];for(let H=0;H<w/3;H++)T[L].push(new v(g[L].positions[3*H],g[L].positions[3*H+1],g[L].positions[3*H+2])),y[L].push(new v(g[L].normals[3*H],g[L].normals[3*H+1],g[L].normals[3*H+2]));D=g[L].uvs.length,P[L]=[];for(let H=0;H<D;H+=2)P[L][H]=e[L].x+(e[L].z-e[L].x)*g[L].uvs[H],P[L][H+1]=e[L].y+(e[L].w-e[L].y)*g[L].uvs[H+1],st.UseOpenGLOrientationForUV&&(P[L][H+1]=1-P[L][H+1]);if(R=R.concat(P[L]),C=C.concat(g[L].indices.map(H=>H+F)),F+=T[L].length,t)for(let H=0;H<4;H++)_.push(t[L].r,t[L].g,t[L].b,t[L].a)}const N=new v(0,0,p),G=U.RotationY(Math.PI);x=T[0].map(L=>v.TransformNormal(L,G).add(N)).map(L=>[L.x,L.y,L.z]).reduce((L,w)=>L.concat(w),[]),E=y[0].map(L=>v.TransformNormal(L,G)).map(L=>[L.x,L.y,L.z]).reduce((L,w)=>L.concat(w),[]),x=x.concat(T[1].map(L=>L.subtract(N)).map(L=>[L.x,L.y,L.z]).reduce((L,w)=>L.concat(w),[])),E=E.concat(y[1].map(L=>[L.x,L.y,L.z]).reduce((L,w)=>L.concat(w),[]));const J=new v(d,0,0),j=U.RotationY(-Math.PI/2);x=x.concat(T[2].map(L=>v.TransformNormal(L,j).add(J)).map(L=>[L.x,L.y,L.z]).reduce((L,w)=>L.concat(w),[])),E=E.concat(y[2].map(L=>v.TransformNormal(L,j)).map(L=>[L.x,L.y,L.z]).reduce((L,w)=>L.concat(w),[]));const z=U.RotationY(Math.PI/2);x=x.concat(T[3].map(L=>v.TransformNormal(L,z).subtract(J)).map(L=>[L.x,L.y,L.z]).reduce((L,w)=>L.concat(w),[])),E=E.concat(y[3].map(L=>v.TransformNormal(L,z)).map(L=>[L.x,L.y,L.z]).reduce((L,w)=>L.concat(w),[]));const $=new v(0,f,0),te=U.RotationX(Math.PI/2);x=x.concat(T[4].map(L=>v.TransformNormal(L,te).add($)).map(L=>[L.x,L.y,L.z]).reduce((L,w)=>L.concat(w),[])),E=E.concat(y[4].map(L=>v.TransformNormal(L,te)).map(L=>[L.x,L.y,L.z]).reduce((L,w)=>L.concat(w),[]));const fe=U.RotationX(-Math.PI/2);x=x.concat(T[5].map(L=>v.TransformNormal(L,fe).subtract($)).map(L=>[L.x,L.y,L.z]).reduce((L,w)=>L.concat(w),[])),E=E.concat(y[5].map(L=>v.TransformNormal(L,fe)).map(L=>[L.x,L.y,L.z]).reduce((L,w)=>L.concat(w),[])),re._ComputeSides(u,x,C,E,R);const Z=new re;if(Z.indices=C,Z.positions=x,Z.normals=E,Z.uvs=R,t){const L=u===re.DOUBLESIDE?_.concat(_):_;Z.colors=L}return Z}re.CreateTiledBox=vI;function Md(n){const e=(n.segments||32)|0,t=n.diameterX||n.diameter||1,i=n.diameterY||n.diameter||1,r=n.diameterZ||n.diameter||1,s=n.arc&&(n.arc<=0||n.arc>1)?1:n.arc||1,o=n.slice&&n.slice<=0?1:n.slice||1,a=n.sideOrientation===0?0:n.sideOrientation||re.DEFAULTSIDE,l=!!n.dedupTopBottomIndices,h=new v(t/2,i/2,r/2),c=2+e,u=2*c,d=[],f=[],p=[],g=[];for(let x=0;x<=c;x++){const E=x/c,R=E*Math.PI*o;for(let C=0;C<=u;C++){const _=C/u,T=_*Math.PI*2*s,y=U.RotationZ(-R),P=U.RotationY(T),D=v.TransformCoordinates(v.Up(),y),F=v.TransformCoordinates(D,P),N=F.multiply(h),G=F.divide(h).normalize();f.push(N.x,N.y,N.z),p.push(G.x,G.y,G.z),g.push(_,st.UseOpenGLOrientationForUV?1-E:E)}if(x>0){const C=f.length/3;for(let _=C-2*(u+1);_+u+2<C;_++)l?(x>1&&(d.push(_),d.push(_+1),d.push(_+u+1)),(x<c||o<1)&&(d.push(_+u+1),d.push(_+1),d.push(_+u+2))):(d.push(_),d.push(_+1),d.push(_+u+1),d.push(_+u+1),d.push(_+1),d.push(_+u+2))}}re._ComputeSides(a,f,d,p,g,n.frontUVs,n.backUVs);const m=new re;return m.indices=d,m.positions=f,m.normals=p,m.uvs=g,m}function w0(n,e={},t=null){const i=new k(n,t);return e.sideOrientation=k._GetDefaultSideOrientation(e.sideOrientation),i._originalBuilderSideOrientation=e.sideOrientation,Md(e).applyToMesh(i,e.updatable),i}re.CreateSphere=Md;k.CreateSphere=(n,e,t,i,r,s)=>w0(n,{segments:e,diameterX:t,diameterY:t,diameterZ:t,sideOrientation:s,updatable:r},i);function Pd(n){const e=n.height||2;let t=n.diameterTop===0?0:n.diameterTop||n.diameter||1,i=n.diameterBottom===0?0:n.diameterBottom||n.diameter||1;t=t||1e-5,i=i||1e-5;const r=(n.tessellation||24)|0,s=(n.subdivisions||1)|0,o=!!n.hasRings,a=!!n.enclose,l=n.cap===0?0:n.cap||k.CAP_ALL,h=n.arc&&(n.arc<=0||n.arc>1)?1:n.arc||1,c=n.sideOrientation===0?0:n.sideOrientation||re.DEFAULTSIDE,u=n.faceUV||new Array(3),d=n.faceColors,f=h!==1&&a?2:0,p=o?s:1,g=2+(1+f)*p;let m;for(m=0;m<g;m++)d&&d[m]===void 0&&(d[m]=new $e(1,1,1,1));for(m=0;m<g;m++)u&&u[m]===void 0&&(u[m]=new Ke(0,0,1,1));const x=[],E=[],R=[],C=[],_=[],T=Math.PI*2*h/r;let y,P,D;const F=(i-t)/2/e,N=v.Zero(),G=v.Zero(),J=v.Zero(),j=v.Zero(),z=v.Zero(),$=Qa.Y;let te,fe,Z,L=1,w=1,H=0,de=0;for(te=0;te<=s;te++)for(P=te/s,D=(P*(t-i)+i)/2,L=o&&te!==0&&te!==s?2:1,Z=0;Z<L;Z++){for(o&&(w+=Z),a&&(w+=2*Z),fe=0;fe<=r;fe++)y=fe*T,N.x=Math.cos(-y)*D,N.y=-e/2+P*e,N.z=Math.sin(-y)*D,t===0&&te===s?(G.x=R[R.length-(r+1)*3],G.y=R[R.length-(r+1)*3+1],G.z=R[R.length-(r+1)*3+2]):(G.x=N.x,G.z=N.z,G.y=Math.sqrt(G.x*G.x+G.z*G.z)*F,G.normalize()),fe===0&&(J.copyFrom(N),j.copyFrom(G)),E.push(N.x,N.y,N.z),R.push(G.x,G.y,G.z),o?de=H!==w?u[w].y:u[w].w:de=u[w].y+(u[w].w-u[w].y)*P,C.push(u[w].x+(u[w].z-u[w].x)*fe/r,st.UseOpenGLOrientationForUV?1-de:de),d&&_.push(d[w].r,d[w].g,d[w].b,d[w].a);h!==1&&a&&(E.push(N.x,N.y,N.z),E.push(0,N.y,0),E.push(0,N.y,0),E.push(J.x,J.y,J.z),v.CrossToRef($,G,z),z.normalize(),R.push(z.x,z.y,z.z,z.x,z.y,z.z),v.CrossToRef(j,$,z),z.normalize(),R.push(z.x,z.y,z.z,z.x,z.y,z.z),o?de=H!==w?u[w+1].y:u[w+1].w:de=u[w+1].y+(u[w+1].w-u[w+1].y)*P,C.push(u[w+1].x,st.UseOpenGLOrientationForUV?1-de:de),C.push(u[w+1].z,st.UseOpenGLOrientationForUV?1-de:de),o?de=H!==w?u[w+2].y:u[w+2].w:de=u[w+2].y+(u[w+2].w-u[w+2].y)*P,C.push(u[w+2].x,st.UseOpenGLOrientationForUV?1-de:de),C.push(u[w+2].z,st.UseOpenGLOrientationForUV?1-de:de),d&&(_.push(d[w+1].r,d[w+1].g,d[w+1].b,d[w+1].a),_.push(d[w+1].r,d[w+1].g,d[w+1].b,d[w+1].a),_.push(d[w+2].r,d[w+2].g,d[w+2].b,d[w+2].a),_.push(d[w+2].r,d[w+2].g,d[w+2].b,d[w+2].a))),H!==w&&(H=w)}const Te=h!==1&&a?r+4:r;for(te=0,w=0;w<s;w++){let ce=0,ve=0,Ue=0,Se=0;for(fe=0;fe<r;fe++)ce=te*(Te+1)+fe,ve=(te+1)*(Te+1)+fe,Ue=te*(Te+1)+(fe+1),Se=(te+1)*(Te+1)+(fe+1),x.push(ce,ve,Ue),x.push(Se,Ue,ve);h!==1&&a&&(x.push(ce+2,ve+2,Ue+2),x.push(Se+2,Ue+2,ve+2),x.push(ce+4,ve+4,Ue+4),x.push(Se+4,Ue+4,ve+4)),te=o?te+2:te+1}const Ne=ce=>{const ve=ce?t/2:i/2;if(ve===0)return;let Ue,Se,ue;const Ze=ce?u[g-1]:u[0];let _t=null;d&&(_t=ce?d[g-1]:d[0]);const vt=E.length/3,Ot=ce?e/2:-e/2,$t=new v(0,Ot,0);E.push($t.x,$t.y,$t.z),R.push(0,ce?1:-1,0);const Ii=Ze.y+(Ze.w-Ze.y)*.5;C.push(Ze.x+(Ze.z-Ze.x)*.5,st.UseOpenGLOrientationForUV?1-Ii:Ii),_t&&_.push(_t.r,_t.g,_t.b,_t.a);const Gi=new me(.5,.5);for(ue=0;ue<=r;ue++){Ue=Math.PI*2*ue*h/r;const rs=Math.cos(-Ue),ss=Math.sin(-Ue);Se=new v(rs*ve,Ot,ss*ve);const Wi=new me(rs*Gi.x+.5,ss*Gi.y+.5);E.push(Se.x,Se.y,Se.z),R.push(0,ce?1:-1,0);const Xi=Ze.y+(Ze.w-Ze.y)*Wi.y;C.push(Ze.x+(Ze.z-Ze.x)*Wi.x,st.UseOpenGLOrientationForUV?1-Xi:Xi),_t&&_.push(_t.r,_t.g,_t.b,_t.a)}for(ue=0;ue<r;ue++)ce?(x.push(vt),x.push(vt+(ue+2)),x.push(vt+(ue+1))):(x.push(vt),x.push(vt+(ue+1)),x.push(vt+(ue+2)))};(l===k.CAP_START||l===k.CAP_ALL)&&Ne(!1),(l===k.CAP_END||l===k.CAP_ALL)&&Ne(!0),re._ComputeSides(c,E,x,R,C,n.frontUVs,n.backUVs);const Fe=new re;return Fe.indices=x,Fe.positions=E,Fe.normals=R,Fe.uvs=C,d&&(Fe.colors=_),Fe}function EI(n,e={},t){const i=new k(n,t);return e.sideOrientation=k._GetDefaultSideOrientation(e.sideOrientation),i._originalBuilderSideOrientation=e.sideOrientation,Pd(e).applyToMesh(i,e.updatable),i}re.CreateCylinder=Pd;k.CreateCylinder=(n,e,t,i,r,s,o,a,l)=>((o===void 0||!(o instanceof Pt))&&(o!==void 0&&(l=a||k.DEFAULTSIDE,a=o),o=s,s=1),EI(n,{height:e,diameterTop:t,diameterBottom:i,tessellation:r,subdivisions:s,sideOrientation:l,updatable:a},o));function Od(n){const e=[],t=[],i=[],r=[],s=n.diameter||1,o=n.thickness||.5,a=(n.tessellation||16)|0,l=n.sideOrientation===0?0:n.sideOrientation||re.DEFAULTSIDE,h=a+1;for(let u=0;u<=a;u++){const d=u/a,f=u*Math.PI*2/a-Math.PI/2,p=U.Translation(s/2,0,0).multiply(U.RotationY(f));for(let g=0;g<=a;g++){const m=1-g/a,x=g*Math.PI*2/a+Math.PI,E=Math.cos(x),R=Math.sin(x);let C=new v(E,R,0),_=C.scale(o/2);const T=new me(d,m);_=v.TransformCoordinates(_,p),C=v.TransformNormal(C,p),t.push(_.x,_.y,_.z),i.push(C.x,C.y,C.z),r.push(T.x,st.UseOpenGLOrientationForUV?1-T.y:T.y);const y=(u+1)%h,P=(g+1)%h;e.push(u*h+g),e.push(u*h+P),e.push(y*h+g),e.push(u*h+P),e.push(y*h+P),e.push(y*h+g)}}re._ComputeSides(l,t,e,i,r,n.frontUVs,n.backUVs);const c=new re;return c.indices=e,c.positions=t,c.normals=i,c.uvs=r,c}function TI(n,e={},t){const i=new k(n,t);return e.sideOrientation=k._GetDefaultSideOrientation(e.sideOrientation),i._originalBuilderSideOrientation=e.sideOrientation,Od(e).applyToMesh(i,e.updatable),i}re.CreateTorus=Od;k.CreateTorus=(n,e,t,i,r,s,o)=>TI(n,{diameter:e,thickness:t,tessellation:i,sideOrientation:o,updatable:s},r);function U0(n){const e=[],t=[],i=[],r=[],s=n.radius||2,o=n.tube||.5,a=n.radialSegments||32,l=n.tubularSegments||32,h=n.p||2,c=n.q||3,u=n.sideOrientation===0?0:n.sideOrientation||re.DEFAULTSIDE,d=m=>{const x=Math.cos(m),E=Math.sin(m),R=c/h*m,C=Math.cos(R),_=s*(2+C)*.5*x,T=s*(2+C)*E*.5,y=s*Math.sin(R)*.5;return new v(_,T,y)};let f,p;for(f=0;f<=a;f++){const m=f%a/a*2*h*Math.PI,x=d(m),E=d(m+.01),R=E.subtract(x);let C=E.add(x);const _=v.Cross(R,C);for(C=v.Cross(_,R),_.normalize(),C.normalize(),p=0;p<l;p++){const T=p%l/l*2*Math.PI,y=-o*Math.cos(T),P=o*Math.sin(T);t.push(x.x+y*C.x+P*_.x),t.push(x.y+y*C.y+P*_.y),t.push(x.z+y*C.z+P*_.z),r.push(f/a),r.push(st.UseOpenGLOrientationForUV?1-p/l:p/l)}}for(f=0;f<a;f++)for(p=0;p<l;p++){const m=(p+1)%l,x=f*l+p,E=(f+1)*l+p,R=(f+1)*l+m,C=f*l+m;e.push(C),e.push(E),e.push(x),e.push(C),e.push(R),e.push(E)}re.ComputeNormals(t,e,i),re._ComputeSides(u,t,e,i,r,n.frontUVs,n.backUVs);const g=new re;return g.indices=e,g.positions=t,g.normals=i,g.uvs=r,g}function xI(n,e={},t){const i=new k(n,t);return e.sideOrientation=k._GetDefaultSideOrientation(e.sideOrientation),i._originalBuilderSideOrientation=e.sideOrientation,U0(e).applyToMesh(i,e.updatable),i}re.CreateTorusKnot=U0;k.CreateTorusKnot=(n,e,t,i,r,s,o,a,l,h)=>xI(n,{radius:e,tube:t,radialSegments:i,tubularSegments:r,p:s,q:o,sideOrientation:h,updatable:l},a);function V0(n){const e=[],t=[],i=n.lines,r=n.colors,s=[];let o=0;for(let l=0;l<i.length;l++){const h=i[l];for(let c=0;c<h.length;c++){const{x:u,y:d,z:f}=h[c];if(t.push(u,d,f),r){const p=r[l],{r:g,g:m,b:x,a:E}=p[c];s.push(g,m,x,E)}c>0&&(e.push(o-1),e.push(o)),o++}}const a=new re;return a.indices=e,a.positions=t,r&&(a.colors=s),a}function B0(n){const e=n.dashSize||3,t=n.gapSize||1,i=n.dashNb||200,r=n.points,s=[],o=[],a=v.Zero();let l=0,h=0,c=0,u=0,d=0,f=0,p=0;for(p=0;p<r.length-1;p++)r[p+1].subtractToRef(r[p],a),l+=a.length();for(c=l/i,u=e*c/(e+t),p=0;p<r.length-1;p++){r[p+1].subtractToRef(r[p],a),h=Math.floor(a.length()/c),a.normalize();for(let m=0;m<h;m++)d=c*m,s.push(r[p].x+d*a.x,r[p].y+d*a.y,r[p].z+d*a.z),s.push(r[p].x+(d+u)*a.x,r[p].y+(d+u)*a.y,r[p].z+(d+u)*a.z),o.push(f,f+1),f+=2}const g=new re;return g.positions=s,g.indices=o,g}function CI(n,e,t=null){const i=e.instance,r=e.lines,s=e.colors;if(i){const l=i.getVerticesData(b.PositionKind);let h,c;s&&(h=i.getVerticesData(b.ColorKind));let u=0,d=0;for(let f=0;f<r.length;f++){const p=r[f];for(let g=0;g<p.length;g++)l[u]=p[g].x,l[u+1]=p[g].y,l[u+2]=p[g].z,s&&h&&(c=s[f],h[d]=c[g].r,h[d+1]=c[g].g,h[d+2]=c[g].b,h[d+3]=c[g].a,d+=4),u+=3}return i.updateVerticesData(b.PositionKind,l,!1,!1),s&&h&&i.updateVerticesData(b.ColorKind,h,!1,!1),i}const o=!!s,a=new wo(n,t,null,void 0,void 0,o,e.useVertexAlpha,e.material);return V0(e).applyToMesh(a,e.updatable),a}function RI(n,e,t=null){const i=e.colors?[e.colors]:null;return CI(n,{lines:[e.points],updatable:e.updatable,instance:e.instance,colors:i,useVertexAlpha:e.useVertexAlpha,material:e.material},t)}function SI(n,e,t=null){const i=e.points,r=e.instance,s=e.gapSize||1,o=e.dashSize||3;if(r){const l=h=>{const c=v.Zero(),u=h.length/6;let d=0,f=0,p=0,g=0,m=0,x=0,E=0,R=0;for(E=0;E<i.length-1;E++)i[E+1].subtractToRef(i[E],c),d+=c.length();p=d/u;const C=r._creationDataStorage.dashSize,_=r._creationDataStorage.gapSize;for(g=C*p/(C+_),E=0;E<i.length-1;E++)for(i[E+1].subtractToRef(i[E],c),f=Math.floor(c.length()/p),c.normalize(),R=0;R<f&&x<h.length;)m=p*R,h[x]=i[E].x+m*c.x,h[x+1]=i[E].y+m*c.y,h[x+2]=i[E].z+m*c.z,h[x+3]=i[E].x+(m+g)*c.x,h[x+4]=i[E].y+(m+g)*c.y,h[x+5]=i[E].z+(m+g)*c.z,x+=6,R++;for(;x<h.length;)h[x]=i[E].x,h[x+1]=i[E].y,h[x+2]=i[E].z,x+=3};return(e.dashNb||e.dashSize||e.gapSize||e.useVertexAlpha||e.material)&&oe.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),r.updateMeshPositions(l,!1),r}const a=new wo(n,t,null,void 0,void 0,void 0,e.useVertexAlpha,e.material);return B0(e).applyToMesh(a,e.updatable),a._creationDataStorage=new S0,a._creationDataStorage.dashSize=o,a._creationDataStorage.gapSize=s,a}re.CreateLineSystem=V0;re.CreateDashedLines=B0;k.CreateLines=(n,e,t=null,i=!1,r=null)=>RI(n,{points:e,updatable:i,instance:r},t);k.CreateDashedLines=(n,e,t,i,r,s=null,o,a)=>SI(n,{points:e,dashSize:t,gapSize:i,dashNb:r,updatable:o,instance:a},s);var So;(function(n){n[n.CW=0]="CW",n[n.CCW=1]="CCW"})(So||(So={}));class fs{constructor(e){this._radians=e,this._radians<0&&(this._radians+=2*Math.PI)}degrees(){return this._radians*180/Math.PI}radians(){return this._radians}static BetweenTwoPoints(e,t){const i=t.subtract(e),r=Math.atan2(i.y,i.x);return new fs(r)}static BetweenTwoVectors(e,t){let i=e.lengthSquared()*t.lengthSquared();if(i===0)return new fs(Math.PI/2);i=Math.sqrt(i);let r=e.dot(t)/i;r=Ye.Clamp(r,-1,1);const s=Math.acos(r);return new fs(s)}static FromRadians(e){return new fs(e)}static FromDegrees(e){return new fs(e*Math.PI/180)}}class yI{constructor(e,t,i){this.startPoint=e,this.midPoint=t,this.endPoint=i;const r=Math.pow(t.x,2)+Math.pow(t.y,2),s=(Math.pow(e.x,2)+Math.pow(e.y,2)-r)/2,o=(r-Math.pow(i.x,2)-Math.pow(i.y,2))/2,a=(e.x-t.x)*(t.y-i.y)-(t.x-i.x)*(e.y-t.y);this.centerPoint=new me((s*(t.y-i.y)-o*(e.y-t.y))/a,((e.x-t.x)*o-(t.x-i.x)*s)/a),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=fs.BetweenTwoPoints(this.centerPoint,this.startPoint);const l=this.startAngle.degrees();let h=fs.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),c=fs.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();h-l>180&&(h-=360),h-l<-180&&(h+=360),c-h>180&&(c-=360),c-h<-180&&(c+=360),this.orientation=h-l<0?So.CW:So.CCW,this.angle=fs.FromDegrees(this.orientation===So.CW?l-c:c-l)}}class Yh{constructor(e,t){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new me(e,t))}addLineTo(e,t){if(this.closed)return this;const i=new me(e,t),r=this._points[this._points.length-1];return this._points.push(i),this._length+=i.subtract(r).length(),this}addArcTo(e,t,i,r,s=36){if(this.closed)return this;const o=this._points[this._points.length-1],a=new me(e,t),l=new me(i,r),h=new yI(o,a,l);let c=h.angle.radians()/s;h.orientation===So.CW&&(c*=-1);let u=h.startAngle.radians()+c;for(let d=0;d<s;d++){const f=Math.cos(u)*h.radius+h.centerPoint.x,p=Math.sin(u)*h.radius+h.centerPoint.y;this.addLineTo(f,p),u+=c}return this}addQuadraticCurveTo(e,t,i,r,s=36){if(this.closed)return this;const o=(l,h,c,u)=>(1-l)*(1-l)*h+2*l*(1-l)*c+l*l*u,a=this._points[this._points.length-1];for(let l=0;l<=s;l++){const h=l/s,c=o(h,a.x,e,i),u=o(h,a.y,t,r);this.addLineTo(c,u)}return this}addBezierCurveTo(e,t,i,r,s,o,a=36){if(this.closed)return this;const l=(c,u,d,f,p)=>(1-c)*(1-c)*(1-c)*u+3*c*(1-c)*(1-c)*d+3*c*c*(1-c)*f+c*c*c*p,h=this._points[this._points.length-1];for(let c=0;c<=a;c++){const u=c/a,d=l(u,h.x,e,i,s),f=l(u,h.y,t,r,o);this.addLineTo(d,f)}return this}isPointInside(e){let t=!1;const i=this._points.length;for(let r=i-1,s=0;s<i;r=s++){let o=this._points[r],a=this._points[s],l=a.x-o.x,h=a.y-o.y;if(Math.abs(h)>Number.EPSILON){if(h<0&&(o=this._points[s],l=-l,a=this._points[r],h=-h),e.y<o.y||e.y>a.y)continue;if(e.y===o.y&&e.x===o.x)return!0;{const c=h*(e.x-o.x)-l*(e.y-o.y);if(c===0)return!0;if(c<0)continue;t=!t}}else{if(e.y!==o.y)continue;if(a.x<=e.x&&e.x<=o.x||o.x<=e.x&&e.x<=a.x)return!0}}return t}close(){return this.closed=!0,this}length(){let e=this._length;if(this.closed){const t=this._points[this._points.length-1],i=this._points[0];e+=i.subtract(t).length()}return e}area(){const e=this._points.length;let t=0;for(let i=e-1,r=0;r<e;i=r++)t+=this._points[i].x*this._points[r].y-this._points[r].x*this._points[i].y;return t*.5}getPoints(){return this._points}getPointAtLengthPosition(e){if(e<0||e>1)return me.Zero();const t=e*this.length();let i=0;for(let r=0;r<this._points.length;r++){const s=(r+1)%this._points.length,o=this._points[r],a=this._points[s].subtract(o),l=a.length()+i;if(t>=i&&t<=l){const h=a.normalize(),c=t-i;return new me(o.x+h.x*c,o.y+h.y*c)}i=l}return me.Zero()}static StartingAt(e,t){return new Yh(e,t)}}class ba{constructor(e,t=null,i,r=!1){this.path=e,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array,this._pointAtData={id:0,point:v.Zero(),previousPointArrayIndex:0,position:0,subPosition:0,interpolateReady:!1,interpolationMatrix:U.Identity()};for(let s=0;s<e.length;s++)this._curve[s]=e[s].clone();this._raw=i||!1,this._alignTangentsWithPath=r,this._compute(t,r)}getCurve(){return this._curve}getPoints(){return this._curve}length(){return this._distances[this._distances.length-1]}getTangents(){return this._tangents}getNormals(){return this._normals}getBinormals(){return this._binormals}getDistances(){return this._distances}getPointAt(e){return this._updatePointAtData(e).point}getTangentAt(e,t=!1){return this._updatePointAtData(e,t),t?v.TransformCoordinates(v.Forward(),this._pointAtData.interpolationMatrix):this._tangents[this._pointAtData.previousPointArrayIndex]}getNormalAt(e,t=!1){return this._updatePointAtData(e,t),t?v.TransformCoordinates(v.Right(),this._pointAtData.interpolationMatrix):this._normals[this._pointAtData.previousPointArrayIndex]}getBinormalAt(e,t=!1){return this._updatePointAtData(e,t),t?v.TransformCoordinates(v.UpReadOnly,this._pointAtData.interpolationMatrix):this._binormals[this._pointAtData.previousPointArrayIndex]}getDistanceAt(e){return this.length()*e}getPreviousPointIndexAt(e){return this._updatePointAtData(e),this._pointAtData.previousPointArrayIndex}getSubPositionAt(e){return this._updatePointAtData(e),this._pointAtData.subPosition}getClosestPositionTo(e){let t=Number.MAX_VALUE,i=0;for(let r=0;r<this._curve.length-1;r++){const s=this._curve[r+0],o=this._curve[r+1].subtract(s).normalize(),a=this._distances[r+1]-this._distances[r+0],l=Math.min(Math.max(v.Dot(o,e.subtract(s).normalize()),0)*v.Distance(s,e)/a,1),h=v.Distance(s.add(o.scale(l*a)),e);h<t&&(t=h,i=(this._distances[r+0]+a*l)/this.length())}return i}slice(e=0,t=1){if(e<0&&(e=1-e*-1%1),t<0&&(t=1-t*-1%1),e>t){const h=e;e=t,t=h}const i=this.getCurve(),r=this.getPointAt(e);let s=this.getPreviousPointIndexAt(e);const o=this.getPointAt(t),a=this.getPreviousPointIndexAt(t)+1,l=[];return e!==0&&(s++,l.push(r)),l.push(...i.slice(s,a)),(t!==1||e===1)&&l.push(o),new ba(l,this.getNormalAt(e),this._raw,this._alignTangentsWithPath)}update(e,t=null,i=!1){for(let r=0;r<e.length;r++)this._curve[r].x=e[r].x,this._curve[r].y=e[r].y,this._curve[r].z=e[r].z;return this._compute(t,i),this}_compute(e,t=!1){const i=this._curve.length;if(i<2)return;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[i-1]=this._curve[i-1].subtract(this._curve[i-2]),this._raw||this._tangents[i-1].normalize();const r=this._tangents[0],s=this._normalVector(r,e);this._normals[0]=s,this._raw||this._normals[0].normalize(),this._binormals[0]=v.Cross(r,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;let o,a,l,h,c;for(let u=1;u<i;u++)o=this._getLastNonNullVector(u),u<i-1&&(a=this._getFirstNonNullVector(u),this._tangents[u]=t?a:o.add(a),this._tangents[u].normalize()),this._distances[u]=this._distances[u-1]+this._curve[u].subtract(this._curve[u-1]).length(),l=this._tangents[u],c=this._binormals[u-1],this._normals[u]=v.Cross(c,l),this._raw||(this._normals[u].length()===0?(h=this._normals[u-1],this._normals[u]=h.clone()):this._normals[u].normalize()),this._binormals[u]=v.Cross(l,this._normals[u]),this._raw||this._binormals[u].normalize();this._pointAtData.id=NaN}_getFirstNonNullVector(e){let t=1,i=this._curve[e+t].subtract(this._curve[e]);for(;i.length()===0&&e+t+1<this._curve.length;)t++,i=this._curve[e+t].subtract(this._curve[e]);return i}_getLastNonNullVector(e){let t=1,i=this._curve[e].subtract(this._curve[e-t]);for(;i.length()===0&&e>t+1;)t++,i=this._curve[e].subtract(this._curve[e-t]);return i}_normalVector(e,t){let i,r=e.length();if(r===0&&(r=1),t==null){let s;Ye.WithinEpsilon(Math.abs(e.y)/r,1,xt)?Ye.WithinEpsilon(Math.abs(e.x)/r,1,xt)?Ye.WithinEpsilon(Math.abs(e.z)/r,1,xt)?s=v.Zero():s=new v(0,0,1):s=new v(1,0,0):s=new v(0,-1,0),i=v.Cross(e,s)}else i=v.Cross(e,t),v.CrossToRef(i,e,i);return i.normalize(),i}_updatePointAtData(e,t=!1){if(this._pointAtData.id===e)return this._pointAtData.interpolateReady||this._updateInterpolationMatrix(),this._pointAtData;this._pointAtData.id=e;const i=this.getPoints();if(e<=0)return this._setPointAtData(0,0,i[0],0,t);if(e>=1)return this._setPointAtData(1,1,i[i.length-1],i.length-1,t);let r=i[0],s,o=0;const a=e*this.length();for(let l=1;l<i.length;l++){s=i[l];const h=v.Distance(r,s);if(o+=h,o===a)return this._setPointAtData(e,1,s,l,t);if(o>a){const c=(o-a)/h,u=r.subtract(s),d=s.add(u.scaleInPlace(c));return this._setPointAtData(e,1-c,d,l-1,t)}r=s}return this._pointAtData}_setPointAtData(e,t,i,r,s){return this._pointAtData.point=i,this._pointAtData.position=e,this._pointAtData.subPosition=t,this._pointAtData.previousPointArrayIndex=r,this._pointAtData.interpolateReady=s,s&&this._updateInterpolationMatrix(),this._pointAtData}_updateInterpolationMatrix(){this._pointAtData.interpolationMatrix=U.Identity();const e=this._pointAtData.previousPointArrayIndex;if(e!==this._tangents.length-1){const t=e+1,i=this._tangents[e].clone(),r=this._normals[e].clone(),s=this._binormals[e].clone(),o=this._tangents[t].clone(),a=this._normals[t].clone(),l=this._binormals[t].clone(),h=Re.RotationQuaternionFromAxis(r,s,i),c=Re.RotationQuaternionFromAxis(a,l,o);Re.Slerp(h,c,this._pointAtData.subPosition).toRotationMatrix(this._pointAtData.interpolationMatrix)}}}class Ls{static CreateQuadraticBezier(e,t,i,r){r=r>2?r:3;const s=[],o=(a,l,h,c)=>(1-a)*(1-a)*l+2*a*(1-a)*h+a*a*c;for(let a=0;a<=r;a++)s.push(new v(o(a/r,e.x,t.x,i.x),o(a/r,e.y,t.y,i.y),o(a/r,e.z,t.z,i.z)));return new Ls(s)}static CreateCubicBezier(e,t,i,r,s){s=s>3?s:4;const o=[],a=(l,h,c,u,d)=>(1-l)*(1-l)*(1-l)*h+3*l*(1-l)*(1-l)*c+3*l*l*(1-l)*u+l*l*l*d;for(let l=0;l<=s;l++)o.push(new v(a(l/s,e.x,t.x,i.x,r.x),a(l/s,e.y,t.y,i.y,r.y),a(l/s,e.z,t.z,i.z,r.z)));return new Ls(o)}static CreateHermiteSpline(e,t,i,r,s){const o=[],a=1/s;for(let l=0;l<=s;l++)o.push(v.Hermite(e,t,i,r,l*a));return new Ls(o)}static CreateCatmullRomSpline(e,t,i){const r=[],s=1/t;let o=0;if(i){const a=e.length;for(let l=0;l<a;l++){o=0;for(let h=0;h<t;h++)r.push(v.CatmullRom(e[l%a],e[(l+1)%a],e[(l+2)%a],e[(l+3)%a],o)),o+=s}r.push(r[0])}else{const a=[];a.push(e[0].clone()),Array.prototype.push.apply(a,e),a.push(e[e.length-1].clone());let l=0;for(;l<a.length-3;l++){o=0;for(let h=0;h<t;h++)r.push(v.CatmullRom(a[l],a[l+1],a[l+2],a[l+3],o)),o+=s}l--,r.push(v.CatmullRom(a[l],a[l+1],a[l+2],a[l+3],o))}return new Ls(r)}static ArcThru3Points(e,t,i,r=32,s=!1,o=!1){const a=[],l=t.subtract(e),h=i.subtract(t),c=e.subtract(i),u=v.Cross(l,h),d=u.length();if(d<Math.pow(10,-8))return new Ls(a);const f=l.lengthSquared(),p=h.lengthSquared(),g=c.lengthSquared(),m=u.lengthSquared(),x=l.length(),E=h.length(),R=c.length(),C=.5*x*E*R/d,_=v.Dot(l,c),T=v.Dot(l,h),y=v.Dot(h,c),P=-.5*p*_/m,D=-.5*g*T/m,F=-.5*f*y/m,N=e.scale(P).add(t.scale(D)).add(i.scale(F)),G=e.subtract(N).normalize(),J=v.Cross(u,G).normalize();if(o){const j=2*Math.PI/r;for(let z=0;z<=2*Math.PI;z+=j)a.push(N.add(G.scale(C*Math.cos(z)).add(J.scale(C*Math.sin(z)))));a.push(e)}else{const j=1/r;let z=0,$=v.Zero();do $=N.add(G.scale(C*Math.cos(z)).add(J.scale(C*Math.sin(z)))),a.push($),z+=j;while(!$.equalsWithEpsilon(i,C*j*1.1));a.push(i),s&&a.push(e)}return new Ls(a)}constructor(e){this._length=0,this._points=e,this._length=this._computeLength(e)}getPoints(){return this._points}length(){return this._length}continue(e){const t=this._points[this._points.length-1],i=this._points.slice(),r=e.getPoints();for(let s=1;s<r.length;s++)i.push(r[s].subtract(r[0]).add(t));return new Ls(i)}_computeLength(e){let t=0;for(let i=1;i<e.length;i++)t+=e[i].subtract(e[i-1]).length();return t}}class bI extends me{constructor(e,t){super(e.x,e.y),this.index=t}}class tu{constructor(){this.elements=[]}add(e){const t=[];return e.forEach(i=>{const r=new bI(i,this.elements.length);t.push(r),this.elements.push(r)}),t}computeBounds(){const e=new me(this.elements[0].x,this.elements[0].y),t=new me(this.elements[0].x,this.elements[0].y);return this.elements.forEach(i=>{i.x<e.x?e.x=i.x:i.x>t.x&&(t.x=i.x),i.y<e.y?e.y=i.y:i.y>t.y&&(t.y=i.y)}),{min:e,max:t,width:t.x-e.x,height:t.y-e.y}}}class II{_addToepoint(e){for(const t of e)this._epoints.push(t.x,t.y)}constructor(e,t,i,r=earcut){this._points=new tu,this._outlinepoints=new tu,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=r,this._name=e,this._scene=i||rt.LastCreatedScene;let s;t instanceof Yh?s=t.getPoints():s=t,this._addToepoint(s),this._points.add(s),this._outlinepoints.add(s),typeof this.bjsEarcut>"u"&&oe.Warn("Earcut was not found, the polygon will not be built.")}addHole(e){this._points.add(e);const t=new tu;return t.add(e),this._holes.push(t),this._eholes.push(this._epoints.length/2),this._addToepoint(e),this}build(e=!1,t=0,i=2){const r=new k(this._name,this._scene),s=this.buildVertexData(t,i);return r.setVerticesData(b.PositionKind,s.positions,e),r.setVerticesData(b.NormalKind,s.normals,e),r.setVerticesData(b.UVKind,s.uvs,e),r.setIndices(s.indices),r}buildVertexData(e=0,t=2){const i=new re,r=[],s=[],o=[],a=this._points.computeBounds();this._points.elements.forEach(c=>{r.push(0,1,0),s.push(c.x,0,c.y),o.push((c.x-a.min.x)/a.width,(c.y-a.min.y)/a.height)});const l=[],h=this.bjsEarcut(this._epoints,this._eholes,2);for(let c=0;c<h.length;c++)l.push(h[c]);if(e>0){const c=s.length/3;this._points.elements.forEach(d=>{r.push(0,-1,0),s.push(d.x,-e,d.y),o.push(1-(d.x-a.min.x)/a.width,1-(d.y-a.min.y)/a.height)});const u=l.length;for(let d=0;d<u;d+=3){const f=l[d+0],p=l[d+1],g=l[d+2];l.push(g+c),l.push(p+c),l.push(f+c)}this._addSide(s,r,o,l,a,this._outlinepoints,e,!1,t),this._holes.forEach(d=>{this._addSide(s,r,o,l,a,d,e,!0,t)})}return i.indices=l,i.positions=s,i.normals=r,i.uvs=o,i}_addSide(e,t,i,r,s,o,a,l,h){let c=e.length/3,u=0;for(let d=0;d<o.elements.length;d++){const f=o.elements[d],p=o.elements[(d+1)%o.elements.length];e.push(f.x,0,f.y),e.push(f.x,-a,f.y),e.push(p.x,0,p.y),e.push(p.x,-a,p.y);const g=o.elements[(d+o.elements.length-1)%o.elements.length],m=o.elements[(d+2)%o.elements.length];let x=new v(-(p.y-f.y),0,p.x-f.x),E=new v(-(f.y-g.y),0,f.x-g.x),R=new v(-(m.y-p.y),0,m.x-p.x);l||(x=x.scale(-1),E=E.scale(-1),R=R.scale(-1));const C=x.normalizeToNew();let _=E.normalizeToNew(),T=R.normalizeToNew();const y=v.Dot(_,C);y>h?y<xt-1?_=new v(f.x,0,f.y).subtract(new v(p.x,0,p.y)).normalize():_=E.add(x).normalize():_=C;const P=v.Dot(R,x);P>h?P<xt-1?T=new v(p.x,0,p.y).subtract(new v(f.x,0,f.y)).normalize():T=R.add(x).normalize():T=C,i.push(u/s.width,0),i.push(u/s.width,1),u+=x.length(),i.push(u/s.width,0),i.push(u/s.width,1),t.push(_.x,_.y,_.z),t.push(_.x,_.y,_.z),t.push(T.x,T.y,T.z),t.push(T.x,T.y,T.z),l?(r.push(c),r.push(c+2),r.push(c+1),r.push(c+1),r.push(c+2),r.push(c+3)):(r.push(c),r.push(c+1),r.push(c+2),r.push(c+1),r.push(c+3),r.push(c+2)),c+=4}}}function k0(n,e,t,i,r,s,o){const a=t||new Array(3),l=i,h=[],c=o||!1;for(let D=0;D<3;D++)a[D]===void 0&&(a[D]=new Ke(0,0,1,1)),l&&l[D]===void 0&&(l[D]=new $e(1,1,1,1));const u=n.getVerticesData(b.PositionKind),d=n.getVerticesData(b.NormalKind),f=n.getVerticesData(b.UVKind),p=n.getIndices(),g=u.length/9;let m=0,x=0,E=0,R=0,C=0;const _=[0];if(c)for(let D=g;D<u.length/3;D+=4)x=u[3*(D+2)]-u[3*D],E=u[3*(D+2)+2]-u[3*D+2],R=Math.sqrt(x*x+E*E),C+=R,_.push(C);let T=0,y=0;for(let D=0;D<d.length;D+=3)Math.abs(d[D+1])<.001&&(y=1),Math.abs(d[D+1]-1)<.001&&(y=0),Math.abs(d[D+1]+1)<.001&&(y=2),T=D/3,y===1?(m=T-g,m%4<1.5?c?f[2*T]=a[y].x+(a[y].z-a[y].x)*_[Math.floor(m/4)]/C:f[2*T]=a[y].x:c?f[2*T]=a[y].x+(a[y].z-a[y].x)*_[Math.floor(m/4)+1]/C:f[2*T]=a[y].z,m%2===0?f[2*T+1]=st.UseOpenGLOrientationForUV?1-a[y].w:a[y].w:f[2*T+1]=st.UseOpenGLOrientationForUV?1-a[y].y:a[y].y):(f[2*T]=(1-f[2*T])*a[y].x+f[2*T]*a[y].z,f[2*T+1]=(1-f[2*T+1])*a[y].y+f[2*T+1]*a[y].w,st.UseOpenGLOrientationForUV&&(f[2*T+1]=1-f[2*T+1])),l&&h.push(l[y].r,l[y].g,l[y].b,l[y].a);re._ComputeSides(e,u,p,d,f,r,s);const P=new re;if(P.indices=p,P.positions=u,P.normals=d,P.uvs=f,l){const D=e===re.DOUBLESIDE?h.concat(h):h;P.colors=D}return P}function z0(n,e,t=null,i=earcut){e.sideOrientation=k._GetDefaultSideOrientation(e.sideOrientation);const r=e.shape,s=e.holes||[],o=e.depth||0,a=e.smoothingThreshold||2,l=[];let h=[];for(let f=0;f<r.length;f++)l[f]=new me(r[f].x,r[f].z);l[0].equalsWithEpsilon(l[l.length-1],1e-8)&&l.pop();const u=new II(n,l,t||rt.LastCreatedScene,i);for(let f=0;f<s.length;f++){h=[];for(let p=0;p<s[f].length;p++)h.push(new me(s[f][p].x,s[f][p].z));u.addHole(h)}const d=u.build(!1,o,a);return d._originalBuilderSideOrientation=e.sideOrientation,k0(d,e.sideOrientation,e.faceUV,e.faceColors,e.frontUVs,e.backUVs,e.wrap).applyToMesh(d,e.updatable),d}function AI(n,e,t=null,i=earcut){return z0(n,e,t,i)}re.CreatePolygon=k0;k.CreatePolygon=(n,e,t,i,r,s,o=earcut)=>z0(n,{shape:e,holes:i,updatable:r,sideOrientation:s},t,o);k.ExtrudePolygon=(n,e,t,i,r,s,o,a=earcut)=>AI(n,{shape:e,holes:r,depth:t,updatable:s,sideOrientation:o},i,a);function MI(n,e,t=null){const i=e.path,r=e.shape,s=e.scale||1,o=e.rotation||0,a=e.cap===0?0:e.cap||k.NO_CAP,l=e.updatable,h=k._GetDefaultSideOrientation(e.sideOrientation),c=e.instance||null,u=e.invertUV||!1,d=e.closeShape||!1,f=e.closePath||!1;return G0(n,r,i,s,o,null,null,f,d,a,!1,t,!!l,h,c,u,e.frontUVs||null,e.backUVs||null,e.firstNormal||null,!!e.adjustFrame)}function PI(n,e,t=null){const i=e.path,r=e.shape,s=e.scaleFunction||(()=>1),o=e.rotationFunction||(()=>0),a=e.closePath||e.ribbonCloseArray||!1,l=e.closeShape||e.ribbonClosePath||!1,h=e.cap===0?0:e.cap||k.NO_CAP,c=e.updatable,u=e.firstNormal||null,d=e.adjustFrame||!1,f=k._GetDefaultSideOrientation(e.sideOrientation),p=e.instance,g=e.invertUV||!1;return G0(n,r,i,null,null,s,o,a,l,h,!0,t,!!c,f,p||null,g,e.frontUVs||null,e.backUVs||null,u,d)}function G0(n,e,t,i,r,s,o,a,l,h,c,u,d,f,p,g,m,x,E,R){const C=(D,F,N,G,J,j,z,$,te,fe,Z)=>{const L=N.getTangents(),w=N.getNormals(),H=N.getBinormals(),de=N.getDistances();if(Z){for(let ue=0;ue<L.length;ue++)if(L[ue].x==0&&L[ue].y==0&&L[ue].z==0&&L[ue].copyFrom(L[ue-1]),w[ue].x==0&&w[ue].y==0&&w[ue].z==0&&w[ue].copyFrom(w[ue-1]),H[ue].x==0&&H[ue].y==0&&H[ue].z==0&&H[ue].copyFrom(H[ue-1]),ue>0){let Ze=L[ue-1];v.Dot(Ze,L[ue])<0&&L[ue].scaleInPlace(-1),Ze=w[ue-1],v.Dot(Ze,w[ue])<0&&w[ue].scaleInPlace(-1),Ze=H[ue-1],v.Dot(Ze,H[ue])<0&&H[ue].scaleInPlace(-1)}}let Te=0;const Ne=()=>J!==null?J:1,Fe=fe&&$?$:()=>j!==null?j:0,ce=fe&&z?z:Ne;let ve=te===k.NO_CAP||te===k.CAP_END?0:2;const Ue=W.Matrix[0];for(let ue=0;ue<F.length;ue++){const Ze=[],_t=Fe(ue,de[ue]),vt=ce(ue,de[ue]);U.RotationAxisToRef(L[ue],Te,Ue);for(let Ot=0;Ot<D.length;Ot++){const $t=L[ue].scale(D[Ot].z).add(w[ue].scale(D[Ot].x)).add(H[ue].scale(D[Ot].y)),Ii=v.Zero();v.TransformCoordinatesToRef($t,Ue,Ii),Ii.scaleInPlace(vt).addInPlace(F[ue]),Ze[Ot]=Ii}G[ve]=Ze,Te+=_t,ve++}const Se=ue=>{const Ze=Array(),_t=v.Zero();let vt;for(vt=0;vt<ue.length;vt++)_t.addInPlace(ue[vt]);for(_t.scaleInPlace(1/ue.length),vt=0;vt<ue.length;vt++)Ze.push(_t);return Ze};switch(te){case k.NO_CAP:break;case k.CAP_START:G[0]=Se(G[2]),G[1]=G[2];break;case k.CAP_END:G[ve]=G[ve-1],G[ve+1]=Se(G[ve-1]);break;case k.CAP_ALL:G[0]=Se(G[2]),G[1]=G[2],G[ve]=G[ve-1],G[ve+1]=Se(G[ve-1]);break}return G};let _,T;if(p){const D=p._creationDataStorage;return _=E?D.path3D.update(t,E):D.path3D.update(t),T=C(e,t,D.path3D,D.pathArray,i,r,s,o,D.cap,c,R),p=Uo("",{pathArray:T,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:p},u||void 0),p}_=E?new ba(t,E):new ba(t);const y=new Array;h=h<0||h>3?0:h,T=C(e,t,_,y,i,r,s,o,h,c,R);const P=Uo(n,{pathArray:T,closeArray:a,closePath:l,updatable:d,sideOrientation:f,invertUV:g,frontUVs:m||void 0,backUVs:x||void 0},u);return P._creationDataStorage.pathArray=T,P._creationDataStorage.path3D=_,P._creationDataStorage.cap=h,P}k.ExtrudeShape=(n,e,t,i,r,s,o=null,a,l,h)=>{const c={shape:e,path:t,scale:i,rotation:r,cap:s===0?0:s||k.NO_CAP,sideOrientation:l,instance:h,updatable:a};return MI(n,c,o)};k.ExtrudeShapeCustom=(n,e,t,i,r,s,o,a,l,h,c,u)=>{const d={shape:e,path:t,scaleFunction:i,rotationFunction:r,ribbonCloseArray:s,ribbonClosePath:o,cap:a===0?0:a||k.NO_CAP,sideOrientation:c,instance:u,updatable:h};return PI(n,d,l)};function OI(n,e,t=null){const i=e.arc?e.arc<=0||e.arc>1?1:e.arc:1,r=e.closed===void 0?!0:e.closed,s=e.shape,o=e.radius||1,a=e.tessellation||64,l=e.clip||0,h=e.updatable,c=k._GetDefaultSideOrientation(e.sideOrientation),u=e.cap||k.NO_CAP,d=Math.PI*2,f=[],p=e.invertUV||!1;let g=0,m=0;const x=d/a*i;let E,R;for(g=0;g<=a-l;g++){for(R=[],(u==k.CAP_START||u==k.CAP_ALL)&&(R.push(new v(0,s[0].y,0)),R.push(new v(Math.cos(g*x)*s[0].x*o,s[0].y,Math.sin(g*x)*s[0].x*o))),m=0;m<s.length;m++)E=new v(Math.cos(g*x)*s[m].x*o,s[m].y,Math.sin(g*x)*s[m].x*o),R.push(E);(u==k.CAP_END||u==k.CAP_ALL)&&(R.push(new v(Math.cos(g*x)*s[s.length-1].x*o,s[s.length-1].y,Math.sin(g*x)*s[s.length-1].x*o)),R.push(new v(0,s[s.length-1].y,0))),f.push(R)}return Uo(n,{pathArray:f,closeArray:r,sideOrientation:c,updatable:h,invertUV:p,frontUVs:e.frontUVs,backUVs:e.backUVs},t)}k.CreateLathe=(n,e,t,i,r,s,o)=>OI(n,{shape:e,radius:t,tessellation:i,sideOrientation:o,updatable:s},r);function Dd(n){const e=[],t=[],i=[],r=[],s=n.width||n.size||1,o=n.height||n.size||1,a=n.sideOrientation===0?0:n.sideOrientation||re.DEFAULTSIDE,l=s/2,h=o/2;t.push(-l,-h,0),i.push(0,0,-1),r.push(0,st.UseOpenGLOrientationForUV?1:0),t.push(l,-h,0),i.push(0,0,-1),r.push(1,st.UseOpenGLOrientationForUV?1:0),t.push(l,h,0),i.push(0,0,-1),r.push(1,st.UseOpenGLOrientationForUV?0:1),t.push(-l,h,0),i.push(0,0,-1),r.push(0,st.UseOpenGLOrientationForUV?0:1),e.push(0),e.push(1),e.push(2),e.push(0),e.push(2),e.push(3),re._ComputeSides(a,t,e,i,r,n.frontUVs,n.backUVs);const c=new re;return c.indices=e,c.positions=t,c.normals=i,c.uvs=r,c}function DI(n,e={},t=null){const i=new k(n,t);return e.sideOrientation=k._GetDefaultSideOrientation(e.sideOrientation),i._originalBuilderSideOrientation=e.sideOrientation,Dd(e).applyToMesh(i,e.updatable),e.sourcePlane&&(i.translate(e.sourcePlane.normal,-e.sourcePlane.d),i.setDirection(e.sourcePlane.normal.scale(-1))),i}re.CreatePlane=Dd;k.CreatePlane=(n,e,t,i,r)=>DI(n,{size:e,width:e,height:e,sideOrientation:r,updatable:i},t);function NI(n,e,t=null){const i=e.path;let r=e.instance,s=1;e.radius!==void 0?s=e.radius:r&&(s=r._creationDataStorage.radius);const o=e.tessellation||64,a=e.radiusFunction||null;let l=e.cap||k.NO_CAP;const h=e.invertUV||!1,c=e.updatable,u=k._GetDefaultSideOrientation(e.sideOrientation);e.arc=e.arc&&(e.arc<=0||e.arc>1)?1:e.arc||1;const d=(x,E,R,C,_,T,y,P)=>{const D=E.getTangents(),F=E.getNormals(),N=E.getDistances(),G=Math.PI*2/_*P,J=T||(()=>C);let j,z,$,te;const fe=W.Matrix[0];let Z=y===k.NO_CAP||y===k.CAP_END?0:2;for(let w=0;w<x.length;w++){z=J(w,N[w]),j=Array(),$=F[w];for(let H=0;H<_;H++)U.RotationAxisToRef(D[w],G*H,fe),te=j[H]?j[H]:v.Zero(),v.TransformCoordinatesToRef($,fe,te),te.scaleInPlace(z).addInPlace(x[w]),j[H]=te;R[Z]=j,Z++}const L=(w,H)=>{const de=Array();for(let Te=0;Te<w;Te++)de.push(x[H]);return de};switch(y){case k.NO_CAP:break;case k.CAP_START:R[0]=L(_,0),R[1]=R[2].slice(0);break;case k.CAP_END:R[Z]=R[Z-1].slice(0),R[Z+1]=L(_,x.length-1);break;case k.CAP_ALL:R[0]=L(_,0),R[1]=R[2].slice(0),R[Z]=R[Z-1].slice(0),R[Z+1]=L(_,x.length-1);break}return R};let f,p;if(r){const x=r._creationDataStorage,E=e.arc||x.arc;return f=x.path3D.update(i),p=d(i,f,x.pathArray,s,x.tessellation,a,x.cap,E),r=Uo("",{pathArray:p,instance:r}),x.path3D=f,x.pathArray=p,x.arc=E,x.radius=s,r}f=new ba(i);const g=new Array;l=l<0||l>3?0:l,p=d(i,f,g,s,o,a,l,e.arc);const m=Uo(n,{pathArray:p,closePath:!0,closeArray:!1,updatable:c,sideOrientation:u,invertUV:h,frontUVs:e.frontUVs,backUVs:e.backUVs},t);return m._creationDataStorage.pathArray=p,m._creationDataStorage.path3D=f,m._creationDataStorage.tessellation=o,m._creationDataStorage.cap=l,m._creationDataStorage.arc=e.arc,m._creationDataStorage.radius=s,m}k.CreateTube=(n,e,t,i,r,s,o,a,l,h)=>NI(n,{path:e,radius:t,tessellation:i,radiusFunction:r,arc:1,cap:s,updatable:a,sideOrientation:l,instance:h},o);function W0(n){const e=[];e[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},e[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},e[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},e[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},e[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},e[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},e[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},e[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},e[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},e[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},e[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},e[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},e[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},e[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},e[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const t=n.type&&(n.type<0||n.type>=e.length)?0:n.type||0,i=n.size,r=n.sizeX||i||1,s=n.sizeY||i||1,o=n.sizeZ||i||1,a=n.custom||e[t],l=a.face.length,h=n.faceUV||new Array(l),c=n.faceColors,u=n.flat===void 0?!0:n.flat,d=n.sideOrientation===0?0:n.sideOrientation||re.DEFAULTSIDE,f=[],p=[],g=[],m=[],x=[];let E=0,R=0;const C=[];let _=0,T=0,y,P,D,F,N,G;if(u)for(T=0;T<l;T++)c&&c[T]===void 0&&(c[T]=new $e(1,1,1,1)),h&&h[T]===void 0&&(h[T]=new Ke(0,0,1,1));if(u)for(T=0;T<l;T++){const j=a.face[T].length;for(D=2*Math.PI/j,F=.5*Math.tan(D/2),N=.5,_=0;_<j;_++)f.push(a.vertex[a.face[T][_]][0]*r,a.vertex[a.face[T][_]][1]*s,a.vertex[a.face[T][_]][2]*o),C.push(E),E++,y=h[T].x+(h[T].z-h[T].x)*(.5+F),P=h[T].y+(h[T].w-h[T].y)*(N-.5),m.push(y,st.UseOpenGLOrientationForUV?1-P:P),G=F*Math.cos(D)-N*Math.sin(D),N=F*Math.sin(D)+N*Math.cos(D),F=G,c&&x.push(c[T].r,c[T].g,c[T].b,c[T].a);for(_=0;_<j-2;_++)p.push(C[0+R],C[_+2+R],C[_+1+R]);R+=j}else{for(_=0;_<a.vertex.length;_++)f.push(a.vertex[_][0]*r,a.vertex[_][1]*s,a.vertex[_][2]*o),m.push(0,st.UseOpenGLOrientationForUV?1:0);for(T=0;T<l;T++)for(_=0;_<a.face[T].length-2;_++)p.push(a.face[T][0],a.face[T][_+2],a.face[T][_+1])}re.ComputeNormals(f,p,g),re._ComputeSides(d,f,p,g,m,n.frontUVs,n.backUVs);const J=new re;return J.positions=f,J.indices=p,J.normals=g,J.uvs=m,c&&u&&(J.colors=x),J}function FI(n,e={},t=null){const i=new k(n,t);return e.sideOrientation=k._GetDefaultSideOrientation(e.sideOrientation),i._originalBuilderSideOrientation=e.sideOrientation,W0(e).applyToMesh(i,e.updatable),i}re.CreatePolyhedron=W0;k.CreatePolyhedron=(n,e,t)=>FI(n,e,t);function Nd(n){const e=n.sideOrientation||re.DEFAULTSIDE,t=n.radius||1,i=n.flat===void 0?!0:n.flat,r=(n.subdivisions||4)|0,s=n.radiusX||t,o=n.radiusY||t,a=n.radiusZ||t,l=(1+Math.sqrt(5))/2,h=[-1,l,-0,1,l,0,-1,-l,0,1,-l,0,0,-1,-l,0,1,-l,0,-1,l,0,1,l,l,0,1,l,0,-1,-l,0,1,-l,0,-1],c=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],u=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],d=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],f=138/1024,p=239/1024,g=60/1024,m=26/1024,x=-40/1024,E=20/1024,R=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],C=[],_=[],T=[],y=[];let P=0;const D=new Array(3),F=new Array(3);let N;for(N=0;N<3;N++)D[N]=v.Zero(),F[N]=me.Zero();for(let J=0;J<20;J++){for(N=0;N<3;N++){const z=c[3*J+N];D[N].copyFromFloats(h[3*u[z]],h[3*u[z]+1],h[3*u[z]+2]),D[N].normalize(),F[N].copyFromFloats(d[2*z]*f+g+R[J]*x,d[2*z+1]*p+m+R[J]*E)}const j=(z,$,te,fe)=>{const Z=v.Lerp(D[0],D[2],$/r),L=v.Lerp(D[1],D[2],$/r),w=r===$?D[2]:v.Lerp(Z,L,z/(r-$));w.normalize();let H;if(i){const Fe=v.Lerp(D[0],D[2],fe/r),ce=v.Lerp(D[1],D[2],fe/r);H=v.Lerp(Fe,ce,te/(r-fe))}else H=new v(w.x,w.y,w.z);H.x/=s,H.y/=o,H.z/=a,H.normalize();const de=me.Lerp(F[0],F[2],$/r),Te=me.Lerp(F[1],F[2],$/r),Ne=r===$?F[2]:me.Lerp(de,Te,z/(r-$));_.push(w.x*s,w.y*o,w.z*a),T.push(H.x,H.y,H.z),y.push(Ne.x,st.UseOpenGLOrientationForUV?1-Ne.y:Ne.y),C.push(P),P++};for(let z=0;z<r;z++)for(let $=0;$+z<r;$++)j($,z,$+1/3,z+1/3),j($+1,z,$+1/3,z+1/3),j($,z+1,$+1/3,z+1/3),$+z+1<r&&(j($+1,z,$+2/3,z+2/3),j($+1,z+1,$+2/3,z+2/3),j($,z+1,$+2/3,z+2/3))}re._ComputeSides(e,_,C,T,y,n.frontUVs,n.backUVs);const G=new re;return G.indices=C,G.positions=_,G.normals=T,G.uvs=y,G}function LI(n,e={},t=null){const i=new k(n,t);return e.sideOrientation=k._GetDefaultSideOrientation(e.sideOrientation),i._originalBuilderSideOrientation=e.sideOrientation,Nd(e).applyToMesh(i,e.updatable),i}re.CreateIcoSphere=Nd;k.CreateIcoSphere=(n,e,t)=>LI(n,e,t);const wI=new v(1,0,0),UI=new v(-1,0,0),VI=new v(0,1,0),BI=new v(0,-1,0),kI=new v(0,0,1),zI=new v(0,0,-1);class ph{constructor(e=v.Zero(),t=v.Up(),i=me.Zero(),r=0,s=0,o=null,a=null,l=null,h=null){this.position=e,this.normal=t,this.uv=i,this.vertexIdx=r,this.vertexIdxForBones=s,this.localPositionOverride=o,this.localNormalOverride=a,this.matrixIndicesOverride=l,this.matrixWeightsOverride=h}clone(){var e,t,i,r;return new ph(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,(e=this.localPositionOverride)==null?void 0:e.slice(),(t=this.localNormalOverride)==null?void 0:t.slice(),(i=this.matrixIndicesOverride)==null?void 0:i.slice(),(r=this.matrixWeightsOverride)==null?void 0:r.slice())}}function GI(n,e,t){var i,r,s,o;const a=!!e.skeleton,l=t.localMode||a,h=e.overrideMaterialSideOrientation!==null&&e.overrideMaterialSideOrientation!==void 0,c=e.getIndices(),u=a?e.getPositionData(!0,!0):e.getVerticesData(b.PositionKind),d=a?e.getNormalsData(!0,!0):e.getVerticesData(b.NormalKind),f=l?a?e.getVerticesData(b.PositionKind):u:null,p=l?a?e.getVerticesData(b.NormalKind):d:null,g=e.getVerticesData(b.UVKind),m=a?e.getVerticesData(b.MatricesIndicesKind):null,x=a?e.getVerticesData(b.MatricesWeightsKind):null,E=a?e.getVerticesData(b.MatricesIndicesExtraKind):null,R=a?e.getVerticesData(b.MatricesWeightsExtraKind):null,C=t.position||v.Zero();let _=t.normal||v.Up();const T=t.size||v.One(),y=t.angle||0;if(!_){const w=new v(0,0,1),H=e.getScene().activeCamera,de=v.TransformCoordinates(w,H.getWorldMatrix());_=H.globalPosition.subtract(de)}const P=-Math.atan2(_.z,_.x)-Math.PI/2,D=Math.sqrt(_.x*_.x+_.z*_.z),F=Math.atan2(_.y,D),N=new re;N.indices=[],N.positions=[],N.normals=[],N.uvs=[],N.matricesIndices=a?[]:null,N.matricesWeights=a?[]:null,N.matricesIndicesExtra=E?[]:null,N.matricesWeightsExtra=R?[]:null;let G=0;const J=(w,H)=>{const de=new ph;if(!c||!u||!d)return de;const Te=c[w];if(de.vertexIdx=Te*3,de.vertexIdxForBones=Te*4,de.position=new v(u[Te*3],u[Te*3+1],u[Te*3+2]),v.TransformCoordinatesToRef(de.position,H,de.position),de.normal=new v(d[Te*3],d[Te*3+1],d[Te*3+2]),v.TransformNormalToRef(de.normal,H,de.normal),t.captureUVS&&g){const Ne=g[Te*2+1];de.uv=new me(g[Te*2],st.UseOpenGLOrientationForUV?1-Ne:Ne)}return de},j=[0,0,0,0],z=(w,H)=>{if(w.length===0)return w;const de=.5*Math.abs(v.Dot(T,H)),Te=(ce,ve,Ue,Se)=>{for(let ue=0;ue<Se;++ue)if(ce[Ue+ue]===ve)return Ue+ue;return-1},Ne=(ce,ve)=>{const Ue=v.GetClipFactor(ce.position,ve.position,H,de);let Se=j,ue=j;if(m&&x){const Tr=ce.matrixIndicesOverride?0:ce.vertexIdxForBones,Ys=ce.matrixIndicesOverride??m,Di=ce.matrixWeightsOverride??x,$o=ve.matrixIndicesOverride?0:ve.vertexIdxForBones,ll=ve.matrixIndicesOverride??m,ea=ve.matrixWeightsOverride??x;Se=[0,0,0,0],ue=[0,0,0,0];let as=0;for(let xr=0;xr<4;++xr)if(Di[Tr+xr]>0){const Zs=Te(ll,Ys[Tr+xr],$o,4);Se[as]=Ys[Tr+xr],ue[as]=Ye.Lerp(Di[Tr+xr],Zs>=0?ea[Zs]:0,Ue),as++}for(let xr=0;xr<4&&as<4;++xr){const Zs=ll[$o+xr];Te(Ys,Zs,Tr,4)===-1&&(Se[as]=Zs,ue[as]=Ye.Lerp(0,ea[$o+xr],Ue),as++)}const Kn=ue[0]+ue[1]+ue[2]+ue[3];ue[0]/=Kn,ue[1]/=Kn,ue[2]/=Kn,ue[3]/=Kn}const Ze=ce.localPositionOverride?ce.localPositionOverride[0]:(f==null?void 0:f[ce.vertexIdx])??0,_t=ce.localPositionOverride?ce.localPositionOverride[1]:(f==null?void 0:f[ce.vertexIdx+1])??0,vt=ce.localPositionOverride?ce.localPositionOverride[2]:(f==null?void 0:f[ce.vertexIdx+2])??0,Ot=ve.localPositionOverride?ve.localPositionOverride[0]:(f==null?void 0:f[ve.vertexIdx])??0,$t=ve.localPositionOverride?ve.localPositionOverride[1]:(f==null?void 0:f[ve.vertexIdx+1])??0,Ii=ve.localPositionOverride?ve.localPositionOverride[2]:(f==null?void 0:f[ve.vertexIdx+2])??0,Gi=ce.localNormalOverride?ce.localNormalOverride[0]:(p==null?void 0:p[ce.vertexIdx])??0,rs=ce.localNormalOverride?ce.localNormalOverride[1]:(p==null?void 0:p[ce.vertexIdx+1])??0,ss=ce.localNormalOverride?ce.localNormalOverride[2]:(p==null?void 0:p[ce.vertexIdx+2])??0,Wi=ve.localNormalOverride?ve.localNormalOverride[0]:(p==null?void 0:p[ve.vertexIdx])??0,Xi=ve.localNormalOverride?ve.localNormalOverride[1]:(p==null?void 0:p[ve.vertexIdx+1])??0,ns=ve.localNormalOverride?ve.localNormalOverride[2]:(p==null?void 0:p[ve.vertexIdx+2])??0,Ir=Gi+(Wi-Gi)*Ue,Ss=rs+(Xi-rs)*Ue,ys=ss+(ns-ss)*Ue,os=Math.sqrt(Ir*Ir+Ss*Ss+ys*ys);return new ph(v.Lerp(ce.position,ve.position,Ue),v.Lerp(ce.normal,ve.normal,Ue).normalize(),me.Lerp(ce.uv,ve.uv,Ue),-1,-1,f?[Ze+(Ot-Ze)*Ue,_t+($t-_t)*Ue,vt+(Ii-vt)*Ue]:null,p?[Ir/os,Ss/os,ys/os]:null,Se,ue)};let Fe=null;w.length>3&&(Fe=[]);for(let ce=0;ce<w.length;ce+=3){let ve=0,Ue=null,Se=null,ue=null,Ze=null;const _t=v.Dot(w[ce].position,H)-de,vt=v.Dot(w[ce+1].position,H)-de,Ot=v.Dot(w[ce+2].position,H)-de,$t=_t>0,Ii=vt>0,Gi=Ot>0;switch(ve=($t?1:0)+(Ii?1:0)+(Gi?1:0),ve){case 0:w.length>3?(Fe.push(w[ce]),Fe.push(w[ce+1]),Fe.push(w[ce+2])):Fe=w;break;case 1:if(Fe=Fe??new Array,$t&&(Ue=w[ce+1],Se=w[ce+2],ue=Ne(w[ce],Ue),Ze=Ne(w[ce],Se)),Ii){Ue=w[ce],Se=w[ce+2],ue=Ne(w[ce+1],Ue),Ze=Ne(w[ce+1],Se),Fe.push(ue),Fe.push(Se.clone()),Fe.push(Ue.clone()),Fe.push(Se.clone()),Fe.push(ue.clone()),Fe.push(Ze);break}Gi&&(Ue=w[ce],Se=w[ce+1],ue=Ne(w[ce+2],Ue),Ze=Ne(w[ce+2],Se)),Ue&&Se&&ue&&Ze&&(Fe.push(Ue.clone()),Fe.push(Se.clone()),Fe.push(ue),Fe.push(Ze),Fe.push(ue.clone()),Fe.push(Se.clone()));break;case 2:Fe=Fe??new Array,$t||(Ue=w[ce].clone(),Se=Ne(Ue,w[ce+1]),ue=Ne(Ue,w[ce+2]),Fe.push(Ue),Fe.push(Se),Fe.push(ue)),Ii||(Ue=w[ce+1].clone(),Se=Ne(Ue,w[ce+2]),ue=Ne(Ue,w[ce]),Fe.push(Ue),Fe.push(Se),Fe.push(ue)),Gi||(Ue=w[ce+2].clone(),Se=Ne(Ue,w[ce]),ue=Ne(Ue,w[ce+1]),Fe.push(Ue),Fe.push(Se),Fe.push(ue));break}}return Fe},$=e instanceof k?e:null,te=$==null?void 0:$._thinInstanceDataStorage.matrixData,fe=($==null?void 0:$.thinInstanceCount)||1,Z=W.Matrix[0];Z.copyFrom(U.IdentityReadOnly);for(let w=0;w<fe;++w){if($!=null&&$.hasThinInstances&&te){const ce=w*16;Z.setRowFromFloats(0,te[ce+0],te[ce+1],te[ce+2],te[ce+3]),Z.setRowFromFloats(1,te[ce+4],te[ce+5],te[ce+6],te[ce+7]),Z.setRowFromFloats(2,te[ce+8],te[ce+9],te[ce+10],te[ce+11]),Z.setRowFromFloats(3,te[ce+12],te[ce+13],te[ce+14],te[ce+15])}const H=U.RotationYawPitchRoll(P,F,y).multiply(U.Translation(C.x,C.y,C.z)),de=U.Invert(H),Te=e.getWorldMatrix(),Ne=Z.multiply(Te).multiply(de),Fe=new Array(3);for(let ce=0;ce<c.length;ce+=3){let ve=Fe;if(ve[0]=J(ce,Ne),h&&l?(ve[1]=J(ce+2,Ne),ve[2]=J(ce+1,Ne)):(ve[1]=J(ce+1,Ne),ve[2]=J(ce+2,Ne)),!(t.cullBackFaces&&-ve[0].normal.z<=0&&-ve[1].normal.z<=0&&-ve[2].normal.z<=0)&&(ve=z(ve,wI),!!ve&&(ve=z(ve,UI),!!ve&&(ve=z(ve,VI),!!ve&&(ve=z(ve,BI),!!ve&&(ve=z(ve,kI),!!ve&&(ve=z(ve,zI),!!ve)))))))for(let Ue=0;Ue<ve.length;Ue++){const Se=ve[Ue];if(N.indices.push(G),l?(Se.localPositionOverride?(N.positions[G*3]=Se.localPositionOverride[0],N.positions[G*3+1]=Se.localPositionOverride[1],N.positions[G*3+2]=Se.localPositionOverride[2]):f&&(N.positions[G*3]=f[Se.vertexIdx],N.positions[G*3+1]=f[Se.vertexIdx+1],N.positions[G*3+2]=f[Se.vertexIdx+2]),Se.localNormalOverride?(N.normals[G*3]=Se.localNormalOverride[0],N.normals[G*3+1]=Se.localNormalOverride[1],N.normals[G*3+2]=Se.localNormalOverride[2]):p&&(N.normals[G*3]=p[Se.vertexIdx],N.normals[G*3+1]=p[Se.vertexIdx+1],N.normals[G*3+2]=p[Se.vertexIdx+2])):(Se.position.toArray(N.positions,G*3),Se.normal.toArray(N.normals,G*3)),N.matricesIndices&&N.matricesWeights&&(Se.matrixIndicesOverride?(N.matricesIndices[G*4]=Se.matrixIndicesOverride[0],N.matricesIndices[G*4+1]=Se.matrixIndicesOverride[1],N.matricesIndices[G*4+2]=Se.matrixIndicesOverride[2],N.matricesIndices[G*4+3]=Se.matrixIndicesOverride[3]):(m&&(N.matricesIndices[G*4]=m[Se.vertexIdxForBones],N.matricesIndices[G*4+1]=m[Se.vertexIdxForBones+1],N.matricesIndices[G*4+2]=m[Se.vertexIdxForBones+2],N.matricesIndices[G*4+3]=m[Se.vertexIdxForBones+3]),E&&N.matricesIndicesExtra&&(N.matricesIndicesExtra[G*4]=E[Se.vertexIdxForBones],N.matricesIndicesExtra[G*4+1]=E[Se.vertexIdxForBones+1],N.matricesIndicesExtra[G*4+2]=E[Se.vertexIdxForBones+2],N.matricesIndicesExtra[G*4+3]=E[Se.vertexIdxForBones+3])),Se.matrixWeightsOverride?(N.matricesWeights[G*4]=Se.matrixWeightsOverride[0],N.matricesWeights[G*4+1]=Se.matrixWeightsOverride[1],N.matricesWeights[G*4+2]=Se.matrixWeightsOverride[2],N.matricesWeights[G*4+3]=Se.matrixWeightsOverride[3]):(x&&(N.matricesWeights[G*4]=x[Se.vertexIdxForBones],N.matricesWeights[G*4+1]=x[Se.vertexIdxForBones+1],N.matricesWeights[G*4+2]=x[Se.vertexIdxForBones+2],N.matricesWeights[G*4+3]=x[Se.vertexIdxForBones+3]),R&&N.matricesWeightsExtra&&(N.matricesWeightsExtra[G*4]=R[Se.vertexIdxForBones],N.matricesWeightsExtra[G*4+1]=R[Se.vertexIdxForBones+1],N.matricesWeightsExtra[G*4+2]=R[Se.vertexIdxForBones+2],N.matricesWeightsExtra[G*4+3]=R[Se.vertexIdxForBones+3]))),t.captureUVS)Se.uv.toArray(N.uvs,G*2);else{N.uvs.push(.5+Se.position.x/T.x);const ue=.5+Se.position.y/T.y;N.uvs.push(st.UseOpenGLOrientationForUV?1-ue:ue)}G++}}}N.indices.length===0&&(N.indices=null),N.positions.length===0&&(N.positions=null),N.normals.length===0&&(N.normals=null),N.uvs.length===0&&(N.uvs=null),((i=N.matricesIndices)==null?void 0:i.length)===0&&(N.matricesIndices=null),((r=N.matricesWeights)==null?void 0:r.length)===0&&(N.matricesWeights=null),((s=N.matricesIndicesExtra)==null?void 0:s.length)===0&&(N.matricesIndicesExtra=null),((o=N.matricesWeightsExtra)==null?void 0:o.length)===0&&(N.matricesWeightsExtra=null);const L=new k(n,e.getScene());return N.applyToMesh(L),l?(L.skeleton=e.skeleton,L.parent=e):(L.position=C.clone(),L.rotation=new v(F,P,y)),L.computeWorldMatrix(!0),L.refreshBoundingInfo(!0,!0),L}k.CreateDecal=(n,e,t,i,r,s)=>GI(n,e,{position:t,normal:i,size:r,angle:s});function Fd(n={subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6}){const e=Math.max(n.subdivisions?n.subdivisions:2,1)|0,t=Math.max(n.tessellation?n.tessellation:16,3)|0,i=Math.max(n.height?n.height:1,0),r=Math.max(n.radius?n.radius:.25,0),s=Math.max(n.capSubdivisions?n.capSubdivisions:6,1)|0,o=t,a=e,l=Math.max(n.radiusTop?n.radiusTop:r,0),h=Math.max(n.radiusBottom?n.radiusBottom:r,0),c=i-(l+h),u=0,d=2*Math.PI,f=Math.max(n.topCapSubdivisions?n.topCapSubdivisions:s,1),p=Math.max(n.bottomCapSubdivisions?n.bottomCapSubdivisions:s,1),g=Math.acos((h-l)/i);let m=[];const x=[],E=[],R=[];let C=0;const _=[],T=c*.5,y=Math.PI*.5;let P,D;const F=v.Zero(),N=v.Zero(),G=Math.cos(g),J=Math.sin(g),j=new me(l*J,T+l*G).subtract(new me(h*J,-T+h*G)).length(),z=l*g+j+h*(y-g);let $=0;for(D=0;D<=f;D++){const L=[],w=y-g*(D/f);$+=l*g/f;const H=Math.cos(w),de=Math.sin(w),Te=H*l;for(P=0;P<=o;P++){const Ne=P/o,Fe=Ne*d+u,ce=Math.sin(Fe),ve=Math.cos(Fe);N.x=Te*ce,N.y=T+de*l,N.z=Te*ve,x.push(N.x,N.y,N.z),F.set(H*ce,de,H*ve),E.push(F.x,F.y,F.z),R.push(Ne,st.UseOpenGLOrientationForUV?$/z:1-$/z),L.push(C),C++}_.push(L)}const te=i-l-h+G*l-G*h,fe=J*(h-l)/te;for(D=1;D<=a;D++){const L=[];$+=j/a;const w=J*(D*(h-l)/a+l);for(P=0;P<=o;P++){const H=P/o,de=H*d+u,Te=Math.sin(de),Ne=Math.cos(de);N.x=w*Te,N.y=T+G*l-D*te/a,N.z=w*Ne,x.push(N.x,N.y,N.z),F.set(Te,fe,Ne).normalize(),E.push(F.x,F.y,F.z),R.push(H,st.UseOpenGLOrientationForUV?$/z:1-$/z),L.push(C),C++}_.push(L)}for(D=1;D<=p;D++){const L=[],w=y-g-(Math.PI-g)*(D/p);$+=h*g/p;const H=Math.cos(w),de=Math.sin(w),Te=H*h;for(P=0;P<=o;P++){const Ne=P/o,Fe=Ne*d+u,ce=Math.sin(Fe),ve=Math.cos(Fe);N.x=Te*ce,N.y=-T+de*h,N.z=Te*ve,x.push(N.x,N.y,N.z),F.set(H*ce,de,H*ve),E.push(F.x,F.y,F.z),R.push(Ne,st.UseOpenGLOrientationForUV?$/z:1-$/z),L.push(C),C++}_.push(L)}for(P=0;P<o;P++)for(D=0;D<f+a+p;D++){const L=_[D][P],w=_[D+1][P],H=_[D+1][P+1],de=_[D][P+1];m.push(L),m.push(w),m.push(de),m.push(w),m.push(H),m.push(de)}if(m=m.reverse(),n.orientation&&!n.orientation.equals(v.Up())){const L=new U;n.orientation.clone().scale(Math.PI*.5).cross(v.Up()).toQuaternion().toRotationMatrix(L);const w=v.Zero();for(let H=0;H<x.length;H+=3)w.set(x[H],x[H+1],x[H+2]),v.TransformCoordinatesToRef(w.clone(),L,w),x[H]=w.x,x[H+1]=w.y,x[H+2]=w.z}const Z=new re;return Z.positions=x,Z.normals=E,Z.uvs=R,Z.indices=m,Z}function WI(n,e={orientation:v.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},t=null){const i=new k(n,t);return Fd(e).applyToMesh(i,e.updatable),i}k.CreateCapsule=(n,e,t)=>WI(n,e,t);re.CreateCapsule=Fd;class XI{constructor(e){this._paths=[],this._tempPaths=[],this._holes=[],this._resolution=e}moveTo(e,t){this._currentPath=new Yh(e,t),this._tempPaths.push(this._currentPath)}lineTo(e,t){this._currentPath.addLineTo(e,t)}quadraticCurveTo(e,t,i,r){this._currentPath.addQuadraticCurveTo(e,t,i,r,this._resolution)}bezierCurveTo(e,t,i,r,s,o){this._currentPath.addBezierCurveTo(e,t,i,r,s,o,this._resolution)}extractHoles(){for(const e of this._tempPaths)e.area()>0?this._holes.push(e):this._paths.push(e);if(!this._paths.length&&this._holes.length){const e=this._holes;this._holes=this._paths,this._paths=e}this._tempPaths.length=0}get paths(){return this._paths}get holes(){return this._holes}}function HI(n,e,t,i,r,s){const o=s.glyphs[n]||s.glyphs["?"];if(!o)return null;const a=new XI(r);if(o.o){const l=o.o.split(" ");for(let h=0,c=l.length;h<c;)switch(l[h++]){case"m":{const u=parseInt(l[h++])*e+t,d=parseInt(l[h++])*e+i;a.moveTo(u,d);break}case"l":{const u=parseInt(l[h++])*e+t,d=parseInt(l[h++])*e+i;a.lineTo(u,d);break}case"q":{const u=parseInt(l[h++])*e+t,d=parseInt(l[h++])*e+i,f=parseInt(l[h++])*e+t,p=parseInt(l[h++])*e+i;a.quadraticCurveTo(f,p,u,d);break}case"b":{const u=parseInt(l[h++])*e+t,d=parseInt(l[h++])*e+i,f=parseInt(l[h++])*e+t,p=parseInt(l[h++])*e+i,g=parseInt(l[h++])*e+t,m=parseInt(l[h++])*e+i;a.bezierCurveTo(f,p,g,m,u,d);break}}}return a.extractHoles(),{offsetX:o.ha*e,shapePath:a}}function KI(n,e,t,i){const r=Array.from(n),s=e/i.resolution,o=(i.boundingBox.yMax-i.boundingBox.yMin+i.underlineThickness)*s,a=[];let l=0,h=0;for(let c=0;c<r.length;c++){const u=r[c];if(u===`
`)l=0,h-=o;else{const d=HI(u,s,l,h,t,i);d&&(l+=d.offsetX,a.push(d.shapePath))}}return a}class qI{constructor(){this.running=!1,this._simplificationArray=[]}addTask(e){this._simplificationArray.push(e)}executeNext(){const e=this._simplificationArray.pop();e?(this.running=!0,this.runSimplification(e)):this.running=!1}runSimplification(e){if(e.parallelProcessing)e.settings.forEach(t=>{this._getSimplifier(e).simplify(t,i=>{t.distance!==void 0&&e.mesh.addLODLevel(t.distance,i),i.isVisible=!0,t.quality===e.settings[e.settings.length-1].quality&&e.successCallback&&e.successCallback(),this.executeNext()})});else{const t=this._getSimplifier(e),i=(r,s)=>{t.simplify(r,o=>{r.distance!==void 0&&e.mesh.addLODLevel(r.distance,o),o.isVisible=!0,s()})};Dr.Run(e.settings.length,r=>{i(e.settings[r.index],()=>{r.executeNext()})},()=>{e.successCallback&&e.successCallback(),this.executeNext()})}}_getSimplifier(e){switch(e.simplificationType){case gh.QUADRATIC:default:return new QI(e.mesh)}}}var gh;(function(n){n[n.QUADRATIC=0]="QUADRATIC"})(gh||(gh={}));class YI{constructor(e){this._vertices=e,this.error=new Array(4),this.deleted=!1,this.isDirty=!1,this.deletePending=!1,this.borderFactor=0}}class ZI{constructor(e,t){this.position=e,this.id=t,this.isBorder=!0,this.q=new yo,this.triangleCount=0,this.triangleStart=0,this.originalOffsets=[]}updatePosition(e){this.position.copyFrom(e)}}class yo{constructor(e){this.data=new Array(10);for(let t=0;t<10;++t)e&&e[t]?this.data[t]=e[t]:this.data[t]=0}det(e,t,i,r,s,o,a,l,h){return this.data[e]*this.data[s]*this.data[h]+this.data[i]*this.data[r]*this.data[l]+this.data[t]*this.data[o]*this.data[a]-this.data[i]*this.data[s]*this.data[a]-this.data[e]*this.data[o]*this.data[l]-this.data[t]*this.data[r]*this.data[h]}addInPlace(e){for(let t=0;t<10;++t)this.data[t]+=e.data[t]}addArrayInPlace(e){for(let t=0;t<10;++t)this.data[t]+=e[t]}add(e){const t=new yo;for(let i=0;i<10;++i)t.data[i]=this.data[i]+e.data[i];return t}static FromData(e,t,i,r){return new yo(yo.DataFromNumbers(e,t,i,r))}static DataFromNumbers(e,t,i,r){return[e*e,e*t,e*i,e*r,t*t,t*i,t*r,i*i,i*r,r*r]}}class jI{constructor(e,t){this.vertexId=e,this.triangleId=t}}class QI{constructor(e){this._mesh=e,this.syncIterations=5e3,this.aggressiveness=7,this.decimationIterations=100,this.boundingBoxEpsilon=xt}simplify(e,t){this._initDecimatedMesh(),Dr.Run(this._mesh.subMeshes.length,i=>{this._initWithMesh(i.index,()=>{this._runDecimation(e,i.index,()=>{i.executeNext()})},e.optimizeMesh)},()=>{setTimeout(()=>{t(this._reconstructedMesh)},0)})}_runDecimation(e,t,i){const r=~~(this._triangles.length*e.quality);let s=0;const o=this._triangles.length,a=(l,h)=>{setTimeout(()=>{l%5===0&&this._updateMesh(l===0);for(let d=0;d<this._triangles.length;++d)this._triangles[d].isDirty=!1;const c=1e-9*Math.pow(l+3,this.aggressiveness),u=d=>{const f=~~((this._triangles.length/2+d)%this._triangles.length),p=this._triangles[f];if(p&&!(p.error[3]>c||p.deleted||p.isDirty)){for(let g=0;g<3;++g)if(p.error[g]<c){const m=[],x=[],E=p._vertices[g],R=p._vertices[(g+1)%3];if(E.isBorder||R.isBorder)continue;const C=v.Zero();this._calculateError(E,R,C);const _=[];if(this._isFlipped(E,R,C,m,_)||this._isFlipped(R,E,C,x,_)||m.indexOf(!0)<0||x.indexOf(!0)<0)continue;const T=[];if(_.forEach(D=>{T.indexOf(D)===-1&&(D.deletePending=!0,T.push(D))}),T.length%2!==0)continue;E.q=R.q.add(E.q),E.updatePosition(C);const y=this._references.length;s=this._updateTriangles(E,E,m,s),s=this._updateTriangles(E,R,x,s);const P=this._references.length-y;if(P<=E.triangleCount){if(P)for(let D=0;D<P;D++)this._references[E.triangleStart+D]=this._references[y+D]}else E.triangleStart=y;E.triangleCount=P;break}}};Dr.SyncAsyncForLoop(this._triangles.length,this.syncIterations,u,h,()=>o-s<=r)},0)};Dr.Run(this.decimationIterations,l=>{o-s<=r?l.breakLoop():a(l.index,()=>{l.executeNext()})},()=>{setTimeout(()=>{this._reconstructMesh(t),i()},0)})}_initWithMesh(e,t,i){this._vertices=[],this._triangles=[];const r=this._mesh.getVerticesData(b.PositionKind),s=this._mesh.getIndices(),o=this._mesh.subMeshes[e],a=u=>{if(i){for(let d=0;d<this._vertices.length;++d)if(this._vertices[d].position.equalsWithEpsilon(u,1e-4))return this._vertices[d]}return null},l=[],h=u=>{if(!r)return;const d=u+o.verticesStart,f=v.FromArray(r,d*3),p=a(f)||new ZI(f,this._vertices.length);p.originalOffsets.push(d),p.id===this._vertices.length&&this._vertices.push(p),l.push(p.id)},c=o.verticesCount;Dr.SyncAsyncForLoop(c,this.syncIterations/4>>0,h,()=>{const u=d=>{if(!s)return;const f=(o.indexStart/3+d)*3,p=s[f+0],g=s[f+1],m=s[f+2],x=this._vertices[l[p-o.verticesStart]],E=this._vertices[l[g-o.verticesStart]],R=this._vertices[l[m-o.verticesStart]],C=new YI([x,E,R]);C.originalOffset=f,this._triangles.push(C)};Dr.SyncAsyncForLoop(o.indexCount/3,this.syncIterations,u,()=>{this._init(t)})})}_init(e){const t=i=>{const r=this._triangles[i];r.normal=v.Cross(r._vertices[1].position.subtract(r._vertices[0].position),r._vertices[2].position.subtract(r._vertices[0].position)).normalize();for(let s=0;s<3;s++)r._vertices[s].q.addArrayInPlace(yo.DataFromNumbers(r.normal.x,r.normal.y,r.normal.z,-v.Dot(r.normal,r._vertices[0].position)))};Dr.SyncAsyncForLoop(this._triangles.length,this.syncIterations,t,()=>{const i=r=>{const s=this._triangles[r];for(let o=0;o<3;++o)s.error[o]=this._calculateError(s._vertices[o],s._vertices[(o+1)%3]);s.error[3]=Math.min(s.error[0],s.error[1],s.error[2])};Dr.SyncAsyncForLoop(this._triangles.length,this.syncIterations,i,()=>{e()})})}_reconstructMesh(e){const t=[];let i;for(i=0;i<this._vertices.length;++i)this._vertices[i].triangleCount=0;let r,s;for(i=0;i<this._triangles.length;++i)if(!this._triangles[i].deleted){for(r=this._triangles[i],s=0;s<3;++s)r._vertices[s].triangleCount=1;t.push(r)}const o=this._reconstructedMesh.getVerticesData(b.PositionKind)||[],a=this._reconstructedMesh.getVerticesData(b.NormalKind)||[],l=this._reconstructedMesh.getVerticesData(b.UVKind)||[],h=this._reconstructedMesh.getVerticesData(b.ColorKind)||[],c=this._mesh.getVerticesData(b.NormalKind),u=this._mesh.getVerticesData(b.UVKind),d=this._mesh.getVerticesData(b.ColorKind);let f=0;for(i=0;i<this._vertices.length;++i){const C=this._vertices[i];C.id=f,C.triangleCount&&C.originalOffsets.forEach(_=>{o.push(C.position.x),o.push(C.position.y),o.push(C.position.z),c&&c.length&&(a.push(c[_*3]),a.push(c[_*3+1]),a.push(c[_*3+2])),u&&u.length&&(l.push(u[_*2]),l.push(u[_*2+1])),d&&d.length&&(h.push(d[_*4]),h.push(d[_*4+1]),h.push(d[_*4+2]),h.push(d[_*4+3])),++f})}const p=this._reconstructedMesh.getTotalIndices(),g=this._reconstructedMesh.getTotalVertices(),m=this._reconstructedMesh.subMeshes;this._reconstructedMesh.subMeshes=[];const x=this._reconstructedMesh.getIndices(),E=this._mesh.getIndices();for(i=0;i<t.length;++i)r=t[i],[0,1,2].forEach(C=>{const _=E[r.originalOffset+C];let T=r._vertices[C].originalOffsets.indexOf(_);T<0&&(T=0),x.push(r._vertices[C].id+T+g)});this._reconstructedMesh.setIndices(x),this._reconstructedMesh.setVerticesData(b.PositionKind,o),a.length>0&&this._reconstructedMesh.setVerticesData(b.NormalKind,a),l.length>0&&this._reconstructedMesh.setVerticesData(b.UVKind,l),h.length>0&&this._reconstructedMesh.setVerticesData(b.ColorKind,h);const R=this._mesh.subMeshes[e];e>0&&(this._reconstructedMesh.subMeshes=[],m.forEach(C=>{Pi.AddToMesh(C.materialIndex,C.verticesStart,C.verticesCount,C.indexStart,C.indexCount,C.getMesh())}),Pi.AddToMesh(R.materialIndex,g,f,p,t.length*3,this._reconstructedMesh))}_initDecimatedMesh(){this._reconstructedMesh=new k(this._mesh.name+"Decimated",this._mesh.getScene()),this._reconstructedMesh.material=this._mesh.material,this._reconstructedMesh.parent=this._mesh.parent,this._reconstructedMesh.isVisible=!1,this._reconstructedMesh.renderingGroupId=this._mesh.renderingGroupId}_isFlipped(e,t,i,r,s){for(let o=0;o<e.triangleCount;++o){const a=this._triangles[this._references[e.triangleStart+o].triangleId];if(a.deleted)continue;const l=this._references[e.triangleStart+o].vertexId,h=a._vertices[(l+1)%3],c=a._vertices[(l+2)%3];if(h===t||c===t){r[o]=!0,s.push(a);continue}let u=h.position.subtract(i);u=u.normalize();let d=c.position.subtract(i);if(d=d.normalize(),Math.abs(v.Dot(u,d))>.999)return!0;const f=v.Cross(u,d).normalize();if(r[o]=!1,v.Dot(f,a.normal)<.2)return!0}return!1}_updateTriangles(e,t,i,r){let s=r;for(let o=0;o<t.triangleCount;++o){const a=this._references[t.triangleStart+o],l=this._triangles[a.triangleId];if(!l.deleted){if(i[o]&&l.deletePending){l.deleted=!0,s++;continue}l._vertices[a.vertexId]=e,l.isDirty=!0,l.error[0]=this._calculateError(l._vertices[0],l._vertices[1])+l.borderFactor/2,l.error[1]=this._calculateError(l._vertices[1],l._vertices[2])+l.borderFactor/2,l.error[2]=this._calculateError(l._vertices[2],l._vertices[0])+l.borderFactor/2,l.error[3]=Math.min(l.error[0],l.error[1],l.error[2]),this._references.push(a)}}return s}_identifyBorder(){for(let e=0;e<this._vertices.length;++e){const t=[],i=[],r=this._vertices[e];let s;for(s=0;s<r.triangleCount;++s){const o=this._triangles[this._references[r.triangleStart+s].triangleId];for(let a=0;a<3;a++){let l=0;const h=o._vertices[a];for(;l<t.length&&i[l]!==h.id;)++l;l===t.length?(t.push(1),i.push(h.id)):t[l]++}}for(s=0;s<t.length;++s)t[s]===1?this._vertices[i[s]].isBorder=!0:this._vertices[i[s]].isBorder=!1}}_updateMesh(e=!1){let t;if(!e){const l=[];for(t=0;t<this._triangles.length;++t)this._triangles[t].deleted||l.push(this._triangles[t]);this._triangles=l}for(t=0;t<this._vertices.length;++t)this._vertices[t].triangleCount=0,this._vertices[t].triangleStart=0;let i,r,s;for(t=0;t<this._triangles.length;++t)for(i=this._triangles[t],r=0;r<3;++r)s=i._vertices[r],s.triangleCount++;let o=0;for(t=0;t<this._vertices.length;++t)this._vertices[t].triangleStart=o,o+=this._vertices[t].triangleCount,this._vertices[t].triangleCount=0;const a=new Array(this._triangles.length*3);for(t=0;t<this._triangles.length;++t)for(i=this._triangles[t],r=0;r<3;++r)s=i._vertices[r],a[s.triangleStart+s.triangleCount]=new jI(r,t),s.triangleCount++;this._references=a,e&&this._identifyBorder()}_vertexError(e,t){const i=t.x,r=t.y,s=t.z;return e.data[0]*i*i+2*e.data[1]*i*r+2*e.data[2]*i*s+2*e.data[3]*i+e.data[4]*r*r+2*e.data[5]*r*s+2*e.data[6]*r+e.data[7]*s*s+2*e.data[8]*s+e.data[9]}_calculateError(e,t,i){const r=e.q.add(t.q),s=e.isBorder&&t.isBorder;let o=0;const a=r.det(0,1,2,1,4,5,2,5,7);if(a!==0&&!s)i||(i=v.Zero()),i.x=-1/a*r.det(1,2,3,4,5,6,5,7,8),i.y=1/a*r.det(0,2,3,1,5,6,2,7,8),i.z=-1/a*r.det(0,1,3,1,4,6,2,5,8),o=this._vertexError(r,i);else{const l=e.position.add(t.position).divide(new v(2,2,2)),h=this._vertexError(r,e.position),c=this._vertexError(r,t.position),u=this._vertexError(r,l);o=Math.min(h,c,u),o===h?i&&i.copyFrom(e.position):o===c?i&&i.copyFrom(t.position):i&&i.copyFrom(l)}return o}}Object.defineProperty(Pt.prototype,"simplificationQueue",{get:function(){if(!this._simplificationQueue){this._simplificationQueue=new qI;let n=this._getComponent(ze.NAME_SIMPLIFICATIONQUEUE);n||(n=new JI(this),this._addComponent(n))}return this._simplificationQueue},set:function(n){this._simplificationQueue=n},enumerable:!0,configurable:!0});k.prototype.simplify=function(n,e=!0,t=gh.QUADRATIC,i){return this.getScene().simplificationQueue.addTask({settings:n,parallelProcessing:e,mesh:this,simplificationType:t,successCallback:i}),this};class JI{constructor(e){this.name=ze.NAME_SIMPLIFICATIONQUEUE,this.scene=e}register(){this.scene._beforeCameraUpdateStage.registerStep(ze.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE,this,this._beforeCameraUpdate)}rebuild(){}dispose(){}_beforeCameraUpdate(){this.scene._simplificationQueue&&!this.scene._simplificationQueue.running&&this.scene._simplificationQueue.executeNext()}}Pi.prototype._projectOnTrianglesToRef=function(n,e,t,i,r,s){const o=W.Vector3[0],a=W.Vector3[1];let l=1/0;for(let h=this.indexStart;h<this.indexStart+this.indexCount-(3-i);h+=i){const c=t[h],u=t[h+1],d=t[h+2];if(r&&d===4294967295){h+=2;continue}const f=e[c],p=e[u],g=e[d];if(!f||!p||!g)continue;const m=v.ProjectOnTriangleToRef(n,f,p,g,a);m<l&&(o.copyFrom(a),l=m)}return s.copyFrom(o),l};Pi.prototype._projectOnUnIndexedTrianglesToRef=function(n,e,t,i){const r=W.Vector3[0],s=W.Vector3[1];let o=1/0;for(let a=this.verticesStart;a<this.verticesStart+this.verticesCount;a+=3){const l=e[a],h=e[a+1],c=e[a+2],u=v.ProjectOnTriangleToRef(n,l,h,c,s);u<o&&(r.copyFrom(s),o=u)}return i.copyFrom(r),o};Pi.prototype.projectToRef=function(n,e,t,i){const r=this.getMaterial();if(!r)return-1;let s=3,o=!1;switch(r.fillMode){case 3:case 5:case 6:case 8:return-1;case 7:s=1,o=!0;break}return r.fillMode===4?-1:!t.length&&this._mesh._unIndexed?this._projectOnUnIndexedTrianglesToRef(n,e,t,i):this._projectOnTrianglesToRef(n,e,t,s,o,i)};function $I(n,e={},t){e.diameter||(e.diameter=1),e.segments||(e.segments=16);const i=w0("",{slice:.5,diameter:e.diameter,segments:e.segments},t),r=D0("",{radius:e.diameter/2,tessellation:e.segments*3+(4-e.segments)},t);r.rotation.x=-Math.PI/2,r.parent=i;const s=k.MergeMeshes([r,i],!0);return s.name=n,s}k.CreateHemisphere=(n,e,t,i)=>$I(n,{segments:e,diameter:t},i);class mh{constructor(){this.previousWorldMatrices={},this.previousBones={}}static AddUniforms(e){e.push("previousWorld","previousViewProjection","mPreviousBones")}static AddSamplers(e){}bindForSubMesh(e,t,i,r,s){if(t.prePassRenderer&&t.prePassRenderer.enabled&&t.prePassRenderer.currentRTisSceneRT&&t.prePassRenderer.getIndex(2)!==-1){this.previousWorldMatrices[i.uniqueId]||(this.previousWorldMatrices[i.uniqueId]=r.clone()),this.previousViewProjection||(this.previousViewProjection=t.getTransformMatrix().clone(),this.currentViewProjection=t.getTransformMatrix().clone());const o=t.getEngine();this.currentViewProjection.updateFlag!==t.getTransformMatrix().updateFlag?(this._lastUpdateFrameId=o.frameId,this.previousViewProjection.copyFrom(this.currentViewProjection),this.currentViewProjection.copyFrom(t.getTransformMatrix())):this._lastUpdateFrameId!==o.frameId&&(this._lastUpdateFrameId=o.frameId,this.previousViewProjection.copyFrom(this.currentViewProjection)),e.setMatrix("previousWorld",this.previousWorldMatrices[i.uniqueId]),e.setMatrix("previousViewProjection",this.previousViewProjection),this.previousWorldMatrices[i.uniqueId]=r.clone()}}}class is{constructor(e){if(this._keys=[],this._isDirty=!0,this._areLightsDirty=!0,this._areLightsDisposed=!1,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1,this._externalProperties=e,e)for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&this._setDefaultValue(t)}get isDirty(){return this._isDirty}markAsProcessed(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areLightsDisposed=!1,this._areMiscDirty=!1,this._arePrePassDirty=!1,this._areImageProcessingDirty=!1}markAsUnprocessed(){this._isDirty=!0}markAllAsDirty(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!1,this._areImageProcessingDirty=!0,this._isDirty=!0}markAsImageProcessingDirty(){this._areImageProcessingDirty=!0,this._isDirty=!0}markAsLightDirty(e=!1){this._areLightsDirty=!0,this._areLightsDisposed=this._areLightsDisposed||e,this._isDirty=!0}markAsAttributesDirty(){this._areAttributesDirty=!0,this._isDirty=!0}markAsTexturesDirty(){this._areTexturesDirty=!0,this._isDirty=!0}markAsFresnelDirty(){this._areFresnelDirty=!0,this._isDirty=!0}markAsMiscDirty(){this._areMiscDirty=!0,this._isDirty=!0}markAsPrePassDirty(){this._arePrePassDirty=!0,this._isDirty=!0}rebuild(){this._keys.length=0;for(const e of Object.keys(this))e[0]!=="_"&&this._keys.push(e);if(this._externalProperties)for(const e in this._externalProperties)this._keys.indexOf(e)===-1&&this._keys.push(e)}isEqual(e){if(this._keys.length!==e._keys.length)return!1;for(let t=0;t<this._keys.length;t++){const i=this._keys[t];if(this[i]!==e[i])return!1}return!0}cloneTo(e){this._keys.length!==e._keys.length&&(e._keys=this._keys.slice(0));for(let t=0;t<this._keys.length;t++){const i=this._keys[t];e[i]=this[i]}}reset(){this._keys.forEach(e=>this._setDefaultValue(e))}_setDefaultValue(e){var t,i,r,s;const o=((i=(t=this._externalProperties)==null?void 0:t[e])==null?void 0:i.type)??typeof this[e],a=(s=(r=this._externalProperties)==null?void 0:r[e])==null?void 0:s.default;switch(o){case"number":this[e]=a??0;break;case"string":this[e]=a??"";break;default:this[e]=a??!1;break}}toString(){let e="";for(let t=0;t<this._keys.length;t++){const i=this._keys[t],r=this[i];switch(typeof r){case"number":case"string":e+="#define "+i+" "+r+`
`;break;default:r&&(e+="#define "+i+`
`);break}}return e}}class ne{static get DiffuseTextureEnabled(){return this._DiffuseTextureEnabled}static set DiffuseTextureEnabled(e){this._DiffuseTextureEnabled!==e&&(this._DiffuseTextureEnabled=e,se.MarkAllMaterialsAsDirty(1))}static get DetailTextureEnabled(){return this._DetailTextureEnabled}static set DetailTextureEnabled(e){this._DetailTextureEnabled!==e&&(this._DetailTextureEnabled=e,se.MarkAllMaterialsAsDirty(1))}static get DecalMapEnabled(){return this._DecalMapEnabled}static set DecalMapEnabled(e){this._DecalMapEnabled!==e&&(this._DecalMapEnabled=e,se.MarkAllMaterialsAsDirty(1))}static get AmbientTextureEnabled(){return this._AmbientTextureEnabled}static set AmbientTextureEnabled(e){this._AmbientTextureEnabled!==e&&(this._AmbientTextureEnabled=e,se.MarkAllMaterialsAsDirty(1))}static get OpacityTextureEnabled(){return this._OpacityTextureEnabled}static set OpacityTextureEnabled(e){this._OpacityTextureEnabled!==e&&(this._OpacityTextureEnabled=e,se.MarkAllMaterialsAsDirty(1))}static get ReflectionTextureEnabled(){return this._ReflectionTextureEnabled}static set ReflectionTextureEnabled(e){this._ReflectionTextureEnabled!==e&&(this._ReflectionTextureEnabled=e,se.MarkAllMaterialsAsDirty(1))}static get EmissiveTextureEnabled(){return this._EmissiveTextureEnabled}static set EmissiveTextureEnabled(e){this._EmissiveTextureEnabled!==e&&(this._EmissiveTextureEnabled=e,se.MarkAllMaterialsAsDirty(1))}static get SpecularTextureEnabled(){return this._SpecularTextureEnabled}static set SpecularTextureEnabled(e){this._SpecularTextureEnabled!==e&&(this._SpecularTextureEnabled=e,se.MarkAllMaterialsAsDirty(1))}static get BumpTextureEnabled(){return this._BumpTextureEnabled}static set BumpTextureEnabled(e){this._BumpTextureEnabled!==e&&(this._BumpTextureEnabled=e,se.MarkAllMaterialsAsDirty(1))}static get LightmapTextureEnabled(){return this._LightmapTextureEnabled}static set LightmapTextureEnabled(e){this._LightmapTextureEnabled!==e&&(this._LightmapTextureEnabled=e,se.MarkAllMaterialsAsDirty(1))}static get RefractionTextureEnabled(){return this._RefractionTextureEnabled}static set RefractionTextureEnabled(e){this._RefractionTextureEnabled!==e&&(this._RefractionTextureEnabled=e,se.MarkAllMaterialsAsDirty(1))}static get ColorGradingTextureEnabled(){return this._ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(e){this._ColorGradingTextureEnabled!==e&&(this._ColorGradingTextureEnabled=e,se.MarkAllMaterialsAsDirty(1))}static get FresnelEnabled(){return this._FresnelEnabled}static set FresnelEnabled(e){this._FresnelEnabled!==e&&(this._FresnelEnabled=e,se.MarkAllMaterialsAsDirty(4))}static get ClearCoatTextureEnabled(){return this._ClearCoatTextureEnabled}static set ClearCoatTextureEnabled(e){this._ClearCoatTextureEnabled!==e&&(this._ClearCoatTextureEnabled=e,se.MarkAllMaterialsAsDirty(1))}static get ClearCoatBumpTextureEnabled(){return this._ClearCoatBumpTextureEnabled}static set ClearCoatBumpTextureEnabled(e){this._ClearCoatBumpTextureEnabled!==e&&(this._ClearCoatBumpTextureEnabled=e,se.MarkAllMaterialsAsDirty(1))}static get ClearCoatTintTextureEnabled(){return this._ClearCoatTintTextureEnabled}static set ClearCoatTintTextureEnabled(e){this._ClearCoatTintTextureEnabled!==e&&(this._ClearCoatTintTextureEnabled=e,se.MarkAllMaterialsAsDirty(1))}static get SheenTextureEnabled(){return this._SheenTextureEnabled}static set SheenTextureEnabled(e){this._SheenTextureEnabled!==e&&(this._SheenTextureEnabled=e,se.MarkAllMaterialsAsDirty(1))}static get AnisotropicTextureEnabled(){return this._AnisotropicTextureEnabled}static set AnisotropicTextureEnabled(e){this._AnisotropicTextureEnabled!==e&&(this._AnisotropicTextureEnabled=e,se.MarkAllMaterialsAsDirty(1))}static get ThicknessTextureEnabled(){return this._ThicknessTextureEnabled}static set ThicknessTextureEnabled(e){this._ThicknessTextureEnabled!==e&&(this._ThicknessTextureEnabled=e,se.MarkAllMaterialsAsDirty(1))}static get RefractionIntensityTextureEnabled(){return this._ThicknessTextureEnabled}static set RefractionIntensityTextureEnabled(e){this._RefractionIntensityTextureEnabled!==e&&(this._RefractionIntensityTextureEnabled=e,se.MarkAllMaterialsAsDirty(1))}static get TranslucencyIntensityTextureEnabled(){return this._ThicknessTextureEnabled}static set TranslucencyIntensityTextureEnabled(e){this._TranslucencyIntensityTextureEnabled!==e&&(this._TranslucencyIntensityTextureEnabled=e,se.MarkAllMaterialsAsDirty(1))}static get IridescenceTextureEnabled(){return this._IridescenceTextureEnabled}static set IridescenceTextureEnabled(e){this._IridescenceTextureEnabled!==e&&(this._IridescenceTextureEnabled=e,se.MarkAllMaterialsAsDirty(1))}}ne._DiffuseTextureEnabled=!0;ne._DetailTextureEnabled=!0;ne._DecalMapEnabled=!0;ne._AmbientTextureEnabled=!0;ne._OpacityTextureEnabled=!0;ne._ReflectionTextureEnabled=!0;ne._EmissiveTextureEnabled=!0;ne._SpecularTextureEnabled=!0;ne._BumpTextureEnabled=!0;ne._LightmapTextureEnabled=!0;ne._RefractionTextureEnabled=!0;ne._ColorGradingTextureEnabled=!0;ne._FresnelEnabled=!0;ne._ClearCoatTextureEnabled=!0;ne._ClearCoatBumpTextureEnabled=!0;ne._ClearCoatTintTextureEnabled=!0;ne._SheenTextureEnabled=!0;ne._AnisotropicTextureEnabled=!0;ne._ThicknessTextureEnabled=!0;ne._RefractionIntensityTextureEnabled=!0;ne._TranslucencyIntensityTextureEnabled=!0;ne._IridescenceTextureEnabled=!0;const eA="decalFragmentDeclaration",tA=`#ifdef DECAL
uniform vec4 vDecalInfos;
#endif
`;Y.IncludesShadersStore[eA]=tA;const iA="defaultFragmentDeclaration",rA=`uniform vec4 vEyePosition;uniform vec4 vDiffuseColor;
#ifdef SPECULARTERM
uniform vec4 vSpecularColor;
#endif
uniform vec3 vEmissiveColor;uniform vec3 vAmbientColor;uniform float visibility;
#ifdef DIFFUSE
uniform vec2 vDiffuseInfos;
#endif
#ifdef AMBIENT
uniform vec2 vAmbientInfos;
#endif
#ifdef OPACITY 
uniform vec2 vOpacityInfos;
#endif
#ifdef EMISSIVE
uniform vec2 vEmissiveInfos;
#endif
#ifdef LIGHTMAP
uniform vec2 vLightmapInfos;
#endif
#ifdef BUMP
uniform vec3 vBumpInfos;uniform vec2 vTangentSpaceParams;
#endif
#ifdef ALPHATEST
uniform float alphaCutOff;
#endif
#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION) || defined(PREPASS)
uniform mat4 view;
#endif
#ifdef REFRACTION
uniform vec4 vRefractionInfos;
#ifndef REFRACTIONMAP_3D
uniform mat4 refractionMatrix;
#endif
#ifdef REFRACTIONFRESNEL
uniform vec4 refractionLeftColor;uniform vec4 refractionRightColor;
#endif
#if defined(USE_LOCAL_REFRACTIONMAP_CUBIC) && defined(REFRACTIONMAP_3D)
uniform vec3 vRefractionPosition;uniform vec3 vRefractionSize; 
#endif
#endif
#if defined(SPECULAR) && defined(SPECULARTERM)
uniform vec2 vSpecularInfos;
#endif
#ifdef DIFFUSEFRESNEL
uniform vec4 diffuseLeftColor;uniform vec4 diffuseRightColor;
#endif
#ifdef OPACITYFRESNEL
uniform vec4 opacityParts;
#endif
#ifdef EMISSIVEFRESNEL
uniform vec4 emissiveLeftColor;uniform vec4 emissiveRightColor;
#endif
#ifdef REFLECTION
uniform vec2 vReflectionInfos;
#if defined(REFLECTIONMAP_PLANAR) || defined(REFLECTIONMAP_CUBIC) || defined(REFLECTIONMAP_PROJECTION) || defined(REFLECTIONMAP_EQUIRECTANGULAR) || defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_SKYBOX)
uniform mat4 reflectionMatrix;
#endif
#ifndef REFLECTIONMAP_SKYBOX
#if defined(USE_LOCAL_REFLECTIONMAP_CUBIC) && defined(REFLECTIONMAP_CUBIC)
uniform vec3 vReflectionPosition;uniform vec3 vReflectionSize; 
#endif
#endif
#ifdef REFLECTIONFRESNEL
uniform vec4 reflectionLeftColor;uniform vec4 reflectionRightColor;
#endif
#endif
#ifdef DETAIL
uniform vec4 vDetailInfos;
#endif
#include<decalFragmentDeclaration>
#define ADDITIONAL_FRAGMENT_DECLARATION
`;Y.IncludesShadersStore[iA]=rA;const sA="sceneUboDeclaration",nA=`layout(std140,column_major) uniform;uniform Scene {mat4 viewProjection;
#ifdef MULTIVIEW
mat4 viewProjectionR;
#endif 
mat4 view;mat4 projection;vec4 vEyePosition;};
`;Y.IncludesShadersStore[sA]=nA;const oA="meshUboDeclaration",aA=`#ifdef WEBGL2
uniform mat4 world;uniform float visibility;
#else
layout(std140,column_major) uniform;uniform Mesh
{mat4 world;float visibility;};
#endif
#define WORLD_UBO
`;Y.IncludesShadersStore[oA]=aA;const lA="defaultUboDeclaration",hA=`layout(std140,column_major) uniform;uniform Material
{vec4 diffuseLeftColor;vec4 diffuseRightColor;vec4 opacityParts;vec4 reflectionLeftColor;vec4 reflectionRightColor;vec4 refractionLeftColor;vec4 refractionRightColor;vec4 emissiveLeftColor;vec4 emissiveRightColor;vec2 vDiffuseInfos;vec2 vAmbientInfos;vec2 vOpacityInfos;vec2 vReflectionInfos;vec3 vReflectionPosition;vec3 vReflectionSize;vec2 vEmissiveInfos;vec2 vLightmapInfos;vec2 vSpecularInfos;vec3 vBumpInfos;mat4 diffuseMatrix;mat4 ambientMatrix;mat4 opacityMatrix;mat4 reflectionMatrix;mat4 emissiveMatrix;mat4 lightmapMatrix;mat4 specularMatrix;mat4 bumpMatrix;vec2 vTangentSpaceParams;float pointSize;float alphaCutOff;mat4 refractionMatrix;vec4 vRefractionInfos;vec3 vRefractionPosition;vec3 vRefractionSize;vec4 vSpecularColor;vec3 vEmissiveColor;vec4 vDiffuseColor;vec3 vAmbientColor;
#define ADDITIONAL_UBO_DECLARATION
};
#include<sceneUboDeclaration>
#include<meshUboDeclaration>
`;Y.IncludesShadersStore[lA]=hA;const cA="prePassDeclaration",uA=`#ifdef PREPASS
#extension GL_EXT_draw_buffers : require
layout(location=0) out highp vec4 glFragData[{X}];highp vec4 gl_FragColor;
#ifdef PREPASS_DEPTH
varying highp vec3 vViewPos;
#endif
#ifdef PREPASS_VELOCITY
varying highp vec4 vCurrentPosition;varying highp vec4 vPreviousPosition;
#endif
#endif
`;Y.IncludesShadersStore[cA]=uA;const dA="oitDeclaration",fA=`#ifdef ORDER_INDEPENDENT_TRANSPARENCY
#extension GL_EXT_draw_buffers : require
layout(location=0) out vec2 depth; 
layout(location=1) out vec4 frontColor;layout(location=2) out vec4 backColor;
#define MAX_DEPTH 99999.0
highp vec4 gl_FragColor;uniform sampler2D oitDepthSampler;uniform sampler2D oitFrontColorSampler;
#endif
`;Y.IncludesShadersStore[dA]=fA;const pA="mainUVVaryingDeclaration",gA=`#ifdef MAINUV{X}
varying vec2 vMainUV{X};
#endif
`;Y.IncludesShadersStore[pA]=gA;const mA="helperFunctions",_A=`const float PI=3.1415926535897932384626433832795;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float HALF_MIN=5.96046448e-08; 
const float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;
#define saturate(x) clamp(x,0.0,1.0)
#define absEps(x) abs(x)+Epsilon
#define maxEps(x) max(x,Epsilon)
#define saturateEps(x) clamp(x,Epsilon,1.0)
mat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(
vec3(i0.x,i1.x,i2.x),
vec3(i0.y,i1.y,i2.y),
vec3(i0.z,i1.z,i2.z)
);return outMatrix;}
mat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),
b11,(a22*a00-a02*a20),(-a12*a00+a02*a10),
b21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}
#if USE_EXACT_SRGB_CONVERSIONS
vec3 toLinearSpaceExact(vec3 color)
{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));
#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)
return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));
#else
return
vec3(
color.r<=0.04045 ? nearZeroSection.r : remainingSection.r,
color.g<=0.04045 ? nearZeroSection.g : remainingSection.g,
color.b<=0.04045 ? nearZeroSection.b : remainingSection.b);
#endif
}
vec3 toGammaSpaceExact(vec3 color)
{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);
#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)
return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));
#else
return
vec3(
color.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,
color.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,
color.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);
#endif
}
#endif
float toLinearSpace(float color)
{
#if USE_EXACT_SRGB_CONVERSIONS
float nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;
#else
return pow(color,LinearEncodePowerApprox);
#endif
}
vec3 toLinearSpace(vec3 color)
{
#if USE_EXACT_SRGB_CONVERSIONS
return toLinearSpaceExact(color);
#else
return pow(color,vec3(LinearEncodePowerApprox));
#endif
}
vec4 toLinearSpace(vec4 color)
{
#if USE_EXACT_SRGB_CONVERSIONS
return vec4(toLinearSpaceExact(color.rgb),color.a);
#else
return vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);
#endif
}
float toGammaSpace(float color)
{
#if USE_EXACT_SRGB_CONVERSIONS
float nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;
#else
return pow(color,GammaEncodePowerApprox);
#endif
}
vec3 toGammaSpace(vec3 color)
{
#if USE_EXACT_SRGB_CONVERSIONS
return toGammaSpaceExact(color);
#else
return pow(color,vec3(GammaEncodePowerApprox));
#endif
}
vec4 toGammaSpace(vec4 color)
{
#if USE_EXACT_SRGB_CONVERSIONS
return vec4(toGammaSpaceExact(color.rgb),color.a);
#else
return vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);
#endif
}
float square(float value)
{return value*value;}
vec3 square(vec3 value)
{return value*value;}
float pow5(float value) {float sq=value*value;return sq*sq*value;}
float getLuminance(vec3 color)
{return clamp(dot(color,LuminanceEncodeApprox),0.,1.);}
float getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}
float dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}
const float rgbdMaxRange=255.0;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(clamp(rgb,0.,1.),D); }
vec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}
vec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.0,1.0,1.0)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}
`;Y.IncludesShadersStore[mA]=_A;const vA="lightFragmentDeclaration",EA=`#ifdef LIGHT{X}
uniform vec4 vLightData{X};uniform vec4 vLightDiffuse{X};
#ifdef SPECULARTERM
uniform vec4 vLightSpecular{X};
#else
vec4 vLightSpecular{X}=vec4(0.);
#endif
#ifdef SHADOW{X}
#ifdef SHADOWCSM{X}
uniform mat4 lightMatrix{X}[SHADOWCSMNUM_CASCADES{X}];uniform float viewFrustumZ{X}[SHADOWCSMNUM_CASCADES{X}];uniform float frustumLengths{X}[SHADOWCSMNUM_CASCADES{X}];uniform float cascadeBlendFactor{X};varying vec4 vPositionFromLight{X}[SHADOWCSMNUM_CASCADES{X}];varying float vDepthMetric{X}[SHADOWCSMNUM_CASCADES{X}];varying vec4 vPositionFromCamera{X};
#if defined(SHADOWPCSS{X})
uniform highp sampler2DArrayShadow shadowSampler{X};uniform highp sampler2DArray depthSampler{X};uniform vec2 lightSizeUVCorrection{X}[SHADOWCSMNUM_CASCADES{X}];uniform float depthCorrection{X}[SHADOWCSMNUM_CASCADES{X}];uniform float penumbraDarkness{X};
#elif defined(SHADOWPCF{X})
uniform highp sampler2DArrayShadow shadowSampler{X};
#else
uniform highp sampler2DArray shadowSampler{X};
#endif
#ifdef SHADOWCSMDEBUG{X}
const vec3 vCascadeColorsMultiplier{X}[8]=vec3[8]
(
vec3 ( 1.5,0.0,0.0 ),
vec3 ( 0.0,1.5,0.0 ),
vec3 ( 0.0,0.0,5.5 ),
vec3 ( 1.5,0.0,5.5 ),
vec3 ( 1.5,1.5,0.0 ),
vec3 ( 1.0,1.0,1.0 ),
vec3 ( 0.0,1.0,5.5 ),
vec3 ( 0.5,3.5,0.75 )
);vec3 shadowDebug{X};
#endif
#ifdef SHADOWCSMUSESHADOWMAXZ{X}
int index{X}=-1;
#else
int index{X}=SHADOWCSMNUM_CASCADES{X}-1;
#endif
float diff{X}=0.;
#elif defined(SHADOWCUBE{X})
uniform samplerCube shadowSampler{X};
#else
varying vec4 vPositionFromLight{X};varying float vDepthMetric{X};
#if defined(SHADOWPCSS{X})
uniform highp sampler2DShadow shadowSampler{X};uniform highp sampler2D depthSampler{X};
#elif defined(SHADOWPCF{X})
uniform highp sampler2DShadow shadowSampler{X};
#else
uniform sampler2D shadowSampler{X};
#endif
uniform mat4 lightMatrix{X};
#endif
uniform vec4 shadowsInfo{X};uniform vec2 depthValues{X};
#endif
#ifdef SPOTLIGHT{X}
uniform vec4 vLightDirection{X};uniform vec4 vLightFalloff{X};
#elif defined(POINTLIGHT{X})
uniform vec4 vLightFalloff{X};
#elif defined(HEMILIGHT{X})
uniform vec3 vLightGround{X};
#endif
#ifdef PROJECTEDLIGHTTEXTURE{X}
uniform mat4 textureProjectionMatrix{X};uniform sampler2D projectionLightSampler{X};
#endif
#endif
`;Y.IncludesShadersStore[vA]=EA;const TA="lightUboDeclaration",xA=`#ifdef LIGHT{X}
uniform Light{X}
{vec4 vLightData;vec4 vLightDiffuse;vec4 vLightSpecular;
#ifdef SPOTLIGHT{X}
vec4 vLightDirection;vec4 vLightFalloff;
#elif defined(POINTLIGHT{X})
vec4 vLightFalloff;
#elif defined(HEMILIGHT{X})
vec3 vLightGround;
#endif
vec4 shadowsInfo;vec2 depthValues;} light{X};
#ifdef PROJECTEDLIGHTTEXTURE{X}
uniform mat4 textureProjectionMatrix{X};uniform sampler2D projectionLightSampler{X};
#endif
#ifdef SHADOW{X}
#ifdef SHADOWCSM{X}
uniform mat4 lightMatrix{X}[SHADOWCSMNUM_CASCADES{X}];uniform float viewFrustumZ{X}[SHADOWCSMNUM_CASCADES{X}];uniform float frustumLengths{X}[SHADOWCSMNUM_CASCADES{X}];uniform float cascadeBlendFactor{X};varying vec4 vPositionFromLight{X}[SHADOWCSMNUM_CASCADES{X}];varying float vDepthMetric{X}[SHADOWCSMNUM_CASCADES{X}];varying vec4 vPositionFromCamera{X};
#if defined(SHADOWPCSS{X})
uniform highp sampler2DArrayShadow shadowSampler{X};uniform highp sampler2DArray depthSampler{X};uniform vec2 lightSizeUVCorrection{X}[SHADOWCSMNUM_CASCADES{X}];uniform float depthCorrection{X}[SHADOWCSMNUM_CASCADES{X}];uniform float penumbraDarkness{X};
#elif defined(SHADOWPCF{X})
uniform highp sampler2DArrayShadow shadowSampler{X};
#else
uniform highp sampler2DArray shadowSampler{X};
#endif
#ifdef SHADOWCSMDEBUG{X}
const vec3 vCascadeColorsMultiplier{X}[8]=vec3[8]
(
vec3 ( 1.5,0.0,0.0 ),
vec3 ( 0.0,1.5,0.0 ),
vec3 ( 0.0,0.0,5.5 ),
vec3 ( 1.5,0.0,5.5 ),
vec3 ( 1.5,1.5,0.0 ),
vec3 ( 1.0,1.0,1.0 ),
vec3 ( 0.0,1.0,5.5 ),
vec3 ( 0.5,3.5,0.75 )
);vec3 shadowDebug{X};
#endif
#ifdef SHADOWCSMUSESHADOWMAXZ{X}
int index{X}=-1;
#else
int index{X}=SHADOWCSMNUM_CASCADES{X}-1;
#endif
float diff{X}=0.;
#elif defined(SHADOWCUBE{X})
uniform samplerCube shadowSampler{X}; 
#else
varying vec4 vPositionFromLight{X};varying float vDepthMetric{X};
#if defined(SHADOWPCSS{X})
uniform highp sampler2DShadow shadowSampler{X};uniform highp sampler2D depthSampler{X};
#elif defined(SHADOWPCF{X})
uniform highp sampler2DShadow shadowSampler{X};
#else
uniform sampler2D shadowSampler{X};
#endif
uniform mat4 lightMatrix{X};
#endif
#endif
#endif
`;Y.IncludesShadersStore[TA]=xA;const CA="lightsFragmentFunctions",RA=`struct lightingInfo
{vec3 diffuse;
#ifdef SPECULARTERM
vec3 specular;
#endif
#ifdef NDOTL
float ndl;
#endif
};lightingInfo computeLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {lightingInfo result;vec3 lightVectorW;float attenuation=1.0;if (lightData.w==0.)
{vec3 direction=lightData.xyz-vPositionW;attenuation=max(0.,1.0-length(direction)/range);lightVectorW=normalize(direction);}
else
{lightVectorW=normalize(-lightData.xyz);}
float ndl=max(0.,dot(vNormal,lightVectorW));
#ifdef NDOTL
result.ndl=ndl;
#endif
result.diffuse=ndl*diffuseColor*attenuation;
#ifdef SPECULARTERM
vec3 angleW=normalize(viewDirectionW+lightVectorW);float specComp=max(0.,dot(vNormal,angleW));specComp=pow(specComp,max(1.,glossiness));result.specular=specComp*specularColor*attenuation;
#endif
return result;}
lightingInfo computeSpotLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec4 lightDirection,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {lightingInfo result;vec3 direction=lightData.xyz-vPositionW;vec3 lightVectorW=normalize(direction);float attenuation=max(0.,1.0-length(direction)/range);float cosAngle=max(0.,dot(lightDirection.xyz,-lightVectorW));if (cosAngle>=lightDirection.w)
{cosAngle=max(0.,pow(cosAngle,lightData.w));attenuation*=cosAngle;float ndl=max(0.,dot(vNormal,lightVectorW));
#ifdef NDOTL
result.ndl=ndl;
#endif
result.diffuse=ndl*diffuseColor*attenuation;
#ifdef SPECULARTERM
vec3 angleW=normalize(viewDirectionW+lightVectorW);float specComp=max(0.,dot(vNormal,angleW));specComp=pow(specComp,max(1.,glossiness));result.specular=specComp*specularColor*attenuation;
#endif
return result;}
result.diffuse=vec3(0.);
#ifdef SPECULARTERM
result.specular=vec3(0.);
#endif
#ifdef NDOTL
result.ndl=0.;
#endif
return result;}
lightingInfo computeHemisphericLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,vec3 groundColor,float glossiness) {lightingInfo result;float ndl=dot(vNormal,lightData.xyz)*0.5+0.5;
#ifdef NDOTL
result.ndl=ndl;
#endif
result.diffuse=mix(groundColor,diffuseColor,ndl);
#ifdef SPECULARTERM
vec3 angleW=normalize(viewDirectionW+lightData.xyz);float specComp=max(0.,dot(vNormal,angleW));specComp=pow(specComp,max(1.,glossiness));result.specular=specComp*specularColor;
#endif
return result;}
#define inline
vec3 computeProjectionTextureDiffuseLighting(sampler2D projectionLightSampler,mat4 textureProjectionMatrix){vec4 strq=textureProjectionMatrix*vec4(vPositionW,1.0);strq/=strq.w;vec3 textureColor=texture2D(projectionLightSampler,strq.xy).rgb;return textureColor;}`;Y.IncludesShadersStore[CA]=RA;const SA="shadowsFragmentFunctions",yA=`#ifdef SHADOWS
#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)
#define TEXTUREFUNC(s,c,l) texture2DLodEXT(s,c,l)
#else
#define TEXTUREFUNC(s,c,b) texture2D(s,c,b)
#endif
#ifndef SHADOWFLOAT
float unpack(vec4 color)
{const vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(color,bit_shift);}
#endif
float computeFallOff(float value,vec2 clipSpace,float frustumEdgeFalloff)
{float mask=smoothstep(1.0-frustumEdgeFalloff,1.00000012,clamp(dot(clipSpace,clipSpace),0.,1.));return mix(value,1.0,mask);}
#define inline
float computeShadowCube(vec3 worldPos,vec3 lightPosition,samplerCube shadowSampler,float darkness,vec2 depthValues)
{vec3 directionToLight=worldPos-lightPosition;float depth=length(directionToLight);depth=(depth+depthValues.x)/(depthValues.y);depth=clamp(depth,0.,1.0);directionToLight=normalize(directionToLight);directionToLight.y=-directionToLight.y;
#ifndef SHADOWFLOAT
float shadow=unpack(textureCube(shadowSampler,directionToLight));
#else
float shadow=textureCube(shadowSampler,directionToLight).x;
#endif
return depth>shadow ? darkness : 1.0;}
#define inline
float computeShadowWithPoissonSamplingCube(vec3 worldPos,vec3 lightPosition,samplerCube shadowSampler,float mapSize,float darkness,vec2 depthValues)
{vec3 directionToLight=worldPos-lightPosition;float depth=length(directionToLight);depth=(depth+depthValues.x)/(depthValues.y);depth=clamp(depth,0.,1.0);directionToLight=normalize(directionToLight);directionToLight.y=-directionToLight.y;float visibility=1.;vec3 poissonDisk[4];poissonDisk[0]=vec3(-1.0,1.0,-1.0);poissonDisk[1]=vec3(1.0,-1.0,-1.0);poissonDisk[2]=vec3(-1.0,-1.0,-1.0);poissonDisk[3]=vec3(1.0,-1.0,1.0);
#ifndef SHADOWFLOAT
if (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize))<depth) visibility-=0.25;if (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize))<depth) visibility-=0.25;if (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize))<depth) visibility-=0.25;if (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize))<depth) visibility-=0.25;
#else
if (textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize).x<depth) visibility-=0.25;if (textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize).x<depth) visibility-=0.25;if (textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize).x<depth) visibility-=0.25;if (textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize).x<depth) visibility-=0.25;
#endif
return min(1.0,visibility+darkness);}
#define inline
float computeShadowWithESMCube(vec3 worldPos,vec3 lightPosition,samplerCube shadowSampler,float darkness,float depthScale,vec2 depthValues)
{vec3 directionToLight=worldPos-lightPosition;float depth=length(directionToLight);depth=(depth+depthValues.x)/(depthValues.y);float shadowPixelDepth=clamp(depth,0.,1.0);directionToLight=normalize(directionToLight);directionToLight.y=-directionToLight.y;
#ifndef SHADOWFLOAT
float shadowMapSample=unpack(textureCube(shadowSampler,directionToLight));
#else
float shadowMapSample=textureCube(shadowSampler,directionToLight).x;
#endif
float esm=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness);return esm;}
#define inline
float computeShadowWithCloseESMCube(vec3 worldPos,vec3 lightPosition,samplerCube shadowSampler,float darkness,float depthScale,vec2 depthValues)
{vec3 directionToLight=worldPos-lightPosition;float depth=length(directionToLight);depth=(depth+depthValues.x)/(depthValues.y);float shadowPixelDepth=clamp(depth,0.,1.0);directionToLight=normalize(directionToLight);directionToLight.y=-directionToLight.y;
#ifndef SHADOWFLOAT
float shadowMapSample=unpack(textureCube(shadowSampler,directionToLight));
#else
float shadowMapSample=textureCube(shadowSampler,directionToLight).x;
#endif
float esm=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);return esm;}
#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)
#define inline
float computeShadowCSM(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray shadowSampler,float darkness,float frustumEdgeFalloff)
{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec2 uv=0.5*clipSpace.xy+vec2(0.5);vec3 uvLayer=vec3(uv.x,uv.y,layer);float shadowPixelDepth=clamp(depthMetric,0.,1.0);
#ifndef SHADOWFLOAT
float shadow=unpack(texture2D(shadowSampler,uvLayer));
#else
float shadow=texture2D(shadowSampler,uvLayer).x;
#endif
return shadowPixelDepth>shadow ? computeFallOff(darkness,clipSpace.xy,frustumEdgeFalloff) : 1.;}
#endif
#define inline
float computeShadow(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float frustumEdgeFalloff)
{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec2 uv=0.5*clipSpace.xy+vec2(0.5);if (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)
{return 1.0;}
else
{float shadowPixelDepth=clamp(depthMetric,0.,1.0);
#ifndef SHADOWFLOAT
float shadow=unpack(TEXTUREFUNC(shadowSampler,uv,0.));
#else
float shadow=TEXTUREFUNC(shadowSampler,uv,0.).x;
#endif
return shadowPixelDepth>shadow ? computeFallOff(darkness,clipSpace.xy,frustumEdgeFalloff) : 1.;}}
#define inline
float computeShadowWithPoissonSampling(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float mapSize,float darkness,float frustumEdgeFalloff)
{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec2 uv=0.5*clipSpace.xy+vec2(0.5);if (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)
{return 1.0;}
else
{float shadowPixelDepth=clamp(depthMetric,0.,1.0);float visibility=1.;vec2 poissonDisk[4];poissonDisk[0]=vec2(-0.94201624,-0.39906216);poissonDisk[1]=vec2(0.94558609,-0.76890725);poissonDisk[2]=vec2(-0.094184101,-0.92938870);poissonDisk[3]=vec2(0.34495938,0.29387760);
#ifndef SHADOWFLOAT
if (unpack(TEXTUREFUNC(shadowSampler,uv+poissonDisk[0]*mapSize,0.))<shadowPixelDepth) visibility-=0.25;if (unpack(TEXTUREFUNC(shadowSampler,uv+poissonDisk[1]*mapSize,0.))<shadowPixelDepth) visibility-=0.25;if (unpack(TEXTUREFUNC(shadowSampler,uv+poissonDisk[2]*mapSize,0.))<shadowPixelDepth) visibility-=0.25;if (unpack(TEXTUREFUNC(shadowSampler,uv+poissonDisk[3]*mapSize,0.))<shadowPixelDepth) visibility-=0.25;
#else
if (TEXTUREFUNC(shadowSampler,uv+poissonDisk[0]*mapSize,0.).x<shadowPixelDepth) visibility-=0.25;if (TEXTUREFUNC(shadowSampler,uv+poissonDisk[1]*mapSize,0.).x<shadowPixelDepth) visibility-=0.25;if (TEXTUREFUNC(shadowSampler,uv+poissonDisk[2]*mapSize,0.).x<shadowPixelDepth) visibility-=0.25;if (TEXTUREFUNC(shadowSampler,uv+poissonDisk[3]*mapSize,0.).x<shadowPixelDepth) visibility-=0.25;
#endif
return computeFallOff(min(1.0,visibility+darkness),clipSpace.xy,frustumEdgeFalloff);}}
#define inline
float computeShadowWithESM(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float depthScale,float frustumEdgeFalloff)
{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec2 uv=0.5*clipSpace.xy+vec2(0.5);if (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)
{return 1.0;}
else
{float shadowPixelDepth=clamp(depthMetric,0.,1.0);
#ifndef SHADOWFLOAT
float shadowMapSample=unpack(TEXTUREFUNC(shadowSampler,uv,0.));
#else
float shadowMapSample=TEXTUREFUNC(shadowSampler,uv,0.).x;
#endif
float esm=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness);return computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);}}
#define inline
float computeShadowWithCloseESM(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float depthScale,float frustumEdgeFalloff)
{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec2 uv=0.5*clipSpace.xy+vec2(0.5);if (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)
{return 1.0;}
else
{float shadowPixelDepth=clamp(depthMetric,0.,1.0); 
#ifndef SHADOWFLOAT
float shadowMapSample=unpack(TEXTUREFUNC(shadowSampler,uv,0.));
#else
float shadowMapSample=TEXTUREFUNC(shadowSampler,uv,0.).x;
#endif
float esm=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);return computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);}}
#ifdef IS_NDC_HALF_ZRANGE
#define ZINCLIP clipSpace.z
#else
#define ZINCLIP uvDepth.z
#endif
#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)
#define GREATEST_LESS_THAN_ONE 0.99999994
/* disable_uniformity_analysis */
#define inline
float computeShadowWithCSMPCF1(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArrayShadow shadowSampler,float darkness,float frustumEdgeFalloff)
{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));uvDepth.z=clamp(ZINCLIP,0.,GREATEST_LESS_THAN_ONE);vec4 uvDepthLayer=vec4(uvDepth.x,uvDepth.y,layer,uvDepth.z);float shadow=texture2D(shadowSampler,uvDepthLayer);shadow=mix(darkness,1.,shadow);return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);}
#define inline
float computeShadowWithCSMPCF3(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArrayShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)
{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));uvDepth.z=clamp(ZINCLIP,0.,GREATEST_LESS_THAN_ONE);vec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x; 
uv+=0.5; 
vec2 st=fract(uv); 
vec2 base_uv=floor(uv)-0.5; 
base_uv*=shadowMapSizeAndInverse.y; 
vec2 uvw0=3.-2.*st;vec2 uvw1=1.+2.*st;vec2 u=vec2((2.-st.x)/uvw0.x-1.,st.x/uvw1.x+1.)*shadowMapSizeAndInverse.y;vec2 v=vec2((2.-st.y)/uvw0.y-1.,st.y/uvw1.y+1.)*shadowMapSizeAndInverse.y;float shadow=0.;shadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[0]),layer,uvDepth.z));shadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[0]),layer,uvDepth.z));shadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[1]),layer,uvDepth.z));shadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[1]),layer,uvDepth.z));shadow=shadow/16.;shadow=mix(darkness,1.,shadow);return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);}
#define inline
float computeShadowWithCSMPCF5(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArrayShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)
{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));uvDepth.z=clamp(ZINCLIP,0.,GREATEST_LESS_THAN_ONE);vec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x; 
uv+=0.5; 
vec2 st=fract(uv); 
vec2 base_uv=floor(uv)-0.5; 
base_uv*=shadowMapSizeAndInverse.y; 
vec2 uvw0=4.-3.*st;vec2 uvw1=vec2(7.);vec2 uvw2=1.+3.*st;vec3 u=vec3((3.-2.*st.x)/uvw0.x-2.,(3.+st.x)/uvw1.x,st.x/uvw2.x+2.)*shadowMapSizeAndInverse.y;vec3 v=vec3((3.-2.*st.y)/uvw0.y-2.,(3.+st.y)/uvw1.y,st.y/uvw2.y+2.)*shadowMapSizeAndInverse.y;float shadow=0.;shadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[0]),layer,uvDepth.z));shadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[0]),layer,uvDepth.z));shadow+=uvw2.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[2],v[0]),layer,uvDepth.z));shadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[1]),layer,uvDepth.z));shadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[1]),layer,uvDepth.z));shadow+=uvw2.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[2],v[1]),layer,uvDepth.z));shadow+=uvw0.x*uvw2.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[2]),layer,uvDepth.z));shadow+=uvw1.x*uvw2.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[2]),layer,uvDepth.z));shadow+=uvw2.x*uvw2.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[2],v[2]),layer,uvDepth.z));shadow=shadow/144.;shadow=mix(darkness,1.,shadow);return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);}
#define inline
float computeShadowWithPCF1(vec4 vPositionFromLight,float depthMetric,highp sampler2DShadow shadowSampler,float darkness,float frustumEdgeFalloff)
{if (depthMetric>1.0 || depthMetric<0.0) {return 1.0;}
else
{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));uvDepth.z=ZINCLIP;float shadow=TEXTUREFUNC(shadowSampler,uvDepth,0.);shadow=mix(darkness,1.,shadow);return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);}}
#define inline
float computeShadowWithPCF3(vec4 vPositionFromLight,float depthMetric,highp sampler2DShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)
{if (depthMetric>1.0 || depthMetric<0.0) {return 1.0;}
else
{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));uvDepth.z=ZINCLIP;vec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x; 
uv+=0.5; 
vec2 st=fract(uv); 
vec2 base_uv=floor(uv)-0.5; 
base_uv*=shadowMapSizeAndInverse.y; 
vec2 uvw0=3.-2.*st;vec2 uvw1=1.+2.*st;vec2 u=vec2((2.-st.x)/uvw0.x-1.,st.x/uvw1.x+1.)*shadowMapSizeAndInverse.y;vec2 v=vec2((2.-st.y)/uvw0.y-1.,st.y/uvw1.y+1.)*shadowMapSizeAndInverse.y;float shadow=0.;shadow+=uvw0.x*uvw0.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[0]),uvDepth.z),0.);shadow+=uvw1.x*uvw0.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[0]),uvDepth.z),0.);shadow+=uvw0.x*uvw1.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[1]),uvDepth.z),0.);shadow+=uvw1.x*uvw1.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[1]),uvDepth.z),0.);shadow=shadow/16.;shadow=mix(darkness,1.,shadow);return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);}}
#define inline
float computeShadowWithPCF5(vec4 vPositionFromLight,float depthMetric,highp sampler2DShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)
{if (depthMetric>1.0 || depthMetric<0.0) {return 1.0;}
else
{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));uvDepth.z=ZINCLIP;vec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x; 
uv+=0.5; 
vec2 st=fract(uv); 
vec2 base_uv=floor(uv)-0.5; 
base_uv*=shadowMapSizeAndInverse.y; 
vec2 uvw0=4.-3.*st;vec2 uvw1=vec2(7.);vec2 uvw2=1.+3.*st;vec3 u=vec3((3.-2.*st.x)/uvw0.x-2.,(3.+st.x)/uvw1.x,st.x/uvw2.x+2.)*shadowMapSizeAndInverse.y;vec3 v=vec3((3.-2.*st.y)/uvw0.y-2.,(3.+st.y)/uvw1.y,st.y/uvw2.y+2.)*shadowMapSizeAndInverse.y;float shadow=0.;shadow+=uvw0.x*uvw0.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[0]),uvDepth.z),0.);shadow+=uvw1.x*uvw0.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[0]),uvDepth.z),0.);shadow+=uvw2.x*uvw0.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[0]),uvDepth.z),0.);shadow+=uvw0.x*uvw1.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[1]),uvDepth.z),0.);shadow+=uvw1.x*uvw1.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[1]),uvDepth.z),0.);shadow+=uvw2.x*uvw1.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[1]),uvDepth.z),0.);shadow+=uvw0.x*uvw2.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[2]),uvDepth.z),0.);shadow+=uvw1.x*uvw2.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[2]),uvDepth.z),0.);shadow+=uvw2.x*uvw2.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[2]),uvDepth.z),0.);shadow=shadow/144.;shadow=mix(darkness,1.,shadow);return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);}}
const vec3 PoissonSamplers32[64]=vec3[64](
vec3(0.06407013,0.05409927,0.),
vec3(0.7366577,0.5789394,0.),
vec3(-0.6270542,-0.5320278,0.),
vec3(-0.4096107,0.8411095,0.),
vec3(0.6849564,-0.4990818,0.),
vec3(-0.874181,-0.04579735,0.),
vec3(0.9989998,0.0009880066,0.),
vec3(-0.004920578,-0.9151649,0.),
vec3(0.1805763,0.9747483,0.),
vec3(-0.2138451,0.2635818,0.),
vec3(0.109845,0.3884785,0.),
vec3(0.06876755,-0.3581074,0.),
vec3(0.374073,-0.7661266,0.),
vec3(0.3079132,-0.1216763,0.),
vec3(-0.3794335,-0.8271583,0.),
vec3(-0.203878,-0.07715034,0.),
vec3(0.5912697,0.1469799,0.),
vec3(-0.88069,0.3031784,0.),
vec3(0.5040108,0.8283722,0.),
vec3(-0.5844124,0.5494877,0.),
vec3(0.6017799,-0.1726654,0.),
vec3(-0.5554981,0.1559997,0.),
vec3(-0.3016369,-0.3900928,0.),
vec3(-0.5550632,-0.1723762,0.),
vec3(0.925029,0.2995041,0.),
vec3(-0.2473137,0.5538505,0.),
vec3(0.9183037,-0.2862392,0.),
vec3(0.2469421,0.6718712,0.),
vec3(0.3916397,-0.4328209,0.),
vec3(-0.03576927,-0.6220032,0.),
vec3(-0.04661255,0.7995201,0.),
vec3(0.4402924,0.3640312,0.),
vec3(0.),
vec3(0.),
vec3(0.),
vec3(0.),
vec3(0.),
vec3(0.),
vec3(0.),
vec3(0.),
vec3(0.),
vec3(0.),
vec3(0.),
vec3(0.),
vec3(0.),
vec3(0.),
vec3(0.),
vec3(0.),
vec3(0.),
vec3(0.),
vec3(0.),
vec3(0.),
vec3(0.),
vec3(0.),
vec3(0.),
vec3(0.),
vec3(0.),
vec3(0.),
vec3(0.),
vec3(0.),
vec3(0.),
vec3(0.),
vec3(0.),
vec3(0.)
);const vec3 PoissonSamplers64[64]=vec3[64](
vec3(-0.613392,0.617481,0.),
vec3(0.170019,-0.040254,0.),
vec3(-0.299417,0.791925,0.),
vec3(0.645680,0.493210,0.),
vec3(-0.651784,0.717887,0.),
vec3(0.421003,0.027070,0.),
vec3(-0.817194,-0.271096,0.),
vec3(-0.705374,-0.668203,0.),
vec3(0.977050,-0.108615,0.),
vec3(0.063326,0.142369,0.),
vec3(0.203528,0.214331,0.),
vec3(-0.667531,0.326090,0.),
vec3(-0.098422,-0.295755,0.),
vec3(-0.885922,0.215369,0.),
vec3(0.566637,0.605213,0.),
vec3(0.039766,-0.396100,0.),
vec3(0.751946,0.453352,0.),
vec3(0.078707,-0.715323,0.),
vec3(-0.075838,-0.529344,0.),
vec3(0.724479,-0.580798,0.),
vec3(0.222999,-0.215125,0.),
vec3(-0.467574,-0.405438,0.),
vec3(-0.248268,-0.814753,0.),
vec3(0.354411,-0.887570,0.),
vec3(0.175817,0.382366,0.),
vec3(0.487472,-0.063082,0.),
vec3(-0.084078,0.898312,0.),
vec3(0.488876,-0.783441,0.),
vec3(0.470016,0.217933,0.),
vec3(-0.696890,-0.549791,0.),
vec3(-0.149693,0.605762,0.),
vec3(0.034211,0.979980,0.),
vec3(0.503098,-0.308878,0.),
vec3(-0.016205,-0.872921,0.),
vec3(0.385784,-0.393902,0.),
vec3(-0.146886,-0.859249,0.),
vec3(0.643361,0.164098,0.),
vec3(0.634388,-0.049471,0.),
vec3(-0.688894,0.007843,0.),
vec3(0.464034,-0.188818,0.),
vec3(-0.440840,0.137486,0.),
vec3(0.364483,0.511704,0.),
vec3(0.034028,0.325968,0.),
vec3(0.099094,-0.308023,0.),
vec3(0.693960,-0.366253,0.),
vec3(0.678884,-0.204688,0.),
vec3(0.001801,0.780328,0.),
vec3(0.145177,-0.898984,0.),
vec3(0.062655,-0.611866,0.),
vec3(0.315226,-0.604297,0.),
vec3(-0.780145,0.486251,0.),
vec3(-0.371868,0.882138,0.),
vec3(0.200476,0.494430,0.),
vec3(-0.494552,-0.711051,0.),
vec3(0.612476,0.705252,0.),
vec3(-0.578845,-0.768792,0.),
vec3(-0.772454,-0.090976,0.),
vec3(0.504440,0.372295,0.),
vec3(0.155736,0.065157,0.),
vec3(0.391522,0.849605,0.),
vec3(-0.620106,-0.328104,0.),
vec3(0.789239,-0.419965,0.),
vec3(-0.545396,0.538133,0.),
vec3(-0.178564,-0.596057,0.)
);
#define inline
float computeShadowWithCSMPCSS(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,int searchTapCount,int pcfTapCount,vec3[64] poissonSamplers,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)
{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));uvDepth.z=clamp(ZINCLIP,0.,GREATEST_LESS_THAN_ONE);vec4 uvDepthLayer=vec4(uvDepth.x,uvDepth.y,layer,uvDepth.z);float blockerDepth=0.0;float sumBlockerDepth=0.0;float numBlocker=0.0;for (int i=0; i<searchTapCount; i ++) {blockerDepth=texture2D(depthSampler,vec3(uvDepth.xy+(lightSizeUV*lightSizeUVCorrection*shadowMapSizeInverse*PoissonSamplers32[i].xy),layer)).r;if (blockerDepth<depthMetric) {sumBlockerDepth+=blockerDepth;numBlocker++;}}
float avgBlockerDepth=sumBlockerDepth/numBlocker;float AAOffset=shadowMapSizeInverse*10.;float penumbraRatio=((depthMetric-avgBlockerDepth)*depthCorrection+AAOffset);vec4 filterRadius=vec4(penumbraRatio*lightSizeUV*lightSizeUVCorrection*shadowMapSizeInverse,0.,0.);float random=getRand(vPositionFromLight.xy);float rotationAngle=random*3.1415926;vec2 rotationVector=vec2(cos(rotationAngle),sin(rotationAngle));float shadow=0.;for (int i=0; i<pcfTapCount; i++) {vec4 offset=vec4(poissonSamplers[i],0.);offset=vec4(offset.x*rotationVector.x-offset.y*rotationVector.y,offset.y*rotationVector.x+offset.x*rotationVector.y,0.,0.);shadow+=texture2D(shadowSampler,uvDepthLayer+offset*filterRadius);}
shadow/=float(pcfTapCount);shadow=mix(shadow,1.,min((depthMetric-avgBlockerDepth)*depthCorrection*penumbraDarkness,1.));shadow=mix(darkness,1.,shadow);if (numBlocker<1.0) {return 1.0;}
else
{return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);}}
#define inline
float computeShadowWithPCSS(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,highp sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,int searchTapCount,int pcfTapCount,vec3[64] poissonSamplers)
{if (depthMetric>1.0 || depthMetric<0.0) {return 1.0;}
else
{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));uvDepth.z=ZINCLIP;float blockerDepth=0.0;float sumBlockerDepth=0.0;float numBlocker=0.0;for (int i=0; i<searchTapCount; i ++) {blockerDepth=TEXTUREFUNC(depthSampler,uvDepth.xy+(lightSizeUV*shadowMapSizeInverse*PoissonSamplers32[i].xy),0.).r;if (blockerDepth<depthMetric) {sumBlockerDepth+=blockerDepth;numBlocker++;}}
if (numBlocker<1.0) {return 1.0;}
else
{float avgBlockerDepth=sumBlockerDepth/numBlocker;float AAOffset=shadowMapSizeInverse*10.;float penumbraRatio=((depthMetric-avgBlockerDepth)+AAOffset);float filterRadius=penumbraRatio*lightSizeUV*shadowMapSizeInverse;float random=getRand(vPositionFromLight.xy);float rotationAngle=random*3.1415926;vec2 rotationVector=vec2(cos(rotationAngle),sin(rotationAngle));float shadow=0.;for (int i=0; i<pcfTapCount; i++) {vec3 offset=poissonSamplers[i];offset=vec3(offset.x*rotationVector.x-offset.y*rotationVector.y,offset.y*rotationVector.x+offset.x*rotationVector.y,0.);shadow+=TEXTUREFUNC(shadowSampler,uvDepth+offset*filterRadius,0.);}
shadow/=float(pcfTapCount);shadow=mix(shadow,1.,depthMetric-avgBlockerDepth);shadow=mix(darkness,1.,shadow);return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);}}}
#define inline
float computeShadowWithPCSS16(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,highp sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)
{return computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,16,PoissonSamplers32);}
#define inline
float computeShadowWithPCSS32(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,highp sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)
{return computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,32,PoissonSamplers32);}
#define inline
float computeShadowWithPCSS64(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,highp sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)
{return computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,32,64,PoissonSamplers64);}
#define inline
float computeShadowWithCSMPCSS16(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)
{return computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,16,PoissonSamplers32,lightSizeUVCorrection,depthCorrection,penumbraDarkness);}
#define inline
float computeShadowWithCSMPCSS32(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)
{return computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,32,PoissonSamplers32,lightSizeUVCorrection,depthCorrection,penumbraDarkness);}
#define inline
float computeShadowWithCSMPCSS64(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)
{return computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,32,64,PoissonSamplers64,lightSizeUVCorrection,depthCorrection,penumbraDarkness);}
#endif
#endif
`;Y.IncludesShadersStore[SA]=yA;const bA="samplerFragmentDeclaration",IA=`#ifdef _DEFINENAME_
#if _DEFINENAME_DIRECTUV==1
#define v_VARYINGNAME_UV vMainUV1
#elif _DEFINENAME_DIRECTUV==2
#define v_VARYINGNAME_UV vMainUV2
#elif _DEFINENAME_DIRECTUV==3
#define v_VARYINGNAME_UV vMainUV3
#elif _DEFINENAME_DIRECTUV==4
#define v_VARYINGNAME_UV vMainUV4
#elif _DEFINENAME_DIRECTUV==5
#define v_VARYINGNAME_UV vMainUV5
#elif _DEFINENAME_DIRECTUV==6
#define v_VARYINGNAME_UV vMainUV6
#else
varying vec2 v_VARYINGNAME_UV;
#endif
uniform sampler2D _SAMPLERNAME_Sampler;
#endif
`;Y.IncludesShadersStore[bA]=IA;const AA="fresnelFunction",MA=`#ifdef FRESNEL
float computeFresnelTerm(vec3 viewDirection,vec3 worldNormal,float bias,float power)
{float fresnelTerm=pow(bias+abs(dot(viewDirection,worldNormal)),power);return clamp(fresnelTerm,0.,1.);}
#endif
`;Y.IncludesShadersStore[AA]=MA;const PA="reflectionFunction",OA=`vec3 computeFixedEquirectangularCoords(vec4 worldPos,vec3 worldNormal,vec3 direction)
{float lon=atan(direction.z,direction.x);float lat=acos(direction.y);vec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;float s=sphereCoords.x*0.5+0.5;float t=sphereCoords.y;return vec3(s,t,0); }
vec3 computeMirroredFixedEquirectangularCoords(vec4 worldPos,vec3 worldNormal,vec3 direction)
{float lon=atan(direction.z,direction.x);float lat=acos(direction.y);vec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;float s=sphereCoords.x*0.5+0.5;float t=sphereCoords.y;return vec3(1.0-s,t,0); }
vec3 computeEquirectangularCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix)
{vec3 cameraToVertex=normalize(worldPos.xyz-eyePosition);vec3 r=normalize(reflect(cameraToVertex,worldNormal));r=vec3(reflectionMatrix*vec4(r,0));float lon=atan(r.z,r.x);float lat=acos(r.y);vec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;float s=sphereCoords.x*0.5+0.5;float t=sphereCoords.y;return vec3(s,t,0);}
vec3 computeSphericalCoords(vec4 worldPos,vec3 worldNormal,mat4 view,mat4 reflectionMatrix)
{vec3 viewDir=normalize(vec3(view*worldPos));vec3 viewNormal=normalize(vec3(view*vec4(worldNormal,0.0)));vec3 r=reflect(viewDir,viewNormal);r=vec3(reflectionMatrix*vec4(r,0));r.z=r.z-1.0;float m=2.0*length(r);return vec3(r.x/m+0.5,1.0-r.y/m-0.5,0);}
vec3 computePlanarCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix)
{vec3 viewDir=worldPos.xyz-eyePosition;vec3 coords=normalize(reflect(viewDir,worldNormal));return vec3(reflectionMatrix*vec4(coords,1));}
vec3 computeCubicCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix)
{vec3 viewDir=normalize(worldPos.xyz-eyePosition);vec3 coords=reflect(viewDir,worldNormal);coords=vec3(reflectionMatrix*vec4(coords,0));
#ifdef INVERTCUBICMAP
coords.y*=-1.0;
#endif
return coords;}
vec3 computeCubicLocalCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix,vec3 reflectionSize,vec3 reflectionPosition)
{vec3 viewDir=normalize(worldPos.xyz-eyePosition);vec3 coords=reflect(viewDir,worldNormal);coords=parallaxCorrectNormal(worldPos.xyz,coords,reflectionSize,reflectionPosition);coords=vec3(reflectionMatrix*vec4(coords,0));
#ifdef INVERTCUBICMAP
coords.y*=-1.0;
#endif
return coords;}
vec3 computeProjectionCoords(vec4 worldPos,mat4 view,mat4 reflectionMatrix)
{return vec3(reflectionMatrix*(view*worldPos));}
vec3 computeSkyBoxCoords(vec3 positionW,mat4 reflectionMatrix)
{return vec3(reflectionMatrix*vec4(positionW,1.));}
#ifdef REFLECTION
vec3 computeReflectionCoords(vec4 worldPos,vec3 worldNormal)
{
#ifdef REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED
vec3 direction=normalize(vDirectionW);return computeMirroredFixedEquirectangularCoords(worldPos,worldNormal,direction);
#endif
#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED
vec3 direction=normalize(vDirectionW);return computeFixedEquirectangularCoords(worldPos,worldNormal,direction);
#endif
#ifdef REFLECTIONMAP_EQUIRECTANGULAR
return computeEquirectangularCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix);
#endif
#ifdef REFLECTIONMAP_SPHERICAL
return computeSphericalCoords(worldPos,worldNormal,view,reflectionMatrix);
#endif
#ifdef REFLECTIONMAP_PLANAR
return computePlanarCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix);
#endif
#ifdef REFLECTIONMAP_CUBIC
#ifdef USE_LOCAL_REFLECTIONMAP_CUBIC
return computeCubicLocalCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix,vReflectionSize,vReflectionPosition);
#else
return computeCubicCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix);
#endif
#endif
#ifdef REFLECTIONMAP_PROJECTION
return computeProjectionCoords(worldPos,view,reflectionMatrix);
#endif
#ifdef REFLECTIONMAP_SKYBOX
return computeSkyBoxCoords(vPositionUVW,reflectionMatrix);
#endif
#ifdef REFLECTIONMAP_EXPLICIT
return vec3(0,0,0);
#endif
}
#endif
`;Y.IncludesShadersStore[PA]=OA;const DA="imageProcessingDeclaration",NA=`#ifdef EXPOSURE
uniform float exposureLinear;
#endif
#ifdef CONTRAST
uniform float contrast;
#endif
#if defined(VIGNETTE) || defined(DITHER)
uniform vec2 vInverseScreenSize;
#endif
#ifdef VIGNETTE
uniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;
#endif
#ifdef COLORCURVES
uniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;
#endif
#ifdef COLORGRADING
#ifdef COLORGRADING3D
uniform highp sampler3D txColorTransform;
#else
uniform sampler2D txColorTransform;
#endif
uniform vec4 colorTransformSettings;
#endif
#ifdef DITHER
uniform float ditherIntensity;
#endif
`;Y.IncludesShadersStore[DA]=NA;const FA="imageProcessingFunctions",LA=`#if defined(COLORGRADING) && !defined(COLORGRADING3D)
/** 
* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.
* sampler3dSetting.x=textureOffset (0.5/textureSize).
* sampler3dSetting.y=textureSize.
*/
#define inline
vec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)
{float sliceSize=2.0*sampler3dSetting.x; 
#ifdef SAMPLER3DGREENDEPTH
float sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;
#else
float sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;
#endif
float sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;
#ifdef SAMPLER3DGREENDEPTH
vec2 sliceUV=color.rb;
#else
vec2 sliceUV=color.rg;
#endif
sliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);
#ifdef SAMPLER3DBGRMAP
color.rgb=result.rgb;
#else
color.rgb=result.bgr;
#endif
return color;}
#endif
#ifdef TONEMAPPING_ACES
const mat3 ACESInputMat=mat3(
vec3(0.59719,0.07600,0.02840),
vec3(0.35458,0.90834,0.13383),
vec3(0.04823,0.01566,0.83777)
);const mat3 ACESOutputMat=mat3(
vec3( 1.60475,-0.10208,-0.00327),
vec3(-0.53108, 1.10813,-0.07276),
vec3(-0.07367,-0.00605, 1.07602)
);vec3 RRTAndODTFit(vec3 v)
{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}
vec3 ACESFitted(vec3 color)
{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}
#endif
#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS
vec4 applyImageProcessing(vec4 result) {
#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART
#ifdef EXPOSURE
result.rgb*=exposureLinear;
#endif
#ifdef VIGNETTE
vec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;
#ifdef VIGNETTEBLENDMODEMULTIPLY
vec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;
#endif
#ifdef VIGNETTEBLENDMODEOPAQUE
result.rgb=mix(vignetteColor,result.rgb,vignette);
#endif
#endif
#ifdef TONEMAPPING
#ifdef TONEMAPPING_ACES
result.rgb=ACESFitted(result.rgb);
#else
const float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);
#endif
#endif
result.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);
#ifdef CONTRAST
vec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}
#endif
#ifdef COLORGRADING
vec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;
#ifdef COLORGRADING3D
vec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;
#else
vec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;
#endif
result.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);
#endif
#ifdef COLORCURVES
float luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);
#endif
#ifdef DITHER
float rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));
#endif
#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND
return result;}`;Y.IncludesShadersStore[FA]=LA;const wA="bumpFragmentMainFunctions",UA=`#if defined(BUMP) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC) || defined(DETAIL)
#if defined(TANGENT) && defined(NORMAL) 
varying mat3 vTBN;
#endif
#ifdef OBJECTSPACE_NORMALMAP
uniform mat4 normalMatrix;
#if defined(WEBGL2) || defined(WEBGPU)
mat4 toNormalMatrix(mat4 wMatrix)
{mat4 ret=inverse(wMatrix);ret=transpose(ret);ret[0][3]=0.;ret[1][3]=0.;ret[2][3]=0.;ret[3]=vec4(0.,0.,0.,1.);return ret;}
#else
mat4 toNormalMatrix(mat4 m)
{float
a00=m[0][0],a01=m[0][1],a02=m[0][2],a03=m[0][3],
a10=m[1][0],a11=m[1][1],a12=m[1][2],a13=m[1][3],
a20=m[2][0],a21=m[2][1],a22=m[2][2],a23=m[2][3],
a30=m[3][0],a31=m[3][1],a32=m[3][2],a33=m[3][3],
b00=a00*a11-a01*a10,
b01=a00*a12-a02*a10,
b02=a00*a13-a03*a10,
b03=a01*a12-a02*a11,
b04=a01*a13-a03*a11,
b05=a02*a13-a03*a12,
b06=a20*a31-a21*a30,
b07=a20*a32-a22*a30,
b08=a20*a33-a23*a30,
b09=a21*a32-a22*a31,
b10=a21*a33-a23*a31,
b11=a22*a33-a23*a32,
det=b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06;mat4 mi=mat4(
a11*b11-a12*b10+a13*b09,
a02*b10-a01*b11-a03*b09,
a31*b05-a32*b04+a33*b03,
a22*b04-a21*b05-a23*b03,
a12*b08-a10*b11-a13*b07,
a00*b11-a02*b08+a03*b07,
a32*b02-a30*b05-a33*b01,
a20*b05-a22*b02+a23*b01,
a10*b10-a11*b08+a13*b06,
a01*b08-a00*b10-a03*b06,
a30*b04-a31*b02+a33*b00,
a21*b02-a20*b04-a23*b00,
a11*b07-a10*b09-a12*b06,
a00*b09-a01*b07+a02*b06,
a31*b01-a30*b03-a32*b00,
a20*b03-a21*b01+a22*b00)/det;return mat4(mi[0][0],mi[1][0],mi[2][0],mi[3][0],
mi[0][1],mi[1][1],mi[2][1],mi[3][1],
mi[0][2],mi[1][2],mi[2][2],mi[3][2],
mi[0][3],mi[1][3],mi[2][3],mi[3][3]);}
#endif
#endif
vec3 perturbNormalBase(mat3 cotangentFrame,vec3 normal,float scale)
{
#ifdef NORMALXYSCALE
normal=normalize(normal*vec3(scale,scale,1.0));
#endif
return normalize(cotangentFrame*normal);}
vec3 perturbNormal(mat3 cotangentFrame,vec3 textureSample,float scale)
{return perturbNormalBase(cotangentFrame,textureSample*2.0-1.0,scale);}
mat3 cotangent_frame(vec3 normal,vec3 p,vec2 uv,vec2 tangentSpaceParams)
{vec3 dp1=dFdx(p);vec3 dp2=dFdy(p);vec2 duv1=dFdx(uv);vec2 duv2=dFdy(uv);vec3 dp2perp=cross(dp2,normal);vec3 dp1perp=cross(normal,dp1);vec3 tangent=dp2perp*duv1.x+dp1perp*duv2.x;vec3 bitangent=dp2perp*duv1.y+dp1perp*duv2.y;tangent*=tangentSpaceParams.x;bitangent*=tangentSpaceParams.y;float det=max(dot(tangent,tangent),dot(bitangent,bitangent));float invmax=det==0.0 ? 0.0 : inversesqrt(det);return mat3(tangent*invmax,bitangent*invmax,normal);}
#endif
`;Y.IncludesShadersStore[wA]=UA;const VA="bumpFragmentFunctions",BA=`#if defined(BUMP)
#include<samplerFragmentDeclaration>(_DEFINENAME_,BUMP,_VARYINGNAME_,Bump,_SAMPLERNAME_,bump)
#endif
#if defined(DETAIL)
#include<samplerFragmentDeclaration>(_DEFINENAME_,DETAIL,_VARYINGNAME_,Detail,_SAMPLERNAME_,detail)
#endif
#if defined(BUMP) && defined(PARALLAX)
const float minSamples=4.;const float maxSamples=15.;const int iMaxSamples=15;vec2 parallaxOcclusion(vec3 vViewDirCoT,vec3 vNormalCoT,vec2 texCoord,float parallaxScale) {float parallaxLimit=length(vViewDirCoT.xy)/vViewDirCoT.z;parallaxLimit*=parallaxScale;vec2 vOffsetDir=normalize(vViewDirCoT.xy);vec2 vMaxOffset=vOffsetDir*parallaxLimit;float numSamples=maxSamples+(dot(vViewDirCoT,vNormalCoT)*(minSamples-maxSamples));float stepSize=1.0/numSamples;float currRayHeight=1.0;vec2 vCurrOffset=vec2(0,0);vec2 vLastOffset=vec2(0,0);float lastSampledHeight=1.0;float currSampledHeight=1.0;bool keepWorking=true;for (int i=0; i<iMaxSamples; i++)
{currSampledHeight=texture2D(bumpSampler,texCoord+vCurrOffset).w;if (!keepWorking)
{}
else if (currSampledHeight>currRayHeight)
{float delta1=currSampledHeight-currRayHeight;float delta2=(currRayHeight+stepSize)-lastSampledHeight;float ratio=delta1/(delta1+delta2);vCurrOffset=(ratio)* vLastOffset+(1.0-ratio)*vCurrOffset;keepWorking=false;}
else
{currRayHeight-=stepSize;vLastOffset=vCurrOffset;
#ifdef PARALLAX_RHS
vCurrOffset-=stepSize*vMaxOffset;
#else
vCurrOffset+=stepSize*vMaxOffset;
#endif
lastSampledHeight=currSampledHeight;}}
return vCurrOffset;}
vec2 parallaxOffset(vec3 viewDir,float heightScale)
{float height=texture2D(bumpSampler,vBumpUV).w;vec2 texCoordOffset=heightScale*viewDir.xy*height;
#ifdef PARALLAX_RHS
return texCoordOffset;
#else
return -texCoordOffset;
#endif
}
#endif
`;Y.IncludesShadersStore[VA]=BA;const kA="logDepthDeclaration",zA=`#ifdef LOGARITHMICDEPTH
uniform float logarithmicDepthConstant;varying float vFragmentDepth;
#endif
`;Y.IncludesShadersStore[kA]=zA;const GA="bumpFragment",WA=`vec2 uvOffset=vec2(0.0,0.0);
#if defined(BUMP) || defined(PARALLAX) || defined(DETAIL)
#ifdef NORMALXYSCALE
float normalScale=1.0;
#elif defined(BUMP)
float normalScale=vBumpInfos.y;
#else
float normalScale=1.0;
#endif
#if defined(TANGENT) && defined(NORMAL)
mat3 TBN=vTBN;
#elif defined(BUMP)
vec2 TBNUV=gl_FrontFacing ? vBumpUV : -vBumpUV;mat3 TBN=cotangent_frame(normalW*normalScale,vPositionW,TBNUV,vTangentSpaceParams);
#else
vec2 TBNUV=gl_FrontFacing ? vDetailUV : -vDetailUV;mat3 TBN=cotangent_frame(normalW*normalScale,vPositionW,TBNUV,vec2(1.,1.));
#endif
#elif defined(ANISOTROPIC)
#if defined(TANGENT) && defined(NORMAL)
mat3 TBN=vTBN;
#else
vec2 TBNUV=gl_FrontFacing ? vMainUV1 : -vMainUV1;mat3 TBN=cotangent_frame(normalW,vPositionW,TBNUV,vec2(1.,1.));
#endif
#endif
#ifdef PARALLAX
mat3 invTBN=transposeMat3(TBN);
#ifdef PARALLAXOCCLUSION
uvOffset=parallaxOcclusion(invTBN*-viewDirectionW,invTBN*normalW,vBumpUV,vBumpInfos.z);
#else
uvOffset=parallaxOffset(invTBN*viewDirectionW,vBumpInfos.z);
#endif
#endif
#ifdef DETAIL
vec4 detailColor=texture2D(detailSampler,vDetailUV+uvOffset);vec2 detailNormalRG=detailColor.wy*2.0-1.0;float detailNormalB=sqrt(1.-saturate(dot(detailNormalRG,detailNormalRG)));vec3 detailNormal=vec3(detailNormalRG,detailNormalB);
#endif
#ifdef BUMP
#ifdef OBJECTSPACE_NORMALMAP
#define CUSTOM_FRAGMENT_BUMP_FRAGMENT
normalW=normalize(texture2D(bumpSampler,vBumpUV).xyz *2.0-1.0);normalW=normalize(mat3(normalMatrix)*normalW);
#elif !defined(DETAIL)
normalW=perturbNormal(TBN,texture2D(bumpSampler,vBumpUV+uvOffset).xyz,vBumpInfos.y);
#else
vec3 bumpNormal=texture2D(bumpSampler,vBumpUV+uvOffset).xyz*2.0-1.0;
#if DETAIL_NORMALBLENDMETHOD==0 
detailNormal.xy*=vDetailInfos.z;vec3 blendedNormal=normalize(vec3(bumpNormal.xy+detailNormal.xy,bumpNormal.z*detailNormal.z));
#elif DETAIL_NORMALBLENDMETHOD==1 
detailNormal.xy*=vDetailInfos.z;bumpNormal+=vec3(0.0,0.0,1.0);detailNormal*=vec3(-1.0,-1.0,1.0);vec3 blendedNormal=bumpNormal*dot(bumpNormal,detailNormal)/bumpNormal.z-detailNormal;
#endif
normalW=perturbNormalBase(TBN,blendedNormal,vBumpInfos.y);
#endif
#elif defined(DETAIL)
detailNormal.xy*=vDetailInfos.z;normalW=perturbNormalBase(TBN,detailNormal,vDetailInfos.z);
#endif
`;Y.IncludesShadersStore[GA]=WA;const XA="decalFragment",HA=`#ifdef DECAL
#ifdef GAMMADECAL
decalColor.rgb=toLinearSpace(decalColor.rgb);
#endif
#ifdef DECAL_SMOOTHALPHA
decalColor.a*=decalColor.a;
#endif
surfaceAlbedo.rgb=mix(surfaceAlbedo.rgb,decalColor.rgb,decalColor.a);
#endif
`;Y.IncludesShadersStore[XA]=HA;const KA="depthPrePass",qA=`#ifdef DEPTHPREPASS
gl_FragColor=vec4(0.,0.,0.,1.0);return;
#endif
`;Y.IncludesShadersStore[KA]=qA;const YA="lightFragment",ZA=`#ifdef LIGHT{X}
#if defined(SHADOWONLY) || defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X}) && defined(LIGHTMAPNOSPECULAR{X})
#else
#ifdef PBR
#ifdef SPOTLIGHT{X}
preInfo=computePointAndSpotPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);
#elif defined(POINTLIGHT{X})
preInfo=computePointAndSpotPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);
#elif defined(HEMILIGHT{X})
preInfo=computeHemisphericPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);
#elif defined(DIRLIGHT{X})
preInfo=computeDirectionalPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);
#endif
preInfo.NdotV=NdotV;
#ifdef SPOTLIGHT{X}
#ifdef LIGHT_FALLOFF_GLTF{X}
preInfo.attenuation=computeDistanceLightFalloff_GLTF(preInfo.lightDistanceSquared,light{X}.vLightFalloff.y);preInfo.attenuation*=computeDirectionalLightFalloff_GLTF(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightFalloff.z,light{X}.vLightFalloff.w);
#elif defined(LIGHT_FALLOFF_PHYSICAL{X})
preInfo.attenuation=computeDistanceLightFalloff_Physical(preInfo.lightDistanceSquared);preInfo.attenuation*=computeDirectionalLightFalloff_Physical(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w);
#elif defined(LIGHT_FALLOFF_STANDARD{X})
preInfo.attenuation=computeDistanceLightFalloff_Standard(preInfo.lightOffset,light{X}.vLightFalloff.x);preInfo.attenuation*=computeDirectionalLightFalloff_Standard(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w,light{X}.vLightData.w);
#else
preInfo.attenuation=computeDistanceLightFalloff(preInfo.lightOffset,preInfo.lightDistanceSquared,light{X}.vLightFalloff.x,light{X}.vLightFalloff.y);preInfo.attenuation*=computeDirectionalLightFalloff(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w,light{X}.vLightData.w,light{X}.vLightFalloff.z,light{X}.vLightFalloff.w);
#endif
#elif defined(POINTLIGHT{X})
#ifdef LIGHT_FALLOFF_GLTF{X}
preInfo.attenuation=computeDistanceLightFalloff_GLTF(preInfo.lightDistanceSquared,light{X}.vLightFalloff.y);
#elif defined(LIGHT_FALLOFF_PHYSICAL{X})
preInfo.attenuation=computeDistanceLightFalloff_Physical(preInfo.lightDistanceSquared);
#elif defined(LIGHT_FALLOFF_STANDARD{X})
preInfo.attenuation=computeDistanceLightFalloff_Standard(preInfo.lightOffset,light{X}.vLightFalloff.x);
#else
preInfo.attenuation=computeDistanceLightFalloff(preInfo.lightOffset,preInfo.lightDistanceSquared,light{X}.vLightFalloff.x,light{X}.vLightFalloff.y);
#endif
#else
preInfo.attenuation=1.0;
#endif
#ifdef HEMILIGHT{X}
preInfo.roughness=roughness;
#else
preInfo.roughness=adjustRoughnessFromLightProperties(roughness,light{X}.vLightSpecular.a,preInfo.lightDistance);
#endif
#ifdef IRIDESCENCE
preInfo.iridescenceIntensity=iridescenceIntensity;
#endif
#ifdef HEMILIGHT{X}
info.diffuse=computeHemisphericDiffuseLighting(preInfo,light{X}.vLightDiffuse.rgb,light{X}.vLightGround);
#elif defined(SS_TRANSLUCENCY)
info.diffuse=computeDiffuseAndTransmittedLighting(preInfo,light{X}.vLightDiffuse.rgb,subSurfaceOut.transmittance);
#else
info.diffuse=computeDiffuseLighting(preInfo,light{X}.vLightDiffuse.rgb);
#endif
#ifdef SPECULARTERM
#ifdef ANISOTROPIC
info.specular=computeAnisotropicSpecularLighting(preInfo,viewDirectionW,normalW,anisotropicOut.anisotropicTangent,anisotropicOut.anisotropicBitangent,anisotropicOut.anisotropy,clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);
#else
info.specular=computeSpecularLighting(preInfo,normalW,clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);
#endif
#endif
#ifdef SHEEN
#ifdef SHEEN_LINKWITHALBEDO
preInfo.roughness=sheenOut.sheenIntensity;
#else
#ifdef HEMILIGHT{X}
preInfo.roughness=sheenOut.sheenRoughness;
#else
preInfo.roughness=adjustRoughnessFromLightProperties(sheenOut.sheenRoughness,light{X}.vLightSpecular.a,preInfo.lightDistance);
#endif
#endif
info.sheen=computeSheenLighting(preInfo,normalW,sheenOut.sheenColor,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);
#endif
#ifdef CLEARCOAT
#ifdef HEMILIGHT{X}
preInfo.roughness=clearcoatOut.clearCoatRoughness;
#else
preInfo.roughness=adjustRoughnessFromLightProperties(clearcoatOut.clearCoatRoughness,light{X}.vLightSpecular.a,preInfo.lightDistance);
#endif
info.clearCoat=computeClearCoatLighting(preInfo,clearcoatOut.clearCoatNormalW,clearcoatOut.clearCoatAARoughnessFactors.x,clearcoatOut.clearCoatIntensity,light{X}.vLightDiffuse.rgb);
#ifdef CLEARCOAT_TINT
absorption=computeClearCoatLightingAbsorption(clearcoatOut.clearCoatNdotVRefract,preInfo.L,clearcoatOut.clearCoatNormalW,clearcoatOut.clearCoatColor,clearcoatOut.clearCoatThickness,clearcoatOut.clearCoatIntensity);info.diffuse*=absorption;
#ifdef SPECULARTERM
info.specular*=absorption;
#endif
#endif
info.diffuse*=info.clearCoat.w;
#ifdef SPECULARTERM
info.specular*=info.clearCoat.w;
#endif
#ifdef SHEEN
info.sheen*=info.clearCoat.w;
#endif
#endif
#else
#ifdef SPOTLIGHT{X}
info=computeSpotLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDirection,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular.rgb,light{X}.vLightDiffuse.a,glossiness);
#elif defined(HEMILIGHT{X})
info=computeHemisphericLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular.rgb,light{X}.vLightGround,glossiness);
#elif defined(POINTLIGHT{X}) || defined(DIRLIGHT{X})
info=computeLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular.rgb,light{X}.vLightDiffuse.a,glossiness);
#endif
#endif
#ifdef PROJECTEDLIGHTTEXTURE{X}
info.diffuse*=computeProjectionTextureDiffuseLighting(projectionLightSampler{X},textureProjectionMatrix{X});
#endif
#endif
#ifdef SHADOW{X}
#ifdef SHADOWCSM{X}
for (int i=0; i<SHADOWCSMNUM_CASCADES{X}; i++) 
{
#ifdef SHADOWCSM_RIGHTHANDED{X}
diff{X}=viewFrustumZ{X}[i]+vPositionFromCamera{X}.z;
#else
diff{X}=viewFrustumZ{X}[i]-vPositionFromCamera{X}.z;
#endif
if (diff{X}>=0.) {index{X}=i;break;}}
#ifdef SHADOWCSMUSESHADOWMAXZ{X}
if (index{X}>=0)
#endif
{
#if defined(SHADOWPCF{X})
#if defined(SHADOWLOWQUALITY{X})
shadow=computeShadowWithCSMPCF1(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#elif defined(SHADOWMEDIUMQUALITY{X})
shadow=computeShadowWithCSMPCF3(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#else
shadow=computeShadowWithCSMPCF5(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#elif defined(SHADOWPCSS{X})
#if defined(SHADOWLOWQUALITY{X})
shadow=computeShadowWithCSMPCSS16(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});
#elif defined(SHADOWMEDIUMQUALITY{X})
shadow=computeShadowWithCSMPCSS32(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});
#else
shadow=computeShadowWithCSMPCSS64(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});
#endif
#else
shadow=computeShadowCSM(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#ifdef SHADOWCSMDEBUG{X}
shadowDebug{X}=vec3(shadow)*vCascadeColorsMultiplier{X}[index{X}];
#endif
#ifndef SHADOWCSMNOBLEND{X}
float frustumLength=frustumLengths{X}[index{X}];float diffRatio=clamp(diff{X}/frustumLength,0.,1.)*cascadeBlendFactor{X};if (index{X}<(SHADOWCSMNUM_CASCADES{X}-1) && diffRatio<1.)
{index{X}+=1;float nextShadow=0.;
#if defined(SHADOWPCF{X})
#if defined(SHADOWLOWQUALITY{X})
nextShadow=computeShadowWithCSMPCF1(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#elif defined(SHADOWMEDIUMQUALITY{X})
nextShadow=computeShadowWithCSMPCF3(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#else
nextShadow=computeShadowWithCSMPCF5(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#elif defined(SHADOWPCSS{X})
#if defined(SHADOWLOWQUALITY{X})
nextShadow=computeShadowWithCSMPCSS16(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});
#elif defined(SHADOWMEDIUMQUALITY{X})
nextShadow=computeShadowWithCSMPCSS32(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});
#else
nextShadow=computeShadowWithCSMPCSS64(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});
#endif
#else
nextShadow=computeShadowCSM(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
shadow=mix(nextShadow,shadow,diffRatio);
#ifdef SHADOWCSMDEBUG{X}
shadowDebug{X}=mix(vec3(nextShadow)*vCascadeColorsMultiplier{X}[index{X}],shadowDebug{X},diffRatio);
#endif
}
#endif
}
#elif defined(SHADOWCLOSEESM{X})
#if defined(SHADOWCUBE{X})
shadow=computeShadowWithCloseESMCube(vPositionW,light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);
#else
shadow=computeShadowWithCloseESM(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);
#endif
#elif defined(SHADOWESM{X})
#if defined(SHADOWCUBE{X})
shadow=computeShadowWithESMCube(vPositionW,light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);
#else
shadow=computeShadowWithESM(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);
#endif
#elif defined(SHADOWPOISSON{X})
#if defined(SHADOWCUBE{X})
shadow=computeShadowWithPoissonSamplingCube(vPositionW,light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.depthValues);
#else
shadow=computeShadowWithPoissonSampling(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#elif defined(SHADOWPCF{X})
#if defined(SHADOWLOWQUALITY{X})
shadow=computeShadowWithPCF1(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#elif defined(SHADOWMEDIUMQUALITY{X})
shadow=computeShadowWithPCF3(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#else
shadow=computeShadowWithPCF5(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#elif defined(SHADOWPCSS{X})
#if defined(SHADOWLOWQUALITY{X})
shadow=computeShadowWithPCSS16(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#elif defined(SHADOWMEDIUMQUALITY{X})
shadow=computeShadowWithPCSS32(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#else
shadow=computeShadowWithPCSS64(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#else
#if defined(SHADOWCUBE{X})
shadow=computeShadowCube(vPositionW,light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.depthValues);
#else
shadow=computeShadow(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#endif
#ifdef SHADOWONLY
#ifndef SHADOWINUSE
#define SHADOWINUSE
#endif
globalShadow+=shadow;shadowLightCount+=1.0;
#endif
#else
shadow=1.;
#endif
aggShadow+=shadow;numLights+=1.0;
#ifndef SHADOWONLY
#ifdef CUSTOMUSERLIGHTING
diffuseBase+=computeCustomDiffuseLighting(info,diffuseBase,shadow);
#ifdef SPECULARTERM
specularBase+=computeCustomSpecularLighting(info,specularBase,shadow);
#endif
#elif defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X})
diffuseBase+=lightmapColor.rgb*shadow;
#ifdef SPECULARTERM
#ifndef LIGHTMAPNOSPECULAR{X}
specularBase+=info.specular*shadow*lightmapColor.rgb;
#endif
#endif
#ifdef CLEARCOAT
#ifndef LIGHTMAPNOSPECULAR{X}
clearCoatBase+=info.clearCoat.rgb*shadow*lightmapColor.rgb;
#endif
#endif
#ifdef SHEEN
#ifndef LIGHTMAPNOSPECULAR{X}
sheenBase+=info.sheen.rgb*shadow;
#endif
#endif
#else
#ifdef SHADOWCSMDEBUG{X}
diffuseBase+=info.diffuse*shadowDebug{X};
#else 
diffuseBase+=info.diffuse*shadow;
#endif
#ifdef SPECULARTERM
specularBase+=info.specular*shadow;
#endif
#ifdef CLEARCOAT
clearCoatBase+=info.clearCoat.rgb*shadow;
#endif
#ifdef SHEEN
sheenBase+=info.sheen.rgb*shadow;
#endif
#endif
#endif
#endif
`;Y.IncludesShadersStore[YA]=ZA;const jA="logDepthFragment",QA=`#ifdef LOGARITHMICDEPTH
gl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;
#endif
`;Y.IncludesShadersStore[jA]=QA;const JA="oitFragment",$A=`#ifdef ORDER_INDEPENDENT_TRANSPARENCY
float fragDepth=gl_FragCoord.z; 
#ifdef ORDER_INDEPENDENT_TRANSPARENCY_16BITS
uint halfFloat=packHalf2x16(vec2(fragDepth));vec2 full=unpackHalf2x16(halfFloat);fragDepth=full.x;
#endif
ivec2 fragCoord=ivec2(gl_FragCoord.xy);vec2 lastDepth=texelFetch(oitDepthSampler,fragCoord,0).rg;vec4 lastFrontColor=texelFetch(oitFrontColorSampler,fragCoord,0);depth.rg=vec2(-MAX_DEPTH);frontColor=lastFrontColor;backColor=vec4(0.0);
#ifdef USE_REVERSE_DEPTHBUFFER
float furthestDepth=-lastDepth.x;float nearestDepth=lastDepth.y;
#else
float nearestDepth=-lastDepth.x;float furthestDepth=lastDepth.y;
#endif
float alphaMultiplier=1.0-lastFrontColor.a;
#ifdef USE_REVERSE_DEPTHBUFFER
if (fragDepth>nearestDepth || fragDepth<furthestDepth) {
#else
if (fragDepth<nearestDepth || fragDepth>furthestDepth) {
#endif
return;}
#ifdef USE_REVERSE_DEPTHBUFFER
if (fragDepth<nearestDepth && fragDepth>furthestDepth) {
#else
if (fragDepth>nearestDepth && fragDepth<furthestDepth) {
#endif
depth.rg=vec2(-fragDepth,fragDepth);return;}
#endif
`;Y.IncludesShadersStore[JA]=$A;const eM="defaultPixelShader",tM=`#include<__decl__defaultFragment>
#if defined(BUMP) || !defined(NORMAL)
#extension GL_OES_standard_derivatives : enable
#endif
#include<prePassDeclaration>[SCENE_MRT_COUNT]
#include<oitDeclaration>
#define CUSTOM_FRAGMENT_BEGIN
#ifdef LOGARITHMICDEPTH
#extension GL_EXT_frag_depth : enable
#endif
varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)
varying vec4 vColor;
#endif
#include<mainUVVaryingDeclaration>[1..7]
#include<helperFunctions>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
#include<lightsFragmentFunctions>
#include<shadowsFragmentFunctions>
#include<samplerFragmentDeclaration>(_DEFINENAME_,DIFFUSE,_VARYINGNAME_,Diffuse,_SAMPLERNAME_,diffuse)
#include<samplerFragmentDeclaration>(_DEFINENAME_,AMBIENT,_VARYINGNAME_,Ambient,_SAMPLERNAME_,ambient)
#include<samplerFragmentDeclaration>(_DEFINENAME_,OPACITY,_VARYINGNAME_,Opacity,_SAMPLERNAME_,opacity)
#include<samplerFragmentDeclaration>(_DEFINENAME_,EMISSIVE,_VARYINGNAME_,Emissive,_SAMPLERNAME_,emissive)
#include<samplerFragmentDeclaration>(_DEFINENAME_,LIGHTMAP,_VARYINGNAME_,Lightmap,_SAMPLERNAME_,lightmap)
#include<samplerFragmentDeclaration>(_DEFINENAME_,DECAL,_VARYINGNAME_,Decal,_SAMPLERNAME_,decal)
#ifdef REFRACTION
#ifdef REFRACTIONMAP_3D
uniform samplerCube refractionCubeSampler;
#else
uniform sampler2D refraction2DSampler;
#endif
#endif
#if defined(SPECULARTERM)
#include<samplerFragmentDeclaration>(_DEFINENAME_,SPECULAR,_VARYINGNAME_,Specular,_SAMPLERNAME_,specular)
#endif
#include<fresnelFunction>
#ifdef REFLECTION
#ifdef REFLECTIONMAP_3D
uniform samplerCube reflectionCubeSampler;
#else
uniform sampler2D reflection2DSampler;
#endif
#ifdef REFLECTIONMAP_SKYBOX
varying vec3 vPositionUVW;
#else
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
varying vec3 vDirectionW;
#endif
#endif
#include<reflectionFunction>
#endif
#include<imageProcessingDeclaration>
#include<imageProcessingFunctions>
#include<bumpFragmentMainFunctions>
#include<bumpFragmentFunctions>
#include<clipPlaneFragmentDeclaration>
#include<logDepthDeclaration>
#include<fogFragmentDeclaration>
#define CUSTOM_FRAGMENT_DEFINITIONS
void main(void) {
#define CUSTOM_FRAGMENT_MAIN_BEGIN
#include<clipPlaneFragment>
vec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);vec4 baseColor=vec4(1.,1.,1.,1.);vec3 diffuseColor=vDiffuseColor.rgb;float alpha=vDiffuseColor.a;
#ifdef NORMAL
vec3 normalW=normalize(vNormalW);
#else
vec3 normalW=normalize(-cross(dFdx(vPositionW),dFdy(vPositionW)));
#endif
#include<bumpFragment>
#ifdef TWOSIDEDLIGHTING
normalW=gl_FrontFacing ? normalW : -normalW;
#endif
#ifdef DIFFUSE
baseColor=texture2D(diffuseSampler,vDiffuseUV+uvOffset);
#if defined(ALPHATEST) && !defined(ALPHATEST_AFTERALLALPHACOMPUTATIONS)
if (baseColor.a<alphaCutOff)
discard;
#endif
#ifdef ALPHAFROMDIFFUSE
alpha*=baseColor.a;
#endif
#define CUSTOM_FRAGMENT_UPDATE_ALPHA
baseColor.rgb*=vDiffuseInfos.y;
#endif
#if defined(DECAL) && !defined(DECAL_AFTER_DETAIL)
vec4 decalColor=texture2D(decalSampler,vDecalUV+uvOffset);
#include<decalFragment>(surfaceAlbedo,baseColor,GAMMADECAL,_GAMMADECAL_NOTUSED_)
#endif
#include<depthPrePass>
#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)
baseColor.rgb*=vColor.rgb;
#endif
#ifdef DETAIL
baseColor.rgb=baseColor.rgb*2.0*mix(0.5,detailColor.r,vDetailInfos.y);
#endif
#if defined(DECAL) && defined(DECAL_AFTER_DETAIL)
vec4 decalColor=texture2D(decalSampler,vDecalUV+uvOffset);
#include<decalFragment>(surfaceAlbedo,baseColor,GAMMADECAL,_GAMMADECAL_NOTUSED_)
#endif
#define CUSTOM_FRAGMENT_UPDATE_DIFFUSE
vec3 baseAmbientColor=vec3(1.,1.,1.);
#ifdef AMBIENT
baseAmbientColor=texture2D(ambientSampler,vAmbientUV+uvOffset).rgb*vAmbientInfos.y;
#endif
#define CUSTOM_FRAGMENT_BEFORE_LIGHTS
#ifdef SPECULARTERM
float glossiness=vSpecularColor.a;vec3 specularColor=vSpecularColor.rgb;
#ifdef SPECULAR
vec4 specularMapColor=texture2D(specularSampler,vSpecularUV+uvOffset);specularColor=specularMapColor.rgb;
#ifdef GLOSSINESS
glossiness=glossiness*specularMapColor.a;
#endif
#endif
#else
float glossiness=0.;
#endif
vec3 diffuseBase=vec3(0.,0.,0.);lightingInfo info;
#ifdef SPECULARTERM
vec3 specularBase=vec3(0.,0.,0.);
#endif
float shadow=1.;float aggShadow=0.;float numLights=0.;
#ifdef LIGHTMAP
vec4 lightmapColor=texture2D(lightmapSampler,vLightmapUV+uvOffset);
#ifdef RGBDLIGHTMAP
lightmapColor.rgb=fromRGBD(lightmapColor);
#endif
lightmapColor.rgb*=vLightmapInfos.y;
#endif
#include<lightFragment>[0..maxSimultaneousLights]
aggShadow=aggShadow/numLights;vec4 refractionColor=vec4(0.,0.,0.,1.);
#ifdef REFRACTION
vec3 refractionVector=normalize(refract(-viewDirectionW,normalW,vRefractionInfos.y));
#ifdef REFRACTIONMAP_3D
#ifdef USE_LOCAL_REFRACTIONMAP_CUBIC
refractionVector=parallaxCorrectNormal(vPositionW,refractionVector,vRefractionSize,vRefractionPosition);
#endif
refractionVector.y=refractionVector.y*vRefractionInfos.w;vec4 refractionLookup=textureCube(refractionCubeSampler,refractionVector);if (dot(refractionVector,viewDirectionW)<1.0) {refractionColor=refractionLookup;}
#else
vec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));vec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;refractionCoords.y=1.0-refractionCoords.y;refractionColor=texture2D(refraction2DSampler,refractionCoords);
#endif
#ifdef RGBDREFRACTION
refractionColor.rgb=fromRGBD(refractionColor);
#endif
#ifdef IS_REFRACTION_LINEAR
refractionColor.rgb=toGammaSpace(refractionColor.rgb);
#endif
refractionColor.rgb*=vRefractionInfos.x;
#endif
vec4 reflectionColor=vec4(0.,0.,0.,1.);
#ifdef REFLECTION
vec3 vReflectionUVW=computeReflectionCoords(vec4(vPositionW,1.0),normalW);
#ifdef REFLECTIONMAP_OPPOSITEZ
vReflectionUVW.z*=-1.0;
#endif
#ifdef REFLECTIONMAP_3D
#ifdef ROUGHNESS
float bias=vReflectionInfos.y;
#ifdef SPECULARTERM
#ifdef SPECULAR
#ifdef GLOSSINESS
bias*=(1.0-specularMapColor.a);
#endif
#endif
#endif
reflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW,bias);
#else
reflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW);
#endif
#else
vec2 coords=vReflectionUVW.xy;
#ifdef REFLECTIONMAP_PROJECTION
coords/=vReflectionUVW.z;
#endif
coords.y=1.0-coords.y;reflectionColor=texture2D(reflection2DSampler,coords);
#endif
#ifdef RGBDREFLECTION
reflectionColor.rgb=fromRGBD(reflectionColor);
#endif
#ifdef IS_REFLECTION_LINEAR
reflectionColor.rgb=toGammaSpace(reflectionColor.rgb);
#endif
reflectionColor.rgb*=vReflectionInfos.x;
#ifdef REFLECTIONFRESNEL
float reflectionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,reflectionRightColor.a,reflectionLeftColor.a);
#ifdef REFLECTIONFRESNELFROMSPECULAR
#ifdef SPECULARTERM
reflectionColor.rgb*=specularColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;
#else
reflectionColor.rgb*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;
#endif
#else
reflectionColor.rgb*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;
#endif
#endif
#endif
#ifdef REFRACTIONFRESNEL
float refractionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,refractionRightColor.a,refractionLeftColor.a);refractionColor.rgb*=refractionLeftColor.rgb*(1.0-refractionFresnelTerm)+refractionFresnelTerm*refractionRightColor.rgb;
#endif
#ifdef OPACITY
vec4 opacityMap=texture2D(opacitySampler,vOpacityUV+uvOffset);
#ifdef OPACITYRGB
opacityMap.rgb=opacityMap.rgb*vec3(0.3,0.59,0.11);alpha*=(opacityMap.x+opacityMap.y+opacityMap.z)* vOpacityInfos.y;
#else
alpha*=opacityMap.a*vOpacityInfos.y;
#endif
#endif
#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)
alpha*=vColor.a;
#endif
#ifdef OPACITYFRESNEL
float opacityFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,opacityParts.z,opacityParts.w);alpha+=opacityParts.x*(1.0-opacityFresnelTerm)+opacityFresnelTerm*opacityParts.y;
#endif
#ifdef ALPHATEST
#ifdef ALPHATEST_AFTERALLALPHACOMPUTATIONS
if (alpha<alphaCutOff)
discard;
#endif
#ifndef ALPHABLEND
alpha=1.0;
#endif
#endif
vec3 emissiveColor=vEmissiveColor;
#ifdef EMISSIVE
emissiveColor+=texture2D(emissiveSampler,vEmissiveUV+uvOffset).rgb*vEmissiveInfos.y;
#endif
#ifdef EMISSIVEFRESNEL
float emissiveFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,emissiveRightColor.a,emissiveLeftColor.a);emissiveColor*=emissiveLeftColor.rgb*(1.0-emissiveFresnelTerm)+emissiveFresnelTerm*emissiveRightColor.rgb;
#endif
#ifdef DIFFUSEFRESNEL
float diffuseFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,diffuseRightColor.a,diffuseLeftColor.a);diffuseBase*=diffuseLeftColor.rgb*(1.0-diffuseFresnelTerm)+diffuseFresnelTerm*diffuseRightColor.rgb;
#endif
#ifdef EMISSIVEASILLUMINATION
vec3 finalDiffuse=clamp(diffuseBase*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;
#else
#ifdef LINKEMISSIVEWITHDIFFUSE
vec3 finalDiffuse=clamp((diffuseBase+emissiveColor)*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;
#else
vec3 finalDiffuse=clamp(diffuseBase*diffuseColor+emissiveColor+vAmbientColor,0.0,1.0)*baseColor.rgb;
#endif
#endif
#ifdef SPECULARTERM
vec3 finalSpecular=specularBase*specularColor;
#ifdef SPECULAROVERALPHA
alpha=clamp(alpha+dot(finalSpecular,vec3(0.3,0.59,0.11)),0.,1.);
#endif
#else
vec3 finalSpecular=vec3(0.0);
#endif
#ifdef REFLECTIONOVERALPHA
alpha=clamp(alpha+dot(reflectionColor.rgb,vec3(0.3,0.59,0.11)),0.,1.);
#endif
#ifdef EMISSIVEASILLUMINATION
vec4 color=vec4(clamp(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor.rgb+emissiveColor+refractionColor.rgb,0.0,1.0),alpha);
#else
vec4 color=vec4(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor.rgb+refractionColor.rgb,alpha);
#endif
#ifdef LIGHTMAP
#ifndef LIGHTMAPEXCLUDED
#ifdef USELIGHTMAPASSHADOWMAP
color.rgb*=lightmapColor.rgb;
#else
color.rgb+=lightmapColor.rgb;
#endif
#endif
#endif
#define CUSTOM_FRAGMENT_BEFORE_FOG
color.rgb=max(color.rgb,0.);
#include<logDepthFragment>
#include<fogFragment>
#ifdef IMAGEPROCESSINGPOSTPROCESS
color.rgb=toLinearSpace(color.rgb);
#else
#ifdef IMAGEPROCESSING
color.rgb=toLinearSpace(color.rgb);color=applyImageProcessing(color);
#endif
#endif
color.a*=visibility;
#ifdef PREMULTIPLYALPHA
color.rgb*=color.a;
#endif
#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR
#ifdef PREPASS
float writeGeometryInfo=color.a>0.4 ? 1.0 : 0.0;gl_FragData[0]=color; 
#ifdef PREPASS_POSITION
gl_FragData[PREPASS_POSITION_INDEX]=vec4(vPositionW,writeGeometryInfo);
#endif
#ifdef PREPASS_VELOCITY
vec2 a=(vCurrentPosition.xy/vCurrentPosition.w)*0.5+0.5;vec2 b=(vPreviousPosition.xy/vPreviousPosition.w)*0.5+0.5;vec2 velocity=abs(a-b);velocity=vec2(pow(velocity.x,1.0/3.0),pow(velocity.y,1.0/3.0))*sign(a-b)*0.5+0.5;gl_FragData[PREPASS_VELOCITY_INDEX]=vec4(velocity,0.0,writeGeometryInfo);
#endif
#ifdef PREPASS_IRRADIANCE
gl_FragData[PREPASS_IRRADIANCE_INDEX]=vec4(0.0,0.0,0.0,writeGeometryInfo); 
#endif
#ifdef PREPASS_DEPTH
gl_FragData[PREPASS_DEPTH_INDEX]=vec4(vViewPos.z,0.0,0.0,writeGeometryInfo); 
#endif
#ifdef PREPASS_NORMAL
#ifdef PREPASS_NORMAL_WORLDSPACE
gl_FragData[PREPASS_NORMAL_INDEX]=vec4(normalW,writeGeometryInfo); 
#else
gl_FragData[PREPASS_NORMAL_INDEX]=vec4(normalize((view*vec4(normalW,0.0)).rgb),writeGeometryInfo); 
#endif
#endif
#ifdef PREPASS_ALBEDO_SQRT
gl_FragData[PREPASS_ALBEDO_SQRT_INDEX]=vec4(0.0,0.0,0.0,writeGeometryInfo); 
#endif
#ifdef PREPASS_REFLECTIVITY
#if defined(SPECULARTERM)
#if defined(SPECULAR)
gl_FragData[PREPASS_REFLECTIVITY_INDEX]=vec4(toLinearSpace(specularMapColor))*writeGeometryInfo; 
#else
gl_FragData[PREPASS_REFLECTIVITY_INDEX]=vec4(toLinearSpace(specularColor),1.0)*writeGeometryInfo;
#endif
#else
gl_FragData[PREPASS_REFLECTIVITY_INDEX]=vec4(0.0,0.0,0.0,1.0)*writeGeometryInfo;
#endif
#endif
#endif
#if !defined(PREPASS) || defined(WEBGL2)
gl_FragColor=color;
#endif
#include<oitFragment>
#if ORDER_INDEPENDENT_TRANSPARENCY
if (fragDepth==nearestDepth) {frontColor.rgb+=color.rgb*color.a*alphaMultiplier;frontColor.a=1.0-alphaMultiplier*(1.0-color.a);} else {backColor+=color;}
#endif
#define CUSTOM_FRAGMENT_MAIN_END
}
`;Y.ShadersStore[eM]=tM;const iM="decalVertexDeclaration",rM=`#ifdef DECAL
uniform vec4 vDecalInfos;uniform mat4 decalMatrix;
#endif
`;Y.IncludesShadersStore[iM]=rM;const sM="defaultVertexDeclaration",nM=`uniform mat4 viewProjection;uniform mat4 view;
#ifdef DIFFUSE
uniform mat4 diffuseMatrix;uniform vec2 vDiffuseInfos;
#endif
#ifdef AMBIENT
uniform mat4 ambientMatrix;uniform vec2 vAmbientInfos;
#endif
#ifdef OPACITY
uniform mat4 opacityMatrix;uniform vec2 vOpacityInfos;
#endif
#ifdef EMISSIVE
uniform vec2 vEmissiveInfos;uniform mat4 emissiveMatrix;
#endif
#ifdef LIGHTMAP
uniform vec2 vLightmapInfos;uniform mat4 lightmapMatrix;
#endif
#if defined(SPECULAR) && defined(SPECULARTERM)
uniform vec2 vSpecularInfos;uniform mat4 specularMatrix;
#endif
#ifdef BUMP
uniform vec3 vBumpInfos;uniform mat4 bumpMatrix;
#endif
#ifdef REFLECTION
uniform mat4 reflectionMatrix;
#endif
#ifdef POINTSIZE
uniform float pointSize;
#endif
#ifdef DETAIL
uniform vec4 vDetailInfos;uniform mat4 detailMatrix;
#endif
#include<decalVertexDeclaration>
#define ADDITIONAL_VERTEX_DECLARATION
`;Y.IncludesShadersStore[sM]=nM;const oM="uvAttributeDeclaration",aM=`#ifdef UV{X}
attribute vec2 uv{X};
#endif
`;Y.IncludesShadersStore[oM]=aM;const lM="prePassVertexDeclaration",hM=`#ifdef PREPASS
#ifdef PREPASS_DEPTH
varying vec3 vViewPos;
#endif
#ifdef PREPASS_VELOCITY
uniform mat4 previousViewProjection;varying vec4 vCurrentPosition;varying vec4 vPreviousPosition;
#endif
#endif
`;Y.IncludesShadersStore[lM]=hM;const cM="samplerVertexDeclaration",uM=`#if defined(_DEFINENAME_) && _DEFINENAME_DIRECTUV==0
varying vec2 v_VARYINGNAME_UV;
#endif
`;Y.IncludesShadersStore[cM]=uM;const dM="bumpVertexDeclaration",fM=`#if defined(BUMP) || defined(PARALLAX) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC)
#if defined(TANGENT) && defined(NORMAL) 
varying mat3 vTBN;
#endif
#endif
`;Y.IncludesShadersStore[dM]=fM;const pM="lightVxFragmentDeclaration",gM=`#ifdef LIGHT{X}
uniform vec4 vLightData{X};uniform vec4 vLightDiffuse{X};
#ifdef SPECULARTERM
uniform vec4 vLightSpecular{X};
#else
vec4 vLightSpecular{X}=vec4(0.);
#endif
#ifdef SHADOW{X}
#ifdef SHADOWCSM{X}
uniform mat4 lightMatrix{X}[SHADOWCSMNUM_CASCADES{X}];varying vec4 vPositionFromLight{X}[SHADOWCSMNUM_CASCADES{X}];varying float vDepthMetric{X}[SHADOWCSMNUM_CASCADES{X}];varying vec4 vPositionFromCamera{X};
#elif defined(SHADOWCUBE{X})
#else
varying vec4 vPositionFromLight{X};varying float vDepthMetric{X};uniform mat4 lightMatrix{X};
#endif
uniform vec4 shadowsInfo{X};uniform vec2 depthValues{X};
#endif
#ifdef SPOTLIGHT{X}
uniform vec4 vLightDirection{X};uniform vec4 vLightFalloff{X};
#elif defined(POINTLIGHT{X})
uniform vec4 vLightFalloff{X};
#elif defined(HEMILIGHT{X})
uniform vec3 vLightGround{X};
#endif
#endif
`;Y.IncludesShadersStore[pM]=gM;const mM="lightVxUboDeclaration",_M=`#ifdef LIGHT{X}
uniform Light{X}
{vec4 vLightData;vec4 vLightDiffuse;vec4 vLightSpecular;
#ifdef SPOTLIGHT{X}
vec4 vLightDirection;vec4 vLightFalloff;
#elif defined(POINTLIGHT{X})
vec4 vLightFalloff;
#elif defined(HEMILIGHT{X})
vec3 vLightGround;
#endif
vec4 shadowsInfo;vec2 depthValues;} light{X};
#ifdef SHADOW{X}
#ifdef SHADOWCSM{X}
uniform mat4 lightMatrix{X}[SHADOWCSMNUM_CASCADES{X}];varying vec4 vPositionFromLight{X}[SHADOWCSMNUM_CASCADES{X}];varying float vDepthMetric{X}[SHADOWCSMNUM_CASCADES{X}];varying vec4 vPositionFromCamera{X};
#elif defined(SHADOWCUBE{X})
#else
varying vec4 vPositionFromLight{X};varying float vDepthMetric{X};uniform mat4 lightMatrix{X};
#endif
#endif
#endif
`;Y.IncludesShadersStore[mM]=_M;const vM="prePassVertex",EM=`#ifdef PREPASS_DEPTH
vViewPos=(view*worldPos).rgb;
#endif
#if defined(PREPASS_VELOCITY) && defined(BONES_VELOCITY_ENABLED)
vCurrentPosition=viewProjection*worldPos;
#if NUM_BONE_INFLUENCERS>0
mat4 previousInfluence;previousInfluence=mPreviousBones[int(matricesIndices[0])]*matricesWeights[0];
#if NUM_BONE_INFLUENCERS>1
previousInfluence+=mPreviousBones[int(matricesIndices[1])]*matricesWeights[1];
#endif 
#if NUM_BONE_INFLUENCERS>2
previousInfluence+=mPreviousBones[int(matricesIndices[2])]*matricesWeights[2];
#endif 
#if NUM_BONE_INFLUENCERS>3
previousInfluence+=mPreviousBones[int(matricesIndices[3])]*matricesWeights[3];
#endif
#if NUM_BONE_INFLUENCERS>4
previousInfluence+=mPreviousBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];
#endif 
#if NUM_BONE_INFLUENCERS>5
previousInfluence+=mPreviousBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];
#endif 
#if NUM_BONE_INFLUENCERS>6
previousInfluence+=mPreviousBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];
#endif 
#if NUM_BONE_INFLUENCERS>7
previousInfluence+=mPreviousBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];
#endif
vPreviousPosition=previousViewProjection*finalPreviousWorld*previousInfluence*vec4(positionUpdated,1.0);
#else
vPreviousPosition=previousViewProjection*finalPreviousWorld*vec4(positionUpdated,1.0);
#endif
#endif
`;Y.IncludesShadersStore[vM]=EM;const TM="uvVariableDeclaration",xM=`#if !defined(UV{X}) && defined(MAINUV{X})
vec2 uv{X}=vec2(0.,0.);
#endif
#ifdef MAINUV{X}
vMainUV{X}=uv{X};
#endif
`;Y.IncludesShadersStore[TM]=xM;const CM="samplerVertexImplementation",RM=`#if defined(_DEFINENAME_) && _DEFINENAME_DIRECTUV==0
if (v_INFONAME_==0.)
{v_VARYINGNAME_UV=vec2(_MATRIXNAME_Matrix*vec4(uvUpdated,1.0,0.0));}
#ifdef UV2
else if (v_INFONAME_==1.)
{v_VARYINGNAME_UV=vec2(_MATRIXNAME_Matrix*vec4(uv2,1.0,0.0));}
#endif
#ifdef UV3
else if (v_INFONAME_==2.)
{v_VARYINGNAME_UV=vec2(_MATRIXNAME_Matrix*vec4(uv3,1.0,0.0));}
#endif
#ifdef UV4
else if (v_INFONAME_==3.)
{v_VARYINGNAME_UV=vec2(_MATRIXNAME_Matrix*vec4(uv4,1.0,0.0));}
#endif
#ifdef UV5
else if (v_INFONAME_==4.)
{v_VARYINGNAME_UV=vec2(_MATRIXNAME_Matrix*vec4(uv5,1.0,0.0));}
#endif
#ifdef UV6
else if (v_INFONAME_==5.)
{v_VARYINGNAME_UV=vec2(_MATRIXNAME_Matrix*vec4(uv6,1.0,0.0));}
#endif
#endif
`;Y.IncludesShadersStore[CM]=RM;const SM="bumpVertex",yM=`#if defined(BUMP) || defined(PARALLAX) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC)
#if defined(TANGENT) && defined(NORMAL)
vec3 tbnNormal=normalize(normalUpdated);vec3 tbnTangent=normalize(tangentUpdated.xyz);vec3 tbnBitangent=cross(tbnNormal,tbnTangent)*tangentUpdated.w;vTBN=mat3(finalWorld)*mat3(tbnTangent,tbnBitangent,tbnNormal);
#endif
#endif
`;Y.IncludesShadersStore[SM]=yM;const bM="shadowsVertex",IM=`#ifdef SHADOWS
#if defined(SHADOWCSM{X})
vPositionFromCamera{X}=view*worldPos;for (int i=0; i<SHADOWCSMNUM_CASCADES{X}; i++) {vPositionFromLight{X}[i]=lightMatrix{X}[i]*worldPos;
#ifdef USE_REVERSE_DEPTHBUFFER
vDepthMetric{X}[i]=(-vPositionFromLight{X}[i].z+light{X}.depthValues.x)/light{X}.depthValues.y;
#else
vDepthMetric{X}[i]=(vPositionFromLight{X}[i].z+light{X}.depthValues.x)/light{X}.depthValues.y;
#endif
}
#elif defined(SHADOW{X}) && !defined(SHADOWCUBE{X})
vPositionFromLight{X}=lightMatrix{X}*worldPos;
#ifdef USE_REVERSE_DEPTHBUFFER
vDepthMetric{X}=(-vPositionFromLight{X}.z+light{X}.depthValues.x)/light{X}.depthValues.y;
#else
vDepthMetric{X}=(vPositionFromLight{X}.z+light{X}.depthValues.x)/light{X}.depthValues.y;
#endif
#endif
#endif
`;Y.IncludesShadersStore[bM]=IM;const AM="pointCloudVertex",MM=`#if defined(POINTSIZE) && !defined(WEBGPU)
gl_PointSize=pointSize;
#endif
`;Y.IncludesShadersStore[AM]=MM;const PM="logDepthVertex",OM=`#ifdef LOGARITHMICDEPTH
vFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;
#endif
`;Y.IncludesShadersStore[PM]=OM;const DM="defaultVertexShader",NM=`#include<__decl__defaultVertex>
#define CUSTOM_VERTEX_BEGIN
attribute vec3 position;
#ifdef NORMAL
attribute vec3 normal;
#endif
#ifdef TANGENT
attribute vec4 tangent;
#endif
#ifdef UV1
attribute vec2 uv;
#endif
#include<uvAttributeDeclaration>[2..7]
#ifdef VERTEXCOLOR
attribute vec4 color;
#endif
#include<helperFunctions>
#include<bonesDeclaration>
#include<bakedVertexAnimationDeclaration>
#include<instancesDeclaration>
#include<prePassVertexDeclaration>
#include<mainUVVaryingDeclaration>[1..7]
#include<samplerVertexDeclaration>(_DEFINENAME_,DIFFUSE,_VARYINGNAME_,Diffuse)
#include<samplerVertexDeclaration>(_DEFINENAME_,DETAIL,_VARYINGNAME_,Detail)
#include<samplerVertexDeclaration>(_DEFINENAME_,AMBIENT,_VARYINGNAME_,Ambient)
#include<samplerVertexDeclaration>(_DEFINENAME_,OPACITY,_VARYINGNAME_,Opacity)
#include<samplerVertexDeclaration>(_DEFINENAME_,EMISSIVE,_VARYINGNAME_,Emissive)
#include<samplerVertexDeclaration>(_DEFINENAME_,LIGHTMAP,_VARYINGNAME_,Lightmap)
#if defined(SPECULARTERM)
#include<samplerVertexDeclaration>(_DEFINENAME_,SPECULAR,_VARYINGNAME_,Specular)
#endif
#include<samplerVertexDeclaration>(_DEFINENAME_,BUMP,_VARYINGNAME_,Bump)
#include<samplerVertexDeclaration>(_DEFINENAME_,DECAL,_VARYINGNAME_,Decal)
varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)
varying vec4 vColor;
#endif
#include<bumpVertexDeclaration>
#include<clipPlaneVertexDeclaration>
#include<fogVertexDeclaration>
#include<__decl__lightVxFragment>[0..maxSimultaneousLights]
#include<morphTargetsVertexGlobalDeclaration>
#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]
#ifdef REFLECTIONMAP_SKYBOX
varying vec3 vPositionUVW;
#endif
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
varying vec3 vDirectionW;
#endif
#include<logDepthDeclaration>
#define CUSTOM_VERTEX_DEFINITIONS
void main(void) {
#define CUSTOM_VERTEX_MAIN_BEGIN
vec3 positionUpdated=position;
#ifdef NORMAL
vec3 normalUpdated=normal;
#endif
#ifdef TANGENT
vec4 tangentUpdated=tangent;
#endif
#ifdef UV1
vec2 uvUpdated=uv;
#endif
#include<morphTargetsVertexGlobal>
#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]
#ifdef REFLECTIONMAP_SKYBOX
vPositionUVW=positionUpdated;
#endif
#define CUSTOM_VERTEX_UPDATE_POSITION
#define CUSTOM_VERTEX_UPDATE_NORMAL
#include<instancesVertex>
#if defined(PREPASS) && defined(PREPASS_VELOCITY) && !defined(BONES_VELOCITY_ENABLED)
vCurrentPosition=viewProjection*finalWorld*vec4(positionUpdated,1.0);vPreviousPosition=previousViewProjection*finalPreviousWorld*vec4(positionUpdated,1.0);
#endif
#include<bonesVertex>
#include<bakedVertexAnimation>
vec4 worldPos=finalWorld*vec4(positionUpdated,1.0);
#ifdef NORMAL
mat3 normalWorld=mat3(finalWorld);
#if defined(INSTANCES) && defined(THIN_INSTANCES)
vNormalW=normalUpdated/vec3(dot(normalWorld[0],normalWorld[0]),dot(normalWorld[1],normalWorld[1]),dot(normalWorld[2],normalWorld[2]));vNormalW=normalize(normalWorld*vNormalW);
#else
#ifdef NONUNIFORMSCALING
normalWorld=transposeMat3(inverseMat3(normalWorld));
#endif
vNormalW=normalize(normalWorld*normalUpdated);
#endif
#endif
#define CUSTOM_VERTEX_UPDATE_WORLDPOS
#ifdef MULTIVIEW
if (gl_ViewID_OVR==0u) {gl_Position=viewProjection*worldPos;} else {gl_Position=viewProjectionR*worldPos;}
#else
gl_Position=viewProjection*worldPos;
#endif
vPositionW=vec3(worldPos);
#include<prePassVertex>
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
vDirectionW=normalize(vec3(finalWorld*vec4(positionUpdated,0.0)));
#endif
#ifndef UV1
vec2 uvUpdated=vec2(0.,0.);
#endif
#ifdef MAINUV1
vMainUV1=uvUpdated;
#endif
#include<uvVariableDeclaration>[2..7]
#include<samplerVertexImplementation>(_DEFINENAME_,DIFFUSE,_VARYINGNAME_,Diffuse,_MATRIXNAME_,diffuse,_INFONAME_,DiffuseInfos.x)
#include<samplerVertexImplementation>(_DEFINENAME_,DETAIL,_VARYINGNAME_,Detail,_MATRIXNAME_,detail,_INFONAME_,DetailInfos.x)
#include<samplerVertexImplementation>(_DEFINENAME_,AMBIENT,_VARYINGNAME_,Ambient,_MATRIXNAME_,ambient,_INFONAME_,AmbientInfos.x)
#include<samplerVertexImplementation>(_DEFINENAME_,OPACITY,_VARYINGNAME_,Opacity,_MATRIXNAME_,opacity,_INFONAME_,OpacityInfos.x)
#include<samplerVertexImplementation>(_DEFINENAME_,EMISSIVE,_VARYINGNAME_,Emissive,_MATRIXNAME_,emissive,_INFONAME_,EmissiveInfos.x)
#include<samplerVertexImplementation>(_DEFINENAME_,LIGHTMAP,_VARYINGNAME_,Lightmap,_MATRIXNAME_,lightmap,_INFONAME_,LightmapInfos.x)
#if defined(SPECULARTERM)
#include<samplerVertexImplementation>(_DEFINENAME_,SPECULAR,_VARYINGNAME_,Specular,_MATRIXNAME_,specular,_INFONAME_,SpecularInfos.x)
#endif
#include<samplerVertexImplementation>(_DEFINENAME_,BUMP,_VARYINGNAME_,Bump,_MATRIXNAME_,bump,_INFONAME_,BumpInfos.x)
#include<samplerVertexImplementation>(_DEFINENAME_,DECAL,_VARYINGNAME_,Decal,_MATRIXNAME_,decal,_INFONAME_,DecalInfos.x)
#include<bumpVertex>
#include<clipPlaneVertex>
#include<fogVertex>
#include<shadowsVertex>[0..maxSimultaneousLights]
#include<vertexColorMixing>
#include<pointCloudVertex>
#include<logDepthVertex>
#define CUSTOM_VERTEX_MAIN_END
}
`;Y.ShadersStore[DM]=NM;const FM=new RegExp("^([gimus]+)!");class hn{constructor(e){this._plugins=[],this._activePlugins=[],this._activePluginsForExtraEvents=[],this._material=e,this._scene=e.getScene(),this._engine=this._scene.getEngine()}_addPlugin(e){for(let r=0;r<this._plugins.length;++r)if(this._plugins[r].name===e.name)return!1;if(this._material._uniformBufferLayoutBuilt)throw`The plugin "${e.name}" can't be added to the material "${this._material.name}" because this material has already been used for rendering! Please add plugins to materials before any rendering with this material occurs.`;const t=e.getClassName();hn._MaterialPluginClassToMainDefine[t]||(hn._MaterialPluginClassToMainDefine[t]="MATERIALPLUGIN_"+ ++hn._MaterialPluginCounter),this._material._callbackPluginEventGeneric=(r,s)=>this._handlePluginEvent(r,s),this._plugins.push(e),this._plugins.sort((r,s)=>r.priority-s.priority),this._codeInjectionPoints={};const i={};i[hn._MaterialPluginClassToMainDefine[t]]={type:"boolean",default:!0};for(const r of this._plugins)r.collectDefines(i),this._collectPointNames("vertex",r.getCustomCode("vertex")),this._collectPointNames("fragment",r.getCustomCode("fragment"));return this._defineNamesFromPlugins=i,!0}_activatePlugin(e){this._activePlugins.indexOf(e)===-1&&(this._activePlugins.push(e),this._activePlugins.sort((t,i)=>t.priority-i.priority),this._material._callbackPluginEventIsReadyForSubMesh=this._handlePluginEventIsReadyForSubMesh.bind(this),this._material._callbackPluginEventPrepareDefinesBeforeAttributes=this._handlePluginEventPrepareDefinesBeforeAttributes.bind(this),this._material._callbackPluginEventPrepareDefines=this._handlePluginEventPrepareDefines.bind(this),this._material._callbackPluginEventBindForSubMesh=this._handlePluginEventBindForSubMesh.bind(this),e.registerForExtraEvents&&(this._activePluginsForExtraEvents.push(e),this._activePluginsForExtraEvents.sort((t,i)=>t.priority-i.priority),this._material._callbackPluginEventHasRenderTargetTextures=this._handlePluginEventHasRenderTargetTextures.bind(this),this._material._callbackPluginEventFillRenderTargetTextures=this._handlePluginEventFillRenderTargetTextures.bind(this),this._material._callbackPluginEventHardBindForSubMesh=this._handlePluginEventHardBindForSubMesh.bind(this)))}getPlugin(e){for(let t=0;t<this._plugins.length;++t)if(this._plugins[t].name===e)return this._plugins[t];return null}_handlePluginEventIsReadyForSubMesh(e){let t=!0;for(const i of this._activePlugins)t=t&&i.isReadyForSubMesh(e.defines,this._scene,this._engine,e.subMesh);e.isReadyForSubMesh=t}_handlePluginEventPrepareDefinesBeforeAttributes(e){for(const t of this._activePlugins)t.prepareDefinesBeforeAttributes(e.defines,this._scene,e.mesh)}_handlePluginEventPrepareDefines(e){for(const t of this._activePlugins)t.prepareDefines(e.defines,this._scene,e.mesh)}_handlePluginEventHardBindForSubMesh(e){for(const t of this._activePluginsForExtraEvents)t.hardBindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,e.subMesh)}_handlePluginEventBindForSubMesh(e){for(const t of this._activePlugins)t.bindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,e.subMesh)}_handlePluginEventHasRenderTargetTextures(e){let t=!1;for(const i of this._activePluginsForExtraEvents)if(t=i.hasRenderTargetTextures(),t)break;e.hasRenderTargetTextures=t}_handlePluginEventFillRenderTargetTextures(e){for(const t of this._activePluginsForExtraEvents)t.fillRenderTargetTextures(e.renderTargets)}_handlePluginEvent(e,t){switch(e){case yi.GetActiveTextures:{const i=t;for(const r of this._activePlugins)r.getActiveTextures(i.activeTextures);break}case yi.GetAnimatables:{const i=t;for(const r of this._activePlugins)r.getAnimatables(i.animatables);break}case yi.HasTexture:{const i=t;let r=!1;for(const s of this._activePlugins)if(r=s.hasTexture(i.texture),r)break;i.hasTexture=r;break}case yi.Disposed:{const i=t;for(const r of this._plugins)r.dispose(i.forceDisposeTextures);break}case yi.GetDefineNames:{const i=t;i.defineNames=this._defineNamesFromPlugins;break}case yi.PrepareEffect:{const i=t;for(const r of this._activePlugins)i.fallbackRank=r.addFallbacks(i.defines,i.fallbacks,i.fallbackRank),r.getAttributes(i.attributes,this._scene,i.mesh);this._uniformList.length>0&&i.uniforms.push(...this._uniformList),this._samplerList.length>0&&i.samplers.push(...this._samplerList),this._uboList.length>0&&i.uniformBuffersNames.push(...this._uboList),i.customCode=this._injectCustomCode(i,i.customCode);break}case yi.PrepareUniformBuffer:{const i=t;this._uboDeclaration="",this._vertexDeclaration="",this._fragmentDeclaration="",this._uniformList=[],this._samplerList=[],this._uboList=[];for(const r of this._plugins){const s=r.getUniforms();if(s){if(s.ubo)for(const o of s.ubo){if(o.size&&o.type){const a=o.arraySize??0;i.ubo.addUniform(o.name,o.size,a),this._uboDeclaration+=`${o.type} ${o.name}${a>0?`[${a}]`:""};
`}this._uniformList.push(o.name)}s.vertex&&(this._vertexDeclaration+=s.vertex+`
`),s.fragment&&(this._fragmentDeclaration+=s.fragment+`
`)}r.getSamplers(this._samplerList),r.getUniformBuffersNames(this._uboList)}break}}}_collectPointNames(e,t){if(t)for(const i in t)this._codeInjectionPoints[e]||(this._codeInjectionPoints[e]={}),this._codeInjectionPoints[e][i]=!0}_injectCustomCode(e,t){return(i,r)=>{var s,o;t&&(r=t(i,r)),this._uboDeclaration&&(r=r.replace("#define ADDITIONAL_UBO_DECLARATION",this._uboDeclaration)),this._vertexDeclaration&&(r=r.replace("#define ADDITIONAL_VERTEX_DECLARATION",this._vertexDeclaration)),this._fragmentDeclaration&&(r=r.replace("#define ADDITIONAL_FRAGMENT_DECLARATION",this._fragmentDeclaration));const a=(s=this._codeInjectionPoints)==null?void 0:s[i];if(!a)return r;let l=null;for(let h in a){let c="";for(const u of this._activePlugins){let d=(o=u.getCustomCode(i))==null?void 0:o[h];if(d){if(u.resolveIncludes){if(l===null){const f=Ti.GLSL;l={defines:[],indexParameters:e.indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:void 0,supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:Y.GetShadersRepository(f),includesShadersStore:Y.GetIncludesShadersStore(f),version:void 0,platformName:this._engine.shaderPlatformName,processingContext:void 0,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:void 0}}l.isFragment=i==="fragment",ms._ProcessIncludes(d,l,f=>d=f)}c+=d+`
`}}if(c.length>0)if(h.charAt(0)==="!"){h=h.substring(1);let u="g";if(h.charAt(0)==="!")u="",h=h.substring(1);else{const g=FM.exec(h);g&&g.length>=2&&(u=g[1],h=h.substring(u.length+1))}u.indexOf("g")<0&&(u+="g");const d=r,f=new RegExp(h,u);let p=f.exec(d);for(;p!==null;){let g=c;for(let m=0;m<p.length;++m)g=g.replace("$"+m,p[m]);r=r.replace(p[0],g),p=f.exec(d)}}else{const u="#define "+h;r=r.replace(u,`
`+c+`
`+u)}}return r}}}hn._MaterialPluginClassToMainDefine={};hn._MaterialPluginCounter=0;rt.OnEnginesDisposedObservable.add(()=>{wM()});const LM=[];let Ig=null;function wM(){LM.length=0,ie.OnEventObservable.remove(Ig),Ig=null}class kr{_enable(e){e&&this._pluginManager._activatePlugin(this)}constructor(e,t,i,r,s=!0,o=!1,a=!1){this.priority=500,this.resolveIncludes=!1,this.registerForExtraEvents=!1,this._material=e,this.name=t,this.priority=i,this.resolveIncludes=a,e.pluginManager||(e.pluginManager=new hn(e),e.onDisposeObservable.add(()=>{e.pluginManager=void 0})),this._pluginDefineNames=r,this._pluginManager=e.pluginManager,s&&this._pluginManager._addPlugin(this),o&&this._enable(!0),this.markAllDefinesAsDirty=e._dirtyCallbacks[63]}getClassName(){return"MaterialPluginBase"}isReadyForSubMesh(e,t,i,r){return!0}hardBindForSubMesh(e,t,i,r){}bindForSubMesh(e,t,i,r){}dispose(e){}getCustomCode(e){return null}collectDefines(e){if(this._pluginDefineNames)for(const t of Object.keys(this._pluginDefineNames)){if(t[0]==="_")continue;const i=typeof this._pluginDefineNames[t];e[t]={type:i==="number"?"number":i==="string"?"string":i==="boolean"?"boolean":"object",default:this._pluginDefineNames[t]}}}prepareDefinesBeforeAttributes(e,t,i){}prepareDefines(e,t,i){}hasTexture(e){return!1}hasRenderTargetTextures(){return!1}fillRenderTargetTextures(e){}getActiveTextures(e){}getAnimatables(e){}addFallbacks(e,t,i){return i}getSamplers(e){}getAttributes(e,t,i){}getUniformBuffersNames(e){}getUniforms(){return{}}copyTo(e){Le.Clone(()=>e,this)}serialize(){return Le.Serialize(this)}parse(e,t,i){Le.Parse(()=>this,e,t,i)}}M([V()],kr.prototype,"name",void 0);M([V()],kr.prototype,"priority",void 0);M([V()],kr.prototype,"resolveIncludes",void 0);M([V()],kr.prototype,"registerForExtraEvents",void 0);class UM extends is{constructor(){super(...arguments),this.DETAIL=!1,this.DETAILDIRECTUV=0,this.DETAIL_NORMALBLENDMETHOD=0}}class _n extends kr{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}constructor(e,t=!0){super(e,"DetailMap",140,new UM,t),this._texture=null,this.diffuseBlendLevel=1,this.roughnessBlendLevel=1,this.bumpLevel=1,this._normalBlendMethod=ie.MATERIAL_NORMALBLENDMETHOD_WHITEOUT,this._isEnabled=!1,this.isEnabled=!1,this._internalMarkAllSubMeshesAsTexturesDirty=e._dirtyCallbacks[1]}isReadyForSubMesh(e,t,i){return this._isEnabled?!(e._areTexturesDirty&&t.texturesEnabled&&i.getCaps().standardDerivatives&&this._texture&&ne.DetailTextureEnabled&&!this._texture.isReady()):!0}prepareDefines(e,t){if(this._isEnabled){e.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod;const i=t.getEngine();e._areTexturesDirty&&(i.getCaps().standardDerivatives&&this._texture&&ne.DetailTextureEnabled&&this._isEnabled?(wt(this._texture,e,"DETAIL"),e.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod):e.DETAIL=!1)}else e.DETAIL=!1}bindForSubMesh(e,t){if(!this._isEnabled)return;const i=this._material.isFrozen;(!e.useUbo||!i||!e.isSync)&&this._texture&&ne.DetailTextureEnabled&&(e.updateFloat4("vDetailInfos",this._texture.coordinatesIndex,this.diffuseBlendLevel,this.bumpLevel,this.roughnessBlendLevel),At(this._texture,e,"detail")),t.texturesEnabled&&this._texture&&ne.DetailTextureEnabled&&e.setTexture("detailSampler",this._texture)}hasTexture(e){return this._texture===e}getActiveTextures(e){this._texture&&e.push(this._texture)}getAnimatables(e){this._texture&&this._texture.animations&&this._texture.animations.length>0&&e.push(this._texture)}dispose(e){var t;e&&((t=this._texture)==null||t.dispose())}getClassName(){return"DetailMapConfiguration"}getSamplers(e){e.push("detailSampler")}getUniforms(){return{ubo:[{name:"vDetailInfos",size:4,type:"vec4"},{name:"detailMatrix",size:16,type:"mat4"}]}}}M([Tt("detailTexture"),ae("_markAllSubMeshesAsTexturesDirty")],_n.prototype,"texture",void 0);M([V()],_n.prototype,"diffuseBlendLevel",void 0);M([V()],_n.prototype,"roughnessBlendLevel",void 0);M([V()],_n.prototype,"bumpLevel",void 0);M([V(),ae("_markAllSubMeshesAsTexturesDirty")],_n.prototype,"normalBlendMethod",void 0);M([V(),ae("_markAllSubMeshesAsTexturesDirty")],_n.prototype,"isEnabled",void 0);const iu={effect:null,subMesh:null};class VM extends is{constructor(e){super(e),this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.DIFFUSE=!1,this.DIFFUSEDIRECTUV=0,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.OPACITY=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.REFLECTION=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.SPECULAR=!1,this.SPECULARDIRECTUV=0,this.BUMP=!1,this.BUMPDIRECTUV=0,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.SPECULAROVERALPHA=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHAFROMDIFFUSE=!1,this.POINTSIZE=!1,this.FOG=!1,this.SPECULARTERM=!1,this.DIFFUSEFRESNEL=!1,this.OPACITYFRESNEL=!1,this.REFLECTIONFRESNEL=!1,this.REFRACTIONFRESNEL=!1,this.EMISSIVEFRESNEL=!1,this.FRESNEL=!1,this.NORMAL=!1,this.TANGENT=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.GLOSSINESS=!1,this.ROUGHNESS=!1,this.EMISSIVEASILLUMINATION=!1,this.LINKEMISSIVEWITHDIFFUSE=!1,this.REFLECTIONFRESNELFROMSPECULAR=!1,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.USELIGHTMAPASSHADOWMAP=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.INVERTCUBICMAP=!1,this.LOGARITHMICDEPTH=!1,this.REFRACTION=!1,this.REFRACTIONMAP_3D=!1,this.REFLECTIONOVERALPHA=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.NONUNIFORMSCALING=!1,this.PREMULTIPLYALPHA=!1,this.ALPHATEST_AFTERALLALPHACOMPUTATIONS=!1,this.ALPHABLEND=!0,this.PREPASS=!1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.RGBDLIGHTMAP=!1,this.RGBDREFLECTION=!1,this.RGBDREFRACTION=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=!1,this.TONEMAPPING_ACES=!1,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.IS_REFLECTION_LINEAR=!1,this.IS_REFRACTION_LINEAR=!1,this.EXPOSURE=!1,this.DECAL_AFTER_DETAIL=!1,this.rebuild()}setReflectionMode(e){const t=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"];for(const i of t)this[i]=i===e}}class Ee extends qh{get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(e){this._attachImageProcessingConfiguration(e),this._markAllSubMeshesAsTexturesDirty()}_attachImageProcessingConfiguration(e){e!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),e?this._imageProcessingConfiguration=e:this._imageProcessingConfiguration=this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add(()=>{this._markAllSubMeshesAsImageProcessingDirty()})))}get isPrePassCapable(){return!this.disableDepthWrite}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(e){this.imageProcessingConfiguration.colorCurvesEnabled=e}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(e){this.imageProcessingConfiguration.colorGradingEnabled=e}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(e){this._imageProcessingConfiguration.toneMappingEnabled=e}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(e){this._imageProcessingConfiguration.exposure=e}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(e){this._imageProcessingConfiguration.contrast=e}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(e){this._imageProcessingConfiguration.colorGradingTexture=e}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(e){this._imageProcessingConfiguration.colorCurves=e}get canRenderToMRT(){return!0}constructor(e,t){super(e,t),this._diffuseTexture=null,this._ambientTexture=null,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._specularTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._refractionTexture=null,this.ambientColor=new De(0,0,0),this.diffuseColor=new De(1,1,1),this.specularColor=new De(1,1,1),this.emissiveColor=new De(0,0,0),this.specularPower=64,this._useAlphaFromDiffuseTexture=!1,this._useEmissiveAsIllumination=!1,this._linkEmissiveWithDiffuse=!1,this._useSpecularOverAlpha=!1,this._useReflectionOverAlpha=!1,this._disableLighting=!1,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this._roughness=0,this.indexOfRefraction=.98,this.invertRefractionY=!0,this.alphaCutOff=.4,this._useLightmapAsShadowmap=!1,this._useReflectionFresnelFromSpecular=!1,this._useGlossinessFromSpecularMapAlpha=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._applyDecalMapAfterDetailMap=!1,this._renderTargets=new Vi(16),this._worldViewProjectionMatrix=U.Zero(),this._globalAmbientColor=new De(0,0,0),this._cacheHasRenderTargetTextures=!1,this.detailMap=new _n(this),this._attachImageProcessingConfiguration(null),this.prePassConfiguration=new mh,this.getRenderTargetTextures=()=>(this._renderTargets.reset(),Ee.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),Ee.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&this._renderTargets.push(this._refractionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets)}get hasRenderTargetTextures(){return Ee.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget||Ee.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget?!0:this._cacheHasRenderTargetTextures}getClassName(){return"StandardMaterial"}needAlphaBlending(){return this._disableAlphaBlending?!1:this.alpha<1||this._opacityTexture!=null||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled}needAlphaTesting(){return this._forceAlphaTest?!0:this._hasAlphaChannel()&&(this._transparencyMode==null||this._transparencyMode===ie.MATERIAL_ALPHATEST)}_shouldUseAlphaFromDiffuseTexture(){return this._diffuseTexture!=null&&this._diffuseTexture.hasAlpha&&this._useAlphaFromDiffuseTexture&&this._transparencyMode!==ie.MATERIAL_OPAQUE}_hasAlphaChannel(){return this._diffuseTexture!=null&&this._diffuseTexture.hasAlpha||this._opacityTexture!=null}getAlphaTestTexture(){return this._diffuseTexture}isReadyForSubMesh(e,t,i=!1){this._uniformBufferLayoutBuilt||this.buildUniformLayout();const r=t._drawWrapper;if(r.effect&&this.isFrozen&&r._wasPreviouslyReady&&r._wasPreviouslyUsingInstances===i)return!0;t.materialDefines||(this._callbackPluginEventGeneric(yi.GetDefineNames,this._eventInfo),t.materialDefines=new VM(this._eventInfo.defineNames));const s=this.getScene(),o=t.materialDefines;if(this._isReadyForSubMesh(t))return!0;const a=s.getEngine();o._needNormals=T0(s,e,o,!0,this._maxSimultaneousLights,this._disableLighting),x0(s,o);const l=this.needAlphaBlendingForMesh(e)&&this.getScene().useOrderIndependentTransparency;if(R0(s,o,this.canRenderToMRT&&!l),C0(s,o,l),o._areTexturesDirty){this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,o._needUVs=!1;for(let c=1;c<=6;++c)o["MAINUV"+c]=!1;if(s.texturesEnabled){if(o.DIFFUSEDIRECTUV=0,o.BUMPDIRECTUV=0,o.AMBIENTDIRECTUV=0,o.OPACITYDIRECTUV=0,o.EMISSIVEDIRECTUV=0,o.SPECULARDIRECTUV=0,o.LIGHTMAPDIRECTUV=0,this._diffuseTexture&&Ee.DiffuseTextureEnabled)if(this._diffuseTexture.isReadyOrNotBlocking())wt(this._diffuseTexture,o,"DIFFUSE");else return!1;else o.DIFFUSE=!1;if(this._ambientTexture&&Ee.AmbientTextureEnabled)if(this._ambientTexture.isReadyOrNotBlocking())wt(this._ambientTexture,o,"AMBIENT");else return!1;else o.AMBIENT=!1;if(this._opacityTexture&&Ee.OpacityTextureEnabled)if(this._opacityTexture.isReadyOrNotBlocking())wt(this._opacityTexture,o,"OPACITY"),o.OPACITYRGB=this._opacityTexture.getAlphaFromRGB;else return!1;else o.OPACITY=!1;if(this._reflectionTexture&&Ee.ReflectionTextureEnabled)if(this._reflectionTexture.isReadyOrNotBlocking()){switch(o._needNormals=!0,o.REFLECTION=!0,o.ROUGHNESS=this._roughness>0,o.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,o.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===le.INVCUBIC_MODE,o.REFLECTIONMAP_3D=this._reflectionTexture.isCube,o.REFLECTIONMAP_OPPOSITEZ=o.REFLECTIONMAP_3D&&this.getScene().useRightHandedSystem?!this._reflectionTexture.invertZ:this._reflectionTexture.invertZ,o.RGBDREFLECTION=this._reflectionTexture.isRGBD,this._reflectionTexture.coordinatesMode){case le.EXPLICIT_MODE:o.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case le.PLANAR_MODE:o.setReflectionMode("REFLECTIONMAP_PLANAR");break;case le.PROJECTION_MODE:o.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case le.SKYBOX_MODE:o.setReflectionMode("REFLECTIONMAP_SKYBOX");break;case le.SPHERICAL_MODE:o.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case le.EQUIRECTANGULAR_MODE:o.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case le.FIXED_EQUIRECTANGULAR_MODE:o.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case le.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:o.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case le.CUBIC_MODE:case le.INVCUBIC_MODE:default:o.setReflectionMode("REFLECTIONMAP_CUBIC");break}o.USE_LOCAL_REFLECTIONMAP_CUBIC=!!this._reflectionTexture.boundingBoxSize}else return!1;else o.REFLECTION=!1,o.REFLECTIONMAP_OPPOSITEZ=!1;if(this._emissiveTexture&&Ee.EmissiveTextureEnabled)if(this._emissiveTexture.isReadyOrNotBlocking())wt(this._emissiveTexture,o,"EMISSIVE");else return!1;else o.EMISSIVE=!1;if(this._lightmapTexture&&Ee.LightmapTextureEnabled)if(this._lightmapTexture.isReadyOrNotBlocking())wt(this._lightmapTexture,o,"LIGHTMAP"),o.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,o.RGBDLIGHTMAP=this._lightmapTexture.isRGBD;else return!1;else o.LIGHTMAP=!1;if(this._specularTexture&&Ee.SpecularTextureEnabled)if(this._specularTexture.isReadyOrNotBlocking())wt(this._specularTexture,o,"SPECULAR"),o.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha;else return!1;else o.SPECULAR=!1;if(s.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&Ee.BumpTextureEnabled){if(this._bumpTexture.isReady())wt(this._bumpTexture,o,"BUMP"),o.PARALLAX=this._useParallax,o.PARALLAX_RHS=s.useRightHandedSystem,o.PARALLAXOCCLUSION=this._useParallaxOcclusion;else return!1;o.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else o.BUMP=!1,o.PARALLAX=!1,o.PARALLAX_RHS=!1,o.PARALLAXOCCLUSION=!1;if(this._refractionTexture&&Ee.RefractionTextureEnabled)if(this._refractionTexture.isReadyOrNotBlocking())o._needUVs=!0,o.REFRACTION=!0,o.REFRACTIONMAP_3D=this._refractionTexture.isCube,o.RGBDREFRACTION=this._refractionTexture.isRGBD,o.USE_LOCAL_REFRACTIONMAP_CUBIC=!!this._refractionTexture.boundingBoxSize;else return!1;else o.REFRACTION=!1;o.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else o.DIFFUSE=!1,o.AMBIENT=!1,o.OPACITY=!1,o.REFLECTION=!1,o.EMISSIVE=!1,o.LIGHTMAP=!1,o.BUMP=!1,o.REFRACTION=!1;o.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),o.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,o.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,o.SPECULAROVERALPHA=this._useSpecularOverAlpha,o.PREMULTIPLYALPHA=this.alphaMode===7||this.alphaMode===8,o.ALPHATEST_AFTERALLALPHACOMPUTATIONS=this.transparencyMode!==null,o.ALPHABLEND=this.transparencyMode===null||this.needAlphaBlendingForMesh(e)}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=o,this._eventInfo.subMesh=t,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(o._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(o),o.IS_REFLECTION_LINEAR=this.reflectionTexture!=null&&!this.reflectionTexture.gammaSpace,o.IS_REFRACTION_LINEAR=this.refractionTexture!=null&&!this.refractionTexture.gammaSpace}o._areFresnelDirty&&(Ee.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(o.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,o.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,o.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,o.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,o.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,o.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,o._needNormals=!0,o.FRESNEL=!0):o.FRESNEL=!1),xd(e,s,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e)||this._forceAlphaTest,o,this._applyDecalMapAfterDetailMap),Cd(s,a,this,o,i,null,t.getRenderingMesh().hasThinInstances),this._eventInfo.defines=o,this._eventInfo.mesh=e,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),Rd(e,o,!0,!0,!0),this._callbackPluginEventPrepareDefines(this._eventInfo);let h=!1;if(o.isDirty){const c=o._areLightsDisposed;o.markAsProcessed();const u=new bd;o.REFLECTION&&u.addFallback(0,"REFLECTION"),o.SPECULAR&&u.addFallback(0,"SPECULAR"),o.BUMP&&u.addFallback(0,"BUMP"),o.PARALLAX&&u.addFallback(1,"PARALLAX"),o.PARALLAX_RHS&&u.addFallback(1,"PARALLAX_RHS"),o.PARALLAXOCCLUSION&&u.addFallback(0,"PARALLAXOCCLUSION"),o.SPECULAROVERALPHA&&u.addFallback(0,"SPECULAROVERALPHA"),o.FOG&&u.addFallback(1,"FOG"),o.POINTSIZE&&u.addFallback(0,"POINTSIZE"),o.LOGARITHMICDEPTH&&u.addFallback(0,"LOGARITHMICDEPTH"),E0(o,u,this._maxSimultaneousLights),o.SPECULARTERM&&u.addFallback(0,"SPECULARTERM"),o.DIFFUSEFRESNEL&&u.addFallback(1,"DIFFUSEFRESNEL"),o.OPACITYFRESNEL&&u.addFallback(2,"OPACITYFRESNEL"),o.REFLECTIONFRESNEL&&u.addFallback(3,"REFLECTIONFRESNEL"),o.EMISSIVEFRESNEL&&u.addFallback(4,"EMISSIVEFRESNEL"),o.FRESNEL&&u.addFallback(4,"FRESNEL"),o.MULTIVIEW&&u.addFallback(0,"MULTIVIEW");const d=[b.PositionKind];o.NORMAL&&d.push(b.NormalKind),o.TANGENT&&d.push(b.TangentKind);for(let T=1;T<=6;++T)o["UV"+T]&&d.push(`uv${T===1?"":T}`);o.VERTEXCOLOR&&d.push(b.ColorKind),v0(d,e,o,u),Td(d,o),p0(d,e,o),vd(d,e,o);let f="default";const p=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","visibility","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","vRefractionPosition","vRefractionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff","boneTextureWidth","morphTargetTextureInfo","morphTargetTextureIndices"],g=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","boneSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"],m=["Material","Scene","Mesh"],x={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:o.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=u,this._eventInfo.fallbackRank=0,this._eventInfo.defines=o,this._eventInfo.uniforms=p,this._eventInfo.attributes=d,this._eventInfo.samplers=g,this._eventInfo.uniformBuffersNames=m,this._eventInfo.customCode=void 0,this._eventInfo.mesh=e,this._eventInfo.indexParameters=x,this._callbackPluginEventGeneric(yi.PrepareEffect,this._eventInfo),mh.AddUniforms(p),nt&&(nt.PrepareUniforms(p,o),nt.PrepareSamplers(g,o)),Sd({uniformsNames:p,uniformBuffersNames:m,samplers:g,defines:o,maxSimultaneousLights:this._maxSimultaneousLights}),Wh(p);const E={};this.customShaderNameResolve&&(f=this.customShaderNameResolve(f,p,m,g,o,d,E));const R=o.toString(),C=t.effect;let _=s.getEngine().createEffect(f,{attributes:d,uniformsNames:p,uniformBuffersNames:m,samplers:g,defines:R,fallbacks:u,onCompiled:this.onCompiled,onError:this.onError,indexParameters:x,processFinalCode:E.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:o.PREPASS},a);if(this._eventInfo.customCode=void 0,_)if(this._onEffectCreatedObservable&&(iu.effect=_,iu.subMesh=t,this._onEffectCreatedObservable.notifyObservers(iu)),this.allowShaderHotSwapping&&C&&!_.isReady()){if(_=C,o.markAsUnprocessed(),h=this.isFrozen,c)return o._areLightsDisposed=!0,!1}else s.resetCachedMaterial(),t.setEffect(_,o,this._materialContext)}return!t.effect||!t.effect.isReady()?!1:(o._renderId=s.getRenderId(),r._wasPreviouslyReady=!h,r._wasPreviouslyUsingInstances=i,this._checkScenePerformancePriority(),!0)}buildUniformLayout(){const e=this._uniformBuffer;e.addUniform("diffuseLeftColor",4),e.addUniform("diffuseRightColor",4),e.addUniform("opacityParts",4),e.addUniform("reflectionLeftColor",4),e.addUniform("reflectionRightColor",4),e.addUniform("refractionLeftColor",4),e.addUniform("refractionRightColor",4),e.addUniform("emissiveLeftColor",4),e.addUniform("emissiveRightColor",4),e.addUniform("vDiffuseInfos",2),e.addUniform("vAmbientInfos",2),e.addUniform("vOpacityInfos",2),e.addUniform("vReflectionInfos",2),e.addUniform("vReflectionPosition",3),e.addUniform("vReflectionSize",3),e.addUniform("vEmissiveInfos",2),e.addUniform("vLightmapInfos",2),e.addUniform("vSpecularInfos",2),e.addUniform("vBumpInfos",3),e.addUniform("diffuseMatrix",16),e.addUniform("ambientMatrix",16),e.addUniform("opacityMatrix",16),e.addUniform("reflectionMatrix",16),e.addUniform("emissiveMatrix",16),e.addUniform("lightmapMatrix",16),e.addUniform("specularMatrix",16),e.addUniform("bumpMatrix",16),e.addUniform("vTangentSpaceParams",2),e.addUniform("pointSize",1),e.addUniform("alphaCutOff",1),e.addUniform("refractionMatrix",16),e.addUniform("vRefractionInfos",4),e.addUniform("vRefractionPosition",3),e.addUniform("vRefractionSize",3),e.addUniform("vSpecularColor",4),e.addUniform("vEmissiveColor",3),e.addUniform("vDiffuseColor",4),e.addUniform("vAmbientColor",3),super.buildUniformLayout()}bindForSubMesh(e,t,i){var r;const s=this.getScene(),o=i.materialDefines;if(!o)return;const a=i.effect;if(!a)return;this._activeEffect=a,t.getMeshUniformBuffer().bindToEffect(a,"Mesh"),t.transferToEffect(e),this._uniformBuffer.bindToEffect(a,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,s,t,e,this.isFrozen),this._eventInfo.subMesh=i,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),o.OBJECTSPACE_NORMALMAP&&(e.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const l=this._mustRebind(s,a,i,t.visibility);Ed(t,a);const h=this._uniformBuffer;if(l){if(this.bindViewProjection(a),!h.useUbo||!this.isFrozen||!h.isSync||i._drawWrapper._forceRebindOnNextCall){if(Ee.FresnelEnabled&&o.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(h.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),h.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&h.updateColor4("opacityParts",new De(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(h.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),h.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(h.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),h.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(h.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),h.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),s.texturesEnabled){if(this._diffuseTexture&&Ee.DiffuseTextureEnabled&&(h.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),At(this._diffuseTexture,h,"diffuse")),this._ambientTexture&&Ee.AmbientTextureEnabled&&(h.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),At(this._ambientTexture,h,"ambient")),this._opacityTexture&&Ee.OpacityTextureEnabled&&(h.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),At(this._opacityTexture,h,"opacity")),this._hasAlphaChannel()&&h.updateFloat("alphaCutOff",this.alphaCutOff),this._reflectionTexture&&Ee.ReflectionTextureEnabled&&(h.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),h.updateMatrix("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix()),this._reflectionTexture.boundingBoxSize)){const c=this._reflectionTexture;h.updateVector3("vReflectionPosition",c.boundingBoxPosition),h.updateVector3("vReflectionSize",c.boundingBoxSize)}if(this._emissiveTexture&&Ee.EmissiveTextureEnabled&&(h.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),At(this._emissiveTexture,h,"emissive")),this._lightmapTexture&&Ee.LightmapTextureEnabled&&(h.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),At(this._lightmapTexture,h,"lightmap")),this._specularTexture&&Ee.SpecularTextureEnabled&&(h.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),At(this._specularTexture,h,"specular")),this._bumpTexture&&s.getEngine().getCaps().standardDerivatives&&Ee.BumpTextureEnabled&&(h.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),At(this._bumpTexture,h,"bump"),s._mirroredCameraPosition?h.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):h.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&Ee.RefractionTextureEnabled){let c=1;if(this._refractionTexture.isCube||(h.updateMatrix("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(c=this._refractionTexture.depth)),h.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,c,this.invertRefractionY?-1:1),this._refractionTexture.boundingBoxSize){const u=this._refractionTexture;h.updateVector3("vRefractionPosition",u.boundingBoxPosition),h.updateVector3("vRefractionSize",u.boundingBoxSize)}}}this.pointsCloud&&h.updateFloat("pointSize",this.pointSize),o.SPECULARTERM&&h.updateColor4("vSpecularColor",this.specularColor,this.specularPower),h.updateColor3("vEmissiveColor",Ee.EmissiveTextureEnabled?this.emissiveColor:De.BlackReadOnly),h.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha),s.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),h.updateColor3("vAmbientColor",this._globalAmbientColor)}s.texturesEnabled&&(this._diffuseTexture&&Ee.DiffuseTextureEnabled&&a.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&Ee.AmbientTextureEnabled&&a.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&Ee.OpacityTextureEnabled&&a.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&Ee.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?a.setTexture("reflectionCubeSampler",this._reflectionTexture):a.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&Ee.EmissiveTextureEnabled&&a.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&Ee.LightmapTextureEnabled&&a.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&Ee.SpecularTextureEnabled&&a.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&s.getEngine().getCaps().standardDerivatives&&Ee.BumpTextureEnabled&&a.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&Ee.RefractionTextureEnabled&&(this._refractionTexture.isCube?a.setTexture("refractionCubeSampler",this._refractionTexture):a.setTexture("refraction2DSampler",this._refractionTexture))),this.getScene().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(t)&&this.getScene().depthPeelingRenderer.bind(a),this._eventInfo.subMesh=i,this._callbackPluginEventBindForSubMesh(this._eventInfo),Xh(a,this,s),this.bindEyePosition(a)}else s.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);(l||!this.isFrozen)&&(s.lightsEnabled&&!this._disableLighting&&_0(s,t,a,o,this._maxSimultaneousLights),(s.fogEnabled&&t.applyFog&&s.fogMode!==Pt.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture||t.receiveShadows||o.PREPASS)&&this.bindView(a),Kh(s,t,a),o.NUM_MORPH_INFLUENCERS&&_d(t,a),o.BAKED_VERTEX_ANIMATION_TEXTURE&&((r=t.bakedVertexAnimationManager)==null||r.bind(a,o.INSTANCES)),this.useLogarithmicDepth&&Hh(o,a,s),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)),this._afterBind(t,this._activeEffect,i),h.update()}getAnimatables(){const e=super.getAnimatables();return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&e.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&e.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&e.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&e.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&e.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&e.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&e.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&e.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&e.push(this._refractionTexture),e}getActiveTextures(){const e=super.getActiveTextures();return this._diffuseTexture&&e.push(this._diffuseTexture),this._ambientTexture&&e.push(this._ambientTexture),this._opacityTexture&&e.push(this._opacityTexture),this._reflectionTexture&&e.push(this._reflectionTexture),this._emissiveTexture&&e.push(this._emissiveTexture),this._specularTexture&&e.push(this._specularTexture),this._bumpTexture&&e.push(this._bumpTexture),this._lightmapTexture&&e.push(this._lightmapTexture),this._refractionTexture&&e.push(this._refractionTexture),e}hasTexture(e){return!!(super.hasTexture(e)||this._diffuseTexture===e||this._ambientTexture===e||this._opacityTexture===e||this._reflectionTexture===e||this._emissiveTexture===e||this._specularTexture===e||this._bumpTexture===e||this._lightmapTexture===e||this._refractionTexture===e)}dispose(e,t){var i,r,s,o,a,l,h,c,u;t&&((i=this._diffuseTexture)==null||i.dispose(),(r=this._ambientTexture)==null||r.dispose(),(s=this._opacityTexture)==null||s.dispose(),(o=this._reflectionTexture)==null||o.dispose(),(a=this._emissiveTexture)==null||a.dispose(),(l=this._specularTexture)==null||l.dispose(),(h=this._bumpTexture)==null||h.dispose(),(c=this._lightmapTexture)==null||c.dispose(),(u=this._refractionTexture)==null||u.dispose()),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(e,t)}clone(e,t=!0,i=""){const r=Le.Clone(()=>new Ee(e,this.getScene()),this,{cloneTexturesOnlyOnce:t});return r.name=e,r.id=e,this.stencil.copyTo(r.stencil),this._clonePlugins(r,i),r}static Parse(e,t,i){const r=Le.Parse(()=>new Ee(e.name,t),e,t,i);return e.stencil&&r.stencil.parse(e.stencil,t,i),ie._ParsePlugins(e,r,t,i),r}static get DiffuseTextureEnabled(){return ne.DiffuseTextureEnabled}static set DiffuseTextureEnabled(e){ne.DiffuseTextureEnabled=e}static get DetailTextureEnabled(){return ne.DetailTextureEnabled}static set DetailTextureEnabled(e){ne.DetailTextureEnabled=e}static get AmbientTextureEnabled(){return ne.AmbientTextureEnabled}static set AmbientTextureEnabled(e){ne.AmbientTextureEnabled=e}static get OpacityTextureEnabled(){return ne.OpacityTextureEnabled}static set OpacityTextureEnabled(e){ne.OpacityTextureEnabled=e}static get ReflectionTextureEnabled(){return ne.ReflectionTextureEnabled}static set ReflectionTextureEnabled(e){ne.ReflectionTextureEnabled=e}static get EmissiveTextureEnabled(){return ne.EmissiveTextureEnabled}static set EmissiveTextureEnabled(e){ne.EmissiveTextureEnabled=e}static get SpecularTextureEnabled(){return ne.SpecularTextureEnabled}static set SpecularTextureEnabled(e){ne.SpecularTextureEnabled=e}static get BumpTextureEnabled(){return ne.BumpTextureEnabled}static set BumpTextureEnabled(e){ne.BumpTextureEnabled=e}static get LightmapTextureEnabled(){return ne.LightmapTextureEnabled}static set LightmapTextureEnabled(e){ne.LightmapTextureEnabled=e}static get RefractionTextureEnabled(){return ne.RefractionTextureEnabled}static set RefractionTextureEnabled(e){ne.RefractionTextureEnabled=e}static get ColorGradingTextureEnabled(){return ne.ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(e){ne.ColorGradingTextureEnabled=e}static get FresnelEnabled(){return ne.FresnelEnabled}static set FresnelEnabled(e){ne.FresnelEnabled=e}}M([Tt("diffuseTexture")],Ee.prototype,"_diffuseTexture",void 0);M([ae("_markAllSubMeshesAsTexturesAndMiscDirty")],Ee.prototype,"diffuseTexture",void 0);M([Tt("ambientTexture")],Ee.prototype,"_ambientTexture",void 0);M([ae("_markAllSubMeshesAsTexturesDirty")],Ee.prototype,"ambientTexture",void 0);M([Tt("opacityTexture")],Ee.prototype,"_opacityTexture",void 0);M([ae("_markAllSubMeshesAsTexturesAndMiscDirty")],Ee.prototype,"opacityTexture",void 0);M([Tt("reflectionTexture")],Ee.prototype,"_reflectionTexture",void 0);M([ae("_markAllSubMeshesAsTexturesDirty")],Ee.prototype,"reflectionTexture",void 0);M([Tt("emissiveTexture")],Ee.prototype,"_emissiveTexture",void 0);M([ae("_markAllSubMeshesAsTexturesDirty")],Ee.prototype,"emissiveTexture",void 0);M([Tt("specularTexture")],Ee.prototype,"_specularTexture",void 0);M([ae("_markAllSubMeshesAsTexturesDirty")],Ee.prototype,"specularTexture",void 0);M([Tt("bumpTexture")],Ee.prototype,"_bumpTexture",void 0);M([ae("_markAllSubMeshesAsTexturesDirty")],Ee.prototype,"bumpTexture",void 0);M([Tt("lightmapTexture")],Ee.prototype,"_lightmapTexture",void 0);M([ae("_markAllSubMeshesAsTexturesDirty")],Ee.prototype,"lightmapTexture",void 0);M([Tt("refractionTexture")],Ee.prototype,"_refractionTexture",void 0);M([ae("_markAllSubMeshesAsTexturesDirty")],Ee.prototype,"refractionTexture",void 0);M([sr("ambient")],Ee.prototype,"ambientColor",void 0);M([sr("diffuse")],Ee.prototype,"diffuseColor",void 0);M([sr("specular")],Ee.prototype,"specularColor",void 0);M([sr("emissive")],Ee.prototype,"emissiveColor",void 0);M([V()],Ee.prototype,"specularPower",void 0);M([V("useAlphaFromDiffuseTexture")],Ee.prototype,"_useAlphaFromDiffuseTexture",void 0);M([ae("_markAllSubMeshesAsTexturesAndMiscDirty")],Ee.prototype,"useAlphaFromDiffuseTexture",void 0);M([V("useEmissiveAsIllumination")],Ee.prototype,"_useEmissiveAsIllumination",void 0);M([ae("_markAllSubMeshesAsTexturesDirty")],Ee.prototype,"useEmissiveAsIllumination",void 0);M([V("linkEmissiveWithDiffuse")],Ee.prototype,"_linkEmissiveWithDiffuse",void 0);M([ae("_markAllSubMeshesAsTexturesDirty")],Ee.prototype,"linkEmissiveWithDiffuse",void 0);M([V("useSpecularOverAlpha")],Ee.prototype,"_useSpecularOverAlpha",void 0);M([ae("_markAllSubMeshesAsTexturesDirty")],Ee.prototype,"useSpecularOverAlpha",void 0);M([V("useReflectionOverAlpha")],Ee.prototype,"_useReflectionOverAlpha",void 0);M([ae("_markAllSubMeshesAsTexturesDirty")],Ee.prototype,"useReflectionOverAlpha",void 0);M([V("disableLighting")],Ee.prototype,"_disableLighting",void 0);M([ae("_markAllSubMeshesAsLightsDirty")],Ee.prototype,"disableLighting",void 0);M([V("useObjectSpaceNormalMap")],Ee.prototype,"_useObjectSpaceNormalMap",void 0);M([ae("_markAllSubMeshesAsTexturesDirty")],Ee.prototype,"useObjectSpaceNormalMap",void 0);M([V("useParallax")],Ee.prototype,"_useParallax",void 0);M([ae("_markAllSubMeshesAsTexturesDirty")],Ee.prototype,"useParallax",void 0);M([V("useParallaxOcclusion")],Ee.prototype,"_useParallaxOcclusion",void 0);M([ae("_markAllSubMeshesAsTexturesDirty")],Ee.prototype,"useParallaxOcclusion",void 0);M([V()],Ee.prototype,"parallaxScaleBias",void 0);M([V("roughness")],Ee.prototype,"_roughness",void 0);M([ae("_markAllSubMeshesAsTexturesDirty")],Ee.prototype,"roughness",void 0);M([V()],Ee.prototype,"indexOfRefraction",void 0);M([V()],Ee.prototype,"invertRefractionY",void 0);M([V()],Ee.prototype,"alphaCutOff",void 0);M([V("useLightmapAsShadowmap")],Ee.prototype,"_useLightmapAsShadowmap",void 0);M([ae("_markAllSubMeshesAsTexturesDirty")],Ee.prototype,"useLightmapAsShadowmap",void 0);M([ja("diffuseFresnelParameters")],Ee.prototype,"_diffuseFresnelParameters",void 0);M([ae("_markAllSubMeshesAsFresnelDirty")],Ee.prototype,"diffuseFresnelParameters",void 0);M([ja("opacityFresnelParameters")],Ee.prototype,"_opacityFresnelParameters",void 0);M([ae("_markAllSubMeshesAsFresnelAndMiscDirty")],Ee.prototype,"opacityFresnelParameters",void 0);M([ja("reflectionFresnelParameters")],Ee.prototype,"_reflectionFresnelParameters",void 0);M([ae("_markAllSubMeshesAsFresnelDirty")],Ee.prototype,"reflectionFresnelParameters",void 0);M([ja("refractionFresnelParameters")],Ee.prototype,"_refractionFresnelParameters",void 0);M([ae("_markAllSubMeshesAsFresnelDirty")],Ee.prototype,"refractionFresnelParameters",void 0);M([ja("emissiveFresnelParameters")],Ee.prototype,"_emissiveFresnelParameters",void 0);M([ae("_markAllSubMeshesAsFresnelDirty")],Ee.prototype,"emissiveFresnelParameters",void 0);M([V("useReflectionFresnelFromSpecular")],Ee.prototype,"_useReflectionFresnelFromSpecular",void 0);M([ae("_markAllSubMeshesAsFresnelDirty")],Ee.prototype,"useReflectionFresnelFromSpecular",void 0);M([V("useGlossinessFromSpecularMapAlpha")],Ee.prototype,"_useGlossinessFromSpecularMapAlpha",void 0);M([ae("_markAllSubMeshesAsTexturesDirty")],Ee.prototype,"useGlossinessFromSpecularMapAlpha",void 0);M([V("maxSimultaneousLights")],Ee.prototype,"_maxSimultaneousLights",void 0);M([ae("_markAllSubMeshesAsLightsDirty")],Ee.prototype,"maxSimultaneousLights",void 0);M([V("invertNormalMapX")],Ee.prototype,"_invertNormalMapX",void 0);M([ae("_markAllSubMeshesAsTexturesDirty")],Ee.prototype,"invertNormalMapX",void 0);M([V("invertNormalMapY")],Ee.prototype,"_invertNormalMapY",void 0);M([ae("_markAllSubMeshesAsTexturesDirty")],Ee.prototype,"invertNormalMapY",void 0);M([V("twoSidedLighting")],Ee.prototype,"_twoSidedLighting",void 0);M([ae("_markAllSubMeshesAsTexturesDirty")],Ee.prototype,"twoSidedLighting",void 0);M([V("applyDecalMapAfterDetailMap")],Ee.prototype,"_applyDecalMapAfterDetailMap",void 0);M([ae("_markAllSubMeshesAsMiscDirty")],Ee.prototype,"applyDecalMapAfterDetailMap",void 0);ye("BABYLON.StandardMaterial",Ee);Pt.DefaultMaterialFactory=n=>new Ee("default material",n);const BM="rgbdDecodePixelShader",kM=`varying vec2 vUV;uniform sampler2D textureSampler;
#include<helperFunctions>
#define CUSTOM_FRAGMENT_DEFINITIONS
void main(void) 
{gl_FragColor=vec4(fromRGBD(texture2D(textureSampler,vUV)),1.0);}`;Y.ShadersStore[BM]=kM;const zM="passCubePixelShader",GM=`varying vec2 vUV;uniform samplerCube textureSampler;
#define CUSTOM_FRAGMENT_DEFINITIONS
void main(void) 
{vec2 uv=vUV*2.0-1.0;
#ifdef POSITIVEX
gl_FragColor=textureCube(textureSampler,vec3(1.001,uv.y,uv.x));
#endif
#ifdef NEGATIVEX
gl_FragColor=textureCube(textureSampler,vec3(-1.001,uv.y,uv.x));
#endif
#ifdef POSITIVEY
gl_FragColor=textureCube(textureSampler,vec3(uv.y,1.001,uv.x));
#endif
#ifdef NEGATIVEY
gl_FragColor=textureCube(textureSampler,vec3(uv.y,-1.001,uv.x));
#endif
#ifdef POSITIVEZ
gl_FragColor=textureCube(textureSampler,vec3(uv,1.001));
#endif
#ifdef NEGATIVEZ
gl_FragColor=textureCube(textureSampler,vec3(uv,-1.001));
#endif
}`;Y.ShadersStore[zM]=GM;class $a extends Mt{getClassName(){return"PassPostProcess"}constructor(e,t,i=null,r,s,o,a=0,l=!1){super(e,"pass",null,null,t,i,r,s,o,void 0,a,void 0,null,l)}static _Parse(e,t,i,r){return Le.Parse(()=>new $a(e.name,e.options,t,e.renderTargetSamplingMode,e._engine,e.reusable),e,i,r)}}ye("BABYLON.PassPostProcess",$a);se._RescalePostProcessFactory=n=>new $a("rescale",1,null,2,n,!1,0);function WM(n,e,t,i=!0){const r=n.getScene(),s=r.getEngine(),o=new vr("resized"+n.name,{width:e,height:t},r,!n.noMipmap,!0,n._texture.type,!1,n.samplingMode,!1);o.wrapU=n.wrapU,o.wrapV=n.wrapV,o.uOffset=n.uOffset,o.vOffset=n.vOffset,o.uScale=n.uScale,o.vScale=n.vScale,o.uAng=n.uAng,o.vAng=n.vAng,o.wAng=n.wAng,o.coordinatesIndex=n.coordinatesIndex,o.level=n.level,o.anisotropicFilteringLevel=n.anisotropicFilteringLevel,o._texture.isReady=!1,n.wrapU=le.CLAMP_ADDRESSMODE,n.wrapV=le.CLAMP_ADDRESSMODE;const a=new $a("pass",1,null,i?le.BILINEAR_SAMPLINGMODE:le.NEAREST_SAMPLINGMODE,s,!1,0);return a.externalTextureSamplerBinding=!0,a.getEffect().executeWhenCompiled(()=>{a.onApply=function(h){h.setTexture("textureSampler",n)};const l=o.renderTarget;l&&(r.postProcessManager.directRender([a],l),s.unBindFramebuffer(l),o.disposeFramebufferObjects(),a.dispose(),o.getInternalTexture().isReady=!0)}),o}function Ld(n,e,t,i,r,s,o,a){const l=e.getEngine();return e.isReady=!1,r=r??e.samplingMode,i=i??e.type,s=s??e.format,o=o??e.width,a=a??e.height,i===-1&&(i=0),new Promise(h=>{const c=new Mt("postprocess",n,null,null,1,null,r,l,!1,void 0,i,void 0,null,!1,s);c.externalTextureSamplerBinding=!0;const u=l.createRenderTargetTexture({width:o,height:a},{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:r,type:i,format:s});c.getEffect().executeWhenCompiled(()=>{c.onApply=d=>{d._bindTexture("textureSampler",e),d.setFloat2("scale",1,1)},t.postProcessManager.directRender([c],u,!0),l.restoreDefaultFramebuffer(),l._releaseTexture(e),c&&c.dispose(),u._swapAndDie(e),e.type=i,e.format=5,e.isReady=!0,h(e)})})}let Sl,Ag;function us(n){Sl||(Sl=new Float32Array(1),Ag=new Int32Array(Sl.buffer)),Sl[0]=n;const e=Ag[0];let t=e>>16&32768,i=e>>12&2047;const r=e>>23&255;return r<103?t:r>142?(t|=31744,t|=(r==255?0:1)&&e&8388607,t):r<113?(i|=2048,t|=(i>>114-r)+(i>>113-r&1),t):(t|=r-112<<10|i>>1,t+=i&1,t)}function Ns(n){const e=(n&32768)>>15,t=(n&31744)>>10,i=n&1023;return t===0?(e?-1:1)*Math.pow(2,-14)*(i/Math.pow(2,10)):t==31?i?NaN:(e?-1:1)*(1/0):(e?-1:1)*Math.pow(2,t-15)*(1+i/Math.pow(2,10))}const XM=async(n,e,t,i,r)=>{const s=n.getScene(),o=s.getEngine();let a;if(!n.isCube)a=new Mt("lod","lod",["lod","gamma"],null,1,null,le.NEAREST_NEAREST_MIPNEAREST,o);else{const c=["#define POSITIVEX","#define NEGATIVEX","#define POSITIVEY","#define NEGATIVEY","#define POSITIVEZ","#define NEGATIVEZ"];a=new Mt("lodCube","lodCube",["lod","gamma"],null,1,null,le.NEAREST_NEAREST_MIPNEAREST,o,!1,c[i])}await new Promise(c=>{a.getEffect().executeWhenCompiled(()=>{c(0)})});const l=new vr("temp",{width:e,height:t},s,!1);a.onApply=function(c){c.setTexture("textureSampler",n),c.setFloat("lod",r),c.setBool("gamma",n.gammaSpace)};const h=n.getInternalTexture();try{if(l.renderTarget&&h){const c=h.samplingMode;r!==0?n.updateSamplingMode(le.NEAREST_NEAREST_MIPNEAREST):n.updateSamplingMode(le.NEAREST_NEAREST),s.postProcessManager.directRender([a],l.renderTarget,!0),n.updateSamplingMode(c);const u=await o.readPixels(0,0,e,t),d=new Uint8Array(u.buffer,0,u.byteLength);return o.unBindFramebuffer(l.renderTarget),d}else throw Error("Render to texture failed.")}finally{l.dispose(),a.dispose()}};async function HM(n,e,t,i=0,r=0){return!n.isReady()&&n._texture&&await new Promise((s,o)=>{if(n._texture===null){o(0);return}n._texture.onLoadedObservable.addOnce(()=>{s(0)})}),await XM(n,e,t,i,r)}const KM={CreateResizedCopy:WM,ApplyPostProcess:Ld,ToHalfFloat:us,FromHalfFloat:Ns,GetTextureDataAsync:HM};class Mg{static ExpandRGBDTexture(e){const t=e._texture;if(!t||!e.isRGBD)return;const i=t.getEngine(),r=i.getCaps(),s=t.isReady;let o=!1;r.textureHalfFloatRender&&r.textureHalfFloatLinearFiltering?(o=!0,t.type=2):r.textureFloatRender&&r.textureFloatLinearFiltering&&(o=!0,t.type=1),o&&(t.isReady=!1,t._isRGBD=!1,t.invertY=!1);const a=()=>{const l=new Mt("rgbdDecode","rgbdDecode",null,null,1,null,3,i,!1,void 0,t.type,void 0,null,!1);l.externalTextureSamplerBinding=!0;const h=i.createRenderTargetTexture(t.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:t.samplingMode,type:t.type,format:5});l.getEffect().executeWhenCompiled(()=>{l.onApply=c=>{c._bindTexture("textureSampler",t),c.setFloat2("scale",1,1)},e.getScene().postProcessManager.directRender([l],h,!0),i.restoreDefaultFramebuffer(),i._releaseTexture(t),l&&l.dispose(),h._swapAndDie(t),t.isReady=!0})};o&&(s?a():e.onLoadObservable.addOnce(a))}static EncodeTextureToRGBD(e,t,i=0){return Ld("rgbdEncode",e,t,i,1,5)}}const qM="data:image/png;base64,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";let YM=0;const X0=n=>{if(!n.environmentBRDFTexture){const e=n.useDelayedTextureLoading;n.useDelayedTextureLoading=!1;const t=n._blockEntityCollection;n._blockEntityCollection=!1;const i=le.CreateFromBase64String(qM,"EnvironmentBRDFTexture"+YM++,n,!0,!1,le.BILINEAR_SAMPLINGMODE);n._blockEntityCollection=t;const r=n.getEngine().getLoadedTexturesCache(),s=r.indexOf(i.getInternalTexture());s!==-1&&r.splice(s,1),i.isRGBD=!0,i.wrapU=le.CLAMP_ADDRESSMODE,i.wrapV=le.CLAMP_ADDRESSMODE,n.environmentBRDFTexture=i,n.useDelayedTextureLoading=e,Mg.ExpandRGBDTexture(i);const o=n.getEngine().onContextRestoredObservable.add(()=>{i.isRGBD=!0;const a=n.onBeforeRenderObservable.add(()=>{i.isReady()&&(n.onBeforeRenderObservable.remove(a),Mg.ExpandRGBDTexture(i))})});n.onDisposeObservable.add(()=>{n.getEngine().onContextRestoredObservable.remove(o)})}return n.environmentBRDFTexture};class ZM extends is{constructor(){super(...arguments),this.BRDF_V_HEIGHT_CORRELATED=!1,this.MS_BRDF_ENERGY_CONSERVATION=!1,this.SPHERICAL_HARMONICS=!1,this.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=!1}}class Ui extends kr{_markAllSubMeshesAsMiscDirty(){this._internalMarkAllSubMeshesAsMiscDirty()}constructor(e,t=!0){super(e,"PBRBRDF",90,new ZM,t),this._useEnergyConservation=Ui.DEFAULT_USE_ENERGY_CONSERVATION,this.useEnergyConservation=Ui.DEFAULT_USE_ENERGY_CONSERVATION,this._useSmithVisibilityHeightCorrelated=Ui.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this.useSmithVisibilityHeightCorrelated=Ui.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this._useSphericalHarmonics=Ui.DEFAULT_USE_SPHERICAL_HARMONICS,this.useSphericalHarmonics=Ui.DEFAULT_USE_SPHERICAL_HARMONICS,this._useSpecularGlossinessInputEnergyConservation=Ui.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this.useSpecularGlossinessInputEnergyConservation=Ui.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this._internalMarkAllSubMeshesAsMiscDirty=e._dirtyCallbacks[16],this._enable(!0)}prepareDefines(e){e.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,e.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,e.SPHERICAL_HARMONICS=this._useSphericalHarmonics,e.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=this._useSpecularGlossinessInputEnergyConservation}getClassName(){return"PBRBRDFConfiguration"}}Ui.DEFAULT_USE_ENERGY_CONSERVATION=!0;Ui.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0;Ui.DEFAULT_USE_SPHERICAL_HARMONICS=!0;Ui.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION=!0;M([V(),ae("_markAllSubMeshesAsMiscDirty")],Ui.prototype,"useEnergyConservation",void 0);M([V(),ae("_markAllSubMeshesAsMiscDirty")],Ui.prototype,"useSmithVisibilityHeightCorrelated",void 0);M([V(),ae("_markAllSubMeshesAsMiscDirty")],Ui.prototype,"useSphericalHarmonics",void 0);M([V(),ae("_markAllSubMeshesAsMiscDirty")],Ui.prototype,"useSpecularGlossinessInputEnergyConservation",void 0);const hs=[Math.sqrt(1/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(3/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(15/(4*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(5/(16*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(15/(16*Math.PI))],jM=[()=>1,n=>n.y,n=>n.z,n=>n.x,n=>n.x*n.y,n=>n.y*n.z,n=>3*n.z*n.z-1,n=>n.x*n.z,n=>n.x*n.x-n.y*n.y],Os=(n,e)=>hs[n]*jM[n](e),Ds=[Math.PI,2*Math.PI/3,2*Math.PI/3,2*Math.PI/3,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4];class Ia{constructor(){this.preScaled=!1,this.l00=v.Zero(),this.l1_1=v.Zero(),this.l10=v.Zero(),this.l11=v.Zero(),this.l2_2=v.Zero(),this.l2_1=v.Zero(),this.l20=v.Zero(),this.l21=v.Zero(),this.l22=v.Zero()}addLight(e,t,i){W.Vector3[0].set(t.r,t.g,t.b);const r=W.Vector3[0],s=W.Vector3[1];r.scaleToRef(i,s),s.scaleToRef(Os(0,e),W.Vector3[2]),this.l00.addInPlace(W.Vector3[2]),s.scaleToRef(Os(1,e),W.Vector3[2]),this.l1_1.addInPlace(W.Vector3[2]),s.scaleToRef(Os(2,e),W.Vector3[2]),this.l10.addInPlace(W.Vector3[2]),s.scaleToRef(Os(3,e),W.Vector3[2]),this.l11.addInPlace(W.Vector3[2]),s.scaleToRef(Os(4,e),W.Vector3[2]),this.l2_2.addInPlace(W.Vector3[2]),s.scaleToRef(Os(5,e),W.Vector3[2]),this.l2_1.addInPlace(W.Vector3[2]),s.scaleToRef(Os(6,e),W.Vector3[2]),this.l20.addInPlace(W.Vector3[2]),s.scaleToRef(Os(7,e),W.Vector3[2]),this.l21.addInPlace(W.Vector3[2]),s.scaleToRef(Os(8,e),W.Vector3[2]),this.l22.addInPlace(W.Vector3[2])}scaleInPlace(e){this.l00.scaleInPlace(e),this.l1_1.scaleInPlace(e),this.l10.scaleInPlace(e),this.l11.scaleInPlace(e),this.l2_2.scaleInPlace(e),this.l2_1.scaleInPlace(e),this.l20.scaleInPlace(e),this.l21.scaleInPlace(e),this.l22.scaleInPlace(e)}convertIncidentRadianceToIrradiance(){this.l00.scaleInPlace(Ds[0]),this.l1_1.scaleInPlace(Ds[1]),this.l10.scaleInPlace(Ds[2]),this.l11.scaleInPlace(Ds[3]),this.l2_2.scaleInPlace(Ds[4]),this.l2_1.scaleInPlace(Ds[5]),this.l20.scaleInPlace(Ds[6]),this.l21.scaleInPlace(Ds[7]),this.l22.scaleInPlace(Ds[8])}convertIrradianceToLambertianRadiance(){this.scaleInPlace(1/Math.PI)}preScaleForRendering(){this.preScaled=!0,this.l00.scaleInPlace(hs[0]),this.l1_1.scaleInPlace(hs[1]),this.l10.scaleInPlace(hs[2]),this.l11.scaleInPlace(hs[3]),this.l2_2.scaleInPlace(hs[4]),this.l2_1.scaleInPlace(hs[5]),this.l20.scaleInPlace(hs[6]),this.l21.scaleInPlace(hs[7]),this.l22.scaleInPlace(hs[8])}updateFromArray(e){return v.FromArrayToRef(e[0],0,this.l00),v.FromArrayToRef(e[1],0,this.l1_1),v.FromArrayToRef(e[2],0,this.l10),v.FromArrayToRef(e[3],0,this.l11),v.FromArrayToRef(e[4],0,this.l2_2),v.FromArrayToRef(e[5],0,this.l2_1),v.FromArrayToRef(e[6],0,this.l20),v.FromArrayToRef(e[7],0,this.l21),v.FromArrayToRef(e[8],0,this.l22),this}updateFromFloatsArray(e){return v.FromFloatsToRef(e[0],e[1],e[2],this.l00),v.FromFloatsToRef(e[3],e[4],e[5],this.l1_1),v.FromFloatsToRef(e[6],e[7],e[8],this.l10),v.FromFloatsToRef(e[9],e[10],e[11],this.l11),v.FromFloatsToRef(e[12],e[13],e[14],this.l2_2),v.FromFloatsToRef(e[15],e[16],e[17],this.l2_1),v.FromFloatsToRef(e[18],e[19],e[20],this.l20),v.FromFloatsToRef(e[21],e[22],e[23],this.l21),v.FromFloatsToRef(e[24],e[25],e[26],this.l22),this}static FromArray(e){return new Ia().updateFromArray(e)}static FromPolynomial(e){const t=new Ia;return t.l00=e.xx.scale(.376127).add(e.yy.scale(.376127)).add(e.zz.scale(.376126)),t.l1_1=e.y.scale(.977204),t.l10=e.z.scale(.977204),t.l11=e.x.scale(.977204),t.l2_2=e.xy.scale(1.16538),t.l2_1=e.yz.scale(1.16538),t.l20=e.zz.scale(1.34567).subtract(e.xx.scale(.672834)).subtract(e.yy.scale(.672834)),t.l21=e.zx.scale(1.16538),t.l22=e.xx.scale(1.16538).subtract(e.yy.scale(1.16538)),t.l1_1.scaleInPlace(-1),t.l11.scaleInPlace(-1),t.l2_1.scaleInPlace(-1),t.l21.scaleInPlace(-1),t.scaleInPlace(Math.PI),t}}class Aa{constructor(){this.x=v.Zero(),this.y=v.Zero(),this.z=v.Zero(),this.xx=v.Zero(),this.yy=v.Zero(),this.zz=v.Zero(),this.xy=v.Zero(),this.yz=v.Zero(),this.zx=v.Zero()}get preScaledHarmonics(){return this._harmonics||(this._harmonics=Ia.FromPolynomial(this)),this._harmonics.preScaled||this._harmonics.preScaleForRendering(),this._harmonics}addAmbient(e){W.Vector3[0].copyFromFloats(e.r,e.g,e.b);const t=W.Vector3[0];this.xx.addInPlace(t),this.yy.addInPlace(t),this.zz.addInPlace(t)}scaleInPlace(e){this.x.scaleInPlace(e),this.y.scaleInPlace(e),this.z.scaleInPlace(e),this.xx.scaleInPlace(e),this.yy.scaleInPlace(e),this.zz.scaleInPlace(e),this.yz.scaleInPlace(e),this.zx.scaleInPlace(e),this.xy.scaleInPlace(e)}updateFromHarmonics(e){return this._harmonics=e,this.x.copyFrom(e.l11),this.x.scaleInPlace(1.02333).scaleInPlace(-1),this.y.copyFrom(e.l1_1),this.y.scaleInPlace(1.02333).scaleInPlace(-1),this.z.copyFrom(e.l10),this.z.scaleInPlace(1.02333),this.xx.copyFrom(e.l00),W.Vector3[0].copyFrom(e.l20).scaleInPlace(.247708),W.Vector3[1].copyFrom(e.l22).scaleInPlace(.429043),this.xx.scaleInPlace(.886277).subtractInPlace(W.Vector3[0]).addInPlace(W.Vector3[1]),this.yy.copyFrom(e.l00),this.yy.scaleInPlace(.886277).subtractInPlace(W.Vector3[0]).subtractInPlace(W.Vector3[1]),this.zz.copyFrom(e.l00),W.Vector3[0].copyFrom(e.l20).scaleInPlace(.495417),this.zz.scaleInPlace(.886277).addInPlace(W.Vector3[0]),this.yz.copyFrom(e.l2_1),this.yz.scaleInPlace(.858086).scaleInPlace(-1),this.zx.copyFrom(e.l21),this.zx.scaleInPlace(.858086).scaleInPlace(-1),this.xy.copyFrom(e.l2_2),this.xy.scaleInPlace(.858086),this.scaleInPlace(1/Math.PI),this}static FromHarmonics(e){return new Aa().updateFromHarmonics(e)}static FromArray(e){const t=new Aa;return v.FromArrayToRef(e[0],0,t.x),v.FromArrayToRef(e[1],0,t.y),v.FromArrayToRef(e[2],0,t.z),v.FromArrayToRef(e[3],0,t.xx),v.FromArrayToRef(e[4],0,t.yy),v.FromArrayToRef(e[5],0,t.zz),v.FromArrayToRef(e[6],0,t.yz),v.FromArrayToRef(e[7],0,t.zx),v.FromArrayToRef(e[8],0,t.xy),t}}class so{constructor(e,t,i,r){this.name=e,this.worldAxisForNormal=t,this.worldAxisForFileX=i,this.worldAxisForFileY=r}}class qo{static ConvertCubeMapTextureToSphericalPolynomial(e){var t;if(!e.isCube)return null;(t=e.getScene())==null||t.getEngine().flushFramebuffer();const i=e.getSize().width,r=e.readPixels(0,void 0,void 0,!1),s=e.readPixels(1,void 0,void 0,!1);let o,a;e.isRenderTarget?(o=e.readPixels(3,void 0,void 0,!1),a=e.readPixels(2,void 0,void 0,!1)):(o=e.readPixels(2,void 0,void 0,!1),a=e.readPixels(3,void 0,void 0,!1));const l=e.readPixels(4,void 0,void 0,!1),h=e.readPixels(5,void 0,void 0,!1),c=e.gammaSpace,u=5;let d=0;return(e.textureType==1||e.textureType==2)&&(d=1),new Promise(f=>{Promise.all([s,r,o,a,l,h]).then(([p,g,m,x,E,R])=>{const C={size:i,right:g,left:p,up:m,down:x,front:E,back:R,format:u,type:d,gammaSpace:c};f(this.ConvertCubeMapToSphericalPolynomial(C))})})}static _AreaElement(e,t){return Math.atan2(e*t,Math.sqrt(e*e+t*t+1))}static ConvertCubeMapToSphericalPolynomial(e){const t=new Ia;let i=0;const r=2/e.size,s=r,o=.5*r,a=o-1;for(let h=0;h<6;h++){const c=this._FileFaces[h],u=e[c.name];let d=a;const f=e.format===5?4:3;for(let p=0;p<e.size;p++){let g=a;for(let m=0;m<e.size;m++){const x=c.worldAxisForFileX.scale(g).add(c.worldAxisForFileY.scale(d)).add(c.worldAxisForNormal);x.normalize();const E=this._AreaElement(g-o,d-o)-this._AreaElement(g-o,d+o)-this._AreaElement(g+o,d-o)+this._AreaElement(g+o,d+o);let R=u[p*e.size*f+m*f+0],C=u[p*e.size*f+m*f+1],_=u[p*e.size*f+m*f+2];isNaN(R)&&(R=0),isNaN(C)&&(C=0),isNaN(_)&&(_=0),e.type===0&&(R/=255,C/=255,_/=255),e.gammaSpace&&(R=Math.pow(Ye.Clamp(R),Zl),C=Math.pow(Ye.Clamp(C),Zl),_=Math.pow(Ye.Clamp(_),Zl));const T=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const P=Math.max(R,C,_);if(P>T){const D=T/P;R*=D,C*=D,_*=D}}else R=Ye.Clamp(R,0,T),C=Ye.Clamp(C,0,T),_=Ye.Clamp(_,0,T);const y=new De(R,C,_);t.addLight(x,y,E),i+=E,g+=r}d+=s}}const l=4*Math.PI*6/6/i;return t.scaleInPlace(l),t.convertIncidentRadianceToIrradiance(),t.convertIrradianceToLambertianRadiance(),Aa.FromHarmonics(t)}}qo._FileFaces=[new so("right",new v(1,0,0),new v(0,0,-1),new v(0,-1,0)),new so("left",new v(-1,0,0),new v(0,0,1),new v(0,-1,0)),new so("up",new v(0,1,0),new v(1,0,0),new v(0,0,1)),new so("down",new v(0,-1,0),new v(1,0,0),new v(0,0,-1)),new so("front",new v(0,0,1),new v(1,0,0),new v(0,-1,0)),new so("back",new v(0,0,-1),new v(-1,0,0),new v(0,-1,0))];qo.MAX_HDRI_VALUE=4096;qo.PRESERVE_CLAMPED_COLORS=!1;yt.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)};Object.defineProperty(yt.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=qo.ConvertCubeMapTextureToSphericalPolynomial(this),this._texture._sphericalPolynomialPromise===null?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then(n=>{this._texture._sphericalPolynomial=n,this._texture._sphericalPolynomialComputed=!0})),null}return null},set:function(n){this._texture&&(this._texture._sphericalPolynomial=n)},enumerable:!0,configurable:!0});const QM="pbrFragmentDeclaration",JM=`uniform vec4 vEyePosition;uniform vec3 vReflectionColor;uniform vec4 vAlbedoColor;uniform vec4 vLightingIntensity;uniform vec4 vReflectivityColor;uniform vec4 vMetallicReflectanceFactors;uniform vec3 vEmissiveColor;uniform float visibility;uniform vec3 vAmbientColor;
#ifdef ALBEDO
uniform vec2 vAlbedoInfos;
#endif
#ifdef AMBIENT
uniform vec4 vAmbientInfos;
#endif
#ifdef BUMP
uniform vec3 vBumpInfos;uniform vec2 vTangentSpaceParams;
#endif
#ifdef OPACITY
uniform vec2 vOpacityInfos;
#endif
#ifdef EMISSIVE
uniform vec2 vEmissiveInfos;
#endif
#ifdef LIGHTMAP
uniform vec2 vLightmapInfos;
#endif
#ifdef REFLECTIVITY
uniform vec3 vReflectivityInfos;
#endif
#ifdef MICROSURFACEMAP
uniform vec2 vMicroSurfaceSamplerInfos;
#endif
#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(SS_REFRACTION) || defined(PREPASS)
uniform mat4 view;
#endif
#ifdef REFLECTION
uniform vec2 vReflectionInfos;
#ifdef REALTIME_FILTERING
uniform vec2 vReflectionFilteringInfo;
#endif
uniform mat4 reflectionMatrix;uniform vec3 vReflectionMicrosurfaceInfos;
#if defined(USE_LOCAL_REFLECTIONMAP_CUBIC) && defined(REFLECTIONMAP_CUBIC)
uniform vec3 vReflectionPosition;uniform vec3 vReflectionSize; 
#endif
#endif
#if defined(SS_REFRACTION) && defined(SS_USE_LOCAL_REFRACTIONMAP_CUBIC)
uniform vec3 vRefractionPosition;uniform vec3 vRefractionSize; 
#endif
#ifdef CLEARCOAT
uniform vec2 vClearCoatParams;uniform vec4 vClearCoatRefractionParams;
#if defined(CLEARCOAT_TEXTURE) || defined(CLEARCOAT_TEXTURE_ROUGHNESS)
uniform vec4 vClearCoatInfos;
#endif
#ifdef CLEARCOAT_TEXTURE
uniform mat4 clearCoatMatrix;
#endif
#ifdef CLEARCOAT_TEXTURE_ROUGHNESS
uniform mat4 clearCoatRoughnessMatrix;
#endif
#ifdef CLEARCOAT_BUMP
uniform vec2 vClearCoatBumpInfos;uniform vec2 vClearCoatTangentSpaceParams;uniform mat4 clearCoatBumpMatrix;
#endif
#ifdef CLEARCOAT_TINT
uniform vec4 vClearCoatTintParams;uniform float clearCoatColorAtDistance;
#ifdef CLEARCOAT_TINT_TEXTURE
uniform vec2 vClearCoatTintInfos;uniform mat4 clearCoatTintMatrix;
#endif
#endif
#endif
#ifdef IRIDESCENCE
uniform vec4 vIridescenceParams;
#if defined(IRIDESCENCE_TEXTURE) || defined(IRIDESCENCE_THICKNESS_TEXTURE)
uniform vec4 vIridescenceInfos;
#endif
#ifdef IRIDESCENCE_TEXTURE
uniform mat4 iridescenceMatrix;
#endif
#ifdef IRIDESCENCE_THICKNESS_TEXTURE
uniform mat4 iridescenceThicknessMatrix;
#endif
#endif
#ifdef ANISOTROPIC
uniform vec3 vAnisotropy;
#ifdef ANISOTROPIC_TEXTURE
uniform vec2 vAnisotropyInfos;uniform mat4 anisotropyMatrix;
#endif
#endif
#ifdef SHEEN
uniform vec4 vSheenColor;
#ifdef SHEEN_ROUGHNESS
uniform float vSheenRoughness;
#endif
#if defined(SHEEN_TEXTURE) || defined(SHEEN_TEXTURE_ROUGHNESS)
uniform vec4 vSheenInfos;
#endif
#ifdef SHEEN_TEXTURE
uniform mat4 sheenMatrix;
#endif
#ifdef SHEEN_TEXTURE_ROUGHNESS
uniform mat4 sheenRoughnessMatrix;
#endif
#endif
#ifdef SUBSURFACE
#ifdef SS_REFRACTION
uniform vec4 vRefractionMicrosurfaceInfos;uniform vec4 vRefractionInfos;uniform mat4 refractionMatrix;
#ifdef REALTIME_FILTERING
uniform vec2 vRefractionFilteringInfo;
#endif
#ifdef SS_DISPERSION
uniform float dispersion;
#endif
#endif
#ifdef SS_THICKNESSANDMASK_TEXTURE
uniform vec2 vThicknessInfos;uniform mat4 thicknessMatrix;
#endif
#ifdef SS_REFRACTIONINTENSITY_TEXTURE
uniform vec2 vRefractionIntensityInfos;uniform mat4 refractionIntensityMatrix;
#endif
#ifdef SS_TRANSLUCENCYINTENSITY_TEXTURE
uniform vec2 vTranslucencyIntensityInfos;uniform mat4 translucencyIntensityMatrix;
#endif
uniform vec2 vThicknessParam;uniform vec3 vDiffusionDistance;uniform vec4 vTintColor;uniform vec3 vSubSurfaceIntensity;
#endif
#ifdef PREPASS
#ifdef SS_SCATTERING
uniform float scatteringDiffusionProfile;
#endif
#endif
#if DEBUGMODE>0
uniform vec2 vDebugMode;
#endif
#ifdef DETAIL
uniform vec4 vDetailInfos;
#endif
#include<decalFragmentDeclaration>
#ifdef USESPHERICALFROMREFLECTIONMAP
#ifdef SPHERICAL_HARMONICS
uniform vec3 vSphericalL00;uniform vec3 vSphericalL1_1;uniform vec3 vSphericalL10;uniform vec3 vSphericalL11;uniform vec3 vSphericalL2_2;uniform vec3 vSphericalL2_1;uniform vec3 vSphericalL20;uniform vec3 vSphericalL21;uniform vec3 vSphericalL22;
#else
uniform vec3 vSphericalX;uniform vec3 vSphericalY;uniform vec3 vSphericalZ;uniform vec3 vSphericalXX_ZZ;uniform vec3 vSphericalYY_ZZ;uniform vec3 vSphericalZZ;uniform vec3 vSphericalXY;uniform vec3 vSphericalYZ;uniform vec3 vSphericalZX;
#endif
#endif
#define ADDITIONAL_FRAGMENT_DECLARATION
`;Y.IncludesShadersStore[QM]=JM;const $M="pbrUboDeclaration",eP=`layout(std140,column_major) uniform;uniform Material {vec2 vAlbedoInfos;vec4 vAmbientInfos;vec2 vOpacityInfos;vec2 vEmissiveInfos;vec2 vLightmapInfos;vec3 vReflectivityInfos;vec2 vMicroSurfaceSamplerInfos;vec2 vReflectionInfos;vec2 vReflectionFilteringInfo;vec3 vReflectionPosition;vec3 vReflectionSize;vec3 vBumpInfos;mat4 albedoMatrix;mat4 ambientMatrix;mat4 opacityMatrix;mat4 emissiveMatrix;mat4 lightmapMatrix;mat4 reflectivityMatrix;mat4 microSurfaceSamplerMatrix;mat4 bumpMatrix;vec2 vTangentSpaceParams;mat4 reflectionMatrix;vec3 vReflectionColor;vec4 vAlbedoColor;vec4 vLightingIntensity;vec3 vReflectionMicrosurfaceInfos;float pointSize;vec4 vReflectivityColor;vec3 vEmissiveColor;vec3 vAmbientColor;vec2 vDebugMode;vec4 vMetallicReflectanceFactors;vec2 vMetallicReflectanceInfos;mat4 metallicReflectanceMatrix;vec2 vReflectanceInfos;mat4 reflectanceMatrix;vec3 vSphericalL00;vec3 vSphericalL1_1;vec3 vSphericalL10;vec3 vSphericalL11;vec3 vSphericalL2_2;vec3 vSphericalL2_1;vec3 vSphericalL20;vec3 vSphericalL21;vec3 vSphericalL22;vec3 vSphericalX;vec3 vSphericalY;vec3 vSphericalZ;vec3 vSphericalXX_ZZ;vec3 vSphericalYY_ZZ;vec3 vSphericalZZ;vec3 vSphericalXY;vec3 vSphericalYZ;vec3 vSphericalZX;
#define ADDITIONAL_UBO_DECLARATION
};
#include<sceneUboDeclaration>
#include<meshUboDeclaration>
`;Y.IncludesShadersStore[$M]=eP;const tP="pbrFragmentExtraDeclaration",iP=`varying vec3 vPositionW;
#if DEBUGMODE>0
varying vec4 vClipSpacePosition;
#endif
#include<mainUVVaryingDeclaration>[1..7]
#ifdef NORMAL
varying vec3 vNormalW;
#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)
varying vec3 vEnvironmentIrradiance;
#endif
#endif
#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)
varying vec4 vColor;
#endif
`;Y.IncludesShadersStore[tP]=iP;const rP="samplerFragmentAlternateDeclaration",sP=`#ifdef _DEFINENAME_
#if _DEFINENAME_DIRECTUV==1
#define v_VARYINGNAME_UV vMainUV1
#elif _DEFINENAME_DIRECTUV==2
#define v_VARYINGNAME_UV vMainUV2
#elif _DEFINENAME_DIRECTUV==3
#define v_VARYINGNAME_UV vMainUV3
#elif _DEFINENAME_DIRECTUV==4
#define v_VARYINGNAME_UV vMainUV4
#elif _DEFINENAME_DIRECTUV==5
#define v_VARYINGNAME_UV vMainUV5
#elif _DEFINENAME_DIRECTUV==6
#define v_VARYINGNAME_UV vMainUV6
#else
varying vec2 v_VARYINGNAME_UV;
#endif
#endif
`;Y.IncludesShadersStore[rP]=sP;const nP="pbrFragmentSamplersDeclaration",oP=`#include<samplerFragmentDeclaration>(_DEFINENAME_,ALBEDO,_VARYINGNAME_,Albedo,_SAMPLERNAME_,albedo)
#include<samplerFragmentDeclaration>(_DEFINENAME_,AMBIENT,_VARYINGNAME_,Ambient,_SAMPLERNAME_,ambient)
#include<samplerFragmentDeclaration>(_DEFINENAME_,OPACITY,_VARYINGNAME_,Opacity,_SAMPLERNAME_,opacity)
#include<samplerFragmentDeclaration>(_DEFINENAME_,EMISSIVE,_VARYINGNAME_,Emissive,_SAMPLERNAME_,emissive)
#include<samplerFragmentDeclaration>(_DEFINENAME_,LIGHTMAP,_VARYINGNAME_,Lightmap,_SAMPLERNAME_,lightmap)
#include<samplerFragmentDeclaration>(_DEFINENAME_,REFLECTIVITY,_VARYINGNAME_,Reflectivity,_SAMPLERNAME_,reflectivity)
#include<samplerFragmentDeclaration>(_DEFINENAME_,MICROSURFACEMAP,_VARYINGNAME_,MicroSurfaceSampler,_SAMPLERNAME_,microSurface)
#include<samplerFragmentDeclaration>(_DEFINENAME_,METALLIC_REFLECTANCE,_VARYINGNAME_,MetallicReflectance,_SAMPLERNAME_,metallicReflectance)
#include<samplerFragmentDeclaration>(_DEFINENAME_,REFLECTANCE,_VARYINGNAME_,Reflectance,_SAMPLERNAME_,reflectance)
#include<samplerFragmentDeclaration>(_DEFINENAME_,DECAL,_VARYINGNAME_,Decal,_SAMPLERNAME_,decal)
#ifdef CLEARCOAT
#include<samplerFragmentDeclaration>(_DEFINENAME_,CLEARCOAT_TEXTURE,_VARYINGNAME_,ClearCoat,_SAMPLERNAME_,clearCoat)
#include<samplerFragmentAlternateDeclaration>(_DEFINENAME_,CLEARCOAT_TEXTURE_ROUGHNESS,_VARYINGNAME_,ClearCoatRoughness)
#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL)
uniform sampler2D clearCoatRoughnessSampler;
#endif
#include<samplerFragmentDeclaration>(_DEFINENAME_,CLEARCOAT_BUMP,_VARYINGNAME_,ClearCoatBump,_SAMPLERNAME_,clearCoatBump)
#include<samplerFragmentDeclaration>(_DEFINENAME_,CLEARCOAT_TINT_TEXTURE,_VARYINGNAME_,ClearCoatTint,_SAMPLERNAME_,clearCoatTint)
#endif
#ifdef IRIDESCENCE
#include<samplerFragmentDeclaration>(_DEFINENAME_,IRIDESCENCE_TEXTURE,_VARYINGNAME_,Iridescence,_SAMPLERNAME_,iridescence)
#include<samplerFragmentDeclaration>(_DEFINENAME_,IRIDESCENCE_THICKNESS_TEXTURE,_VARYINGNAME_,IridescenceThickness,_SAMPLERNAME_,iridescenceThickness)
#endif
#ifdef SHEEN
#include<samplerFragmentDeclaration>(_DEFINENAME_,SHEEN_TEXTURE,_VARYINGNAME_,Sheen,_SAMPLERNAME_,sheen)
#include<samplerFragmentAlternateDeclaration>(_DEFINENAME_,SHEEN_TEXTURE_ROUGHNESS,_VARYINGNAME_,SheenRoughness)
#if defined(SHEEN_ROUGHNESS) && defined(SHEEN_TEXTURE_ROUGHNESS) && !defined(SHEEN_TEXTURE_ROUGHNESS_IDENTICAL)
uniform sampler2D sheenRoughnessSampler;
#endif
#endif
#ifdef ANISOTROPIC
#include<samplerFragmentDeclaration>(_DEFINENAME_,ANISOTROPIC_TEXTURE,_VARYINGNAME_,Anisotropy,_SAMPLERNAME_,anisotropy)
#endif
#ifdef REFLECTION
#ifdef REFLECTIONMAP_3D
#define sampleReflection(s,c) textureCube(s,c)
uniform samplerCube reflectionSampler;
#ifdef LODBASEDMICROSFURACE
#define sampleReflectionLod(s,c,l) textureCubeLodEXT(s,c,l)
#else
uniform samplerCube reflectionSamplerLow;uniform samplerCube reflectionSamplerHigh;
#endif
#ifdef USEIRRADIANCEMAP
uniform samplerCube irradianceSampler;
#endif
#else
#define sampleReflection(s,c) texture2D(s,c)
uniform sampler2D reflectionSampler;
#ifdef LODBASEDMICROSFURACE
#define sampleReflectionLod(s,c,l) texture2DLodEXT(s,c,l)
#else
uniform sampler2D reflectionSamplerLow;uniform sampler2D reflectionSamplerHigh;
#endif
#ifdef USEIRRADIANCEMAP
uniform sampler2D irradianceSampler;
#endif
#endif
#ifdef REFLECTIONMAP_SKYBOX
varying vec3 vPositionUVW;
#else
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
varying vec3 vDirectionW;
#endif
#endif
#endif
#ifdef ENVIRONMENTBRDF
uniform sampler2D environmentBrdfSampler;
#endif
#ifdef SUBSURFACE
#ifdef SS_REFRACTION
#ifdef SS_REFRACTIONMAP_3D
#define sampleRefraction(s,c) textureCube(s,c)
uniform samplerCube refractionSampler;
#ifdef LODBASEDMICROSFURACE
#define sampleRefractionLod(s,c,l) textureCubeLodEXT(s,c,l)
#else
uniform samplerCube refractionSamplerLow;uniform samplerCube refractionSamplerHigh;
#endif
#else
#define sampleRefraction(s,c) texture2D(s,c)
uniform sampler2D refractionSampler;
#ifdef LODBASEDMICROSFURACE
#define sampleRefractionLod(s,c,l) texture2DLodEXT(s,c,l)
#else
uniform sampler2D refractionSamplerLow;uniform sampler2D refractionSamplerHigh;
#endif
#endif
#endif
#include<samplerFragmentDeclaration>(_DEFINENAME_,SS_THICKNESSANDMASK_TEXTURE,_VARYINGNAME_,Thickness,_SAMPLERNAME_,thickness)
#include<samplerFragmentDeclaration>(_DEFINENAME_,SS_REFRACTIONINTENSITY_TEXTURE,_VARYINGNAME_,RefractionIntensity,_SAMPLERNAME_,refractionIntensity)
#include<samplerFragmentDeclaration>(_DEFINENAME_,SS_TRANSLUCENCYINTENSITY_TEXTURE,_VARYINGNAME_,TranslucencyIntensity,_SAMPLERNAME_,translucencyIntensity)
#endif
`;Y.IncludesShadersStore[nP]=oP;const aP="subSurfaceScatteringFunctions",lP=`bool testLightingForSSS(float diffusionProfile)
{return diffusionProfile<1.;}`;Y.IncludesShadersStore[aP]=lP;const hP="importanceSampling",cP=`vec3 hemisphereCosSample(vec2 u) {float phi=2.*PI*u.x;float cosTheta2=1.-u.y;float cosTheta=sqrt(cosTheta2);float sinTheta=sqrt(1.-cosTheta2);return vec3(sinTheta*cos(phi),sinTheta*sin(phi),cosTheta);}
vec3 hemisphereImportanceSampleDggx(vec2 u,float a) {float phi=2.*PI*u.x;float cosTheta2=(1.-u.y)/(1.+(a+1.)*((a-1.)*u.y));float cosTheta=sqrt(cosTheta2);float sinTheta=sqrt(1.-cosTheta2);return vec3(sinTheta*cos(phi),sinTheta*sin(phi),cosTheta);}
vec3 hemisphereImportanceSampleDCharlie(vec2 u,float a) { 
float phi=2.*PI*u.x;float sinTheta=pow(u.y,a/(2.*a+1.));float cosTheta=sqrt(1.-sinTheta*sinTheta);return vec3(sinTheta*cos(phi),sinTheta*sin(phi),cosTheta);}`;Y.IncludesShadersStore[hP]=cP;const uP="pbrHelperFunctions",dP=`#define MINIMUMVARIANCE 0.0005
float convertRoughnessToAverageSlope(float roughness)
{return square(roughness)+MINIMUMVARIANCE;}
float fresnelGrazingReflectance(float reflectance0) {float reflectance90=saturate(reflectance0*25.0);return reflectance90;}
vec2 getAARoughnessFactors(vec3 normalVector) {
#ifdef SPECULARAA
vec3 nDfdx=dFdx(normalVector.xyz);vec3 nDfdy=dFdy(normalVector.xyz);float slopeSquare=max(dot(nDfdx,nDfdx),dot(nDfdy,nDfdy));float geometricRoughnessFactor=pow(saturate(slopeSquare),0.333);float geometricAlphaGFactor=sqrt(slopeSquare);geometricAlphaGFactor*=0.75;return vec2(geometricRoughnessFactor,geometricAlphaGFactor);
#else
return vec2(0.);
#endif
}
#ifdef ANISOTROPIC
#ifdef ANISOTROPIC_LEGACY
vec2 getAnisotropicRoughness(float alphaG,float anisotropy) {float alphaT=max(alphaG*(1.0+anisotropy),MINIMUMVARIANCE);float alphaB=max(alphaG*(1.0-anisotropy),MINIMUMVARIANCE);return vec2(alphaT,alphaB);}
vec3 getAnisotropicBentNormals(const vec3 T,const vec3 B,const vec3 N,const vec3 V,float anisotropy,float roughness) {vec3 anisotropicFrameDirection=anisotropy>=0.0 ? B : T;vec3 anisotropicFrameTangent=cross(normalize(anisotropicFrameDirection),V);vec3 anisotropicFrameNormal=cross(anisotropicFrameTangent,anisotropicFrameDirection);vec3 anisotropicNormal=normalize(mix(N,anisotropicFrameNormal,abs(anisotropy)));return anisotropicNormal;}
#else
vec2 getAnisotropicRoughness(float alphaG,float anisotropy) {float alphaT=max(mix(alphaG,1.0,anisotropy*anisotropy),MINIMUMVARIANCE);float alphaB=max(alphaG,MINIMUMVARIANCE);return vec2(alphaT,alphaB);}
vec3 getAnisotropicBentNormals(const vec3 T,const vec3 B,const vec3 N,const vec3 V,float anisotropy,float roughness) {vec3 bentNormal=cross(B,V);bentNormal=normalize(cross(bentNormal,B));float a=square(square(1.0-anisotropy*(1.0-roughness)));bentNormal=normalize(mix(bentNormal,N,a));return bentNormal;}
#endif
#endif
#if defined(CLEARCOAT) || defined(SS_REFRACTION)
vec3 cocaLambert(vec3 alpha,float distance) {return exp(-alpha*distance);}
vec3 cocaLambert(float NdotVRefract,float NdotLRefract,vec3 alpha,float thickness) {return cocaLambert(alpha,(thickness*((NdotLRefract+NdotVRefract)/(NdotLRefract*NdotVRefract))));}
vec3 computeColorAtDistanceInMedia(vec3 color,float distance) {return -log(color)/distance;}
vec3 computeClearCoatAbsorption(float NdotVRefract,float NdotLRefract,vec3 clearCoatColor,float clearCoatThickness,float clearCoatIntensity) {vec3 clearCoatAbsorption=mix(vec3(1.0),
cocaLambert(NdotVRefract,NdotLRefract,clearCoatColor,clearCoatThickness),
clearCoatIntensity);return clearCoatAbsorption;}
#endif
#ifdef MICROSURFACEAUTOMATIC
float computeDefaultMicroSurface(float microSurface,vec3 reflectivityColor)
{const float kReflectivityNoAlphaWorkflow_SmoothnessMax=0.95;float reflectivityLuminance=getLuminance(reflectivityColor);float reflectivityLuma=sqrt(reflectivityLuminance);microSurface=reflectivityLuma*kReflectivityNoAlphaWorkflow_SmoothnessMax;return microSurface;}
#endif
`;Y.IncludesShadersStore[uP]=dP;const fP="harmonicsFunctions",pP=`#ifdef USESPHERICALFROMREFLECTIONMAP
#ifdef SPHERICAL_HARMONICS
vec3 computeEnvironmentIrradiance(vec3 normal) {return vSphericalL00
+ vSphericalL1_1*(normal.y)
+ vSphericalL10*(normal.z)
+ vSphericalL11*(normal.x)
+ vSphericalL2_2*(normal.y*normal.x)
+ vSphericalL2_1*(normal.y*normal.z)
+ vSphericalL20*((3.0*normal.z*normal.z)-1.0)
+ vSphericalL21*(normal.z*normal.x)
+ vSphericalL22*(normal.x*normal.x-(normal.y*normal.y));}
#else
vec3 computeEnvironmentIrradiance(vec3 normal) {float Nx=normal.x;float Ny=normal.y;float Nz=normal.z;vec3 C1=vSphericalZZ.rgb;vec3 Cx=vSphericalX.rgb;vec3 Cy=vSphericalY.rgb;vec3 Cz=vSphericalZ.rgb;vec3 Cxx_zz=vSphericalXX_ZZ.rgb;vec3 Cyy_zz=vSphericalYY_ZZ.rgb;vec3 Cxy=vSphericalXY.rgb;vec3 Cyz=vSphericalYZ.rgb;vec3 Czx=vSphericalZX.rgb;vec3 a1=Cyy_zz*Ny+Cy;vec3 a2=Cyz*Nz+a1;vec3 b1=Czx*Nz+Cx;vec3 b2=Cxy*Ny+b1;vec3 b3=Cxx_zz*Nx+b2;vec3 t1=Cz *Nz+C1;vec3 t2=a2 *Ny+t1;vec3 t3=b3 *Nx+t2;return t3;}
#endif
#endif
`;Y.IncludesShadersStore[fP]=pP;const gP="pbrDirectLightingSetupFunctions",mP=`struct preLightingInfo
{vec3 lightOffset;float lightDistanceSquared;float lightDistance;float attenuation;vec3 L;vec3 H;float NdotV;float NdotLUnclamped;float NdotL;float VdotH;float roughness;
#ifdef IRIDESCENCE
float iridescenceIntensity;
#endif
};preLightingInfo computePointAndSpotPreLightingInfo(vec4 lightData,vec3 V,vec3 N) {preLightingInfo result;result.lightOffset=lightData.xyz-vPositionW;result.lightDistanceSquared=dot(result.lightOffset,result.lightOffset);result.lightDistance=sqrt(result.lightDistanceSquared);result.L=normalize(result.lightOffset);result.H=normalize(V+result.L);result.VdotH=saturate(dot(V,result.H));result.NdotLUnclamped=dot(N,result.L);result.NdotL=saturateEps(result.NdotLUnclamped);return result;}
preLightingInfo computeDirectionalPreLightingInfo(vec4 lightData,vec3 V,vec3 N) {preLightingInfo result;result.lightDistance=length(-lightData.xyz);result.L=normalize(-lightData.xyz);result.H=normalize(V+result.L);result.VdotH=saturate(dot(V,result.H));result.NdotLUnclamped=dot(N,result.L);result.NdotL=saturateEps(result.NdotLUnclamped);return result;}
preLightingInfo computeHemisphericPreLightingInfo(vec4 lightData,vec3 V,vec3 N) {preLightingInfo result;result.NdotL=dot(N,lightData.xyz)*0.5+0.5;result.NdotL=saturateEps(result.NdotL);result.NdotLUnclamped=result.NdotL;
#ifdef SPECULARTERM
result.L=normalize(lightData.xyz);result.H=normalize(V+result.L);result.VdotH=saturate(dot(V,result.H));
#endif
return result;}`;Y.IncludesShadersStore[gP]=mP;const _P="pbrDirectLightingFalloffFunctions",vP=`float computeDistanceLightFalloff_Standard(vec3 lightOffset,float range)
{return max(0.,1.0-length(lightOffset)/range);}
float computeDistanceLightFalloff_Physical(float lightDistanceSquared)
{return 1.0/maxEps(lightDistanceSquared);}
float computeDistanceLightFalloff_GLTF(float lightDistanceSquared,float inverseSquaredRange)
{float lightDistanceFalloff=1.0/maxEps(lightDistanceSquared);float factor=lightDistanceSquared*inverseSquaredRange;float attenuation=saturate(1.0-factor*factor);attenuation*=attenuation;lightDistanceFalloff*=attenuation;return lightDistanceFalloff;}
float computeDistanceLightFalloff(vec3 lightOffset,float lightDistanceSquared,float range,float inverseSquaredRange)
{
#ifdef USEPHYSICALLIGHTFALLOFF
return computeDistanceLightFalloff_Physical(lightDistanceSquared);
#elif defined(USEGLTFLIGHTFALLOFF)
return computeDistanceLightFalloff_GLTF(lightDistanceSquared,inverseSquaredRange);
#else
return computeDistanceLightFalloff_Standard(lightOffset,range);
#endif
}
float computeDirectionalLightFalloff_Standard(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle,float exponent)
{float falloff=0.0;float cosAngle=maxEps(dot(-lightDirection,directionToLightCenterW));if (cosAngle>=cosHalfAngle)
{falloff=max(0.,pow(cosAngle,exponent));}
return falloff;}
float computeDirectionalLightFalloff_Physical(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle)
{const float kMinusLog2ConeAngleIntensityRatio=6.64385618977; 
float concentrationKappa=kMinusLog2ConeAngleIntensityRatio/(1.0-cosHalfAngle);vec4 lightDirectionSpreadSG=vec4(-lightDirection*concentrationKappa,-concentrationKappa);float falloff=exp2(dot(vec4(directionToLightCenterW,1.0),lightDirectionSpreadSG));return falloff;}
float computeDirectionalLightFalloff_GLTF(vec3 lightDirection,vec3 directionToLightCenterW,float lightAngleScale,float lightAngleOffset)
{float cd=dot(-lightDirection,directionToLightCenterW);float falloff=saturate(cd*lightAngleScale+lightAngleOffset);falloff*=falloff;return falloff;}
float computeDirectionalLightFalloff(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle,float exponent,float lightAngleScale,float lightAngleOffset)
{
#ifdef USEPHYSICALLIGHTFALLOFF
return computeDirectionalLightFalloff_Physical(lightDirection,directionToLightCenterW,cosHalfAngle);
#elif defined(USEGLTFLIGHTFALLOFF)
return computeDirectionalLightFalloff_GLTF(lightDirection,directionToLightCenterW,lightAngleScale,lightAngleOffset);
#else
return computeDirectionalLightFalloff_Standard(lightDirection,directionToLightCenterW,cosHalfAngle,exponent);
#endif
}`;Y.IncludesShadersStore[_P]=vP;const EP="pbrBRDFFunctions",TP=`#define FRESNEL_MAXIMUM_ON_ROUGH 0.25
#ifdef MS_BRDF_ENERGY_CONSERVATION
vec3 getEnergyConservationFactor(const vec3 specularEnvironmentR0,const vec3 environmentBrdf) {return 1.0+specularEnvironmentR0*(1.0/environmentBrdf.y-1.0);}
#endif
#ifdef ENVIRONMENTBRDF
vec3 getBRDFLookup(float NdotV,float perceptualRoughness) {vec2 UV=vec2(NdotV,perceptualRoughness);vec4 brdfLookup=texture2D(environmentBrdfSampler,UV);
#ifdef ENVIRONMENTBRDF_RGBD
brdfLookup.rgb=fromRGBD(brdfLookup.rgba);
#endif
return brdfLookup.rgb;}
vec3 getReflectanceFromBRDFLookup(const vec3 specularEnvironmentR0,const vec3 specularEnvironmentR90,const vec3 environmentBrdf) {
#ifdef BRDF_V_HEIGHT_CORRELATED
vec3 reflectance=(specularEnvironmentR90-specularEnvironmentR0)*environmentBrdf.x+specularEnvironmentR0*environmentBrdf.y;
#else
vec3 reflectance=specularEnvironmentR0*environmentBrdf.x+specularEnvironmentR90*environmentBrdf.y;
#endif
return reflectance;}
vec3 getReflectanceFromBRDFLookup(const vec3 specularEnvironmentR0,const vec3 environmentBrdf) {
#ifdef BRDF_V_HEIGHT_CORRELATED
vec3 reflectance=mix(environmentBrdf.xxx,environmentBrdf.yyy,specularEnvironmentR0);
#else
vec3 reflectance=specularEnvironmentR0*environmentBrdf.x+environmentBrdf.y;
#endif
return reflectance;}
#endif
/* NOT USED
#if defined(SHEEN) && defined(SHEEN_SOFTER)
float getBRDFLookupCharlieSheen(float NdotV,float perceptualRoughness)
{float c=1.0-NdotV;float c3=c*c*c;return 0.65584461*c3+1.0/(4.16526551+exp(-7.97291361*perceptualRoughness+6.33516894));}
#endif
*/
#if !defined(ENVIRONMENTBRDF) || defined(REFLECTIONMAP_SKYBOX) || defined(ALPHAFRESNEL)
vec3 getReflectanceFromAnalyticalBRDFLookup_Jones(float VdotN,vec3 reflectance0,vec3 reflectance90,float smoothness)
{float weight=mix(FRESNEL_MAXIMUM_ON_ROUGH,1.0,smoothness);return reflectance0+weight*(reflectance90-reflectance0)*pow5(saturate(1.0-VdotN));}
#endif
#if defined(SHEEN) && defined(ENVIRONMENTBRDF)
/**
* The sheen BRDF not containing F can be easily stored in the blue channel of the BRDF texture.
* The blue channel contains DCharlie*VAshikhmin*NdotL as a lokkup table
*/
vec3 getSheenReflectanceFromBRDFLookup(const vec3 reflectance0,const vec3 environmentBrdf) {vec3 sheenEnvironmentReflectance=reflectance0*environmentBrdf.b;return sheenEnvironmentReflectance;}
#endif
vec3 fresnelSchlickGGX(float VdotH,vec3 reflectance0,vec3 reflectance90)
{return reflectance0+(reflectance90-reflectance0)*pow5(1.0-VdotH);}
float fresnelSchlickGGX(float VdotH,float reflectance0,float reflectance90)
{return reflectance0+(reflectance90-reflectance0)*pow5(1.0-VdotH);}
#ifdef CLEARCOAT
vec3 getR0RemappedForClearCoat(vec3 f0) {
#ifdef CLEARCOAT_DEFAULTIOR
#ifdef MOBILE
return saturate(f0*(f0*0.526868+0.529324)-0.0482256);
#else
return saturate(f0*(f0*(0.941892-0.263008*f0)+0.346479)-0.0285998);
#endif
#else
vec3 s=sqrt(f0);vec3 t=(vClearCoatRefractionParams.z+vClearCoatRefractionParams.w*s)/(vClearCoatRefractionParams.w+vClearCoatRefractionParams.z*s);return square(t);
#endif
}
#endif
#ifdef IRIDESCENCE
const mat3 XYZ_TO_REC709=mat3(
3.2404542,-0.9692660, 0.0556434,
-1.5371385, 1.8760108,-0.2040259,
-0.4985314, 0.0415560, 1.0572252
);vec3 getIORTfromAirToSurfaceR0(vec3 f0) {vec3 sqrtF0=sqrt(f0);return (1.+sqrtF0)/(1.-sqrtF0);}
vec3 getR0fromIORs(vec3 iorT,float iorI) {return square((iorT-vec3(iorI))/(iorT+vec3(iorI)));}
float getR0fromIORs(float iorT,float iorI) {return square((iorT-iorI)/(iorT+iorI));}
vec3 evalSensitivity(float opd,vec3 shift) {float phase=2.0*PI*opd*1.0e-9;const vec3 val=vec3(5.4856e-13,4.4201e-13,5.2481e-13);const vec3 pos=vec3(1.6810e+06,1.7953e+06,2.2084e+06);const vec3 var=vec3(4.3278e+09,9.3046e+09,6.6121e+09);vec3 xyz=val*sqrt(2.0*PI*var)*cos(pos*phase+shift)*exp(-square(phase)*var);xyz.x+=9.7470e-14*sqrt(2.0*PI*4.5282e+09)*cos(2.2399e+06*phase+shift[0])*exp(-4.5282e+09*square(phase));xyz/=1.0685e-7;vec3 srgb=XYZ_TO_REC709*xyz;return srgb;}
vec3 evalIridescence(float outsideIOR,float eta2,float cosTheta1,float thinFilmThickness,vec3 baseF0) {vec3 I=vec3(1.0);float iridescenceIOR=mix(outsideIOR,eta2,smoothstep(0.0,0.03,thinFilmThickness));float sinTheta2Sq=square(outsideIOR/iridescenceIOR)*(1.0-square(cosTheta1));float cosTheta2Sq=1.0-sinTheta2Sq;if (cosTheta2Sq<0.0) {return I;}
float cosTheta2=sqrt(cosTheta2Sq);float R0=getR0fromIORs(iridescenceIOR,outsideIOR);float R12=fresnelSchlickGGX(cosTheta1,R0,1.);float R21=R12;float T121=1.0-R12;float phi12=0.0;if (iridescenceIOR<outsideIOR) phi12=PI;float phi21=PI-phi12;vec3 baseIOR=getIORTfromAirToSurfaceR0(clamp(baseF0,0.0,0.9999)); 
vec3 R1=getR0fromIORs(baseIOR,iridescenceIOR);vec3 R23=fresnelSchlickGGX(cosTheta2,R1,vec3(1.));vec3 phi23=vec3(0.0);if (baseIOR[0]<iridescenceIOR) phi23[0]=PI;if (baseIOR[1]<iridescenceIOR) phi23[1]=PI;if (baseIOR[2]<iridescenceIOR) phi23[2]=PI;float opd=2.0*iridescenceIOR*thinFilmThickness*cosTheta2;vec3 phi=vec3(phi21)+phi23;vec3 R123=clamp(R12*R23,1e-5,0.9999);vec3 r123=sqrt(R123);vec3 Rs=square(T121)*R23/(vec3(1.0)-R123);vec3 C0=R12+Rs;I=C0;vec3 Cm=Rs-T121;for (int m=1; m<=2; ++m)
{Cm*=r123;vec3 Sm=2.0*evalSensitivity(float(m)*opd,float(m)*phi);I+=Cm*Sm;}
return max(I,vec3(0.0));}
#endif
float normalDistributionFunction_TrowbridgeReitzGGX(float NdotH,float alphaG)
{float a2=square(alphaG);float d=NdotH*NdotH*(a2-1.0)+1.0;return a2/(PI*d*d);}
#ifdef SHEEN
float normalDistributionFunction_CharlieSheen(float NdotH,float alphaG)
{float invR=1./alphaG;float cos2h=NdotH*NdotH;float sin2h=1.-cos2h;return (2.+invR)*pow(sin2h,invR*.5)/(2.*PI);}
#endif
#ifdef ANISOTROPIC
float normalDistributionFunction_BurleyGGX_Anisotropic(float NdotH,float TdotH,float BdotH,const vec2 alphaTB) {float a2=alphaTB.x*alphaTB.y;vec3 v=vec3(alphaTB.y*TdotH,alphaTB.x *BdotH,a2*NdotH);float v2=dot(v,v);float w2=a2/v2;return a2*w2*w2*RECIPROCAL_PI;}
#endif
#ifdef BRDF_V_HEIGHT_CORRELATED
float smithVisibility_GGXCorrelated(float NdotL,float NdotV,float alphaG) {
#ifdef MOBILE
float GGXV=NdotL*(NdotV*(1.0-alphaG)+alphaG);float GGXL=NdotV*(NdotL*(1.0-alphaG)+alphaG);return 0.5/(GGXV+GGXL);
#else
float a2=alphaG*alphaG;float GGXV=NdotL*sqrt(NdotV*(NdotV-a2*NdotV)+a2);float GGXL=NdotV*sqrt(NdotL*(NdotL-a2*NdotL)+a2);return 0.5/(GGXV+GGXL);
#endif
}
#else
float smithVisibilityG1_TrowbridgeReitzGGXFast(float dot,float alphaG)
{
#ifdef MOBILE
return 1.0/(dot+alphaG+(1.0-alphaG)*dot ));
#else
float alphaSquared=alphaG*alphaG;return 1.0/(dot+sqrt(alphaSquared+(1.0-alphaSquared)*dot*dot));
#endif
}
float smithVisibility_TrowbridgeReitzGGXFast(float NdotL,float NdotV,float alphaG)
{float visibility=smithVisibilityG1_TrowbridgeReitzGGXFast(NdotL,alphaG)*smithVisibilityG1_TrowbridgeReitzGGXFast(NdotV,alphaG);return visibility;}
#endif
#ifdef ANISOTROPIC
float smithVisibility_GGXCorrelated_Anisotropic(float NdotL,float NdotV,float TdotV,float BdotV,float TdotL,float BdotL,const vec2 alphaTB) {float lambdaV=NdotL*length(vec3(alphaTB.x*TdotV,alphaTB.y*BdotV,NdotV));float lambdaL=NdotV*length(vec3(alphaTB.x*TdotL,alphaTB.y*BdotL,NdotL));float v=0.5/(lambdaV+lambdaL);return v;}
#endif
#ifdef CLEARCOAT
float visibility_Kelemen(float VdotH) {return 0.25/(VdotH*VdotH); }
#endif
#ifdef SHEEN
float visibility_Ashikhmin(float NdotL,float NdotV)
{return 1./(4.*(NdotL+NdotV-NdotL*NdotV));}
/* NOT USED
#ifdef SHEEN_SOFTER
float l(float x,float alphaG)
{float oneMinusAlphaSq=(1.0-alphaG)*(1.0-alphaG);float a=mix(21.5473,25.3245,oneMinusAlphaSq);float b=mix(3.82987,3.32435,oneMinusAlphaSq);float c=mix(0.19823,0.16801,oneMinusAlphaSq);float d=mix(-1.97760,-1.27393,oneMinusAlphaSq);float e=mix(-4.32054,-4.85967,oneMinusAlphaSq);return a/(1.0+b*pow(x,c))+d*x+e;}
float lambdaSheen(float cosTheta,float alphaG)
{return abs(cosTheta)<0.5 ? exp(l(cosTheta,alphaG)) : exp(2.0*l(0.5,alphaG)-l(1.0-cosTheta,alphaG));}
float visibility_CharlieSheen(float NdotL,float NdotV,float alphaG)
{float G=1.0/(1.0+lambdaSheen(NdotV,alphaG)+lambdaSheen(NdotL,alphaG));return G/(4.0*NdotV*NdotL);}
#endif
*/
#endif
float diffuseBRDF_Burley(float NdotL,float NdotV,float VdotH,float roughness) {float diffuseFresnelNV=pow5(saturateEps(1.0-NdotL));float diffuseFresnelNL=pow5(saturateEps(1.0-NdotV));float diffuseFresnel90=0.5+2.0*VdotH*VdotH*roughness;float fresnel =
(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNL) *
(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNV);return fresnel/PI;}
#ifdef SS_TRANSLUCENCY
vec3 transmittanceBRDF_Burley(const vec3 tintColor,const vec3 diffusionDistance,float thickness) {vec3 S=1./maxEps(diffusionDistance);vec3 temp=exp((-0.333333333*thickness)*S);return tintColor.rgb*0.25*(temp*temp*temp+3.0*temp);}
float computeWrappedDiffuseNdotL(float NdotL,float w) {float t=1.0+w;float invt2=1.0/square(t);return saturate((NdotL+w)*invt2);}
#endif
`;Y.IncludesShadersStore[EP]=TP;const xP="hdrFilteringFunctions",CP=`#ifdef NUM_SAMPLES
#if NUM_SAMPLES>0
#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)
float radicalInverse_VdC(uint bits) 
{bits=(bits<<16u) | (bits>>16u);bits=((bits & 0x55555555u)<<1u) | ((bits & 0xAAAAAAAAu)>>1u);bits=((bits & 0x33333333u)<<2u) | ((bits & 0xCCCCCCCCu)>>2u);bits=((bits & 0x0F0F0F0Fu)<<4u) | ((bits & 0xF0F0F0F0u)>>4u);bits=((bits & 0x00FF00FFu)<<8u) | ((bits & 0xFF00FF00u)>>8u);return float(bits)*2.3283064365386963e-10; }
vec2 hammersley(uint i,uint N)
{return vec2(float(i)/float(N),radicalInverse_VdC(i));}
#else
float vanDerCorpus(int n,int base)
{float invBase=1.0/float(base);float denom =1.0;float result =0.0;for(int i=0; i<32; ++i)
{if(n>0)
{denom =mod(float(n),2.0);result+=denom*invBase;invBase=invBase/2.0;n =int(float(n)/2.0);}}
return result;}
vec2 hammersley(int i,int N)
{return vec2(float(i)/float(N),vanDerCorpus(i,2));}
#endif
float log4(float x) {return log2(x)/2.;}
const float NUM_SAMPLES_FLOAT=float(NUM_SAMPLES);const float NUM_SAMPLES_FLOAT_INVERSED=1./NUM_SAMPLES_FLOAT;const float K=4.;
#define inline
vec3 irradiance(samplerCube inputTexture,vec3 inputN,vec2 filteringInfo)
{vec3 n=normalize(inputN);vec3 result=vec3(0.0);vec3 tangent=abs(n.z)<0.999 ? vec3(0.,0.,1.) : vec3(1.,0.,0.);tangent=normalize(cross(tangent,n));vec3 bitangent=cross(n,tangent);mat3 tbn=mat3(tangent,bitangent,n);float maxLevel=filteringInfo.y;float dim0=filteringInfo.x;float omegaP=(4.*PI)/(6.*dim0*dim0);
#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)
for(uint i=0u; i<NUM_SAMPLES; ++i)
#else
for(int i=0; i<NUM_SAMPLES; ++i)
#endif
{vec2 Xi=hammersley(i,NUM_SAMPLES);vec3 Ls=hemisphereCosSample(Xi);Ls=normalize(Ls);vec3 Ns=vec3(0.,0.,1.);float NoL=dot(Ns,Ls);if (NoL>0.) {float pdf_inversed=PI/NoL;float omegaS=NUM_SAMPLES_FLOAT_INVERSED*pdf_inversed;float l=log4(omegaS)-log4(omegaP)+log4(K);float mipLevel=clamp(l,0.0,maxLevel);vec3 c=textureCubeLodEXT(inputTexture,tbn*Ls,mipLevel).rgb;
#ifdef GAMMA_INPUT
c=toLinearSpace(c);
#endif
result+=c;}}
result=result*NUM_SAMPLES_FLOAT_INVERSED;return result;}
#define inline
vec3 radiance(float alphaG,samplerCube inputTexture,vec3 inputN,vec2 filteringInfo)
{vec3 n=normalize(inputN);vec3 c=textureCube(inputTexture,n).rgb; 
if (alphaG==0.) {
#ifdef GAMMA_INPUT
c=toLinearSpace(c);
#endif
return c;} else {vec3 result=vec3(0.);vec3 tangent=abs(n.z)<0.999 ? vec3(0.,0.,1.) : vec3(1.,0.,0.);tangent=normalize(cross(tangent,n));vec3 bitangent=cross(n,tangent);mat3 tbn=mat3(tangent,bitangent,n);float maxLevel=filteringInfo.y;float dim0=filteringInfo.x;float omegaP=(4.*PI)/(6.*dim0*dim0);float weight=0.;
#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)
for(uint i=0u; i<NUM_SAMPLES; ++i)
#else
for(int i=0; i<NUM_SAMPLES; ++i)
#endif
{vec2 Xi=hammersley(i,NUM_SAMPLES);vec3 H=hemisphereImportanceSampleDggx(Xi,alphaG);float NoV=1.;float NoH=H.z;float NoH2=H.z*H.z;float NoL=2.*NoH2-1.;vec3 L=vec3(2.*NoH*H.x,2.*NoH*H.y,NoL);L=normalize(L);if (NoL>0.) {float pdf_inversed=4./normalDistributionFunction_TrowbridgeReitzGGX(NoH,alphaG);float omegaS=NUM_SAMPLES_FLOAT_INVERSED*pdf_inversed;float l=log4(omegaS)-log4(omegaP)+log4(K);float mipLevel=clamp(float(l),0.0,maxLevel);weight+=NoL;vec3 c=textureCubeLodEXT(inputTexture,tbn*L,mipLevel).rgb;
#ifdef GAMMA_INPUT
c=toLinearSpace(c);
#endif
result+=c*NoL;}}
result=result/weight;return result;}}
#endif
#endif
`;Y.IncludesShadersStore[xP]=CP;const RP="pbrDirectLightingFunctions",SP=`#define CLEARCOATREFLECTANCE90 1.0
struct lightingInfo
{vec3 diffuse;
#ifdef SPECULARTERM
vec3 specular;
#endif
#ifdef CLEARCOAT
vec4 clearCoat;
#endif
#ifdef SHEEN
vec3 sheen;
#endif
};float adjustRoughnessFromLightProperties(float roughness,float lightRadius,float lightDistance) {
#if defined(USEPHYSICALLIGHTFALLOFF) || defined(USEGLTFLIGHTFALLOFF)
float lightRoughness=lightRadius/lightDistance;float totalRoughness=saturate(lightRoughness+roughness);return totalRoughness;
#else
return roughness;
#endif
}
vec3 computeHemisphericDiffuseLighting(preLightingInfo info,vec3 lightColor,vec3 groundColor) {return mix(groundColor,lightColor,info.NdotL);}
vec3 computeDiffuseLighting(preLightingInfo info,vec3 lightColor) {float diffuseTerm=diffuseBRDF_Burley(info.NdotL,info.NdotV,info.VdotH,info.roughness);return diffuseTerm*info.attenuation*info.NdotL*lightColor;}
#define inline
vec3 computeProjectionTextureDiffuseLighting(sampler2D projectionLightSampler,mat4 textureProjectionMatrix){vec4 strq=textureProjectionMatrix*vec4(vPositionW,1.0);strq/=strq.w;vec3 textureColor=texture2D(projectionLightSampler,strq.xy).rgb;return toLinearSpace(textureColor);}
#ifdef SS_TRANSLUCENCY
vec3 computeDiffuseAndTransmittedLighting(preLightingInfo info,vec3 lightColor,vec3 transmittance) {float NdotL=absEps(info.NdotLUnclamped);float wrapNdotL=computeWrappedDiffuseNdotL(NdotL,0.02);float trAdapt=step(0.,info.NdotLUnclamped);vec3 transmittanceNdotL=mix(transmittance*wrapNdotL,vec3(wrapNdotL),trAdapt);float diffuseTerm=diffuseBRDF_Burley(NdotL,info.NdotV,info.VdotH,info.roughness);return diffuseTerm*transmittanceNdotL*info.attenuation*lightColor;}
#endif
#ifdef SPECULARTERM
vec3 computeSpecularLighting(preLightingInfo info,vec3 N,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,vec3 lightColor) {float NdotH=saturateEps(dot(N,info.H));float roughness=max(info.roughness,geometricRoughnessFactor);float alphaG=convertRoughnessToAverageSlope(roughness);vec3 fresnel=fresnelSchlickGGX(info.VdotH,reflectance0,reflectance90);
#ifdef IRIDESCENCE
fresnel=mix(fresnel,reflectance0,info.iridescenceIntensity);
#endif
float distribution=normalDistributionFunction_TrowbridgeReitzGGX(NdotH,alphaG);
#ifdef BRDF_V_HEIGHT_CORRELATED
float smithVisibility=smithVisibility_GGXCorrelated(info.NdotL,info.NdotV,alphaG);
#else
float smithVisibility=smithVisibility_TrowbridgeReitzGGXFast(info.NdotL,info.NdotV,alphaG);
#endif
vec3 specTerm=fresnel*distribution*smithVisibility;return specTerm*info.attenuation*info.NdotL*lightColor;}
#endif
#ifdef ANISOTROPIC
vec3 computeAnisotropicSpecularLighting(preLightingInfo info,vec3 V,vec3 N,vec3 T,vec3 B,float anisotropy,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,vec3 lightColor) {float NdotH=saturateEps(dot(N,info.H));float TdotH=dot(T,info.H);float BdotH=dot(B,info.H);float TdotV=dot(T,V);float BdotV=dot(B,V);float TdotL=dot(T,info.L);float BdotL=dot(B,info.L);float alphaG=convertRoughnessToAverageSlope(info.roughness);vec2 alphaTB=getAnisotropicRoughness(alphaG,anisotropy);alphaTB=max(alphaTB,square(geometricRoughnessFactor));vec3 fresnel=fresnelSchlickGGX(info.VdotH,reflectance0,reflectance90);
#ifdef IRIDESCENCE
fresnel=mix(fresnel,reflectance0,info.iridescenceIntensity);
#endif
float distribution=normalDistributionFunction_BurleyGGX_Anisotropic(NdotH,TdotH,BdotH,alphaTB);float smithVisibility=smithVisibility_GGXCorrelated_Anisotropic(info.NdotL,info.NdotV,TdotV,BdotV,TdotL,BdotL,alphaTB);vec3 specTerm=fresnel*distribution*smithVisibility;return specTerm*info.attenuation*info.NdotL*lightColor;}
#endif
#ifdef CLEARCOAT
vec4 computeClearCoatLighting(preLightingInfo info,vec3 Ncc,float geometricRoughnessFactor,float clearCoatIntensity,vec3 lightColor) {float NccdotL=saturateEps(dot(Ncc,info.L));float NccdotH=saturateEps(dot(Ncc,info.H));float clearCoatRoughness=max(info.roughness,geometricRoughnessFactor);float alphaG=convertRoughnessToAverageSlope(clearCoatRoughness);float fresnel=fresnelSchlickGGX(info.VdotH,vClearCoatRefractionParams.x,CLEARCOATREFLECTANCE90);fresnel*=clearCoatIntensity;float distribution=normalDistributionFunction_TrowbridgeReitzGGX(NccdotH,alphaG);float kelemenVisibility=visibility_Kelemen(info.VdotH);float clearCoatTerm=fresnel*distribution*kelemenVisibility;return vec4(
clearCoatTerm*info.attenuation*NccdotL*lightColor,
1.0-fresnel
);}
vec3 computeClearCoatLightingAbsorption(float NdotVRefract,vec3 L,vec3 Ncc,vec3 clearCoatColor,float clearCoatThickness,float clearCoatIntensity) {vec3 LRefract=-refract(L,Ncc,vClearCoatRefractionParams.y);float NdotLRefract=saturateEps(dot(Ncc,LRefract));vec3 absorption=computeClearCoatAbsorption(NdotVRefract,NdotLRefract,clearCoatColor,clearCoatThickness,clearCoatIntensity);return absorption;}
#endif
#ifdef SHEEN
vec3 computeSheenLighting(preLightingInfo info,vec3 N,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,vec3 lightColor) {float NdotH=saturateEps(dot(N,info.H));float roughness=max(info.roughness,geometricRoughnessFactor);float alphaG=convertRoughnessToAverageSlope(roughness);float fresnel=1.;float distribution=normalDistributionFunction_CharlieSheen(NdotH,alphaG);/*#ifdef SHEEN_SOFTER
float visibility=visibility_CharlieSheen(info.NdotL,info.NdotV,alphaG);
#else */
float visibility=visibility_Ashikhmin(info.NdotL,info.NdotV);/* #endif */
float sheenTerm=fresnel*distribution*visibility;return sheenTerm*info.attenuation*info.NdotL*lightColor;}
#endif
`;Y.IncludesShadersStore[RP]=SP;const yP="pbrIBLFunctions",bP=`#if defined(REFLECTION) || defined(SS_REFRACTION)
float getLodFromAlphaG(float cubeMapDimensionPixels,float microsurfaceAverageSlope) {float microsurfaceAverageSlopeTexels=cubeMapDimensionPixels*microsurfaceAverageSlope;float lod=log2(microsurfaceAverageSlopeTexels);return lod;}
float getLinearLodFromRoughness(float cubeMapDimensionPixels,float roughness) {float lod=log2(cubeMapDimensionPixels)*roughness;return lod;}
#endif
#if defined(ENVIRONMENTBRDF) && defined(RADIANCEOCCLUSION)
float environmentRadianceOcclusion(float ambientOcclusion,float NdotVUnclamped) {float temp=NdotVUnclamped+ambientOcclusion;return saturate(square(temp)-1.0+ambientOcclusion);}
#endif
#if defined(ENVIRONMENTBRDF) && defined(HORIZONOCCLUSION)
float environmentHorizonOcclusion(vec3 view,vec3 normal,vec3 geometricNormal) {vec3 reflection=reflect(view,normal);float temp=saturate(1.0+1.1*dot(reflection,geometricNormal));return square(temp);}
#endif
#if defined(LODINREFLECTIONALPHA) || defined(SS_LODINREFRACTIONALPHA)
#define UNPACK_LOD(x) (1.0-x)*255.0
float getLodFromAlphaG(float cubeMapDimensionPixels,float alphaG,float NdotV) {float microsurfaceAverageSlope=alphaG;microsurfaceAverageSlope*=sqrt(abs(NdotV));return getLodFromAlphaG(cubeMapDimensionPixels,microsurfaceAverageSlope);}
#endif
`;Y.IncludesShadersStore[yP]=bP;const IP="pbrBlockAlbedoOpacity",AP=`struct albedoOpacityOutParams
{vec3 surfaceAlbedo;float alpha;};
#define pbr_inline
void albedoOpacityBlock(
in vec4 vAlbedoColor,
#ifdef ALBEDO
in vec4 albedoTexture,
in vec2 albedoInfos,
#endif
#ifdef OPACITY
in vec4 opacityMap,
in vec2 vOpacityInfos,
#endif
#ifdef DETAIL
in vec4 detailColor,
in vec4 vDetailInfos,
#endif
#ifdef DECAL
in vec4 decalColor,
in vec4 vDecalInfos,
#endif
out albedoOpacityOutParams outParams
)
{vec3 surfaceAlbedo=vAlbedoColor.rgb;float alpha=vAlbedoColor.a;
#ifdef ALBEDO
#if defined(ALPHAFROMALBEDO) || defined(ALPHATEST)
alpha*=albedoTexture.a;
#endif
#ifdef GAMMAALBEDO
surfaceAlbedo*=toLinearSpace(albedoTexture.rgb);
#else
surfaceAlbedo*=albedoTexture.rgb;
#endif
surfaceAlbedo*=albedoInfos.y;
#endif
#ifndef DECAL_AFTER_DETAIL
#include<decalFragment>
#endif
#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)
surfaceAlbedo*=vColor.rgb;
#endif
#ifdef DETAIL
float detailAlbedo=2.0*mix(0.5,detailColor.r,vDetailInfos.y);surfaceAlbedo.rgb=surfaceAlbedo.rgb*detailAlbedo*detailAlbedo; 
#endif
#ifdef DECAL_AFTER_DETAIL
#include<decalFragment>
#endif
#define CUSTOM_FRAGMENT_UPDATE_ALBEDO
#ifdef OPACITY
#ifdef OPACITYRGB
alpha=getLuminance(opacityMap.rgb);
#else
alpha*=opacityMap.a;
#endif
alpha*=vOpacityInfos.y;
#endif
#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)
alpha*=vColor.a;
#endif
#if !defined(SS_LINKREFRACTIONTOTRANSPARENCY) && !defined(ALPHAFRESNEL)
#ifdef ALPHATEST 
#if DEBUGMODE != 88
if (alpha<ALPHATESTVALUE)
discard;
#endif
#ifndef ALPHABLEND
alpha=1.0;
#endif
#endif
#endif
outParams.surfaceAlbedo=surfaceAlbedo;outParams.alpha=alpha;}
`;Y.IncludesShadersStore[IP]=AP;const MP="pbrBlockReflectivity",PP=`struct reflectivityOutParams
{float microSurface;float roughness;vec3 surfaceReflectivityColor;
#ifdef METALLICWORKFLOW
vec3 surfaceAlbedo;
#endif
#if defined(METALLICWORKFLOW) && defined(REFLECTIVITY) && defined(AOSTOREINMETALMAPRED)
vec3 ambientOcclusionColor;
#endif
#if DEBUGMODE>0
#ifdef METALLICWORKFLOW
vec2 metallicRoughness;
#ifdef REFLECTIVITY
vec4 surfaceMetallicColorMap;
#endif
#ifndef FROSTBITE_REFLECTANCE
vec3 metallicF0;
#endif
#else
#ifdef REFLECTIVITY
vec4 surfaceReflectivityColorMap;
#endif
#endif
#endif
};
#define pbr_inline
void reflectivityBlock(
in vec4 vReflectivityColor,
#ifdef METALLICWORKFLOW
in vec3 surfaceAlbedo,
in vec4 metallicReflectanceFactors,
#endif
#ifdef REFLECTIVITY
in vec3 reflectivityInfos,
in vec4 surfaceMetallicOrReflectivityColorMap,
#endif
#if defined(METALLICWORKFLOW) && defined(REFLECTIVITY) && defined(AOSTOREINMETALMAPRED)
in vec3 ambientOcclusionColorIn,
#endif
#ifdef MICROSURFACEMAP
in vec4 microSurfaceTexel,
#endif
#ifdef DETAIL
in vec4 detailColor,
in vec4 vDetailInfos,
#endif
out reflectivityOutParams outParams
)
{float microSurface=vReflectivityColor.a;vec3 surfaceReflectivityColor=vReflectivityColor.rgb;
#ifdef METALLICWORKFLOW
vec2 metallicRoughness=surfaceReflectivityColor.rg;
#ifdef REFLECTIVITY
#if DEBUGMODE>0
outParams.surfaceMetallicColorMap=surfaceMetallicOrReflectivityColorMap;
#endif
#ifdef AOSTOREINMETALMAPRED
vec3 aoStoreInMetalMap=vec3(surfaceMetallicOrReflectivityColorMap.r,surfaceMetallicOrReflectivityColorMap.r,surfaceMetallicOrReflectivityColorMap.r);outParams.ambientOcclusionColor=mix(ambientOcclusionColorIn,aoStoreInMetalMap,reflectivityInfos.z);
#endif
#ifdef METALLNESSSTOREINMETALMAPBLUE
metallicRoughness.r*=surfaceMetallicOrReflectivityColorMap.b;
#else
metallicRoughness.r*=surfaceMetallicOrReflectivityColorMap.r;
#endif
#ifdef ROUGHNESSSTOREINMETALMAPALPHA
metallicRoughness.g*=surfaceMetallicOrReflectivityColorMap.a;
#else
#ifdef ROUGHNESSSTOREINMETALMAPGREEN
metallicRoughness.g*=surfaceMetallicOrReflectivityColorMap.g;
#endif
#endif
#endif
#ifdef DETAIL
float detailRoughness=mix(0.5,detailColor.b,vDetailInfos.w);float loLerp=mix(0.,metallicRoughness.g,detailRoughness*2.);float hiLerp=mix(metallicRoughness.g,1.,(detailRoughness-0.5)*2.);metallicRoughness.g=mix(loLerp,hiLerp,step(detailRoughness,0.5));
#endif
#ifdef MICROSURFACEMAP
metallicRoughness.g*=microSurfaceTexel.r;
#endif
#if DEBUGMODE>0
outParams.metallicRoughness=metallicRoughness;
#endif
#define CUSTOM_FRAGMENT_UPDATE_METALLICROUGHNESS
microSurface=1.0-metallicRoughness.g;vec3 baseColor=surfaceAlbedo;
#ifdef FROSTBITE_REFLECTANCE
outParams.surfaceAlbedo=baseColor.rgb*(1.0-metallicRoughness.r);surfaceReflectivityColor=mix(0.16*reflectance*reflectance,baseColor,metallicRoughness.r);
#else
vec3 metallicF0=metallicReflectanceFactors.rgb;
#if DEBUGMODE>0
outParams.metallicF0=metallicF0;
#endif
outParams.surfaceAlbedo=mix(baseColor.rgb*(1.0-metallicF0),vec3(0.,0.,0.),metallicRoughness.r);surfaceReflectivityColor=mix(metallicF0,baseColor,metallicRoughness.r);
#endif
#else
#ifdef REFLECTIVITY
surfaceReflectivityColor*=surfaceMetallicOrReflectivityColorMap.rgb;
#if DEBUGMODE>0
outParams.surfaceReflectivityColorMap=surfaceMetallicOrReflectivityColorMap;
#endif
#ifdef MICROSURFACEFROMREFLECTIVITYMAP
microSurface*=surfaceMetallicOrReflectivityColorMap.a;microSurface*=reflectivityInfos.z;
#else
#ifdef MICROSURFACEAUTOMATIC
microSurface*=computeDefaultMicroSurface(microSurface,surfaceReflectivityColor);
#endif
#ifdef MICROSURFACEMAP
microSurface*=microSurfaceTexel.r;
#endif
#define CUSTOM_FRAGMENT_UPDATE_MICROSURFACE
#endif
#endif
#endif
microSurface=saturate(microSurface);float roughness=1.-microSurface;outParams.microSurface=microSurface;outParams.roughness=roughness;outParams.surfaceReflectivityColor=surfaceReflectivityColor;}
`;Y.IncludesShadersStore[MP]=PP;const OP="pbrBlockAmbientOcclusion",DP=`struct ambientOcclusionOutParams
{vec3 ambientOcclusionColor;
#if DEBUGMODE>0 && defined(AMBIENT)
vec3 ambientOcclusionColorMap;
#endif
};
#define pbr_inline
void ambientOcclusionBlock(
#ifdef AMBIENT
in vec3 ambientOcclusionColorMap_,
in vec4 vAmbientInfos,
#endif
out ambientOcclusionOutParams outParams
)
{vec3 ambientOcclusionColor=vec3(1.,1.,1.);
#ifdef AMBIENT
vec3 ambientOcclusionColorMap=ambientOcclusionColorMap_*vAmbientInfos.y;
#ifdef AMBIENTINGRAYSCALE
ambientOcclusionColorMap=vec3(ambientOcclusionColorMap.r,ambientOcclusionColorMap.r,ambientOcclusionColorMap.r);
#endif
ambientOcclusionColor=mix(ambientOcclusionColor,ambientOcclusionColorMap,vAmbientInfos.z);
#if DEBUGMODE>0
outParams.ambientOcclusionColorMap=ambientOcclusionColorMap;
#endif
#endif
outParams.ambientOcclusionColor=ambientOcclusionColor;}
`;Y.IncludesShadersStore[OP]=DP;const NP="pbrBlockAlphaFresnel",FP=`#ifdef ALPHAFRESNEL
#if defined(ALPHATEST) || defined(ALPHABLEND)
struct alphaFresnelOutParams
{float alpha;};
#define pbr_inline
void alphaFresnelBlock(
in vec3 normalW,
in vec3 viewDirectionW,
in float alpha,
in float microSurface,
out alphaFresnelOutParams outParams
)
{float opacityPerceptual=alpha;
#ifdef LINEARALPHAFRESNEL
float opacity0=opacityPerceptual;
#else
float opacity0=opacityPerceptual*opacityPerceptual;
#endif
float opacity90=fresnelGrazingReflectance(opacity0);vec3 normalForward=faceforward(normalW,-viewDirectionW,normalW);outParams.alpha=getReflectanceFromAnalyticalBRDFLookup_Jones(saturate(dot(viewDirectionW,normalForward)),vec3(opacity0),vec3(opacity90),sqrt(microSurface)).x;
#ifdef ALPHATEST
if (outParams.alpha<ALPHATESTVALUE)
discard;
#ifndef ALPHABLEND
outParams.alpha=1.0;
#endif
#endif
}
#endif
#endif
`;Y.IncludesShadersStore[NP]=FP;const LP="pbrBlockAnisotropic",wP=`#ifdef ANISOTROPIC
struct anisotropicOutParams
{float anisotropy;vec3 anisotropicTangent;vec3 anisotropicBitangent;vec3 anisotropicNormal;
#if DEBUGMODE>0 && defined(ANISOTROPIC_TEXTURE)
vec3 anisotropyMapData;
#endif
};
#define pbr_inline
void anisotropicBlock(
in vec3 vAnisotropy,
in float roughness,
#ifdef ANISOTROPIC_TEXTURE
in vec3 anisotropyMapData,
#endif
in mat3 TBN,
in vec3 normalW,
in vec3 viewDirectionW,
out anisotropicOutParams outParams
)
{float anisotropy=vAnisotropy.b;vec3 anisotropyDirection=vec3(vAnisotropy.xy,0.);
#ifdef ANISOTROPIC_TEXTURE
anisotropy*=anisotropyMapData.b;
#if DEBUGMODE>0
outParams.anisotropyMapData=anisotropyMapData;
#endif
anisotropyMapData.rg=anisotropyMapData.rg*2.0-1.0;
#ifdef ANISOTROPIC_LEGACY
anisotropyDirection.rg*=anisotropyMapData.rg;
#else
anisotropyDirection.xy=mat2(anisotropyDirection.x,anisotropyDirection.y,-anisotropyDirection.y,anisotropyDirection.x)*normalize(anisotropyMapData.rg);
#endif
#endif
mat3 anisoTBN=mat3(normalize(TBN[0]),normalize(TBN[1]),normalize(TBN[2]));vec3 anisotropicTangent=normalize(anisoTBN*anisotropyDirection);vec3 anisotropicBitangent=normalize(cross(anisoTBN[2],anisotropicTangent));outParams.anisotropy=anisotropy;outParams.anisotropicTangent=anisotropicTangent;outParams.anisotropicBitangent=anisotropicBitangent;outParams.anisotropicNormal=getAnisotropicBentNormals(anisotropicTangent,anisotropicBitangent,normalW,viewDirectionW,anisotropy,roughness);}
#endif
`;Y.IncludesShadersStore[LP]=wP;const UP="pbrBlockReflection",VP=`#ifdef REFLECTION
struct reflectionOutParams
{vec4 environmentRadiance;vec3 environmentIrradiance;
#ifdef REFLECTIONMAP_3D
vec3 reflectionCoords;
#else
vec2 reflectionCoords;
#endif
#ifdef SS_TRANSLUCENCY
#ifdef USESPHERICALFROMREFLECTIONMAP
#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)
vec3 irradianceVector;
#endif
#endif
#endif
};
#define pbr_inline
void createReflectionCoords(
in vec3 vPositionW,
in vec3 normalW,
#ifdef ANISOTROPIC
in anisotropicOutParams anisotropicOut,
#endif
#ifdef REFLECTIONMAP_3D
out vec3 reflectionCoords
#else
out vec2 reflectionCoords
#endif
)
{
#ifdef ANISOTROPIC
vec3 reflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),anisotropicOut.anisotropicNormal);
#else
vec3 reflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),normalW);
#endif
#ifdef REFLECTIONMAP_OPPOSITEZ
reflectionVector.z*=-1.0;
#endif
#ifdef REFLECTIONMAP_3D
reflectionCoords=reflectionVector;
#else
reflectionCoords=reflectionVector.xy;
#ifdef REFLECTIONMAP_PROJECTION
reflectionCoords/=reflectionVector.z;
#endif
reflectionCoords.y=1.0-reflectionCoords.y;
#endif
}
#define pbr_inline
#define inline
void sampleReflectionTexture(
in float alphaG,
in vec3 vReflectionMicrosurfaceInfos,
in vec2 vReflectionInfos,
in vec3 vReflectionColor,
#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)
in float NdotVUnclamped,
#endif
#ifdef LINEARSPECULARREFLECTION
in float roughness,
#endif
#ifdef REFLECTIONMAP_3D
in samplerCube reflectionSampler,
const vec3 reflectionCoords,
#else
in sampler2D reflectionSampler,
const vec2 reflectionCoords,
#endif
#ifndef LODBASEDMICROSFURACE
#ifdef REFLECTIONMAP_3D
in samplerCube reflectionSamplerLow,
in samplerCube reflectionSamplerHigh,
#else
in sampler2D reflectionSamplerLow,
in sampler2D reflectionSamplerHigh,
#endif
#endif
#ifdef REALTIME_FILTERING
in vec2 vReflectionFilteringInfo,
#endif
out vec4 environmentRadiance
)
{
#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)
float reflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,alphaG,NdotVUnclamped);
#elif defined(LINEARSPECULARREFLECTION)
float reflectionLOD=getLinearLodFromRoughness(vReflectionMicrosurfaceInfos.x,roughness);
#else
float reflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,alphaG);
#endif
#ifdef LODBASEDMICROSFURACE
reflectionLOD=reflectionLOD*vReflectionMicrosurfaceInfos.y+vReflectionMicrosurfaceInfos.z;
#ifdef LODINREFLECTIONALPHA
float automaticReflectionLOD=UNPACK_LOD(sampleReflection(reflectionSampler,reflectionCoords).a);float requestedReflectionLOD=max(automaticReflectionLOD,reflectionLOD);
#else
float requestedReflectionLOD=reflectionLOD;
#endif
#ifdef REALTIME_FILTERING
environmentRadiance=vec4(radiance(alphaG,reflectionSampler,reflectionCoords,vReflectionFilteringInfo),1.0);
#else
environmentRadiance=sampleReflectionLod(reflectionSampler,reflectionCoords,reflectionLOD);
#endif
#else
float lodReflectionNormalized=saturate(reflectionLOD/log2(vReflectionMicrosurfaceInfos.x));float lodReflectionNormalizedDoubled=lodReflectionNormalized*2.0;vec4 environmentMid=sampleReflection(reflectionSampler,reflectionCoords);if (lodReflectionNormalizedDoubled<1.0){environmentRadiance=mix(
sampleReflection(reflectionSamplerHigh,reflectionCoords),
environmentMid,
lodReflectionNormalizedDoubled
);} else {environmentRadiance=mix(
environmentMid,
sampleReflection(reflectionSamplerLow,reflectionCoords),
lodReflectionNormalizedDoubled-1.0
);}
#endif
#ifdef RGBDREFLECTION
environmentRadiance.rgb=fromRGBD(environmentRadiance);
#endif
#ifdef GAMMAREFLECTION
environmentRadiance.rgb=toLinearSpace(environmentRadiance.rgb);
#endif
environmentRadiance.rgb*=vReflectionInfos.x;environmentRadiance.rgb*=vReflectionColor.rgb;}
#define pbr_inline
#define inline
void reflectionBlock(
in vec3 vPositionW,
in vec3 normalW,
in float alphaG,
in vec3 vReflectionMicrosurfaceInfos,
in vec2 vReflectionInfos,
in vec3 vReflectionColor,
#ifdef ANISOTROPIC
in anisotropicOutParams anisotropicOut,
#endif
#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)
in float NdotVUnclamped,
#endif
#ifdef LINEARSPECULARREFLECTION
in float roughness,
#endif
#ifdef REFLECTIONMAP_3D
in samplerCube reflectionSampler,
#else
in sampler2D reflectionSampler,
#endif
#if defined(NORMAL) && defined(USESPHERICALINVERTEX)
in vec3 vEnvironmentIrradiance,
#endif
#ifdef USESPHERICALFROMREFLECTIONMAP
#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)
in mat4 reflectionMatrix,
#endif
#endif
#ifdef USEIRRADIANCEMAP
#ifdef REFLECTIONMAP_3D
in samplerCube irradianceSampler,
#else
in sampler2D irradianceSampler,
#endif
#endif
#ifndef LODBASEDMICROSFURACE
#ifdef REFLECTIONMAP_3D
in samplerCube reflectionSamplerLow,
in samplerCube reflectionSamplerHigh,
#else
in sampler2D reflectionSamplerLow,
in sampler2D reflectionSamplerHigh,
#endif
#endif
#ifdef REALTIME_FILTERING
in vec2 vReflectionFilteringInfo,
#endif
out reflectionOutParams outParams
)
{vec4 environmentRadiance=vec4(0.,0.,0.,0.);
#ifdef REFLECTIONMAP_3D
vec3 reflectionCoords=vec3(0.);
#else
vec2 reflectionCoords=vec2(0.);
#endif
createReflectionCoords(
vPositionW,
normalW,
#ifdef ANISOTROPIC
anisotropicOut,
#endif
reflectionCoords
);sampleReflectionTexture(
alphaG,
vReflectionMicrosurfaceInfos,
vReflectionInfos,
vReflectionColor,
#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)
NdotVUnclamped,
#endif
#ifdef LINEARSPECULARREFLECTION
roughness,
#endif
#ifdef REFLECTIONMAP_3D
reflectionSampler,
reflectionCoords,
#else
reflectionSampler,
reflectionCoords,
#endif
#ifndef LODBASEDMICROSFURACE
reflectionSamplerLow,
reflectionSamplerHigh,
#endif
#ifdef REALTIME_FILTERING
vReflectionFilteringInfo,
#endif
environmentRadiance
);vec3 environmentIrradiance=vec3(0.,0.,0.);
#ifdef USESPHERICALFROMREFLECTIONMAP
#if defined(NORMAL) && defined(USESPHERICALINVERTEX)
environmentIrradiance=vEnvironmentIrradiance;
#else
#ifdef ANISOTROPIC
vec3 irradianceVector=vec3(reflectionMatrix*vec4(anisotropicOut.anisotropicNormal,0)).xyz;
#else
vec3 irradianceVector=vec3(reflectionMatrix*vec4(normalW,0)).xyz;
#endif
#ifdef REFLECTIONMAP_OPPOSITEZ
irradianceVector.z*=-1.0;
#endif
#ifdef INVERTCUBICMAP
irradianceVector.y*=-1.0;
#endif
#if defined(REALTIME_FILTERING)
environmentIrradiance=irradiance(reflectionSampler,irradianceVector,vReflectionFilteringInfo);
#else
environmentIrradiance=computeEnvironmentIrradiance(irradianceVector);
#endif
#ifdef SS_TRANSLUCENCY
outParams.irradianceVector=irradianceVector;
#endif
#endif
#elif defined(USEIRRADIANCEMAP)
vec4 environmentIrradiance4=sampleReflection(irradianceSampler,reflectionCoords);environmentIrradiance=environmentIrradiance4.rgb;
#ifdef RGBDREFLECTION
environmentIrradiance.rgb=fromRGBD(environmentIrradiance4);
#endif
#ifdef GAMMAREFLECTION
environmentIrradiance.rgb=toLinearSpace(environmentIrradiance.rgb);
#endif
#endif
environmentIrradiance*=vReflectionColor.rgb;outParams.environmentRadiance=environmentRadiance;outParams.environmentIrradiance=environmentIrradiance;outParams.reflectionCoords=reflectionCoords;}
#endif
`;Y.IncludesShadersStore[UP]=VP;const BP="pbrBlockSheen",kP=`#ifdef SHEEN
struct sheenOutParams
{float sheenIntensity;vec3 sheenColor;float sheenRoughness;
#ifdef SHEEN_LINKWITHALBEDO
vec3 surfaceAlbedo;
#endif
#if defined(ENVIRONMENTBRDF) && defined(SHEEN_ALBEDOSCALING)
float sheenAlbedoScaling;
#endif
#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)
vec3 finalSheenRadianceScaled;
#endif
#if DEBUGMODE>0
#ifdef SHEEN_TEXTURE
vec4 sheenMapData;
#endif
#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)
vec3 sheenEnvironmentReflectance;
#endif
#endif
};
#define pbr_inline
#define inline
void sheenBlock(
in vec4 vSheenColor,
#ifdef SHEEN_ROUGHNESS
in float vSheenRoughness,
#if defined(SHEEN_TEXTURE_ROUGHNESS) && !defined(SHEEN_TEXTURE_ROUGHNESS_IDENTICAL) && !defined(SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE)
in vec4 sheenMapRoughnessData,
#endif
#endif
in float roughness,
#ifdef SHEEN_TEXTURE
in vec4 sheenMapData,
in float sheenMapLevel,
#endif
in float reflectance,
#ifdef SHEEN_LINKWITHALBEDO
in vec3 baseColor,
in vec3 surfaceAlbedo,
#endif
#ifdef ENVIRONMENTBRDF
in float NdotV,
in vec3 environmentBrdf,
#endif
#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)
in vec2 AARoughnessFactors,
in vec3 vReflectionMicrosurfaceInfos,
in vec2 vReflectionInfos,
in vec3 vReflectionColor,
in vec4 vLightingIntensity,
#ifdef REFLECTIONMAP_3D
in samplerCube reflectionSampler,
in vec3 reflectionCoords,
#else
in sampler2D reflectionSampler,
in vec2 reflectionCoords,
#endif
in float NdotVUnclamped,
#ifndef LODBASEDMICROSFURACE
#ifdef REFLECTIONMAP_3D
in samplerCube reflectionSamplerLow,
in samplerCube reflectionSamplerHigh,
#else
in sampler2D reflectionSamplerLow,
in sampler2D reflectionSamplerHigh,
#endif
#endif
#ifdef REALTIME_FILTERING
in vec2 vReflectionFilteringInfo,
#endif
#if !defined(REFLECTIONMAP_SKYBOX) && defined(RADIANCEOCCLUSION)
in float seo,
#endif
#if !defined(REFLECTIONMAP_SKYBOX) && defined(HORIZONOCCLUSION) && defined(BUMP) && defined(REFLECTIONMAP_3D)
in float eho,
#endif
#endif
out sheenOutParams outParams
)
{float sheenIntensity=vSheenColor.a;
#ifdef SHEEN_TEXTURE
#if DEBUGMODE>0
outParams.sheenMapData=sheenMapData;
#endif
#endif
#ifdef SHEEN_LINKWITHALBEDO
float sheenFactor=pow5(1.0-sheenIntensity);vec3 sheenColor=baseColor.rgb*(1.0-sheenFactor);float sheenRoughness=sheenIntensity;outParams.surfaceAlbedo=surfaceAlbedo*sheenFactor;
#ifdef SHEEN_TEXTURE
sheenIntensity*=sheenMapData.a;
#endif
#else
vec3 sheenColor=vSheenColor.rgb;
#ifdef SHEEN_TEXTURE
#ifdef SHEEN_GAMMATEXTURE
sheenColor.rgb*=toLinearSpace(sheenMapData.rgb);
#else
sheenColor.rgb*=sheenMapData.rgb;
#endif
sheenColor.rgb*=sheenMapLevel;
#endif
#ifdef SHEEN_ROUGHNESS
float sheenRoughness=vSheenRoughness;
#ifdef SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE
#if defined(SHEEN_TEXTURE)
sheenRoughness*=sheenMapData.a;
#endif
#elif defined(SHEEN_TEXTURE_ROUGHNESS)
#ifdef SHEEN_TEXTURE_ROUGHNESS_IDENTICAL
sheenRoughness*=sheenMapData.a;
#else
sheenRoughness*=sheenMapRoughnessData.a;
#endif
#endif
#else
float sheenRoughness=roughness;
#ifdef SHEEN_TEXTURE
sheenIntensity*=sheenMapData.a;
#endif
#endif
#if !defined(SHEEN_ALBEDOSCALING)
sheenIntensity*=(1.-reflectance);
#endif
sheenColor*=sheenIntensity;
#endif
#ifdef ENVIRONMENTBRDF
/*#ifdef SHEEN_SOFTER
vec3 environmentSheenBrdf=vec3(0.,0.,getBRDFLookupCharlieSheen(NdotV,sheenRoughness));
#else*/
#ifdef SHEEN_ROUGHNESS
vec3 environmentSheenBrdf=getBRDFLookup(NdotV,sheenRoughness);
#else
vec3 environmentSheenBrdf=environmentBrdf;
#endif
/*#endif*/
#endif
#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)
float sheenAlphaG=convertRoughnessToAverageSlope(sheenRoughness);
#ifdef SPECULARAA
sheenAlphaG+=AARoughnessFactors.y;
#endif
vec4 environmentSheenRadiance=vec4(0.,0.,0.,0.);sampleReflectionTexture(
sheenAlphaG,
vReflectionMicrosurfaceInfos,
vReflectionInfos,
vReflectionColor,
#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)
NdotVUnclamped,
#endif
#ifdef LINEARSPECULARREFLECTION
sheenRoughness,
#endif
reflectionSampler,
reflectionCoords,
#ifndef LODBASEDMICROSFURACE
reflectionSamplerLow,
reflectionSamplerHigh,
#endif
#ifdef REALTIME_FILTERING
vReflectionFilteringInfo,
#endif
environmentSheenRadiance
);vec3 sheenEnvironmentReflectance=getSheenReflectanceFromBRDFLookup(sheenColor,environmentSheenBrdf);
#if !defined(REFLECTIONMAP_SKYBOX) && defined(RADIANCEOCCLUSION)
sheenEnvironmentReflectance*=seo;
#endif
#if !defined(REFLECTIONMAP_SKYBOX) && defined(HORIZONOCCLUSION) && defined(BUMP) && defined(REFLECTIONMAP_3D)
sheenEnvironmentReflectance*=eho;
#endif
#if DEBUGMODE>0
outParams.sheenEnvironmentReflectance=sheenEnvironmentReflectance;
#endif
outParams.finalSheenRadianceScaled=
environmentSheenRadiance.rgb *
sheenEnvironmentReflectance *
vLightingIntensity.z;
#endif
#if defined(ENVIRONMENTBRDF) && defined(SHEEN_ALBEDOSCALING)
outParams.sheenAlbedoScaling=1.0-sheenIntensity*max(max(sheenColor.r,sheenColor.g),sheenColor.b)*environmentSheenBrdf.b;
#endif
outParams.sheenIntensity=sheenIntensity;outParams.sheenColor=sheenColor;outParams.sheenRoughness=sheenRoughness;}
#endif
`;Y.IncludesShadersStore[BP]=kP;const zP="pbrBlockClearcoat",GP=`struct clearcoatOutParams
{vec3 specularEnvironmentR0;float conservationFactor;vec3 clearCoatNormalW;vec2 clearCoatAARoughnessFactors;float clearCoatIntensity;float clearCoatRoughness;
#ifdef REFLECTION
vec3 finalClearCoatRadianceScaled;
#endif
#ifdef CLEARCOAT_TINT
vec3 absorption;float clearCoatNdotVRefract;vec3 clearCoatColor;float clearCoatThickness;
#endif
#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)
vec3 energyConservationFactorClearCoat;
#endif
#if DEBUGMODE>0
#ifdef CLEARCOAT_BUMP
mat3 TBNClearCoat;
#endif
#ifdef CLEARCOAT_TEXTURE
vec2 clearCoatMapData;
#endif
#if defined(CLEARCOAT_TINT) && defined(CLEARCOAT_TINT_TEXTURE)
vec4 clearCoatTintMapData;
#endif
#ifdef REFLECTION
vec4 environmentClearCoatRadiance;vec3 clearCoatEnvironmentReflectance;
#endif
float clearCoatNdotV;
#endif
};
#ifdef CLEARCOAT
#define pbr_inline
#define inline
void clearcoatBlock(
in vec3 vPositionW,
in vec3 geometricNormalW,
in vec3 viewDirectionW,
in vec2 vClearCoatParams,
#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL) && !defined(CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE)
in vec4 clearCoatMapRoughnessData,
#endif
in vec3 specularEnvironmentR0,
#ifdef CLEARCOAT_TEXTURE
in vec2 clearCoatMapData,
#endif
#ifdef CLEARCOAT_TINT
in vec4 vClearCoatTintParams,
in float clearCoatColorAtDistance,
in vec4 vClearCoatRefractionParams,
#ifdef CLEARCOAT_TINT_TEXTURE
in vec4 clearCoatTintMapData,
#endif
#endif
#ifdef CLEARCOAT_BUMP
in vec2 vClearCoatBumpInfos,
in vec4 clearCoatBumpMapData,
in vec2 vClearCoatBumpUV,
#if defined(TANGENT) && defined(NORMAL)
in mat3 vTBN,
#else
in vec2 vClearCoatTangentSpaceParams,
#endif
#ifdef OBJECTSPACE_NORMALMAP
in mat4 normalMatrix,
#endif
#endif
#if defined(FORCENORMALFORWARD) && defined(NORMAL)
in vec3 faceNormal,
#endif
#ifdef REFLECTION
in vec3 vReflectionMicrosurfaceInfos,
in vec2 vReflectionInfos,
in vec3 vReflectionColor,
in vec4 vLightingIntensity,
#ifdef REFLECTIONMAP_3D
in samplerCube reflectionSampler,
#else
in sampler2D reflectionSampler,
#endif
#ifndef LODBASEDMICROSFURACE
#ifdef REFLECTIONMAP_3D
in samplerCube reflectionSamplerLow,
in samplerCube reflectionSamplerHigh,
#else
in sampler2D reflectionSamplerLow,
in sampler2D reflectionSamplerHigh,
#endif
#endif
#ifdef REALTIME_FILTERING
in vec2 vReflectionFilteringInfo,
#endif
#endif
#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)
#ifdef RADIANCEOCCLUSION
in float ambientMonochrome,
#endif
#endif
#if defined(CLEARCOAT_BUMP) || defined(TWOSIDEDLIGHTING)
in float frontFacingMultiplier,
#endif
out clearcoatOutParams outParams
)
{float clearCoatIntensity=vClearCoatParams.x;float clearCoatRoughness=vClearCoatParams.y;
#ifdef CLEARCOAT_TEXTURE
clearCoatIntensity*=clearCoatMapData.x;
#ifdef CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE
clearCoatRoughness*=clearCoatMapData.y;
#endif
#if DEBUGMODE>0
outParams.clearCoatMapData=clearCoatMapData;
#endif
#endif
#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE)
#ifdef CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL
clearCoatRoughness*=clearCoatMapData.y;
#else
clearCoatRoughness*=clearCoatMapRoughnessData.y;
#endif
#endif
outParams.clearCoatIntensity=clearCoatIntensity;outParams.clearCoatRoughness=clearCoatRoughness;
#ifdef CLEARCOAT_TINT
vec3 clearCoatColor=vClearCoatTintParams.rgb;float clearCoatThickness=vClearCoatTintParams.a;
#ifdef CLEARCOAT_TINT_TEXTURE
#ifdef CLEARCOAT_TINT_GAMMATEXTURE
clearCoatColor*=toLinearSpace(clearCoatTintMapData.rgb);
#else
clearCoatColor*=clearCoatTintMapData.rgb;
#endif
clearCoatThickness*=clearCoatTintMapData.a;
#if DEBUGMODE>0
outParams.clearCoatTintMapData=clearCoatTintMapData;
#endif
#endif
outParams.clearCoatColor=computeColorAtDistanceInMedia(clearCoatColor,clearCoatColorAtDistance);outParams.clearCoatThickness=clearCoatThickness;
#endif
#ifdef CLEARCOAT_REMAP_F0
vec3 specularEnvironmentR0Updated=getR0RemappedForClearCoat(specularEnvironmentR0);
#else
vec3 specularEnvironmentR0Updated=specularEnvironmentR0;
#endif
outParams.specularEnvironmentR0=mix(specularEnvironmentR0,specularEnvironmentR0Updated,clearCoatIntensity);vec3 clearCoatNormalW=geometricNormalW;
#ifdef CLEARCOAT_BUMP
#ifdef NORMALXYSCALE
float clearCoatNormalScale=1.0;
#else
float clearCoatNormalScale=vClearCoatBumpInfos.y;
#endif
#if defined(TANGENT) && defined(NORMAL)
mat3 TBNClearCoat=vTBN;
#else
vec2 TBNClearCoatUV=vClearCoatBumpUV*frontFacingMultiplier;mat3 TBNClearCoat=cotangent_frame(clearCoatNormalW*clearCoatNormalScale,vPositionW,TBNClearCoatUV,vClearCoatTangentSpaceParams);
#endif
#if DEBUGMODE>0
outParams.TBNClearCoat=TBNClearCoat;
#endif
#ifdef OBJECTSPACE_NORMALMAP
clearCoatNormalW=normalize(clearCoatBumpMapData.xyz *2.0-1.0);clearCoatNormalW=normalize(mat3(normalMatrix)*clearCoatNormalW);
#else
clearCoatNormalW=perturbNormal(TBNClearCoat,clearCoatBumpMapData.xyz,vClearCoatBumpInfos.y);
#endif
#endif
#if defined(FORCENORMALFORWARD) && defined(NORMAL)
clearCoatNormalW*=sign(dot(clearCoatNormalW,faceNormal));
#endif
#if defined(TWOSIDEDLIGHTING) && defined(NORMAL)
clearCoatNormalW=clearCoatNormalW*frontFacingMultiplier;
#endif
outParams.clearCoatNormalW=clearCoatNormalW;outParams.clearCoatAARoughnessFactors=getAARoughnessFactors(clearCoatNormalW.xyz);float clearCoatNdotVUnclamped=dot(clearCoatNormalW,viewDirectionW);float clearCoatNdotV=absEps(clearCoatNdotVUnclamped);
#if DEBUGMODE>0
outParams.clearCoatNdotV=clearCoatNdotV;
#endif
#ifdef CLEARCOAT_TINT
vec3 clearCoatVRefract=refract(-viewDirectionW,clearCoatNormalW,vClearCoatRefractionParams.y);outParams.clearCoatNdotVRefract=absEps(dot(clearCoatNormalW,clearCoatVRefract));
#endif
#if defined(ENVIRONMENTBRDF) && (!defined(REFLECTIONMAP_SKYBOX) || defined(MS_BRDF_ENERGY_CONSERVATION))
vec3 environmentClearCoatBrdf=getBRDFLookup(clearCoatNdotV,clearCoatRoughness);
#endif
#if defined(REFLECTION)
float clearCoatAlphaG=convertRoughnessToAverageSlope(clearCoatRoughness);
#ifdef SPECULARAA
clearCoatAlphaG+=outParams.clearCoatAARoughnessFactors.y;
#endif
vec4 environmentClearCoatRadiance=vec4(0.,0.,0.,0.);vec3 clearCoatReflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),clearCoatNormalW);
#ifdef REFLECTIONMAP_OPPOSITEZ
clearCoatReflectionVector.z*=-1.0;
#endif
#ifdef REFLECTIONMAP_3D
vec3 clearCoatReflectionCoords=clearCoatReflectionVector;
#else
vec2 clearCoatReflectionCoords=clearCoatReflectionVector.xy;
#ifdef REFLECTIONMAP_PROJECTION
clearCoatReflectionCoords/=clearCoatReflectionVector.z;
#endif
clearCoatReflectionCoords.y=1.0-clearCoatReflectionCoords.y;
#endif
sampleReflectionTexture(
clearCoatAlphaG,
vReflectionMicrosurfaceInfos,
vReflectionInfos,
vReflectionColor,
#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)
clearCoatNdotVUnclamped,
#endif
#ifdef LINEARSPECULARREFLECTION
clearCoatRoughness,
#endif
reflectionSampler,
clearCoatReflectionCoords,
#ifndef LODBASEDMICROSFURACE
reflectionSamplerLow,
reflectionSamplerHigh,
#endif
#ifdef REALTIME_FILTERING
vReflectionFilteringInfo,
#endif
environmentClearCoatRadiance
);
#if DEBUGMODE>0
outParams.environmentClearCoatRadiance=environmentClearCoatRadiance;
#endif
#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)
vec3 clearCoatEnvironmentReflectance=getReflectanceFromBRDFLookup(vec3(vClearCoatRefractionParams.x),environmentClearCoatBrdf);
#ifdef HORIZONOCCLUSION
#ifdef BUMP
#ifdef REFLECTIONMAP_3D
float clearCoatEho=environmentHorizonOcclusion(-viewDirectionW,clearCoatNormalW,geometricNormalW);clearCoatEnvironmentReflectance*=clearCoatEho;
#endif
#endif
#endif
#else
vec3 clearCoatEnvironmentReflectance=getReflectanceFromAnalyticalBRDFLookup_Jones(clearCoatNdotV,vec3(1.),vec3(1.),sqrt(1.-clearCoatRoughness));
#endif
clearCoatEnvironmentReflectance*=clearCoatIntensity;
#if DEBUGMODE>0
outParams.clearCoatEnvironmentReflectance=clearCoatEnvironmentReflectance;
#endif
outParams.finalClearCoatRadianceScaled=
environmentClearCoatRadiance.rgb *
clearCoatEnvironmentReflectance *
vLightingIntensity.z;
#endif
#if defined(CLEARCOAT_TINT)
outParams.absorption=computeClearCoatAbsorption(outParams.clearCoatNdotVRefract,outParams.clearCoatNdotVRefract,outParams.clearCoatColor,clearCoatThickness,clearCoatIntensity);
#endif
float fresnelIBLClearCoat=fresnelSchlickGGX(clearCoatNdotV,vClearCoatRefractionParams.x,CLEARCOATREFLECTANCE90);fresnelIBLClearCoat*=clearCoatIntensity;outParams.conservationFactor=(1.-fresnelIBLClearCoat);
#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)
outParams.energyConservationFactorClearCoat=getEnergyConservationFactor(outParams.specularEnvironmentR0,environmentClearCoatBrdf);
#endif
}
#endif
`;Y.IncludesShadersStore[zP]=GP;const WP="pbrBlockIridescence",XP=`struct iridescenceOutParams
{float iridescenceIntensity;float iridescenceIOR;float iridescenceThickness;vec3 specularEnvironmentR0;};
#ifdef IRIDESCENCE
#define pbr_inline
#define inline
void iridescenceBlock(
in vec4 vIridescenceParams,
in float viewAngle,
in vec3 specularEnvironmentR0,
#ifdef IRIDESCENCE_TEXTURE
in vec2 iridescenceMapData,
#endif
#ifdef IRIDESCENCE_THICKNESS_TEXTURE
in vec2 iridescenceThicknessMapData,
#endif
#ifdef CLEARCOAT
in float NdotVUnclamped,
#ifdef CLEARCOAT_TEXTURE
in vec2 clearCoatMapData,
#endif
#endif
out iridescenceOutParams outParams
)
{float iridescenceIntensity=vIridescenceParams.x;float iridescenceIOR=vIridescenceParams.y;float iridescenceThicknessMin=vIridescenceParams.z;float iridescenceThicknessMax=vIridescenceParams.w;float iridescenceThicknessWeight=1.;
#ifdef IRIDESCENCE_TEXTURE
iridescenceIntensity*=iridescenceMapData.x;
#ifdef IRIDESCENCE_USE_THICKNESS_FROM_MAINTEXTURE
iridescenceThicknessWeight=iridescenceMapData.g;
#endif
#endif
#if defined(IRIDESCENCE_THICKNESS_TEXTURE)
iridescenceThicknessWeight=iridescenceThicknessMapData.g;
#endif
float iridescenceThickness=mix(iridescenceThicknessMin,iridescenceThicknessMax,iridescenceThicknessWeight);float topIor=1.; 
#ifdef CLEARCOAT
float clearCoatIntensity=vClearCoatParams.x;
#ifdef CLEARCOAT_TEXTURE
clearCoatIntensity*=clearCoatMapData.x;
#endif
topIor=mix(1.0,vClearCoatRefractionParams.w-1.,clearCoatIntensity);viewAngle=sqrt(1.0+square(1.0/topIor)*(square(NdotVUnclamped)-1.0));
#endif
vec3 iridescenceFresnel=evalIridescence(topIor,iridescenceIOR,viewAngle,iridescenceThickness,specularEnvironmentR0);outParams.specularEnvironmentR0=mix(specularEnvironmentR0,iridescenceFresnel,iridescenceIntensity);outParams.iridescenceIntensity=iridescenceIntensity;outParams.iridescenceThickness=iridescenceThickness;outParams.iridescenceIOR=iridescenceIOR;}
#endif
`;Y.IncludesShadersStore[WP]=XP;const HP="pbrBlockSubSurface",KP=`struct subSurfaceOutParams
{vec3 specularEnvironmentReflectance;
#ifdef SS_REFRACTION
vec3 finalRefraction;vec3 surfaceAlbedo;
#ifdef SS_LINKREFRACTIONTOTRANSPARENCY
float alpha;
#endif
#ifdef REFLECTION
float refractionFactorForIrradiance;
#endif
#endif
#ifdef SS_TRANSLUCENCY
vec3 transmittance;float translucencyIntensity;
#ifdef REFLECTION
vec3 refractionIrradiance;
#endif
#endif
#if DEBUGMODE>0
#ifdef SS_THICKNESSANDMASK_TEXTURE
vec4 thicknessMap;
#endif
#ifdef SS_REFRACTION
vec4 environmentRefraction;vec3 refractionTransmittance;
#endif
#endif
};
#ifdef SUBSURFACE
#ifdef SS_REFRACTION
#define pbr_inline
#define inline
vec4 sampleEnvironmentRefraction(
in float ior
,in float thickness
,in float refractionLOD
,in vec3 normalW
,in vec3 vPositionW
,in vec3 viewDirectionW
,in mat4 view
,in vec4 vRefractionInfos
,in mat4 refractionMatrix
,in vec4 vRefractionMicrosurfaceInfos
,in float alphaG
#ifdef SS_REFRACTIONMAP_3D
,in samplerCube refractionSampler
#ifndef LODBASEDMICROSFURACE
,in samplerCube refractionSamplerLow
,in samplerCube refractionSamplerHigh
#endif
#else
,in sampler2D refractionSampler
#ifndef LODBASEDMICROSFURACE
,in sampler2D refractionSamplerLow
,in sampler2D refractionSamplerHigh
#endif
#endif
#ifdef ANISOTROPIC
,in anisotropicOutParams anisotropicOut
#endif
#ifdef REALTIME_FILTERING
,in vec2 vRefractionFilteringInfo
#endif
#ifdef SS_USE_LOCAL_REFRACTIONMAP_CUBIC
,in vec3 refractionPosition
,in vec3 refractionSize
#endif
) {vec4 environmentRefraction=vec4(0.,0.,0.,0.);
#ifdef ANISOTROPIC
vec3 refractionVector=refract(-viewDirectionW,anisotropicOut.anisotropicNormal,ior);
#else
vec3 refractionVector=refract(-viewDirectionW,normalW,ior);
#endif
#ifdef SS_REFRACTIONMAP_OPPOSITEZ
refractionVector.z*=-1.0;
#endif
#ifdef SS_REFRACTIONMAP_3D
#ifdef SS_USE_LOCAL_REFRACTIONMAP_CUBIC
refractionVector=parallaxCorrectNormal(vPositionW,refractionVector,refractionSize,refractionPosition);
#endif
refractionVector.y=refractionVector.y*vRefractionInfos.w;vec3 refractionCoords=refractionVector;refractionCoords=vec3(refractionMatrix*vec4(refractionCoords,0));
#else
#ifdef SS_USE_THICKNESS_AS_DEPTH
vec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*thickness,1.0)));
#else
vec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));
#endif
vec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;refractionCoords.y=1.0-refractionCoords.y;
#endif
#ifdef LODBASEDMICROSFURACE
refractionLOD=refractionLOD*vRefractionMicrosurfaceInfos.y+vRefractionMicrosurfaceInfos.z;
#ifdef SS_LODINREFRACTIONALPHA
float automaticRefractionLOD=UNPACK_LOD(sampleRefraction(refractionSampler,refractionCoords).a);float requestedRefractionLOD=max(automaticRefractionLOD,refractionLOD);
#else
float requestedRefractionLOD=refractionLOD;
#endif
#if defined(REALTIME_FILTERING) && defined(SS_REFRACTIONMAP_3D)
environmentRefraction=vec4(radiance(alphaG,refractionSampler,refractionCoords,vRefractionFilteringInfo),1.0);
#else
environmentRefraction=sampleRefractionLod(refractionSampler,refractionCoords,requestedRefractionLOD);
#endif
#else
float lodRefractionNormalized=saturate(refractionLOD/log2(vRefractionMicrosurfaceInfos.x));float lodRefractionNormalizedDoubled=lodRefractionNormalized*2.0;vec4 environmentRefractionMid=sampleRefraction(refractionSampler,refractionCoords);if (lodRefractionNormalizedDoubled<1.0){environmentRefraction=mix(
sampleRefraction(refractionSamplerHigh,refractionCoords),
environmentRefractionMid,
lodRefractionNormalizedDoubled
);} else {environmentRefraction=mix(
environmentRefractionMid,
sampleRefraction(refractionSamplerLow,refractionCoords),
lodRefractionNormalizedDoubled-1.0
);}
#endif
#ifdef SS_RGBDREFRACTION
environmentRefraction.rgb=fromRGBD(environmentRefraction);
#endif
#ifdef SS_GAMMAREFRACTION
environmentRefraction.rgb=toLinearSpace(environmentRefraction.rgb);
#endif
return environmentRefraction;}
#endif
#define pbr_inline
#define inline
void subSurfaceBlock(
in vec3 vSubSurfaceIntensity,
in vec2 vThicknessParam,
in vec4 vTintColor,
in vec3 normalW,
in vec3 specularEnvironmentReflectance,
#ifdef SS_THICKNESSANDMASK_TEXTURE
in vec4 thicknessMap,
#endif
#ifdef SS_REFRACTIONINTENSITY_TEXTURE
in vec4 refractionIntensityMap,
#endif
#ifdef SS_TRANSLUCENCYINTENSITY_TEXTURE
in vec4 translucencyIntensityMap,
#endif
#ifdef REFLECTION
#ifdef SS_TRANSLUCENCY
in mat4 reflectionMatrix,
#ifdef USESPHERICALFROMREFLECTIONMAP
#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)
in vec3 irradianceVector_,
#endif
#if defined(REALTIME_FILTERING)
in samplerCube reflectionSampler,
in vec2 vReflectionFilteringInfo,
#endif
#endif
#ifdef USEIRRADIANCEMAP
#ifdef REFLECTIONMAP_3D
in samplerCube irradianceSampler,
#else
in sampler2D irradianceSampler,
#endif
#endif
#endif
#endif
#if defined(SS_REFRACTION) || defined(SS_TRANSLUCENCY)
in vec3 surfaceAlbedo,
#endif
#ifdef SS_REFRACTION
in vec3 vPositionW,
in vec3 viewDirectionW,
in mat4 view,
in vec4 vRefractionInfos,
in mat4 refractionMatrix,
in vec4 vRefractionMicrosurfaceInfos,
in vec4 vLightingIntensity,
#ifdef SS_LINKREFRACTIONTOTRANSPARENCY
in float alpha,
#endif
#ifdef SS_LODINREFRACTIONALPHA
in float NdotVUnclamped,
#endif
#ifdef SS_LINEARSPECULARREFRACTION
in float roughness,
#endif
in float alphaG,
#ifdef SS_REFRACTIONMAP_3D
in samplerCube refractionSampler,
#ifndef LODBASEDMICROSFURACE
in samplerCube refractionSamplerLow,
in samplerCube refractionSamplerHigh,
#endif
#else
in sampler2D refractionSampler,
#ifndef LODBASEDMICROSFURACE
in sampler2D refractionSamplerLow,
in sampler2D refractionSamplerHigh,
#endif
#endif
#ifdef ANISOTROPIC
in anisotropicOutParams anisotropicOut,
#endif
#ifdef REALTIME_FILTERING
in vec2 vRefractionFilteringInfo,
#endif
#ifdef SS_USE_LOCAL_REFRACTIONMAP_CUBIC
in vec3 refractionPosition,
in vec3 refractionSize,
#endif
#ifdef SS_DISPERSION
in float dispersion,
#endif
#endif
#ifdef SS_TRANSLUCENCY
in vec3 vDiffusionDistance,
#endif
out subSurfaceOutParams outParams
)
{outParams.specularEnvironmentReflectance=specularEnvironmentReflectance;
#ifdef SS_REFRACTION
float refractionIntensity=vSubSurfaceIntensity.x;
#ifdef SS_LINKREFRACTIONTOTRANSPARENCY
refractionIntensity*=(1.0-alpha);outParams.alpha=1.0;
#endif
#endif
#ifdef SS_TRANSLUCENCY
float translucencyIntensity=vSubSurfaceIntensity.y;
#endif
#ifdef SS_THICKNESSANDMASK_TEXTURE
#if defined(SS_USE_GLTF_TEXTURES)
float thickness=thicknessMap.g*vThicknessParam.y+vThicknessParam.x;
#else
float thickness=thicknessMap.r*vThicknessParam.y+vThicknessParam.x;
#endif
#if DEBUGMODE>0
outParams.thicknessMap=thicknessMap;
#endif
#ifdef SS_MASK_FROM_THICKNESS_TEXTURE
#if defined(SS_REFRACTION) && defined(SS_REFRACTION_USE_INTENSITY_FROM_TEXTURE)
#if defined(SS_USE_GLTF_TEXTURES)
refractionIntensity*=thicknessMap.r;
#else
refractionIntensity*=thicknessMap.g;
#endif
#endif
#if defined(SS_TRANSLUCENCY) && defined(SS_TRANSLUCENCY_USE_INTENSITY_FROM_TEXTURE)
translucencyIntensity*=thicknessMap.b;
#endif
#endif
#else
float thickness=vThicknessParam.y;
#endif
#ifdef SS_REFRACTIONINTENSITY_TEXTURE
#ifdef SS_USE_GLTF_TEXTURES
refractionIntensity*=refractionIntensityMap.r;
#else
refractionIntensity*=refractionIntensityMap.g;
#endif
#endif
#ifdef SS_TRANSLUCENCYINTENSITY_TEXTURE
translucencyIntensity*=translucencyIntensityMap.b;
#endif
#ifdef SS_TRANSLUCENCY
thickness=maxEps(thickness);vec3 transmittance=transmittanceBRDF_Burley(vTintColor.rgb,vDiffusionDistance,thickness);transmittance*=translucencyIntensity;outParams.transmittance=transmittance;outParams.translucencyIntensity=translucencyIntensity;
#endif
#ifdef SS_REFRACTION
vec4 environmentRefraction=vec4(0.,0.,0.,0.);
#ifdef SS_HAS_THICKNESS
float ior=vRefractionInfos.y;
#else
float ior=vRefractionMicrosurfaceInfos.w;
#endif
#ifdef SS_LODINREFRACTIONALPHA
float refractionAlphaG=alphaG;refractionAlphaG=mix(alphaG,0.0,clamp(ior*3.0-2.0,0.0,1.0));float refractionLOD=getLodFromAlphaG(vRefractionMicrosurfaceInfos.x,refractionAlphaG,NdotVUnclamped);
#elif defined(SS_LINEARSPECULARREFRACTION)
float refractionRoughness=alphaG;refractionRoughness=mix(alphaG,0.0,clamp(ior*3.0-2.0,0.0,1.0));float refractionLOD=getLinearLodFromRoughness(vRefractionMicrosurfaceInfos.x,refractionRoughness);
#else
float refractionAlphaG=alphaG;refractionAlphaG=mix(alphaG,0.0,clamp(ior*3.0-2.0,0.0,1.0));float refractionLOD=getLodFromAlphaG(vRefractionMicrosurfaceInfos.x,refractionAlphaG);
#endif
float refraction_ior=vRefractionInfos.y;
#ifdef SS_DISPERSION
float realIOR=1.0/refraction_ior;float iorDispersionSpread=0.04*dispersion*(realIOR-1.0);vec3 iors=vec3(1.0/(realIOR-iorDispersionSpread),refraction_ior,1.0/(realIOR+iorDispersionSpread));for (int i=0; i<3; i++) {refraction_ior=iors[i];
#endif
vec4 envSample=sampleEnvironmentRefraction(refraction_ior,thickness,refractionLOD,normalW,vPositionW,viewDirectionW,view,vRefractionInfos,refractionMatrix,vRefractionMicrosurfaceInfos,alphaG
#ifdef SS_REFRACTIONMAP_3D
,refractionSampler
#ifndef LODBASEDMICROSFURACE
,refractionSamplerLow
,refractionSamplerHigh
#endif
#else
,refractionSampler
#ifndef LODBASEDMICROSFURACE
,refractionSamplerLow
,refractionSamplerHigh
#endif
#endif
#ifdef ANISOTROPIC
,anisotropicOut
#endif
#ifdef REALTIME_FILTERING
,vRefractionFilteringInfo
#endif
#ifdef SS_USE_LOCAL_REFRACTIONMAP_CUBIC
,refractionPosition
,refractionSize
#endif
);
#ifdef SS_DISPERSION
environmentRefraction[i]=envSample[i];}
#else
environmentRefraction=envSample;
#endif
environmentRefraction.rgb*=vRefractionInfos.x;
#endif
#ifdef SS_REFRACTION
vec3 refractionTransmittance=vec3(refractionIntensity);
#ifdef SS_THICKNESSANDMASK_TEXTURE
vec3 volumeAlbedo=computeColorAtDistanceInMedia(vTintColor.rgb,vTintColor.w);refractionTransmittance*=cocaLambert(volumeAlbedo,thickness);
#elif defined(SS_LINKREFRACTIONTOTRANSPARENCY)
float maxChannel=max(max(surfaceAlbedo.r,surfaceAlbedo.g),surfaceAlbedo.b);vec3 volumeAlbedo=saturate(maxChannel*surfaceAlbedo);environmentRefraction.rgb*=volumeAlbedo;
#else
vec3 volumeAlbedo=computeColorAtDistanceInMedia(vTintColor.rgb,vTintColor.w);refractionTransmittance*=cocaLambert(volumeAlbedo,vThicknessParam.y);
#endif
#ifdef SS_ALBEDOFORREFRACTIONTINT
environmentRefraction.rgb*=surfaceAlbedo.rgb;
#endif
outParams.surfaceAlbedo=surfaceAlbedo*(1.-refractionIntensity);
#ifdef REFLECTION
outParams.refractionFactorForIrradiance=(1.-refractionIntensity);
#endif
#ifdef UNUSED_MULTIPLEBOUNCES
vec3 bounceSpecularEnvironmentReflectance=(2.0*specularEnvironmentReflectance)/(1.0+specularEnvironmentReflectance);outParams.specularEnvironmentReflectance=mix(bounceSpecularEnvironmentReflectance,specularEnvironmentReflectance,refractionIntensity);
#endif
refractionTransmittance*=1.0-outParams.specularEnvironmentReflectance;
#if DEBUGMODE>0
outParams.refractionTransmittance=refractionTransmittance;
#endif
outParams.finalRefraction=environmentRefraction.rgb*refractionTransmittance*vLightingIntensity.z;
#if DEBUGMODE>0
outParams.environmentRefraction=environmentRefraction;
#endif
#endif
#if defined(REFLECTION) && defined(SS_TRANSLUCENCY)
#if defined(NORMAL) && defined(USESPHERICALINVERTEX) || !defined(USESPHERICALFROMREFLECTIONMAP)
vec3 irradianceVector=vec3(reflectionMatrix*vec4(normalW,0)).xyz;
#ifdef REFLECTIONMAP_OPPOSITEZ
irradianceVector.z*=-1.0;
#endif
#ifdef INVERTCUBICMAP
irradianceVector.y*=-1.0;
#endif
#else
vec3 irradianceVector=irradianceVector_;
#endif
#if defined(USESPHERICALFROMREFLECTIONMAP)
#if defined(REALTIME_FILTERING)
vec3 refractionIrradiance=irradiance(reflectionSampler,-irradianceVector,vReflectionFilteringInfo);
#else
vec3 refractionIrradiance=computeEnvironmentIrradiance(-irradianceVector);
#endif
#elif defined(USEIRRADIANCEMAP)
#ifdef REFLECTIONMAP_3D
vec3 irradianceCoords=irradianceVector;
#else
vec2 irradianceCoords=irradianceVector.xy;
#ifdef REFLECTIONMAP_PROJECTION
irradianceCoords/=irradianceVector.z;
#endif
irradianceCoords.y=1.0-irradianceCoords.y;
#endif
vec4 refractionIrradiance=sampleReflection(irradianceSampler,-irradianceCoords);
#ifdef RGBDREFLECTION
refractionIrradiance.rgb=fromRGBD(refractionIrradiance);
#endif
#ifdef GAMMAREFLECTION
refractionIrradiance.rgb=toLinearSpace(refractionIrradiance.rgb);
#endif
#else
vec4 refractionIrradiance=vec4(0.);
#endif
refractionIrradiance.rgb*=transmittance;
#ifdef SS_ALBEDOFORTRANSLUCENCYTINT
refractionIrradiance.rgb*=surfaceAlbedo.rgb;
#endif
outParams.refractionIrradiance=refractionIrradiance.rgb;
#endif
}
#endif
`;Y.IncludesShadersStore[HP]=KP;const qP="pbrBlockNormalGeometric",YP=`vec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);
#ifdef NORMAL
vec3 normalW=normalize(vNormalW);
#else
vec3 normalW=normalize(cross(dFdx(vPositionW),dFdy(vPositionW)))*vEyePosition.w;
#endif
vec3 geometricNormalW=normalW;
#if defined(TWOSIDEDLIGHTING) && defined(NORMAL)
geometricNormalW=gl_FrontFacing ? geometricNormalW : -geometricNormalW;
#endif
`;Y.IncludesShadersStore[qP]=YP;const ZP="pbrBlockNormalFinal",jP=`#if defined(FORCENORMALFORWARD) && defined(NORMAL)
vec3 faceNormal=normalize(cross(dFdx(vPositionW),dFdy(vPositionW)))*vEyePosition.w;
#if defined(TWOSIDEDLIGHTING)
faceNormal=gl_FrontFacing ? faceNormal : -faceNormal;
#endif
normalW*=sign(dot(normalW,faceNormal));
#endif
#if defined(TWOSIDEDLIGHTING) && defined(NORMAL)
normalW=gl_FrontFacing ? normalW : -normalW;
#endif
`;Y.IncludesShadersStore[ZP]=jP;const QP="pbrBlockLightmapInit",JP=`#ifdef LIGHTMAP
vec4 lightmapColor=texture2D(lightmapSampler,vLightmapUV+uvOffset);
#ifdef RGBDLIGHTMAP
lightmapColor.rgb=fromRGBD(lightmapColor);
#endif
#ifdef GAMMALIGHTMAP
lightmapColor.rgb=toLinearSpace(lightmapColor.rgb);
#endif
lightmapColor.rgb*=vLightmapInfos.y;
#endif
`;Y.IncludesShadersStore[QP]=JP;const $P="pbrBlockGeometryInfo",eO=`float NdotVUnclamped=dot(normalW,viewDirectionW);float NdotV=absEps(NdotVUnclamped);float alphaG=convertRoughnessToAverageSlope(roughness);vec2 AARoughnessFactors=getAARoughnessFactors(normalW.xyz);
#ifdef SPECULARAA
alphaG+=AARoughnessFactors.y;
#endif
#if defined(ENVIRONMENTBRDF)
vec3 environmentBrdf=getBRDFLookup(NdotV,roughness);
#endif
#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)
#ifdef RADIANCEOCCLUSION
#ifdef AMBIENTINGRAYSCALE
float ambientMonochrome=aoOut.ambientOcclusionColor.r;
#else
float ambientMonochrome=getLuminance(aoOut.ambientOcclusionColor);
#endif
float seo=environmentRadianceOcclusion(ambientMonochrome,NdotVUnclamped);
#endif
#ifdef HORIZONOCCLUSION
#ifdef BUMP
#ifdef REFLECTIONMAP_3D
float eho=environmentHorizonOcclusion(-viewDirectionW,normalW,geometricNormalW);
#endif
#endif
#endif
#endif
`;Y.IncludesShadersStore[$P]=eO;const tO="pbrBlockReflectance0",iO=`float reflectance=max(max(reflectivityOut.surfaceReflectivityColor.r,reflectivityOut.surfaceReflectivityColor.g),reflectivityOut.surfaceReflectivityColor.b);vec3 specularEnvironmentR0=reflectivityOut.surfaceReflectivityColor.rgb;
#ifdef METALLICWORKFLOW
vec3 specularEnvironmentR90=vec3(metallicReflectanceFactors.a);
#else 
vec3 specularEnvironmentR90=vec3(1.0,1.0,1.0);
#endif
#ifdef ALPHAFRESNEL
float reflectance90=fresnelGrazingReflectance(reflectance);specularEnvironmentR90=specularEnvironmentR90*reflectance90;
#endif
`;Y.IncludesShadersStore[tO]=iO;const rO="pbrBlockReflectance",sO=`#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)
vec3 specularEnvironmentReflectance=getReflectanceFromBRDFLookup(clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,environmentBrdf);
#ifdef RADIANCEOCCLUSION
specularEnvironmentReflectance*=seo;
#endif
#ifdef HORIZONOCCLUSION
#ifdef BUMP
#ifdef REFLECTIONMAP_3D
specularEnvironmentReflectance*=eho;
#endif
#endif
#endif
#else
vec3 specularEnvironmentReflectance=getReflectanceFromAnalyticalBRDFLookup_Jones(NdotV,clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,sqrt(microSurface));
#endif
#ifdef CLEARCOAT
specularEnvironmentReflectance*=clearcoatOut.conservationFactor;
#if defined(CLEARCOAT_TINT)
specularEnvironmentReflectance*=clearcoatOut.absorption;
#endif
#endif
`;Y.IncludesShadersStore[rO]=sO;const nO="pbrBlockDirectLighting",oO=`vec3 diffuseBase=vec3(0.,0.,0.);
#ifdef SPECULARTERM
vec3 specularBase=vec3(0.,0.,0.);
#endif
#ifdef CLEARCOAT
vec3 clearCoatBase=vec3(0.,0.,0.);
#endif
#ifdef SHEEN
vec3 sheenBase=vec3(0.,0.,0.);
#endif
preLightingInfo preInfo;lightingInfo info;float shadow=1.; 
float aggShadow=0.;float numLights=0.;
#if defined(CLEARCOAT) && defined(CLEARCOAT_TINT)
vec3 absorption=vec3(0.);
#endif
`;Y.IncludesShadersStore[nO]=oO;const aO="pbrBlockFinalLitComponents",lO=`aggShadow=aggShadow/numLights;
#if defined(ENVIRONMENTBRDF)
#ifdef MS_BRDF_ENERGY_CONSERVATION
vec3 energyConservationFactor=getEnergyConservationFactor(clearcoatOut.specularEnvironmentR0,environmentBrdf);
#endif
#endif
#ifndef METALLICWORKFLOW
#ifdef SPECULAR_GLOSSINESS_ENERGY_CONSERVATION
surfaceAlbedo.rgb=(1.-reflectance)*surfaceAlbedo.rgb;
#endif
#endif
#if defined(SHEEN) && defined(SHEEN_ALBEDOSCALING) && defined(ENVIRONMENTBRDF)
surfaceAlbedo.rgb=sheenOut.sheenAlbedoScaling*surfaceAlbedo.rgb;
#endif
#ifdef REFLECTION
vec3 finalIrradiance=reflectionOut.environmentIrradiance;
#if defined(CLEARCOAT)
finalIrradiance*=clearcoatOut.conservationFactor;
#if defined(CLEARCOAT_TINT)
finalIrradiance*=clearcoatOut.absorption;
#endif
#endif
#if defined(SS_REFRACTION)
finalIrradiance*=subSurfaceOut.refractionFactorForIrradiance;
#endif
#if defined(SS_TRANSLUCENCY)
finalIrradiance*=(1.0-subSurfaceOut.translucencyIntensity);finalIrradiance+=subSurfaceOut.refractionIrradiance;
#endif
finalIrradiance*=surfaceAlbedo.rgb;finalIrradiance*=vLightingIntensity.z;finalIrradiance*=aoOut.ambientOcclusionColor;
#endif
#ifdef SPECULARTERM
vec3 finalSpecular=specularBase;finalSpecular=max(finalSpecular,0.0);vec3 finalSpecularScaled=finalSpecular*vLightingIntensity.x*vLightingIntensity.w;
#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)
finalSpecularScaled*=energyConservationFactor;
#endif
#if defined(SHEEN) && defined(ENVIRONMENTBRDF) && defined(SHEEN_ALBEDOSCALING)
finalSpecularScaled*=sheenOut.sheenAlbedoScaling;
#endif
#endif
#ifdef REFLECTION
vec3 finalRadiance=reflectionOut.environmentRadiance.rgb;finalRadiance*=subSurfaceOut.specularEnvironmentReflectance;vec3 finalRadianceScaled=finalRadiance*vLightingIntensity.z;
#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)
finalRadianceScaled*=energyConservationFactor;
#endif
#if defined(SHEEN) && defined(ENVIRONMENTBRDF) && defined(SHEEN_ALBEDOSCALING)
finalRadianceScaled*=sheenOut.sheenAlbedoScaling;
#endif
#endif
#ifdef SHEEN
vec3 finalSheen=sheenBase*sheenOut.sheenColor;finalSheen=max(finalSheen,0.0);vec3 finalSheenScaled=finalSheen*vLightingIntensity.x*vLightingIntensity.w;
#if defined(CLEARCOAT) && defined(REFLECTION) && defined(ENVIRONMENTBRDF)
sheenOut.finalSheenRadianceScaled*=clearcoatOut.conservationFactor;
#if defined(CLEARCOAT_TINT)
sheenOut.finalSheenRadianceScaled*=clearcoatOut.absorption;
#endif
#endif
#endif
#ifdef CLEARCOAT
vec3 finalClearCoat=clearCoatBase;finalClearCoat=max(finalClearCoat,0.0);vec3 finalClearCoatScaled=finalClearCoat*vLightingIntensity.x*vLightingIntensity.w;
#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)
finalClearCoatScaled*=clearcoatOut.energyConservationFactorClearCoat;
#endif
#ifdef SS_REFRACTION
subSurfaceOut.finalRefraction*=clearcoatOut.conservationFactor;
#ifdef CLEARCOAT_TINT
subSurfaceOut.finalRefraction*=clearcoatOut.absorption;
#endif
#endif
#endif
#ifdef ALPHABLEND
float luminanceOverAlpha=0.0;
#if defined(REFLECTION) && defined(RADIANCEOVERALPHA)
luminanceOverAlpha+=getLuminance(finalRadianceScaled);
#if defined(CLEARCOAT)
luminanceOverAlpha+=getLuminance(clearcoatOut.finalClearCoatRadianceScaled);
#endif
#endif
#if defined(SPECULARTERM) && defined(SPECULAROVERALPHA)
luminanceOverAlpha+=getLuminance(finalSpecularScaled);
#endif
#if defined(CLEARCOAT) && defined(CLEARCOATOVERALPHA)
luminanceOverAlpha+=getLuminance(finalClearCoatScaled);
#endif
#if defined(RADIANCEOVERALPHA) || defined(SPECULAROVERALPHA) || defined(CLEARCOATOVERALPHA)
alpha=saturate(alpha+luminanceOverAlpha*luminanceOverAlpha);
#endif
#endif
`;Y.IncludesShadersStore[aO]=lO;const hO="pbrBlockFinalUnlitComponents",cO=`vec3 finalDiffuse=diffuseBase;finalDiffuse*=surfaceAlbedo.rgb;finalDiffuse=max(finalDiffuse,0.0);finalDiffuse*=vLightingIntensity.x;vec3 finalAmbient=vAmbientColor;finalAmbient*=surfaceAlbedo.rgb;vec3 finalEmissive=vEmissiveColor;
#ifdef EMISSIVE
vec3 emissiveColorTex=texture2D(emissiveSampler,vEmissiveUV+uvOffset).rgb;
#ifdef GAMMAEMISSIVE
finalEmissive*=toLinearSpace(emissiveColorTex.rgb);
#else
finalEmissive*=emissiveColorTex.rgb;
#endif
finalEmissive*= vEmissiveInfos.y;
#endif
finalEmissive*=vLightingIntensity.y;
#ifdef AMBIENT
vec3 ambientOcclusionForDirectDiffuse=mix(vec3(1.),aoOut.ambientOcclusionColor,vAmbientInfos.w);
#else
vec3 ambientOcclusionForDirectDiffuse=aoOut.ambientOcclusionColor;
#endif
finalAmbient*=aoOut.ambientOcclusionColor;finalDiffuse*=ambientOcclusionForDirectDiffuse;
`;Y.IncludesShadersStore[hO]=cO;const uO="pbrBlockFinalColorComposition",dO=`vec4 finalColor=vec4(
#ifndef UNLIT
#ifdef REFLECTION
finalIrradiance +
#endif
#ifdef SPECULARTERM
finalSpecularScaled +
#endif
#ifdef SHEEN
finalSheenScaled +
#endif
#ifdef CLEARCOAT
finalClearCoatScaled +
#endif
#ifdef REFLECTION
finalRadianceScaled +
#if defined(SHEEN) && defined(ENVIRONMENTBRDF)
sheenOut.finalSheenRadianceScaled +
#endif
#ifdef CLEARCOAT
clearcoatOut.finalClearCoatRadianceScaled +
#endif
#endif
#ifdef SS_REFRACTION
subSurfaceOut.finalRefraction +
#endif
#endif
finalAmbient +
finalDiffuse,
alpha);
#ifdef LIGHTMAP
#ifndef LIGHTMAPEXCLUDED
#ifdef USELIGHTMAPASSHADOWMAP
finalColor.rgb*=lightmapColor.rgb;
#else
finalColor.rgb+=lightmapColor.rgb;
#endif
#endif
#endif
finalColor.rgb+=finalEmissive;
#define CUSTOM_FRAGMENT_BEFORE_FOG
finalColor=max(finalColor,0.0);
`;Y.IncludesShadersStore[uO]=dO;const fO="pbrBlockImageProcessing",pO=`#if defined(IMAGEPROCESSINGPOSTPROCESS) || defined(SS_SCATTERING)
#if !defined(SKIPFINALCOLORCLAMP)
finalColor.rgb=clamp(finalColor.rgb,0.,30.0);
#endif
#else
finalColor=applyImageProcessing(finalColor);
#endif
finalColor.a*=visibility;
#ifdef PREMULTIPLYALPHA
finalColor.rgb*=finalColor.a;
#endif
`;Y.IncludesShadersStore[fO]=pO;const gO="pbrDebug",mO=`#if DEBUGMODE>0
if (vClipSpacePosition.x/vClipSpacePosition.w>=vDebugMode.x) {
#if DEBUGMODE==1
gl_FragColor.rgb=vPositionW.rgb;
#define DEBUGMODE_NORMALIZE
#elif DEBUGMODE==2 && defined(NORMAL)
gl_FragColor.rgb=vNormalW.rgb;
#define DEBUGMODE_NORMALIZE
#elif DEBUGMODE==3 && defined(BUMP) || DEBUGMODE==3 && defined(PARALLAX) || DEBUGMODE==3 && defined(ANISOTROPIC)
gl_FragColor.rgb=TBN[0];
#define DEBUGMODE_NORMALIZE
#elif DEBUGMODE==4 && defined(BUMP) || DEBUGMODE==4 && defined(PARALLAX) || DEBUGMODE==4 && defined(ANISOTROPIC)
gl_FragColor.rgb=TBN[1];
#define DEBUGMODE_NORMALIZE
#elif DEBUGMODE==5
gl_FragColor.rgb=normalW;
#define DEBUGMODE_NORMALIZE
#elif DEBUGMODE==6 && defined(MAINUV1)
gl_FragColor.rgb=vec3(vMainUV1,0.0);
#elif DEBUGMODE==7 && defined(MAINUV2)
gl_FragColor.rgb=vec3(vMainUV2,0.0);
#elif DEBUGMODE==8 && defined(CLEARCOAT) && defined(CLEARCOAT_BUMP)
gl_FragColor.rgb=clearcoatOut.TBNClearCoat[0];
#define DEBUGMODE_NORMALIZE
#elif DEBUGMODE==9 && defined(CLEARCOAT) && defined(CLEARCOAT_BUMP)
gl_FragColor.rgb=clearcoatOut.TBNClearCoat[1];
#define DEBUGMODE_NORMALIZE
#elif DEBUGMODE==10 && defined(CLEARCOAT)
gl_FragColor.rgb=clearcoatOut.clearCoatNormalW;
#define DEBUGMODE_NORMALIZE
#elif DEBUGMODE==11 && defined(ANISOTROPIC)
gl_FragColor.rgb=anisotropicOut.anisotropicNormal;
#define DEBUGMODE_NORMALIZE
#elif DEBUGMODE==12 && defined(ANISOTROPIC)
gl_FragColor.rgb=anisotropicOut.anisotropicTangent;
#define DEBUGMODE_NORMALIZE
#elif DEBUGMODE==13 && defined(ANISOTROPIC)
gl_FragColor.rgb=anisotropicOut.anisotropicBitangent;
#define DEBUGMODE_NORMALIZE
#elif DEBUGMODE==20 && defined(ALBEDO)
gl_FragColor.rgb=albedoTexture.rgb;
#ifndef GAMMAALBEDO
#define DEBUGMODE_GAMMA
#endif
#elif DEBUGMODE==21 && defined(AMBIENT)
gl_FragColor.rgb=aoOut.ambientOcclusionColorMap.rgb;
#elif DEBUGMODE==22 && defined(OPACITY)
gl_FragColor.rgb=opacityMap.rgb;
#elif DEBUGMODE==23 && defined(EMISSIVE)
gl_FragColor.rgb=emissiveColorTex.rgb;
#ifndef GAMMAEMISSIVE
#define DEBUGMODE_GAMMA
#endif
#elif DEBUGMODE==24 && defined(LIGHTMAP)
gl_FragColor.rgb=lightmapColor.rgb;
#ifndef GAMMALIGHTMAP
#define DEBUGMODE_GAMMA
#endif
#elif DEBUGMODE==25 && defined(REFLECTIVITY) && defined(METALLICWORKFLOW)
gl_FragColor.rgb=reflectivityOut.surfaceMetallicColorMap.rgb;
#elif DEBUGMODE==26 && defined(REFLECTIVITY) && !defined(METALLICWORKFLOW)
gl_FragColor.rgb=reflectivityOut.surfaceReflectivityColorMap.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE==27 && defined(CLEARCOAT) && defined(CLEARCOAT_TEXTURE)
gl_FragColor.rgb=vec3(clearcoatOut.clearCoatMapData.rg,0.0);
#elif DEBUGMODE==28 && defined(CLEARCOAT) && defined(CLEARCOAT_TINT) && defined(CLEARCOAT_TINT_TEXTURE)
gl_FragColor.rgb=clearcoatOut.clearCoatTintMapData.rgb;
#elif DEBUGMODE==29 && defined(SHEEN) && defined(SHEEN_TEXTURE)
gl_FragColor.rgb=sheenOut.sheenMapData.rgb;
#elif DEBUGMODE==30 && defined(ANISOTROPIC) && defined(ANISOTROPIC_TEXTURE)
gl_FragColor.rgb=anisotropicOut.anisotropyMapData.rgb;
#elif DEBUGMODE==31 && defined(SUBSURFACE) && defined(SS_THICKNESSANDMASK_TEXTURE)
gl_FragColor.rgb=subSurfaceOut.thicknessMap.rgb;
#elif DEBUGMODE==32 && defined(BUMP)
gl_FragColor.rgb=texture2D(bumpSampler,vBumpUV).rgb;
#elif DEBUGMODE==40 && defined(SS_REFRACTION)
gl_FragColor.rgb=subSurfaceOut.environmentRefraction.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE==41 && defined(REFLECTION)
gl_FragColor.rgb=reflectionOut.environmentRadiance.rgb;
#ifndef GAMMAREFLECTION
#define DEBUGMODE_GAMMA
#endif
#elif DEBUGMODE==42 && defined(CLEARCOAT) && defined(REFLECTION)
gl_FragColor.rgb=clearcoatOut.environmentClearCoatRadiance.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE==50
gl_FragColor.rgb=diffuseBase.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE==51 && defined(SPECULARTERM)
gl_FragColor.rgb=specularBase.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE==52 && defined(CLEARCOAT)
gl_FragColor.rgb=clearCoatBase.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE==53 && defined(SHEEN)
gl_FragColor.rgb=sheenBase.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE==54 && defined(REFLECTION)
gl_FragColor.rgb=reflectionOut.environmentIrradiance.rgb;
#ifndef GAMMAREFLECTION
#define DEBUGMODE_GAMMA
#endif
#elif DEBUGMODE==60
gl_FragColor.rgb=surfaceAlbedo.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE==61
gl_FragColor.rgb=clearcoatOut.specularEnvironmentR0;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE==62 && defined(METALLICWORKFLOW)
gl_FragColor.rgb=vec3(reflectivityOut.metallicRoughness.r);
#elif DEBUGMODE==71 && defined(METALLICWORKFLOW)
gl_FragColor.rgb=reflectivityOut.metallicF0;
#elif DEBUGMODE==63
gl_FragColor.rgb=vec3(roughness);
#elif DEBUGMODE==64
gl_FragColor.rgb=vec3(alphaG);
#elif DEBUGMODE==65
gl_FragColor.rgb=vec3(NdotV);
#elif DEBUGMODE==66 && defined(CLEARCOAT) && defined(CLEARCOAT_TINT)
gl_FragColor.rgb=clearcoatOut.clearCoatColor.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE==67 && defined(CLEARCOAT)
gl_FragColor.rgb=vec3(clearcoatOut.clearCoatRoughness);
#elif DEBUGMODE==68 && defined(CLEARCOAT)
gl_FragColor.rgb=vec3(clearcoatOut.clearCoatNdotV);
#elif DEBUGMODE==69 && defined(SUBSURFACE) && defined(SS_TRANSLUCENCY)
gl_FragColor.rgb=subSurfaceOut.transmittance;
#elif DEBUGMODE==70 && defined(SUBSURFACE) && defined(SS_REFRACTION)
gl_FragColor.rgb=subSurfaceOut.refractionTransmittance;
#elif DEBUGMODE==72
gl_FragColor.rgb=vec3(microSurface);
#elif DEBUGMODE==73
gl_FragColor.rgb=vAlbedoColor.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE==74 && !defined(METALLICWORKFLOW)
gl_FragColor.rgb=vReflectivityColor.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE==75
gl_FragColor.rgb=vEmissiveColor.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE==80 && defined(RADIANCEOCCLUSION)
gl_FragColor.rgb=vec3(seo);
#elif DEBUGMODE==81 && defined(HORIZONOCCLUSION) && defined(BUMP) && defined(REFLECTIONMAP_3D)
gl_FragColor.rgb=vec3(eho);
#elif DEBUGMODE==82 && defined(MS_BRDF_ENERGY_CONSERVATION)
gl_FragColor.rgb=vec3(energyConservationFactor);
#elif DEBUGMODE==83 && defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)
gl_FragColor.rgb=specularEnvironmentReflectance;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE==84 && defined(CLEARCOAT) && defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)
gl_FragColor.rgb=clearcoatOut.clearCoatEnvironmentReflectance;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE==85 && defined(SHEEN) && defined(REFLECTION)
gl_FragColor.rgb=sheenOut.sheenEnvironmentReflectance;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE==86 && defined(ALPHABLEND)
gl_FragColor.rgb=vec3(luminanceOverAlpha);
#elif DEBUGMODE==87
gl_FragColor.rgb=vec3(alpha);
#elif DEBUGMODE==88 && defined(ALBEDO)
gl_FragColor.rgb=vec3(albedoTexture.a);
#else
float stripeWidth=30.;float stripePos=floor((gl_FragCoord.x+gl_FragCoord.y)/stripeWidth);float whichColor=mod(stripePos,2.);vec3 color1=vec3(.6,.2,.2);vec3 color2=vec3(.3,.1,.1);gl_FragColor.rgb=mix(color1,color2,whichColor);
#endif
gl_FragColor.rgb*=vDebugMode.y;
#ifdef DEBUGMODE_NORMALIZE
gl_FragColor.rgb=normalize(gl_FragColor.rgb)*0.5+0.5;
#endif
#ifdef DEBUGMODE_GAMMA
gl_FragColor.rgb=toGammaSpace(gl_FragColor.rgb);
#endif
gl_FragColor.a=1.0;
#ifdef PREPASS
gl_FragData[0]=toLinearSpace(gl_FragColor); 
gl_FragData[1]=vec4(0.,0.,0.,0.); 
#endif
#ifdef DEBUGMODE_FORCERETURN
return;
#endif
}
#endif
`;Y.IncludesShadersStore[gO]=mO;const _O="pbrPixelShader",vO=`#if defined(BUMP) || !defined(NORMAL) || defined(FORCENORMALFORWARD) || defined(SPECULARAA) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC)
#extension GL_OES_standard_derivatives : enable
#endif
#ifdef LODBASEDMICROSFURACE
#extension GL_EXT_shader_texture_lod : enable
#endif
#define CUSTOM_FRAGMENT_BEGIN
#ifdef LOGARITHMICDEPTH
#extension GL_EXT_frag_depth : enable
#endif
#include<prePassDeclaration>[SCENE_MRT_COUNT]
precision highp float;
#include<oitDeclaration>
#ifndef FROMLINEARSPACE
#define FROMLINEARSPACE
#endif
#include<__decl__pbrFragment>
#include<pbrFragmentExtraDeclaration>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
#include<pbrFragmentSamplersDeclaration>
#include<imageProcessingDeclaration>
#include<clipPlaneFragmentDeclaration>
#include<logDepthDeclaration>
#include<fogFragmentDeclaration>
#include<helperFunctions>
#include<subSurfaceScatteringFunctions>
#include<importanceSampling>
#include<pbrHelperFunctions>
#include<imageProcessingFunctions>
#include<shadowsFragmentFunctions>
#include<harmonicsFunctions>
#include<pbrDirectLightingSetupFunctions>
#include<pbrDirectLightingFalloffFunctions>
#include<pbrBRDFFunctions>
#include<hdrFilteringFunctions>
#include<pbrDirectLightingFunctions>
#include<pbrIBLFunctions>
#include<bumpFragmentMainFunctions>
#include<bumpFragmentFunctions>
#ifdef REFLECTION
#include<reflectionFunction>
#endif
#define CUSTOM_FRAGMENT_DEFINITIONS
#include<pbrBlockAlbedoOpacity>
#include<pbrBlockReflectivity>
#include<pbrBlockAmbientOcclusion>
#include<pbrBlockAlphaFresnel>
#include<pbrBlockAnisotropic>
#include<pbrBlockReflection>
#include<pbrBlockSheen>
#include<pbrBlockClearcoat>
#include<pbrBlockIridescence>
#include<pbrBlockSubSurface>
void main(void) {
#define CUSTOM_FRAGMENT_MAIN_BEGIN
#include<clipPlaneFragment>
#include<pbrBlockNormalGeometric>
#include<bumpFragment>
#include<pbrBlockNormalFinal>
albedoOpacityOutParams albedoOpacityOut;
#ifdef ALBEDO
vec4 albedoTexture=texture2D(albedoSampler,vAlbedoUV+uvOffset);
#endif
#ifdef OPACITY
vec4 opacityMap=texture2D(opacitySampler,vOpacityUV+uvOffset);
#endif
#ifdef DECAL
vec4 decalColor=texture2D(decalSampler,vDecalUV+uvOffset);
#endif
albedoOpacityBlock(
vAlbedoColor,
#ifdef ALBEDO
albedoTexture,
vAlbedoInfos,
#endif
#ifdef OPACITY
opacityMap,
vOpacityInfos,
#endif
#ifdef DETAIL
detailColor,
vDetailInfos,
#endif
#ifdef DECAL
decalColor,
vDecalInfos,
#endif
albedoOpacityOut
);vec3 surfaceAlbedo=albedoOpacityOut.surfaceAlbedo;float alpha=albedoOpacityOut.alpha;
#define CUSTOM_FRAGMENT_UPDATE_ALPHA
#include<depthPrePass>
#define CUSTOM_FRAGMENT_BEFORE_LIGHTS
ambientOcclusionOutParams aoOut;
#ifdef AMBIENT
vec3 ambientOcclusionColorMap=texture2D(ambientSampler,vAmbientUV+uvOffset).rgb;
#endif
ambientOcclusionBlock(
#ifdef AMBIENT
ambientOcclusionColorMap,
vAmbientInfos,
#endif
aoOut
);
#include<pbrBlockLightmapInit>
#ifdef UNLIT
vec3 diffuseBase=vec3(1.,1.,1.);
#else
vec3 baseColor=surfaceAlbedo;reflectivityOutParams reflectivityOut;
#if defined(REFLECTIVITY)
vec4 surfaceMetallicOrReflectivityColorMap=texture2D(reflectivitySampler,vReflectivityUV+uvOffset);vec4 baseReflectivity=surfaceMetallicOrReflectivityColorMap;
#ifndef METALLICWORKFLOW
#ifdef REFLECTIVITY_GAMMA
surfaceMetallicOrReflectivityColorMap=toLinearSpace(surfaceMetallicOrReflectivityColorMap);
#endif
surfaceMetallicOrReflectivityColorMap.rgb*=vReflectivityInfos.y;
#endif
#endif
#if defined(MICROSURFACEMAP)
vec4 microSurfaceTexel=texture2D(microSurfaceSampler,vMicroSurfaceSamplerUV+uvOffset)*vMicroSurfaceSamplerInfos.y;
#endif
#ifdef METALLICWORKFLOW
vec4 metallicReflectanceFactors=vMetallicReflectanceFactors;
#ifdef REFLECTANCE
vec4 reflectanceFactorsMap=texture2D(reflectanceSampler,vReflectanceUV+uvOffset);
#ifdef REFLECTANCE_GAMMA
reflectanceFactorsMap=toLinearSpace(reflectanceFactorsMap);
#endif
metallicReflectanceFactors.rgb*=reflectanceFactorsMap.rgb;
#endif
#ifdef METALLIC_REFLECTANCE
vec4 metallicReflectanceFactorsMap=texture2D(metallicReflectanceSampler,vMetallicReflectanceUV+uvOffset);
#ifdef METALLIC_REFLECTANCE_GAMMA
metallicReflectanceFactorsMap=toLinearSpace(metallicReflectanceFactorsMap);
#endif
#ifndef METALLIC_REFLECTANCE_USE_ALPHA_ONLY
metallicReflectanceFactors.rgb*=metallicReflectanceFactorsMap.rgb;
#endif
metallicReflectanceFactors*=metallicReflectanceFactorsMap.a;
#endif
#endif
reflectivityBlock(
vReflectivityColor,
#ifdef METALLICWORKFLOW
surfaceAlbedo,
metallicReflectanceFactors,
#endif
#ifdef REFLECTIVITY
vReflectivityInfos,
surfaceMetallicOrReflectivityColorMap,
#endif
#if defined(METALLICWORKFLOW) && defined(REFLECTIVITY) && defined(AOSTOREINMETALMAPRED)
aoOut.ambientOcclusionColor,
#endif
#ifdef MICROSURFACEMAP
microSurfaceTexel,
#endif
#ifdef DETAIL
detailColor,
vDetailInfos,
#endif
reflectivityOut
);float microSurface=reflectivityOut.microSurface;float roughness=reflectivityOut.roughness;
#ifdef METALLICWORKFLOW
surfaceAlbedo=reflectivityOut.surfaceAlbedo;
#endif
#if defined(METALLICWORKFLOW) && defined(REFLECTIVITY) && defined(AOSTOREINMETALMAPRED)
aoOut.ambientOcclusionColor=reflectivityOut.ambientOcclusionColor;
#endif
#ifdef ALPHAFRESNEL
#if defined(ALPHATEST) || defined(ALPHABLEND)
alphaFresnelOutParams alphaFresnelOut;alphaFresnelBlock(
normalW,
viewDirectionW,
alpha,
microSurface,
alphaFresnelOut
);alpha=alphaFresnelOut.alpha;
#endif
#endif
#include<pbrBlockGeometryInfo>
#ifdef ANISOTROPIC
anisotropicOutParams anisotropicOut;
#ifdef ANISOTROPIC_TEXTURE
vec3 anisotropyMapData=texture2D(anisotropySampler,vAnisotropyUV+uvOffset).rgb*vAnisotropyInfos.y;
#endif
anisotropicBlock(
vAnisotropy,
roughness,
#ifdef ANISOTROPIC_TEXTURE
anisotropyMapData,
#endif
TBN,
normalW,
viewDirectionW,
anisotropicOut
);
#endif
#ifdef REFLECTION
reflectionOutParams reflectionOut;
#ifndef USE_CUSTOM_REFLECTION
reflectionBlock(
vPositionW,
normalW,
alphaG,
vReflectionMicrosurfaceInfos,
vReflectionInfos,
vReflectionColor,
#ifdef ANISOTROPIC
anisotropicOut,
#endif
#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)
NdotVUnclamped,
#endif
#ifdef LINEARSPECULARREFLECTION
roughness,
#endif
reflectionSampler,
#if defined(NORMAL) && defined(USESPHERICALINVERTEX)
vEnvironmentIrradiance,
#endif
#ifdef USESPHERICALFROMREFLECTIONMAP
#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)
reflectionMatrix,
#endif
#endif
#ifdef USEIRRADIANCEMAP
irradianceSampler,
#endif
#ifndef LODBASEDMICROSFURACE
reflectionSamplerLow,
reflectionSamplerHigh,
#endif
#ifdef REALTIME_FILTERING
vReflectionFilteringInfo,
#endif
reflectionOut
);
#else
#define CUSTOM_REFLECTION
#endif
#endif
#include<pbrBlockReflectance0>
#ifdef SHEEN
sheenOutParams sheenOut;
#ifdef SHEEN_TEXTURE
vec4 sheenMapData=texture2D(sheenSampler,vSheenUV+uvOffset);
#endif
#if defined(SHEEN_ROUGHNESS) && defined(SHEEN_TEXTURE_ROUGHNESS) && !defined(SHEEN_TEXTURE_ROUGHNESS_IDENTICAL) && !defined(SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE)
vec4 sheenMapRoughnessData=texture2D(sheenRoughnessSampler,vSheenRoughnessUV+uvOffset)*vSheenInfos.w;
#endif
sheenBlock(
vSheenColor,
#ifdef SHEEN_ROUGHNESS
vSheenRoughness,
#if defined(SHEEN_TEXTURE_ROUGHNESS) && !defined(SHEEN_TEXTURE_ROUGHNESS_IDENTICAL) && !defined(SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE)
sheenMapRoughnessData,
#endif
#endif
roughness,
#ifdef SHEEN_TEXTURE
sheenMapData,
vSheenInfos.y,
#endif
reflectance,
#ifdef SHEEN_LINKWITHALBEDO
baseColor,
surfaceAlbedo,
#endif
#ifdef ENVIRONMENTBRDF
NdotV,
environmentBrdf,
#endif
#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)
AARoughnessFactors,
vReflectionMicrosurfaceInfos,
vReflectionInfos,
vReflectionColor,
vLightingIntensity,
reflectionSampler,
reflectionOut.reflectionCoords,
NdotVUnclamped,
#ifndef LODBASEDMICROSFURACE
reflectionSamplerLow,
reflectionSamplerHigh,
#endif
#ifdef REALTIME_FILTERING
vReflectionFilteringInfo,
#endif
#if !defined(REFLECTIONMAP_SKYBOX) && defined(RADIANCEOCCLUSION)
seo,
#endif
#if !defined(REFLECTIONMAP_SKYBOX) && defined(HORIZONOCCLUSION) && defined(BUMP) && defined(REFLECTIONMAP_3D)
eho,
#endif
#endif
sheenOut
);
#ifdef SHEEN_LINKWITHALBEDO
surfaceAlbedo=sheenOut.surfaceAlbedo;
#endif
#endif
#ifdef CLEARCOAT
#ifdef CLEARCOAT_TEXTURE
vec2 clearCoatMapData=texture2D(clearCoatSampler,vClearCoatUV+uvOffset).rg*vClearCoatInfos.y;
#endif
#endif
#ifdef IRIDESCENCE
iridescenceOutParams iridescenceOut;
#ifdef IRIDESCENCE_TEXTURE
vec2 iridescenceMapData=texture2D(iridescenceSampler,vIridescenceUV+uvOffset).rg*vIridescenceInfos.y;
#endif
#ifdef IRIDESCENCE_THICKNESS_TEXTURE
vec2 iridescenceThicknessMapData=texture2D(iridescenceThicknessSampler,vIridescenceThicknessUV+uvOffset).rg*vIridescenceInfos.w;
#endif
iridescenceBlock(
vIridescenceParams,
NdotV,
specularEnvironmentR0,
#ifdef IRIDESCENCE_TEXTURE
iridescenceMapData,
#endif
#ifdef IRIDESCENCE_THICKNESS_TEXTURE
iridescenceThicknessMapData,
#endif
#ifdef CLEARCOAT
NdotVUnclamped,
#ifdef CLEARCOAT_TEXTURE
clearCoatMapData,
#endif
#endif
iridescenceOut
);float iridescenceIntensity=iridescenceOut.iridescenceIntensity;specularEnvironmentR0=iridescenceOut.specularEnvironmentR0;
#endif
clearcoatOutParams clearcoatOut;
#ifdef CLEARCOAT
#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL) && !defined(CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE)
vec4 clearCoatMapRoughnessData=texture2D(clearCoatRoughnessSampler,vClearCoatRoughnessUV+uvOffset)*vClearCoatInfos.w;
#endif
#if defined(CLEARCOAT_TINT) && defined(CLEARCOAT_TINT_TEXTURE)
vec4 clearCoatTintMapData=texture2D(clearCoatTintSampler,vClearCoatTintUV+uvOffset);
#endif
#ifdef CLEARCOAT_BUMP
vec4 clearCoatBumpMapData=texture2D(clearCoatBumpSampler,vClearCoatBumpUV+uvOffset);
#endif
clearcoatBlock(
vPositionW,
geometricNormalW,
viewDirectionW,
vClearCoatParams,
#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL) && !defined(CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE)
clearCoatMapRoughnessData,
#endif
specularEnvironmentR0,
#ifdef CLEARCOAT_TEXTURE
clearCoatMapData,
#endif
#ifdef CLEARCOAT_TINT
vClearCoatTintParams,
clearCoatColorAtDistance,
vClearCoatRefractionParams,
#ifdef CLEARCOAT_TINT_TEXTURE
clearCoatTintMapData,
#endif
#endif
#ifdef CLEARCOAT_BUMP
vClearCoatBumpInfos,
clearCoatBumpMapData,
vClearCoatBumpUV,
#if defined(TANGENT) && defined(NORMAL)
vTBN,
#else
vClearCoatTangentSpaceParams,
#endif
#ifdef OBJECTSPACE_NORMALMAP
normalMatrix,
#endif
#endif
#if defined(FORCENORMALFORWARD) && defined(NORMAL)
faceNormal,
#endif
#ifdef REFLECTION
vReflectionMicrosurfaceInfos,
vReflectionInfos,
vReflectionColor,
vLightingIntensity,
reflectionSampler,
#ifndef LODBASEDMICROSFURACE
reflectionSamplerLow,
reflectionSamplerHigh,
#endif
#ifdef REALTIME_FILTERING
vReflectionFilteringInfo,
#endif
#endif
#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)
#ifdef RADIANCEOCCLUSION
ambientMonochrome,
#endif
#endif
#if defined(CLEARCOAT_BUMP) || defined(TWOSIDEDLIGHTING)
(gl_FrontFacing ? 1. : -1.),
#endif
clearcoatOut
);
#else
clearcoatOut.specularEnvironmentR0=specularEnvironmentR0;
#endif
#include<pbrBlockReflectance>
subSurfaceOutParams subSurfaceOut;
#ifdef SUBSURFACE
#ifdef SS_THICKNESSANDMASK_TEXTURE
vec4 thicknessMap=texture2D(thicknessSampler,vThicknessUV+uvOffset);
#endif
#ifdef SS_REFRACTIONINTENSITY_TEXTURE
vec4 refractionIntensityMap=texture2D(refractionIntensitySampler,vRefractionIntensityUV+uvOffset);
#endif
#ifdef SS_TRANSLUCENCYINTENSITY_TEXTURE
vec4 translucencyIntensityMap=texture2D(translucencyIntensitySampler,vTranslucencyIntensityUV+uvOffset);
#endif
subSurfaceBlock(
vSubSurfaceIntensity,
vThicknessParam,
vTintColor,
normalW,
specularEnvironmentReflectance,
#ifdef SS_THICKNESSANDMASK_TEXTURE
thicknessMap,
#endif
#ifdef SS_REFRACTIONINTENSITY_TEXTURE
refractionIntensityMap,
#endif
#ifdef SS_TRANSLUCENCYINTENSITY_TEXTURE
translucencyIntensityMap,
#endif
#ifdef REFLECTION
#ifdef SS_TRANSLUCENCY
reflectionMatrix,
#ifdef USESPHERICALFROMREFLECTIONMAP
#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)
reflectionOut.irradianceVector,
#endif
#if defined(REALTIME_FILTERING)
reflectionSampler,
vReflectionFilteringInfo,
#endif
#endif
#ifdef USEIRRADIANCEMAP
irradianceSampler,
#endif
#endif
#endif
#if defined(SS_REFRACTION) || defined(SS_TRANSLUCENCY)
surfaceAlbedo,
#endif
#ifdef SS_REFRACTION
vPositionW,
viewDirectionW,
view,
vRefractionInfos,
refractionMatrix,
vRefractionMicrosurfaceInfos,
vLightingIntensity,
#ifdef SS_LINKREFRACTIONTOTRANSPARENCY
alpha,
#endif
#ifdef SS_LODINREFRACTIONALPHA
NdotVUnclamped,
#endif
#ifdef SS_LINEARSPECULARREFRACTION
roughness,
#endif
alphaG,
refractionSampler,
#ifndef LODBASEDMICROSFURACE
refractionSamplerLow,
refractionSamplerHigh,
#endif
#ifdef ANISOTROPIC
anisotropicOut,
#endif
#ifdef REALTIME_FILTERING
vRefractionFilteringInfo,
#endif
#ifdef SS_USE_LOCAL_REFRACTIONMAP_CUBIC
vRefractionPosition,
vRefractionSize,
#endif
#ifdef SS_DISPERSION
dispersion,
#endif
#endif
#ifdef SS_TRANSLUCENCY
vDiffusionDistance,
#endif
subSurfaceOut
);
#ifdef SS_REFRACTION
surfaceAlbedo=subSurfaceOut.surfaceAlbedo;
#ifdef SS_LINKREFRACTIONTOTRANSPARENCY
alpha=subSurfaceOut.alpha;
#endif
#endif
#else
subSurfaceOut.specularEnvironmentReflectance=specularEnvironmentReflectance;
#endif
#include<pbrBlockDirectLighting>
#include<lightFragment>[0..maxSimultaneousLights]
#include<pbrBlockFinalLitComponents>
#endif 
#include<pbrBlockFinalUnlitComponents>
#define CUSTOM_FRAGMENT_BEFORE_FINALCOLORCOMPOSITION
#include<pbrBlockFinalColorComposition>
#include<logDepthFragment>
#include<fogFragment>(color,finalColor)
#include<pbrBlockImageProcessing>
#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR
#ifdef PREPASS
float writeGeometryInfo=finalColor.a>0.4 ? 1.0 : 0.0;
#ifdef PREPASS_POSITION
gl_FragData[PREPASS_POSITION_INDEX]=vec4(vPositionW,writeGeometryInfo);
#endif
#ifdef PREPASS_VELOCITY
vec2 a=(vCurrentPosition.xy/vCurrentPosition.w)*0.5+0.5;vec2 b=(vPreviousPosition.xy/vPreviousPosition.w)*0.5+0.5;vec2 velocity=abs(a-b);velocity=vec2(pow(velocity.x,1.0/3.0),pow(velocity.y,1.0/3.0))*sign(a-b)*0.5+0.5;gl_FragData[PREPASS_VELOCITY_INDEX]=vec4(velocity,0.0,writeGeometryInfo);
#endif
#ifdef PREPASS_ALBEDO_SQRT
vec3 sqAlbedo=sqrt(surfaceAlbedo); 
#endif
#ifdef PREPASS_IRRADIANCE
vec3 irradiance=finalDiffuse;
#ifndef UNLIT
#ifdef REFLECTION
irradiance+=finalIrradiance;
#endif
#endif
#ifdef SS_SCATTERING
gl_FragData[0]=vec4(finalColor.rgb-irradiance,finalColor.a); 
irradiance/=sqAlbedo;
#else
gl_FragData[0]=finalColor; 
float scatteringDiffusionProfile=255.;
#endif
gl_FragData[PREPASS_IRRADIANCE_INDEX]=vec4(clamp(irradiance,vec3(0.),vec3(1.)),writeGeometryInfo*scatteringDiffusionProfile/255.); 
#else
gl_FragData[0]=vec4(finalColor.rgb,finalColor.a);
#endif
#ifdef PREPASS_DEPTH
gl_FragData[PREPASS_DEPTH_INDEX]=vec4(vViewPos.z,0.0,0.0,writeGeometryInfo); 
#endif
#ifdef PREPASS_NORMAL
#ifdef PREPASS_NORMAL_WORLDSPACE
gl_FragData[PREPASS_NORMAL_INDEX]=vec4(normalW,writeGeometryInfo); 
#else
gl_FragData[PREPASS_NORMAL_INDEX]=vec4(normalize((view*vec4(normalW,0.0)).rgb),writeGeometryInfo); 
#endif
#endif
#ifdef PREPASS_ALBEDO_SQRT
gl_FragData[PREPASS_ALBEDO_SQRT_INDEX]=vec4(sqAlbedo,writeGeometryInfo); 
#endif
#ifdef PREPASS_REFLECTIVITY
#ifndef UNLIT
gl_FragData[PREPASS_REFLECTIVITY_INDEX]=vec4(specularEnvironmentR0,microSurface)*writeGeometryInfo;
#else
gl_FragData[PREPASS_REFLECTIVITY_INDEX]=vec4( 0.0,0.0,0.0,1.0 )*writeGeometryInfo;
#endif
#endif
#endif
#if !defined(PREPASS) || defined(WEBGL2)
gl_FragColor=finalColor;
#endif
#include<oitFragment>
#if ORDER_INDEPENDENT_TRANSPARENCY
if (fragDepth==nearestDepth) {frontColor.rgb+=finalColor.rgb*finalColor.a*alphaMultiplier;frontColor.a=1.0-alphaMultiplier*(1.0-finalColor.a);} else {backColor+=finalColor;}
#endif
#include<pbrDebug>
#define CUSTOM_FRAGMENT_MAIN_END
}
`;Y.ShadersStore[_O]=vO;const EO="pbrVertexDeclaration",TO=`uniform mat4 view;uniform mat4 viewProjection;
#ifdef ALBEDO
uniform mat4 albedoMatrix;uniform vec2 vAlbedoInfos;
#endif
#ifdef AMBIENT
uniform mat4 ambientMatrix;uniform vec4 vAmbientInfos;
#endif
#ifdef OPACITY
uniform mat4 opacityMatrix;uniform vec2 vOpacityInfos;
#endif
#ifdef EMISSIVE
uniform vec2 vEmissiveInfos;uniform mat4 emissiveMatrix;
#endif
#ifdef LIGHTMAP
uniform vec2 vLightmapInfos;uniform mat4 lightmapMatrix;
#endif
#ifdef REFLECTIVITY 
uniform vec3 vReflectivityInfos;uniform mat4 reflectivityMatrix;
#endif
#ifdef METALLIC_REFLECTANCE
uniform vec2 vMetallicReflectanceInfos;uniform mat4 metallicReflectanceMatrix;
#endif
#ifdef REFLECTANCE
uniform vec2 vReflectanceInfos;uniform mat4 reflectanceMatrix;
#endif
#ifdef MICROSURFACEMAP
uniform vec2 vMicroSurfaceSamplerInfos;uniform mat4 microSurfaceSamplerMatrix;
#endif
#ifdef BUMP
uniform vec3 vBumpInfos;uniform mat4 bumpMatrix;
#endif
#ifdef POINTSIZE
uniform float pointSize;
#endif
#ifdef REFLECTION
uniform vec2 vReflectionInfos;uniform mat4 reflectionMatrix;
#endif
#ifdef CLEARCOAT
#if defined(CLEARCOAT_TEXTURE) || defined(CLEARCOAT_TEXTURE_ROUGHNESS)
uniform vec4 vClearCoatInfos;
#endif
#ifdef CLEARCOAT_TEXTURE
uniform mat4 clearCoatMatrix;
#endif
#ifdef CLEARCOAT_TEXTURE_ROUGHNESS
uniform mat4 clearCoatRoughnessMatrix;
#endif
#ifdef CLEARCOAT_BUMP
uniform vec2 vClearCoatBumpInfos;uniform mat4 clearCoatBumpMatrix;
#endif
#ifdef CLEARCOAT_TINT_TEXTURE
uniform vec2 vClearCoatTintInfos;uniform mat4 clearCoatTintMatrix;
#endif
#endif
#ifdef IRIDESCENCE
#if defined(IRIDESCENCE_TEXTURE) || defined(IRIDESCENCE_THICKNESS_TEXTURE)
uniform vec4 vIridescenceInfos;
#endif
#ifdef IRIDESCENCE_TEXTURE
uniform mat4 iridescenceMatrix;
#endif
#ifdef IRIDESCENCE_THICKNESS_TEXTURE
uniform mat4 iridescenceThicknessMatrix;
#endif
#endif
#ifdef ANISOTROPIC
#ifdef ANISOTROPIC_TEXTURE
uniform vec2 vAnisotropyInfos;uniform mat4 anisotropyMatrix;
#endif
#endif
#ifdef SHEEN
#if defined(SHEEN_TEXTURE) || defined(SHEEN_TEXTURE_ROUGHNESS)
uniform vec4 vSheenInfos;
#endif
#ifdef SHEEN_TEXTURE
uniform mat4 sheenMatrix;
#endif
#ifdef SHEEN_TEXTURE_ROUGHNESS
uniform mat4 sheenRoughnessMatrix;
#endif
#endif
#ifdef SUBSURFACE
#ifdef SS_REFRACTION
uniform vec4 vRefractionInfos;uniform mat4 refractionMatrix;
#endif
#ifdef SS_THICKNESSANDMASK_TEXTURE
uniform vec2 vThicknessInfos;uniform mat4 thicknessMatrix;
#endif
#ifdef SS_REFRACTIONINTENSITY_TEXTURE
uniform vec2 vRefractionIntensityInfos;uniform mat4 refractionIntensityMatrix;
#endif
#ifdef SS_TRANSLUCENCYINTENSITY_TEXTURE
uniform vec2 vTranslucencyIntensityInfos;uniform mat4 translucencyIntensityMatrix;
#endif
#endif
#ifdef NORMAL
#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)
#ifdef USESPHERICALFROMREFLECTIONMAP
#ifdef SPHERICAL_HARMONICS
uniform vec3 vSphericalL00;uniform vec3 vSphericalL1_1;uniform vec3 vSphericalL10;uniform vec3 vSphericalL11;uniform vec3 vSphericalL2_2;uniform vec3 vSphericalL2_1;uniform vec3 vSphericalL20;uniform vec3 vSphericalL21;uniform vec3 vSphericalL22;
#else
uniform vec3 vSphericalX;uniform vec3 vSphericalY;uniform vec3 vSphericalZ;uniform vec3 vSphericalXX_ZZ;uniform vec3 vSphericalYY_ZZ;uniform vec3 vSphericalZZ;uniform vec3 vSphericalXY;uniform vec3 vSphericalYZ;uniform vec3 vSphericalZX;
#endif
#endif
#endif
#endif
#ifdef DETAIL
uniform vec4 vDetailInfos;uniform mat4 detailMatrix;
#endif
#include<decalVertexDeclaration>
#define ADDITIONAL_VERTEX_DECLARATION
`;Y.IncludesShadersStore[EO]=TO;const xO="pbrVertexShader",CO=`precision highp float;
#include<__decl__pbrVertex>
#define CUSTOM_VERTEX_BEGIN
attribute vec3 position;
#ifdef NORMAL
attribute vec3 normal;
#endif
#ifdef TANGENT
attribute vec4 tangent;
#endif
#ifdef UV1
attribute vec2 uv;
#endif
#include<uvAttributeDeclaration>[2..7]
#include<mainUVVaryingDeclaration>[1..7]
#ifdef VERTEXCOLOR
attribute vec4 color;
#endif
#include<helperFunctions>
#include<bonesDeclaration>
#include<bakedVertexAnimationDeclaration>
#include<instancesDeclaration>
#include<prePassVertexDeclaration>
#include<samplerVertexDeclaration>(_DEFINENAME_,ALBEDO,_VARYINGNAME_,Albedo)
#include<samplerVertexDeclaration>(_DEFINENAME_,DETAIL,_VARYINGNAME_,Detail)
#include<samplerVertexDeclaration>(_DEFINENAME_,AMBIENT,_VARYINGNAME_,Ambient)
#include<samplerVertexDeclaration>(_DEFINENAME_,OPACITY,_VARYINGNAME_,Opacity)
#include<samplerVertexDeclaration>(_DEFINENAME_,EMISSIVE,_VARYINGNAME_,Emissive)
#include<samplerVertexDeclaration>(_DEFINENAME_,LIGHTMAP,_VARYINGNAME_,Lightmap)
#include<samplerVertexDeclaration>(_DEFINENAME_,REFLECTIVITY,_VARYINGNAME_,Reflectivity)
#include<samplerVertexDeclaration>(_DEFINENAME_,MICROSURFACEMAP,_VARYINGNAME_,MicroSurfaceSampler)
#include<samplerVertexDeclaration>(_DEFINENAME_,METALLIC_REFLECTANCE,_VARYINGNAME_,MetallicReflectance)
#include<samplerVertexDeclaration>(_DEFINENAME_,REFLECTANCE,_VARYINGNAME_,Reflectance)
#include<samplerVertexDeclaration>(_DEFINENAME_,BUMP,_VARYINGNAME_,Bump)
#include<samplerVertexDeclaration>(_DEFINENAME_,DECAL,_VARYINGNAME_,Decal)
#ifdef CLEARCOAT
#include<samplerVertexDeclaration>(_DEFINENAME_,CLEARCOAT_TEXTURE,_VARYINGNAME_,ClearCoat)
#include<samplerVertexDeclaration>(_DEFINENAME_,CLEARCOAT_TEXTURE_ROUGHNESS,_VARYINGNAME_,ClearCoatRoughness)
#include<samplerVertexDeclaration>(_DEFINENAME_,CLEARCOAT_BUMP,_VARYINGNAME_,ClearCoatBump)
#include<samplerVertexDeclaration>(_DEFINENAME_,CLEARCOAT_TINT_TEXTURE,_VARYINGNAME_,ClearCoatTint)
#endif
#ifdef IRIDESCENCE
#include<samplerVertexDeclaration>(_DEFINENAME_,IRIDESCENCE_TEXTURE,_VARYINGNAME_,Iridescence)
#include<samplerVertexDeclaration>(_DEFINENAME_,IRIDESCENCE_THICKNESS_TEXTURE,_VARYINGNAME_,IridescenceThickness)
#endif
#ifdef SHEEN
#include<samplerVertexDeclaration>(_DEFINENAME_,SHEEN_TEXTURE,_VARYINGNAME_,Sheen)
#include<samplerVertexDeclaration>(_DEFINENAME_,SHEEN_TEXTURE_ROUGHNESS,_VARYINGNAME_,SheenRoughness)
#endif
#ifdef ANISOTROPIC
#include<samplerVertexDeclaration>(_DEFINENAME_,ANISOTROPIC_TEXTURE,_VARYINGNAME_,Anisotropy)
#endif
#ifdef SUBSURFACE
#include<samplerVertexDeclaration>(_DEFINENAME_,SS_THICKNESSANDMASK_TEXTURE,_VARYINGNAME_,Thickness)
#include<samplerVertexDeclaration>(_DEFINENAME_,SS_REFRACTIONINTENSITY_TEXTURE,_VARYINGNAME_,RefractionIntensity)
#include<samplerVertexDeclaration>(_DEFINENAME_,SS_TRANSLUCENCYINTENSITY_TEXTURE,_VARYINGNAME_,TranslucencyIntensity)
#endif
varying vec3 vPositionW;
#if DEBUGMODE>0
varying vec4 vClipSpacePosition;
#endif
#ifdef NORMAL
varying vec3 vNormalW;
#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)
varying vec3 vEnvironmentIrradiance;
#include<harmonicsFunctions>
#endif
#endif
#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)
varying vec4 vColor;
#endif
#include<bumpVertexDeclaration>
#include<clipPlaneVertexDeclaration>
#include<fogVertexDeclaration>
#include<__decl__lightVxFragment>[0..maxSimultaneousLights]
#include<morphTargetsVertexGlobalDeclaration>
#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]
#ifdef REFLECTIONMAP_SKYBOX
varying vec3 vPositionUVW;
#endif
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
varying vec3 vDirectionW;
#endif
#include<logDepthDeclaration>
#define CUSTOM_VERTEX_DEFINITIONS
void main(void) {
#define CUSTOM_VERTEX_MAIN_BEGIN
vec3 positionUpdated=position;
#ifdef NORMAL
vec3 normalUpdated=normal;
#endif
#ifdef TANGENT
vec4 tangentUpdated=tangent;
#endif
#ifdef UV1
vec2 uvUpdated=uv;
#endif
#include<morphTargetsVertexGlobal>
#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]
#ifdef REFLECTIONMAP_SKYBOX
vPositionUVW=positionUpdated;
#endif
#define CUSTOM_VERTEX_UPDATE_POSITION
#define CUSTOM_VERTEX_UPDATE_NORMAL
#include<instancesVertex>
#if defined(PREPASS) && defined(PREPASS_VELOCITY) && !defined(BONES_VELOCITY_ENABLED)
vCurrentPosition=viewProjection*finalWorld*vec4(positionUpdated,1.0);vPreviousPosition=previousViewProjection*finalPreviousWorld*vec4(positionUpdated,1.0);
#endif
#include<bonesVertex>
#include<bakedVertexAnimation>
vec4 worldPos=finalWorld*vec4(positionUpdated,1.0);vPositionW=vec3(worldPos);
#include<prePassVertex>
#ifdef NORMAL
mat3 normalWorld=mat3(finalWorld);
#if defined(INSTANCES) && defined(THIN_INSTANCES)
vNormalW=normalUpdated/vec3(dot(normalWorld[0],normalWorld[0]),dot(normalWorld[1],normalWorld[1]),dot(normalWorld[2],normalWorld[2]));vNormalW=normalize(normalWorld*vNormalW);
#else
#ifdef NONUNIFORMSCALING
normalWorld=transposeMat3(inverseMat3(normalWorld));
#endif
vNormalW=normalize(normalWorld*normalUpdated);
#endif
#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)
vec3 reflectionVector=vec3(reflectionMatrix*vec4(vNormalW,0)).xyz;
#ifdef REFLECTIONMAP_OPPOSITEZ
reflectionVector.z*=-1.0;
#endif
vEnvironmentIrradiance=computeEnvironmentIrradiance(reflectionVector);
#endif
#endif
#define CUSTOM_VERTEX_UPDATE_WORLDPOS
#ifdef MULTIVIEW
if (gl_ViewID_OVR==0u) {gl_Position=viewProjection*worldPos;} else {gl_Position=viewProjectionR*worldPos;}
#else
gl_Position=viewProjection*worldPos;
#endif
#if DEBUGMODE>0
vClipSpacePosition=gl_Position;
#endif
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
vDirectionW=normalize(vec3(finalWorld*vec4(positionUpdated,0.0)));
#endif
#ifndef UV1
vec2 uvUpdated=vec2(0.,0.);
#endif
#ifdef MAINUV1
vMainUV1=uvUpdated;
#endif
#include<uvVariableDeclaration>[2..7]
#include<samplerVertexImplementation>(_DEFINENAME_,ALBEDO,_VARYINGNAME_,Albedo,_MATRIXNAME_,albedo,_INFONAME_,AlbedoInfos.x)
#include<samplerVertexImplementation>(_DEFINENAME_,DETAIL,_VARYINGNAME_,Detail,_MATRIXNAME_,detail,_INFONAME_,DetailInfos.x)
#include<samplerVertexImplementation>(_DEFINENAME_,AMBIENT,_VARYINGNAME_,Ambient,_MATRIXNAME_,ambient,_INFONAME_,AmbientInfos.x)
#include<samplerVertexImplementation>(_DEFINENAME_,OPACITY,_VARYINGNAME_,Opacity,_MATRIXNAME_,opacity,_INFONAME_,OpacityInfos.x)
#include<samplerVertexImplementation>(_DEFINENAME_,EMISSIVE,_VARYINGNAME_,Emissive,_MATRIXNAME_,emissive,_INFONAME_,EmissiveInfos.x)
#include<samplerVertexImplementation>(_DEFINENAME_,LIGHTMAP,_VARYINGNAME_,Lightmap,_MATRIXNAME_,lightmap,_INFONAME_,LightmapInfos.x)
#include<samplerVertexImplementation>(_DEFINENAME_,REFLECTIVITY,_VARYINGNAME_,Reflectivity,_MATRIXNAME_,reflectivity,_INFONAME_,ReflectivityInfos.x)
#include<samplerVertexImplementation>(_DEFINENAME_,MICROSURFACEMAP,_VARYINGNAME_,MicroSurfaceSampler,_MATRIXNAME_,microSurfaceSampler,_INFONAME_,MicroSurfaceSamplerInfos.x)
#include<samplerVertexImplementation>(_DEFINENAME_,METALLIC_REFLECTANCE,_VARYINGNAME_,MetallicReflectance,_MATRIXNAME_,metallicReflectance,_INFONAME_,MetallicReflectanceInfos.x)
#include<samplerVertexImplementation>(_DEFINENAME_,REFLECTANCE,_VARYINGNAME_,Reflectance,_MATRIXNAME_,reflectance,_INFONAME_,ReflectanceInfos.x)
#include<samplerVertexImplementation>(_DEFINENAME_,BUMP,_VARYINGNAME_,Bump,_MATRIXNAME_,bump,_INFONAME_,BumpInfos.x)
#include<samplerVertexImplementation>(_DEFINENAME_,DECAL,_VARYINGNAME_,Decal,_MATRIXNAME_,decal,_INFONAME_,DecalInfos.x)
#ifdef CLEARCOAT
#include<samplerVertexImplementation>(_DEFINENAME_,CLEARCOAT_TEXTURE,_VARYINGNAME_,ClearCoat,_MATRIXNAME_,clearCoat,_INFONAME_,ClearCoatInfos.x)
#include<samplerVertexImplementation>(_DEFINENAME_,CLEARCOAT_TEXTURE_ROUGHNESS,_VARYINGNAME_,ClearCoatRoughness,_MATRIXNAME_,clearCoatRoughness,_INFONAME_,ClearCoatInfos.z)
#include<samplerVertexImplementation>(_DEFINENAME_,CLEARCOAT_BUMP,_VARYINGNAME_,ClearCoatBump,_MATRIXNAME_,clearCoatBump,_INFONAME_,ClearCoatBumpInfos.x)
#include<samplerVertexImplementation>(_DEFINENAME_,CLEARCOAT_TINT_TEXTURE,_VARYINGNAME_,ClearCoatTint,_MATRIXNAME_,clearCoatTint,_INFONAME_,ClearCoatTintInfos.x)
#endif
#ifdef IRIDESCENCE
#include<samplerVertexImplementation>(_DEFINENAME_,IRIDESCENCE_TEXTURE,_VARYINGNAME_,Iridescence,_MATRIXNAME_,iridescence,_INFONAME_,IridescenceInfos.x)
#include<samplerVertexImplementation>(_DEFINENAME_,IRIDESCENCE_THICKNESS_TEXTURE,_VARYINGNAME_,IridescenceThickness,_MATRIXNAME_,iridescenceThickness,_INFONAME_,IridescenceInfos.z)
#endif
#ifdef SHEEN
#include<samplerVertexImplementation>(_DEFINENAME_,SHEEN_TEXTURE,_VARYINGNAME_,Sheen,_MATRIXNAME_,sheen,_INFONAME_,SheenInfos.x)
#include<samplerVertexImplementation>(_DEFINENAME_,SHEEN_TEXTURE_ROUGHNESS,_VARYINGNAME_,SheenRoughness,_MATRIXNAME_,sheenRoughness,_INFONAME_,SheenInfos.z)
#endif
#ifdef ANISOTROPIC
#include<samplerVertexImplementation>(_DEFINENAME_,ANISOTROPIC_TEXTURE,_VARYINGNAME_,Anisotropy,_MATRIXNAME_,anisotropy,_INFONAME_,AnisotropyInfos.x)
#endif
#ifdef SUBSURFACE
#include<samplerVertexImplementation>(_DEFINENAME_,SS_THICKNESSANDMASK_TEXTURE,_VARYINGNAME_,Thickness,_MATRIXNAME_,thickness,_INFONAME_,ThicknessInfos.x)
#include<samplerVertexImplementation>(_DEFINENAME_,SS_REFRACTIONINTENSITY_TEXTURE,_VARYINGNAME_,RefractionIntensity,_MATRIXNAME_,refractionIntensity,_INFONAME_,RefractionIntensityInfos.x)
#include<samplerVertexImplementation>(_DEFINENAME_,SS_TRANSLUCENCYINTENSITY_TEXTURE,_VARYINGNAME_,TranslucencyIntensity,_MATRIXNAME_,translucencyIntensity,_INFONAME_,TranslucencyIntensityInfos.x)
#endif
#include<bumpVertex>
#include<clipPlaneVertex>
#include<fogVertex>
#include<shadowsVertex>[0..maxSimultaneousLights]
#include<vertexColorMixing>
#if defined(POINTSIZE) && !defined(WEBGPU)
gl_PointSize=pointSize;
#endif
#include<logDepthVertex>
#define CUSTOM_VERTEX_MAIN_END
}`;Y.ShadersStore[xO]=CO;class RO extends is{constructor(){super(...arguments),this.CLEARCOAT=!1,this.CLEARCOAT_DEFAULTIOR=!1,this.CLEARCOAT_TEXTURE=!1,this.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this.CLEARCOAT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,this.CLEARCOAT_BUMP=!1,this.CLEARCOAT_BUMPDIRECTUV=0,this.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,this.CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL=!1,this.CLEARCOAT_REMAP_F0=!1,this.CLEARCOAT_TINT=!1,this.CLEARCOAT_TINT_TEXTURE=!1,this.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TINT_GAMMATEXTURE=!1}}class bi extends kr{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}constructor(e,t=!0){super(e,"PBRClearCoat",100,new RO,t),this._isEnabled=!1,this.isEnabled=!1,this.intensity=1,this.roughness=0,this._indexOfRefraction=bi._DefaultIndexOfRefraction,this.indexOfRefraction=bi._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._textureRoughness=null,this.textureRoughness=null,this._remapF0OnInterfaceChange=!0,this.remapF0OnInterfaceChange=!0,this._bumpTexture=null,this.bumpTexture=null,this._isTintEnabled=!1,this.isTintEnabled=!1,this.tintColor=De.White(),this.tintColorAtDistance=1,this.tintThickness=1,this._tintTexture=null,this.tintTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=e._dirtyCallbacks[1]}isReadyForSubMesh(e,t,i){if(!this._isEnabled)return!0;const r=this._material._disableBumpMap;return!(e._areTexturesDirty&&t.texturesEnabled&&(this._texture&&ne.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking()||this._textureRoughness&&ne.ClearCoatTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking()||i.getCaps().standardDerivatives&&this._bumpTexture&&ne.ClearCoatBumpTextureEnabled&&!r&&!this._bumpTexture.isReady()||this._isTintEnabled&&this._tintTexture&&ne.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking()))}prepareDefinesBeforeAttributes(e,t){var i;this._isEnabled?(e.CLEARCOAT=!0,e.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,e.CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL=this._texture!==null&&this._texture._texture===((i=this._textureRoughness)==null?void 0:i._texture)&&this._texture.checkTransformsAreIdentical(this._textureRoughness),e.CLEARCOAT_REMAP_F0=this._remapF0OnInterfaceChange,e._areTexturesDirty&&t.texturesEnabled&&(this._texture&&ne.ClearCoatTextureEnabled?wt(this._texture,e,"CLEARCOAT_TEXTURE"):e.CLEARCOAT_TEXTURE=!1,this._textureRoughness&&ne.ClearCoatTextureEnabled?wt(this._textureRoughness,e,"CLEARCOAT_TEXTURE_ROUGHNESS"):e.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this._bumpTexture&&ne.ClearCoatBumpTextureEnabled?wt(this._bumpTexture,e,"CLEARCOAT_BUMP"):e.CLEARCOAT_BUMP=!1,e.CLEARCOAT_DEFAULTIOR=this._indexOfRefraction===bi._DefaultIndexOfRefraction,this._isTintEnabled?(e.CLEARCOAT_TINT=!0,this._tintTexture&&ne.ClearCoatTintTextureEnabled?(wt(this._tintTexture,e,"CLEARCOAT_TINT_TEXTURE"),e.CLEARCOAT_TINT_GAMMATEXTURE=this._tintTexture.gammaSpace):e.CLEARCOAT_TINT_TEXTURE=!1):(e.CLEARCOAT_TINT=!1,e.CLEARCOAT_TINT_TEXTURE=!1))):(e.CLEARCOAT=!1,e.CLEARCOAT_TEXTURE=!1,e.CLEARCOAT_TEXTURE_ROUGHNESS=!1,e.CLEARCOAT_BUMP=!1,e.CLEARCOAT_TINT=!1,e.CLEARCOAT_TINT_TEXTURE=!1,e.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,e.CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL=!1,e.CLEARCOAT_DEFAULTIOR=!1,e.CLEARCOAT_TEXTUREDIRECTUV=0,e.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,e.CLEARCOAT_BUMPDIRECTUV=0,e.CLEARCOAT_REMAP_F0=!1,e.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,e.CLEARCOAT_TINT_GAMMATEXTURE=!1)}bindForSubMesh(e,t,i,r){var s,o,a,l;if(!this._isEnabled)return;const h=r.materialDefines,c=this._material.isFrozen,u=this._material._disableBumpMap,d=this._material._invertNormalMapX,f=this._material._invertNormalMapY,p=h.CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL;if(!e.useUbo||!c||!e.isSync){p&&ne.ClearCoatTextureEnabled?(e.updateFloat4("vClearCoatInfos",this._texture.coordinatesIndex,this._texture.level,-1,-1),At(this._texture,e,"clearCoat")):(this._texture||this._textureRoughness)&&ne.ClearCoatTextureEnabled&&(e.updateFloat4("vClearCoatInfos",((s=this._texture)==null?void 0:s.coordinatesIndex)??0,((o=this._texture)==null?void 0:o.level)??0,((a=this._textureRoughness)==null?void 0:a.coordinatesIndex)??0,((l=this._textureRoughness)==null?void 0:l.level)??0),this._texture&&At(this._texture,e,"clearCoat"),this._textureRoughness&&!p&&!h.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&At(this._textureRoughness,e,"clearCoatRoughness")),this._bumpTexture&&i.getCaps().standardDerivatives&&ne.ClearCoatTextureEnabled&&!u&&(e.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),At(this._bumpTexture,e,"clearCoatBump"),t._mirroredCameraPosition?e.updateFloat2("vClearCoatTangentSpaceParams",d?1:-1,f?1:-1):e.updateFloat2("vClearCoatTangentSpaceParams",d?-1:1,f?-1:1)),this._tintTexture&&ne.ClearCoatTintTextureEnabled&&(e.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),At(this._tintTexture,e,"clearCoatTint")),e.updateFloat2("vClearCoatParams",this.intensity,this.roughness);const g=1-this._indexOfRefraction,m=1+this._indexOfRefraction,x=Math.pow(-g/m,2),E=1/this._indexOfRefraction;e.updateFloat4("vClearCoatRefractionParams",x,E,g,m),this._isTintEnabled&&(e.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness)),e.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance)))}t.texturesEnabled&&(this._texture&&ne.ClearCoatTextureEnabled&&e.setTexture("clearCoatSampler",this._texture),this._textureRoughness&&!p&&!h.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&ne.ClearCoatTextureEnabled&&e.setTexture("clearCoatRoughnessSampler",this._textureRoughness),this._bumpTexture&&i.getCaps().standardDerivatives&&ne.ClearCoatBumpTextureEnabled&&!u&&e.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&ne.ClearCoatTintTextureEnabled&&e.setTexture("clearCoatTintSampler",this._tintTexture))}hasTexture(e){return this._texture===e||this._textureRoughness===e||this._bumpTexture===e||this._tintTexture===e}getActiveTextures(e){this._texture&&e.push(this._texture),this._textureRoughness&&e.push(this._textureRoughness),this._bumpTexture&&e.push(this._bumpTexture),this._tintTexture&&e.push(this._tintTexture)}getAnimatables(e){this._texture&&this._texture.animations&&this._texture.animations.length>0&&e.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&e.push(this._textureRoughness),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&e.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&e.push(this._tintTexture)}dispose(e){var t,i,r,s;e&&((t=this._texture)==null||t.dispose(),(i=this._textureRoughness)==null||i.dispose(),(r=this._bumpTexture)==null||r.dispose(),(s=this._tintTexture)==null||s.dispose())}getClassName(){return"PBRClearCoatConfiguration"}addFallbacks(e,t,i){return e.CLEARCOAT_BUMP&&t.addFallback(i++,"CLEARCOAT_BUMP"),e.CLEARCOAT_TINT&&t.addFallback(i++,"CLEARCOAT_TINT"),e.CLEARCOAT&&t.addFallback(i++,"CLEARCOAT"),i}getSamplers(e){e.push("clearCoatSampler","clearCoatRoughnessSampler","clearCoatBumpSampler","clearCoatTintSampler")}getUniforms(){return{ubo:[{name:"vClearCoatParams",size:2,type:"vec2"},{name:"vClearCoatRefractionParams",size:4,type:"vec4"},{name:"vClearCoatInfos",size:4,type:"vec4"},{name:"clearCoatMatrix",size:16,type:"mat4"},{name:"clearCoatRoughnessMatrix",size:16,type:"mat4"},{name:"vClearCoatBumpInfos",size:2,type:"vec2"},{name:"vClearCoatTangentSpaceParams",size:2,type:"vec2"},{name:"clearCoatBumpMatrix",size:16,type:"mat4"},{name:"vClearCoatTintParams",size:4,type:"vec4"},{name:"clearCoatColorAtDistance",size:1,type:"float"},{name:"vClearCoatTintInfos",size:2,type:"vec2"},{name:"clearCoatTintMatrix",size:16,type:"mat4"}]}}}bi._DefaultIndexOfRefraction=1.5;M([V(),ae("_markAllSubMeshesAsTexturesDirty")],bi.prototype,"isEnabled",void 0);M([V()],bi.prototype,"intensity",void 0);M([V()],bi.prototype,"roughness",void 0);M([V(),ae("_markAllSubMeshesAsTexturesDirty")],bi.prototype,"indexOfRefraction",void 0);M([Tt(),ae("_markAllSubMeshesAsTexturesDirty")],bi.prototype,"texture",void 0);M([V(),ae("_markAllSubMeshesAsTexturesDirty")],bi.prototype,"useRoughnessFromMainTexture",void 0);M([Tt(),ae("_markAllSubMeshesAsTexturesDirty")],bi.prototype,"textureRoughness",void 0);M([V(),ae("_markAllSubMeshesAsTexturesDirty")],bi.prototype,"remapF0OnInterfaceChange",void 0);M([Tt(),ae("_markAllSubMeshesAsTexturesDirty")],bi.prototype,"bumpTexture",void 0);M([V(),ae("_markAllSubMeshesAsTexturesDirty")],bi.prototype,"isTintEnabled",void 0);M([sr()],bi.prototype,"tintColor",void 0);M([V()],bi.prototype,"tintColorAtDistance",void 0);M([V()],bi.prototype,"tintThickness",void 0);M([Tt(),ae("_markAllSubMeshesAsTexturesDirty")],bi.prototype,"tintTexture",void 0);class SO extends is{constructor(){super(...arguments),this.IRIDESCENCE=!1,this.IRIDESCENCE_TEXTURE=!1,this.IRIDESCENCE_TEXTUREDIRECTUV=0,this.IRIDESCENCE_THICKNESS_TEXTURE=!1,this.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0,this.IRIDESCENCE_USE_THICKNESS_FROM_MAINTEXTURE=!1}}class dr extends kr{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}constructor(e,t=!0){super(e,"PBRIridescence",110,new SO,t),this._isEnabled=!1,this.isEnabled=!1,this.intensity=1,this.minimumThickness=dr._DefaultMinimumThickness,this.maximumThickness=dr._DefaultMaximumThickness,this.indexOfRefraction=dr._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._thicknessTexture=null,this.thicknessTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=e._dirtyCallbacks[1]}isReadyForSubMesh(e,t){return this._isEnabled?!(e._areTexturesDirty&&t.texturesEnabled&&(this._texture&&ne.IridescenceTextureEnabled&&!this._texture.isReadyOrNotBlocking()||this._thicknessTexture&&ne.IridescenceTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())):!0}prepareDefinesBeforeAttributes(e,t){var i;this._isEnabled?(e.IRIDESCENCE=!0,e.IRIDESCENCE_USE_THICKNESS_FROM_MAINTEXTURE=this._texture!==null&&this._texture._texture===((i=this._thicknessTexture)==null?void 0:i._texture)&&this._texture.checkTransformsAreIdentical(this._thicknessTexture),e._areTexturesDirty&&t.texturesEnabled&&(this._texture&&ne.IridescenceTextureEnabled?wt(this._texture,e,"IRIDESCENCE_TEXTURE"):e.IRIDESCENCE_TEXTURE=!1,!e.IRIDESCENCE_USE_THICKNESS_FROM_MAINTEXTURE&&this._thicknessTexture&&ne.IridescenceTextureEnabled?wt(this._thicknessTexture,e,"IRIDESCENCE_THICKNESS_TEXTURE"):e.IRIDESCENCE_THICKNESS_TEXTURE=!1)):(e.IRIDESCENCE=!1,e.IRIDESCENCE_TEXTURE=!1,e.IRIDESCENCE_THICKNESS_TEXTURE=!1,e.IRIDESCENCE_USE_THICKNESS_FROM_MAINTEXTURE=!1,e.IRIDESCENCE_TEXTUREDIRECTUV=0,e.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0)}bindForSubMesh(e,t,i,r){var s,o,a,l;if(!this._isEnabled)return;const h=r.materialDefines,c=this._material.isFrozen,u=h.IRIDESCENCE_USE_THICKNESS_FROM_MAINTEXTURE;(!e.useUbo||!c||!e.isSync)&&(u&&ne.IridescenceTextureEnabled?(e.updateFloat4("vIridescenceInfos",this._texture.coordinatesIndex,this._texture.level,-1,-1),At(this._texture,e,"iridescence")):(this._texture||this._thicknessTexture)&&ne.IridescenceTextureEnabled&&(e.updateFloat4("vIridescenceInfos",((s=this._texture)==null?void 0:s.coordinatesIndex)??0,((o=this._texture)==null?void 0:o.level)??0,((a=this._thicknessTexture)==null?void 0:a.coordinatesIndex)??0,((l=this._thicknessTexture)==null?void 0:l.level)??0),this._texture&&At(this._texture,e,"iridescence"),this._thicknessTexture&&!u&&!h.IRIDESCENCE_USE_THICKNESS_FROM_MAINTEXTURE&&At(this._thicknessTexture,e,"iridescenceThickness")),e.updateFloat4("vIridescenceParams",this.intensity,this.indexOfRefraction,this.minimumThickness,this.maximumThickness)),t.texturesEnabled&&(this._texture&&ne.IridescenceTextureEnabled&&e.setTexture("iridescenceSampler",this._texture),this._thicknessTexture&&!u&&!h.IRIDESCENCE_USE_THICKNESS_FROM_MAINTEXTURE&&ne.IridescenceTextureEnabled&&e.setTexture("iridescenceThicknessSampler",this._thicknessTexture))}hasTexture(e){return this._texture===e||this._thicknessTexture===e}getActiveTextures(e){this._texture&&e.push(this._texture),this._thicknessTexture&&e.push(this._thicknessTexture)}getAnimatables(e){this._texture&&this._texture.animations&&this._texture.animations.length>0&&e.push(this._texture),this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&e.push(this._thicknessTexture)}dispose(e){var t,i;e&&((t=this._texture)==null||t.dispose(),(i=this._thicknessTexture)==null||i.dispose())}getClassName(){return"PBRIridescenceConfiguration"}addFallbacks(e,t,i){return e.IRIDESCENCE&&t.addFallback(i++,"IRIDESCENCE"),i}getSamplers(e){e.push("iridescenceSampler","iridescenceThicknessSampler")}getUniforms(){return{ubo:[{name:"vIridescenceParams",size:4,type:"vec4"},{name:"vIridescenceInfos",size:4,type:"vec4"},{name:"iridescenceMatrix",size:16,type:"mat4"},{name:"iridescenceThicknessMatrix",size:16,type:"mat4"}]}}}dr._DefaultMinimumThickness=100;dr._DefaultMaximumThickness=400;dr._DefaultIndexOfRefraction=1.3;M([V(),ae("_markAllSubMeshesAsTexturesDirty")],dr.prototype,"isEnabled",void 0);M([V()],dr.prototype,"intensity",void 0);M([V()],dr.prototype,"minimumThickness",void 0);M([V()],dr.prototype,"maximumThickness",void 0);M([V()],dr.prototype,"indexOfRefraction",void 0);M([Tt(),ae("_markAllSubMeshesAsTexturesDirty")],dr.prototype,"texture",void 0);M([Tt(),ae("_markAllSubMeshesAsTexturesDirty")],dr.prototype,"thicknessTexture",void 0);class yO extends is{constructor(){super(...arguments),this.ANISOTROPIC=!1,this.ANISOTROPIC_TEXTURE=!1,this.ANISOTROPIC_TEXTUREDIRECTUV=0,this.ANISOTROPIC_LEGACY=!1,this.MAINUV1=!1}}class Yo extends kr{set angle(e){this.direction.x=Math.cos(e),this.direction.y=Math.sin(e)}get angle(){return Math.atan2(this.direction.y,this.direction.x)}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markAllSubMeshesAsMiscDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsMiscDirty()}constructor(e,t=!0){super(e,"PBRAnisotropic",110,new yO,t),this._isEnabled=!1,this.isEnabled=!1,this.intensity=1,this.direction=new me(1,0),this._texture=null,this.texture=null,this._legacy=!1,this.legacy=!1,this._internalMarkAllSubMeshesAsTexturesDirty=e._dirtyCallbacks[1],this._internalMarkAllSubMeshesAsMiscDirty=e._dirtyCallbacks[16]}isReadyForSubMesh(e,t){return this._isEnabled?!(e._areTexturesDirty&&t.texturesEnabled&&this._texture&&ne.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking()):!0}prepareDefinesBeforeAttributes(e,t,i){this._isEnabled?(e.ANISOTROPIC=this._isEnabled,this._isEnabled&&!i.isVerticesDataPresent(b.TangentKind)&&(e._needUVs=!0,e.MAINUV1=!0),e._areTexturesDirty&&t.texturesEnabled&&(this._texture&&ne.AnisotropicTextureEnabled?wt(this._texture,e,"ANISOTROPIC_TEXTURE"):e.ANISOTROPIC_TEXTURE=!1),e._areMiscDirty&&(e.ANISOTROPIC_LEGACY=this._legacy)):(e.ANISOTROPIC=!1,e.ANISOTROPIC_TEXTURE=!1,e.ANISOTROPIC_TEXTUREDIRECTUV=0,e.ANISOTROPIC_LEGACY=!1)}bindForSubMesh(e,t){if(!this._isEnabled)return;const i=this._material.isFrozen;(!e.useUbo||!i||!e.isSync)&&(this._texture&&ne.AnisotropicTextureEnabled&&(e.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),At(this._texture,e,"anisotropy")),e.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.intensity)),t.texturesEnabled&&this._texture&&ne.AnisotropicTextureEnabled&&e.setTexture("anisotropySampler",this._texture)}hasTexture(e){return this._texture===e}getActiveTextures(e){this._texture&&e.push(this._texture)}getAnimatables(e){this._texture&&this._texture.animations&&this._texture.animations.length>0&&e.push(this._texture)}dispose(e){e&&this._texture&&this._texture.dispose()}getClassName(){return"PBRAnisotropicConfiguration"}addFallbacks(e,t,i){return e.ANISOTROPIC&&t.addFallback(i++,"ANISOTROPIC"),i}getSamplers(e){e.push("anisotropySampler")}getUniforms(){return{ubo:[{name:"vAnisotropy",size:3,type:"vec3"},{name:"vAnisotropyInfos",size:2,type:"vec2"},{name:"anisotropyMatrix",size:16,type:"mat4"}]}}parse(e,t,i){super.parse(e,t,i),e.legacy===void 0&&(this.legacy=!0)}}M([V(),ae("_markAllSubMeshesAsTexturesDirty")],Yo.prototype,"isEnabled",void 0);M([V()],Yo.prototype,"intensity",void 0);M([a0()],Yo.prototype,"direction",void 0);M([Tt(),ae("_markAllSubMeshesAsTexturesDirty")],Yo.prototype,"texture",void 0);M([V(),ae("_markAllSubMeshesAsMiscDirty")],Yo.prototype,"legacy",void 0);class bO extends is{constructor(){super(...arguments),this.SHEEN=!1,this.SHEEN_TEXTURE=!1,this.SHEEN_GAMMATEXTURE=!1,this.SHEEN_TEXTURE_ROUGHNESS=!1,this.SHEEN_TEXTUREDIRECTUV=0,this.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0,this.SHEEN_LINKWITHALBEDO=!1,this.SHEEN_ROUGHNESS=!1,this.SHEEN_ALBEDOSCALING=!1,this.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,this.SHEEN_TEXTURE_ROUGHNESS_IDENTICAL=!1}}class Rs extends kr{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}constructor(e,t=!0){super(e,"Sheen",120,new bO,t),this._isEnabled=!1,this.isEnabled=!1,this._linkSheenWithAlbedo=!1,this.linkSheenWithAlbedo=!1,this.intensity=1,this.color=De.White(),this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._roughness=null,this.roughness=null,this._textureRoughness=null,this.textureRoughness=null,this._albedoScaling=!1,this.albedoScaling=!1,this._internalMarkAllSubMeshesAsTexturesDirty=e._dirtyCallbacks[1]}isReadyForSubMesh(e,t){return this._isEnabled?!(e._areTexturesDirty&&t.texturesEnabled&&(this._texture&&ne.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking()||this._textureRoughness&&ne.SheenTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())):!0}prepareDefinesBeforeAttributes(e,t){var i;this._isEnabled?(e.SHEEN=!0,e.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,e.SHEEN_ROUGHNESS=this._roughness!==null,e.SHEEN_ALBEDOSCALING=this._albedoScaling,e.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,e.SHEEN_TEXTURE_ROUGHNESS_IDENTICAL=this._texture!==null&&this._texture._texture===((i=this._textureRoughness)==null?void 0:i._texture)&&this._texture.checkTransformsAreIdentical(this._textureRoughness),e._areTexturesDirty&&t.texturesEnabled&&(this._texture&&ne.SheenTextureEnabled?(wt(this._texture,e,"SHEEN_TEXTURE"),e.SHEEN_GAMMATEXTURE=this._texture.gammaSpace):e.SHEEN_TEXTURE=!1,this._textureRoughness&&ne.SheenTextureEnabled?wt(this._textureRoughness,e,"SHEEN_TEXTURE_ROUGHNESS"):e.SHEEN_TEXTURE_ROUGHNESS=!1)):(e.SHEEN=!1,e.SHEEN_TEXTURE=!1,e.SHEEN_TEXTURE_ROUGHNESS=!1,e.SHEEN_LINKWITHALBEDO=!1,e.SHEEN_ROUGHNESS=!1,e.SHEEN_ALBEDOSCALING=!1,e.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,e.SHEEN_TEXTURE_ROUGHNESS_IDENTICAL=!1,e.SHEEN_GAMMATEXTURE=!1,e.SHEEN_TEXTUREDIRECTUV=0,e.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0)}bindForSubMesh(e,t,i,r){var s,o,a,l;if(!this._isEnabled)return;const h=r.materialDefines,c=this._material.isFrozen,u=h.SHEEN_TEXTURE_ROUGHNESS_IDENTICAL;(!e.useUbo||!c||!e.isSync)&&(u&&ne.SheenTextureEnabled?(e.updateFloat4("vSheenInfos",this._texture.coordinatesIndex,this._texture.level,-1,-1),At(this._texture,e,"sheen")):(this._texture||this._textureRoughness)&&ne.SheenTextureEnabled&&(e.updateFloat4("vSheenInfos",((s=this._texture)==null?void 0:s.coordinatesIndex)??0,((o=this._texture)==null?void 0:o.level)??0,((a=this._textureRoughness)==null?void 0:a.coordinatesIndex)??0,((l=this._textureRoughness)==null?void 0:l.level)??0),this._texture&&At(this._texture,e,"sheen"),this._textureRoughness&&!u&&!h.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&At(this._textureRoughness,e,"sheenRoughness")),e.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.intensity),this._roughness!==null&&e.updateFloat("vSheenRoughness",this._roughness)),t.texturesEnabled&&(this._texture&&ne.SheenTextureEnabled&&e.setTexture("sheenSampler",this._texture),this._textureRoughness&&!u&&!h.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&ne.SheenTextureEnabled&&e.setTexture("sheenRoughnessSampler",this._textureRoughness))}hasTexture(e){return this._texture===e||this._textureRoughness===e}getActiveTextures(e){this._texture&&e.push(this._texture),this._textureRoughness&&e.push(this._textureRoughness)}getAnimatables(e){this._texture&&this._texture.animations&&this._texture.animations.length>0&&e.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&e.push(this._textureRoughness)}dispose(e){var t,i;e&&((t=this._texture)==null||t.dispose(),(i=this._textureRoughness)==null||i.dispose())}getClassName(){return"PBRSheenConfiguration"}addFallbacks(e,t,i){return e.SHEEN&&t.addFallback(i++,"SHEEN"),i}getSamplers(e){e.push("sheenSampler","sheenRoughnessSampler")}getUniforms(){return{ubo:[{name:"vSheenColor",size:4,type:"vec4"},{name:"vSheenRoughness",size:1,type:"float"},{name:"vSheenInfos",size:4,type:"vec4"},{name:"sheenMatrix",size:16,type:"mat4"},{name:"sheenRoughnessMatrix",size:16,type:"mat4"}]}}}M([V(),ae("_markAllSubMeshesAsTexturesDirty")],Rs.prototype,"isEnabled",void 0);M([V(),ae("_markAllSubMeshesAsTexturesDirty")],Rs.prototype,"linkSheenWithAlbedo",void 0);M([V()],Rs.prototype,"intensity",void 0);M([sr()],Rs.prototype,"color",void 0);M([Tt(),ae("_markAllSubMeshesAsTexturesDirty")],Rs.prototype,"texture",void 0);M([V(),ae("_markAllSubMeshesAsTexturesDirty")],Rs.prototype,"useRoughnessFromMainTexture",void 0);M([V(),ae("_markAllSubMeshesAsTexturesDirty")],Rs.prototype,"roughness",void 0);M([Tt(),ae("_markAllSubMeshesAsTexturesDirty")],Rs.prototype,"textureRoughness",void 0);M([V(),ae("_markAllSubMeshesAsTexturesDirty")],Rs.prototype,"albedoScaling",void 0);class IO extends is{constructor(){super(...arguments),this.SUBSURFACE=!1,this.SS_REFRACTION=!1,this.SS_REFRACTION_USE_INTENSITY_FROM_TEXTURE=!1,this.SS_TRANSLUCENCY=!1,this.SS_TRANSLUCENCY_USE_INTENSITY_FROM_TEXTURE=!1,this.SS_SCATTERING=!1,this.SS_DISPERSION=!1,this.SS_THICKNESSANDMASK_TEXTURE=!1,this.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,this.SS_HAS_THICKNESS=!1,this.SS_REFRACTIONINTENSITY_TEXTURE=!1,this.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,this.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,this.SS_REFRACTIONMAP_3D=!1,this.SS_REFRACTIONMAP_OPPOSITEZ=!1,this.SS_LODINREFRACTIONALPHA=!1,this.SS_GAMMAREFRACTION=!1,this.SS_RGBDREFRACTION=!1,this.SS_LINEARSPECULARREFRACTION=!1,this.SS_LINKREFRACTIONTOTRANSPARENCY=!1,this.SS_ALBEDOFORREFRACTIONTINT=!1,this.SS_ALBEDOFORTRANSLUCENCYTINT=!1,this.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.SS_USE_THICKNESS_AS_DEPTH=!1,this.SS_MASK_FROM_THICKNESS_TEXTURE=!1,this.SS_USE_GLTF_TEXTURES=!1}}class Yt extends kr{get scatteringDiffusionProfile(){return this._scene.subSurfaceConfiguration?this._scene.subSurfaceConfiguration.ssDiffusionProfileColors[this._scatteringDiffusionProfileIndex]:null}set scatteringDiffusionProfile(e){this._scene.enableSubSurfaceForPrePass()&&e&&(this._scatteringDiffusionProfileIndex=this._scene.subSurfaceConfiguration.addDiffusionProfile(e))}get volumeIndexOfRefraction(){return this._volumeIndexOfRefraction>=1?this._volumeIndexOfRefraction:this._indexOfRefraction}set volumeIndexOfRefraction(e){e>=1?this._volumeIndexOfRefraction=e:this._volumeIndexOfRefraction=-1}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markScenePrePassDirty(){this._internalMarkAllSubMeshesAsTexturesDirty(),this._internalMarkScenePrePassDirty()}constructor(e,t=!0){super(e,"PBRSubSurface",130,new IO,t),this._isRefractionEnabled=!1,this.isRefractionEnabled=!1,this._isTranslucencyEnabled=!1,this.isTranslucencyEnabled=!1,this._isDispersionEnabled=!1,this.isDispersionEnabled=!1,this._isScatteringEnabled=!1,this.isScatteringEnabled=!1,this._scatteringDiffusionProfileIndex=0,this.refractionIntensity=1,this.translucencyIntensity=1,this.useAlbedoToTintRefraction=!1,this.useAlbedoToTintTranslucency=!1,this._thicknessTexture=null,this.thicknessTexture=null,this._refractionTexture=null,this.refractionTexture=null,this._indexOfRefraction=1.5,this.indexOfRefraction=1.5,this._volumeIndexOfRefraction=-1,this._invertRefractionY=!1,this.invertRefractionY=!1,this._linkRefractionWithTransparency=!1,this.linkRefractionWithTransparency=!1,this.minimumThickness=0,this.maximumThickness=1,this.useThicknessAsDepth=!1,this.tintColor=De.White(),this.tintColorAtDistance=1,this.dispersion=0,this.diffusionDistance=De.White(),this._useMaskFromThicknessTexture=!1,this.useMaskFromThicknessTexture=!1,this._refractionIntensityTexture=null,this.refractionIntensityTexture=null,this._translucencyIntensityTexture=null,this.translucencyIntensityTexture=null,this._useGltfStyleTextures=!1,this.useGltfStyleTextures=!1,this._scene=e.getScene(),this.registerForExtraEvents=!0,this._internalMarkAllSubMeshesAsTexturesDirty=e._dirtyCallbacks[1],this._internalMarkScenePrePassDirty=e._dirtyCallbacks[32]}isReadyForSubMesh(e,t){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return!0;if(e._areTexturesDirty&&t.texturesEnabled){if(this._thicknessTexture&&ne.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;const i=this._getRefractionTexture(t);if(i&&ne.RefractionTextureEnabled&&!i.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(e,t){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled){e.SUBSURFACE=!1,e.SS_DISPERSION=!1,e.SS_TRANSLUCENCY=!1,e.SS_SCATTERING=!1,e.SS_REFRACTION=!1,e.SS_REFRACTION_USE_INTENSITY_FROM_TEXTURE=!1,e.SS_TRANSLUCENCY_USE_INTENSITY_FROM_TEXTURE=!1,e.SS_THICKNESSANDMASK_TEXTURE=!1,e.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,e.SS_HAS_THICKNESS=!1,e.SS_REFRACTIONINTENSITY_TEXTURE=!1,e.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,e.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,e.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,e.SS_REFRACTIONMAP_3D=!1,e.SS_REFRACTIONMAP_OPPOSITEZ=!1,e.SS_LODINREFRACTIONALPHA=!1,e.SS_GAMMAREFRACTION=!1,e.SS_RGBDREFRACTION=!1,e.SS_LINEARSPECULARREFRACTION=!1,e.SS_LINKREFRACTIONTOTRANSPARENCY=!1,e.SS_ALBEDOFORREFRACTIONTINT=!1,e.SS_ALBEDOFORTRANSLUCENCYTINT=!1,e.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,e.SS_USE_THICKNESS_AS_DEPTH=!1,e.SS_MASK_FROM_THICKNESS_TEXTURE=!1,e.SS_USE_GLTF_TEXTURES=!1;return}if(e._areTexturesDirty){e.SUBSURFACE=!0,e.SS_DISPERSION=this._isDispersionEnabled,e.SS_TRANSLUCENCY=this._isTranslucencyEnabled,e.SS_TRANSLUCENCY_USE_INTENSITY_FROM_TEXTURE=!1,e.SS_SCATTERING=this._isScatteringEnabled,e.SS_THICKNESSANDMASK_TEXTURE=!1,e.SS_REFRACTIONINTENSITY_TEXTURE=!1,e.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,e.SS_HAS_THICKNESS=!1,e.SS_MASK_FROM_THICKNESS_TEXTURE=!1,e.SS_USE_GLTF_TEXTURES=!1,e.SS_REFRACTION=!1,e.SS_REFRACTION_USE_INTENSITY_FROM_TEXTURE=!1,e.SS_REFRACTIONMAP_3D=!1,e.SS_GAMMAREFRACTION=!1,e.SS_RGBDREFRACTION=!1,e.SS_LINEARSPECULARREFRACTION=!1,e.SS_REFRACTIONMAP_OPPOSITEZ=!1,e.SS_LODINREFRACTIONALPHA=!1,e.SS_LINKREFRACTIONTOTRANSPARENCY=!1,e.SS_ALBEDOFORREFRACTIONTINT=!1,e.SS_ALBEDOFORTRANSLUCENCYTINT=!1,e.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,e.SS_USE_THICKNESS_AS_DEPTH=!1;const i=!!this._thicknessTexture&&!!this._refractionIntensityTexture&&this._refractionIntensityTexture.checkTransformsAreIdentical(this._thicknessTexture)&&this._refractionIntensityTexture._texture===this._thicknessTexture._texture,r=!!this._thicknessTexture&&!!this._translucencyIntensityTexture&&this._translucencyIntensityTexture.checkTransformsAreIdentical(this._thicknessTexture)&&this._translucencyIntensityTexture._texture===this._thicknessTexture._texture,s=(i||!this._refractionIntensityTexture)&&(r||!this._translucencyIntensityTexture);if(e._areTexturesDirty&&t.texturesEnabled&&(this._thicknessTexture&&ne.ThicknessTextureEnabled&&wt(this._thicknessTexture,e,"SS_THICKNESSANDMASK_TEXTURE"),this._refractionIntensityTexture&&ne.RefractionIntensityTextureEnabled&&!s&&wt(this._refractionIntensityTexture,e,"SS_REFRACTIONINTENSITY_TEXTURE"),this._translucencyIntensityTexture&&ne.TranslucencyIntensityTextureEnabled&&!s&&wt(this._translucencyIntensityTexture,e,"SS_TRANSLUCENCYINTENSITY_TEXTURE")),e.SS_HAS_THICKNESS=this.maximumThickness-this.minimumThickness!==0,e.SS_MASK_FROM_THICKNESS_TEXTURE=(this._useMaskFromThicknessTexture||!!this._refractionIntensityTexture||!!this._translucencyIntensityTexture)&&s,e.SS_USE_GLTF_TEXTURES=this._useGltfStyleTextures,e.SS_REFRACTION_USE_INTENSITY_FROM_TEXTURE=(this._useMaskFromThicknessTexture||!!this._refractionIntensityTexture)&&s,e.SS_TRANSLUCENCY_USE_INTENSITY_FROM_TEXTURE=(this._useMaskFromThicknessTexture||!!this._translucencyIntensityTexture)&&s,this._isRefractionEnabled&&t.texturesEnabled){const o=this._getRefractionTexture(t);o&&ne.RefractionTextureEnabled&&(e.SS_REFRACTION=!0,e.SS_REFRACTIONMAP_3D=o.isCube,e.SS_GAMMAREFRACTION=o.gammaSpace,e.SS_RGBDREFRACTION=o.isRGBD,e.SS_LINEARSPECULARREFRACTION=o.linearSpecularLOD,e.SS_REFRACTIONMAP_OPPOSITEZ=this._scene.useRightHandedSystem&&o.isCube?!o.invertZ:o.invertZ,e.SS_LODINREFRACTIONALPHA=o.lodLevelInAlpha,e.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency,e.SS_ALBEDOFORREFRACTIONTINT=this.useAlbedoToTintRefraction,e.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=o.isCube&&o.boundingBoxSize,e.SS_USE_THICKNESS_AS_DEPTH=this.useThicknessAsDepth)}this._isTranslucencyEnabled&&(e.SS_ALBEDOFORTRANSLUCENCYTINT=this.useAlbedoToTintTranslucency)}}hardBindForSubMesh(e,t,i,r){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return;r.getRenderingMesh().getWorldMatrix().decompose(W.Vector3[0]);const s=Math.max(Math.abs(W.Vector3[0].x),Math.abs(W.Vector3[0].y),Math.abs(W.Vector3[0].z));e.updateFloat2("vThicknessParam",this.minimumThickness*s,(this.maximumThickness-this.minimumThickness)*s)}bindForSubMesh(e,t,i,r){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return;const s=r.materialDefines,o=this._material.isFrozen,a=this._material.realTimeFiltering,l=s.LODBASEDMICROSFURACE,h=this._getRefractionTexture(t);if(!e.useUbo||!o||!e.isSync){if(this._thicknessTexture&&ne.ThicknessTextureEnabled&&(e.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),At(this._thicknessTexture,e,"thickness")),this._refractionIntensityTexture&&ne.RefractionIntensityTextureEnabled&&s.SS_REFRACTIONINTENSITY_TEXTURE&&(e.updateFloat2("vRefractionIntensityInfos",this._refractionIntensityTexture.coordinatesIndex,this._refractionIntensityTexture.level),At(this._refractionIntensityTexture,e,"refractionIntensity")),this._translucencyIntensityTexture&&ne.TranslucencyIntensityTextureEnabled&&s.SS_TRANSLUCENCYINTENSITY_TEXTURE&&(e.updateFloat2("vTranslucencyIntensityInfos",this._translucencyIntensityTexture.coordinatesIndex,this._translucencyIntensityTexture.level),At(this._translucencyIntensityTexture,e,"translucencyIntensity")),h&&ne.RefractionTextureEnabled){e.updateMatrix("refractionMatrix",h.getRefractionTextureMatrix());let c=1;h.isCube||h.depth&&(c=h.depth);const u=h.getSize().width,d=this.volumeIndexOfRefraction;if(e.updateFloat4("vRefractionInfos",h.level,1/d,c,this._invertRefractionY?-1:1),e.updateFloat4("vRefractionMicrosurfaceInfos",u,h.lodGenerationScale,h.lodGenerationOffset,1/this.indexOfRefraction),a&&e.updateFloat2("vRefractionFilteringInfo",u,Ye.Log2(u)),h.boundingBoxSize){const f=h;e.updateVector3("vRefractionPosition",f.boundingBoxPosition),e.updateVector3("vRefractionSize",f.boundingBoxSize)}}this._isScatteringEnabled&&e.updateFloat("scatteringDiffusionProfile",this._scatteringDiffusionProfileIndex),e.updateColor3("vDiffusionDistance",this.diffusionDistance),e.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintColorAtDistance)),e.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,0),e.updateFloat("dispersion",this.dispersion)}t.texturesEnabled&&(this._thicknessTexture&&ne.ThicknessTextureEnabled&&e.setTexture("thicknessSampler",this._thicknessTexture),this._refractionIntensityTexture&&ne.RefractionIntensityTextureEnabled&&s.SS_REFRACTIONINTENSITY_TEXTURE&&e.setTexture("refractionIntensitySampler",this._refractionIntensityTexture),this._translucencyIntensityTexture&&ne.TranslucencyIntensityTextureEnabled&&s.SS_TRANSLUCENCYINTENSITY_TEXTURE&&e.setTexture("translucencyIntensitySampler",this._translucencyIntensityTexture),h&&ne.RefractionTextureEnabled&&(l?e.setTexture("refractionSampler",h):(e.setTexture("refractionSampler",h._lodTextureMid||h),e.setTexture("refractionSamplerLow",h._lodTextureLow||h),e.setTexture("refractionSamplerHigh",h._lodTextureHigh||h))))}_getRefractionTexture(e){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?e.environmentTexture:null}get disableAlphaBlending(){return this._isRefractionEnabled&&this._linkRefractionWithTransparency}fillRenderTargetTextures(e){ne.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&e.push(this._refractionTexture)}hasTexture(e){return this._thicknessTexture===e||this._refractionTexture===e||this._refractionIntensityTexture===e||this._translucencyIntensityTexture===e}hasRenderTargetTextures(){return!!(ne.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)}getActiveTextures(e){this._thicknessTexture&&e.push(this._thicknessTexture),this._refractionTexture&&e.push(this._refractionTexture)}getAnimatables(e){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&e.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&e.push(this._refractionTexture)}dispose(e){e&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose())}getClassName(){return"PBRSubSurfaceConfiguration"}addFallbacks(e,t,i){return e.SS_SCATTERING&&t.addFallback(i++,"SS_SCATTERING"),e.SS_TRANSLUCENCY&&t.addFallback(i++,"SS_TRANSLUCENCY"),i}getSamplers(e){e.push("thicknessSampler","refractionIntensitySampler","translucencyIntensitySampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh")}getUniforms(){return{ubo:[{name:"vRefractionMicrosurfaceInfos",size:4,type:"vec4"},{name:"vRefractionFilteringInfo",size:2,type:"vec2"},{name:"vTranslucencyIntensityInfos",size:2,type:"vec2"},{name:"vRefractionInfos",size:4,type:"vec4"},{name:"refractionMatrix",size:16,type:"mat4"},{name:"vThicknessInfos",size:2,type:"vec2"},{name:"vRefractionIntensityInfos",size:2,type:"vec2"},{name:"thicknessMatrix",size:16,type:"mat4"},{name:"refractionIntensityMatrix",size:16,type:"mat4"},{name:"translucencyIntensityMatrix",size:16,type:"mat4"},{name:"vThicknessParam",size:2,type:"vec2"},{name:"vDiffusionDistance",size:3,type:"vec3"},{name:"vTintColor",size:4,type:"vec4"},{name:"vSubSurfaceIntensity",size:3,type:"vec3"},{name:"vRefractionPosition",size:3,type:"vec3"},{name:"vRefractionSize",size:3,type:"vec3"},{name:"scatteringDiffusionProfile",size:1,type:"float"},{name:"dispersion",size:1,type:"float"}]}}}M([V(),ae("_markAllSubMeshesAsTexturesDirty")],Yt.prototype,"isRefractionEnabled",void 0);M([V(),ae("_markAllSubMeshesAsTexturesDirty")],Yt.prototype,"isTranslucencyEnabled",void 0);M([V(),ae("_markAllSubMeshesAsTexturesDirty")],Yt.prototype,"isDispersionEnabled",void 0);M([V(),ae("_markScenePrePassDirty")],Yt.prototype,"isScatteringEnabled",void 0);M([V()],Yt.prototype,"_scatteringDiffusionProfileIndex",void 0);M([V()],Yt.prototype,"refractionIntensity",void 0);M([V()],Yt.prototype,"translucencyIntensity",void 0);M([V()],Yt.prototype,"useAlbedoToTintRefraction",void 0);M([V()],Yt.prototype,"useAlbedoToTintTranslucency",void 0);M([Tt(),ae("_markAllSubMeshesAsTexturesDirty")],Yt.prototype,"thicknessTexture",void 0);M([Tt(),ae("_markAllSubMeshesAsTexturesDirty")],Yt.prototype,"refractionTexture",void 0);M([V(),ae("_markAllSubMeshesAsTexturesDirty")],Yt.prototype,"indexOfRefraction",void 0);M([V()],Yt.prototype,"_volumeIndexOfRefraction",void 0);M([ae("_markAllSubMeshesAsTexturesDirty")],Yt.prototype,"volumeIndexOfRefraction",null);M([V(),ae("_markAllSubMeshesAsTexturesDirty")],Yt.prototype,"invertRefractionY",void 0);M([V(),ae("_markAllSubMeshesAsTexturesDirty")],Yt.prototype,"linkRefractionWithTransparency",void 0);M([V()],Yt.prototype,"minimumThickness",void 0);M([V()],Yt.prototype,"maximumThickness",void 0);M([V()],Yt.prototype,"useThicknessAsDepth",void 0);M([sr()],Yt.prototype,"tintColor",void 0);M([V()],Yt.prototype,"tintColorAtDistance",void 0);M([V()],Yt.prototype,"dispersion",void 0);M([sr()],Yt.prototype,"diffusionDistance",void 0);M([V(),ae("_markAllSubMeshesAsTexturesDirty")],Yt.prototype,"useMaskFromThicknessTexture",void 0);M([Tt(),ae("_markAllSubMeshesAsTexturesDirty")],Yt.prototype,"refractionIntensityTexture",void 0);M([Tt(),ae("_markAllSubMeshesAsTexturesDirty")],Yt.prototype,"translucencyIntensityTexture",void 0);M([V(),ae("_markAllSubMeshesAsTexturesDirty")],Yt.prototype,"useGltfStyleTextures",void 0);const no={effect:null,subMesh:null};class Pg extends is{constructor(e){super(e),this.PBR=!0,this.NUM_SAMPLES="0",this.REALTIME_FILTERING=!1,this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.ALBEDO=!1,this.GAMMAALBEDO=!1,this.ALBEDODIRECTUV=0,this.VERTEXCOLOR=!1,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.AMBIENTINGRAYSCALE=!1,this.OPACITY=!1,this.VERTEXALPHA=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHABLEND=!1,this.ALPHAFROMALBEDO=!1,this.ALPHATESTVALUE="0.5",this.SPECULAROVERALPHA=!1,this.RADIANCEOVERALPHA=!1,this.ALPHAFRESNEL=!1,this.LINEARALPHAFRESNEL=!1,this.PREMULTIPLYALPHA=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.GAMMAEMISSIVE=!1,this.REFLECTIVITY=!1,this.REFLECTIVITY_GAMMA=!1,this.REFLECTIVITYDIRECTUV=0,this.SPECULARTERM=!1,this.MICROSURFACEFROMREFLECTIVITYMAP=!1,this.MICROSURFACEAUTOMATIC=!1,this.LODBASEDMICROSFURACE=!1,this.MICROSURFACEMAP=!1,this.MICROSURFACEMAPDIRECTUV=0,this.METALLICWORKFLOW=!1,this.ROUGHNESSSTOREINMETALMAPALPHA=!1,this.ROUGHNESSSTOREINMETALMAPGREEN=!1,this.METALLNESSSTOREINMETALMAPBLUE=!1,this.AOSTOREINMETALMAPRED=!1,this.METALLIC_REFLECTANCE=!1,this.METALLIC_REFLECTANCE_GAMMA=!1,this.METALLIC_REFLECTANCEDIRECTUV=0,this.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=!1,this.REFLECTANCE=!1,this.REFLECTANCE_GAMMA=!1,this.REFLECTANCEDIRECTUV=0,this.ENVIRONMENTBRDF=!1,this.ENVIRONMENTBRDF_RGBD=!1,this.NORMAL=!1,this.TANGENT=!1,this.BUMP=!1,this.BUMPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.NORMALXYSCALE=!0,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.USELIGHTMAPASSHADOWMAP=!1,this.GAMMALIGHTMAP=!1,this.RGBDLIGHTMAP=!1,this.REFLECTION=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.INVERTCUBICMAP=!1,this.USESPHERICALFROMREFLECTIONMAP=!1,this.USEIRRADIANCEMAP=!1,this.USESPHERICALINVERTEX=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.LODINREFLECTIONALPHA=!1,this.GAMMAREFLECTION=!1,this.RGBDREFLECTION=!1,this.LINEARSPECULARREFLECTION=!1,this.RADIANCEOCCLUSION=!1,this.HORIZONOCCLUSION=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.PREPASS=!1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.NONUNIFORMSCALING=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=!1,this.TONEMAPPING_ACES=!1,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.EXPOSURE=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.USEPHYSICALLIGHTFALLOFF=!1,this.USEGLTFLIGHTFALLOFF=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.LOGARITHMICDEPTH=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.FORCENORMALFORWARD=!1,this.SPECULARAA=!1,this.UNLIT=!1,this.DECAL_AFTER_DETAIL=!1,this.DEBUGMODE=0,this.rebuild()}reset(){super.reset(),this.ALPHATESTVALUE="0.5",this.PBR=!0,this.NORMALXYSCALE=!0}}class Nt extends qh{get realTimeFiltering(){return this._realTimeFiltering}set realTimeFiltering(e){this._realTimeFiltering=e,this.markAsDirty(1)}get realTimeFilteringQuality(){return this._realTimeFilteringQuality}set realTimeFilteringQuality(e){this._realTimeFilteringQuality=e,this.markAsDirty(1)}get canRenderToMRT(){return!0}_attachImageProcessingConfiguration(e){e!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),e?this._imageProcessingConfiguration=e:this._imageProcessingConfiguration=this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add(()=>{this._markAllSubMeshesAsImageProcessingDirty()})))}constructor(e,t){super(e,t),this._directIntensity=1,this._emissiveIntensity=1,this._environmentIntensity=1,this._specularIntensity=1,this._lightingInfos=new Ke(this._directIntensity,this._emissiveIntensity,this._environmentIntensity,this._specularIntensity),this._disableBumpMap=!1,this._albedoTexture=null,this._ambientTexture=null,this._ambientTextureStrength=1,this._ambientTextureImpactOnAnalyticalLights=Nt.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._reflectivityTexture=null,this._metallicTexture=null,this._metallic=null,this._roughness=null,this._metallicF0Factor=1,this._metallicReflectanceColor=De.White(),this._useOnlyMetallicFromMetallicReflectanceTexture=!1,this._metallicReflectanceTexture=null,this._reflectanceTexture=null,this._microSurfaceTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._ambientColor=new De(0,0,0),this._albedoColor=new De(1,1,1),this._reflectivityColor=new De(1,1,1),this._reflectionColor=new De(1,1,1),this._emissiveColor=new De(0,0,0),this._microSurface=.9,this._useLightmapAsShadowmap=!1,this._useHorizonOcclusion=!0,this._useRadianceOcclusion=!0,this._useAlphaFromAlbedoTexture=!1,this._useSpecularOverAlpha=!0,this._useMicroSurfaceFromReflectivityMapAlpha=!1,this._useRoughnessFromMetallicTextureAlpha=!0,this._useRoughnessFromMetallicTextureGreen=!1,this._useMetallnessFromMetallicTextureBlue=!1,this._useAmbientOcclusionFromMetallicTextureRed=!1,this._useAmbientInGrayScale=!1,this._useAutoMicroSurfaceFromReflectivityMap=!1,this._lightFalloff=Nt.LIGHTFALLOFF_PHYSICAL,this._useRadianceOverAlpha=!0,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this._parallaxScaleBias=.05,this._disableLighting=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._alphaCutOff=.4,this._forceAlphaTest=!1,this._useAlphaFresnel=!1,this._useLinearAlphaFresnel=!1,this._environmentBRDFTexture=null,this._forceIrradianceInFragment=!1,this._realTimeFiltering=!1,this._realTimeFilteringQuality=8,this._forceNormalForward=!1,this._enableSpecularAntiAliasing=!1,this._imageProcessingObserver=null,this._renderTargets=new Vi(16),this._globalAmbientColor=new De(0,0,0),this._unlit=!1,this._applyDecalMapAfterDetailMap=!1,this._debugMode=0,this.debugMode=0,this.debugLimit=-1,this.debugFactor=1,this._cacheHasRenderTargetTextures=!1,this.brdf=new Ui(this),this.clearCoat=new bi(this),this.iridescence=new dr(this),this.anisotropy=new Yo(this),this.sheen=new Rs(this),this.subSurface=new Yt(this),this.detailMap=new _n(this),this._attachImageProcessingConfiguration(null),this.getRenderTargetTextures=()=>(this._renderTargets.reset(),ne.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets),this._environmentBRDFTexture=X0(this.getScene()),this.prePassConfiguration=new mh}get hasRenderTargetTextures(){return ne.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget?!0:this._cacheHasRenderTargetTextures}get isPrePassCapable(){return!this.disableDepthWrite}getClassName(){return"PBRBaseMaterial"}get _disableAlphaBlending(){var e;return this._transparencyMode===Nt.PBRMATERIAL_OPAQUE||this._transparencyMode===Nt.PBRMATERIAL_ALPHATEST||((e=this.subSurface)==null?void 0:e.disableAlphaBlending)}needAlphaBlending(){return this._disableAlphaBlending?!1:this.alpha<1||this._opacityTexture!=null||this._shouldUseAlphaFromAlbedoTexture()}needAlphaTesting(){var e;return this._forceAlphaTest?!0:(e=this.subSurface)!=null&&e.disableAlphaBlending?!1:this._hasAlphaChannel()&&(this._transparencyMode==null||this._transparencyMode===Nt.PBRMATERIAL_ALPHATEST)}_shouldUseAlphaFromAlbedoTexture(){return this._albedoTexture!=null&&this._albedoTexture.hasAlpha&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==Nt.PBRMATERIAL_OPAQUE}_hasAlphaChannel(){return this._albedoTexture!=null&&this._albedoTexture.hasAlpha||this._opacityTexture!=null}getAlphaTestTexture(){return this._albedoTexture}isReadyForSubMesh(e,t,i){var r;this._uniformBufferLayoutBuilt||this.buildUniformLayout();const s=t._drawWrapper;if(s.effect&&this.isFrozen&&s._wasPreviouslyReady&&s._wasPreviouslyUsingInstances===i)return!0;t.materialDefines||(this._callbackPluginEventGeneric(yi.GetDefineNames,this._eventInfo),t.materialDefines=new Pg(this._eventInfo.defineNames));const o=t.materialDefines;if(this._isReadyForSubMesh(t))return!0;const a=this.getScene(),l=a.getEngine();if(o._areTexturesDirty&&(this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,a.texturesEnabled)){if(this._albedoTexture&&ne.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking()||this._ambientTexture&&ne.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking()||this._opacityTexture&&ne.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;const f=this._getReflectionTexture();if(f&&ne.ReflectionTextureEnabled){if(!f.isReadyOrNotBlocking())return!1;if(f.irradianceTexture){if(!f.irradianceTexture.isReadyOrNotBlocking())return!1}else if(!f.sphericalPolynomial&&(r=f.getInternalTexture())!=null&&r._sphericalPolynomialPromise)return!1}if(this._lightmapTexture&&ne.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking()||this._emissiveTexture&&ne.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(ne.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._metallicReflectanceTexture&&!this._metallicReflectanceTexture.isReadyOrNotBlocking()||this._reflectanceTexture&&!this._reflectanceTexture.isReadyOrNotBlocking()||this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(l.getCaps().standardDerivatives&&this._bumpTexture&&ne.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady()||this._environmentBRDFTexture&&ne.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=o,this._eventInfo.subMesh=t,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh||o._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;!l.getCaps().standardDerivatives&&!e.isVerticesDataPresent(b.NormalKind)&&(e.createNormals(!0),oe.Warn("PBRMaterial: Normals have been created for the mesh: "+e.name));const h=t.effect,c=o._areLightsDisposed;let u=this._prepareEffect(e,o,this.onCompiled,this.onError,i,null,t.getRenderingMesh().hasThinInstances),d=!1;if(u)if(this._onEffectCreatedObservable&&(no.effect=u,no.subMesh=t,this._onEffectCreatedObservable.notifyObservers(no)),this.allowShaderHotSwapping&&h&&!u.isReady()){if(u=h,o.markAsUnprocessed(),d=this.isFrozen,c)return o._areLightsDisposed=!0,!1}else a.resetCachedMaterial(),t.setEffect(u,o,this._materialContext);return!t.effect||!t.effect.isReady()?!1:(o._renderId=a.getRenderId(),s._wasPreviouslyReady=!d,s._wasPreviouslyUsingInstances=!!i,this._checkScenePerformancePriority(),!0)}isMetallicWorkflow(){return!!(this._metallic!=null||this._roughness!=null||this._metallicTexture)}_prepareEffect(e,t,i=null,r=null,s=null,o=null,a){if(this._prepareDefines(e,t,s,o,a),!t.isDirty)return null;t.markAsProcessed();const l=this.getScene().getEngine(),h=new bd;let c=0;t.USESPHERICALINVERTEX&&h.addFallback(c++,"USESPHERICALINVERTEX"),t.FOG&&h.addFallback(c,"FOG"),t.SPECULARAA&&h.addFallback(c,"SPECULARAA"),t.POINTSIZE&&h.addFallback(c,"POINTSIZE"),t.LOGARITHMICDEPTH&&h.addFallback(c,"LOGARITHMICDEPTH"),t.PARALLAX&&h.addFallback(c,"PARALLAX"),t.PARALLAX_RHS&&h.addFallback(c,"PARALLAX_RHS"),t.PARALLAXOCCLUSION&&h.addFallback(c++,"PARALLAXOCCLUSION"),t.ENVIRONMENTBRDF&&h.addFallback(c++,"ENVIRONMENTBRDF"),t.TANGENT&&h.addFallback(c++,"TANGENT"),t.BUMP&&h.addFallback(c++,"BUMP"),c=E0(t,h,this._maxSimultaneousLights,c++),t.SPECULARTERM&&h.addFallback(c++,"SPECULARTERM"),t.USESPHERICALFROMREFLECTIONMAP&&h.addFallback(c++,"USESPHERICALFROMREFLECTIONMAP"),t.USEIRRADIANCEMAP&&h.addFallback(c++,"USEIRRADIANCEMAP"),t.LIGHTMAP&&h.addFallback(c++,"LIGHTMAP"),t.NORMAL&&h.addFallback(c++,"NORMAL"),t.AMBIENT&&h.addFallback(c++,"AMBIENT"),t.EMISSIVE&&h.addFallback(c++,"EMISSIVE"),t.VERTEXCOLOR&&h.addFallback(c++,"VERTEXCOLOR"),t.MORPHTARGETS&&h.addFallback(c++,"MORPHTARGETS"),t.MULTIVIEW&&h.addFallback(0,"MULTIVIEW");const u=[b.PositionKind];t.NORMAL&&u.push(b.NormalKind),t.TANGENT&&u.push(b.TangentKind);for(let C=1;C<=6;++C)t["UV"+C]&&u.push(`uv${C===1?"":C}`);t.VERTEXCOLOR&&u.push(b.ColorKind),v0(u,e,t,h),Td(u,t),p0(u,e,t),vd(u,e,t);let d="pbr";const f=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","vReflectivityColor","vMetallicReflectanceFactors","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vReflectionFilteringInfo","vMetallicReflectanceInfos","vReflectanceInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","albedoMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","metallicReflectanceMatrix","reflectanceMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vTangentSpaceParams","boneTextureWidth","vDebugMode","morphTargetTextureInfo","morphTargetTextureIndices"],p=["albedoSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","irradianceSampler","microSurfaceSampler","environmentBrdfSampler","boneSampler","metallicReflectanceSampler","reflectanceSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"],g=["Material","Scene","Mesh"],m={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:t.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=h,this._eventInfo.fallbackRank=c,this._eventInfo.defines=t,this._eventInfo.uniforms=f,this._eventInfo.attributes=u,this._eventInfo.samplers=p,this._eventInfo.uniformBuffersNames=g,this._eventInfo.customCode=void 0,this._eventInfo.mesh=e,this._eventInfo.indexParameters=m,this._callbackPluginEventGeneric(yi.PrepareEffect,this._eventInfo),mh.AddUniforms(f),Wh(f),nt&&(nt.PrepareUniforms(f,t),nt.PrepareSamplers(p,t)),Sd({uniformsNames:f,uniformBuffersNames:g,samplers:p,defines:t,maxSimultaneousLights:this._maxSimultaneousLights});const x={};this.customShaderNameResolve&&(d=this.customShaderNameResolve(d,f,g,p,t,u,x));const E=t.toString(),R=l.createEffect(d,{attributes:u,uniformsNames:f,uniformBuffersNames:g,samplers:p,defines:E,fallbacks:h,onCompiled:i,onError:r,indexParameters:m,processFinalCode:x.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:t.PREPASS},l);return this._eventInfo.customCode=void 0,R}_prepareDefines(e,t,i=null,r=null,s=!1){var o;const a=this.getScene(),l=a.getEngine();T0(a,e,t,!0,this._maxSimultaneousLights,this._disableLighting),t._needNormals=!0,x0(a,t);const h=this.needAlphaBlendingForMesh(e)&&this.getScene().useOrderIndependentTransparency;if(R0(a,t,this.canRenderToMRT&&!h),C0(a,t,h),t.METALLICWORKFLOW=this.isMetallicWorkflow(),t._areTexturesDirty){t._needUVs=!1;for(let c=1;c<=6;++c)t["MAINUV"+c]=!1;if(a.texturesEnabled){t.ALBEDODIRECTUV=0,t.AMBIENTDIRECTUV=0,t.OPACITYDIRECTUV=0,t.EMISSIVEDIRECTUV=0,t.REFLECTIVITYDIRECTUV=0,t.MICROSURFACEMAPDIRECTUV=0,t.METALLIC_REFLECTANCEDIRECTUV=0,t.REFLECTANCEDIRECTUV=0,t.BUMPDIRECTUV=0,t.LIGHTMAPDIRECTUV=0,l.getCaps().textureLOD&&(t.LODBASEDMICROSFURACE=!0),this._albedoTexture&&ne.DiffuseTextureEnabled?(wt(this._albedoTexture,t,"ALBEDO"),t.GAMMAALBEDO=this._albedoTexture.gammaSpace):t.ALBEDO=!1,this._ambientTexture&&ne.AmbientTextureEnabled?(wt(this._ambientTexture,t,"AMBIENT"),t.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):t.AMBIENT=!1,this._opacityTexture&&ne.OpacityTextureEnabled?(wt(this._opacityTexture,t,"OPACITY"),t.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):t.OPACITY=!1;const c=this._getReflectionTexture();if(c&&ne.ReflectionTextureEnabled){switch(t.REFLECTION=!0,t.GAMMAREFLECTION=c.gammaSpace,t.RGBDREFLECTION=c.isRGBD,t.LODINREFLECTIONALPHA=c.lodLevelInAlpha,t.LINEARSPECULARREFLECTION=c.linearSpecularLOD,this.realTimeFiltering&&this.realTimeFilteringQuality>0?(t.NUM_SAMPLES=""+this.realTimeFilteringQuality,l._features.needTypeSuffixInShaderConstants&&(t.NUM_SAMPLES=t.NUM_SAMPLES+"u"),t.REALTIME_FILTERING=!0):t.REALTIME_FILTERING=!1,t.INVERTCUBICMAP=c.coordinatesMode===le.INVCUBIC_MODE,t.REFLECTIONMAP_3D=c.isCube,t.REFLECTIONMAP_OPPOSITEZ=t.REFLECTIONMAP_3D&&this.getScene().useRightHandedSystem?!c.invertZ:c.invertZ,t.REFLECTIONMAP_CUBIC=!1,t.REFLECTIONMAP_EXPLICIT=!1,t.REFLECTIONMAP_PLANAR=!1,t.REFLECTIONMAP_PROJECTION=!1,t.REFLECTIONMAP_SKYBOX=!1,t.REFLECTIONMAP_SPHERICAL=!1,t.REFLECTIONMAP_EQUIRECTANGULAR=!1,t.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,t.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,c.coordinatesMode){case le.EXPLICIT_MODE:t.REFLECTIONMAP_EXPLICIT=!0;break;case le.PLANAR_MODE:t.REFLECTIONMAP_PLANAR=!0;break;case le.PROJECTION_MODE:t.REFLECTIONMAP_PROJECTION=!0;break;case le.SKYBOX_MODE:t.REFLECTIONMAP_SKYBOX=!0;break;case le.SPHERICAL_MODE:t.REFLECTIONMAP_SPHERICAL=!0;break;case le.EQUIRECTANGULAR_MODE:t.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case le.FIXED_EQUIRECTANGULAR_MODE:t.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case le.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:t.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case le.CUBIC_MODE:case le.INVCUBIC_MODE:default:t.REFLECTIONMAP_CUBIC=!0,t.USE_LOCAL_REFLECTIONMAP_CUBIC=!!c.boundingBoxSize;break}c.coordinatesMode!==le.SKYBOX_MODE&&(c.irradianceTexture?(t.USEIRRADIANCEMAP=!0,t.USESPHERICALFROMREFLECTIONMAP=!1):c.isCube&&(t.USESPHERICALFROMREFLECTIONMAP=!0,t.USEIRRADIANCEMAP=!1,this._forceIrradianceInFragment||this.realTimeFiltering||this._twoSidedLighting||l.getCaps().maxVaryingVectors<=8?t.USESPHERICALINVERTEX=!1:t.USESPHERICALINVERTEX=!0))}else t.REFLECTION=!1,t.REFLECTIONMAP_3D=!1,t.REFLECTIONMAP_SPHERICAL=!1,t.REFLECTIONMAP_PLANAR=!1,t.REFLECTIONMAP_CUBIC=!1,t.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,t.REFLECTIONMAP_PROJECTION=!1,t.REFLECTIONMAP_SKYBOX=!1,t.REFLECTIONMAP_EXPLICIT=!1,t.REFLECTIONMAP_EQUIRECTANGULAR=!1,t.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,t.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,t.INVERTCUBICMAP=!1,t.USESPHERICALFROMREFLECTIONMAP=!1,t.USEIRRADIANCEMAP=!1,t.USESPHERICALINVERTEX=!1,t.REFLECTIONMAP_OPPOSITEZ=!1,t.LODINREFLECTIONALPHA=!1,t.GAMMAREFLECTION=!1,t.RGBDREFLECTION=!1,t.LINEARSPECULARREFLECTION=!1;if(this._lightmapTexture&&ne.LightmapTextureEnabled?(wt(this._lightmapTexture,t,"LIGHTMAP"),t.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,t.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace,t.RGBDLIGHTMAP=this._lightmapTexture.isRGBD):t.LIGHTMAP=!1,this._emissiveTexture&&ne.EmissiveTextureEnabled?(wt(this._emissiveTexture,t,"EMISSIVE"),t.GAMMAEMISSIVE=this._emissiveTexture.gammaSpace):t.EMISSIVE=!1,ne.SpecularTextureEnabled){if(this._metallicTexture?(wt(this._metallicTexture,t,"REFLECTIVITY"),t.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,t.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,t.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,t.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed,t.REFLECTIVITY_GAMMA=!1):this._reflectivityTexture?(wt(this._reflectivityTexture,t,"REFLECTIVITY"),t.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,t.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap,t.REFLECTIVITY_GAMMA=this._reflectivityTexture.gammaSpace):t.REFLECTIVITY=!1,this._metallicReflectanceTexture||this._reflectanceTexture){const u=this._metallicReflectanceTexture!==null&&this._metallicReflectanceTexture._texture===((o=this._reflectanceTexture)==null?void 0:o._texture)&&this._metallicReflectanceTexture.checkTransformsAreIdentical(this._reflectanceTexture);t.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=this._useOnlyMetallicFromMetallicReflectanceTexture&&!u,this._metallicReflectanceTexture?(wt(this._metallicReflectanceTexture,t,"METALLIC_REFLECTANCE"),t.METALLIC_REFLECTANCE_GAMMA=this._metallicReflectanceTexture.gammaSpace):t.METALLIC_REFLECTANCE=!1,this._reflectanceTexture&&!u&&(!this._metallicReflectanceTexture||this._metallicReflectanceTexture&&this._useOnlyMetallicFromMetallicReflectanceTexture)?(wt(this._reflectanceTexture,t,"REFLECTANCE"),t.REFLECTANCE_GAMMA=this._reflectanceTexture.gammaSpace):t.REFLECTANCE=!1}else t.METALLIC_REFLECTANCE=!1,t.REFLECTANCE=!1;this._microSurfaceTexture?wt(this._microSurfaceTexture,t,"MICROSURFACEMAP"):t.MICROSURFACEMAP=!1}else t.REFLECTIVITY=!1,t.MICROSURFACEMAP=!1;l.getCaps().standardDerivatives&&this._bumpTexture&&ne.BumpTextureEnabled&&!this._disableBumpMap?(wt(this._bumpTexture,t,"BUMP"),this._useParallax&&this._albedoTexture&&ne.DiffuseTextureEnabled?(t.PARALLAX=!0,t.PARALLAX_RHS=a.useRightHandedSystem,t.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):t.PARALLAX=!1,t.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):(t.BUMP=!1,t.PARALLAX=!1,t.PARALLAX_RHS=!1,t.PARALLAXOCCLUSION=!1,t.OBJECTSPACE_NORMALMAP=!1),this._environmentBRDFTexture&&ne.ReflectionTextureEnabled?(t.ENVIRONMENTBRDF=!0,t.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(t.ENVIRONMENTBRDF=!1,t.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?t.ALPHAFROMALBEDO=!0:t.ALPHAFROMALBEDO=!1}t.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===Nt.LIGHTFALLOFF_STANDARD?(t.USEPHYSICALLIGHTFALLOFF=!1,t.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===Nt.LIGHTFALLOFF_GLTF?(t.USEPHYSICALLIGHTFALLOFF=!1,t.USEGLTFLIGHTFALLOFF=!0):(t.USEPHYSICALLIGHTFALLOFF=!0,t.USEGLTFLIGHTFALLOFF=!1),t.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.backFaceCulling&&this._twoSidedLighting?t.TWOSIDEDLIGHTING=!0:t.TWOSIDEDLIGHTING=!1,t.SPECULARAA=l.getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}(t._areTexturesDirty||t._areMiscDirty)&&(t.ALPHATESTVALUE=`${this._alphaCutOff}${this._alphaCutOff%1===0?".":""}`,t.PREMULTIPLYALPHA=this.alphaMode===7||this.alphaMode===8,t.ALPHABLEND=this.needAlphaBlendingForMesh(e),t.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,t.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel),t._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(t),t.FORCENORMALFORWARD=this._forceNormalForward,t.RADIANCEOCCLUSION=this._useRadianceOcclusion,t.HORIZONOCCLUSION=this._useHorizonOcclusion,t._areMiscDirty&&(xd(e,a,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e)||this._forceAlphaTest,t,this._applyDecalMapAfterDetailMap),t.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!e.isVerticesDataPresent(b.NormalKind),t.DEBUGMODE=this._debugMode),Cd(a,l,this,t,!!i,r,s),this._eventInfo.defines=t,this._eventInfo.mesh=e,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),Rd(e,t,!0,!0,!0,this._transparencyMode!==Nt.PBRMATERIAL_OPAQUE),this._callbackPluginEventPrepareDefines(this._eventInfo)}forceCompilation(e,t,i){const r={clipPlane:!1,useInstances:!1,...i};this._uniformBufferLayoutBuilt||this.buildUniformLayout(),this._callbackPluginEventGeneric(yi.GetDefineNames,this._eventInfo);const s=new Pg(this._eventInfo.defineNames),o=this._prepareEffect(e,s,void 0,void 0,r.useInstances,r.clipPlane,e.hasThinInstances);this._onEffectCreatedObservable&&(no.effect=o,no.subMesh=null,this._onEffectCreatedObservable.notifyObservers(no)),o.isReady()?t&&t(this):o.onCompileObservable.add(()=>{t&&t(this)})}buildUniformLayout(){const e=this._uniformBuffer;e.addUniform("vAlbedoInfos",2),e.addUniform("vAmbientInfos",4),e.addUniform("vOpacityInfos",2),e.addUniform("vEmissiveInfos",2),e.addUniform("vLightmapInfos",2),e.addUniform("vReflectivityInfos",3),e.addUniform("vMicroSurfaceSamplerInfos",2),e.addUniform("vReflectionInfos",2),e.addUniform("vReflectionFilteringInfo",2),e.addUniform("vReflectionPosition",3),e.addUniform("vReflectionSize",3),e.addUniform("vBumpInfos",3),e.addUniform("albedoMatrix",16),e.addUniform("ambientMatrix",16),e.addUniform("opacityMatrix",16),e.addUniform("emissiveMatrix",16),e.addUniform("lightmapMatrix",16),e.addUniform("reflectivityMatrix",16),e.addUniform("microSurfaceSamplerMatrix",16),e.addUniform("bumpMatrix",16),e.addUniform("vTangentSpaceParams",2),e.addUniform("reflectionMatrix",16),e.addUniform("vReflectionColor",3),e.addUniform("vAlbedoColor",4),e.addUniform("vLightingIntensity",4),e.addUniform("vReflectionMicrosurfaceInfos",3),e.addUniform("pointSize",1),e.addUniform("vReflectivityColor",4),e.addUniform("vEmissiveColor",3),e.addUniform("vAmbientColor",3),e.addUniform("vDebugMode",2),e.addUniform("vMetallicReflectanceFactors",4),e.addUniform("vMetallicReflectanceInfos",2),e.addUniform("metallicReflectanceMatrix",16),e.addUniform("vReflectanceInfos",2),e.addUniform("reflectanceMatrix",16),e.addUniform("vSphericalL00",3),e.addUniform("vSphericalL1_1",3),e.addUniform("vSphericalL10",3),e.addUniform("vSphericalL11",3),e.addUniform("vSphericalL2_2",3),e.addUniform("vSphericalL2_1",3),e.addUniform("vSphericalL20",3),e.addUniform("vSphericalL21",3),e.addUniform("vSphericalL22",3),e.addUniform("vSphericalX",3),e.addUniform("vSphericalY",3),e.addUniform("vSphericalZ",3),e.addUniform("vSphericalXX_ZZ",3),e.addUniform("vSphericalYY_ZZ",3),e.addUniform("vSphericalZZ",3),e.addUniform("vSphericalXY",3),e.addUniform("vSphericalYZ",3),e.addUniform("vSphericalZX",3),super.buildUniformLayout()}bindForSubMesh(e,t,i){var r,s,o;const a=this.getScene(),l=i.materialDefines;if(!l)return;const h=i.effect;if(!h)return;this._activeEffect=h,t.getMeshUniformBuffer().bindToEffect(h,"Mesh"),t.transferToEffect(e);const c=a.getEngine();this._uniformBuffer.bindToEffect(h,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,a,t,e,this.isFrozen),this._eventInfo.subMesh=i,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),l.OBJECTSPACE_NORMALMAP&&(e.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const u=this._mustRebind(a,h,i,t.visibility);Ed(t,this._activeEffect,this.prePassConfiguration);let d=null;const f=this._uniformBuffer;if(u){if(this.bindViewProjection(h),d=this._getReflectionTexture(),!f.useUbo||!this.isFrozen||!f.isSync||i._drawWrapper._forceRebindOnNextCall){if(a.texturesEnabled){if(this._albedoTexture&&ne.DiffuseTextureEnabled&&(f.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),At(this._albedoTexture,f,"albedo")),this._ambientTexture&&ne.AmbientTextureEnabled&&(f.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),At(this._ambientTexture,f,"ambient")),this._opacityTexture&&ne.OpacityTextureEnabled&&(f.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),At(this._opacityTexture,f,"opacity")),d&&ne.ReflectionTextureEnabled){if(f.updateMatrix("reflectionMatrix",d.getReflectionTextureMatrix()),f.updateFloat2("vReflectionInfos",d.level,0),d.boundingBoxSize){const p=d;f.updateVector3("vReflectionPosition",p.boundingBoxPosition),f.updateVector3("vReflectionSize",p.boundingBoxSize)}if(this.realTimeFiltering){const p=d.getSize().width;f.updateFloat2("vReflectionFilteringInfo",p,Ye.Log2(p))}if(!l.USEIRRADIANCEMAP){const p=d.sphericalPolynomial;if(l.USESPHERICALFROMREFLECTIONMAP&&p)if(l.SPHERICAL_HARMONICS){const g=p.preScaledHarmonics;f.updateVector3("vSphericalL00",g.l00),f.updateVector3("vSphericalL1_1",g.l1_1),f.updateVector3("vSphericalL10",g.l10),f.updateVector3("vSphericalL11",g.l11),f.updateVector3("vSphericalL2_2",g.l2_2),f.updateVector3("vSphericalL2_1",g.l2_1),f.updateVector3("vSphericalL20",g.l20),f.updateVector3("vSphericalL21",g.l21),f.updateVector3("vSphericalL22",g.l22)}else f.updateFloat3("vSphericalX",p.x.x,p.x.y,p.x.z),f.updateFloat3("vSphericalY",p.y.x,p.y.y,p.y.z),f.updateFloat3("vSphericalZ",p.z.x,p.z.y,p.z.z),f.updateFloat3("vSphericalXX_ZZ",p.xx.x-p.zz.x,p.xx.y-p.zz.y,p.xx.z-p.zz.z),f.updateFloat3("vSphericalYY_ZZ",p.yy.x-p.zz.x,p.yy.y-p.zz.y,p.yy.z-p.zz.z),f.updateFloat3("vSphericalZZ",p.zz.x,p.zz.y,p.zz.z),f.updateFloat3("vSphericalXY",p.xy.x,p.xy.y,p.xy.z),f.updateFloat3("vSphericalYZ",p.yz.x,p.yz.y,p.yz.z),f.updateFloat3("vSphericalZX",p.zx.x,p.zx.y,p.zx.z)}f.updateFloat3("vReflectionMicrosurfaceInfos",d.getSize().width,d.lodGenerationScale,d.lodGenerationOffset)}this._emissiveTexture&&ne.EmissiveTextureEnabled&&(f.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),At(this._emissiveTexture,f,"emissive")),this._lightmapTexture&&ne.LightmapTextureEnabled&&(f.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),At(this._lightmapTexture,f,"lightmap")),ne.SpecularTextureEnabled&&(this._metallicTexture?(f.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),At(this._metallicTexture,f,"reflectivity")):this._reflectivityTexture&&(f.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),At(this._reflectivityTexture,f,"reflectivity")),this._metallicReflectanceTexture&&(f.updateFloat2("vMetallicReflectanceInfos",this._metallicReflectanceTexture.coordinatesIndex,this._metallicReflectanceTexture.level),At(this._metallicReflectanceTexture,f,"metallicReflectance")),this._reflectanceTexture&&l.REFLECTANCE&&(f.updateFloat2("vReflectanceInfos",this._reflectanceTexture.coordinatesIndex,this._reflectanceTexture.level),At(this._reflectanceTexture,f,"reflectance")),this._microSurfaceTexture&&(f.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),At(this._microSurfaceTexture,f,"microSurfaceSampler"))),this._bumpTexture&&c.getCaps().standardDerivatives&&ne.BumpTextureEnabled&&!this._disableBumpMap&&(f.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),At(this._bumpTexture,f,"bump"),a._mirroredCameraPosition?f.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):f.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}if(this.pointsCloud&&f.updateFloat("pointSize",this.pointSize),l.METALLICWORKFLOW){Qr.Color3[0].r=this._metallic===void 0||this._metallic===null?1:this._metallic,Qr.Color3[0].g=this._roughness===void 0||this._roughness===null?1:this._roughness,f.updateColor4("vReflectivityColor",Qr.Color3[0],1);const p=((r=this.subSurface)==null?void 0:r._indexOfRefraction)??1.5,g=1,m=Math.pow((p-g)/(p+g),2);this._metallicReflectanceColor.scaleToRef(m*this._metallicF0Factor,Qr.Color3[0]);const x=this._metallicF0Factor;f.updateColor4("vMetallicReflectanceFactors",Qr.Color3[0],x)}else f.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface);f.updateColor3("vEmissiveColor",ne.EmissiveTextureEnabled?this._emissiveColor:De.BlackReadOnly),f.updateColor3("vReflectionColor",this._reflectionColor),!l.SS_REFRACTION&&(s=this.subSurface)!=null&&s._linkRefractionWithTransparency?f.updateColor4("vAlbedoColor",this._albedoColor,1):f.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity*a.environmentIntensity,this._lightingInfos.w=this._specularIntensity,f.updateVector4("vLightingIntensity",this._lightingInfos),a.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor),f.updateColor3("vAmbientColor",this._globalAmbientColor),f.updateFloat2("vDebugMode",this.debugLimit,this.debugFactor)}a.texturesEnabled&&(this._albedoTexture&&ne.DiffuseTextureEnabled&&f.setTexture("albedoSampler",this._albedoTexture),this._ambientTexture&&ne.AmbientTextureEnabled&&f.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&ne.OpacityTextureEnabled&&f.setTexture("opacitySampler",this._opacityTexture),d&&ne.ReflectionTextureEnabled&&(l.LODBASEDMICROSFURACE?f.setTexture("reflectionSampler",d):(f.setTexture("reflectionSampler",d._lodTextureMid||d),f.setTexture("reflectionSamplerLow",d._lodTextureLow||d),f.setTexture("reflectionSamplerHigh",d._lodTextureHigh||d)),l.USEIRRADIANCEMAP&&f.setTexture("irradianceSampler",d.irradianceTexture)),l.ENVIRONMENTBRDF&&f.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&ne.EmissiveTextureEnabled&&f.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&ne.LightmapTextureEnabled&&f.setTexture("lightmapSampler",this._lightmapTexture),ne.SpecularTextureEnabled&&(this._metallicTexture?f.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&f.setTexture("reflectivitySampler",this._reflectivityTexture),this._metallicReflectanceTexture&&f.setTexture("metallicReflectanceSampler",this._metallicReflectanceTexture),this._reflectanceTexture&&l.REFLECTANCE&&f.setTexture("reflectanceSampler",this._reflectanceTexture),this._microSurfaceTexture&&f.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&c.getCaps().standardDerivatives&&ne.BumpTextureEnabled&&!this._disableBumpMap&&f.setTexture("bumpSampler",this._bumpTexture)),this.getScene().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(t)&&this.getScene().depthPeelingRenderer.bind(h),this._eventInfo.subMesh=i,this._callbackPluginEventBindForSubMesh(this._eventInfo),Xh(this._activeEffect,this,a),this.bindEyePosition(h)}else a.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);(u||!this.isFrozen)&&(a.lightsEnabled&&!this._disableLighting&&_0(a,t,this._activeEffect,l,this._maxSimultaneousLights),(a.fogEnabled&&t.applyFog&&a.fogMode!==Pt.FOGMODE_NONE||d||this.subSurface.refractionTexture||t.receiveShadows||l.PREPASS)&&this.bindView(h),Kh(a,t,this._activeEffect,!0),l.NUM_MORPH_INFLUENCERS&&_d(t,this._activeEffect),l.BAKED_VERTEX_ANIMATION_TEXTURE&&((o=t.bakedVertexAnimationManager)==null||o.bind(h,l.INSTANCES)),this._imageProcessingConfiguration.bind(this._activeEffect),Hh(l,this._activeEffect,a)),this._afterBind(t,this._activeEffect,i),f.update()}getAnimatables(){const e=super.getAnimatables();return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&e.push(this._albedoTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&e.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&e.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&e.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&e.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?e.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&e.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&e.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&e.push(this._lightmapTexture),this._metallicReflectanceTexture&&this._metallicReflectanceTexture.animations&&this._metallicReflectanceTexture.animations.length>0&&e.push(this._metallicReflectanceTexture),this._reflectanceTexture&&this._reflectanceTexture.animations&&this._reflectanceTexture.animations.length>0&&e.push(this._reflectanceTexture),this._microSurfaceTexture&&this._microSurfaceTexture.animations&&this._microSurfaceTexture.animations.length>0&&e.push(this._microSurfaceTexture),e}_getReflectionTexture(){return this._reflectionTexture?this._reflectionTexture:this.getScene().environmentTexture}getActiveTextures(){const e=super.getActiveTextures();return this._albedoTexture&&e.push(this._albedoTexture),this._ambientTexture&&e.push(this._ambientTexture),this._opacityTexture&&e.push(this._opacityTexture),this._reflectionTexture&&e.push(this._reflectionTexture),this._emissiveTexture&&e.push(this._emissiveTexture),this._reflectivityTexture&&e.push(this._reflectivityTexture),this._metallicTexture&&e.push(this._metallicTexture),this._metallicReflectanceTexture&&e.push(this._metallicReflectanceTexture),this._reflectanceTexture&&e.push(this._reflectanceTexture),this._microSurfaceTexture&&e.push(this._microSurfaceTexture),this._bumpTexture&&e.push(this._bumpTexture),this._lightmapTexture&&e.push(this._lightmapTexture),e}hasTexture(e){return!!(super.hasTexture(e)||this._albedoTexture===e||this._ambientTexture===e||this._opacityTexture===e||this._reflectionTexture===e||this._emissiveTexture===e||this._reflectivityTexture===e||this._metallicTexture===e||this._metallicReflectanceTexture===e||this._reflectanceTexture===e||this._microSurfaceTexture===e||this._bumpTexture===e||this._lightmapTexture===e)}setPrePassRenderer(){var e;if(!((e=this.subSurface)!=null&&e.isScatteringEnabled))return!1;const t=this.getScene().enableSubSurfaceForPrePass();return t&&(t.enabled=!0),!0}dispose(e,t){var i,r,s,o,a,l,h,c,u,d,f,p;t&&(this._environmentBRDFTexture&&this.getScene().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),(i=this._albedoTexture)==null||i.dispose(),(r=this._ambientTexture)==null||r.dispose(),(s=this._opacityTexture)==null||s.dispose(),(o=this._reflectionTexture)==null||o.dispose(),(a=this._emissiveTexture)==null||a.dispose(),(l=this._metallicTexture)==null||l.dispose(),(h=this._reflectivityTexture)==null||h.dispose(),(c=this._bumpTexture)==null||c.dispose(),(u=this._lightmapTexture)==null||u.dispose(),(d=this._metallicReflectanceTexture)==null||d.dispose(),(f=this._reflectanceTexture)==null||f.dispose(),(p=this._microSurfaceTexture)==null||p.dispose()),this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(e,t)}}Nt.PBRMATERIAL_OPAQUE=ie.MATERIAL_OPAQUE;Nt.PBRMATERIAL_ALPHATEST=ie.MATERIAL_ALPHATEST;Nt.PBRMATERIAL_ALPHABLEND=ie.MATERIAL_ALPHABLEND;Nt.PBRMATERIAL_ALPHATESTANDBLEND=ie.MATERIAL_ALPHATESTANDBLEND;Nt.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0;Nt.LIGHTFALLOFF_PHYSICAL=0;Nt.LIGHTFALLOFF_GLTF=1;Nt.LIGHTFALLOFF_STANDARD=2;M([Cy()],Nt.prototype,"_imageProcessingConfiguration",void 0);M([ae("_markAllSubMeshesAsMiscDirty")],Nt.prototype,"debugMode",void 0);class we extends Nt{get refractionTexture(){return this.subSurface.refractionTexture}set refractionTexture(e){this.subSurface.refractionTexture=e,e?this.subSurface.isRefractionEnabled=!0:this.subSurface.linkRefractionWithTransparency||(this.subSurface.isRefractionEnabled=!1)}get indexOfRefraction(){return this.subSurface.indexOfRefraction}set indexOfRefraction(e){this.subSurface.indexOfRefraction=e}get invertRefractionY(){return this.subSurface.invertRefractionY}set invertRefractionY(e){this.subSurface.invertRefractionY=e}get linkRefractionWithTransparency(){return this.subSurface.linkRefractionWithTransparency}set linkRefractionWithTransparency(e){this.subSurface.linkRefractionWithTransparency=e,e&&(this.subSurface.isRefractionEnabled=!0)}get usePhysicalLightFalloff(){return this._lightFalloff===Nt.LIGHTFALLOFF_PHYSICAL}set usePhysicalLightFalloff(e){e!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),e?this._lightFalloff=Nt.LIGHTFALLOFF_PHYSICAL:this._lightFalloff=Nt.LIGHTFALLOFF_STANDARD)}get useGLTFLightFalloff(){return this._lightFalloff===Nt.LIGHTFALLOFF_GLTF}set useGLTFLightFalloff(e){e!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),e?this._lightFalloff=Nt.LIGHTFALLOFF_GLTF:this._lightFalloff=Nt.LIGHTFALLOFF_STANDARD)}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(e){this._attachImageProcessingConfiguration(e),this._markAllSubMeshesAsTexturesDirty()}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(e){this.imageProcessingConfiguration.colorCurvesEnabled=e}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(e){this.imageProcessingConfiguration.colorGradingEnabled=e}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(e){this._imageProcessingConfiguration.toneMappingEnabled=e}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(e){this._imageProcessingConfiguration.exposure=e}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(e){this._imageProcessingConfiguration.contrast=e}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(e){this._imageProcessingConfiguration.colorGradingTexture=e}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(e){this._imageProcessingConfiguration.colorCurves=e}constructor(e,t){super(e,t),this.directIntensity=1,this.emissiveIntensity=1,this.environmentIntensity=1,this.specularIntensity=1,this.disableBumpMap=!1,this.ambientTextureStrength=1,this.ambientTextureImpactOnAnalyticalLights=we.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this.metallicF0Factor=1,this.metallicReflectanceColor=De.White(),this.useOnlyMetallicFromMetallicReflectanceTexture=!1,this.ambientColor=new De(0,0,0),this.albedoColor=new De(1,1,1),this.reflectivityColor=new De(1,1,1),this.reflectionColor=new De(1,1,1),this.emissiveColor=new De(0,0,0),this.microSurface=1,this.useLightmapAsShadowmap=!1,this.useAlphaFromAlbedoTexture=!1,this.forceAlphaTest=!1,this.alphaCutOff=.4,this.useSpecularOverAlpha=!0,this.useMicroSurfaceFromReflectivityMapAlpha=!1,this.useRoughnessFromMetallicTextureAlpha=!0,this.useRoughnessFromMetallicTextureGreen=!1,this.useMetallnessFromMetallicTextureBlue=!1,this.useAmbientOcclusionFromMetallicTextureRed=!1,this.useAmbientInGrayScale=!1,this.useAutoMicroSurfaceFromReflectivityMap=!1,this.useRadianceOverAlpha=!0,this.useObjectSpaceNormalMap=!1,this.useParallax=!1,this.useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this.disableLighting=!1,this.forceIrradianceInFragment=!1,this.maxSimultaneousLights=4,this.invertNormalMapX=!1,this.invertNormalMapY=!1,this.twoSidedLighting=!1,this.useAlphaFresnel=!1,this.useLinearAlphaFresnel=!1,this.environmentBRDFTexture=null,this.forceNormalForward=!1,this.enableSpecularAntiAliasing=!1,this.useHorizonOcclusion=!0,this.useRadianceOcclusion=!0,this.unlit=!1,this.applyDecalMapAfterDetailMap=!1,this._environmentBRDFTexture=X0(this.getScene())}getClassName(){return"PBRMaterial"}clone(e,t=!0,i=""){const r=Le.Clone(()=>new we(e,this.getScene()),this,{cloneTexturesOnlyOnce:t});return r.id=e,r.name=e,this.stencil.copyTo(r.stencil),this._clonePlugins(r,i),r}serialize(){const e=super.serialize();return e.customType="BABYLON.PBRMaterial",e}static Parse(e,t,i){const r=Le.Parse(()=>new we(e.name,t),e,t,i);return e.stencil&&r.stencil.parse(e.stencil,t,i),ie._ParsePlugins(e,r,t,i),e.clearCoat&&r.clearCoat.parse(e.clearCoat,t,i),e.anisotropy&&r.anisotropy.parse(e.anisotropy,t,i),e.brdf&&r.brdf.parse(e.brdf,t,i),e.sheen&&r.sheen.parse(e.sheen,t,i),e.subSurface&&r.subSurface.parse(e.subSurface,t,i),e.iridescence&&r.iridescence.parse(e.iridescence,t,i),r}}we.PBRMATERIAL_OPAQUE=Nt.PBRMATERIAL_OPAQUE;we.PBRMATERIAL_ALPHATEST=Nt.PBRMATERIAL_ALPHATEST;we.PBRMATERIAL_ALPHABLEND=Nt.PBRMATERIAL_ALPHABLEND;we.PBRMATERIAL_ALPHATESTANDBLEND=Nt.PBRMATERIAL_ALPHATESTANDBLEND;we.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=Nt.DEFAULT_AO_ON_ANALYTICAL_LIGHTS;M([V(),ae("_markAllSubMeshesAsTexturesDirty")],we.prototype,"directIntensity",void 0);M([V(),ae("_markAllSubMeshesAsTexturesDirty")],we.prototype,"emissiveIntensity",void 0);M([V(),ae("_markAllSubMeshesAsTexturesDirty")],we.prototype,"environmentIntensity",void 0);M([V(),ae("_markAllSubMeshesAsTexturesDirty")],we.prototype,"specularIntensity",void 0);M([V(),ae("_markAllSubMeshesAsTexturesDirty")],we.prototype,"disableBumpMap",void 0);M([Tt(),ae("_markAllSubMeshesAsTexturesDirty")],we.prototype,"albedoTexture",void 0);M([Tt(),ae("_markAllSubMeshesAsTexturesDirty")],we.prototype,"ambientTexture",void 0);M([V(),ae("_markAllSubMeshesAsTexturesDirty")],we.prototype,"ambientTextureStrength",void 0);M([V(),ae("_markAllSubMeshesAsTexturesDirty")],we.prototype,"ambientTextureImpactOnAnalyticalLights",void 0);M([Tt(),ae("_markAllSubMeshesAsTexturesAndMiscDirty")],we.prototype,"opacityTexture",void 0);M([Tt(),ae("_markAllSubMeshesAsTexturesDirty")],we.prototype,"reflectionTexture",void 0);M([Tt(),ae("_markAllSubMeshesAsTexturesDirty")],we.prototype,"emissiveTexture",void 0);M([Tt(),ae("_markAllSubMeshesAsTexturesDirty")],we.prototype,"reflectivityTexture",void 0);M([Tt(),ae("_markAllSubMeshesAsTexturesDirty")],we.prototype,"metallicTexture",void 0);M([V(),ae("_markAllSubMeshesAsTexturesDirty")],we.prototype,"metallic",void 0);M([V(),ae("_markAllSubMeshesAsTexturesDirty")],we.prototype,"roughness",void 0);M([V(),ae("_markAllSubMeshesAsTexturesDirty")],we.prototype,"metallicF0Factor",void 0);M([sr(),ae("_markAllSubMeshesAsTexturesDirty")],we.prototype,"metallicReflectanceColor",void 0);M([V(),ae("_markAllSubMeshesAsTexturesDirty")],we.prototype,"useOnlyMetallicFromMetallicReflectanceTexture",void 0);M([Tt(),ae("_markAllSubMeshesAsTexturesDirty")],we.prototype,"metallicReflectanceTexture",void 0);M([Tt(),ae("_markAllSubMeshesAsTexturesDirty")],we.prototype,"reflectanceTexture",void 0);M([Tt(),ae("_markAllSubMeshesAsTexturesDirty")],we.prototype,"microSurfaceTexture",void 0);M([Tt(),ae("_markAllSubMeshesAsTexturesDirty")],we.prototype,"bumpTexture",void 0);M([Tt(),ae("_markAllSubMeshesAsTexturesDirty",null)],we.prototype,"lightmapTexture",void 0);M([sr("ambient"),ae("_markAllSubMeshesAsTexturesDirty")],we.prototype,"ambientColor",void 0);M([sr("albedo"),ae("_markAllSubMeshesAsTexturesDirty")],we.prototype,"albedoColor",void 0);M([sr("reflectivity"),ae("_markAllSubMeshesAsTexturesDirty")],we.prototype,"reflectivityColor",void 0);M([sr("reflection"),ae("_markAllSubMeshesAsTexturesDirty")],we.prototype,"reflectionColor",void 0);M([sr("emissive"),ae("_markAllSubMeshesAsTexturesDirty")],we.prototype,"emissiveColor",void 0);M([V(),ae("_markAllSubMeshesAsTexturesDirty")],we.prototype,"microSurface",void 0);M([V(),ae("_markAllSubMeshesAsTexturesDirty")],we.prototype,"useLightmapAsShadowmap",void 0);M([V(),ae("_markAllSubMeshesAsTexturesAndMiscDirty")],we.prototype,"useAlphaFromAlbedoTexture",void 0);M([V(),ae("_markAllSubMeshesAsTexturesAndMiscDirty")],we.prototype,"forceAlphaTest",void 0);M([V(),ae("_markAllSubMeshesAsTexturesAndMiscDirty")],we.prototype,"alphaCutOff",void 0);M([V(),ae("_markAllSubMeshesAsTexturesDirty")],we.prototype,"useSpecularOverAlpha",void 0);M([V(),ae("_markAllSubMeshesAsTexturesDirty")],we.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0);M([V(),ae("_markAllSubMeshesAsTexturesDirty")],we.prototype,"useRoughnessFromMetallicTextureAlpha",void 0);M([V(),ae("_markAllSubMeshesAsTexturesDirty")],we.prototype,"useRoughnessFromMetallicTextureGreen",void 0);M([V(),ae("_markAllSubMeshesAsTexturesDirty")],we.prototype,"useMetallnessFromMetallicTextureBlue",void 0);M([V(),ae("_markAllSubMeshesAsTexturesDirty")],we.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0);M([V(),ae("_markAllSubMeshesAsTexturesDirty")],we.prototype,"useAmbientInGrayScale",void 0);M([V(),ae("_markAllSubMeshesAsTexturesDirty")],we.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0);M([V()],we.prototype,"usePhysicalLightFalloff",null);M([V()],we.prototype,"useGLTFLightFalloff",null);M([V(),ae("_markAllSubMeshesAsTexturesDirty")],we.prototype,"useRadianceOverAlpha",void 0);M([V(),ae("_markAllSubMeshesAsTexturesDirty")],we.prototype,"useObjectSpaceNormalMap",void 0);M([V(),ae("_markAllSubMeshesAsTexturesDirty")],we.prototype,"useParallax",void 0);M([V(),ae("_markAllSubMeshesAsTexturesDirty")],we.prototype,"useParallaxOcclusion",void 0);M([V(),ae("_markAllSubMeshesAsTexturesDirty")],we.prototype,"parallaxScaleBias",void 0);M([V(),ae("_markAllSubMeshesAsLightsDirty")],we.prototype,"disableLighting",void 0);M([V(),ae("_markAllSubMeshesAsTexturesDirty")],we.prototype,"forceIrradianceInFragment",void 0);M([V(),ae("_markAllSubMeshesAsLightsDirty")],we.prototype,"maxSimultaneousLights",void 0);M([V(),ae("_markAllSubMeshesAsTexturesDirty")],we.prototype,"invertNormalMapX",void 0);M([V(),ae("_markAllSubMeshesAsTexturesDirty")],we.prototype,"invertNormalMapY",void 0);M([V(),ae("_markAllSubMeshesAsTexturesDirty")],we.prototype,"twoSidedLighting",void 0);M([V(),ae("_markAllSubMeshesAsTexturesDirty")],we.prototype,"useAlphaFresnel",void 0);M([V(),ae("_markAllSubMeshesAsTexturesDirty")],we.prototype,"useLinearAlphaFresnel",void 0);M([ae("_markAllSubMeshesAsTexturesDirty")],we.prototype,"environmentBRDFTexture",void 0);M([V(),ae("_markAllSubMeshesAsTexturesDirty")],we.prototype,"forceNormalForward",void 0);M([V(),ae("_markAllSubMeshesAsTexturesDirty")],we.prototype,"enableSpecularAntiAliasing",void 0);M([V(),ae("_markAllSubMeshesAsTexturesDirty")],we.prototype,"useHorizonOcclusion",void 0);M([V(),ae("_markAllSubMeshesAsTexturesDirty")],we.prototype,"useRadianceOcclusion",void 0);M([V(),ae("_markAllSubMeshesAsMiscDirty")],we.prototype,"unlit",void 0);M([V(),ae("_markAllSubMeshesAsMiscDirty")],we.prototype,"applyDecalMapAfterDetailMap",void 0);ye("BABYLON.PBRMaterial",we);Oe.prototype.updateRawTexture=function(n,e,t,i,r=null,s=0,o=!1){if(!n)return;const a=this._getRGBABufferInternalSizedFormat(s,t,o),l=this._getInternalFormat(t),h=this._getWebGLTextureType(s);this._bindTextureDirectly(this._gl.TEXTURE_2D,n,!0),this._unpackFlipY(i===void 0?!0:!!i),this._doNotHandleContextLost||(n._bufferView=e,n.format=t,n.type=s,n.invertY=i,n._compression=r),n.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),r&&e?this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,0,this.getCaps().s3tc[r],n.width,n.height,0,e):this._gl.texImage2D(this._gl.TEXTURE_2D,0,a,n.width,n.height,0,l,h,e),n.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),n.isReady=!0};Oe.prototype.createRawTexture=function(n,e,t,i,r,s,o,a=null,l=0,h=0,c=!1){const u=new ur(this,Dt.Raw);u.baseWidth=e,u.baseHeight=t,u.width=e,u.height=t,u.format=i,u.generateMipMaps=r,u.samplingMode=o,u.invertY=s,u._compression=a,u.type=l,u._useSRGBBuffer=this._getUseSRGBBuffer(c,!r),this._doNotHandleContextLost||(u._bufferView=n),this.updateRawTexture(u,n,i,s,a,l,u._useSRGBBuffer),this._bindTextureDirectly(this._gl.TEXTURE_2D,u,!0);const d=this._getSamplingParameters(o,r);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,d.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,d.min),r&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._internalTexturesCache.push(u),u};Oe.prototype.createRawCubeTexture=function(n,e,t,i,r,s,o,a=null){const l=this._gl,h=new ur(this,Dt.CubeRaw);h.isCube=!0,h.format=t,h.type=i,this._doNotHandleContextLost||(h._bufferViewArray=n);const c=this._getWebGLTextureType(i);let u=this._getInternalFormat(t);u===l.RGB&&(u=l.RGBA),c===l.FLOAT&&!this._caps.textureFloatLinearFiltering?(r=!1,o=1,oe.Warn("Float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")):c===this._gl.HALF_FLOAT_OES&&!this._caps.textureHalfFloatLinearFiltering?(r=!1,o=1,oe.Warn("Half float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")):c===l.FLOAT&&!this._caps.textureFloatRender?(r=!1,oe.Warn("Render to float textures is not supported. Mipmap generation forced to false.")):c===l.HALF_FLOAT&&!this._caps.colorBufferFloat&&(r=!1,oe.Warn("Render to half float textures is not supported. Mipmap generation forced to false."));const d=e,f=d;if(h.width=d,h.height=f,h.invertY=s,h._compression=a,!this.needPOTTextures||Ca(h.width)&&Ca(h.height)||(r=!1),n)this.updateRawCubeTexture(h,n,t,i,s,a);else{const g=this._getRGBABufferInternalSizedFormat(i),m=0;this._bindTextureDirectly(l.TEXTURE_CUBE_MAP,h,!0);for(let x=0;x<6;x++)a?l.compressedTexImage2D(l.TEXTURE_CUBE_MAP_POSITIVE_X+x,m,this.getCaps().s3tc[a],h.width,h.height,0,void 0):l.texImage2D(l.TEXTURE_CUBE_MAP_POSITIVE_X+x,m,g,h.width,h.height,0,u,c,null);this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)}this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,h,!0),n&&r&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP);const p=this._getSamplingParameters(o,r);return l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_MAG_FILTER,p.mag),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_MIN_FILTER,p.min),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),this._bindTextureDirectly(l.TEXTURE_CUBE_MAP,null),h.generateMipMaps=r,h.samplingMode=o,h.isReady=!0,h};Oe.prototype.updateRawCubeTexture=function(n,e,t,i,r,s=null,o=0){n._bufferViewArray=e,n.format=t,n.type=i,n.invertY=r,n._compression=s;const a=this._gl,l=this._getWebGLTextureType(i);let h=this._getInternalFormat(t);const c=this._getRGBABufferInternalSizedFormat(i);let u=!1;h===a.RGB&&(h=a.RGBA,u=!0),this._bindTextureDirectly(a.TEXTURE_CUBE_MAP,n,!0),this._unpackFlipY(r===void 0?!0:!!r),n.width%4!==0&&a.pixelStorei(a.UNPACK_ALIGNMENT,1);for(let d=0;d<6;d++){let f=e[d];s?a.compressedTexImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+d,o,this.getCaps().s3tc[s],n.width,n.height,0,f):(u&&(f=H0(f,n.width,n.height,i)),a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+d,o,c,n.width,n.height,0,h,l,f))}(!this.needPOTTextures||Ca(n.width)&&Ca(n.height))&&n.generateMipMaps&&o===0&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),n.isReady=!0};Oe.prototype.createRawCubeTextureFromUrl=function(n,e,t,i,r,s,o,a,l=null,h=null,c=3,u=!1){const d=this._gl,f=this.createRawCubeTexture(null,t,i,r,!s,u,c,null);e==null||e.addPendingData(f),f.url=n,f.isReady=!1,this._internalTexturesCache.push(f);const p=(m,x)=>{e==null||e.removePendingData(f),h&&m&&h(m.status+" "+m.statusText,x)},g=m=>{const x=f.width,E=o(m);if(E){if(a){const R=this._getWebGLTextureType(r);let C=this._getInternalFormat(i);const _=this._getRGBABufferInternalSizedFormat(r);let T=!1;C===d.RGB&&(C=d.RGBA,T=!0),this._bindTextureDirectly(d.TEXTURE_CUBE_MAP,f,!0),this._unpackFlipY(!1);const y=a(E);for(let P=0;P<y.length;P++){const D=x>>P;for(let F=0;F<6;F++){let N=y[P][F];T&&(N=H0(N,D,D,r)),d.texImage2D(F,P,_,D,D,0,C,R,N)}}this._bindTextureDirectly(d.TEXTURE_CUBE_MAP,null)}else this.updateRawCubeTexture(f,E,i,r,u);f.isReady=!0,e==null||e.removePendingData(f),f.onLoadedObservable.notifyObservers(f),f.onLoadedObservable.clear(),l&&l()}};return this._loadFile(n,m=>{g(m)},void 0,e==null?void 0:e.offlineProvider,!0,p),f};function H0(n,e,t,i){let r,s=1;i===1?r=new Float32Array(e*t*4):i===2?(r=new Uint16Array(e*t*4),s=15360):i===7?r=new Uint32Array(e*t*4):r=new Uint8Array(e*t*4);for(let o=0;o<e;o++)for(let a=0;a<t;a++){const l=(a*e+o)*3,h=(a*e+o)*4;r[h+0]=n[l+0],r[h+1]=n[l+1],r[h+2]=n[l+2],r[h+3]=s}return r}function K0(n){return function(e,t,i,r,s,o,a,l,h=null,c=0){const u=n?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,d=n?Dt.Raw3D:Dt.Raw2DArray,f=new ur(this,d);f.baseWidth=t,f.baseHeight=i,f.baseDepth=r,f.width=t,f.height=i,f.depth=r,f.format=s,f.type=c,f.generateMipMaps=o,f.samplingMode=l,n?f.is3D=!0:f.is2DArray=!0,this._doNotHandleContextLost||(f._bufferView=e),n?this.updateRawTexture3D(f,e,s,a,h,c):this.updateRawTexture2DArray(f,e,s,a,h,c),this._bindTextureDirectly(u,f,!0);const p=this._getSamplingParameters(l,o);return this._gl.texParameteri(u,this._gl.TEXTURE_MAG_FILTER,p.mag),this._gl.texParameteri(u,this._gl.TEXTURE_MIN_FILTER,p.min),o&&this._gl.generateMipmap(u),this._bindTextureDirectly(u,null),this._internalTexturesCache.push(f),f}}Oe.prototype.createRawTexture2DArray=K0(!1);Oe.prototype.createRawTexture3D=K0(!0);function q0(n){return function(e,t,i,r,s=null,o=0){const a=n?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,l=this._getWebGLTextureType(o),h=this._getInternalFormat(i),c=this._getRGBABufferInternalSizedFormat(o,i);this._bindTextureDirectly(a,e,!0),this._unpackFlipY(r===void 0?!0:!!r),this._doNotHandleContextLost||(e._bufferView=t,e.format=i,e.invertY=r,e._compression=s),e.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),s&&t?this._gl.compressedTexImage3D(a,0,this.getCaps().s3tc[s],e.width,e.height,e.depth,0,t):this._gl.texImage3D(a,0,c,e.width,e.height,e.depth,0,h,l,t),e.generateMipMaps&&this._gl.generateMipmap(a),this._bindTextureDirectly(a,null),e.isReady=!0}}Oe.prototype.updateRawTexture2DArray=q0(!1);Oe.prototype.updateRawTexture3D=q0(!0);class lr extends le{constructor(e,t,i,r,s,o=!0,a=!1,l=3,h=0,c,u){super(null,s,!o,a,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,c),this.format=r,this._engine&&(!this._engine._caps.textureFloatLinearFiltering&&h===1&&(l=1),!this._engine._caps.textureHalfFloatLinearFiltering&&h===2&&(l=1),this._texture=this._engine.createRawTexture(e,t,i,r,o,a,l,null,h,c??0,u??!1),this.wrapU=le.CLAMP_ADDRESSMODE,this.wrapV=le.CLAMP_ADDRESSMODE)}update(e){this._getEngine().updateRawTexture(this._texture,e,this._texture.format,this._texture.invertY,null,this._texture.type,this._texture._useSRGBBuffer)}static CreateLuminanceTexture(e,t,i,r,s=!0,o=!1,a=3){return new lr(e,t,i,1,r,s,o,a)}static CreateLuminanceAlphaTexture(e,t,i,r,s=!0,o=!1,a=3){return new lr(e,t,i,2,r,s,o,a)}static CreateAlphaTexture(e,t,i,r,s=!0,o=!1,a=3){return new lr(e,t,i,0,r,s,o,a)}static CreateRGBTexture(e,t,i,r,s=!0,o=!1,a=3,l=0,h=0,c=!1){return new lr(e,t,i,4,r,s,o,a,l,h,c)}static CreateRGBATexture(e,t,i,r,s=!0,o=!1,a=3,l=0,h=0,c=!1){return new lr(e,t,i,5,r,s,o,a,l,h,c)}static CreateRGBAStorageTexture(e,t,i,r,s=!0,o=!1,a=3,l=0,h=!1){return new lr(e,t,i,5,r,s,o,a,l,1,h)}static CreateRTexture(e,t,i,r,s=!0,o=!1,a=le.TRILINEAR_SAMPLINGMODE,l=1){return new lr(e,t,i,6,r,s,o,a,l)}static CreateRStorageTexture(e,t,i,r,s=!0,o=!1,a=le.TRILINEAR_SAMPLINGMODE,l=1){return new lr(e,t,i,6,r,s,o,a,l,1)}}class Bi{}Bi.DEFAULT_COLOR=De.White();Bi.DEFAULT_WIDTH_ATTENUATED=1;Bi.DEFAULT_WIDTH=.1;class ft{static ConvertPoints(e){if(e.length&&Array.isArray(e)&&typeof e[0]=="number")return[e];if(e.length&&Array.isArray(e[0])&&typeof e[0][0]=="number")return e;if(e.length&&!Array.isArray(e[0])&&e[0]instanceof v){const t=[];for(let i=0;i<e.length;i++){const r=e[i];t.push(r.x,r.y,r.z)}return[t]}else if(e.length>0&&Array.isArray(e[0])&&e[0].length>0&&e[0][0]instanceof v){const t=[];return e.forEach(i=>{t.push(i.flatMap(r=>[r.x,r.y,r.z]))}),t}else{if(e instanceof Float32Array)return[Array.from(e)];if(e.length&&e[0]instanceof Float32Array){const t=[];return e.forEach(i=>{t.push(Array.from(i))}),t}}return[]}static OmitZeroLengthPredicate(e,t,i){const r=[];return t.subtract(e).lengthSquared()>0&&r.push([e,t]),i.subtract(t).lengthSquared()>0&&r.push([t,i]),e.subtract(i).lengthSquared()>0&&r.push([i,e]),r.length===0?null:r}static OmitDuplicatesPredicate(e,t,i,r){const s=[];return ft._SearchInPoints(e,t,r)||s.push([e,t]),ft._SearchInPoints(t,i,r)||s.push([t,i]),ft._SearchInPoints(i,e,r)||s.push([i,e]),s.length===0?null:s}static _SearchInPoints(e,t,i){var r,s,o;for(const a of i)for(let l=0;l<a.length;l++)if((r=a[l])!=null&&r.equals(e)&&((s=a[l+1])!=null&&s.equals(t)||(o=a[l-1])!=null&&o.equals(t)))return!0;return!1}static MeshesToLines(e,t){const i=[];return e.forEach((r,s)=>{const o=r.getVerticesData(b.PositionKind),a=r.getIndices();if(o&&a)for(let l=0,h=0;l<a.length;l++){const c=a[h++]*3,u=a[h++]*3,d=a[h++]*3,f=new v(o[c],o[c+1],o[c+2]),p=new v(o[u],o[u+1],o[u+2]),g=new v(o[d],o[d+1],o[d+2]);if(t){const m=t(f,p,g,i,l,c,r,s,o,a);if(m)for(const x of m)i.push(x)}else i.push([f,p],[p,g],[g,f])}}),i}static ToVector3Array(e){if(Array.isArray(e[0])){const r=[],s=e;for(const o of s){const a=[];for(let l=0;l<o.length;l+=3)a.push(new v(o[l],o[l+1],o[l+2]));r.push(a)}return r}const t=e,i=[];for(let r=0;r<t.length;r+=3)i.push(new v(t[r],t[r+1],t[r+2]));return i}static ToNumberArray(e){return e.flatMap(t=>[t.x,t.y,t.z])}static GetPointsCountInfo(e){const t=new Array(e.length);let i=0;for(let r=e.length;r--;)t[r]=e[r].length/3,i+=t[r];return{total:i,counts:t}}static GetLineLength(e){if(e.length===0)return 0;let t;typeof e[0]=="number"?t=ft.ToVector3Array(e):t=e;const i=W.Vector3[0];let r=0;for(let s=0;s<t.length-1;s++){const o=t[s],a=t[s+1];r+=a.subtractToRef(o,i).length()}return r}static SegmentizeSegmentByCount(e,t,i){const r=[],s=t.subtract(e),o=W.Vector3[0];o.setAll(i);const a=W.Vector3[1];s.divideToRef(o,a);let l=e.clone();r.push(l);for(let h=0;h<i;h++)l=l.clone(),r.push(l.addInPlace(a));return r}static SegmentizeLineBySegmentLength(e,t){const i=e[0]instanceof v?ft.GetLineSegments(e):typeof e[0]=="number"?ft.GetLineSegments(ft.ToVector3Array(e)):e,r=[];return i.forEach(s=>{s.length>t?ft.SegmentizeSegmentByCount(s.point1,s.point2,Math.ceil(s.length/t)).forEach(o=>{r.push(o)}):(r.push(s.point1),r.push(s.point2))}),r}static SegmentizeLineBySegmentCount(e,t){const i=typeof e[0]=="number"?ft.ToVector3Array(e):e,r=ft.GetLineLength(i)/t;return ft.SegmentizeLineBySegmentLength(i,r)}static GetLineSegments(e){const t=[];for(let i=0;i<e.length-1;i++){const r=e[i],s=e[i+1],o=s.subtract(r).length();t.push({point1:r,point2:s,length:o})}return t}static GetMinMaxSegmentLength(e){const t=ft.GetLineSegments(e).sort(i=>i.length);return{min:t[0].length,max:t[t.length-1].length}}static GetPositionOnLineByVisibility(e,t,i,r=!1){const s=t*i;let o=0,a=0;const l=e.length;for(let c=0;c<l;c++){if(s<=o+e[c].length){a=c;break}o+=e[c].length}const h=(s-o)/e[a].length;return e[a].point2.subtractToRef(e[a].point1,W.Vector3[0]),W.Vector3[1]=W.Vector3[0].multiplyByFloats(h,h,h),r||W.Vector3[1].addInPlace(e[a].point1),W.Vector3[1].clone()}static GetCircleLinePoints(e,t,i=0,r=e,s=Math.PI*2/t){const o=[];for(let a=0;a<=t;a++)o.push(new v(Math.cos(a*s)*e,Math.sin(a*s)*r,i));return o}static GetBezierLinePoints(e,t,i,r){return Ls.CreateQuadraticBezier(e,t,i,r).getPoints().flatMap(s=>[s.x,s.y,s.z])}static GetArrowCap(e,t,i,r,s,o=0,a=0){return{points:[e.clone(),e.add(t.multiplyByFloats(i,i,i))],widths:[r,s,o,a]}}static GetPointsFromText(e,t,i,r,s=0,o=!0){const a=[],l=KI(e,t,i,r);for(const h of l){for(const c of h.paths){const u=[],d=c.getPoints();for(const f of d)u.push(f.x,f.y,s);a.push(u)}if(o)for(const c of h.holes){const u=[],d=c.getPoints();for(const f of d)u.push(f.x,f.y,s);a.push(u)}}return a}static Color3toRGBAUint8(e){const t=new Uint8Array(e.length*4);for(let i=0,r=0;i<e.length;i++)t[r++]=e[i].r*255,t[r++]=e[i].g*255,t[r++]=e[i].b*255,t[r++]=255;return t}static CreateColorsTexture(e,t,i,r){const s=ft.Color3toRGBAUint8(t),o=new lr(s,t.length,1,se.TEXTUREFORMAT_RGBA,r,!1,!0,i);return o.name=e,o}static PrepareEmptyColorsTexture(e){if(!Bi.EmptyColorsTexture){const t=new Uint8Array(4);Bi.EmptyColorsTexture=new lr(t,1,1,se.TEXTUREFORMAT_RGBA,e,!1,!1,lr.NEAREST_NEAREST),Bi.EmptyColorsTexture.name="grlEmptyColorsTexture"}return Bi.EmptyColorsTexture}static DisposeEmptyColorsTexture(){var e;(e=Bi.EmptyColorsTexture)==null||e.dispose(),Bi.EmptyColorsTexture=null}static BooleanToNumber(e){return e?1:0}}var Og;(function(n){n[n.MATERIAL_TYPE_STANDARD=0]="MATERIAL_TYPE_STANDARD",n[n.MATERIAL_TYPE_PBR=1]="MATERIAL_TYPE_PBR",n[n.MATERIAL_TYPE_SIMPLE=2]="MATERIAL_TYPE_SIMPLE"})(Og||(Og={}));var Sr;(function(n){n[n.COLOR_MODE_SET=0]="COLOR_MODE_SET",n[n.COLOR_MODE_ADD=1]="COLOR_MODE_ADD",n[n.COLOR_MODE_MULTIPLY=2]="COLOR_MODE_MULTIPLY"})(Sr||(Sr={}));var zs;(function(n){n[n.COLOR_DISTRIBUTION_TYPE_SEGMENT=0]="COLOR_DISTRIBUTION_TYPE_SEGMENT",n[n.COLOR_DISTRIBUTION_TYPE_LINE=1]="COLOR_DISTRIBUTION_TYPE_LINE"})(zs||(zs={}));class AO extends is{constructor(){super(...arguments),this.GREASED_LINE_HAS_COLOR=!1,this.GREASED_LINE_SIZE_ATTENUATION=!1,this.GREASED_LINE_COLOR_DISTRIBUTION_TYPE_LINE=!1,this.GREASED_LINE_RIGHT_HANDED_COORDINATE_SYSTEM=!1,this.GREASED_LINE_CAMERA_FACING=!0}}class Bn extends kr{constructor(e,t,i){i=i||{color:Bi.DEFAULT_COLOR};const r=new AO;r.GREASED_LINE_HAS_COLOR=!!i.color&&!i.useColors,r.GREASED_LINE_SIZE_ATTENUATION=i.sizeAttenuation??!1,r.GREASED_LINE_COLOR_DISTRIBUTION_TYPE_LINE=i.colorDistributionType===zs.COLOR_DISTRIBUTION_TYPE_LINE,r.GREASED_LINE_RIGHT_HANDED_COORDINATE_SYSTEM=(t??e.getScene()).useRightHandedSystem,r.GREASED_LINE_CAMERA_FACING=i.cameraFacing??!0,super(e,Bn.GREASED_LINE_MATERIAL_NAME,200,r),this.colorsTexture=null,this._scene=t??e.getScene(),this._engine=this._scene.getEngine(),this._cameraFacing=i.cameraFacing??!0,this.visibility=i.visibility??1,this.useDash=i.useDash??!1,this.dashRatio=i.dashRatio??.5,this.dashOffset=i.dashOffset??0,this.width=i.width?i.width:i.sizeAttenuation?Bi.DEFAULT_WIDTH_ATTENUATED:Bi.DEFAULT_WIDTH,this._sizeAttenuation=i.sizeAttenuation??!1,this.colorMode=i.colorMode??Sr.COLOR_MODE_SET,this._color=i.color??null,this.useColors=i.useColors??!1,this._colorsDistributionType=i.colorDistributionType??zs.COLOR_DISTRIBUTION_TYPE_SEGMENT,this.colorsSampling=i.colorsSampling??lr.NEAREST_NEAREST,this._colors=i.colors??null,this.dashCount=i.dashCount??1,this.resolution=i.resolution??new me(this._engine.getRenderWidth(),this._engine.getRenderHeight()),i.colorsTexture?this.colorsTexture=i.colorsTexture:this._colors?this.colorsTexture=ft.CreateColorsTexture(`${e.name}-colors-texture`,this._colors,this.colorsSampling,this._scene):(this._color=this._color??Bi.DEFAULT_COLOR,ft.PrepareEmptyColorsTexture(this._scene)),this._engine.onDisposeObservable.add(()=>{ft.DisposeEmptyColorsTexture()}),this._enable(!0)}getAttributes(e){e.push("grl_offsets"),e.push("grl_widths"),e.push("grl_colorPointers"),e.push("grl_counters"),this._cameraFacing?(e.push("grl_previousAndSide"),e.push("grl_nextAndCounters")):e.push("grl_slopes")}getSamplers(e){e.push("grl_colors")}getActiveTextures(e){this.colorsTexture&&e.push(this.colorsTexture)}getUniforms(){const e=[{name:"grl_singleColor",size:3,type:"vec3"},{name:"grl_dashOptions",size:4,type:"vec4"},{name:"grl_colorMode_visibility_colorsWidth_useColors",size:4,type:"vec4"}];return this._cameraFacing&&e.push({name:"grl_projection",size:16,type:"mat4"},{name:"grl_aspect_resolution_lineWidth",size:4,type:"vec4"}),{ubo:e,vertex:this._cameraFacing?`
                uniform vec4 grl_aspect_resolution_lineWidth;
                uniform mat4 grl_projection;
                `:"",fragment:`
                uniform vec4 grl_dashOptions;
                uniform vec4 grl_colorMode_visibility_colorsWidth_useColors;
                uniform vec3 grl_singleColor;
                `}}get isEnabled(){return!0}bindForSubMesh(e){if(this._cameraFacing){const r=this._scene.activeCamera;if(r){const o=r.getProjectionMatrix();e.updateMatrix("grl_projection",o)}else throw Error("GreasedLinePluginMaterial requires an active camera.");const s=W.Vector4[0];s.x=this._aspect,s.y=this._resolution.x,s.z=this._resolution.y,s.w=this.width,e.updateVector4("grl_aspect_resolution_lineWidth",s)}const t=W.Vector4[0];t.x=ft.BooleanToNumber(this.useDash),t.y=this._dashArray,t.z=this.dashOffset,t.w=this.dashRatio,e.updateVector4("grl_dashOptions",t);const i=W.Vector4[1];i.x=this.colorMode,i.y=this.visibility,i.z=this.colorsTexture?this.colorsTexture.getSize().width:0,i.w=ft.BooleanToNumber(this.useColors),e.updateVector4("grl_colorMode_visibility_colorsWidth_useColors",i),this._color&&e.updateColor3("grl_singleColor",this._color),e.setTexture("grl_colors",this.colorsTexture??Bi.EmptyColorsTexture)}prepareDefines(e,t,i){e.GREASED_LINE_HAS_COLOR=!!this.color&&!this.useColors,e.GREASED_LINE_SIZE_ATTENUATION=this._sizeAttenuation,e.GREASED_LINE_COLOR_DISTRIBUTION_TYPE_LINE=this._colorsDistributionType===zs.COLOR_DISTRIBUTION_TYPE_LINE,e.GREASED_LINE_RIGHT_HANDED_COORDINATE_SYSTEM=t.useRightHandedSystem,e.GREASED_LINE_CAMERA_FACING=this._cameraFacing}getClassName(){return Bn.GREASED_LINE_MATERIAL_NAME}getCustomCode(e){if(e==="vertex"){const t={CUSTOM_VERTEX_DEFINITIONS:`
                attribute float grl_widths;
                attribute vec3 grl_offsets;
                attribute float grl_colorPointers;

                varying float grlCounters;
                varying float grlColorPointer;

                #ifdef GREASED_LINE_CAMERA_FACING
                    attribute vec4 grl_previousAndSide;
                    attribute vec4 grl_nextAndCounters;

                    vec2 grlFix( vec4 i, float aspect ) {
                        vec2 res = i.xy / i.w;
                        res.x *= aspect;
                        return res;
                    }
                #else
                    attribute vec3 grl_slopes;
                    attribute float grl_counters;
                #endif
                `,CUSTOM_VERTEX_UPDATE_POSITION:`
                #ifdef GREASED_LINE_CAMERA_FACING
                    vec3 grlPositionOffset = grl_offsets;
                    positionUpdated += grlPositionOffset;
                #else
                    positionUpdated = (positionUpdated + grl_offsets) + (grl_slopes * grl_widths);
                #endif
                `,CUSTOM_VERTEX_MAIN_END:`
                grlColorPointer = grl_colorPointers;

                #ifdef GREASED_LINE_CAMERA_FACING

                    float grlAspect = grl_aspect_resolution_lineWidth.x;
                    float grlBaseWidth = grl_aspect_resolution_lineWidth.w;


                    vec3 grlPrevious = grl_previousAndSide.xyz;
                    float grlSide = grl_previousAndSide.w;

                    vec3 grlNext = grl_nextAndCounters.xyz;
                    grlCounters = grl_nextAndCounters.w;

                    mat4 grlMatrix = viewProjection * finalWorld;
                    vec4 grlFinalPosition = grlMatrix * vec4( positionUpdated , 1.0 );
                    vec4 grlPrevPos = grlMatrix * vec4( grlPrevious + grlPositionOffset, 1.0 );
                    vec4 grlNextPos = grlMatrix * vec4( grlNext + grlPositionOffset, 1.0 );

                    vec2 grlCurrentP = grlFix( grlFinalPosition, grlAspect );
                    vec2 grlPrevP = grlFix( grlPrevPos, grlAspect );
                    vec2 grlNextP = grlFix( grlNextPos, grlAspect );

                    float grlWidth = grlBaseWidth * grl_widths;

                    vec2 grlDir;
                    if( grlNextP == grlCurrentP ) grlDir = normalize( grlCurrentP - grlPrevP );
                    else if( grlPrevP == grlCurrentP ) grlDir = normalize( grlNextP - grlCurrentP );
                    else {
                        vec2 grlDir1 = normalize( grlCurrentP - grlPrevP );
                        vec2 grlDir2 = normalize( grlNextP - grlCurrentP );
                        grlDir = normalize( grlDir1 + grlDir2 );
                    }
                    vec4 grlNormal = vec4( -grlDir.y, grlDir.x, 0., 1. );
                    #ifdef GREASED_LINE_RIGHT_HANDED_COORDINATE_SYSTEM
                        grlNormal.xy *= -.5 * grlWidth;
                    #else
                        grlNormal.xy *= .5 * grlWidth;
                    #endif

                    grlNormal *= grl_projection;

                    #ifdef GREASED_LINE_SIZE_ATTENUATION
                        grlNormal.xy *= grlFinalPosition.w;
                        grlNormal.xy /= ( vec4( grl_aspect_resolution_lineWidth.yz, 0., 1. ) * grl_projection ).xy;
                    #endif

                    grlFinalPosition.xy += grlNormal.xy * grlSide;
                    gl_Position = grlFinalPosition;

                    vPositionW = vec3(grlFinalPosition);
                #else
                    grlCounters = grl_counters;
                #endif
                `};return this._cameraFacing&&(t["!gl_Position\\=viewProjection\\*worldPos;"]="//"),t}return e==="fragment"?{CUSTOM_FRAGMENT_DEFINITIONS:`
                    varying float grlCounters;
                    varying float grlColorPointer;
                    uniform sampler2D grl_colors;
                `,CUSTOM_FRAGMENT_MAIN_END:`
                    float grlColorMode = grl_colorMode_visibility_colorsWidth_useColors.x;
                    float grlVisibility = grl_colorMode_visibility_colorsWidth_useColors.y;
                    float grlColorsWidth = grl_colorMode_visibility_colorsWidth_useColors.z;
                    float grlUseColors = grl_colorMode_visibility_colorsWidth_useColors.w;

                    float grlUseDash = grl_dashOptions.x;
                    float grlDashArray = grl_dashOptions.y;
                    float grlDashOffset = grl_dashOptions.z;
                    float grlDashRatio = grl_dashOptions.w;

                    gl_FragColor.a *= step(grlCounters, grlVisibility);
                    if( gl_FragColor.a == 0. ) discard;

                    if(grlUseDash == 1.){
                        gl_FragColor.a *= ceil(mod(grlCounters + grlDashOffset, grlDashArray) - (grlDashArray * grlDashRatio));
                        if (gl_FragColor.a == 0.) discard;
                    }

                    #ifdef GREASED_LINE_HAS_COLOR
                        if (grlColorMode == ${Sr.COLOR_MODE_SET}.) {
                            gl_FragColor.rgb = grl_singleColor;
                        } else if (grlColorMode == ${Sr.COLOR_MODE_ADD}.) {
                            gl_FragColor.rgb += grl_singleColor;
                        } else if (grlColorMode == ${Sr.COLOR_MODE_MULTIPLY}.) {
                            gl_FragColor.rgb *= grl_singleColor;
                        }
                    #else
                        if (grlUseColors == 1.) {
                            #ifdef GREASED_LINE_COLOR_DISTRIBUTION_TYPE_LINE
                                vec4 grlColor = texture2D(grl_colors, vec2(grlCounters, 0.), 0.);
                            #else
                                vec4 grlColor = texture2D(grl_colors, vec2(grlColorPointer/grlColorsWidth, 0.), 0.);
                            #endif
                            if (grlColorMode == ${Sr.COLOR_MODE_SET}.) {
                                gl_FragColor = grlColor;
                            } else if (grlColorMode == ${Sr.COLOR_MODE_ADD}.) {
                                gl_FragColor += grlColor;
                            } else if (grlColorMode == ${Sr.COLOR_MODE_MULTIPLY}.) {
                                gl_FragColor *= grlColor;
                            }
                        }
                    #endif

                `}:null}dispose(){var e;(e=this.colorsTexture)==null||e.dispose(),super.dispose()}get colors(){return this._colors}set colors(e){this.setColors(e)}setColors(e,t=!1,i=!1){var r,s,o;const a=((r=this._colors)==null?void 0:r.length)??0;if(this._colors=e,e===null||e.length===0){(s=this.colorsTexture)==null||s.dispose();return}if(!(t&&!i))if(this.colorsTexture&&a===e.length&&!i){const l=ft.Color3toRGBAUint8(e);this.colorsTexture.update(l)}else(o=this.colorsTexture)==null||o.dispose(),this.colorsTexture=ft.CreateColorsTexture(`${this._material.name}-colors-texture`,e,this.colorsSampling,this._scene)}updateLazy(){this._colors&&this.setColors(this._colors,!1,!0)}get dashCount(){return this._dashCount}set dashCount(e){this._dashCount=e,this._dashArray=1/e}get sizeAttenuation(){return this._sizeAttenuation}set sizeAttenuation(e){this._sizeAttenuation=e,this.markAllDefinesAsDirty()}get color(){return this._color}set color(e){this.setColor(e)}setColor(e,t=!1){this._color===null&&e!==null||this._color!==null&&e===null?(this._color=e,!t&&this.markAllDefinesAsDirty()):this._color=e}get colorsDistributionType(){return this._colorsDistributionType}set colorsDistributionType(e){this._colorsDistributionType=e,this.markAllDefinesAsDirty()}get resolution(){return this._resolution}set resolution(e){this._aspect=e.x/e.y,this._resolution=e}serialize(){const e=super.serialize(),t={colorDistributionType:this._colorsDistributionType,colorsSampling:this.colorsSampling,colorMode:this.colorMode,dashCount:this._dashCount,dashOffset:this.dashOffset,dashRatio:this.dashRatio,resolution:this._resolution,sizeAttenuation:this._sizeAttenuation,useColors:this.useColors,useDash:this.useDash,visibility:this.visibility,width:this.width};return this._colors&&(t.colors=this._colors),this._color&&(t.color=this._color),e.greasedLineMaterialOptions=t,e}parse(e,t,i){var r;super.parse(e,t,i);const s=e.greasedLineMaterialOptions;(r=this.colorsTexture)==null||r.dispose(),s.color&&this.setColor(s.color,!0),s.colorDistributionType&&(this.colorsDistributionType=s.colorDistributionType),s.colors&&(this.colors=s.colors),s.colorsSampling&&(this.colorsSampling=s.colorsSampling),s.colorMode&&(this.colorMode=s.colorMode),s.useColors&&(this.useColors=s.useColors),s.visibility&&(this.visibility=s.visibility),s.useDash&&(this.useDash=s.useDash),s.dashCount&&(this.dashCount=s.dashCount),s.dashRatio&&(this.dashRatio=s.dashRatio),s.dashOffset&&(this.dashOffset=s.dashOffset),s.width&&(this.width=s.width),s.sizeAttenuation&&(this.sizeAttenuation=s.sizeAttenuation),s.resolution&&(this.resolution=s.resolution),this.colors?this.colorsTexture=ft.CreateColorsTexture(`${this._material.name}-colors-texture`,this.colors,this.colorsSampling,t):ft.PrepareEmptyColorsTexture(t),this.markAllDefinesAsDirty()}copyTo(e){var t;const i=e;(t=i.colorsTexture)==null||t.dispose(),this._colors&&(i.colorsTexture=ft.CreateColorsTexture(`${i._material.name}-colors-texture`,this._colors,i.colorsSampling,this._scene)),i.setColor(this.color,!0),i.colorsDistributionType=this.colorsDistributionType,i.colorsSampling=this.colorsSampling,i.colorMode=this.colorMode,i.useColors=this.useColors,i.visibility=this.visibility,i.useDash=this.useDash,i.dashCount=this.dashCount,i.dashRatio=this.dashRatio,i.dashOffset=this.dashOffset,i.width=this.width,i.sizeAttenuation=this.sizeAttenuation,i.resolution=this.resolution,i.markAllDefinesAsDirty()}}Bn.GREASED_LINE_MATERIAL_NAME="GreasedLinePluginMaterial";ye(`BABYLON.${Bn.GREASED_LINE_MATERIAL_NAME}`,Bn);const MO="greasedLinePixelShader",PO=`precision highp float;uniform sampler2D grlColors;uniform float grlUseColors;uniform float grlUseDash;uniform float grlDashArray;uniform float grlDashOffset;uniform float grlDashRatio;uniform float grlVisibility;uniform float grlColorsWidth;uniform vec2 grl_colorModeAndColorDistributionType;uniform vec3 grlColor;varying float grlCounters;varying float grlColorPointer;void main() {float grlColorMode=grl_colorModeAndColorDistributionType.x;float grlColorDistributionType=grl_colorModeAndColorDistributionType.y;gl_FragColor=vec4(grlColor,1.);gl_FragColor.a=step(grlCounters,grlVisibility);if (gl_FragColor.a==0.) discard;if( grlUseDash==1. ){gl_FragColor.a=ceil(mod(grlCounters+grlDashOffset,grlDashArray)-(grlDashArray*grlDashRatio));if (gl_FragColor.a==0.) discard;}
if (grlUseColors==1.) {vec4 textureColor;if (grlColorDistributionType==COLOR_DISTRIBUTION_TYPE_LINE) { 
textureColor=texture2D(grlColors,vec2(grlCounters,0.),0.);} else {textureColor=texture2D(grlColors,vec2(grlColorPointer/grlColorsWidth,0.),0.);}
if (grlColorMode==COLOR_MODE_SET) {gl_FragColor=textureColor;} else if (grlColorMode==COLOR_MODE_ADD) {gl_FragColor+=textureColor;} else if (grlColorMode==COLOR_MODE_MULTIPLY) {gl_FragColor*=textureColor;}}}
`;Y.ShadersStore[MO]=PO;const OO="greasedLineVertexShader",DO=`precision highp float;
#include<instancesDeclaration>
attribute float grl_widths;attribute vec3 grl_offsets;attribute float grl_colorPointers;attribute vec3 position;uniform mat4 viewProjection;uniform mat4 projection;varying float grlCounters;varying float grlColorPointer;
#ifdef GREASED_LINE_CAMERA_FACING
attribute vec4 grl_nextAndCounters;attribute vec4 grl_previousAndSide;uniform vec2 grlResolution;uniform float grlAspect;uniform float grlWidth;uniform float grlSizeAttenuation;vec2 grlFix( vec4 i,float aspect ) {vec2 res=i.xy/i.w;res.x*=aspect;return res;}
#else
attribute vec3 grl_slopes;attribute float grl_counters;
#endif
void main() {
#include<instancesVertex>
grlColorPointer=grl_colorPointers;
#ifdef GREASED_LINE_CAMERA_FACING
float grlBaseWidth=grlWidth;vec3 grlPrevious=grl_previousAndSide.xyz;float grlSide=grl_previousAndSide.w;vec3 grlNext=grl_nextAndCounters.xyz;grlCounters=grl_nextAndCounters.w;mat4 grlMatrix=viewProjection*finalWorld ;vec3 grlPositionOffset=grl_offsets;vec4 grlFinalPosition=grlMatrix*vec4( position+grlPositionOffset ,1.0 );vec4 grlPrevPos=grlMatrix*vec4( grlPrevious+grlPositionOffset,1.0 );vec4 grlNextPos=grlMatrix*vec4( grlNext+grlPositionOffset,1.0 );vec2 grlCurrentP=grlFix( grlFinalPosition,grlAspect );vec2 grlPrevP=grlFix( grlPrevPos,grlAspect );vec2 grlNextP=grlFix( grlNextPos,grlAspect );float grlWidth=grlBaseWidth*grl_widths;vec2 grlDir;if( grlNextP==grlCurrentP ) grlDir=normalize( grlCurrentP-grlPrevP );else if( grlPrevP==grlCurrentP ) grlDir=normalize( grlNextP-grlCurrentP );else {vec2 grlDir1=normalize( grlCurrentP-grlPrevP );vec2 grlDir2=normalize( grlNextP-grlCurrentP );grlDir=normalize( grlDir1+grlDir2 );}
vec4 grlNormal=vec4( -grlDir.y,grlDir.x,0.,1. );
#ifdef GREASED_LINE_RIGHT_HANDED_COORDINATE_SYSTEM
grlNormal.xy*=-.5*grlWidth;
#else
grlNormal.xy*=.5*grlWidth;
#endif
grlNormal*=projection;if (grlSizeAttenuation==1.) {grlNormal.xy*=grlFinalPosition.w;grlNormal.xy/=( vec4( grlResolution,0.,1. )*projection ).xy;}
grlFinalPosition.xy+=grlNormal.xy*grlSide;gl_Position=grlFinalPosition;
#else
grlCounters=grl_counters;vec4 grlFinalPosition=worldViewProjection*vec4( (position+grl_offsets)+grl_slopes*grl_widths ,1.0 ) ;gl_Position=grlFinalPosition;
#endif
}
`;Y.ShadersStore[OO]=DO;class NO extends Hs{constructor(e,t,i){const r=[`COLOR_DISTRIBUTION_TYPE_LINE ${zs.COLOR_DISTRIBUTION_TYPE_LINE}.`,`COLOR_DISTRIBUTION_TYPE_SEGMENT ${zs.COLOR_DISTRIBUTION_TYPE_SEGMENT}.`,`COLOR_MODE_SET ${Sr.COLOR_MODE_SET}.`,`COLOR_MODE_ADD ${Sr.COLOR_MODE_ADD}.`,`COLOR_MODE_MULTIPLY ${Sr.COLOR_MODE_MULTIPLY}.`],s=["position","grl_widths","grl_offsets","grl_colorPointers"];t.useRightHandedSystem&&r.push("GREASED_LINE_RIGHT_HANDED_COORDINATE_SYSTEM"),i.cameraFacing?(r.push("GREASED_LINE_CAMERA_FACING"),s.push("grl_previousAndSide","grl_nextAndCounters")):(s.push("grl_slopes"),s.push("grl_counters")),super(e,t,{vertex:"greasedLine",fragment:"greasedLine"},{attributes:s,uniforms:["world","viewProjection","view","projection","grlColorsWidth","grlUseColors","grlWidth","grlColor","grl_colorModeAndColorDistributionType","grlResolution","grlAspect","grlAizeAttenuation","grlDashArray","grlDashOffset","grlDashRatio","grlUseDash","grlVisibility"],samplers:["grlColors"],defines:r}),this._color=De.White(),this._colorsDistributionType=zs.COLOR_DISTRIBUTION_TYPE_SEGMENT,this._colorsTexture=null,i=i||{color:Bi.DEFAULT_COLOR};const o=t.getEngine();this.visibility=i.visibility??1,this.useDash=i.useDash??!1,this.dashRatio=i.dashRatio??.5,this.dashOffset=i.dashOffset??0,this.dashCount=i.dashCount??1,this.width=i.width?i.width:i.sizeAttenuation&&i.cameraFacing?Bi.DEFAULT_WIDTH_ATTENUATED:Bi.DEFAULT_WIDTH,this.sizeAttenuation=i.sizeAttenuation??!1,this.color=i.color??De.White(),this.useColors=i.useColors??!1,this.colorsDistributionType=i.colorDistributionType??zs.COLOR_DISTRIBUTION_TYPE_SEGMENT,this.colorsSampling=i.colorsSampling??lr.NEAREST_NEAREST,this.colorMode=i.colorMode??Sr.COLOR_MODE_SET,this._colors=i.colors??null,this._cameraFacing=i.cameraFacing??!0,this.resolution=i.resolution??new me(o.getRenderWidth(),o.getRenderHeight()),i.colorsTexture?this.colorsTexture=i.colorsTexture:this.colorsTexture=ft.PrepareEmptyColorsTexture(t),this._colors&&this.setColors(this._colors),o.onDisposeObservable.add(()=>{ft.DisposeEmptyColorsTexture()})}dispose(){var e;(e=this._colorsTexture)==null||e.dispose(),super.dispose()}_setColorModeAndColorDistributionType(){this.setVector2("grl_colorModeAndColorDistributionType",new me(this._colorMode,this._colorsDistributionType))}updateLazy(){this._colors&&this.setColors(this._colors,!1,!0)}get colors(){return this._colors}set colors(e){this.setColors(e)}setColors(e,t=!1,i=!1){var r,s,o;const a=((r=this._colors)==null?void 0:r.length)??0;if(this._colors=e,e===null||e.length===0){(s=this._colorsTexture)==null||s.dispose();return}if(!(t&&!i))if(this._colorsTexture&&a===e.length&&!i){const l=ft.Color3toRGBAUint8(e);this._colorsTexture.update(l)}else(o=this._colorsTexture)==null||o.dispose(),this.colorsTexture=ft.CreateColorsTexture(`${this.name}-colors-texture`,e,this.colorsSampling,this.getScene())}get colorsTexture(){return this._colorsTexture??null}set colorsTexture(e){this._colorsTexture=e,this.setFloat("grlColorsWidth",this._colorsTexture.getSize().width),this.setTexture("grlColors",this._colorsTexture)}get width(){return this._width}set width(e){this._width=e,this.setFloat("grlWidth",e)}get useColors(){return this._useColors}set useColors(e){this._useColors=e,this.setFloat("grlUseColors",ft.BooleanToNumber(e))}get colorsSampling(){return this._colorsSampling}set colorsSampling(e){this._colorsSampling=e}get visibility(){return this._visibility}set visibility(e){this._visibility=e,this.setFloat("grlVisibility",e)}get useDash(){return this._useDash}set useDash(e){this._useDash=e,this.setFloat("grlUseDash",ft.BooleanToNumber(e))}get dashOffset(){return this._dashOffset}set dashOffset(e){this._dashOffset=e,this.setFloat("grlDashOffset",e)}get dashRatio(){return this._dashRatio}set dashRatio(e){this._dashRatio=e,this.setFloat("grlDashRatio",e)}get dashCount(){return this._dashCount}set dashCount(e){this._dashCount=e,this._dashArray=1/e,this.setFloat("grlDashArray",this._dashArray)}get sizeAttenuation(){return this._sizeAttenuation}set sizeAttenuation(e){this._sizeAttenuation=e,this.setFloat("grlSizeAttenuation",ft.BooleanToNumber(e))}get color(){return this.color}set color(e){this.setColor(e)}setColor(e){e=e??Bi.DEFAULT_COLOR,this._color=e,this.setColor3("grlColor",e)}get colorsDistributionType(){return this._colorsDistributionType}set colorsDistributionType(e){this._colorsDistributionType=e,this._setColorModeAndColorDistributionType()}get colorMode(){return this._colorMode}set colorMode(e){this._colorMode=e,this._setColorModeAndColorDistributionType()}get resolution(){return this._resolution}set resolution(e){this._resolution=e,this.setVector2("grlResolution",e),this.setFloat("grlAspect",e.x/e.y)}serialize(){const e=super.serialize(),t={colorDistributionType:this._colorsDistributionType,colorsSampling:this._colorsSampling,colorMode:this._colorMode,color:this._color,dashCount:this._dashCount,dashOffset:this._dashOffset,dashRatio:this._dashRatio,resolution:this._resolution,sizeAttenuation:this._sizeAttenuation,useColors:this._useColors,useDash:this._useDash,visibility:this._visibility,width:this._width,cameraFacing:this._cameraFacing};return this._colors&&(t.colors=this._colors),e.greasedLineMaterialOptions=t,e}parse(e,t,i){var r;const s=e.greasedLineMaterialOptions;(r=this._colorsTexture)==null||r.dispose(),s.color&&(this.color=s.color),s.colorDistributionType&&(this.colorsDistributionType=s.colorDistributionType),s.colorsSampling&&(this.colorsSampling=s.colorsSampling),s.colorMode&&(this.colorMode=s.colorMode),s.useColors&&(this.useColors=s.useColors),s.visibility&&(this.visibility=s.visibility),s.useDash&&(this.useDash=s.useDash),s.dashCount&&(this.dashCount=s.dashCount),s.dashRatio&&(this.dashRatio=s.dashRatio),s.dashOffset&&(this.dashOffset=s.dashOffset),s.width&&(this.width=s.width),s.sizeAttenuation&&(this.sizeAttenuation=s.sizeAttenuation),s.resolution&&(this.resolution=s.resolution),s.colors?this.colorsTexture=ft.CreateColorsTexture(`${this.name}-colors-texture`,s.colors,this.colorsSampling,this.getScene()):this.colorsTexture=ft.PrepareEmptyColorsTexture(t),this._cameraFacing=s.cameraFacing??!0,this.setDefine("GREASED_LINE_CAMERA_FACING",this._cameraFacing)}}var ws;(function(n){n[n.POINTS_MODE_POINTS=0]="POINTS_MODE_POINTS",n[n.POINTS_MODE_PATHS=1]="POINTS_MODE_PATHS"})(ws||(ws={}));var Du;(function(n){n[n.FACES_MODE_SINGLE_SIDED=0]="FACES_MODE_SINGLE_SIDED",n[n.FACES_MODE_SINGLE_SIDED_NO_BACKFACE_CULLING=1]="FACES_MODE_SINGLE_SIDED_NO_BACKFACE_CULLING",n[n.FACES_MODE_DOUBLE_SIDED=2]="FACES_MODE_DOUBLE_SIDED"})(Du||(Du={}));var ma;(function(n){n[n.AUTO_DIRECTIONS_FROM_FIRST_SEGMENT=0]="AUTO_DIRECTIONS_FROM_FIRST_SEGMENT",n[n.AUTO_DIRECTIONS_FROM_ALL_SEGMENTS=1]="AUTO_DIRECTIONS_FROM_ALL_SEGMENTS",n[n.AUTO_DIRECTIONS_ENHANCED=2]="AUTO_DIRECTIONS_ENHANCED",n[n.AUTO_DIRECTIONS_NONE=99]="AUTO_DIRECTIONS_NONE"})(ma||(ma={}));class Y0 extends k{constructor(e,t,i){super(e,t,null,null,!1,!1),this.name=e,this._options=i,this._lazy=!1,this._updatable=!1,this._engine=t.getEngine(),this._lazy=i.lazy??!1,this._updatable=i.updatable??!1,this._vertexPositions=[],this._indices=[],this._uvs=[],this._points=[],this._colorPointers=i.colorPointers??[],this._widths=i.widths??new Array(i.points.length).fill(1)}getClassName(){return"GreasedLineMesh"}_updateWidthsWithValue(e){let t=0;for(const r of this._points)t+=r.length;const i=t/3*2-this._widths.length;for(let r=0;r<i;r++)this._widths.push(e)}updateLazy(){var e,t;this._setPoints(this._points),this._options.colorPointers||this._updateColorPointers(),this._createVertexBuffers((e=this._options.ribbonOptions)==null?void 0:e.smoothShading),this.refreshBoundingInfo(),(t=this.greasedLineMaterial)==null||t.updateLazy()}addPoints(e,t){for(const i of e)this._points.push(i);this._lazy||this.setPoints(this._points,t)}dispose(e,t=!1){super.dispose(e,t)}isLazy(){return this._lazy}get offsets(){return this._offsets}set offsets(e){this._offsets=e,this._offsetsBuffer?this._offsetsBuffer.update(e):this._createOffsetsBuffer(e)}get widths(){return this._widths}set widths(e){this._widths=e,this._lazy||this._widthsBuffer&&this._widthsBuffer.update(e)}get colorPointers(){return this._colorPointers}set colorPointers(e){this._colorPointers=e,this._lazy||this._colorPointersBuffer&&this._colorPointersBuffer.update(e)}get greasedLineMaterial(){var e,t;if(this.material&&this.material instanceof NO)return this.material;const i=(t=(e=this.material)==null?void 0:e.pluginManager)==null?void 0:t.getPlugin(Bn.GREASED_LINE_MATERIAL_NAME);if(i)return i}get points(){const e=[];return Vn.DeepCopy(this._points,e),e}setPoints(e,t){this._points=e,this._updateWidths(),t!=null&&t.colorPointers||this._updateColorPointers(),this._setPoints(e,t)}_initGreasedLine(){this._vertexPositions=[],this._indices=[],this._uvs=[]}_createLineOptions(){return{points:this._points,colorPointers:this._colorPointers,lazy:this._lazy,updatable:this._updatable,uvs:this._uvs,widths:this._widths,ribbonOptions:this._options.ribbonOptions}}serialize(e){super.serialize(e),e.type=this.getClassName(),e.lineOptions=this._createLineOptions()}_createVertexBuffers(e=!1){const t=new re;return t.positions=this._vertexPositions,t.indices=this._indices,t.uvs=this._uvs,e&&(t.normals=[],re.ComputeNormals(this._vertexPositions,this._indices,t.normals)),t.applyToMesh(this,this._options.updatable),t}_createOffsetsBuffer(e){const t=this._scene.getEngine(),i=new mr(t,e,this._updatable,3);this.setVerticesBuffer(i.createVertexBuffer("grl_offsets",0,3)),this._offsetsBuffer=i}}k._GreasedLineMeshParser=(n,e)=>ii.Parse(n,e);class ii extends Y0{constructor(e,t,i){super(e,t,i),this.name=e,this.intersectionThreshold=.1,this._previousAndSide=[],this._nextAndCounters=[],i.points&&this.addPoints(ft.ConvertPoints(i.points))}getClassName(){return"GreasedLineMesh"}_updateColorPointers(){if(this._options.colorPointers)return;let e=0;this._colorPointers=[],this._points.forEach(t=>{for(let i=0;i<t.length;i+=3)this._colorPointers.push(e),this._colorPointers.push(e++)})}_updateWidths(){super._updateWidthsWithValue(0)}_setPoints(e){this._points=e,this._options.points=e,this._initGreasedLine();let t=0;e.forEach(i=>{const r=[],s=[],o=[],a=ft.GetLineLength(i);for(let d=0,f=0;f<i.length;d++,f+=3){const p=i.slice(0,f+3),g=ft.GetLineLength(p)/a;if(s.push(i[f],i[f+1],i[f+2]),s.push(i[f],i[f+1],i[f+2]),r.push(g),r.push(g),f<i.length-3){const m=d*2+t;o.push(m,m+1,m+2),o.push(m+2,m+1,m+3)}}t+=i.length/3*2;const l=[],h=[],c=[];let u=[];this._preprocess(s,l,h,c,u);for(const d of s)this._vertexPositions.push(d);for(const d of o)this._indices.push(d);for(let d=0;d<c.length;d++)this._previousAndSide.push(l[d*3],l[d*3+1],l[d*3+2],c[d]),this._nextAndCounters.push(h[d*3],h[d*3+1],h[d*3+2],r[d]);u=this._options.uvs??u;for(const d of u)this._uvs.push(d)}),this._lazy||(this._options.colorPointers||this._updateColorPointers(),this._createVertexBuffers(),this.refreshBoundingInfo())}clone(e=`${this.name}-cloned`,t){const i=this._createLineOptions(),r={};Vn.DeepCopy(i,r,["instance"],void 0,!0);const s=new ii(e,this._scene,r);return t&&(s.parent=t),s.material=this.material,s}serialize(e){super.serialize(e),e.type=this.getClassName(),e.lineOptions=this._createLineOptions()}static Parse(e,t){const i=e.lineOptions,r=e.name;return new ii(r,t,i)}_initGreasedLine(){super._initGreasedLine(),this._previousAndSide=[],this._nextAndCounters=[]}intersects(e,t,i,r=!1,s,o=!1){const a=new Ts,l=this.findAllIntersections(e,t,i,r,s,o,!0);if((l==null?void 0:l.length)===1){const h=l[0];a.hit=!0,a.distance=h.distance,a.ray=e,a.pickedMesh=this,a.pickedPoint=h.point}return a}findAllIntersections(e,t,i,r=!1,s,o=!1,a=!1){var l;if(r&&!o&&e.intersectsSphere(this._boundingSphere,this.intersectionThreshold)===!1)return;const h=this.getIndices(),c=this.getVerticesData(b.PositionKind),u=this._widths,d=((l=this.greasedLineMaterial)==null?void 0:l.width)??1,f=[];if(h&&c&&u){let p=0,g=0;for(p=0,g=h.length-1;p<g;p+=3){const m=h[p],x=h[p+1];ii._V_START.fromArray(c,m*3),ii._V_END.fromArray(c,x*3),this._offsets&&(ii._V_OFFSET_START.fromArray(this._offsets,m*3),ii._V_OFFSET_END.fromArray(this._offsets,x*3),ii._V_START.addInPlace(ii._V_OFFSET_START),ii._V_END.addInPlace(ii._V_OFFSET_END));const E=Math.floor(p/3),R=u[E]!==void 0?u[E]:1,C=this.intersectionThreshold*(d*R)/2,_=e.intersectionSegment(ii._V_START,ii._V_END,C);if(_!==-1&&(f.push({distance:_,point:e.direction.normalize().multiplyByFloats(_,_,_).add(e.origin)}),a))return f}p=g}return f}get _boundingSphere(){return this.getBoundingInfo().boundingSphere}static _CompareV3(e,t,i){const r=e*6,s=t*6;return i[r]===i[s]&&i[r+1]===i[s+1]&&i[r+2]===i[s+2]}static _CopyV3(e,t){const i=e*6;return[t[i],t[i+1],t[i+2]]}_preprocess(e,t,i,r,s){const o=e.length/6;let a=[];ii._CompareV3(0,o-1,e)?a=ii._CopyV3(o-2,e):a=ii._CopyV3(0,e),t.push(a[0],a[1],a[2]),t.push(a[0],a[1],a[2]);for(let l=0;l<o;l++)r.push(1),r.push(-1),this._options.uvs||(s.push(l/(o-1),0),s.push(l/(o-1),1)),l<o-1&&(a=ii._CopyV3(l,e),t.push(a[0],a[1],a[2]),t.push(a[0],a[1],a[2])),l>0&&(a=ii._CopyV3(l,e),i.push(a[0],a[1],a[2]),i.push(a[0],a[1],a[2]));return ii._CompareV3(o-1,0,e)?a=ii._CopyV3(1,e):a=ii._CopyV3(o-1,e),i.push(a[0],a[1],a[2]),i.push(a[0],a[1],a[2]),{previous:t,next:i,uvs:s,side:r}}_createVertexBuffers(){const e=super._createVertexBuffers(),t=this._scene.getEngine(),i=new mr(t,this._previousAndSide,!1,4);this.setVerticesBuffer(i.createVertexBuffer("grl_previousAndSide",0,4));const r=new mr(t,this._nextAndCounters,!1,4);this.setVerticesBuffer(r.createVertexBuffer("grl_nextAndCounters",0,4));const s=new mr(t,this._widths,this._updatable,1);this.setVerticesBuffer(s.createVertexBuffer("grl_widths",0,1)),this._widthsBuffer=s;const o=new mr(t,this._colorPointers,this._updatable,1);return this.setVerticesBuffer(o.createVertexBuffer("grl_colorPointers",0,1)),this._colorPointersBuffer=o,e}}ii._V_START=new v;ii._V_END=new v;ii._V_OFFSET_START=new v;ii._V_OFFSET_END=new v;k._GreasedLineRibbonMeshParser=(n,e)=>li.Parse(n,e);class li extends Y0{constructor(e,t,i,r){if(super(e,t,i),this.name=e,!i.ribbonOptions)throw"'GreasedLineMeshOptions.ribbonOptions' is not set.";this._paths=[],this._counters=[],this._slopes=[],this._widths=i.widths??[],this._ribbonWidths=[],this._pathsOptions=r??[],i.points&&this.addPoints(ft.ConvertPoints(i.points),i,!!r)}addPoints(e,t,i=!1){if(!t.ribbonOptions)throw"addPoints() on GreasedLineRibbonMesh instance requires 'GreasedLineMeshOptions.ribbonOptions'.";i||this._pathsOptions.push({options:t,pathCount:e.length}),super.addPoints(e,t)}getClassName(){return"GreasedLineRibbonMesh"}get isFlatLine(){return this._paths.length<3}get slopes(){return this._slopes}set slopes(e){this._slopes=e}_updateColorPointers(){if(this._options.colorPointers)return;let e=0;this._colorPointers=[];for(let t=0;t<this._pathsOptions.length;t++){const{options:i,pathCount:r}=this._pathsOptions[t],s=this._points[t];if(i.ribbonOptions.pointsMode===ws.POINTS_MODE_POINTS)for(let o=0;o<r;o++)for(let a=0;a<s.length;a+=3)this._colorPointers.push(e),this._colorPointers.push(e++);else for(let o=0;o<s.length;o+=3){for(let a=0;a<r;a++)this._colorPointers.push(e);e++}}}_updateWidths(){super._updateWidthsWithValue(1)}_setPoints(e,t){var i,r;if(!this._options.ribbonOptions)throw"No 'GreasedLineMeshOptions.ribbonOptions' provided.";this._points=e,this._options.points=e,this._initGreasedLine();let s=0,o;for(let a=0,l=0;a<this._pathsOptions.length;a++){const{options:h,pathCount:c}=this._pathsOptions[a],u=e.slice(l,l+c);if(l+=c,((i=h.ribbonOptions)==null?void 0:i.pointsMode)===ws.POINTS_MODE_PATHS)s=this._preprocess(ft.ToVector3Array(u),s,h);else{if(((r=h.ribbonOptions)==null?void 0:r.directionsAutoMode)===ma.AUTO_DIRECTIONS_NONE){if(!h.ribbonOptions.directions)throw"In GreasedLineRibbonAutoDirectionMode.AUTO_DIRECTIONS_NONE 'GreasedLineMeshOptions.ribbonOptions.directions' must be defined.";o=li._GetDirectionPlanesFromDirectionsOption(u.length,h.ribbonOptions.directions)}u.forEach((d,f)=>{const p=li._ConvertToRibbonPath(d,h.ribbonOptions,this._scene.useRightHandedSystem,o&&o[f]);s=this._preprocess(p,s,h)})}}this._lazy||(this._createVertexBuffers(),this.refreshBoundingInfo())}static _GetDirectionPlanesFromDirectionsOption(e,t){return Array.isArray(t)?t:new Array(e).fill(t)}static _CreateRibbonVertexData(e,t){var i,r;const s=e.length;if(s<2)throw"Minimum of two paths are required to create a GreasedLineRibbonMesh.";const o=[],a=[],l=e[0];for(let d=0;d<l.length;d++)for(let f=0;f<e.length;f++){const p=e[f][d];o.push(p.x,p.y,p.z)}const h=[1,0,s],c=((i=t.ribbonOptions)==null?void 0:i.facesMode)===Du.FACES_MODE_DOUBLE_SIDED,u=((r=t.ribbonOptions)==null?void 0:r.pointsMode)===ws.POINTS_MODE_PATHS&&t.ribbonOptions.closePath;if(s>2)for(let d=0;d<l.length-1;d++){h[0]=1+s*d,h[1]=s*d,h[2]=(d+1)*s;for(let f=0;f<(s-1)*2;f++)f%2!==0&&(h[2]+=1),f%2===0&&f>0&&(h[0]+=1,h[1]+=1),a.push(h[1]+(f%2!==0?s:0),h[0],h[2]),c&&a.push(h[0],h[1]+(f%2!==0?s:0),h[2])}else for(let d=0;d<o.length/3-3;d+=2)a.push(d,d+1,d+2),a.push(d+2,d+1,d+3),c&&(a.push(d+1,d,d+2),a.push(d+1,d+2,d+3));if(u){let d=s*(l.length-1);for(let f=0;f<s-1;f++)a.push(d,f+1,f),a.push(d+1,f+1,d),c&&(a.push(f,f+1,d),a.push(d,f+1,d+1)),d++}return{positions:o,indices:a}}_preprocess(e,t,i){var r,s;this._paths=e;const o=li._CreateRibbonVertexData(e,i),a=o.positions;if(!this._options.widths)throw"No 'GreasedLineMeshOptions.widths' table is specified.";for(const d of a)this._vertexPositions.push(d);let l=e;if(((r=i.ribbonOptions)==null?void 0:r.pointsMode)===ws.POINTS_MODE_PATHS&&i.ribbonOptions.closePath){l=[];for(let d=0;d<e.length;d++){const f=e[d].slice();f.push(e[d][0].clone()),l.push(f)}}this._calculateSegmentLengths(l);const h=l.length,c=new Array(h).fill(0);for(let d=0;d<l[0].length;d++){let f=0;for(let p=0;p<h;p++){const g=c[p]+this._vSegmentLengths[p][d]/this._vTotalLengths[p];this._counters.push(g),this._uvs.push(g,f),c[p]=g,f+=this._uSegmentLengths[d][p]/this._uTotalLengths[d]}}for(let d=0,f=0;d<l[0].length;d++){const p=this._uSegmentLengths[d][0]/2,g=this._uSegmentLengths[d][h-1]/2;this._ribbonWidths.push(((this._widths[f++]??1)-1)*p);for(let m=0;m<h-2;m++)this._ribbonWidths.push(0);this._ribbonWidths.push(((this._widths[f++]??1)-1)*g)}const u=((s=i.ribbonOptions)==null?void 0:s.pointsMode)===ws.POINTS_MODE_PATHS?new Array(l[0].length*l.length*6).fill(0):li._CalculateSlopes(l);for(const d of u)this._slopes.push(d);if(o.indices)for(let d=0;d<o.indices.length;d++)this._indices.push(o.indices[d]+t);return t+=a.length/3,t}static _ConvertToRibbonPath(e,t,i,r){if(t.pointsMode===ws.POINTS_MODE_POINTS&&!t.width)throw"'GreasedLineMeshOptions.ribbonOptiosn.width' must be specified in GreasedLineRibbonPointsMode.POINTS_MODE_POINTS.";const s=[],o=[];if(t.pointsMode===ws.POINTS_MODE_POINTS){const a=t.width/2,l=ft.ToVector3Array(e);let h=null,c=null;t.directionsAutoMode===ma.AUTO_DIRECTIONS_FROM_FIRST_SEGMENT&&(r=li._GetDirectionFromPoints(l[0],l[1],null));for(let u=0;u<l.length-(r?0:1);u++){const d=l[u],f=l[u+1];if(r)h=r;else if(t.directionsAutoMode===ma.AUTO_DIRECTIONS_FROM_ALL_SEGMENTS)h=li._GetDirectionFromPoints(d,f,h);else{const p=f.subtract(d);p.applyRotationQuaternionInPlace(p.x>p.y&&p.x>p.z?i?li._RightHandedForwardReadOnlyQuaternion:li._LeftHandedForwardReadOnlyQuaternion:li._LeftReadOnlyQuaternion),h=p.normalize()}c=h.multiplyByFloats(a,a,a),s.push(d.add(c)),o.push(d.subtract(c))}r||(s.push(l[l.length-1].add(c)),o.push(l[l.length-1].subtract(c)))}return[s,o]}static _GetDirectionFromPoints(e,t,i){return e.x===t.x&&(!i||(i==null?void 0:i.x)===1)?li.DIRECTION_YZ:e.y===t.y?li.DIRECTION_XZ:e.z===t.z?li.DIRECTION_XY:li.DIRECTION_XZ}clone(e=`${this.name}-cloned`,t){const i=this._createLineOptions(),r={},s=[];Vn.DeepCopy(this._pathsOptions,s,void 0,void 0,!0),Vn.DeepCopy(i,r,["instance"],void 0,!0);const o=new li(e,this._scene,r,s);return t&&(o.parent=t),o.material=this.material,o}serialize(e){super.serialize(e),e.type=this.getClassName(),e.lineOptions=this._createLineOptions(),e.pathsOptions=this._pathsOptions}static Parse(e,t){const i=e.lineOptions,r=e.name,s=e.pathOptions;return new li(r,t,i,s)}_initGreasedLine(){super._initGreasedLine(),this._paths=[],this._counters=[],this._slopes=[],this._ribbonWidths=[]}_calculateSegmentLengths(e){const t=e.length;this._vSegmentLengths=new Array(t),this._vTotalLengths=new Array(t);let i=0;for(let o=0;o<t;o++){const a=e[o];this._vSegmentLengths[o]=[0],i=0;for(let l=0;l<a.length-1;l++){const h=Math.abs(a[l].subtract(a[l+1]).lengthSquared());i+=h,this._vSegmentLengths[o].push(h)}this._vTotalLengths[o]=i}const r=e[0].length;this._uSegmentLengths=new Array(r).fill([]),this._uTotalLengths=new Array(r).fill([]);const s=new v;for(let o=0;o<r;o++){i=0;for(let a=1;a<t;a++){e[a][o].subtractToRef(e[a-1][o],s);const l=s.length();i+=l,this._uSegmentLengths[o].push(l)}this._uTotalLengths[o]=i}}static _CalculateSlopes(e){const t=e[0],i=e.length===2?e[1]:e[e.length-1],r=[],s=new v;for(let o=0;o<t.length;o++)for(let a=0;a<e.length;a++)a===0||a===e.length-1?(t[o].subtract(i[o]).normalizeToRef(s),r.push(s.x,s.y,s.z),r.push(-s.x,-s.y,-s.z)):r.push(0,0,0,0,0,0);return r}_createVertexBuffers(){var e;this._uvs=this._options.uvs??this._uvs;const t=super._createVertexBuffers((e=this._options.ribbonOptions)==null?void 0:e.smoothShading),i=new mr(this._engine,this._counters,this._updatable,1);this.setVerticesBuffer(i.createVertexBuffer("grl_counters",0,1));const r=new mr(this._engine,this._colorPointers,this._updatable,1);this.setVerticesBuffer(r.createVertexBuffer("grl_colorPointers",0,1));const s=new mr(this._engine,this._slopes,this._updatable,3);this.setVerticesBuffer(s.createVertexBuffer("grl_slopes",0,3));const o=new mr(this._engine,this._ribbonWidths,this._updatable,1);return this.setVerticesBuffer(o.createVertexBuffer("grl_widths",0,1)),this._widthsBuffer=o,t}}li.DEFAULT_WIDTH=.1;li._RightHandedForwardReadOnlyQuaternion=Re.RotationAxis(v.RightHandedForwardReadOnly,Math.PI/2);li._LeftHandedForwardReadOnlyQuaternion=Re.RotationAxis(v.LeftHandedForwardReadOnly,Math.PI/2);li._LeftReadOnlyQuaternion=Re.RotationAxis(v.LeftReadOnly,Math.PI/2);li.DIRECTION_XY=v.LeftHandedForwardReadOnly;li.DIRECTION_XZ=v.UpReadOnly;li.DIRECTION_YZ=v.LeftReadOnly;var Dg;(function(n){n[n.COLOR_DISTRIBUTION_NONE=0]="COLOR_DISTRIBUTION_NONE",n[n.COLOR_DISTRIBUTION_REPEAT=1]="COLOR_DISTRIBUTION_REPEAT",n[n.COLOR_DISTRIBUTION_EVEN=2]="COLOR_DISTRIBUTION_EVEN",n[n.COLOR_DISTRIBUTION_START=3]="COLOR_DISTRIBUTION_START",n[n.COLOR_DISTRIBUTION_END=4]="COLOR_DISTRIBUTION_END",n[n.COLOR_DISTRIBUTION_START_END=5]="COLOR_DISTRIBUTION_START_END"})(Dg||(Dg={}));var Ng;(function(n){n[n.WIDTH_DISTRIBUTION_NONE=0]="WIDTH_DISTRIBUTION_NONE",n[n.WIDTH_DISTRIBUTION_REPEAT=1]="WIDTH_DISTRIBUTION_REPEAT",n[n.WIDTH_DISTRIBUTION_EVEN=2]="WIDTH_DISTRIBUTION_EVEN",n[n.WIDTH_DISTRIBUTION_START=3]="WIDTH_DISTRIBUTION_START",n[n.WIDTH_DISTRIBUTION_END=4]="WIDTH_DISTRIBUTION_END",n[n.WIDTH_DISTRIBUTION_START_END=5]="WIDTH_DISTRIBUTION_START_END"})(Ng||(Ng={}));k.prototype.thinInstanceAdd=function(n,e=!0){if(!this.getScene().getEngine().getCaps().instancedArrays)return oe.Error("Thin Instances are not supported on this device as Instanced Array extension not supported"),-1;this._thinInstanceUpdateBufferSize("matrix",Array.isArray(n)?n.length:1);const t=this._thinInstanceDataStorage.instancesCount;if(Array.isArray(n))for(let i=0;i<n.length;++i)this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,n[i],i===n.length-1&&e);else this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,n,e);return t};k.prototype.thinInstanceAddSelf=function(n=!0){return this.thinInstanceAdd(U.IdentityReadOnly,n)};k.prototype.thinInstanceRegisterAttribute=function(n,e){n===b.ColorKind&&(n=b.ColorInstanceKind),this.removeVerticesData(n),this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.strides[n]=e,this._userThinInstanceBuffersStorage.sizes[n]=e*Math.max(32,this._thinInstanceDataStorage.instancesCount),this._userThinInstanceBuffersStorage.data[n]=new Float32Array(this._userThinInstanceBuffersStorage.sizes[n]),this._userThinInstanceBuffersStorage.vertexBuffers[n]=new b(this.getEngine(),this._userThinInstanceBuffersStorage.data[n],n,!0,!1,e,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[n])};k.prototype.thinInstanceSetMatrixAt=function(n,e,t=!0){if(!this._thinInstanceDataStorage.matrixData||n>=this._thinInstanceDataStorage.instancesCount)return!1;const i=this._thinInstanceDataStorage.matrixData;return e.copyToArray(i,n*16),this._thinInstanceDataStorage.worldMatrices&&(this._thinInstanceDataStorage.worldMatrices[n]=e),t&&(this.thinInstanceBufferUpdated("matrix"),this.doNotSyncBoundingInfo||this.thinInstanceRefreshBoundingInfo(!1)),!0};k.prototype.thinInstanceSetAttributeAt=function(n,e,t,i=!0){return n===b.ColorKind&&(n=b.ColorInstanceKind),!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.data[n]||e>=this._thinInstanceDataStorage.instancesCount?!1:(this._thinInstanceUpdateBufferSize(n,0),this._userThinInstanceBuffersStorage.data[n].set(t,e*this._userThinInstanceBuffersStorage.strides[n]),i&&this.thinInstanceBufferUpdated(n),!0)};Object.defineProperty(k.prototype,"thinInstanceCount",{get:function(){return this._thinInstanceDataStorage.instancesCount},set:function(n){var e;const t=this._thinInstanceDataStorage.matrixData??((e=this.source)==null?void 0:e._thinInstanceDataStorage.matrixData),i=t?t.length/16:0;n<=i&&(this._thinInstanceDataStorage.instancesCount=n)},enumerable:!0,configurable:!0});k.prototype._thinInstanceCreateMatrixBuffer=function(n,e,t=!0){const i=new mr(this.getEngine(),e,!t,16,!1,!0);for(let r=0;r<4;r++)this.setVerticesBuffer(i.createVertexBuffer(n+r,r*4,4));return i};k.prototype.thinInstanceSetBuffer=function(n,e,t=0,i=!0){var r,s,o;t=t||16,n==="matrix"?((r=this._thinInstanceDataStorage.matrixBuffer)==null||r.dispose(),this._thinInstanceDataStorage.matrixBuffer=null,this._thinInstanceDataStorage.matrixBufferSize=e?e.length:32*t,this._thinInstanceDataStorage.matrixData=e,this._thinInstanceDataStorage.worldMatrices=null,e!==null?(this._thinInstanceDataStorage.instancesCount=e.length/t,this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",e,i),this.doNotSyncBoundingInfo||this.thinInstanceRefreshBoundingInfo(!1)):(this._thinInstanceDataStorage.instancesCount=0,this.doNotSyncBoundingInfo||this.refreshBoundingInfo())):n==="previousMatrix"?((s=this._thinInstanceDataStorage.previousMatrixBuffer)==null||s.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=null,this._thinInstanceDataStorage.previousMatrixData=e,e!==null&&(this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",e,i))):(n===b.ColorKind&&(n=b.ColorInstanceKind),e===null?(o=this._userThinInstanceBuffersStorage)!=null&&o.data[n]&&(this.removeVerticesData(n),delete this._userThinInstanceBuffersStorage.data[n],delete this._userThinInstanceBuffersStorage.strides[n],delete this._userThinInstanceBuffersStorage.sizes[n],delete this._userThinInstanceBuffersStorage.vertexBuffers[n]):(this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.data[n]=e,this._userThinInstanceBuffersStorage.strides[n]=t,this._userThinInstanceBuffersStorage.sizes[n]=e.length,this._userThinInstanceBuffersStorage.vertexBuffers[n]=new b(this.getEngine(),e,n,!i,!1,t,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[n])))};k.prototype.thinInstanceBufferUpdated=function(n){var e,t,i;n==="matrix"?(this.thinInstanceAllowAutomaticStaticBufferRecreation&&this._thinInstanceDataStorage.matrixBuffer&&!this._thinInstanceDataStorage.matrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(n),(e=this._thinInstanceDataStorage.matrixBuffer)==null||e.updateDirectly(this._thinInstanceDataStorage.matrixData,0,this._thinInstanceDataStorage.instancesCount)):n==="previousMatrix"?(this.thinInstanceAllowAutomaticStaticBufferRecreation&&this._thinInstanceDataStorage.previousMatrixBuffer&&!this._thinInstanceDataStorage.previousMatrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(n),(t=this._thinInstanceDataStorage.previousMatrixBuffer)==null||t.updateDirectly(this._thinInstanceDataStorage.previousMatrixData,0,this._thinInstanceDataStorage.instancesCount)):(n===b.ColorKind&&(n=b.ColorInstanceKind),(i=this._userThinInstanceBuffersStorage)!=null&&i.vertexBuffers[n]&&(this.thinInstanceAllowAutomaticStaticBufferRecreation&&!this._userThinInstanceBuffersStorage.vertexBuffers[n].isUpdatable()&&this._thinInstanceRecreateBuffer(n),this._userThinInstanceBuffersStorage.vertexBuffers[n].updateDirectly(this._userThinInstanceBuffersStorage.data[n],0)))};k.prototype.thinInstancePartialBufferUpdate=function(n,e,t){var i;n==="matrix"?this._thinInstanceDataStorage.matrixBuffer&&this._thinInstanceDataStorage.matrixBuffer.updateDirectly(e,t):(n===b.ColorKind&&(n=b.ColorInstanceKind),(i=this._userThinInstanceBuffersStorage)!=null&&i.vertexBuffers[n]&&this._userThinInstanceBuffersStorage.vertexBuffers[n].updateDirectly(e,t))};k.prototype.thinInstanceGetWorldMatrices=function(){if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return[];const n=this._thinInstanceDataStorage.matrixData;if(!this._thinInstanceDataStorage.worldMatrices){this._thinInstanceDataStorage.worldMatrices=[];for(let e=0;e<this._thinInstanceDataStorage.instancesCount;++e)this._thinInstanceDataStorage.worldMatrices[e]=U.FromArray(n,e*16)}return this._thinInstanceDataStorage.worldMatrices};k.prototype.thinInstanceRefreshBoundingInfo=function(n=!1,e=!1,t=!1){if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return;const i=this._thinInstanceDataStorage.boundingVectors;if(n||!this.rawBoundingInfo){i.length=0,this.refreshBoundingInfo(e,t);const o=this.getBoundingInfo();this.rawBoundingInfo=new br(o.minimum,o.maximum)}const r=this.getBoundingInfo(),s=this._thinInstanceDataStorage.matrixData;if(i.length===0)for(let o=0;o<r.boundingBox.vectors.length;++o)i.push(r.boundingBox.vectors[o].clone());W.Vector3[0].setAll(Number.POSITIVE_INFINITY),W.Vector3[1].setAll(Number.NEGATIVE_INFINITY);for(let o=0;o<this._thinInstanceDataStorage.instancesCount;++o){U.FromArrayToRef(s,o*16,W.Matrix[0]);for(let a=0;a<i.length;++a)v.TransformCoordinatesToRef(i[a],W.Matrix[0],W.Vector3[2]),W.Vector3[0].minimizeInPlace(W.Vector3[2]),W.Vector3[1].maximizeInPlace(W.Vector3[2])}r.reConstruct(W.Vector3[0],W.Vector3[1]),this._updateBoundingInfo()};k.prototype._thinInstanceRecreateBuffer=function(n,e=!0){var t,i,r;n==="matrix"?((t=this._thinInstanceDataStorage.matrixBuffer)==null||t.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",this._thinInstanceDataStorage.matrixData,e)):n==="previousMatrix"?this._scene.needsPreviousWorldMatrices&&((i=this._thinInstanceDataStorage.previousMatrixBuffer)==null||i.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.previousMatrixData??this._thinInstanceDataStorage.matrixData,e)):(n===b.ColorKind&&(n=b.ColorInstanceKind),(r=this._userThinInstanceBuffersStorage.vertexBuffers[n])==null||r.dispose(),this._userThinInstanceBuffersStorage.vertexBuffers[n]=new b(this.getEngine(),this._userThinInstanceBuffersStorage.data[n],n,!e,!1,this._userThinInstanceBuffersStorage.strides[n],!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[n]))};k.prototype._thinInstanceUpdateBufferSize=function(n,e=1){var t,i,r;n===b.ColorKind&&(n=b.ColorInstanceKind);const s=n==="matrix";if(!s&&(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.strides[n]))return;const o=s?16:this._userThinInstanceBuffersStorage.strides[n],a=s?this._thinInstanceDataStorage.matrixBufferSize:this._userThinInstanceBuffersStorage.sizes[n];let l=s?this._thinInstanceDataStorage.matrixData:this._userThinInstanceBuffersStorage.data[n];const h=(this._thinInstanceDataStorage.instancesCount+e)*o;let c=a;for(;c<h;)c*=2;if(!l||a!=c){if(!l)l=new Float32Array(c);else{const u=new Float32Array(c);u.set(l,0),l=u}s?((t=this._thinInstanceDataStorage.matrixBuffer)==null||t.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",l,!1),this._thinInstanceDataStorage.matrixData=l,this._thinInstanceDataStorage.matrixBufferSize=c,this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&((i=this._thinInstanceDataStorage.previousMatrixBuffer)==null||i.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",l,!1))):((r=this._userThinInstanceBuffersStorage.vertexBuffers[n])==null||r.dispose(),this._userThinInstanceBuffersStorage.data[n]=l,this._userThinInstanceBuffersStorage.sizes[n]=c,this._userThinInstanceBuffersStorage.vertexBuffers[n]=new b(this.getEngine(),l,n,!0,!1,o,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[n]))}};k.prototype._thinInstanceInitializeUserStorage=function(){this._userThinInstanceBuffersStorage||(this._userThinInstanceBuffersStorage={data:{},sizes:{},vertexBuffers:{},strides:{}})};k.prototype._disposeThinInstanceSpecificData=function(){var n;(n=this._thinInstanceDataStorage)!=null&&n.matrixBuffer&&(this._thinInstanceDataStorage.matrixBuffer.dispose(),this._thinInstanceDataStorage.matrixBuffer=null)};var I;(function(n){n[n.Int=1]="Int",n[n.Float=2]="Float",n[n.Vector2=4]="Vector2",n[n.Vector3=8]="Vector3",n[n.Vector4=16]="Vector4",n[n.Matrix=32]="Matrix",n[n.Geometry=64]="Geometry",n[n.Texture=128]="Texture",n[n.AutoDetect=1024]="AutoDetect",n[n.BasedOnInput=2048]="BasedOnInput",n[n.Undefined=4096]="Undefined",n[n.All=4095]="All"})(I||(I={}));var an;(function(n){n[n.Compatible=0]="Compatible",n[n.TypeIncompatible=1]="TypeIncompatible",n[n.HierarchyIssue=2]="HierarchyIssue"})(an||(an={}));var Ma;(function(n){n[n.Input=0]="Input",n[n.Output=1]="Output"})(Ma||(Ma={}));class Fg{get direction(){return this._direction}get type(){if(this._type===I.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource&&this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type}if(this._type===I.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(e){this._type=e}get isConnected(){return this.connectedPoint!==null||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return this._endpoints.length===0?[]:this._endpoints.map(e=>e.ownerBlock)}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&this._linkedConnectionSource.isConnected?this.type:this._type}_resetCounters(){this._callCount=0,this._executionCount=0}get callCount(){return this._callCount}get executionCount(){return this._executionCount}getConnectedValue(e){var t;return this.isConnected?(t=this._connectedPoint)!=null&&t._storedFunction?(this._connectedPoint._callCount++,this._connectedPoint._executionCount++,this._connectedPoint._storedFunction(e)):(this._connectedPoint._callCount++,this._connectedPoint._executionCount=1,this._connectedPoint._storedValue):(this._callCount++,this._executionCount=1,this.value)}constructor(e,t,i){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=I.Geometry,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._defaultConnectionPointType=null,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new he,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._callCount=0,this._executionCount=0,this._ownerBlock=t,this.name=e,this._direction=i}getClassName(){return"NodeGeometryConnectionPoint"}canConnectTo(e){return this.checkCompatibilityState(e)===an.Compatible}checkCompatibilityState(e){const t=this._ownerBlock,i=e.ownerBlock;if(this.type!==e.type&&e.innerType!==I.AutoDetect)return e.acceptedConnectionPointTypes&&e.acceptedConnectionPointTypes.indexOf(this.type)!==-1?an.Compatible:an.TypeIncompatible;if(e.excludedConnectionPointTypes&&e.excludedConnectionPointTypes.indexOf(this.type)!==-1)return an.TypeIncompatible;let r=i,s=t;return this.direction===Ma.Input&&(r=t,s=i),r.isAnAncestorOf(s)?an.HierarchyIssue:an.Compatible}connectTo(e,t=!1){if(!t&&!this.canConnectTo(e))throw"Cannot connect these two connectors.";return this._endpoints.push(e),e._connectedPoint=this,this.onConnectionObservable.notifyObservers(e),e.onConnectionObservable.notifyObservers(this),this}disconnectFrom(e){const t=this._endpoints.indexOf(e);return t===-1?this:(this._endpoints.splice(t,1),e._connectedPoint=null,this)}addExcludedConnectionPointFromAllowedTypes(e){let t=1;for(;t<I.All;)e&t||this.excludedConnectionPointTypes.push(t),t=t<<1}serialize(e=!0){const t={};return t.name=this.name,t.displayName=this.displayName,this.value!==void 0&&this.value!==null&&(this.value.asArray?(t.valueType="BABYLON."+this.value.getClassName(),t.value=this.value.asArray()):(t.valueType="number",t.value=this.value)),e&&this.connectedPoint&&(t.inputName=this.name,t.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,t.targetConnectionName=this.connectedPoint.name),t}dispose(){this.onConnectionObservable.clear()}}class Ve{get buildExecutionTime(){return this._buildExecutionTime}get inputs(){return this._inputs}get outputs(){return this._outputs}get name(){return this._name}set name(e){this._name=e}get isInput(){return this._isInput}get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isDebug(){return this._isDebug}get isUnique(){return this._isUnique}getClassName(){return"NodeGeometryBlock"}_inputRename(e){return e}_outputRename(e){return e}isAnAncestorOf(e){for(const t of this._outputs)if(t.hasEndpoints){for(const i of t.endpoints)if(i.ownerBlock===e||i.ownerBlock.isAnAncestorOf(e))return!0}return!1}isAnAncestorOfType(e){if(this.getClassName()===e)return!0;for(const t of this._outputs)if(t.hasEndpoints){for(const i of t.endpoints)if(i.ownerBlock.isAnAncestorOfType(e))return!0}return!1}getDescendantOfPredicate(e){if(e(this))return this;for(const t of this._outputs)if(t.hasEndpoints)for(const i of t.endpoints){const r=i.ownerBlock.getDescendantOfPredicate(e);if(r)return r}return null}constructor(e){this._name="",this._isInput=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._isDebug=!1,this._isUnique=!1,this._buildExecutionTime=0,this.onBuildObservable=new he,this._inputs=new Array,this._outputs=new Array,this._codeVariableName="",this.visibleOnFrame=!1,this._name=e,this.uniqueId=gd.UniqueId}registerInput(e,t,i=!1,r,s,o){const a=new Fg(e,this,Ma.Input);return a.type=t,a.isOptional=i,a.defaultValue=r,a.value=r,a.valueMin=s,a.valueMax=o,this._inputs.push(a),this}registerOutput(e,t,i){return i=i??new Fg(e,this,Ma.Output),i.type=t,this._outputs.push(i),this}_buildBlock(e){}_customBuildStep(e){}build(e){if(this._buildId===e.buildId)return!0;if(this._outputs.length>0){if(!this._outputs.some(i=>i.hasEndpoints)&&!this.isDebug)return!1;this.outputs.forEach(i=>i._resetCounters())}this._buildId=e.buildId;for(const i of this._inputs){if(!i.connectedPoint){i.isOptional||e.notConnectedNonOptionalInputs.push(i);continue}const r=i.connectedPoint.ownerBlock;r&&r!==this&&r.build(e)}this._customBuildStep(e),e.verbose&&oe.Log(`Building ${this.name} [${this.getClassName()}]`);const t=hr.Now;this._buildBlock(e),this._buildExecutionTime=hr.Now-t;for(const i of this._outputs)for(const r of i.endpoints){const s=r.ownerBlock;s&&s.build(e)}return this.onBuildObservable.notifyObservers(this),!1}_linkConnectionTypes(e,t,i=!1){i?this._inputs[t]._acceptedConnectionPointType=this._inputs[e]:this._inputs[e]._linkedConnectionSource=this._inputs[t],this._inputs[t]._linkedConnectionSource=this._inputs[e]}initialize(){}autoConfigure(){}getInputByName(e){const t=this._inputs.filter(i=>i.name===e);return t.length?t[0]:null}getOutputByName(e){const t=this._outputs.filter(i=>i.name===e);return t.length?t[0]:null}serialize(){const e={};e.customType="BABYLON."+this.getClassName(),e.id=this.uniqueId,e.name=this.name,e.inputs=[],e.outputs=[];for(const t of this.inputs)e.inputs.push(t.serialize());for(const t of this.outputs)e.outputs.push(t.serialize(!1));return e}_deserialize(e){this._name=e.name,this.comments=e.comments,this.visibleOnFrame=!!e.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(e)}_deserializePortDisplayNamesAndExposedOnFrame(e){const t=e.inputs,i=e.outputs;t&&t.forEach(r=>{const s=this.inputs.find(o=>o.name===r.name);if(s&&(r.displayName&&(s.displayName=r.displayName),r.isExposedOnFrame&&(s.isExposedOnFrame=r.isExposedOnFrame,s.exposedPortPosition=r.exposedPortPosition),r.value!==void 0&&r.value!==null))if(r.valueType==="number")s.value=r.value;else{const o=Er(r.valueType);o&&(s.value=o.FromArray(r.value))}}),i&&i.forEach((r,s)=>{r.displayName&&(this.outputs[s].displayName=r.displayName),r.isExposedOnFrame&&(this.outputs[s].isExposedOnFrame=r.isExposedOnFrame,this.outputs[s].exposedPortPosition=r.exposedPortPosition)})}_dumpPropertiesCode(){return`${this._codeVariableName}.visibleOnFrame = ${this.visibleOnFrame};
`}_dumpCodeForOutputConnections(e){let t="";if(e.indexOf(this)!==-1)return t;e.push(this);for(const i of this.inputs){if(!i.isConnected)continue;const r=i.connectedPoint,s=r.ownerBlock;t+=s._dumpCodeForOutputConnections(e),t+=`${s._codeVariableName}.${s._outputRename(r.name)}.connectTo(${this._codeVariableName}.${this._inputRename(i.name)});
`}return t}_dumpCode(e,t){t.push(this);const i=this.name.replace(/[^A-Za-z_]+/g,"");if(this._codeVariableName=i||`${this.getClassName()}_${this.uniqueId}`,e.indexOf(this._codeVariableName)!==-1){let o=0;do o++,this._codeVariableName=i+o;while(e.indexOf(this._codeVariableName)!==-1)}e.push(this._codeVariableName);let r=`
// ${this.getClassName()}
`;this.comments&&(r+=`// ${this.comments}
`);const s=this.getClassName();if(s==="GeometryInputBlock"){const o=this.type;r+=`var ${this._codeVariableName} = new BABYLON.GeometryInputBlock("${this.name}", ${o});
`}else r+=`var ${this._codeVariableName} = new BABYLON.${s}("${this.name}");
`;r+=this._dumpPropertiesCode();for(const o of this.inputs){if(!o.isConnected)continue;const a=o.connectedPoint.ownerBlock;t.indexOf(a)===-1&&(r+=a._dumpCode(e,t))}for(const o of this.outputs)if(o.hasEndpoints)for(const a of o.endpoints){const l=a.ownerBlock;l&&t.indexOf(l)===-1&&(r+=l._dumpCode(e,t))}return r}clone(){const e=this.serialize(),t=Er(e.customType);if(t){const i=new t;return i._deserialize(e),i}return null}dispose(){for(const e of this.inputs)e.dispose();for(const e of this.outputs)e.dispose();this.onBuildObservable.clear()}}M([V("comment")],Ve.prototype,"comments",void 0);class Z0 extends Ve{get currentVertexData(){return this._vertexData}constructor(e){super(e),this._vertexData=null,this._isUnique=!0,this.registerInput("geometry",I.Geometry)}getClassName(){return"GeometryOutputBlock"}get geometry(){return this._inputs[0]}_buildBlock(e){e.vertexData=this.geometry.getConnectedValue(e),this._vertexData=e.vertexData}}ye("BABYLON.GeometryOutputBlock",Z0);var at;(function(n){n[n.None=0]="None",n[n.Positions=1]="Positions",n[n.Normals=2]="Normals",n[n.Tangents=3]="Tangents",n[n.UV=4]="UV",n[n.UV2=5]="UV2",n[n.UV3=6]="UV3",n[n.UV4=7]="UV4",n[n.UV5=8]="UV5",n[n.UV6=9]="UV6",n[n.Colors=10]="Colors",n[n.VertexID=11]="VertexID",n[n.FaceID=12]="FaceID",n[n.GeometryID=13]="GeometryID",n[n.CollectionID=14]="CollectionID",n[n.LoopID=15]="LoopID",n[n.InstanceID=16]="InstanceID"})(at||(at={}));class FO{constructor(){this._rotationMatrix=new U,this._scalingMatrix=new U,this._positionMatrix=new U,this._scalingRotationMatrix=new U,this._transformMatrix=new U,this._tempVector3=new v,this.notConnectedNonOptionalInputs=[],this.noContextualData=[],this.vertexData=null,this._geometryContext=null,this._executionContext=null,this._instancingContext=null,this._geometryContextStack=[],this._executionContextStack=[],this._instancingContextStack=[]}get geometryContext(){return this._geometryContext}get executionContext(){return this._executionContext}get instancingContext(){return this._instancingContext}pushGeometryContext(e){this._geometryContext=e,this._geometryContextStack.push(this._geometryContext)}pushExecutionContext(e){this._executionContext=e,this._executionContextStack.push(this._executionContext)}pushInstancingContext(e){this._instancingContext=e,this._instancingContextStack.push(this._instancingContext)}restoreGeometryContext(){this._geometryContextStack.pop(),this._geometryContext=this._geometryContextStack.length>0?this._geometryContextStack[this._geometryContextStack.length-1]:null}restoreExecutionContext(){this._executionContextStack.pop(),this._executionContext=this._executionContextStack.length>0?this._executionContextStack[this._executionContextStack.length-1]:null}restoreInstancingContext(){this._instancingContextStack.pop(),this._instancingContext=this._instancingContextStack.length>0?this._instancingContextStack[this._instancingContextStack.length-1]:null}getContextualValue(e,t=!1){if(!this.executionContext)return t||this.noContextualData.push(e),null;const i=this.executionContext.getExecutionIndex();switch(e){case at.Positions:return this.executionContext.getOverridePositionsContextualValue?this.executionContext.getOverridePositionsContextualValue():!this.geometryContext||!this.geometryContext.positions?v.Zero():v.FromArray(this.geometryContext.positions,i*3);case at.Normals:return this.executionContext.getOverrideNormalsContextualValue?this.executionContext.getOverrideNormalsContextualValue():!this.geometryContext||!this.geometryContext.normals?v.Zero():v.FromArray(this.geometryContext.normals,i*3);case at.Colors:return!this.geometryContext||!this.geometryContext.colors?Ke.Zero():Ke.FromArray(this.geometryContext.colors,i*4);case at.Tangents:return!this.geometryContext||!this.geometryContext.tangents?Ke.Zero():Ke.FromArray(this.geometryContext.tangents,i*4);case at.UV:return this.executionContext.getOverrideUVs1ContextualValue?this.executionContext.getOverrideUVs1ContextualValue():!this.geometryContext||!this.geometryContext.uvs?me.Zero():me.FromArray(this.geometryContext.uvs,i*2);case at.UV2:return!this.geometryContext||!this.geometryContext.uvs2?me.Zero():me.FromArray(this.geometryContext.uvs2,i*2);case at.UV3:return!this.geometryContext||!this.geometryContext.uvs3?me.Zero():me.FromArray(this.geometryContext.uvs3,i*2);case at.UV4:return!this.geometryContext||!this.geometryContext.uvs4?me.Zero():me.FromArray(this.geometryContext.uvs4,i*2);case at.UV5:return!this.geometryContext||!this.geometryContext.uvs5?me.Zero():me.FromArray(this.geometryContext.uvs5,i*2);case at.UV6:return!this.geometryContext||!this.geometryContext.uvs6?me.Zero():me.FromArray(this.geometryContext.uvs6,i*2);case at.VertexID:return i;case at.FaceID:return this.executionContext.getExecutionFaceIndex();case at.LoopID:return this.executionContext.getExecutionLoopIndex();case at.InstanceID:return this.instancingContext?this.instancingContext.getInstanceIndex():0;case at.GeometryID:return this.geometryContext?this.geometryContext.uniqueId:0;case at.CollectionID:return!this.geometryContext||!this.geometryContext.metadata?0:this.geometryContext.metadata.collectionId||0}return null}adapt(e,t){const i=e.getConnectedValue(this)||0;if(e.type===t)return i;switch(t){case I.Vector2:return new me(i,i);case I.Vector3:return new v(i,i,i);case I.Vector4:return new Ke(i,i,i,i)}return null}adaptInput(e,t,i){var r;if(!e.isConnected)return e.value||i;const s=e.getConnectedValue(this);if(((r=e._connectedPoint)==null?void 0:r.type)===t)return s;switch(t){case I.Vector2:return new me(s,s);case I.Vector3:return new v(s,s,s);case I.Vector4:return new Ke(s,s,s,s)}return null}emitErrors(){let e="";for(const t of this.notConnectedNonOptionalInputs)e+=`input ${t.name} from block ${t.ownerBlock.name}[${t.ownerBlock.getClassName()}] is not connected and is not optional.
`;for(const t of this.noContextualData)e+=`Contextual input ${at[t]} has no context to pull data from (must be connected to a setXXX block or a instantiateXXX block).
`;if(e)throw`Build of NodeGeometry failed:
`+e}_instantiate(e,t,i,r,s){U.ScalingToRef(r.x,r.y,r.z,this._scalingMatrix),U.RotationYawPitchRollToRef(i.y,i.x,i.z,this._rotationMatrix),U.TranslationToRef(t.x,t.y,t.z,this._positionMatrix),this._scalingMatrix.multiplyToRef(this._rotationMatrix,this._scalingRotationMatrix),this._scalingRotationMatrix.multiplyToRef(this._positionMatrix,this._transformMatrix);for(let o=0;o<e.positions.length;o+=3)this._tempVector3.fromArray(e.positions,o),v.TransformCoordinatesToRef(this._tempVector3,this._transformMatrix,this._tempVector3),this._tempVector3.toArray(e.positions,o),e.normals&&(this._tempVector3.fromArray(e.normals,o),v.TransformNormalToRef(this._tempVector3,this._scalingRotationMatrix,this._tempVector3),this._tempVector3.toArray(e.normals,o));s.push(e)}_instantiateWithMatrix(e,t,i){for(let r=0;r<e.positions.length;r+=3)this._tempVector3.fromArray(e.positions,r),v.TransformCoordinatesToRef(this._tempVector3,t,this._tempVector3),this._tempVector3.toArray(e.positions,r),e.normals&&(this._tempVector3.fromArray(e.normals,r),v.TransformNormalToRef(this._tempVector3,t,this._tempVector3),this._tempVector3.toArray(e.normals,r));i.push(e)}_instantiateWithPositionAndMatrix(e,t,i,r){U.TranslationToRef(t.x,t.y,t.z,this._positionMatrix),i.multiplyToRef(this._positionMatrix,this._transformMatrix);for(let s=0;s<e.positions.length;s+=3)this._tempVector3.fromArray(e.positions,s),v.TransformCoordinatesToRef(this._tempVector3,this._transformMatrix,this._tempVector3),this._tempVector3.toArray(e.positions,s),e.normals&&(this._tempVector3.fromArray(e.normals,s),v.TransformNormalToRef(this._tempVector3,this._transformMatrix,this._tempVector3),this._tempVector3.toArray(e.normals,s));r.push(e)}}class oi extends Ve{get type(){if(this._type===I.AutoDetect&&this.value!=null){if(!isNaN(this.value))return this._type=I.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=I.Vector2,this._type;case"Vector3":return this._type=I.Vector3,this._type;case"Vector4":return this._type=I.Vector4,this._type;case"Matrix":return this._type=I.Matrix,this._type}}return this._type}get isContextual(){return this._contextualSource!==at.None}get contextualValue(){return this._contextualSource}set contextualValue(e){switch(this._contextualSource=e,e){case at.Positions:case at.Normals:this._type=I.Vector3;break;case at.Colors:case at.Tangents:this._type=I.Vector4;break;case at.UV:case at.UV2:case at.UV3:case at.UV4:case at.UV5:case at.UV6:this._type=I.Vector2;break;case at.VertexID:case at.GeometryID:case at.CollectionID:case at.FaceID:case at.LoopID:case at.InstanceID:this._type=I.Int;break}this.output&&(this.output.type=this._type)}constructor(e,t=I.AutoDetect){super(e),this._type=I.Undefined,this._contextualSource=at.None,this.min=0,this.max=0,this.groupInInspector="",this.onValueChangedObservable=new he,this._type=t,this._isInput=!0,this.setDefaultValue(),this.registerOutput("output",t)}get value(){return this._storedValue}set value(e){this.type===I.Float&&this.min!==this.max&&(e=Math.max(this.min,e),e=Math.min(this.max,e)),this._storedValue=e,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(e){this._valueCallback=e}getClassName(){return"GeometryInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.contextualValue=at.None,this.type){case I.Int:case I.Float:this.value=0;break;case I.Vector2:this.value=me.Zero();break;case I.Vector3:this.value=v.Zero();break;case I.Vector4:this.value=Ke.Zero();break;case I.Matrix:this.value=U.Identity();break}}_buildBlock(e){super._buildBlock(e),this.isContextual?(this.output._storedValue=null,this.output._storedFunction=t=>t.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}_dumpPropertiesCode(){const e=this._codeVariableName;if(this.isContextual)return super._dumpPropertiesCode()+`${e}.contextualValue = BABYLON.NodeGeometryContextualSources.${at[this._contextualSource]};
`;const t=[];let i="";switch(this.type){case I.Float:case I.Int:i=`${this.value}`;break;case I.Vector2:i=`new BABYLON.Vector2(${this.value.x}, ${this.value.y})`;break;case I.Vector3:i=`new BABYLON.Vector3(${this.value.x}, ${this.value.y}, ${this.value.z})`;break;case I.Vector4:i=`new BABYLON.Vector4(${this.value.x}, ${this.value.y}, ${this.value.z}, ${this.value.w})`;break}return t.push(`${e}.value = ${i}`),(this.type===I.Float||this.type===I.Int)&&t.push(`${e}.min = ${this.min}`,`${e}.max = ${this.max}`),t.push(""),super._dumpPropertiesCode()+t.join(`;
`)}serialize(){const e=super.serialize();return e.type=this.type,e.contextualValue=this.contextualValue,e.min=this.min,e.max=this.max,e.groupInInspector=this.groupInInspector,this._storedValue!==null&&!this.isContextual&&(this._storedValue.asArray?(e.valueType="BABYLON."+this._storedValue.getClassName(),e.value=this._storedValue.asArray()):(e.valueType="number",e.value=this._storedValue)),e}_deserialize(e){if(super._deserialize(e),this._type=e.type,this.contextualValue=e.contextualValue,this.min=e.min||0,this.max=e.max||0,this.groupInInspector=e.groupInInspector||"",!!e.valueType)if(e.valueType==="number")this._storedValue=e.value;else{const t=Er(e.valueType);t&&(this._storedValue=t.FromArray(e.value))}}}ye("BABYLON.GeometryInputBlock",oi);var lt;(function(n){n[n.Boolean=0]="Boolean",n[n.Float=1]="Float",n[n.Int=2]="Int",n[n.Vector2=3]="Vector2",n[n.List=4]="List"})(lt||(lt={}));function pt(n,e=lt.Boolean,t="PROPERTIES",i){return(r,s)=>{let o=r._propStore;o||(o=[],r._propStore=o),o.push({propertyName:s,displayName:n,type:e,groupName:t,options:i??{}})}}class wd extends Ve{constructor(e){super(e),this.evaluateContext=!1,this.registerInput("size",I.Float,!0,1),this.registerInput("width",I.Float,!0,0),this.registerInput("height",I.Float,!0,0),this.registerInput("depth",I.Float,!0,0),this.registerInput("subdivisions",I.Int,!0,1),this.registerInput("subdivisionsX",I.Int,!0,0),this.registerInput("subdivisionsY",I.Int,!0,0),this.registerInput("subdivisionsZ",I.Int,!0,0),this.registerOutput("geometry",I.Geometry)}getClassName(){return"BoxBlock"}get size(){return this._inputs[0]}get width(){return this._inputs[1]}get height(){return this._inputs[2]}get depth(){return this._inputs[3]}get subdivisions(){return this._inputs[4]}get subdivisionsX(){return this._inputs[5]}get subdivisionsY(){return this._inputs[6]}get subdivisionsZ(){return this._inputs[7]}get geometry(){return this._outputs[0]}autoConfigure(){if(!this.size.isConnected){if(!this.width.isConnected&&!this.height.isConnected&&!this.depth.isConnected){const e=new oi("Size");e.value=1,e.output.connectTo(this.size);return}if(!this.width.isConnected){const e=new oi("Width");e.value=1,e.output.connectTo(this.width)}if(!this.height.isConnected){const e=new oi("Height");e.value=1,e.output.connectTo(this.height)}if(!this.depth.isConnected){const e=new oi("Depth");e.value=1,e.output.connectTo(this.depth)}}}_buildBlock(e){const t={},i=r=>{t.size=this.size.getConnectedValue(r),t.width=this.width.getConnectedValue(r),t.height=this.height.getConnectedValue(r),t.depth=this.depth.getConnectedValue(r);const s=this.subdivisions.getConnectedValue(r),o=this.subdivisionsX.getConnectedValue(r),a=this.subdivisionsY.getConnectedValue(r),l=this.subdivisionsZ.getConnectedValue(r);return s&&(t.segments=s),o&&(t.widthSegments=o),a&&(t.heightSegments=a),l&&(t.depthSegments=l),mI(t)};if(this.evaluateContext)this.geometry._storedFunction=i;else{const r=i(e);this.geometry._storedFunction=()=>(this.geometry._executionCount=1,r.clone())}}_dumpPropertiesCode(){return super._dumpPropertiesCode()+`${this._codeVariableName}.evaluateContext = ${this.evaluateContext?"true":"false"};
`}serialize(){const e=super.serialize();return e.evaluateContext=this.evaluateContext,e}_deserialize(e){super._deserialize(e),this.evaluateContext=e.evaluateContext}}M([pt("Evaluate context",lt.Boolean,"ADVANCED",{notifiers:{rebuild:!0}})],wd.prototype,"evaluateContext",void 0);ye("BABYLON.BoxBlock",wd);class pr{_getGlobalNodeGeometryEditor(){if(typeof NODEGEOMETRYEDITOR<"u")return NODEGEOMETRYEDITOR;if(typeof BABYLON<"u"&&typeof BABYLON.NodeGeometryEditor<"u")return BABYLON}get buildExecutionTime(){return this._buildExecutionTime}constructor(e){this._buildId=pr._BuildIdGenerator++,this._buildWasSuccessful=!1,this._vertexData=null,this._buildExecutionTime=0,this.BJSNODEGEOMETRYEDITOR=this._getGlobalNodeGeometryEditor(),this.editorData=null,this.attachedBlocks=[],this.onBuildObservable=new he,this.outputBlock=null,this.name=e}getClassName(){return"NodeGeometry"}getBlockByName(e){let t=null;for(const i of this.attachedBlocks)if(i.name===e)if(!t)t=i;else return ge.Warn("More than one block was found with the name `"+e+"`"),t;return t}getBlockByPredicate(e){for(const t of this.attachedBlocks)if(e(t))return t;return null}getInputBlocks(){const e=[];for(const t of this.attachedBlocks)t.isInput&&e.push(t);return e}edit(e){return new Promise(t=>{if(this.BJSNODEGEOMETRYEDITOR=this.BJSNODEGEOMETRYEDITOR||this._getGlobalNodeGeometryEditor(),typeof this.BJSNODEGEOMETRYEDITOR>"u"){const i=e&&e.editorURL?e.editorURL:pr.EditorURL;ge.LoadBabylonScript(i,()=>{this.BJSNODEGEOMETRYEDITOR=this.BJSNODEGEOMETRYEDITOR||this._getGlobalNodeGeometryEditor(),this._createNodeEditor(e==null?void 0:e.nodeGeometryEditorConfig),t()})}else this._createNodeEditor(e==null?void 0:e.nodeGeometryEditorConfig),t()})}_createNodeEditor(e){const t={nodeGeometry:this,...e};this.BJSNODEGEOMETRYEDITOR.NodeGeometryEditor.Show(t)}build(e=!1,t=!0,i=!1){if(this._buildWasSuccessful=!1,!this.outputBlock)throw"You must define the outputBlock property before building the geometry";const r=hr.Now;this._initializeBlock(this.outputBlock,i);const s=new FO;s.buildId=this._buildId,s.verbose=e,this.outputBlock.build(s),t&&(this._buildId=pr._BuildIdGenerator++),this._buildExecutionTime=hr.Now-r,s.emitErrors(),this._buildWasSuccessful=!0,this._vertexData=s.vertexData,this.onBuildObservable.notifyObservers(this)}createMesh(e,t=null){if(this._buildWasSuccessful||this.build(),!this._vertexData)return null;const i=new k(e,t);return this._vertexData.applyToMesh(i),i._internalMetadata=i._internalMetadata||{},i._internalMetadata.nodeGeometry=this,i}updateMesh(e){return this._buildWasSuccessful||this.build(),this._vertexData?(this._vertexData.applyToMesh(e),e._internalMetadata=e._internalMetadata||{},e._internalMetadata.nodeGeometry=this,e):!1}_initializeBlock(e,t=!0){e.initialize(),t&&e.autoConfigure(),e._preparationId=this._buildId,this.attachedBlocks.indexOf(e)===-1&&this.attachedBlocks.push(e);for(const i of e.inputs){const r=i.connectedPoint;if(r){const s=r.ownerBlock;s!==e&&this._initializeBlock(s,t)}}}clear(){this.outputBlock=null,this.attachedBlocks.length=0}removeBlock(e){const t=this.attachedBlocks.indexOf(e);t>-1&&this.attachedBlocks.splice(t,1),e===this.outputBlock&&(this.outputBlock=null)}parseSerializedObject(e,t=!1){t||this.clear();const i={};for(const r of e.blocks){const s=Er(r.customType);if(s){const o=new s;o._deserialize(r),i[r.id]=o,this.attachedBlocks.push(o)}}for(const r of this.attachedBlocks)if(r.isTeleportOut){const s=r,o=s._tempEntryPointUniqueId;if(o){const a=i[o];a&&a.attachToEndpoint(s)}}for(let r=0;r<e.blocks.length;r++){const s=e.blocks[r],o=i[s.id];o&&(o.inputs.length&&s.inputs.some(a=>a.targetConnectionName)&&!t||this._restoreConnections(o,e,i))}if(e.outputNodeId&&(this.outputBlock=i[e.outputNodeId]),e.locations||e.editorData&&e.editorData.locations){const r=e.locations||e.editorData.locations;for(const o of r)i[o.blockId]&&(o.blockId=i[o.blockId].uniqueId);t&&this.editorData&&this.editorData.locations&&r.concat(this.editorData.locations),e.locations?this.editorData={locations:r}:(this.editorData=e.editorData,this.editorData.locations=r);const s=[];for(const o in i)s[o]=i[o].uniqueId;this.editorData.map=s}this.comment=e.comment}_restoreConnections(e,t,i){for(const r of e.outputs)for(const s of t.blocks){const o=i[s.id];if(o){for(const a of s.inputs)if(i[a.targetBlockId]===e&&a.targetConnectionName===r.name){const l=o.getInputByName(a.inputName);if(!l||l.isConnected)continue;r.connectTo(l,!0),this._restoreConnections(o,t,i);continue}}}}generateCode(){let e=[];const t=[],i=["const","var","let"];this.outputBlock&&this._gatherBlocks(this.outputBlock,t);let r=`let nodeGeometry = new BABYLON.NodeGeometry("${this.name||"node geometry"}");
`;for(const s of t)s.isInput&&e.indexOf(s)===-1&&(r+=s._dumpCode(i,e));return this.outputBlock&&(e=[],r+=`// Connections
`,r+=this.outputBlock._dumpCodeForOutputConnections(e),r+=`// Output nodes
`,r+=`nodeGeometry.outputBlock = ${this.outputBlock._codeVariableName};
`,r+=`nodeGeometry.build();
`),r}_gatherBlocks(e,t){if(t.indexOf(e)===-1){t.push(e);for(const i of e.inputs){const r=i.connectedPoint;if(r){const s=r.ownerBlock;s!==e&&this._gatherBlocks(s,t)}}if(e.isTeleportOut){const i=e;i.entryPoint&&this._gatherBlocks(i.entryPoint,t)}}}setToDefault(){this.clear(),this.editorData=null;const e=new wd("Box");e.autoConfigure();const t=new Z0("Geometry Output");e.geometry.connectTo(t.geometry),this.outputBlock=t}clone(e){const t=this.serialize(),i=Le.Clone(()=>new pr(e),this);return i.name=e,i.parseSerializedObject(t),i._buildId=this._buildId,i.build(!1),i}serialize(e){const t=e?{}:Le.Serialize(this);t.editorData=JSON.parse(JSON.stringify(this.editorData));let i=[];e?i=e:(t.customType="BABYLON.NodeGeometry",this.outputBlock&&(t.outputNodeId=this.outputBlock.uniqueId)),t.blocks=[];for(const r of i)t.blocks.push(r.serialize());if(!e)for(const r of this.attachedBlocks)i.indexOf(r)===-1&&t.blocks.push(r.serialize());return t}dispose(){for(const e of this.attachedBlocks)e.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(e){const t=new pr(e);return t.setToDefault(),t.build(),t}static Parse(e){const t=Le.Parse(()=>new pr(e.name),e,null);return t.parseSerializedObject(e),t.build(),t}static ParseFromSnippetAsync(e,t,i=!1){return e==="_BLANK"?Promise.resolve(pr.CreateDefault("blank")):new Promise((r,s)=>{const o=new Ei;o.addEventListener("readystatechange",()=>{if(o.readyState==4)if(o.status==200){const a=JSON.parse(JSON.parse(o.responseText).jsonPayload),l=JSON.parse(a.nodeGeometry);t||(t=Le.Parse(()=>new pr(e),l,null)),t.parseSerializedObject(l),t.snippetId=e;try{i||t.build(),r(t)}catch(h){s(h)}}else s("Unable to load the snippet "+e)}),o.open("GET",this.SnippetUrl+"/"+e.replace(/#/g,"/")),o.send()})}}pr._BuildIdGenerator=0;pr.EditorURL=`${ge._DefaultCdnUrl}/v${se.Version}/nodeGeometryEditor/babylon.nodeGeometryEditor.js`;pr.SnippetUrl="https://snippet.babylonjs.com";M([V()],pr.prototype,"name",void 0);M([V("comment")],pr.prototype,"comment",void 0);class Ud extends Ve{constructor(e){super(e),this.evaluateContext=!0,this.epsilon=xt,this.registerInput("geometry",I.Geometry),this.registerOutput("output",I.Geometry)}getClassName(){return"GeometryOptimizeBlock"}get geometry(){return this._inputs[0]}get output(){return this._outputs[0]}_buildBlock(e){const t=i=>{if(!this.geometry.isConnected)return null;const r=this.geometry.getConnectedValue(i),s=[],o={};for(let l=0;l<r.positions.length;l+=3){const h=r.positions[l],c=r.positions[l+1],u=r.positions[l+2];let d=!1;for(let f=0;f<s.length;f+=3)if(Ye.WithinEpsilon(h,s[f],this.epsilon)&&Ye.WithinEpsilon(c,s[f+1],this.epsilon)&&Ye.WithinEpsilon(u,s[f+2],this.epsilon)){o[l/3]=f/3,d=!0;continue}d||(o[l/3]=s.length/3,s.push(h,c,u))}const a=new re;return a.positions=s,a.indices=r.indices.map(l=>o[l]),a};this.evaluateContext?this.output._storedFunction=t:(this.output._storedFunction=null,this.output._storedValue=t(e))}_dumpPropertiesCode(){let e=super._dumpPropertiesCode()+`${this._codeVariableName}.evaluateContext = ${this.evaluateContext?"true":"false"};
`;return e+=`${this._codeVariableName}.epsilon = ${this.epsilon};
`,e}serialize(){const e=super.serialize();return e.evaluateContext=this.evaluateContext,e.epsilon=this.epsilon,e}_deserialize(e){super._deserialize(e),this.evaluateContext=e.evaluateContext,this.epsilon=e.epsilon}}M([pt("Evaluate context",lt.Boolean,"ADVANCED",{notifiers:{rebuild:!0}})],Ud.prototype,"evaluateContext",void 0);M([pt("Epsilon",lt.Float,"ADVANCED",{notifiers:{rebuild:!0}})],Ud.prototype,"epsilon",void 0);ye("BABYLON.GeometryOptimizeBlock",Ud);class j0 extends Ve{constructor(e){super(e),this.evaluateContext=!1,this.registerInput("size",I.Float,!0,1),this.registerInput("width",I.Float,!0,0),this.registerInput("height",I.Float,!0,0),this.registerOutput("geometry",I.Geometry)}getClassName(){return"PlaneBlock"}get size(){return this._inputs[0]}get width(){return this._inputs[1]}get height(){return this._inputs[2]}get geometry(){return this._outputs[0]}autoConfigure(){if(!this.size.isConnected){if(!this.width.isConnected&&!this.height.isConnected){const e=new oi("Size");e.value=1,e.output.connectTo(this.size);return}if(!this.width.isConnected){const e=new oi("Width");e.value=1,e.output.connectTo(this.width)}if(!this.height.isConnected){const e=new oi("Height");e.value=1,e.output.connectTo(this.height)}}}_buildBlock(e){const t={},i=r=>(t.size=this.size.getConnectedValue(r),t.width=this.width.getConnectedValue(r),t.height=this.height.getConnectedValue(r),Dd(t));if(this.evaluateContext)this.geometry._storedFunction=i;else{const r=i(e);this.geometry._storedFunction=()=>(this.geometry._executionCount=1,r.clone())}}_dumpPropertiesCode(){return super._dumpPropertiesCode()+`${this._codeVariableName}.evaluateContext = ${this.evaluateContext?"true":"false"};
`}serialize(){const e=super.serialize();return e.evaluateContext=this.evaluateContext,e}_deserialize(e){super._deserialize(e),this.evaluateContext=e.evaluateContext}}M([pt("Evaluate context",lt.Boolean,"ADVANCED",{notifiers:{rebuild:!0}})],j0.prototype,"evaluateContext",void 0);ye("BABYLON.PlaneBlock",j0);class Q0 extends Ve{get mesh(){return this._mesh}set mesh(e){this._mesh=e}constructor(e){super(e),this._cachedVertexData=null,this.reverseWindingOrder=!1,this.serializedCachedData=!1,this.registerOutput("geometry",I.Geometry)}getClassName(){return"MeshBlock"}get isUsingCachedData(){return!this.mesh&&!!this._cachedVertexData}get geometry(){return this._outputs[0]}cleanData(){this._mesh=null,this._cachedVertexData=null}_buildBlock(){if(!this._mesh){this._cachedVertexData?this.geometry._storedValue=this._cachedVertexData.clone():this.geometry._storedValue=null;return}const e=re.ExtractFromMesh(this._mesh,!1,!0);if(this._cachedVertexData=null,this.reverseWindingOrder&&e.indices)for(let t=0;t<e.indices.length;t+=3){const i=e.indices[t];e.indices[t]=e.indices[t+2],e.indices[t+2]=i}this.geometry._storedFunction=()=>e.clone()}serialize(){const e=super.serialize();return e.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(this._mesh?e.cachedVertexData=re.ExtractFromMesh(this._mesh,!1,!0).serialize():this._cachedVertexData&&(e.cachedVertexData=this._cachedVertexData.serialize())),e.reverseWindingOrder=this.reverseWindingOrder,e}_deserialize(e){super._deserialize(e),e.cachedVertexData&&(this._cachedVertexData=re.Parse(e.cachedVertexData)),this.serializedCachedData=!!e.serializedCachedData,this.reverseWindingOrder=e.reverseWindingOrder}}M([pt("Serialize cached data",lt.Boolean,"ADVANCED",{notifiers:{rebuild:!0}})],Q0.prototype,"serializedCachedData",void 0);ye("BABYLON.MeshBlock",Q0);class J0 extends Ve{constructor(e){super(e),this.evaluateContext=!1,this.registerInput("radius",I.Float,!0,1),this.registerInput("radiusX",I.Float,!0,0),this.registerInput("radiusY",I.Float,!0,0),this.registerInput("radiusZ",I.Float,!0,0),this.registerInput("subdivisions",I.Int,!0,4),this.registerOutput("geometry",I.Geometry)}getClassName(){return"IcoSphereBlock"}get radius(){return this._inputs[0]}get radiusX(){return this._inputs[1]}get radiusY(){return this._inputs[2]}get radiusZ(){return this._inputs[3]}get subdivisions(){return this._inputs[4]}get geometry(){return this._outputs[0]}autoConfigure(){if(!this.radius.isConnected){const e=new oi("Radius");e.value=.2,e.output.connectTo(this.radius)}}_buildBlock(e){const t={},i=r=>(t.radius=this.radius.getConnectedValue(r),t.subdivisions=this.subdivisions.getConnectedValue(r),t.radiusX=this.radiusX.getConnectedValue(r),t.radiusY=this.radiusY.getConnectedValue(r),t.radiusZ=this.radiusZ.getConnectedValue(r),Nd(t));if(this.evaluateContext)this.geometry._storedFunction=i;else{const r=i(e);this.geometry._storedFunction=()=>(this.geometry._executionCount=1,r.clone())}}_dumpPropertiesCode(){return super._dumpPropertiesCode()+`${this._codeVariableName}.evaluateContext = ${this.evaluateContext?"true":"false"};
`}serialize(){const e=super.serialize();return e.evaluateContext=this.evaluateContext,e}_deserialize(e){super._deserialize(e),this.evaluateContext=e.evaluateContext}}M([pt("Evaluate context",lt.Boolean,"ADVANCED",{notifiers:{rebuild:!0}})],J0.prototype,"evaluateContext",void 0);ye("BABYLON.IcoSphereBlock",J0);class $0 extends Ve{constructor(e){super(e),this.evaluateContext=!1,this.registerInput("segments",I.Int,!0,32),this.registerInput("diameter",I.Float,!0,1),this.registerInput("diameterX",I.Float,!0,0),this.registerInput("diameterY",I.Float,!0,0),this.registerInput("diameterZ",I.Float,!0,0),this.registerInput("arc",I.Float,!0,1),this.registerInput("slice",I.Float,!0,1),this.registerOutput("geometry",I.Geometry)}getClassName(){return"SphereBlock"}get segments(){return this._inputs[0]}get diameter(){return this._inputs[1]}get diameterX(){return this._inputs[2]}get diameterY(){return this._inputs[3]}get diameterZ(){return this._inputs[4]}get arc(){return this._inputs[5]}get slice(){return this._inputs[6]}get geometry(){return this._outputs[0]}autoConfigure(){if(!this.diameter.isConnected){const e=new oi("Diameter");e.value=1,e.output.connectTo(this.diameter)}}_buildBlock(e){const t={},i=r=>(t.segments=this.segments.getConnectedValue(r),t.diameter=this.diameter.getConnectedValue(r),t.diameterX=this.diameterX.getConnectedValue(r),t.diameterY=this.diameterY.getConnectedValue(r),t.diameterZ=this.diameterZ.getConnectedValue(r),t.arc=this.arc.getConnectedValue(r),t.slice=this.slice.getConnectedValue(r),Md(t));if(this.evaluateContext)this.geometry._storedFunction=i;else{const r=i(e);this.geometry._storedFunction=()=>(this.geometry._executionCount=1,r.clone())}}_dumpPropertiesCode(){return super._dumpPropertiesCode()+`${this._codeVariableName}.evaluateContext = ${this.evaluateContext?"true":"false"};
`}serialize(){const e=super.serialize();return e.evaluateContext=this.evaluateContext,e}_deserialize(e){super._deserialize(e),this.evaluateContext=e.evaluateContext}}M([pt("Evaluate context",lt.Boolean,"ADVANCED",{notifiers:{rebuild:!0}})],$0.prototype,"evaluateContext",void 0);ye("BABYLON.SphereBlock",$0);class ev extends Ve{constructor(e){super(e),this.evaluateContext=!1,this.registerInput("width",I.Float,!0,1),this.registerInput("height",I.Float,!0,1),this.registerInput("subdivisions",I.Int,!0,1),this.registerInput("subdivisionsX",I.Int,!0,0),this.registerInput("subdivisionsY",I.Int,!0,0),this.registerOutput("geometry",I.Geometry)}getClassName(){return"GridBlock"}get width(){return this._inputs[0]}get height(){return this._inputs[1]}get subdivisions(){return this._inputs[2]}get subdivisionsX(){return this._inputs[3]}get subdivisionsY(){return this._inputs[4]}get geometry(){return this._outputs[0]}autoConfigure(){if(!this.width.isConnected){const e=new oi("Width");e.value=1,e.output.connectTo(this.width)}if(!this.height.isConnected){const e=new oi("Height");e.value=1,e.output.connectTo(this.height)}}_buildBlock(e){const t={},i=r=>(t.width=this.width.getConnectedValue(r),t.height=this.height.getConnectedValue(r),t.subdivisions=this.subdivisions.getConnectedValue(r),t.subdivisionsX=this.subdivisionsX.getConnectedValue(r),t.subdivisionsY=this.subdivisionsY.getConnectedValue(r),Vs(t));if(this.evaluateContext)this.geometry._storedFunction=i;else{const r=i(e);this.geometry._storedFunction=()=>(this.geometry._executionCount=1,r.clone())}}_dumpPropertiesCode(){return super._dumpPropertiesCode()+`${this._codeVariableName}.evaluateContext = ${this.evaluateContext?"true":"false"};
`}serialize(){const e=super.serialize();return e.evaluateContext=this.evaluateContext,e}_deserialize(e){super._deserialize(e),this.evaluateContext=e.evaluateContext}}M([pt("Evaluate context",lt.Boolean,"ADVANCED",{notifiers:{rebuild:!0}})],ev.prototype,"evaluateContext",void 0);ye("BABYLON.GridBlock",ev);class tv extends Ve{constructor(e){super(e),this.evaluateContext=!1,this.registerInput("diameter",I.Float,!0,1),this.registerInput("thickness",I.Float,!0,.5),this.registerInput("tessellation",I.Int,!0,16),this.registerOutput("geometry",I.Geometry)}getClassName(){return"TorusBlock"}get diameter(){return this._inputs[0]}get thickness(){return this._inputs[1]}get tessellation(){return this._inputs[2]}get geometry(){return this._outputs[0]}autoConfigure(){if(!this.diameter.isConnected){const e=new oi("Diameter");e.value=1,e.output.connectTo(this.diameter)}}_buildBlock(e){const t={},i=r=>(t.thickness=this.thickness.getConnectedValue(r),t.diameter=this.diameter.getConnectedValue(r),t.tessellation=this.tessellation.getConnectedValue(r),Od(t));if(this.evaluateContext)this.geometry._storedFunction=i;else{const r=i(e);this.geometry._storedFunction=()=>(this.geometry._executionCount=1,r.clone())}}_dumpPropertiesCode(){return super._dumpPropertiesCode()+`${this._codeVariableName}.evaluateContext = ${this.evaluateContext?"true":"false"};
`}serialize(){const e=super.serialize();return e.evaluateContext=this.evaluateContext,e}_deserialize(e){super._deserialize(e),this.evaluateContext=e.evaluateContext}}M([pt("Evaluate context",lt.Boolean,"ADVANCED",{notifiers:{rebuild:!0}})],tv.prototype,"evaluateContext",void 0);ye("BABYLON.TorusBlock",tv);class iv extends Ve{constructor(e){super(e),this.evaluateContext=!1,this.registerInput("height",I.Float,!0,25),this.registerInput("diameter",I.Float,!0,1),this.registerInput("diameterTop",I.Float,!0,-1),this.registerInput("diameterBottom",I.Float,!0,-1),this.registerInput("subdivisions",I.Int,!0,1),this.registerInput("tessellation",I.Int,!0,24),this.registerInput("arc",I.Float,!0,1),this.registerOutput("geometry",I.Geometry)}getClassName(){return"CylinderBlock"}get height(){return this._inputs[0]}get diameter(){return this._inputs[1]}get diameterTop(){return this._inputs[2]}get diameterBottom(){return this._inputs[3]}get subdivisions(){return this._inputs[4]}get tessellation(){return this._inputs[5]}get arc(){return this._inputs[6]}get geometry(){return this._outputs[0]}autoConfigure(){if(!this.diameter.isConnected){const e=new oi("Diameter");e.value=1,e.output.connectTo(this.diameter)}if(!this.height.isConnected){const e=new oi("Height");e.value=1,e.output.connectTo(this.height)}}_buildBlock(e){const t={},i=r=>(t.height=this.height.getConnectedValue(r),t.diameter=this.diameter.getConnectedValue(r),t.diameterTop=this.diameterTop.getConnectedValue(r),t.diameterBottom=this.diameterBottom.getConnectedValue(r),t.diameterTop===-1&&(t.diameterTop=t.diameter),t.diameterBottom===-1&&(t.diameterBottom=t.diameter),t.tessellation=this.tessellation.getConnectedValue(r),t.subdivisions=this.subdivisions.getConnectedValue(r),t.arc=this.arc.getConnectedValue(r),Pd(t));if(this.evaluateContext)this.geometry._storedFunction=i;else{const r=i(e);this.geometry._storedFunction=()=>(this.geometry._executionCount=1,r.clone())}}_dumpPropertiesCode(){return super._dumpPropertiesCode()+`${this._codeVariableName}.evaluateContext = ${this.evaluateContext?"true":"false"};
`}serialize(){const e=super.serialize();return e.evaluateContext=this.evaluateContext,e}_deserialize(e){super._deserialize(e),this.evaluateContext=e.evaluateContext}}M([pt("Evaluate context",lt.Boolean,"ADVANCED",{notifiers:{rebuild:!0}})],iv.prototype,"evaluateContext",void 0);ye("BABYLON.CylinderBlock",iv);class rv extends Ve{constructor(e){super(e),this.evaluateContext=!1,this.registerInput("height",I.Float,!0,1),this.registerInput("radius",I.Float,!0,.25),this.registerInput("tessellation",I.Int,!0,16),this.registerInput("subdivisions",I.Int,!0,2),this.registerOutput("geometry",I.Geometry)}getClassName(){return"CapsuleBlock"}get height(){return this._inputs[0]}get radius(){return this._inputs[1]}get tessellation(){return this._inputs[2]}get subdivisions(){return this._inputs[3]}get geometry(){return this._outputs[0]}autoConfigure(){if(!this.height.isConnected){const e=new oi("Height");e.value=1,e.output.connectTo(this.height)}if(!this.radius.isConnected){const e=new oi("Radius");e.value=.2,e.output.connectTo(this.radius)}}_buildBlock(e){const t={},i=r=>(t.height=this.height.getConnectedValue(r),t.radius=this.radius.getConnectedValue(r),t.tessellation=this.tessellation.getConnectedValue(r),t.subdivisions=this.subdivisions.getConnectedValue(r),Fd(t));if(this.evaluateContext)this.geometry._storedFunction=i;else{const r=i(e);this.geometry._storedFunction=()=>(this.geometry._executionCount=1,r.clone())}}_dumpPropertiesCode(){return super._dumpPropertiesCode()+`${this._codeVariableName}.evaluateContext = ${this.evaluateContext?"true":"false"};
`}serialize(){const e=super.serialize();return e.evaluateContext=this.evaluateContext,e}_deserialize(e){super._deserialize(e),this.evaluateContext=e.evaluateContext}}M([pt("Evaluate context",lt.Boolean,"ADVANCED",{notifiers:{rebuild:!0}})],rv.prototype,"evaluateContext",void 0);ye("BABYLON.CapsuleBlock",rv);class sv extends Ve{constructor(e){super(e),this.evaluateContext=!1,this.registerInput("radius",I.Float,!0,.5),this.registerInput("tessellation",I.Int,!0,64),this.registerInput("arc",I.Float,!0,1),this.registerOutput("geometry",I.Geometry)}getClassName(){return"DiscBlock"}get radius(){return this._inputs[0]}get tessellation(){return this._inputs[1]}get arc(){return this._inputs[2]}get geometry(){return this._outputs[0]}autoConfigure(){if(!this.radius.isConnected){const e=new oi("Radius");e.value=.2,e.output.connectTo(this.radius)}}_buildBlock(e){const t={},i=r=>(t.radius=this.radius.getConnectedValue(r),t.tessellation=this.tessellation.getConnectedValue(r),t.arc=this.arc.getConnectedValue(r),Ad(t));if(this.evaluateContext)this.geometry._storedFunction=i;else{const r=i(e);this.geometry._storedFunction=()=>(this.geometry._executionCount=1,r.clone())}}_dumpPropertiesCode(){return super._dumpPropertiesCode()+`${this._codeVariableName}.evaluateContext = ${this.evaluateContext?"true":"false"};
`}serialize(){const e=super.serialize();return e.evaluateContext=this.evaluateContext,e}_deserialize(e){super._deserialize(e),this.evaluateContext=e.evaluateContext}}M([pt("Evaluate context",lt.Boolean,"ADVANCED",{notifiers:{rebuild:!0}})],sv.prototype,"evaluateContext",void 0);ye("BABYLON.DiscBlock",sv);class LO extends Ve{constructor(e){super(e),this.registerOutput("geometry",I.Geometry)}getClassName(){return"NullBlock"}get geometry(){return this._outputs[0]}_buildBlock(){this.geometry._storedValue=null}}ye("BABYLON.NullBlock",LO);class nv extends Ve{constructor(e){super(e),this.evaluateContext=!0,this.registerInput("geometry",I.Geometry),this.registerInput("positions",I.Vector3),this.registerOutput("output",I.Geometry)}getExecutionIndex(){return this._currentIndex}getExecutionLoopIndex(){return this._currentIndex}getExecutionFaceIndex(){return 0}getClassName(){return"SetPositionsBlock"}get geometry(){return this._inputs[0]}get positions(){return this._inputs[1]}get output(){return this._outputs[0]}_buildBlock(e){const t=i=>{if(i.pushExecutionContext(this),this._vertexData=this.geometry.getConnectedValue(i),this._vertexData&&(this._vertexData=this._vertexData.clone()),i.pushGeometryContext(this._vertexData),!this._vertexData||!this._vertexData.positions||!this.positions.isConnected){i.restoreGeometryContext(),i.restoreExecutionContext(),this.output._storedValue=null;return}const r=this._vertexData.positions.length/3;for(this._currentIndex=0;this._currentIndex<r;this._currentIndex++){const s=this.positions.getConnectedValue(i);s&&s.toArray(this._vertexData.positions,this._currentIndex*3)}return i.restoreGeometryContext(),i.restoreExecutionContext(),this._vertexData};this.evaluateContext?this.output._storedFunction=t:(this.output._storedFunction=null,this.output._storedValue=t(e))}_dumpPropertiesCode(){return super._dumpPropertiesCode()+`${this._codeVariableName}.evaluateContext = ${this.evaluateContext?"true":"false"};
`}serialize(){const e=super.serialize();return e.evaluateContext=this.evaluateContext,e}_deserialize(e){super._deserialize(e),e.evaluateContext!==void 0&&(this.evaluateContext=e.evaluateContext)}}M([pt("Evaluate context",lt.Boolean,"ADVANCED",{notifiers:{rebuild:!0}})],nv.prototype,"evaluateContext",void 0);ye("BABYLON.SetPositionsBlock",nv);class ov extends Ve{constructor(e){super(e),this.evaluateContext=!0,this.registerInput("geometry",I.Geometry),this.registerInput("normals",I.Vector3),this.registerOutput("output",I.Geometry)}getExecutionIndex(){return this._currentIndex}getExecutionLoopIndex(){return this._currentIndex}getExecutionFaceIndex(){return 0}getClassName(){return"SetNormalsBlock"}get geometry(){return this._inputs[0]}get normals(){return this._inputs[1]}get output(){return this._outputs[0]}_buildBlock(e){const t=i=>{if(i.pushExecutionContext(this),this._vertexData=this.geometry.getConnectedValue(i),this._vertexData&&(this._vertexData=this._vertexData.clone()),i.pushGeometryContext(this._vertexData),!this._vertexData||!this._vertexData.positions){i.restoreGeometryContext(),i.restoreExecutionContext(),this.output._storedValue=null;return}if(!this.normals.isConnected){i.restoreGeometryContext(),i.restoreExecutionContext(),this.output._storedValue=this._vertexData;return}this._vertexData.normals||(this._vertexData.normals=[]);const r=this._vertexData.positions.length/3;for(this._currentIndex=0;this._currentIndex<r;this._currentIndex++){const s=this.normals.getConnectedValue(i);s&&s.toArray(this._vertexData.normals,this._currentIndex*3)}return i.restoreGeometryContext(),i.restoreExecutionContext(),this._vertexData};this.evaluateContext?this.output._storedFunction=t:(this.output._storedFunction=null,this.output._storedValue=t(e))}_dumpPropertiesCode(){return super._dumpPropertiesCode()+`${this._codeVariableName}.evaluateContext = ${this.evaluateContext?"true":"false"};
`}serialize(){const e=super.serialize();return e.evaluateContext=this.evaluateContext,e}_deserialize(e){super._deserialize(e),e.evaluateContext!==void 0&&(this.evaluateContext=e.evaluateContext)}}M([pt("Evaluate context",lt.Boolean,"ADVANCED",{notifiers:{rebuild:!0}})],ov.prototype,"evaluateContext",void 0);ye("BABYLON.SetNormalsBlock",ov);class Vd extends Ve{constructor(e){super(e),this.evaluateContext=!0,this.textureCoordinateIndex=0,this.registerInput("geometry",I.Geometry),this.registerInput("uvs",I.Vector2),this.registerOutput("output",I.Geometry)}getExecutionIndex(){return this._currentIndex}getExecutionLoopIndex(){return this._currentIndex}getExecutionFaceIndex(){return 0}getClassName(){return"SetUVsBlock"}get geometry(){return this._inputs[0]}get uvs(){return this._inputs[1]}get output(){return this._outputs[0]}_buildBlock(e){const t=i=>{if(i.pushExecutionContext(this),this._vertexData=this.geometry.getConnectedValue(i),this._vertexData&&(this._vertexData=this._vertexData.clone()),i.pushGeometryContext(this._vertexData),!this._vertexData||!this._vertexData.positions){i.restoreGeometryContext(),i.restoreExecutionContext(),this.output._storedValue=null;return}if(!this.uvs.isConnected){i.restoreGeometryContext(),i.restoreExecutionContext(),this.output._storedValue=this._vertexData;return}const r=[],s=this._vertexData.positions.length/3;for(this._currentIndex=0;this._currentIndex<s;this._currentIndex++){const o=this.uvs.getConnectedValue(i);o&&o.toArray(r,this._currentIndex*2)}switch(this.textureCoordinateIndex){case 0:this._vertexData.uvs=r;break;case 1:this._vertexData.uvs2=r;break;case 2:this._vertexData.uvs3=r;break;case 3:this._vertexData.uvs4=r;break;case 4:this._vertexData.uvs5=r;break;case 5:this._vertexData.uvs6=r;break}return i.restoreGeometryContext(),i.restoreExecutionContext(),this._vertexData};this.evaluateContext?this.output._storedFunction=t:(this.output._storedFunction=null,this.output._storedValue=t(e))}_dumpPropertiesCode(){let e=super._dumpPropertiesCode()+`${this._codeVariableName}.textureCoordinateIndex};
`;return e+=`${this._codeVariableName}.evaluateContext = ${this.evaluateContext?"true":"false"};
`,e}serialize(){const e=super.serialize();return e.evaluateContext=this.evaluateContext,e.textureCoordinateIndex=this.textureCoordinateIndex,e}_deserialize(e){super._deserialize(e),this.textureCoordinateIndex=e.textureCoordinateIndex,e.evaluateContext!==void 0&&(this.evaluateContext=e.evaluateContext)}}M([pt("Evaluate context",lt.Boolean,"ADVANCED",{notifiers:{rebuild:!0}})],Vd.prototype,"evaluateContext",void 0);M([pt("Texture coordinates index",lt.List,"ADVANCED",{notifiers:{update:!0},options:[{label:"UV1",value:0},{label:"UV2",value:1},{label:"UV3",value:2},{label:"UV4",value:3},{label:"UV5",value:4},{label:"UV6",value:5}]})],Vd.prototype,"textureCoordinateIndex",void 0);ye("BABYLON.SetUVsBlock",Vd);class av extends Ve{constructor(e){super(e),this.evaluateContext=!0,this.registerInput("geometry",I.Geometry),this.registerInput("colors",I.AutoDetect),this.registerOutput("output",I.Geometry),this._inputs[1].excludedConnectionPointTypes.push(I.Int),this._inputs[1].excludedConnectionPointTypes.push(I.Float),this._inputs[1].excludedConnectionPointTypes.push(I.Vector2),this._inputs[1].excludedConnectionPointTypes.push(I.Texture),this._inputs[1].excludedConnectionPointTypes.push(I.Texture)}getExecutionIndex(){return this._currentIndex}getExecutionLoopIndex(){return this._currentIndex}getExecutionFaceIndex(){return 0}getClassName(){return"SetColorsBlock"}get geometry(){return this._inputs[0]}get colors(){return this._inputs[1]}get output(){return this._outputs[0]}_buildBlock(e){const t=i=>{var r;if(i.pushExecutionContext(this),this._vertexData=this.geometry.getConnectedValue(i),this._vertexData&&(this._vertexData=this._vertexData.clone()),i.pushGeometryContext(this._vertexData),!this._vertexData||!this._vertexData.positions){i.restoreGeometryContext(),i.restoreExecutionContext(),this.output._storedValue=null;return}if(!this.colors.isConnected){i.restoreGeometryContext(),i.restoreExecutionContext(),this.output._storedValue=this._vertexData;return}this._vertexData.colors||(this._vertexData.colors=[]);const s=this._vertexData.positions.length/3;for(this._currentIndex=0;this._currentIndex<s;this._currentIndex++)if(((r=this.colors.connectedPoint)==null?void 0:r.type)===I.Vector3){const o=this.colors.getConnectedValue(i);o&&(o.toArray(this._vertexData.colors,this._currentIndex*4),this._vertexData.colors[this._currentIndex*4+3]=1,this._vertexData.hasVertexAlpha=!1)}else{const o=this.colors.getConnectedValue(i);o&&(o.toArray(this._vertexData.colors,this._currentIndex*4),this._vertexData.hasVertexAlpha=!0)}return i.restoreGeometryContext(),i.restoreExecutionContext(),this._vertexData};this.evaluateContext?this.output._storedFunction=t:(this.output._storedFunction=null,this.output._storedValue=t(e))}_dumpPropertiesCode(){return super._dumpPropertiesCode()+`${this._codeVariableName}.evaluateContext = ${this.evaluateContext?"true":"false"};
`}serialize(){const e=super.serialize();return e.evaluateContext=this.evaluateContext,e}_deserialize(e){super._deserialize(e),e.evaluateContext!==void 0&&(this.evaluateContext=e.evaluateContext)}}M([pt("Evaluate context",lt.Boolean,"ADVANCED",{notifiers:{rebuild:!0}})],av.prototype,"evaluateContext",void 0);ye("BABYLON.SetColorsBlock",av);class lv extends Ve{constructor(e){super(e),this.evaluateContext=!0,this.registerInput("geometry",I.Geometry),this.registerInput("tangents",I.Vector4),this.registerOutput("output",I.Geometry)}getExecutionIndex(){return this._currentIndex}getExecutionLoopIndex(){return this._currentIndex}getExecutionFaceIndex(){return 0}getClassName(){return"SetTangentsBlock"}get geometry(){return this._inputs[0]}get tangents(){return this._inputs[1]}get output(){return this._outputs[0]}_buildBlock(e){const t=i=>{if(i.pushExecutionContext(this),this._vertexData=this.geometry.getConnectedValue(i),this._vertexData&&(this._vertexData=this._vertexData.clone()),i.pushGeometryContext(this._vertexData),!this._vertexData||!this._vertexData.positions){i.restoreGeometryContext(),i.restoreExecutionContext(),this.output._storedValue=null;return}if(!this.tangents.isConnected){i.restoreGeometryContext(),i.restoreExecutionContext(),this.output._storedValue=this._vertexData;return}this._vertexData.tangents||(this._vertexData.tangents=[]);const r=this._vertexData.positions.length/3;for(this._currentIndex=0;this._currentIndex<r;this._currentIndex++){const s=this.tangents.getConnectedValue(i);s&&s.toArray(this._vertexData.tangents,this._currentIndex*4)}return i.restoreGeometryContext(),i.restoreExecutionContext(),this._vertexData};this.evaluateContext?this.output._storedFunction=t:(this.output._storedFunction=null,this.output._storedValue=t(e))}_dumpPropertiesCode(){return super._dumpPropertiesCode()+`${this._codeVariableName}.evaluateContext = ${this.evaluateContext?"true":"false"};
`}serialize(){const e=super.serialize();return e.evaluateContext=this.evaluateContext,e}_deserialize(e){super._deserialize(e),e.evaluateContext!==void 0&&(this.evaluateContext=e.evaluateContext)}}M([pt("Evaluate context",lt.Boolean,"ADVANCED",{notifiers:{rebuild:!0}})],lv.prototype,"evaluateContext",void 0);ye("BABYLON.SetTangentsBlock",lv);var er;(function(n){n[n.Add=0]="Add",n[n.Subtract=1]="Subtract",n[n.Multiply=2]="Multiply",n[n.Divide=3]="Divide",n[n.Max=4]="Max",n[n.Min=5]="Min"})(er||(er={}));class hv extends Ve{constructor(e){super(e),this.operation=er.Add,this.registerInput("left",I.AutoDetect),this.registerInput("right",I.AutoDetect),this.registerOutput("output",I.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(I.Matrix),this._inputs[0].excludedConnectionPointTypes.push(I.Geometry),this._inputs[0].excludedConnectionPointTypes.push(I.Texture),this._inputs[1].excludedConnectionPointTypes.push(I.Matrix),this._inputs[1].excludedConnectionPointTypes.push(I.Geometry),this._inputs[1].excludedConnectionPointTypes.push(I.Texture),this._inputs[1].acceptedConnectionPointTypes.push(I.Float),this._linkConnectionTypes(0,1)}getClassName(){return"MathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_buildBlock(){let e;const t=this.left,i=this.right;if(!t.isConnected||!i.isConnected){this.output._storedFunction=null,this.output._storedValue=null;return}const r=t.type===I.Float||t.type===I.Int;switch(this.operation){case er.Add:{r?e=s=>t.getConnectedValue(s)+i.getConnectedValue(s):e=s=>t.getConnectedValue(s).add(s.adapt(i,t.type));break}case er.Subtract:{r?e=s=>t.getConnectedValue(s)-i.getConnectedValue(s):e=s=>t.getConnectedValue(s).subtract(s.adapt(i,t.type));break}case er.Multiply:{r?e=s=>t.getConnectedValue(s)*i.getConnectedValue(s):e=s=>t.getConnectedValue(s).multiply(s.adapt(i,t.type));break}case er.Divide:{r?e=s=>t.getConnectedValue(s)/i.getConnectedValue(s):e=s=>t.getConnectedValue(s).divide(s.adapt(i,t.type));break}case er.Min:{if(r)e=s=>Math.min(t.getConnectedValue(s),i.getConnectedValue(s));else switch(t.type){case I.Vector2:{e=s=>me.Minimize(t.getConnectedValue(s),s.adapt(i,t.type));break}case I.Vector3:{e=s=>v.Minimize(t.getConnectedValue(s),s.adapt(i,t.type));break}case I.Vector4:{e=s=>Ke.Minimize(t.getConnectedValue(s),s.adapt(i,t.type));break}}break}case er.Max:if(r)e=s=>Math.max(t.getConnectedValue(s),i.getConnectedValue(s));else{switch(t.type){case I.Vector2:{e=s=>me.Maximize(t.getConnectedValue(s),s.adapt(i,t.type));break}case I.Vector3:{e=s=>v.Maximize(t.getConnectedValue(s),s.adapt(i,t.type));break}case I.Vector4:{e=s=>Ke.Maximize(t.getConnectedValue(s),s.adapt(i,t.type));break}}break}}this.output._storedFunction=s=>t.type===I.Int?e(s)|0:e(s)}_dumpPropertiesCode(){return super._dumpPropertiesCode()+`${this._codeVariableName}.operation = BABYLON.MathBlockOperations.${er[this.operation]};
`}serialize(){const e=super.serialize();return e.operation=this.operation,e}_deserialize(e){super._deserialize(e),this.operation=e.operation}}M([pt("Operation",lt.List,"ADVANCED",{notifiers:{rebuild:!0},options:[{label:"Add",value:er.Add},{label:"Subtract",value:er.Subtract},{label:"Multiply",value:er.Multiply},{label:"Divide",value:er.Divide},{label:"Max",value:er.Max},{label:"Min",value:er.Min}]})],hv.prototype,"operation",void 0);ye("BABYLON.MathBlock",hv);class wO extends Ve{constructor(e){super(e),this.registerInput("value",I.AutoDetect),this.registerInput("fromMin",I.Float,!0,0),this.registerInput("fromMax",I.Float,!0,1),this.registerInput("toMin",I.Float,!0,0),this.registerInput("toMax",I.Float,!0,1),this.registerOutput("output",I.BasedOnInput),this._inputs[0].excludedConnectionPointTypes.push(I.Vector2),this._inputs[0].excludedConnectionPointTypes.push(I.Vector3),this._inputs[0].excludedConnectionPointTypes.push(I.Vector4),this._inputs[0].excludedConnectionPointTypes.push(I.Matrix),this._inputs[0].excludedConnectionPointTypes.push(I.Geometry),this._inputs[0].excludedConnectionPointTypes.push(I.Texture),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"MapRangeBlock"}get value(){return this._inputs[0]}get fromMin(){return this._inputs[1]}get fromMax(){return this._inputs[2]}get toMin(){return this._inputs[3]}get toMax(){return this._inputs[4]}get output(){return this._outputs[0]}_buildBlock(){if(!this.value.isConnected){this.output._storedFunction=null,this.output._storedValue=null;return}this.output._storedFunction=e=>{const t=this.value.getConnectedValue(e),i=this.fromMin.getConnectedValue(e),r=this.fromMax.getConnectedValue(e),s=this.toMin.getConnectedValue(e),o=this.toMax.getConnectedValue(e),a=(t-i)/(r-i)*(o-s)+s;return this.output.type===I.Int?Math.floor(a):a}}}ye("BABYLON.MapRangeBlock",wO);var gi;(function(n){n[n.Equal=0]="Equal",n[n.NotEqual=1]="NotEqual",n[n.LessThan=2]="LessThan",n[n.GreaterThan=3]="GreaterThan",n[n.LessOrEqual=4]="LessOrEqual",n[n.GreaterOrEqual=5]="GreaterOrEqual",n[n.Xor=6]="Xor",n[n.Or=7]="Or",n[n.And=8]="And"})(gi||(gi={}));class cv extends Ve{constructor(e){super(e),this.test=gi.Equal,this.registerInput("left",I.Float),this.registerInput("right",I.Float,!0,0),this.registerInput("ifTrue",I.AutoDetect,!0,1),this.registerInput("ifFalse",I.AutoDetect,!0,0),this.registerOutput("output",I.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[2],this._outputs[0]._defaultConnectionPointType=I.Float,this._inputs[0].acceptedConnectionPointTypes.push(I.Int),this._inputs[1].acceptedConnectionPointTypes.push(I.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_buildBlock(){if(!this.left.isConnected){this.output._storedFunction=null,this.output._storedValue=null;return}const e=t=>{const i=this.left.getConnectedValue(t),r=this.right.getConnectedValue(t);let s=!1;switch(this.test){case gi.Equal:s=Ye.WithinEpsilon(i,r,xt);break;case gi.NotEqual:s=i!==r;break;case gi.LessThan:s=i<r;break;case gi.GreaterThan:s=i>r;break;case gi.LessOrEqual:s=i<=r;break;case gi.GreaterOrEqual:s=i>=r;break;case gi.Xor:s=!!i&&!r||!i&&!!r;break;case gi.Or:s=!!i||!!r;break;case gi.And:s=!!i&&!!r;break}return s};this.output._storedFunction=t=>e(t)?this.ifTrue.getConnectedValue(t):this.ifFalse.getConnectedValue(t)}_dumpPropertiesCode(){return super._dumpPropertiesCode()+`${this._codeVariableName}.test = BABYLON.ConditionBlockTests.${gi[this.test]};
`}serialize(){const e=super.serialize();return e.test=this.test,e}_deserialize(e){super._deserialize(e),this.test=e.test}}M([pt("Test",lt.List,"ADVANCED",{notifiers:{rebuild:!0},options:[{label:"Equal",value:gi.Equal},{label:"NotEqual",value:gi.NotEqual},{label:"LessThan",value:gi.LessThan},{label:"GreaterThan",value:gi.GreaterThan},{label:"LessOrEqual",value:gi.LessOrEqual},{label:"GreaterOrEqual",value:gi.GreaterOrEqual},{label:"Xor",value:gi.Xor},{label:"Or",value:gi.Or},{label:"And",value:gi.And}]})],cv.prototype,"test",void 0);ye("BABYLON.ConditionBlock",cv);var jr;(function(n){n[n.None=0]="None",n[n.LoopID=1]="LoopID",n[n.InstanceID=2]="InstanceID"})(jr||(jr={}));class uv extends Ve{constructor(e){super(e),this._currentLockId=-1,this.lockMode=jr.None,this.registerInput("min",I.AutoDetect),this.registerInput("max",I.AutoDetect),this.registerOutput("output",I.BasedOnInput),this._inputs[0].excludedConnectionPointTypes.push(I.Matrix),this._inputs[0].excludedConnectionPointTypes.push(I.Geometry),this._inputs[0].excludedConnectionPointTypes.push(I.Texture),this._inputs[1].excludedConnectionPointTypes.push(I.Matrix),this._inputs[1].excludedConnectionPointTypes.push(I.Geometry),this._inputs[1].excludedConnectionPointTypes.push(I.Texture),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1)}getClassName(){return"RandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}autoConfigure(){if(!this.min.isConnected){const e=new oi("Min");e.value=0,e.output.connectTo(this.min)}if(!this.max.isConnected){const e=new oi("Max");e.value=1,e.output.connectTo(this.max)}}_buildBlock(){let e=null;switch(this._currentLockId=-1,this.min.type){case I.Int:case I.Float:{e=t=>{const i=this.min.getConnectedValue(t)||0,r=this.max.getConnectedValue(t)||0;return i+Math.random()*(r-i)};break}case I.Vector2:{e=t=>{const i=this.min.getConnectedValue(t)||me.Zero(),r=this.max.getConnectedValue(t)||me.Zero();return new me(i.x+Math.random()*(r.x-i.x),i.y+Math.random()*(r.y-i.y))};break}case I.Vector3:{e=t=>{const i=this.min.getConnectedValue(t)||v.Zero(),r=this.max.getConnectedValue(t)||v.Zero();return new v(i.x+Math.random()*(r.x-i.x),i.y+Math.random()*(r.y-i.y),i.z+Math.random()*(r.z-i.z))};break}case I.Vector4:{e=t=>{const i=this.min.getConnectedValue(t)||Ke.Zero(),r=this.max.getConnectedValue(t)||Ke.Zero();return new Ke(i.x+Math.random()*(r.x-i.x),i.y+Math.random()*(r.y-i.y),i.z+Math.random()*(r.z-i.z),i.w+Math.random()*(r.w-i.w))};break}}this.lockMode===jr.None||!e?this.output._storedFunction=e:this.output._storedFunction=t=>{let i=0;switch(this.lockMode){case jr.InstanceID:i=t.getContextualValue(at.InstanceID,!0)||0;break;case jr.LoopID:i=t.getContextualValue(at.LoopID,!0)||0;break}return(this._currentLockId!==i||this.lockMode===jr.None)&&(this._currentLockId=i,this.output._storedValue=e(t)),this.output._storedValue}}_dumpPropertiesCode(){return super._dumpPropertiesCode()+`${this._codeVariableName}.lockMode = BABYLON.RandomBlockLocks.${jr[this.lockMode]};
`}serialize(){const e=super.serialize();return e.lockMode=this.lockMode,e}_deserialize(e){super._deserialize(e),this.lockMode=e.lockMode}}M([pt("LockMode",lt.List,"ADVANCED",{notifiers:{rebuild:!0},options:[{label:"None",value:jr.None},{label:"LoopID",value:jr.LoopID},{label:"InstanceID",value:jr.InstanceID}]})],uv.prototype,"lockMode",void 0);ye("BABYLON.RandomBlock",uv);class UO extends Ve{constructor(e){super(e),this.registerInput("offset",I.Vector3,!0,v.Zero()),this.registerInput("scale",I.Float,!0,1),this.registerInput("octaves",I.Float,!0,2,0,16),this.registerInput("roughness",I.Float,!0,.5,0,1),this.registerOutput("output",I.Float)}getClassName(){return"NoiseBlock"}get offset(){return this._inputs[0]}get scale(){return this._inputs[1]}get octaves(){return this._inputs[2]}get roughness(){return this._inputs[3]}get output(){return this._outputs[0]}_negateIf(e,t){return t!==0?-e:e}_noiseGrad(e,t,i,r){const s=e&15,o=s<8?t:i,a=s===12||s==14?t:r,l=s<4?i:a;return this._negateIf(o,s&o)+this._negateIf(l,s&2)}_fade(e){return e*e*e*(e*(e*6-15)+10)}_hashBitRotate(e,t){return e<<t|e>>32-t}_hash(e,t,i){let r,s,o;return r=s=o=3735928584,o+=i,s+=t,r+=e,o^=s,o-=this._hashBitRotate(s,14),r^=o,r-=this._hashBitRotate(o,11),s^=r,s-=this._hashBitRotate(r,25),o^=s,o-=this._hashBitRotate(s,16),r^=o,r-=this._hashBitRotate(o,4),s^=r,s-=this._hashBitRotate(r,14),o^=s,o-=this._hashBitRotate(s,24),o}_mix(e,t,i,r,s,o,a,l,h,c,u){const d=1-h,f=1-c;return(1-u)*(f*(e*d+t*h)+c*(i*d+r*h))+u*(f*(s*d+o*h)+c*(a*d+l*h))}_perlinNoise(e){const t=(e.x|0)-(e.x<0?1:0),i=(e.y|0)-(e.y<0?1:0),r=(e.z|0)-(e.z<0?1:0),s=e.x-t,o=e.y-i,a=e.z-r,l=this._fade(s),h=this._fade(o),c=this._fade(a);return this._mix(this._noiseGrad(this._hash(t,i,r),s,o,a),this._noiseGrad(this._hash(t+1,i,r),s-1,o,a),this._noiseGrad(this._hash(t,i+1,r),s,o-1,a),this._noiseGrad(this._hash(t+1,i+1,r),s-1,o-1,a),this._noiseGrad(this._hash(t,i,r+1),s,o,a-1),this._noiseGrad(this._hash(t+1,i,r+1),s-1,o,a-1),this._noiseGrad(this._hash(t,i+1,r+1),s,o-1,a-1),this._noiseGrad(this._hash(t+1,i+1,r+1),s-1,o-1,a-1),l,h,c)}_perlinSigned(e){return this._perlinNoise(e)*.982}_perlin(e){return this._perlinSigned(e)/2+.5}noise(e,t,i,r,s){const o=new v(i.x*s+r.x,i.y*s+r.y,i.z*s+r.z);let a=1,l=1,h=0,c=0;e=Ye.Clamp(e,0,15);const u=e|0;for(let g=0;g<=u;g++){const m=this._perlin(o.scale(a));c+=m*l,h+=l,l*=Ye.Clamp(t,0,1),a*=2}const d=e-Math.floor(e);if(d==0)return c/h;const f=this._perlin(o.scale(a));let p=c+f*l;return c/=h,p/=h+l,(1-d)*c+d*p}_buildBlock(){this.output._storedFunction=e=>{const t=e.getContextualValue(at.Positions),i=this.octaves.getConnectedValue(e),r=this.roughness.getConnectedValue(e),s=this.offset.getConnectedValue(e),o=this.scale.getConnectedValue(e);return this.noise(i,r,t,s,o)}}}ye("BABYLON.NoiseBlock",UO);class dv extends Ve{constructor(e){super(e),this.evaluateContext=!1,this.registerInput("geometry0",I.Geometry),this.registerInput("geometry1",I.Geometry,!0),this.registerInput("geometry2",I.Geometry,!0),this.registerInput("geometry3",I.Geometry,!0),this.registerInput("geometry4",I.Geometry,!0),this.registerOutput("output",I.Geometry)}getClassName(){return"MergeGeometryBlock"}get geometry0(){return this._inputs[0]}get geometry1(){return this._inputs[1]}get geometry2(){return this._inputs[2]}get geometry3(){return this._inputs[3]}get geometry4(){return this._inputs[4]}get output(){return this._outputs[0]}_buildBlock(e){const t=i=>{let r=this.geometry0.getConnectedValue(i);const s=[];if(r)r=r.clone();else return null;if(this.geometry1.isConnected){const o=this.geometry1.getConnectedValue(i);o&&s.push(o)}if(this.geometry2.isConnected){const o=this.geometry2.getConnectedValue(i);o&&s.push(o)}if(this.geometry3.isConnected){const o=this.geometry3.getConnectedValue(i);o&&s.push(o)}if(this.geometry4.isConnected){const o=this.geometry4.getConnectedValue(i);o&&s.push(o)}return s.length&&r&&(r=r.merge(s,!0,!1,!0,!0)),r};this.evaluateContext?this.output._storedFunction=t:(this.output._storedFunction=null,this.output._storedValue=t(e))}_dumpPropertiesCode(){return super._dumpPropertiesCode()+`${this._codeVariableName}.evaluateContext = ${this.evaluateContext?"true":"false"};
`}serialize(){const e=super.serialize();return e.evaluateContext=this.evaluateContext,e}_deserialize(e){super._deserialize(e),this.evaluateContext=e.evaluateContext}}M([pt("Evaluate context",lt.Boolean,"ADVANCED",{notifiers:{rebuild:!0}})],dv.prototype,"evaluateContext",void 0);ye("BABYLON.MergeGeometryBlock",dv);class fv extends Ve{constructor(e){super(e),this.evaluateContext=!0,this.registerInput("geometry0",I.Geometry,!0),this.registerInput("geometry1",I.Geometry,!0),this.registerInput("geometry2",I.Geometry,!0),this.registerInput("geometry3",I.Geometry,!0),this.registerInput("geometry4",I.Geometry,!0),this.registerInput("geometry5",I.Geometry,!0),this.registerInput("geometry6",I.Geometry,!0),this.registerInput("geometry7",I.Geometry,!0),this.registerInput("geometry8",I.Geometry,!0),this.registerInput("geometry9",I.Geometry,!0),this.registerOutput("output",I.Geometry),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1)}getClassName(){return"GeometryCollectionBlock"}get geometry0(){return this._inputs[0]}get geometry1(){return this._inputs[1]}get geometry2(){return this._inputs[2]}get geometry3(){return this._inputs[3]}get geometry4(){return this._inputs[4]}get geometry5(){return this._inputs[5]}get geometry6(){return this._inputs[6]}get geometry7(){return this._inputs[7]}get geometry8(){return this._inputs[8]}get geometry9(){return this._inputs[9]}get output(){return this._outputs[0]}_storeGeometry(e,t,i,r){if(e.isConnected){const s=e.getConnectedValue(t);if(!s)return;s.metadata=s.metadata||{},s.metadata.collectionId=i,r.push(s)}}_buildBlock(e){const t=i=>{const r=[];return this._storeGeometry(this.geometry0,i,0,r),this._storeGeometry(this.geometry1,i,1,r),this._storeGeometry(this.geometry2,i,2,r),this._storeGeometry(this.geometry3,i,3,r),this._storeGeometry(this.geometry4,i,4,r),this._storeGeometry(this.geometry5,i,5,r),this._storeGeometry(this.geometry6,i,6,r),this._storeGeometry(this.geometry7,i,7,r),this._storeGeometry(this.geometry8,i,8,r),this._storeGeometry(this.geometry9,i,9,r),r.length?r[Math.round(Math.random()*(r.length-1))]:null};this.evaluateContext?this.output._storedFunction=t:(this.output._storedFunction=null,this.output._storedValue=t(e))}_dumpPropertiesCode(){return super._dumpPropertiesCode()+`${this._codeVariableName}.evaluateContext = ${this.evaluateContext?"true":"false"};
`}serialize(){const e=super.serialize();return e.evaluateContext=this.evaluateContext,e}_deserialize(e){super._deserialize(e),this.evaluateContext=e.evaluateContext}}M([pt("Evaluate context",lt.Boolean,"ADVANCED",{notifiers:{rebuild:!0}})],fv.prototype,"evaluateContext",void 0);ye("BABYLON.GeometryCollectionBlock",fv);class VO extends Ve{constructor(e){super(e),this.registerInput("input",I.AutoDetect),this.registerOutput("output",I.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}get buildExecutionTime(){return 0}getClassName(){return"GeometryElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_buildBlock(e){super._buildBlock(e);const t=this._outputs[0],i=this._inputs[0];t._storedFunction=r=>i.getConnectedValue(r)}}ye("BABYLON.GeometryElbowBlock",VO);class BO extends Ve{constructor(e){super(e),this.registerInput("geometry",I.Geometry),this.registerOutput("output",I.Geometry)}getClassName(){return"ComputeNormalsBlock"}get geometry(){return this._inputs[0]}get output(){return this._outputs[0]}_buildBlock(){this.output._storedFunction=e=>{if(!this.geometry.isConnected)return null;const t=this.geometry.getConnectedValue(e);return t.normals||(t.normals=[]),re.ComputeNormals(t.positions,t.indices,t.normals),t}}}ye("BABYLON.ComputeNormalsBlock",BO);class kO extends Ve{constructor(e){super(e),this.registerInput("xyzw ",I.Vector4,!0),this.registerInput("xyz ",I.Vector3,!0),this.registerInput("xy ",I.Vector2,!0),this.registerInput("zw ",I.Vector2,!0),this.registerInput("x ",I.Float,!0),this.registerInput("y ",I.Float,!0),this.registerInput("z ",I.Float,!0),this.registerInput("w ",I.Float,!0),this.registerOutput("xyzw",I.Vector4),this.registerOutput("xyz",I.Vector3),this.registerOutput("xy",I.Vector2),this.registerOutput("zw",I.Vector2),this.registerOutput("x",I.Float),this.registerOutput("y",I.Float),this.registerOutput("z",I.Float),this.registerOutput("w",I.Float)}getClassName(){return"VectorConverterBlock"}get xyzwIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get xyzwOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(e){return e==="xyzw "?"xyzwIn":e==="xyz "?"xyzIn":e==="xy "?"xyIn":e==="zw "?"zwIn":e==="x "?"xIn":e==="y "?"yIn":e==="z "?"zIn":e==="w "?"wIn":e}_outputRename(e){switch(e){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"xyzw":return"xyzwOut";default:return e}}_buildBlock(e){super._buildBlock(e);const t=this.xIn,i=this.yIn,r=this.zIn,s=this.wIn,o=this.xyIn,a=this.zwIn,l=this.xyzIn,h=this.xyzwIn,c=this.xyzwOut,u=this.xyzOut,d=this.xyOut,f=this.zwOut,p=this.xOut,g=this.yOut,m=this.zOut,x=this.wOut,E=R=>{if(h.isConnected)return h.getConnectedValue(R);let C=0,_=0,T=0,y=0;if(t.isConnected&&(C=t.getConnectedValue(R)),i.isConnected&&(_=i.getConnectedValue(R)),r.isConnected&&(T=r.getConnectedValue(R)),s.isConnected&&(y=s.getConnectedValue(R)),o.isConnected){const P=o.getConnectedValue(R);P&&(C=P.x,_=P.y)}if(a.isConnected){const P=a.getConnectedValue(R);P&&(T=P.x,y=P.y)}if(l.isConnected){const P=l.getConnectedValue(R);P&&(C=P.x,_=P.y,T=P.z)}return new Ke(C,_,T,y)};c._storedFunction=R=>E(R),u._storedFunction=R=>{const C=E(R);return new v(C.x,C.y,C.z)},d._storedFunction=R=>{const C=E(R);return new me(C.x,C.y)},f._storedFunction=R=>{const C=E(R);return new me(C.z,C.w)},p._storedFunction=R=>E(R).x,g._storedFunction=R=>E(R).y,m._storedFunction=R=>E(R).z,x._storedFunction=R=>E(R).w}}ye("BABYLON.VectorConverterBlock",kO);class zO extends Ve{constructor(e){super(e),this.registerInput("input",I.AutoDetect),this.registerOutput("output",I.BasedOnInput),this._inputs[0].excludedConnectionPointTypes.push(I.Float),this._inputs[0].excludedConnectionPointTypes.push(I.Matrix),this._inputs[0].excludedConnectionPointTypes.push(I.Geometry),this._inputs[0].excludedConnectionPointTypes.push(I.Texture),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"NormalizeVectorBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_buildBlock(e){if(super._buildBlock(e),this.output._storedFunction=null,!this.input.isConnected){this.output._storedValue=null;return}this.output._storedFunction=t=>this.input.getConnectedValue(t).normalize()}}ye("BABYLON.NormalizeVectorBlock",zO);class pv extends Ve{constructor(e){super(e),this.evaluateContext=!0,this.registerInput("geometry",I.Geometry),this.registerInput("id",I.Int,!0,0),this.registerOutput("output",I.Geometry),this.id.acceptedConnectionPointTypes.push(I.Float)}getClassName(){return"SetMaterialIDBlock"}get geometry(){return this._inputs[0]}get id(){return this._inputs[1]}get output(){return this._outputs[0]}_buildBlock(e){if(!this.geometry.isConnected){this.output._storedFunction=null,this.output._storedValue=null;return}const t=i=>{const r=this.geometry.getConnectedValue(i);if(!r||!r.indices||!r.positions)return r;const s=new Ql;return s.materialIndex=this.id.getConnectedValue(i)|0,s.indexStart=0,s.indexCount=r.indices.length,s.verticesStart=0,s.verticesCount=r.positions.length/3,r.materialInfos=[s],r};this.evaluateContext?this.output._storedFunction=t:(this.output._storedFunction=null,this.output._storedValue=t(e))}_dumpPropertiesCode(){return super._dumpPropertiesCode()+`${this._codeVariableName}.evaluateContext = ${this.evaluateContext?"true":"false"};
`}serialize(){const e=super.serialize();return e.evaluateContext=this.evaluateContext,e}_deserialize(e){super._deserialize(e),e.evaluateContext!==void 0&&(this.evaluateContext=e.evaluateContext)}}M([pt("Evaluate context",lt.Boolean,"ADVANCED",{notifiers:{rebuild:!0}})],pv.prototype,"evaluateContext",void 0);ye("BABYLON.SetMaterialIDBlock",pv);var tt;(function(n){n[n.Cos=0]="Cos",n[n.Sin=1]="Sin",n[n.Abs=2]="Abs",n[n.Exp=3]="Exp",n[n.Round=4]="Round",n[n.Floor=5]="Floor",n[n.Ceiling=6]="Ceiling",n[n.Sqrt=7]="Sqrt",n[n.Log=8]="Log",n[n.Tan=9]="Tan",n[n.ArcTan=10]="ArcTan",n[n.ArcCos=11]="ArcCos",n[n.ArcSin=12]="ArcSin",n[n.Sign=13]="Sign",n[n.Negate=14]="Negate",n[n.OneMinus=15]="OneMinus",n[n.Reciprocal=16]="Reciprocal",n[n.ToDegrees=17]="ToDegrees",n[n.ToRadians=18]="ToRadians",n[n.Fract=19]="Fract",n[n.Exp2=20]="Exp2"})(tt||(tt={}));class gv extends Ve{constructor(e){super(e),this.operation=tt.Cos,this.registerInput("input",I.AutoDetect),this.registerOutput("output",I.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(I.Matrix),this._inputs[0].excludedConnectionPointTypes.push(I.Geometry),this._inputs[0].excludedConnectionPointTypes.push(I.Texture)}getClassName(){return"GeometryTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_buildBlock(e){super._buildBlock(e);let t=null;switch(this.operation){case tt.Cos:{t=i=>Math.cos(i);break}case tt.Sin:{t=i=>Math.sin(i);break}case tt.Abs:{t=i=>Math.abs(i);break}case tt.Exp:{t=i=>Math.exp(i);break}case tt.Exp2:{t=i=>Math.pow(2,i);break}case tt.Round:{t=i=>Math.round(i);break}case tt.Floor:{t=i=>Math.floor(i);break}case tt.Ceiling:{t=i=>Math.ceil(i);break}case tt.Sqrt:{t=i=>Math.sqrt(i);break}case tt.Log:{t=i=>Math.log(i);break}case tt.Tan:{t=i=>Math.tan(i);break}case tt.ArcTan:{t=i=>Math.atan(i);break}case tt.ArcCos:{t=i=>Math.acos(i);break}case tt.ArcSin:{t=i=>Math.asin(i);break}case tt.Sign:{t=i=>Math.sign(i);break}case tt.Negate:{t=i=>-i;break}case tt.OneMinus:{t=i=>1-i;break}case tt.Reciprocal:{t=i=>1/i;break}case tt.ToRadians:{t=i=>i*Math.PI/180;break}case tt.ToDegrees:{t=i=>i*180/Math.PI;break}case tt.Fract:{t=i=>i>=0?i-Math.floor(i):i-Math.ceil(i);break}}if(!t){this.output._storedFunction=null,this.output._storedValue=null;return}switch(this.input.type){case I.Int:case I.Float:{this.output._storedFunction=i=>{const r=this.input.getConnectedValue(i);return t(r)};break}case I.Vector2:{this.output._storedFunction=i=>{const r=this.input.getConnectedValue(i);return new me(t(r.x),t(r.y))};break}case I.Vector3:{this.output._storedFunction=i=>{const r=this.input.getConnectedValue(i);return new v(t(r.x),t(r.y),t(r.z))};break}case I.Vector4:{this.output._storedFunction=i=>{const r=this.input.getConnectedValue(i);return new Ke(t(r.x),t(r.y),t(r.z),t(r.w))};break}}return this}serialize(){const e=super.serialize();return e.operation=this.operation,e}_deserialize(e){super._deserialize(e),this.operation=e.operation}_dumpPropertiesCode(){return super._dumpPropertiesCode()+`${this._codeVariableName}.operation = BABYLON.GeometryTrigonometryBlockOperations.${tt[this.operation]};
`}}M([pt("Operation",lt.List,"ADVANCED",{notifiers:{rebuild:!0},options:[{label:"Cos",value:tt.Cos},{label:"Sin",value:tt.Sin},{label:"Abs",value:tt.Abs},{label:"Exp",value:tt.Exp},{label:"Exp2",value:tt.Exp2},{label:"Round",value:tt.Round},{label:"Floor",value:tt.Floor},{label:"Ceiling",value:tt.Ceiling},{label:"Sqrt",value:tt.Sqrt},{label:"Log",value:tt.Log},{label:"Tan",value:tt.Tan},{label:"ArcTan",value:tt.ArcTan},{label:"ArcCos",value:tt.ArcCos},{label:"ArcSin",value:tt.ArcSin},{label:"Sign",value:tt.Sign},{label:"Negate",value:tt.Negate},{label:"OneMinus",value:tt.OneMinus},{label:"Reciprocal",value:tt.Reciprocal},{label:"ToDegrees",value:tt.ToDegrees},{label:"ToRadians",value:tt.ToRadians},{label:"Fract",value:tt.Fract}]})],gv.prototype,"operation",void 0);ye("BABYLON.GeometryTrigonometryBlock",gv);class mv extends Ve{constructor(e){super(e),this._rotationMatrix=new U,this._scalingMatrix=new U,this._translationMatrix=new U,this._scalingRotationMatrix=new U,this._transformMatrix=new U,this.evaluateContext=!0,this.registerInput("value",I.AutoDetect),this.registerInput("matrix",I.Matrix,!0),this.registerInput("translation",I.Vector3,!0,v.Zero()),this.registerInput("rotation",I.Vector3,!0,v.Zero()),this.registerInput("scaling",I.Vector3,!0,v.One()),this.registerOutput("output",I.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(I.Float),this._inputs[0].excludedConnectionPointTypes.push(I.Matrix),this._inputs[0].excludedConnectionPointTypes.push(I.Texture)}getClassName(){return"GeometryTransformBlock"}get value(){return this._inputs[0]}get matrix(){return this._inputs[1]}get translation(){return this._inputs[2]}get rotation(){return this._inputs[3]}get scaling(){return this._inputs[4]}get output(){return this._outputs[0]}_buildBlock(e){if(!this.value.isConnected){this.output._storedFunction=null,this.output._storedValue=null;return}const t=i=>{const r=this.value.getConnectedValue(i);if(!r)return null;let s;if(this.matrix.isConnected)s=this.matrix.getConnectedValue(i);else{const o=this.scaling.getConnectedValue(i),a=this.rotation.getConnectedValue(i),l=this.translation.getConnectedValue(i);U.ScalingToRef(o.x,o.y,o.z,this._scalingMatrix),U.RotationYawPitchRollToRef(a.y,a.x,a.z,this._rotationMatrix),U.TranslationToRef(l.x,l.y,l.z,this._translationMatrix),this._scalingMatrix.multiplyToRef(this._rotationMatrix,this._scalingRotationMatrix),this._scalingRotationMatrix.multiplyToRef(this._translationMatrix,this._transformMatrix),s=this._transformMatrix}switch(this.value.type){case I.Geometry:{const o=r.clone();return o.transform(s),o}case I.Vector2:return me.Transform(r,s);case I.Vector3:return v.TransformCoordinates(r,s);case I.Vector4:return Ke.TransformCoordinates(r,s)}return null};this.evaluateContext?this.output._storedFunction=t:(this.output._storedFunction=null,this.output._storedValue=t(e))}_dumpPropertiesCode(){return super._dumpPropertiesCode()+`${this._codeVariableName}.evaluateContext = ${this.evaluateContext?"true":"false"};
`}serialize(){const e=super.serialize();return e.evaluateContext=this.evaluateContext,e}_deserialize(e){super._deserialize(e),e.evaluateContext!==void 0&&(this.evaluateContext=e.evaluateContext)}}M([pt("Evaluate context",lt.Boolean,"ADVANCED",{notifiers:{rebuild:!0}})],mv.prototype,"evaluateContext",void 0);ye("BABYLON.GeometryTransformBlock",mv);class GO extends Ve{constructor(e){super(e),this.registerInput("angle",I.Float,!1,0),this.registerOutput("matrix",I.Matrix)}getClassName(){return"RotationXBlock"}get angle(){return this._inputs[0]}get matrix(){return this._outputs[0]}autoConfigure(){if(!this.angle.isConnected){const e=new oi("Angle");e.value=0,e.output.connectTo(this.angle)}}_buildBlock(e){super._buildBlock(e),this.matrix._storedFunction=t=>U.RotationX(this.angle.getConnectedValue(t))}}ye("BABYLON.RotationXBlock",GO);class WO extends Ve{constructor(e){super(e),this.registerInput("angle",I.Float,!1,0),this.registerOutput("matrix",I.Matrix)}getClassName(){return"RotationYBlock"}get angle(){return this._inputs[0]}get matrix(){return this._outputs[0]}autoConfigure(){if(!this.angle.isConnected){const e=new oi("Angle");e.value=0,e.output.connectTo(this.angle)}}_buildBlock(e){super._buildBlock(e),this.matrix._storedFunction=t=>U.RotationY(this.angle.getConnectedValue(t))}}ye("BABYLON.RotationYBlock",WO);class XO extends Ve{constructor(e){super(e),this.registerInput("angle",I.Float,!1,0),this.registerOutput("matrix",I.Matrix)}getClassName(){return"RotationZBlock"}get angle(){return this._inputs[0]}get matrix(){return this._outputs[0]}autoConfigure(){if(!this.angle.isConnected){const e=new oi("Angle");e.value=0,e.output.connectTo(this.angle)}}_buildBlock(e){super._buildBlock(e),this.matrix._storedFunction=t=>U.RotationZ(this.angle.getConnectedValue(t))}}ye("BABYLON.RotationZBlock",XO);class HO extends Ve{constructor(e){super(e),this.registerInput("scale",I.Vector3,!1,v.One()),this.registerOutput("matrix",I.Matrix)}getClassName(){return"ScalingBlock"}get scale(){return this._inputs[0]}get matrix(){return this._outputs[0]}autoConfigure(){if(!this.scale.isConnected){const e=new oi("Scale");e.value=new v(1,1,1),e.output.connectTo(this.scale)}}_buildBlock(e){super._buildBlock(e),this.matrix._storedFunction=t=>{const i=this.scale.getConnectedValue(t);return U.Scaling(i.x,i.y,i.z)}}}ye("BABYLON.ScalingBlock",HO);class KO extends Ve{constructor(e){super(e),this.registerInput("source",I.Vector3,!0,v.Up()),this.registerInput("target",I.Vector3,!0,v.Left()),this.registerOutput("matrix",I.Matrix)}getClassName(){return"AlignBlock"}get source(){return this._inputs[0]}get target(){return this._inputs[1]}get matrix(){return this._outputs[0]}_buildBlock(e){super._buildBlock(e),this.matrix._storedFunction=t=>{const i=this.source.getConnectedValue(t).clone(),r=this.target.getConnectedValue(t).clone(),s=new U;return i.normalize(),r.normalize(),U.RotationAlignToRef(i,r,s,!0),s}}}ye("BABYLON.AlignBlock",KO);class qO extends Ve{constructor(e){super(e),this.registerInput("translation",I.Vector3,!1,v.Zero()),this.registerOutput("matrix",I.Matrix)}getClassName(){return"TranslationBlock"}get translation(){return this._inputs[0]}get matrix(){return this._outputs[0]}autoConfigure(){if(!this.translation.isConnected){const e=new oi("Translation");e.value=new v(0,0,0),e.output.connectTo(this.translation)}}_buildBlock(e){super._buildBlock(e),this.matrix._storedFunction=t=>{const i=this.translation.getConnectedValue(t);return U.Translation(i.x,i.y,i.z)}}}ye("BABYLON.TranslationBlock",qO);class Bd extends Ve{constructor(e){super(e),this._indexTranslation=null,this.evaluateContext=!0,this.removeDuplicatedPositions=!0,this.registerInput("geometry",I.Geometry),this.registerInput("instance",I.Geometry,!0),this.registerInput("density",I.Float,!0,1,0,1),this.registerInput("matrix",I.Matrix,!0),this.registerInput("rotation",I.Vector3,!0,v.Zero()),this.registerInput("scaling",I.Vector3,!0,v.One()),this.scaling.acceptedConnectionPointTypes.push(I.Float),this.registerOutput("output",I.Geometry)}getInstanceIndex(){return this._currentLoopIndex}getExecutionIndex(){return this._indexTranslation?this._indexTranslation[this._currentIndex]:this._currentIndex}getExecutionLoopIndex(){return this._currentLoopIndex}getExecutionFaceIndex(){return 0}getClassName(){return"InstantiateOnVerticesBlock"}get geometry(){return this._inputs[0]}get instance(){return this._inputs[1]}get density(){return this._inputs[2]}get matrix(){return this._inputs[3]}get rotation(){return this._inputs[4]}get scaling(){return this._inputs[5]}get output(){return this._outputs[0]}_buildBlock(e){const t=i=>{if(i.pushExecutionContext(this),i.pushInstancingContext(this),this._vertexData=this.geometry.getConnectedValue(i),i.pushGeometryContext(this._vertexData),!this._vertexData||!this._vertexData.positions||!this.instance.isConnected){i.restoreExecutionContext(),i.restoreInstancingContext(),i.restoreGeometryContext(),this.output._storedValue=null;return}let r=this._vertexData.positions.length/3;const s=[],o=new v,a=[];let l=this._vertexData.positions;if(this._currentLoopIndex=0,this.removeDuplicatedPositions){for(this._indexTranslation={},this._currentIndex=0;this._currentIndex<r;this._currentIndex++){const h=l[this._currentIndex*3],c=l[this._currentIndex*3+1],u=l[this._currentIndex*3+2];let d=!1;for(let f=0;f<a.length;f+=3)if(Math.abs(a[f]-h)<xt&&Math.abs(a[f+1]-c)<xt&&Math.abs(a[f+2]-u)<xt){d=!0;break}d||(this._indexTranslation[a.length/3]=this._currentIndex,a.push(h,c,u))}l=a,r=l.length/3}else this._indexTranslation=null;for(this._currentIndex=0;this._currentIndex<r;this._currentIndex++){const h=this.instance.getConnectedValue(i);if(!h||!h.positions||h.positions.length===0)continue;const c=this.density.getConnectedValue(i);if(c<1&&Math.random()>c)continue;o.fromArray(l,this._currentIndex*3);const u=h.clone();if(this.matrix.isConnected){const d=this.matrix.getConnectedValue(i);i._instantiateWithPositionAndMatrix(u,o,d,s)}else{const d=i.adaptInput(this.scaling,I.Vector3,v.OneReadOnly),f=this.rotation.getConnectedValue(i)||v.ZeroReadOnly;i._instantiate(u,o,f,d,s)}this._currentLoopIndex++}if(i.restoreGeometryContext(),i.restoreExecutionContext(),i.restoreInstancingContext(),s.length)if(s.length===1)this._vertexData=s[0];else{const h=s.splice(0,1)[0];this._vertexData=h.merge(s,!0,!1,!0,!0)}else return null;return this._vertexData};this.evaluateContext?this.output._storedFunction=t:(this.output._storedFunction=null,this.output._storedValue=t(e))}_dumpPropertiesCode(){let e=super._dumpPropertiesCode()+`${this._codeVariableName}.removeDuplicatedPositions = ${this.removeDuplicatedPositions?"true":"false"};
`;return e+=`${this._codeVariableName}.evaluateContext = ${this.evaluateContext?"true":"false"};
`,e}serialize(){const e=super.serialize();return e.removeDuplicatedPositions=this.removeDuplicatedPositions,e.evaluateContext=this.evaluateContext,e}_deserialize(e){super._deserialize(e),this.removeDuplicatedPositions=e.removeDuplicatedPositions,e.evaluateContext!==void 0&&(this.evaluateContext=e.evaluateContext)}}M([pt("Evaluate context",lt.Boolean,"ADVANCED",{notifiers:{rebuild:!0}})],Bd.prototype,"evaluateContext",void 0);M([pt("Remove duplicated positions",lt.Boolean,"ADVANCED",{notifiers:{update:!0}})],Bd.prototype,"removeDuplicatedPositions",void 0);ye("BABYLON.InstantiateOnVerticesBlock",Bd);class _v extends Ve{constructor(e){super(e),this._currentPosition=new v,this._currentUV=new me,this._vertex0=new v,this._vertex1=new v,this._vertex2=new v,this._tempVector0=new v,this._tempVector1=new v,this._uv0=new me,this._uv1=new me,this._uv2=new me,this.evaluateContext=!0,this.registerInput("geometry",I.Geometry),this.registerInput("instance",I.Geometry,!0),this.registerInput("count",I.Int,!0,256),this.registerInput("matrix",I.Matrix,!0),this.registerInput("rotation",I.Vector3,!0,v.Zero()),this.registerInput("scaling",I.Vector3,!0,v.One()),this.scaling.acceptedConnectionPointTypes.push(I.Float),this.registerOutput("output",I.Geometry)}getInstanceIndex(){return this._currentLoopIndex}getExecutionIndex(){return 0}getExecutionFaceIndex(){return this._currentFaceIndex}getExecutionLoopIndex(){return this._currentLoopIndex}getOverridePositionsContextualValue(){return this._currentPosition}getOverrideNormalsContextualValue(){return this._vertex1.subtractToRef(this._vertex0,this._tempVector0),this._vertex2.subtractToRef(this._vertex1,this._tempVector1),this._tempVector0.normalize(),this._tempVector1.normalize(),v.Cross(this._tempVector1,this._tempVector0)}getOverrideUVs1ContextualValue(){return this._currentUV}getClassName(){return"InstantiateOnFacesBlock"}get geometry(){return this._inputs[0]}get instance(){return this._inputs[1]}get count(){return this._inputs[2]}get matrix(){return this._inputs[3]}get rotation(){return this._inputs[4]}get scaling(){return this._inputs[5]}get output(){return this._outputs[0]}_buildBlock(e){const t=i=>{if(i.pushExecutionContext(this),i.pushInstancingContext(this),this._vertexData=this.geometry.getConnectedValue(i),i.pushGeometryContext(this._vertexData),!this._vertexData||!this._vertexData.positions||!this._vertexData.indices||!this.instance.isConnected){i.restoreExecutionContext(),i.restoreInstancingContext(),i.restoreGeometryContext(),this.output._storedValue=null;return}let r=null;const s=this.count.getConnectedValue(i),o=this._vertexData.indices.length/3,a=s/o;let l=0;const h=[];let c=0;for(this._currentLoopIndex=0,this._currentFaceIndex=0;this._currentFaceIndex<o;this._currentFaceIndex++){l+=a;const u=(l|0)-c;if(u<1)continue;const d=this._vertexData.indices[this._currentFaceIndex*3],f=this._vertexData.indices[this._currentFaceIndex*3+1],p=this._vertexData.indices[this._currentFaceIndex*3+2];this._vertex0.fromArray(this._vertexData.positions,d*3),this._vertex1.fromArray(this._vertexData.positions,f*3),this._vertex2.fromArray(this._vertexData.positions,p*3),this._vertexData.uvs&&(this._uv0.fromArray(this._vertexData.uvs,d*2),this._uv1.fromArray(this._vertexData.uvs,f*2),this._uv2.fromArray(this._vertexData.uvs,p*2));for(let g=0;g<u&&!(c>=s);g++){let m=Math.random(),x=Math.random();if(m>x){const T=m;m=x,x=T}const E=m,R=x-m,C=1-E-R;if(this._currentPosition.set(E*this._vertex0.x+R*this._vertex1.x+C*this._vertex2.x,E*this._vertex0.y+R*this._vertex1.y+C*this._vertex2.y,E*this._vertex0.z+R*this._vertex1.z+C*this._vertex2.z),this._vertexData.uvs&&this._currentUV.set(E*this._uv0.x+R*this._uv1.x+C*this._uv2.x,E*this._uv0.y+R*this._uv1.y+C*this._uv2.y),r=this.instance.getConnectedValue(i),!r||!r.positions||r.positions.length===0){l-=a;continue}const _=r.clone();if(this.matrix.isConnected){const T=this.matrix.getConnectedValue(i);i._instantiateWithPositionAndMatrix(_,this._currentPosition,T,h)}else{const T=i.adaptInput(this.scaling,I.Vector3,v.OneReadOnly),y=this.rotation.getConnectedValue(i)||v.ZeroReadOnly;i._instantiate(_,this._currentPosition,y,T,h)}c++,this._currentLoopIndex++}}if(h.length)if(h.length===1)this._vertexData=h[0];else{const u=h.splice(0,1)[0];this._vertexData=u.merge(h,!0,!1,!0,!0)}return i.restoreExecutionContext(),i.restoreInstancingContext(),i.restoreGeometryContext(),this._vertexData};this.evaluateContext?this.output._storedFunction=t:(this.output._storedFunction=null,this.output._storedValue=t(e))}_dumpPropertiesCode(){return super._dumpPropertiesCode()+`${this._codeVariableName}.evaluateContext = ${this.evaluateContext?"true":"false"};
`}serialize(){const e=super.serialize();return e.evaluateContext=this.evaluateContext,e}_deserialize(e){super._deserialize(e),e.evaluateContext!==void 0&&(this.evaluateContext=e.evaluateContext)}}M([pt("Evaluate context",lt.Boolean,"ADVANCED",{notifiers:{rebuild:!0}})],_v.prototype,"evaluateContext",void 0);ye("BABYLON.InstantiateOnFacesBlock",_v);class ot{constructor(e,t,i=Number.MAX_VALUE,r=xt){this.origin=e,this.direction=t,this.length=i,this.epsilon=r}clone(){return new ot(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(e,t,i=0){const r=ot._TmpVector3[0].copyFromFloats(e.x-i,e.y-i,e.z-i),s=ot._TmpVector3[1].copyFromFloats(t.x+i,t.y+i,t.z+i);let o=0,a=Number.MAX_VALUE,l,h,c,u;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<r.x||this.origin.x>s.x)return!1}else if(l=1/this.direction.x,h=(r.x-this.origin.x)*l,c=(s.x-this.origin.x)*l,c===-1/0&&(c=1/0),h>c&&(u=h,h=c,c=u),o=Math.max(h,o),a=Math.min(c,a),o>a)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<r.y||this.origin.y>s.y)return!1}else if(l=1/this.direction.y,h=(r.y-this.origin.y)*l,c=(s.y-this.origin.y)*l,c===-1/0&&(c=1/0),h>c&&(u=h,h=c,c=u),o=Math.max(h,o),a=Math.min(c,a),o>a)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<r.z||this.origin.z>s.z)return!1}else if(l=1/this.direction.z,h=(r.z-this.origin.z)*l,c=(s.z-this.origin.z)*l,c===-1/0&&(c=1/0),h>c&&(u=h,h=c,c=u),o=Math.max(h,o),a=Math.min(c,a),o>a)return!1;return!0}intersectsBox(e,t=0){return this.intersectsBoxMinMax(e.minimum,e.maximum,t)}intersectsSphere(e,t=0){const i=e.center.x-this.origin.x,r=e.center.y-this.origin.y,s=e.center.z-this.origin.z,o=i*i+r*r+s*s,a=e.radius+t,l=a*a;if(o<=l)return!0;const h=i*this.direction.x+r*this.direction.y+s*this.direction.z;return h<0?!1:o-h*h<=l}intersectsTriangle(e,t,i){const r=ot._TmpVector3[0],s=ot._TmpVector3[1],o=ot._TmpVector3[2],a=ot._TmpVector3[3],l=ot._TmpVector3[4];t.subtractToRef(e,r),i.subtractToRef(e,s),v.CrossToRef(this.direction,s,o);const h=v.Dot(r,o);if(h===0)return null;const c=1/h;this.origin.subtractToRef(e,a);const u=v.Dot(a,o)*c;if(u<-this.epsilon||u>1+this.epsilon)return null;v.CrossToRef(a,r,l);const d=v.Dot(this.direction,l)*c;if(d<-this.epsilon||u+d>1+this.epsilon)return null;const f=v.Dot(s,l)*c;return f>this.length?null:new Pu(1-u-d,u,f)}intersectsPlane(e){let t;const i=v.Dot(e.normal,this.direction);if(Math.abs(i)<999999997475243e-21)return null;{const r=v.Dot(e.normal,this.origin);return t=(-e.d-r)/i,t<0?t<-999999997475243e-21?null:0:t}}intersectsAxis(e,t=0){switch(e){case"y":{const i=(this.origin.y-t)/this.direction.y;return i>0?null:new v(this.origin.x+this.direction.x*-i,t,this.origin.z+this.direction.z*-i)}case"x":{const i=(this.origin.x-t)/this.direction.x;return i>0?null:new v(t,this.origin.y+this.direction.y*-i,this.origin.z+this.direction.z*-i)}case"z":{const i=(this.origin.z-t)/this.direction.z;return i>0?null:new v(this.origin.x+this.direction.x*-i,this.origin.y+this.direction.y*-i,t)}default:return null}}intersectsMesh(e,t,i,r=!1,s,o=!1){const a=W.Matrix[0];return e.getWorldMatrix().invertToRef(a),this._tmpRay?ot.TransformToRef(this,a,this._tmpRay):this._tmpRay=ot.Transform(this,a),e.intersects(this._tmpRay,t,i,r,s,o)}intersectsMeshes(e,t,i){i?i.length=0:i=[];for(let r=0;r<e.length;r++){const s=this.intersectsMesh(e[r],t);s.hit&&i.push(s)}return i.sort(this._comparePickingInfo),i}_comparePickingInfo(e,t){return e.distance<t.distance?-1:e.distance>t.distance?1:0}intersectionSegment(e,t,i){const r=this.origin,s=W.Vector3[0],o=W.Vector3[1],a=W.Vector3[2],l=W.Vector3[3];t.subtractToRef(e,s),this.direction.scaleToRef(ot._Rayl,a),r.addToRef(a,o),e.subtractToRef(r,l);const h=v.Dot(s,s),c=v.Dot(s,a),u=v.Dot(a,a),d=v.Dot(s,l),f=v.Dot(a,l),p=h*u-c*c;let g,m=p,x,E=p;p<ot._Smallnum?(g=0,m=1,x=f,E=u):(g=c*f-u*d,x=h*f-c*d,g<0?(g=0,x=f,E=u):g>m&&(g=m,x=f+c,E=u)),x<0?(x=0,-d<0?g=0:-d>h?g=m:(g=-d,m=h)):x>E&&(x=E,-d+c<0?g=0:-d+c>h?g=m:(g=-d+c,m=h));const R=Math.abs(g)<ot._Smallnum?0:g/m,C=Math.abs(x)<ot._Smallnum?0:x/E,_=W.Vector3[4];a.scaleToRef(C,_);const T=W.Vector3[5];s.scaleToRef(R,T),T.addInPlace(l);const y=W.Vector3[6];return T.subtractToRef(_,y),C>0&&C<=this.length&&y.lengthSquared()<i*i?T.length():-1}update(e,t,i,r,s,o,a,l=!1){if(l){ot._RayDistant||(ot._RayDistant=ot.Zero()),ot._RayDistant.unprojectRayToRef(e,t,i,r,U.IdentityReadOnly,o,a);const h=W.Matrix[0];s.invertToRef(h),ot.TransformToRef(ot._RayDistant,h,this)}else this.unprojectRayToRef(e,t,i,r,s,o,a);return this}static Zero(){return new ot(v.Zero(),v.Zero())}static CreateNew(e,t,i,r,s,o,a){return ot.Zero().update(e,t,i,r,s,o,a)}static CreateNewFromTo(e,t,i=U.IdentityReadOnly){const r=new ot(new v(0,0,0),new v(0,0,0));return ot.CreateFromToToRef(e,t,r,i)}static CreateFromToToRef(e,t,i,r=U.IdentityReadOnly){i.origin.copyFrom(e);const s=t.subtractToRef(e,i.direction),o=Math.sqrt(s.x*s.x+s.y*s.y+s.z*s.z);return i.length=o,i.direction.normalize(),ot.TransformToRef(i,r,i)}static Transform(e,t){const i=new ot(new v(0,0,0),new v(0,0,0));return ot.TransformToRef(e,t,i),i}static TransformToRef(e,t,i){v.TransformCoordinatesToRef(e.origin,t,i.origin),v.TransformNormalToRef(e.direction,t,i.direction),i.length=e.length,i.epsilon=e.epsilon;const r=i.direction,s=r.length();if(!(s===0||s===1)){const o=1/s;r.x*=o,r.y*=o,r.z*=o,i.length*=s}return i}unprojectRayToRef(e,t,i,r,s,o,a){const l=W.Matrix[0];s.multiplyToRef(o,l),l.multiplyToRef(a,l),l.invert();const h=rt.LastCreatedEngine,c=W.Vector3[0];c.x=e/i*2-1,c.y=-(t/r*2-1),c.z=h!=null&&h.useReverseDepthBuffer?1:h!=null&&h.isNDCHalfZRange?0:-1;const u=W.Vector3[1].copyFromFloats(c.x,c.y,1-1e-8),d=W.Vector3[2],f=W.Vector3[3];v._UnprojectFromInvertedMatrixToRef(c,l,d),v._UnprojectFromInvertedMatrixToRef(u,l,f),this.origin.copyFrom(d),f.subtractToRef(d,this.direction),this.direction.normalize()}}ot._TmpVector3=Ci.BuildArray(6,v.Zero);ot._RayDistant=ot.Zero();ot._Smallnum=1e-8;ot._Rayl=1e9;Pt.prototype.createPickingRay=function(n,e,t,i,r=!1){const s=ot.Zero();return this.createPickingRayToRef(n,e,t,s,i,r),s};Pt.prototype.createPickingRayToRef=function(n,e,t,i,r,s=!1,o=!1){const a=this.getEngine();if(!r&&!(r=this.activeCamera))return this;const l=r.viewport,h=a.getRenderHeight(),{x:c,y:u,width:d,height:f}=l.toGlobal(a.getRenderWidth(),h),p=1/a.getHardwareScalingLevel();return n=n*p-c,e=e*p-(h-u-f),i.update(n,e,d,f,t||U.IdentityReadOnly,s?U.IdentityReadOnly:r.getViewMatrix(),r.getProjectionMatrix(),o),this};Pt.prototype.createPickingRayInCameraSpace=function(n,e,t){const i=ot.Zero();return this.createPickingRayInCameraSpaceToRef(n,e,i,t),i};Pt.prototype.createPickingRayInCameraSpaceToRef=function(n,e,t,i){if(!Ts)return this;const r=this.getEngine();if(!i&&!(i=this.activeCamera))throw new Error("Active camera not set");const s=i.viewport,o=r.getRenderHeight(),{x:a,y:l,width:h,height:c}=s.toGlobal(r.getRenderWidth(),o),u=U.Identity(),d=1/r.getHardwareScalingLevel();return n=n*d-a,e=e*d-(o-l-c),t.update(n,e,h,c,u,u,i.getProjectionMatrix()),this};Pt.prototype._internalPickForMesh=function(n,e,t,i,r,s,o,a){const l=e(i,t.enableDistantPicking),h=t.intersects(l,r,o,s,i,a);return!h||!h.hit||!r&&n!=null&&h.distance>=n.distance?null:h};Pt.prototype._internalPick=function(n,e,t,i,r){let s=null;const o=!!(this.activeCameras&&this.activeCameras.length>1&&this.cameraToUseForPointers!==this.activeCamera),a=this.cameraToUseForPointers||this.activeCamera;for(let l=0;l<this.meshes.length;l++){const h=this.meshes[l];if(e){if(!e(h))continue}else if(!h.isEnabled()||!h.isVisible||!h.isPickable)continue;const c=o&&h.isWorldMatrixCameraDependent(),u=h.computeWorldMatrix(c,a);if(h.hasThinInstances&&h.thinInstanceEnablePicking){const d=this._internalPickForMesh(s,n,h,u,!0,!0,r);if(d){if(i)return d;const f=W.Matrix[1],p=h.thinInstanceGetWorldMatrices();for(let g=0;g<p.length;g++){p[g].multiplyToRef(u,f);const m=this._internalPickForMesh(s,n,h,f,t,i,r,!0);if(m&&(s=m,s.thinInstanceIndex=g,t))return s}}}else{const d=this._internalPickForMesh(s,n,h,u,t,i,r);if(d&&(s=d,t))return s}}return s||new Ts};Pt.prototype._internalMultiPick=function(n,e,t){if(!Ts)return null;const i=[],r=!!(this.activeCameras&&this.activeCameras.length>1&&this.cameraToUseForPointers!==this.activeCamera),s=this.cameraToUseForPointers||this.activeCamera;for(let o=0;o<this.meshes.length;o++){const a=this.meshes[o];if(e){if(!e(a))continue}else if(!a.isEnabled()||!a.isVisible||!a.isPickable)continue;const l=r&&a.isWorldMatrixCameraDependent(),h=a.computeWorldMatrix(l,s);if(a.hasThinInstances&&a.thinInstanceEnablePicking){if(this._internalPickForMesh(null,n,a,h,!0,!0,t)){const c=W.Matrix[1],u=a.thinInstanceGetWorldMatrices();for(let d=0;d<u.length;d++){u[d].multiplyToRef(h,c);const f=this._internalPickForMesh(null,n,a,c,!1,!1,t,!0);f&&(f.thinInstanceIndex=d,i.push(f))}}}else{const c=this._internalPickForMesh(null,n,a,h,!1,!1,t);c&&i.push(c)}}return i};Pt.prototype.pickWithBoundingInfo=function(n,e,t,i,r){if(!Ts)return null;const s=this._internalPick(o=>(this._tempPickingRay||(this._tempPickingRay=ot.Zero()),this.createPickingRayToRef(n,e,o,this._tempPickingRay,r||null),this._tempPickingRay),t,i,!0);return s&&(s.ray=this.createPickingRay(n,e,U.Identity(),r||null)),s};Object.defineProperty(Pt.prototype,"_pickingAvailable",{get:()=>!0,enumerable:!1,configurable:!1});Pt.prototype.pick=function(n,e,t,i,r,s,o=!1){const a=this._internalPick((l,h)=>(this._tempPickingRay||(this._tempPickingRay=ot.Zero()),this.createPickingRayToRef(n,e,l,this._tempPickingRay,r||null,!1,h),this._tempPickingRay),t,i,!1,s);return a&&(a.ray=this.createPickingRay(n,e,U.Identity(),r||null)),a};Pt.prototype.pickWithRay=function(n,e,t,i){const r=this._internalPick(s=>(this._pickWithRayInverseMatrix||(this._pickWithRayInverseMatrix=U.Identity()),s.invertToRef(this._pickWithRayInverseMatrix),this._cachedRayForTransform||(this._cachedRayForTransform=ot.Zero()),ot.TransformToRef(n,this._pickWithRayInverseMatrix,this._cachedRayForTransform),this._cachedRayForTransform),e,t,!1,i);return r&&(r.ray=n),r};Pt.prototype.multiPick=function(n,e,t,i,r){return this._internalMultiPick(s=>this.createPickingRay(n,e,s,i||null),t,r)};Pt.prototype.multiPickWithRay=function(n,e,t){return this._internalMultiPick(i=>(this._pickWithRayInverseMatrix||(this._pickWithRayInverseMatrix=U.Identity()),i.invertToRef(this._pickWithRayInverseMatrix),this._cachedRayForTransform||(this._cachedRayForTransform=ot.Zero()),ot.TransformToRef(n,this._pickWithRayInverseMatrix,this._cachedRayForTransform),this._cachedRayForTransform),e,t)};Je.prototype.getForwardRay=function(n=100,e,t){return this.getForwardRayToRef(new ot(v.Zero(),v.Zero(),n),n,e,t)};Je.prototype.getForwardRayToRef=function(n,e=100,t,i){t||(t=this.getWorldMatrix()),n.length=e,i?n.origin.copyFrom(i):n.origin.copyFrom(this.position);const r=W.Vector3[2];r.set(0,0,this._scene.useRightHandedSystem?-1:1);const s=W.Vector3[3];return v.TransformNormalToRef(r,t,s),v.NormalizeToRef(s,n.direction),n};class vv extends Ve{constructor(e){super(e),this._currentPosition=new v,this._vertex0=new v,this._vertex1=new v,this._vertex2=new v,this.evaluateContext=!0,this.registerInput("geometry",I.Geometry),this.registerInput("instance",I.Geometry,!0),this.registerInput("count",I.Int,!0,256),this.registerInput("matrix",I.Matrix,!0),this.registerInput("rotation",I.Vector3,!0,v.Zero()),this.registerInput("scaling",I.Vector3,!0,v.One()),this.scaling.acceptedConnectionPointTypes.push(I.Float),this.registerOutput("output",I.Geometry)}getInstanceIndex(){return this._currentLoopIndex}getExecutionIndex(){return 0}getExecutionFaceIndex(){return 0}getExecutionLoopIndex(){return this._currentLoopIndex}getOverridePositionsContextualValue(){return this._currentPosition}getClassName(){return"InstantiateOnVolumeBlock"}get geometry(){return this._inputs[0]}get instance(){return this._inputs[1]}get count(){return this._inputs[2]}get matrix(){return this._inputs[3]}get rotation(){return this._inputs[4]}get scaling(){return this._inputs[5]}get output(){return this._outputs[0]}_buildBlock(e){const t=i=>{if(i.pushExecutionContext(this),i.pushInstancingContext(this),this._vertexData=this.geometry.getConnectedValue(i),i.pushGeometryContext(this._vertexData),!this._vertexData||!this._vertexData.positions||!this._vertexData.indices||!this.instance.isConnected){i.restoreExecutionContext(),i.restoreInstancingContext(),i.restoreGeometryContext(),this.output._storedValue=null;return}let r=null;const s=this.count.getConnectedValue(i),o=[],a=Ra(this._vertexData.positions,0,this._vertexData.positions.length/3),l=a.minimum,h=a.maximum,c=new v(1,0,0),u=this._vertexData.indices.length/3;this._currentLoopIndex=0;for(let d=0;d<s;d++){this._currentPosition.set(Math.random()*(h.x-l.x)+l.x,Math.random()*(h.y-l.y)+l.y,Math.random()*(h.z-l.z)+l.z);const f=new ot(this._currentPosition,c);let p=0;for(let m=0;m<u;m++){this._vertex0.fromArray(this._vertexData.positions,this._vertexData.indices[m*3]*3),this._vertex1.fromArray(this._vertexData.positions,this._vertexData.indices[m*3+1]*3),this._vertex2.fromArray(this._vertexData.positions,this._vertexData.indices[m*3+2]*3);const x=f.intersectsTriangle(this._vertex0,this._vertex1,this._vertex2);x&&x.distance>0&&p++}if(p%2===0){d--;continue}if(r=this.instance.getConnectedValue(i),!r||!r.positions||r.positions.length===0)continue;const g=r.clone();if(this.matrix.isConnected){const m=this.matrix.getConnectedValue(i);i._instantiateWithPositionAndMatrix(g,this._currentPosition,m,o)}else{const m=i.adaptInput(this.scaling,I.Vector3,v.OneReadOnly),x=this.rotation.getConnectedValue(i)||v.ZeroReadOnly;i._instantiate(g,this._currentPosition,x,m,o)}this._currentLoopIndex++}if(o.length)if(o.length===1)this._vertexData=o[0];else{const d=o.splice(0,1)[0];this._vertexData=d.merge(o,!0,!1,!0,!0)}return i.restoreGeometryContext(),i.restoreExecutionContext(),i.restoreInstancingContext(),this._vertexData};this.evaluateContext?this.output._storedFunction=t:(this.output._storedFunction=null,this.output._storedValue=t(e))}_dumpPropertiesCode(){return super._dumpPropertiesCode()+`${this._codeVariableName}.evaluateContext = ${this.evaluateContext?"true":"false"};
`}serialize(){const e=super.serialize();return e.evaluateContext=this.evaluateContext,e}_deserialize(e){super._deserialize(e),e.evaluateContext!==void 0&&(this.evaluateContext=e.evaluateContext)}}M([pt("Evaluate context",lt.Boolean,"ADVANCED",{notifiers:{rebuild:!0}})],vv.prototype,"evaluateContext",void 0);ye("BABYLON.InstantiateOnVolumeBlock",vv);class Zh extends Ve{constructor(e){super(e),this.evaluateContext=!0,this.registerInput("instance",I.Geometry,!0),this.registerInput("count",I.Int,!0,1),this.registerOutput("output",I.Geometry)}getInstanceIndex(){return this._currentIndex}getExecutionIndex(){return this._currentIndex}getExecutionLoopIndex(){return this._currentIndex}getExecutionFaceIndex(){return 0}getClassName(){return"InstantiateBaseBlock"}get instance(){return this._inputs[0]}get count(){return this._inputs[1]}get output(){return this._outputs[0]}_dumpPropertiesCode(){return super._dumpPropertiesCode()+`${this._codeVariableName}.evaluateContext = ${this.evaluateContext?"true":"false"};
`}serialize(){const e=super.serialize();return e.evaluateContext=this.evaluateContext,e}_deserialize(e){super._deserialize(e),e.evaluateContext!==void 0&&(this.evaluateContext=e.evaluateContext)}}M([pt("Evaluate context",lt.Boolean,"ADVANCED",{notifiers:{rebuild:!0}})],Zh.prototype,"evaluateContext",void 0);class YO extends Zh{constructor(e){super(e),this.registerInput("matrix",I.Matrix,!0),this.registerInput("position",I.Vector3,!0,v.Zero()),this.registerInput("rotation",I.Vector3,!0,v.Zero()),this.registerInput("scaling",I.Vector3,!0,v.One()),this.scaling.acceptedConnectionPointTypes.push(I.Float)}getInstanceIndex(){return this._currentIndex}getExecutionIndex(){return this._currentIndex}getExecutionLoopIndex(){return this._currentIndex}getExecutionFaceIndex(){return 0}getClassName(){return"InstantiateBlock"}get matrix(){return this._inputs[2]}get position(){return this._inputs[3]}get rotation(){return this._inputs[4]}get scaling(){return this._inputs[5]}_buildBlock(e){const t=i=>{i.pushExecutionContext(this),i.pushInstancingContext(this);const r=this.count.getConnectedValue(i),s=[];for(this._currentIndex=0;this._currentIndex<r;this._currentIndex++){const o=this.instance.getConnectedValue(i);if(!o||!o.positions||o.positions.length===0)continue;const a=o.clone();if(this.matrix.isConnected){const l=this.matrix.getConnectedValue(i);i._instantiateWithMatrix(a,l,s)}else{const l=this.position.getConnectedValue(i)||v.ZeroReadOnly,h=i.adaptInput(this.scaling,I.Vector3,v.OneReadOnly),c=this.rotation.getConnectedValue(i)||v.ZeroReadOnly;i._instantiate(a,l,c,h,s)}}if(s.length)if(s.length===1)this._vertexData=s[0];else{const o=s.splice(0,1)[0];this._vertexData=o.merge(s,!0,!1,!0,!0)}return i.restoreExecutionContext(),i.restoreInstancingContext(),this._vertexData};this.evaluateContext?this.output._storedFunction=t:(this.output._storedFunction=null,this.output._storedValue=t(e))}}ye("BABYLON.InstantiateBlock",YO);class ZO extends Zh{constructor(e){super(e),this.registerInput("direction",I.Vector3,!0,new v(1,0,0)),this.registerInput("rotation",I.Vector3,!0,new v(0,0,0)),this.registerInput("scaling",I.Vector3,!0,new v(0,0,0)),this.scaling.acceptedConnectionPointTypes.push(I.Float)}getClassName(){return"InstantiateLinearBlock"}get direction(){return this._inputs[2]}get rotation(){return this._inputs[3]}get scaling(){return this._inputs[4]}_buildBlock(e){const t=i=>{i.pushExecutionContext(this),i.pushInstancingContext(this);const r=this.count.getConnectedValue(i),s=[],o=U.Identity(),a=v.Zero(),l=v.Zero(),h=v.Zero();for(this._currentIndex=0;this._currentIndex<r;this._currentIndex++){const c=this.instance.getConnectedValue(i);if(!c||!c.positions||c.positions.length===0)continue;const u=c.clone(),d=this.direction.getConnectedValue(i),f=this.rotation.getConnectedValue(i),p=i.adaptInput(this.scaling,I.Vector3,v.OneReadOnly);a.copyFrom(d.clone().scale(this._currentIndex)),l.copyFrom(f.clone().scale(this._currentIndex)),h.copyFrom(p.clone().scale(this._currentIndex)),h.addInPlaceFromFloats(1,1,1),U.ComposeToRef(h,Re.FromEulerAngles(l.x,l.y,l.z),a,o),i._instantiateWithMatrix(u,o,s)}if(s.length)if(s.length===1)this._vertexData=s[0];else{const c=s.splice(0,1)[0];this._vertexData=c.merge(s,!0,!1,!0,!0)}return i.restoreExecutionContext(),i.restoreInstancingContext(),this._vertexData};this.evaluateContext?this.output._storedFunction=t:(this.output._storedFunction=null,this.output._storedValue=t(e))}}ye("BABYLON.InstantiateLinearBlock",ZO);class jO extends Zh{constructor(e){super(e),this.registerInput("radius",I.Int,!0,0,0),this.registerInput("angleStart",I.Float,!0,0),this.registerInput("angleEnd",I.Float,!0,Math.PI*2),this.registerInput("transform",I.Vector3,!0,new v(0,0,0)),this.registerInput("rotation",I.Vector3,!0,new v(0,0,0)),this.registerInput("scaling",I.Vector3,!0,new v(0,0,0)),this.scaling.acceptedConnectionPointTypes.push(I.Float)}getClassName(){return"InstantiateRadialBlock"}get radius(){return this._inputs[2]}get angleStart(){return this._inputs[3]}get angleEnd(){return this._inputs[4]}get transform(){return this._inputs[5]}get rotation(){return this._inputs[6]}get scaling(){return this._inputs[7]}_buildBlock(e){const t=i=>{i.pushExecutionContext(this),i.pushInstancingContext(this);const r=this.count.getConnectedValue(i),s=[],o=U.Identity(),a=U.Identity(),l=U.Identity(),h=v.Zero(),c=v.Zero(),u=v.Zero();for(this._currentIndex=0;this._currentIndex<r;this._currentIndex++){const d=this.instance.getConnectedValue(i);if(!d||!d.positions||d.positions.length===0)continue;const f=d.clone(),p=this.radius.getConnectedValue(i),g=this.angleStart.getConnectedValue(i),m=this.angleEnd.getConnectedValue(i),x=this.transform.getConnectedValue(i),E=this.rotation.getConnectedValue(i),R=i.adaptInput(this.scaling,I.Vector3,v.OneReadOnly),C=(m-g)/r,_=g+C*this._currentIndex,T=Re.FromEulerAngles(0,_,0);h.copyFrom(x.clone().scale(this._currentIndex)),c.copyFrom(E.clone().scale(this._currentIndex)),u.copyFrom(R.clone().scale(this._currentIndex)),u.addInPlaceFromFloats(1,1,1),U.RotationYawPitchRollToRef(c.y,c.x,c.z,o),a.setTranslationFromFloats(0,0,p),U.ComposeToRef(u,T,h,l),o.multiplyToRef(a,a),a.multiplyToRef(l,l),i._instantiateWithMatrix(f,l,s)}if(s.length)if(s.length===1)this._vertexData=s[0];else{const d=s.splice(0,1)[0];this._vertexData=d.merge(s,!0,!1,!0,!0)}return i.restoreExecutionContext(),i.restoreInstancingContext(),this._vertexData};this.evaluateContext?this.output._storedFunction=t:(this.output._storedFunction=null,this.output._storedValue=t(e))}}ye("BABYLON.InstantiateRadialBlock",jO);class QO extends Ve{constructor(e){super(e),this.registerInput("float ",I.Float,!0),this.registerInput("int ",I.Int,!0),this.registerOutput("float",I.Float),this.registerOutput("int",I.Int)}getClassName(){return"IntFloatConverterBlock"}get floatIn(){return this._inputs[0]}get intIn(){return this._inputs[1]}get floatOut(){return this._outputs[0]}get intOut(){return this._outputs[1]}_inputRename(e){return e==="float "?"floatIn":e==="int "?"intIn":e}_buildBlock(){this.floatOut._storedFunction=e=>this.floatIn.isConnected?this.floatIn.getConnectedValue(e):this.intIn.isConnected?this.intIn.getConnectedValue(e):0,this.intOut._storedFunction=e=>this.floatIn.isConnected?Math.floor(this.floatIn.getConnectedValue(e)):this.intIn.isConnected?Math.floor(this.intIn.getConnectedValue(e)):0}}ye("BABYLON.IntFloatConverterBlock",QO);function JO(n,e){return`{X: ${n.x.toFixed(e)} Y: ${n.y.toFixed(e)}}`}function $O(n,e){return`{X: ${n._x.toFixed(e)} Y: ${n._y.toFixed(e)} Z: ${n._z.toFixed(e)}}`}function eD(n,e){return`{X: ${n.x.toFixed(e)} Y: ${n.y.toFixed(e)} Z: ${n.z.toFixed(e)} W: ${n.w.toFixed(e)}}`}class tD extends Ve{constructor(e){super(e),this.log=[],this._isDebug=!0,this.registerInput("input",I.AutoDetect),this.registerOutput("output",I.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(I.Geometry),this._inputs[0].excludedConnectionPointTypes.push(I.Texture)}get buildExecutionTime(){return 0}getClassName(){return"DebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_buildBlock(e){if(!this.input.isConnected){this.output._storedFunction=null,this.output._storedValue=null;return}this.log=[];const t=i=>{const r=this.input.getConnectedValue(i);if(r==null)return this.log.push(["null",""]),r;switch(this.input.type){case I.Vector2:this.log.push([JO(r,4),r.toString()]);break;case I.Vector3:this.log.push([$O(r,4),r.toString()]);break;case I.Vector4:this.log.push([eD(r,4),r.toString()]);break;default:this.log.push([r.toString(),r.toString()]);break}return r};this.output.isConnected?this.output._storedFunction=t:this.output._storedValue=t(e)}}ye("BABYLON.DebugBlock",tD);class iD extends Ve{constructor(e){super(e),this.registerInput("geometry",I.Geometry),this.registerOutput("output",I.Geometry),this.registerOutput("id",I.Int),this.registerOutput("collectionId",I.Int),this.registerOutput("verticesCount",I.Int),this.registerOutput("facesCount",I.Int)}getClassName(){return"GeometryInfoBlock"}get geometry(){return this._inputs[0]}get output(){return this._outputs[0]}get id(){return this._outputs[1]}get collectionId(){return this._outputs[2]}get verticesCount(){return this._outputs[3]}get facesCount(){return this._outputs[4]}_buildBlock(){if(!this.geometry.isConnected){this.id._storedValue=0,this.collectionId._storedValue=0,this.verticesCount._storedValue=0,this.facesCount._storedValue=0,this.output._storedValue=0,this.id._storedFunction=null,this.collectionId._storedFunction=null,this.verticesCount._storedFunction=null,this.facesCount._storedFunction=null,this.output._storedFunction=null;return}this.output._storedFunction=e=>(this._currentVertexData=this.geometry.getConnectedValue(e),this._currentVertexData),this.id._storedFunction=e=>(this._currentVertexData=this._currentVertexData||this.geometry.getConnectedValue(e),this._currentVertexData.uniqueId),this.collectionId._storedFunction=e=>(this._currentVertexData=this._currentVertexData||this.geometry.getConnectedValue(e),this._currentVertexData.metadata?this._currentVertexData.metadata.collectionId:0),this.verticesCount._storedFunction=e=>(this._currentVertexData=this._currentVertexData||this.geometry.getConnectedValue(e),this._currentVertexData.positions?this._currentVertexData.positions.length/3:0),this.facesCount._storedFunction=e=>(this._currentVertexData=this._currentVertexData||this.geometry.getConnectedValue(e),this._currentVertexData.indices?this._currentVertexData.indices.length/3:0)}}ye("BABYLON.GeometryInfoBlock",iD);var ps;(function(n){n[n.Spherical=0]="Spherical",n[n.Cylindrical=1]="Cylindrical",n[n.Cubic=2]="Cubic"})(ps||(ps={}));class Ev extends Ve{constructor(e){super(e),this.mapping=ps.Spherical,this.registerInput("position",I.Vector3),this.registerInput("normal",I.Vector3),this.registerInput("center",I.Vector3,!0,v.Zero()),this.registerOutput("uv",I.Vector2)}getClassName(){return"MappingBlock"}get position(){return this._inputs[0]}get normal(){return this._inputs[1]}get center(){return this._inputs[2]}get uv(){return this._outputs[0]}_buildBlock(){if(!this.position.isConnected){this.uv._storedFunction=null,this.uv._storedValue=null;return}const e=v.Zero(),t=i=>{const r=this.position.getConnectedValue(i)||v.Zero(),s=this.normal.getConnectedValue(i)||v.Zero(),o=this.center.getConnectedValue(i),a=me.Zero();switch(this.mapping){case ps.Spherical:{r.subtractToRef(o,e);const l=e.length();l>0&&(a.x=Math.acos(e.y/l)/Math.PI,(e.x!==0||e.z!==0)&&(a.y=Math.atan2(e.x,e.z)/(Math.PI*2)));break}case ps.Cylindrical:{r.subtractToRef(o,e);const l=e.length();l>0&&(a.x=Math.atan2(e.x/l,e.z/l)/(Math.PI*2),a.y=(e.y+1)/2);break}case ps.Cubic:{const l=Math.abs(s.x),h=Math.abs(s.y),c=Math.abs(s.z),u=Math.max(Math.abs(r.x),Math.abs(r.y),Math.abs(r.z));let d=0,f=0;l>=h&&l>=c?(d=r.y/u-o.y,f=r.z/u-o.z):h>=l&&h>=c?(d=r.x/u-o.x,f=r.z/u-o.z):(d=r.x/u-o.x,f=r.y/u-o.y),a.x=(d+1)/2,a.y=(f+1)/2}}return a};this.uv._storedFunction=i=>t(i)}_dumpPropertiesCode(){return super._dumpPropertiesCode()+`${this._codeVariableName}.mapping = BABYLON.MappingTypes.${ps[this.mapping]};
`}serialize(){const e=super.serialize();return e.mapping=this.mapping,e}_deserialize(e){super._deserialize(e),this.mapping=e.mapping}}M([pt("Mapping",lt.List,"ADVANCED",{notifiers:{rebuild:!0},options:[{label:"Spherical",value:ps.Spherical},{label:"Cylindrical",value:ps.Cylindrical},{label:"Cubic",value:ps.Cubic}]})],Ev.prototype,"mapping",void 0);ye("BABYLON.MappingBlock",Ev);class rD extends Ve{constructor(e){super(e),this.registerInput("matrix0",I.Matrix),this.registerInput("matrix1",I.Matrix),this.registerOutput("output",I.Matrix)}getClassName(){return"MatrixComposeBlock"}get matrix0(){return this._inputs[0]}get matrix1(){return this._inputs[1]}get output(){return this._outputs[0]}_buildBlock(){this.output._storedFunction=e=>{if(!this.matrix0.isConnected||!this.matrix1.isConnected)return null;const t=this.matrix0.getConnectedValue(e),i=this.matrix1.getConnectedValue(e);return!t||!i?null:t.multiply(i)}}}ye("BABYLON.MatrixComposeBlock",rD);class sD extends Ve{get endpoints(){return this._endpoints}constructor(e){super(e),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",I.AutoDetect)}getClassName(){return"TeleportInBlock"}get input(){return this._inputs[0]}_dumpCode(e,t){let i=super._dumpCode(e,t);for(const r of this.endpoints)t.indexOf(r)===-1&&(i+=r._dumpCode(e,t));return i}isAnAncestorOfType(e){if(this.getClassName()===e)return!0;for(const t of this.endpoints)if(t.isAnAncestorOfType(e))return!0;return!1}isAnAncestorOf(e){for(const t of this.endpoints)if(t===e||t.isAnAncestorOf(e))return!0;return!1}getDescendantOfPredicate(e){if(e(this))return this;for(const t of this.endpoints){const i=t.getDescendantOfPredicate(e);if(i)return i}return null}attachToEndpoint(e){e.detach(),this._endpoints.push(e),e._entryPoint=this,e._outputs[0]._typeConnectionSource=this._inputs[0],e._tempEntryPointUniqueId=null,e.name="> "+this.name}detachFromEndpoint(e){const t=this._endpoints.indexOf(e);t!==-1&&(this._endpoints.splice(t,1),e._outputs[0]._typeConnectionSource=null,e._entryPoint=null)}_buildBlock(){for(const e of this._endpoints)e.output._storedFunction=t=>this.input.getConnectedValue(t)}}ye("BABYLON.TeleportInBlock",sD);class nD extends Ve{constructor(e){super(e),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",I.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"TeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_buildBlock(){}_customBuildStep(e){this.entryPoint&&this.entryPoint.build(e)}_dumpCode(e,t){let i="";return this.entryPoint&&t.indexOf(this.entryPoint)===-1&&(i+=this.entryPoint._dumpCode(e,t)),i+super._dumpCode(e,t)}_dumpCodeForOutputConnections(e){let t=super._dumpCodeForOutputConnections(e);return this.entryPoint&&(t+=this.entryPoint._dumpCodeForOutputConnections(e)),t}clone(){const e=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(e),e}_dumpPropertiesCode(){let e=super._dumpPropertiesCode();return this.entryPoint&&(e+=`${this.entryPoint._codeVariableName}.attachToEndpoint(${this._codeVariableName});
`),e}serialize(){var e;const t=super.serialize();return t.entryPoint=((e=this.entryPoint)==null?void 0:e.uniqueId)??"",t}_deserialize(e){super._deserialize(e),this._tempEntryPointUniqueId=e.entryPoint}}ye("BABYLON.TeleportOutBlock",nD);class Tv extends Ve{get textureData(){return this._data}get textureWidth(){return this._width}get textureHeight(){return this._height}constructor(e){super(e),this._data=null,this.serializedCachedData=!1,this.registerOutput("texture",I.Texture)}getClassName(){return"GeometryTextureBlock"}get texture(){return this._outputs[0]}_prepareImgToLoadAsync(e){return new Promise((t,i)=>{const r=new Image,s=document.createElement("canvas"),o=s.getContext("2d");r.onload=()=>{s.width=r.width,s.height=r.height,o.drawImage(r,0,0);const a=o.getImageData(0,0,r.width,r.height).data,l=new Float32Array(a.length);for(let h=0;h<a.length;h++)l[h]=a[h]/255;this._data=l,this._width=r.width,this._height=r.height,t()},r.onerror=()=>{this._data=null,i()},r.src=e})}cleanData(){this._data=null}loadTextureFromFileAsync(e){return this._prepareImgToLoadAsync(URL.createObjectURL(e))}loadTextureFromUrlAsync(e){return this._prepareImgToLoadAsync(e)}extractFromTextureAsync(e){return new Promise((t,i)=>{if(!e.isReady()){e.onLoadObservable.addOnce(()=>this.extractFromTextureAsync(e).then(t).catch(i));return}const r=e.getSize();KM.GetTextureDataAsync(e,r.width,r.height).then(async s=>{const o=new Float32Array(s.length);for(let a=0;a<s.length;a++)o[a]=s[a]/255;this._data=o,this._width=r.width,this._height=r.height,t()}).catch(i)})}_buildBlock(){if(!this._data){this.texture._storedValue=null;return}const e={data:this._data,width:this._width,height:this._height};this.texture._storedValue=e}serialize(){const e=super.serialize();return e.width=this._width,e.height=this._height,e.serializedCachedData=this.serializedCachedData,this._data&&this.serializedCachedData&&(e.data=Array.from(this._data)),e}_deserialize(e){super._deserialize(e),this._width=e.width,this._height=e.height,e.data?(this._data=new Float32Array(e.data),this.serializedCachedData=!0):this.serializedCachedData=!!e.serializedCachedData}}M([pt("Serialize cached data",lt.Boolean,"ADVANCED",{notifiers:{rebuild:!0}})],Tv.prototype,"serializedCachedData",void 0);ye("BABYLON.GeometryTextureBlock",Tv);class xv extends Ve{constructor(e){super(e),this.clampCoordinates=!0,this.registerInput("texture",I.Texture),this.registerInput("coordinates",I.Vector2),this.registerOutput("rgba",I.Vector4),this.registerOutput("rgb",I.Vector3),this.registerOutput("r",I.Float),this.registerOutput("g",I.Float),this.registerOutput("b",I.Float),this.registerOutput("a",I.Float)}getClassName(){return"GeometryTextureFetchBlock"}get texture(){return this.inputs[0]}get coordinates(){return this.inputs[1]}get rgba(){return this._outputs[0]}get rgb(){return this._outputs[1]}get r(){return this._outputs[2]}get g(){return this._outputs[3]}get b(){return this._outputs[4]}get a(){return this._outputs[5]}_repeatClamp(e){return e>=0?e%1:1-Math.abs(e)%1}_buildBlock(){const e=t=>{const i=this.texture.getConnectedValue(t);if(!i||!i.data)return null;const r=this.coordinates.getConnectedValue(t);if(!r)return null;const s=this.clampCoordinates?Math.max(0,Math.min(r.x,1)):this._repeatClamp(r.x),o=this.clampCoordinates?Math.max(0,Math.min(r.y,1)):this._repeatClamp(r.y),a=Math.floor(s*(i.width-1)),l=Math.floor(o*(i.height-1)),h=a+i.width*l;return Ke.FromArray(i.data,h*4)};this.rgba._storedFunction=t=>e(t),this.rgb._storedFunction=t=>{const i=e(t);return i?i.toVector3():null},this.r._storedFunction=t=>{const i=e(t);return i?i.x:null},this.g._storedFunction=t=>{const i=e(t);return i?i.y:null},this.b._storedFunction=t=>{const i=e(t);return i?i.z:null},this.a._storedFunction=t=>{const i=e(t);return i?i.w:null}}_dumpPropertiesCode(){return super._dumpPropertiesCode()+`${this._codeVariableName}.clampCoordinates = ${this.clampCoordinates};
`}serialize(){const e=super.serialize();return e.clampCoordinates=this.clampCoordinates,e}_deserialize(e){super._deserialize(e),this.clampCoordinates=e.clampCoordinates}}M([pt("Clamp Coordinates",lt.Boolean,"ADVANCED",{notifiers:{rebuild:!0}})],xv.prototype,"clampCoordinates",void 0);ye("BABYLON.GeometryTextureFetchBlock",xv);class oD extends Ve{constructor(e){super(e),this.registerInput("geometry",I.Geometry),this.registerOutput("min",I.Vector3),this.registerOutput("max",I.Vector3)}getClassName(){return"BoundingBlock"}get geometry(){return this._inputs[0]}get min(){return this._outputs[0]}get max(){return this._outputs[1]}_buildBlock(){this.min._storedFunction=e=>{const t=this.geometry.getConnectedValue(e);return t?Ra(t.positions,0,t.positions.length/3).minimum:null},this.max._storedFunction=e=>{const t=this.geometry.getConnectedValue(e);return t?Ra(t.positions,0,t.positions.length/3).maximum:null}}}ye("BABYLON.BoundingBlock",oD);var gs;(function(n){n[n.Intersect=0]="Intersect",n[n.Subtract=1]="Subtract",n[n.Union=2]="Union"})(gs||(gs={}));class kd extends Ve{constructor(e){super(e),this.evaluateContext=!1,this.operation=gs.Intersect,this.registerInput("geometry0",I.Geometry),this.registerInput("geometry1",I.Geometry),this.registerOutput("output",I.Geometry)}getClassName(){return"BooleanGeometryBlock"}get geometry0(){return this._inputs[0]}get geometry1(){return this._inputs[1]}get output(){return this._outputs[0]}_buildBlock(e){const t=i=>{const r=this.geometry0.getConnectedValue(i),s=this.geometry1.getConnectedValue(i);if(!r||!s)return null;const o=r.positions.length/3;!r.normals&&s.normals&&(r.normals=new Array(r.positions.length)),!s.normals&&r.normals&&(s.normals=new Array(s.positions.length)),!r.uvs&&s.uvs&&(r.uvs=new Array(o*2)),!s.uvs&&r.uvs&&(s.uvs=new Array(o*2)),!r.colors&&s.colors&&(r.colors=new Array(o*4)),!s.colors&&r.colors&&(s.colors=new Array(o*4));const a=cs.FromVertexData(r),l=cs.FromVertexData(s);let h;switch(this.operation){case gs.Intersect:h=a.intersect(l);break;case gs.Subtract:h=a.subtract(l);break;case gs.Union:h=a.union(l);break}return h.toVertexData()};this.evaluateContext?this.output._storedFunction=t:(this.output._storedFunction=null,this.output._storedValue=t(e))}_dumpPropertiesCode(){let e=super._dumpPropertiesCode()+`${this._codeVariableName}.evaluateContext = ${this.evaluateContext?"true":"false"};
`;return e+=`${this._codeVariableName}.operation = BABYLON.BooleanGeometryOperations.${gs[this.operation]};
`,e}serialize(){const e=super.serialize();return e.evaluateContext=this.evaluateContext,e.operation=this.operation,e}_deserialize(e){super._deserialize(e),this.evaluateContext=e.evaluateContext,e.operation&&(this.operation=e.operation)}}M([pt("Evaluate context",lt.Boolean,"ADVANCED",{notifiers:{rebuild:!0}})],kd.prototype,"evaluateContext",void 0);M([pt("Operation",lt.List,"ADVANCED",{notifiers:{rebuild:!0},options:[{label:"Intersect",value:gs.Intersect},{label:"Subtract",value:gs.Subtract},{label:"Union",value:gs.Union}]})],kd.prototype,"operation",void 0);ye("BABYLON.BooleanGeometryBlock",kd);class aD extends Ve{constructor(e){super(e),this.registerInput("x",I.AutoDetect),this.registerInput("y",I.AutoDetect),this.registerOutput("output",I.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].excludedConnectionPointTypes.push(I.Matrix),this._inputs[0].excludedConnectionPointTypes.push(I.Geometry),this._inputs[0].excludedConnectionPointTypes.push(I.Texture)}getClassName(){return"GeometryArcTan2Block"}get x(){return this._inputs[0]}get y(){return this._inputs[1]}get output(){return this._outputs[0]}_buildBlock(){if(!this.x.isConnected||!this.y.isConnected){this.output._storedFunction=null,this.output._storedValue=null;return}const e=(t,i)=>Math.atan2(t,i);this.output._storedFunction=t=>{const i=this.x.getConnectedValue(t),r=this.y.getConnectedValue(t);switch(this.x.type){case I.Int:case I.Float:return e(i,r);case I.Vector2:return new me(e(i.x,r.x),e(i.y,r.y));case I.Vector3:return new v(e(i.x,r.x),e(i.y,r.y),e(i.z,r.z));case I.Vector4:return new Ke(e(i.x,r.x),e(i.y,r.y),e(i.z,r.z),e(i.w,r.w))}return 0}}}ye("BABYLON.GeometryArcTan2Block",aD);class lD extends Ve{constructor(e){super(e),this.registerInput("left",I.AutoDetect),this.registerInput("right",I.AutoDetect),this.registerInput("gradient",I.Float),this.registerOutput("output",I.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].excludedConnectionPointTypes.push(I.Matrix),this._inputs[0].excludedConnectionPointTypes.push(I.Geometry),this._inputs[0].excludedConnectionPointTypes.push(I.Texture)}getClassName(){return"GeometryLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_buildBlock(){if(!this.left.isConnected||!this.right.isConnected||!this.gradient.isConnected){this.output._storedFunction=null,this.output._storedValue=null;return}const e=(t,i,r)=>(1-t)*i+t*r;return this.output._storedFunction=t=>{const i=this.left.getConnectedValue(t),r=this.right.getConnectedValue(t),s=this.gradient.getConnectedValue(t);switch(this.left.type){case I.Int:case I.Float:return e(s,i,r);case I.Vector2:return new me(e(s,i.x,r.x),e(s,i.y,r.y));case I.Vector3:return new v(e(s,i.x,r.x),e(s,i.y,r.y),e(s,i.z,r.z));case I.Vector4:return new Ke(e(s,i.x,r.x),e(s,i.y,r.y),e(s,i.z,r.z),e(s,i.w,r.w))}return 0},this}}ye("BABYLON.GeometryLerpBlock",lD);class hD extends Ve{constructor(e){super(e),this.registerInput("left",I.AutoDetect),this.registerInput("right",I.AutoDetect),this.registerInput("gradient",I.Float),this.registerOutput("output",I.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].excludedConnectionPointTypes.push(I.Matrix),this._inputs[0].excludedConnectionPointTypes.push(I.Geometry),this._inputs[0].excludedConnectionPointTypes.push(I.Texture)}getClassName(){return"GeometryNLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_buildBlock(){if(!this.left.isConnected||!this.right.isConnected||!this.gradient.isConnected){this.output._storedFunction=null,this.output._storedValue=null;return}const e=(t,i,r)=>(1-t)*i+t*r;return this.output._storedFunction=t=>{const i=this.left.getConnectedValue(t),r=this.right.getConnectedValue(t),s=this.gradient.getConnectedValue(t);switch(this.left.type){case I.Int:case I.Float:return e(s,i,r);case I.Vector2:{const o=new me(e(s,i.x,r.x),e(s,i.y,r.y));return o.normalize(),o}case I.Vector3:{const o=new v(e(s,i.x,r.x),e(s,i.y,r.y),e(s,i.z,r.z));return o.normalize(),o}case I.Vector4:{const o=new Ke(e(s,i.x,r.x),e(s,i.y,r.y),e(s,i.z,r.z),e(s,i.w,r.w));return o.normalize(),o}}return 0},this}}ye("BABYLON.GeometryNLerpBlock",hD);class cD extends Ve{constructor(e){super(e),this.registerInput("value",I.AutoDetect),this.registerInput("edge",I.Float),this.registerOutput("output",I.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(I.Matrix),this._inputs[0].excludedConnectionPointTypes.push(I.Geometry),this._inputs[0].excludedConnectionPointTypes.push(I.Texture)}getClassName(){return"GeometryStepBlock"}get value(){return this._inputs[0]}get edge(){return this._inputs[1]}get output(){return this._outputs[0]}_buildBlock(){if(!this.value.isConnected||!this.edge.isConnected){this.output._storedFunction=null,this.output._storedValue=null;return}const e=(t,i)=>t<i?0:1;return this.output._storedFunction=t=>{const i=this.value.getConnectedValue(t),r=this.edge.getConnectedValue(t);switch(this.value.type){case I.Int:case I.Float:return e(i,r);case I.Vector2:return new me(e(i.x,r),e(i.y,r));case I.Vector3:return new v(e(i.x,r),e(i.y,r),e(i.z,r));case I.Vector4:return new Ke(e(i.x,r),e(i.y,r),e(i.z,r),e(i.w,r))}return 0},this}}ye("BABYLON.GeometryStepBlock",cD);class uD extends Ve{constructor(e){super(e),this.registerInput("value",I.AutoDetect),this.registerInput("edge0",I.Float),this.registerInput("edge1",I.Float),this.registerOutput("output",I.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(I.Matrix),this._inputs[0].excludedConnectionPointTypes.push(I.Geometry),this._inputs[0].excludedConnectionPointTypes.push(I.Texture)}getClassName(){return"GeometrySmoothStepBlock"}get value(){return this._inputs[0]}get edge0(){return this._inputs[1]}get edge1(){return this._inputs[2]}get output(){return this._outputs[0]}_buildBlock(){if(!this.value.isConnected||!this.edge0.isConnected||!this.edge1.isConnected){this.output._storedFunction=null,this.output._storedValue=null;return}const e=(t,i,r)=>{const s=Math.max(0,Math.min((t-i)/(r-i),1));return s*s*(3-2*s)};return this.output._storedFunction=t=>{const i=this.value.getConnectedValue(t),r=this.edge0.getConnectedValue(t),s=this.edge1.getConnectedValue(t);switch(this.value.type){case I.Int:case I.Float:return e(i,r,s);case I.Vector2:return new me(e(i.x,r,s),e(i.y,r,s));case I.Vector3:return new v(e(i.x,r,s),e(i.y,r,s),e(i.z,r,s));case I.Vector4:return new Ke(e(i.x,r,s),e(i.y,r,s),e(i.z,r,s),e(i.w,r,s))}return 0},this}}ye("BABYLON.GeometrySmoothStepBlock",uD);class dD extends Ve{constructor(e){super(e),this.registerInput("left",I.AutoDetect),this.registerInput("right",I.AutoDetect),this.registerOutput("output",I.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].excludedConnectionPointTypes.push(I.Matrix),this._inputs[0].excludedConnectionPointTypes.push(I.Geometry),this._inputs[0].excludedConnectionPointTypes.push(I.Texture)}getClassName(){return"GeometryModBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_buildBlock(){if(!this.left.isConnected||!this.right.isConnected){this.output._storedFunction=null,this.output._storedValue=null;return}const e=(t,i)=>t-Math.floor(t/i)*i;return this.output._storedFunction=t=>{const i=this.left.getConnectedValue(t),r=this.right.getConnectedValue(t);switch(this.left.type){case I.Int:case I.Float:return e(i,r);case I.Vector2:return new me(e(i.x,r.x),e(i.y,r.y));case I.Vector3:return new v(e(i.x,r.x),e(i.y,r.y),e(i.z,r.z));case I.Vector4:return new Ke(e(i.x,r.x),e(i.y,r.y),e(i.z,r.z),e(i.w,r.w))}return 0},this}}ye("BABYLON.GeometryModBlock",dD);class fD extends Ve{constructor(e){super(e),this.registerInput("value",I.AutoDetect),this.registerInput("power",I.AutoDetect),this.registerOutput("output",I.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].excludedConnectionPointTypes.push(I.Matrix),this._inputs[0].excludedConnectionPointTypes.push(I.Geometry),this._inputs[0].excludedConnectionPointTypes.push(I.Texture)}getClassName(){return"GeometryPowBlock"}get value(){return this._inputs[0]}get power(){return this._inputs[1]}get output(){return this._outputs[0]}_buildBlock(){if(!this.value.isConnected||!this.power.isConnected){this.output._storedFunction=null,this.output._storedValue=null;return}const e=(t,i)=>Math.pow(t,i);return this.output._storedFunction=t=>{const i=this.value.getConnectedValue(t),r=this.power.getConnectedValue(t);switch(this.value.type){case I.Int:case I.Float:return e(i,r);case I.Vector2:return new me(e(i.x,r),e(i.y,r));case I.Vector3:return new v(e(i.x,r),e(i.y,r),e(i.z,r));case I.Vector4:return new Ke(e(i.x,r),e(i.y,r),e(i.z,r),e(i.w,r))}return 0},this}}ye("BABYLON.GeometryPowBlock",fD);class zd extends Ve{constructor(e){super(e),this.minimum=0,this.maximum=1,this.registerInput("value",I.AutoDetect),this.registerOutput("output",I.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(I.Matrix),this._inputs[0].excludedConnectionPointTypes.push(I.Geometry),this._inputs[0].excludedConnectionPointTypes.push(I.Texture)}getClassName(){return"GeometryClampBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_buildBlock(){if(!this.value.isConnected){this.output._storedFunction=null,this.output._storedValue=null;return}const e=t=>Math.max(this.minimum,Math.min(t,this.maximum));return this.output._storedFunction=t=>{const i=this.value.getConnectedValue(t);switch(this.value.type){case I.Int:case I.Float:return e(i);case I.Vector2:return new me(e(i.x),e(i.y));case I.Vector3:return new v(e(i.x),e(i.y),e(i.z));case I.Vector4:return new Ke(e(i.x),e(i.y),e(i.z),e(i.w))}return 0},this}_dumpPropertiesCode(){let e=super._dumpPropertiesCode()+`${this._codeVariableName}.minimum = ${this.minimum};
`;return e+=`${this._codeVariableName}.maximum = ${this.maximum};
`,e}serialize(){const e=super.serialize();return e.minimum=this.minimum,e.maximum=this.maximum,e}_deserialize(e){super._deserialize(e),this.minimum=e.minimum,this.maximum=e.maximum}}M([pt("Minimum",lt.Float)],zd.prototype,"minimum",void 0);M([pt("Maximum",lt.Float)],zd.prototype,"maximum",void 0);ye("BABYLON.GeometryClampBlock",zd);class pD extends Ve{constructor(e){super(e),this.registerInput("left",I.AutoDetect),this.registerInput("right",I.AutoDetect),this.registerOutput("output",I.Vector3),this._linkConnectionTypes(0,1),this._inputs[0].excludedConnectionPointTypes.push(I.Int),this._inputs[0].excludedConnectionPointTypes.push(I.Float),this._inputs[0].excludedConnectionPointTypes.push(I.Matrix),this._inputs[0].excludedConnectionPointTypes.push(I.Vector2),this._inputs[1].excludedConnectionPointTypes.push(I.Int),this._inputs[1].excludedConnectionPointTypes.push(I.Float),this._inputs[1].excludedConnectionPointTypes.push(I.Matrix),this._inputs[1].excludedConnectionPointTypes.push(I.Vector2)}getClassName(){return"GeometryCrossBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_buildBlock(){if(!this.left.isConnected||!this.right.isConnected){this.output._storedFunction=null,this.output._storedValue=null;return}return this.output._storedFunction=e=>{const t=this.left.getConnectedValue(e),i=this.right.getConnectedValue(e);switch(this.left.type){case I.Vector3:return v.Cross(t,i);case I.Vector4:return v.Cross(t.toVector3(),i.toVector3())}return 0},this}}ye("BABYLON.GeometryCrossBlock",pD);var qe;(function(n){n[n.EaseInSine=0]="EaseInSine",n[n.EaseOutSine=1]="EaseOutSine",n[n.EaseInOutSine=2]="EaseInOutSine",n[n.EaseInQuad=3]="EaseInQuad",n[n.EaseOutQuad=4]="EaseOutQuad",n[n.EaseInOutQuad=5]="EaseInOutQuad",n[n.EaseInCubic=6]="EaseInCubic",n[n.EaseOutCubic=7]="EaseOutCubic",n[n.EaseInOutCubic=8]="EaseInOutCubic",n[n.EaseInQuart=9]="EaseInQuart",n[n.EaseOutQuart=10]="EaseOutQuart",n[n.EaseInOutQuart=11]="EaseInOutQuart",n[n.EaseInQuint=12]="EaseInQuint",n[n.EaseOutQuint=13]="EaseOutQuint",n[n.EaseInOutQuint=14]="EaseInOutQuint",n[n.EaseInExpo=15]="EaseInExpo",n[n.EaseOutExpo=16]="EaseOutExpo",n[n.EaseInOutExpo=17]="EaseInOutExpo",n[n.EaseInCirc=18]="EaseInCirc",n[n.EaseOutCirc=19]="EaseOutCirc",n[n.EaseInOutCirc=20]="EaseInOutCirc",n[n.EaseInBack=21]="EaseInBack",n[n.EaseOutBack=22]="EaseOutBack",n[n.EaseInOutBack=23]="EaseInOutBack",n[n.EaseInElastic=24]="EaseInElastic",n[n.EaseOutElastic=25]="EaseOutElastic",n[n.EaseInOutElastic=26]="EaseInOutElastic"})(qe||(qe={}));class Cv extends Ve{constructor(e){super(e),this.type=qe.EaseInOutSine,this.registerInput("input",I.AutoDetect),this.registerOutput("output",I.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(I.Matrix),this._inputs[0].excludedConnectionPointTypes.push(I.Int)}getClassName(){return"GeometryCurveBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_buildBlock(){if(!this.input.isConnected){this.output._storedFunction=null,this.output._storedValue=null;return}let e;switch(this.type){case qe.EaseInSine:e=t=>1-Math.cos(t*3.1415/2);break;case qe.EaseOutSine:e=t=>Math.sin(t*3.1415/2);break;case qe.EaseInOutSine:e=t=>-(Math.cos(t*3.1415)-1)/2;break;case qe.EaseInQuad:e=t=>t*t;break;case qe.EaseOutQuad:e=t=>(1-t)*(1-t);break;case qe.EaseInOutQuad:{e=t=>t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2;break}case qe.EaseInCubic:e=t=>t*t*t;break;case qe.EaseOutCubic:{e=t=>1-Math.pow(1-t,3);break}case qe.EaseInOutCubic:{e=t=>t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2;break}case qe.EaseInQuart:e=t=>t*t*t*t;break;case qe.EaseOutQuart:{e=t=>1-Math.pow(1-t,4);break}case qe.EaseInOutQuart:{e=t=>t<.5?8*t*t*t*t:1-Math.pow(-2*t+2,4)/2;break}case qe.EaseInQuint:e=t=>t*t*t*t*t;break;case qe.EaseOutQuint:{e=t=>1-Math.pow(1-t,5);break}case qe.EaseInOutQuint:{e=t=>t<.5?16*t*t*t*t*t:1-Math.pow(-2*t+2,5)/2;break}case qe.EaseInExpo:{e=t=>t===0?0:Math.pow(2,10*t-10);break}case qe.EaseOutExpo:{e=t=>t===1?1:1-Math.pow(2,-10*t);break}case qe.EaseInOutExpo:{e=t=>t===0?0:t===1?1:t<.5?Math.pow(2,20*t-10)/2:(2-Math.pow(2,-20*t+10))/2;break}case qe.EaseInCirc:{e=t=>1-Math.sqrt(1-Math.pow(t,2));break}case qe.EaseOutCirc:{e=t=>Math.sqrt(1-Math.pow(t-1,2));break}case qe.EaseInOutCirc:{e=t=>t<.5?(1-Math.sqrt(1-Math.pow(2*t,2)))/2:(Math.sqrt(1-Math.pow(-2*t+2,2))+1)/2;break}case qe.EaseInBack:{e=t=>2.70158*t*t*t-1.70158*t*t;break}case qe.EaseOutBack:{e=t=>2.70158*Math.pow(t-1,3)+1.70158*Math.pow(t-1,2);break}case qe.EaseInOutBack:{e=t=>t<.5?Math.pow(2*t,2)*(3.5949095*2*t-2.5949095)/2:(Math.pow(2*t-2,2)*(3.5949095*(t*2-2)+3.5949095)+2)/2;break}case qe.EaseInElastic:{e=t=>t===0?0:t===1?1:-Math.pow(2,10*t-10)*Math.sin((t*10-10.75)*(2*3.1415/3));break}case qe.EaseOutElastic:{e=t=>t===0?0:t===1?1:Math.pow(2,-10*t)*Math.sin((t*10-.75)*(2*3.1415/3))+1;break}case qe.EaseInOutElastic:{e=t=>t===0?0:t==1?1:t<.5?-(Math.pow(2,20*t-10)*Math.sin((20*t-11.125)*(2*3.1415/4.5)))/2:Math.pow(2,-20*t+10)*Math.sin((20*t-11.125)*(2*3.1415/4.5))/2+1;break}}return this.output._storedFunction=t=>{const i=this.input.getConnectedValue(t);switch(this.input.type){case I.Float:return e(i);case I.Vector2:return new me(e(i.x),e(i.y));case I.Vector3:return new v(e(i.x),e(i.y),e(i.z));case I.Vector4:return new Ke(e(i.x),e(i.y),e(i.z),e(i.w))}return 0},this}serialize(){const e=super.serialize();return e.curveType=this.type,e}_deserialize(e){super._deserialize(e),this.type=e.curveType}_dumpPropertiesCode(){return super._dumpPropertiesCode()+`${this._codeVariableName}.type = BABYLON.GeometryCurveBlockTypes.${qe[this.type]};
`}}M([pt("Type",lt.List,"ADVANCED",{notifiers:{rebuild:!0},options:[{label:"EaseInSine",value:qe.EaseInSine},{label:"EaseOutSine",value:qe.EaseOutSine},{label:"EaseInOutSine",value:qe.EaseInOutSine},{label:"EaseInQuad",value:qe.EaseInQuad},{label:"EaseOutQuad",value:qe.EaseOutQuad},{label:"EaseInOutQuad",value:qe.EaseInOutQuad},{label:"EaseInCubic",value:qe.EaseInCubic},{label:"EaseOutCubic",value:qe.EaseOutCubic},{label:"EaseInOutCubic",value:qe.EaseInOutCubic},{label:"EaseInQuart",value:qe.EaseInQuart},{label:"EaseOutQuart",value:qe.EaseOutQuart},{label:"EaseInOutQuart",value:qe.EaseInOutQuart},{label:"EaseInQuint",value:qe.EaseInQuint},{label:"EaseOutQuint",value:qe.EaseOutQuint},{label:"EaseInOutQuint",value:qe.EaseInOutQuint},{label:"EaseInExpo",value:qe.EaseInExpo},{label:"EaseOutExpo",value:qe.EaseOutExpo},{label:"EaseInOutExpo",value:qe.EaseInOutExpo},{label:"EaseInCirc",value:qe.EaseInCirc},{label:"EaseOutCirc",value:qe.EaseOutCirc},{label:"EaseInOutCirc",value:qe.EaseInOutCirc},{label:"EaseInBack",value:qe.EaseInBack},{label:"EaseOutBack",value:qe.EaseOutBack},{label:"EaseInOutBack",value:qe.EaseInOutBack},{label:"EaseInElastic",value:qe.EaseInElastic},{label:"EaseOutElastic",value:qe.EaseOutElastic},{label:"EaseInOutElastic",value:qe.EaseInOutElastic}]})],Cv.prototype,"type",void 0);ye("BABYLON.GeometryCurveBlock",Cv);class gD extends Ve{constructor(e){super(e),this.registerInput("color",I.Vector3),this.registerInput("level",I.Float,!0,0),this.registerOutput("output",I.Vector3)}getClassName(){return"GeometryDesaturateBlock"}get color(){return this._inputs[0]}get level(){return this._inputs[1]}get output(){return this._outputs[0]}_buildBlock(){if(!this.color.isConnected){this.output._storedFunction=null,this.output._storedValue=null;return}return this.output._storedFunction=e=>{const t=this.color.getConnectedValue(e),i=this.level.getConnectedValue(e),r=Math.min(t.x,t.y,t.z),s=Math.max(t.x,t.y,t.z),o=.5*(r+s);return new v(t.x*(1-i)+o*i,t.y*(1-i)+o*i,t.z*(1-i)+o*i)},this}}ye("BABYLON.GeometryDesaturateBlock",gD);class mD extends Ve{constructor(e){super(e),this.registerInput("value",I.AutoDetect),this.registerInput("steps",I.AutoDetect),this.registerOutput("output",I.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].excludedConnectionPointTypes.push(I.Matrix),this._inputs[1].excludedConnectionPointTypes.push(I.Matrix),this._inputs[1].acceptedConnectionPointTypes.push(I.Float)}getClassName(){return"GeometryPosterizeBlock"}get value(){return this._inputs[0]}get steps(){return this._inputs[1]}get output(){return this._outputs[0]}_buildBlock(){if(!this.value.isConnected||!this.steps.isConnected){this.output._storedFunction=null,this.output._storedValue=null;return}return this.output._storedFunction=e=>{const t=this.value.getConnectedValue(e),i=this.steps.getConnectedValue(e);let r=i;if(this.steps.type===I.Float)switch(this.value.type){case I.Vector2:r=new me(i,i);break;case I.Vector3:r=new v(i,i,i);break;case I.Vector4:r=new Ke(i,i,i,i);break}switch(this.value.type){case I.Vector2:return new me(t.x/(1/r.x)*(1/r.x),t.y/(1/r.y)*(1/r.y));case I.Vector3:return new v(t.x/(1/r.x)*(1/r.x),t.y/(1/r.y)*(1/r.y),t.z/(1/r.z)*(1/r.z));case I.Vector4:return new Ke(t.x/(1/r.x)*(1/r.x),t.y/(1/r.y)*(1/r.y),t.z/(1/r.z)*(1/r.z),t.w/(1/r.w)*(1/r.w));default:return Math.floor(t/(1/i)*(1/i))}},this}}ye("BABYLON.GeometryPosterizeBlock",mD);class _D extends Ve{constructor(e){super(e),this.registerInput("value",I.AutoDetect),this.registerInput("reference",I.AutoDetect),this.registerInput("distance",I.Float),this.registerInput("replacement",I.AutoDetect),this.registerOutput("output",I.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._linkConnectionTypes(0,3),this._inputs[0].excludedConnectionPointTypes.push(I.Float),this._inputs[0].excludedConnectionPointTypes.push(I.Matrix),this._inputs[1].excludedConnectionPointTypes.push(I.Float),this._inputs[1].excludedConnectionPointTypes.push(I.Matrix),this._inputs[3].excludedConnectionPointTypes.push(I.Float),this._inputs[3].excludedConnectionPointTypes.push(I.Matrix)}getClassName(){return"GeometryReplaceColorBlock"}get value(){return this._inputs[0]}get reference(){return this._inputs[1]}get distance(){return this._inputs[2]}get replacement(){return this._inputs[3]}get output(){return this._outputs[0]}_buildBlock(){if(!this.value.isConnected||!this.reference.isConnected||!this.distance.isConnected||!this.replacement.isConnected){this.output._storedFunction=null,this.output._storedValue=null;return}return this.output._storedFunction=e=>{const t=this.value.getConnectedValue(e),i=this.reference.getConnectedValue(e),r=this.distance.getConnectedValue(e),s=this.replacement.getConnectedValue(e);return t.subtract(i).length()<r?s:t},this}}ye("BABYLON.GeometryReplaceColorBlock",_D);class vD extends Ve{constructor(e){super(e),this.registerInput("left",I.AutoDetect),this.registerInput("right",I.AutoDetect),this.registerOutput("output",I.Float),this._linkConnectionTypes(0,1),this._inputs[0].excludedConnectionPointTypes.push(I.Int),this._inputs[0].excludedConnectionPointTypes.push(I.Float),this._inputs[0].excludedConnectionPointTypes.push(I.Matrix),this._inputs[1].excludedConnectionPointTypes.push(I.Float),this._inputs[1].excludedConnectionPointTypes.push(I.Matrix)}getClassName(){return"GeometryDistanceBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_buildBlock(){if(!this.left.isConnected||!this.right.isConnected){this.output._storedFunction=null,this.output._storedValue=null;return}return this.output._storedFunction=e=>{const t=this.left.getConnectedValue(e),i=this.right.getConnectedValue(e);return t.subtract(i).length()},this}}ye("BABYLON.GeometryDistanceBlock",vD);class ED extends Ve{constructor(e){super(e),this.registerInput("left",I.AutoDetect),this.registerInput("right",I.AutoDetect),this.registerOutput("output",I.Float),this._linkConnectionTypes(0,1),this._inputs[0].excludedConnectionPointTypes.push(I.Int),this._inputs[0].excludedConnectionPointTypes.push(I.Float),this._inputs[0].excludedConnectionPointTypes.push(I.Matrix),this._inputs[1].excludedConnectionPointTypes.push(I.Float),this._inputs[1].excludedConnectionPointTypes.push(I.Matrix)}getClassName(){return"GeometryDotBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_buildBlock(){if(!this.left.isConnected||!this.right.isConnected){this.output._storedFunction=null,this.output._storedValue=null;return}return this.output._storedFunction=e=>{const t=this.left.getConnectedValue(e),i=this.right.getConnectedValue(e);return t.dot(i)},this}}ye("BABYLON.GeometryDotBlock",ED);class TD extends Ve{constructor(e){super(e),this.registerInput("value",I.AutoDetect),this.registerOutput("output",I.Float),this._inputs[0].excludedConnectionPointTypes.push(I.Int),this._inputs[0].excludedConnectionPointTypes.push(I.Float),this._inputs[0].excludedConnectionPointTypes.push(I.Matrix)}getClassName(){return"GeometryLengthBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_buildBlock(){if(!this.value.isConnected){this.output._storedFunction=null,this.output._storedValue=null;return}return this.output._storedFunction=e=>this.value.getConnectedValue(e).length(),this}}ye("BABYLON.GeometryLengthBlock",TD);class xD extends Ve{constructor(e){super(e),this.registerInput("input",I.Vector2),this.registerInput("angle",I.Float),this.registerOutput("output",I.Vector2)}getClassName(){return"GeometryRotate2dBlock"}get input(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}_buildBlock(){if(!this.angle.isConnected||!this.input.isConnected){this.output._storedFunction=null,this.output._storedValue=null;return}return this.output._storedFunction=e=>{const t=this.input.getConnectedValue(e),i=this.angle.getConnectedValue(e);return new me(Math.cos(i)*t.x-Math.sin(i)*t.y,Math.sin(i)*t.x+Math.cos(i)*t.y)},this}}ye("BABYLON.GeometryRotate2dBlock",xD);const CD="gaussianSplattingPixelShader",RD=`#include<clipPlaneFragmentDeclaration>
#include<logDepthDeclaration>
#include<fogFragmentDeclaration>
varying vec4 vColor;varying vec2 vPosition;void main () { 
#include<clipPlaneFragment>
float A=-dot(vPosition,vPosition);if (A<-4.0) discard;float B=exp(A)*vColor.a;
#include<logDepthFragment>
vec3 color=vColor.rgb;
#ifdef FOG
#include<fogFragment>
#endif
gl_FragColor=vec4(color,B);}
`;Y.ShadersStore[CD]=RD;const SD="gaussianSplattingVertexDeclaration",yD=`uniform mat4 world;uniform mat4 view;uniform mat4 projection;
`;Y.IncludesShadersStore[SD]=yD;const bD="gaussianSplattingUboDeclaration",ID=`#include<sceneUboDeclaration>
#include<meshUboDeclaration>
`;Y.IncludesShadersStore[bD]=ID;const AD="gaussianSplattingVertexShader",MD=`#include<__decl__gaussianSplattingVertex>
#ifdef LOGARITHMICDEPTH
#extension GL_EXT_frag_depth : enable
#endif
#include<clipPlaneVertexDeclaration>
#include<fogVertexDeclaration>
#include<logDepthDeclaration>
attribute vec2 position;attribute float splatIndex;uniform vec2 viewport;uniform vec2 dataTextureSize;uniform vec2 focal;uniform sampler2D covariancesATexture;uniform sampler2D covariancesBTexture;uniform sampler2D centersTexture;uniform sampler2D colorsTexture;varying vec4 vColor;varying vec2 vPosition;
#if !defined(WEBGL2) && !defined(WEBGPU) && !defined(NATIVE)
mat3 transpose(mat3 matrix) {return mat3(matrix[0][0],matrix[1][0],matrix[2][0],
matrix[0][1],matrix[1][1],matrix[2][1],
matrix[0][2],matrix[1][2],matrix[2][2]);}
#endif
vec2 getDataUV(float index,vec2 textureSize) {float y=floor(index/textureSize.x);float x=index-y*textureSize.x;return vec2((x+0.5)/textureSize.x,(y+0.5)/textureSize.y);}
void main () {vec2 splatUV=getDataUV(splatIndex,dataTextureSize);vec3 center=texture2D(centersTexture,splatUV).xyz;vec4 color=texture2D(colorsTexture,splatUV);vec3 covA=texture2D(covariancesATexture,splatUV).xyz;vec3 covB=texture2D(covariancesBTexture,splatUV).xyz;vec4 worldPos=world*vec4(center,1.0);mat4 modelView=view*world;vec4 camspace=view*worldPos;vec4 pos2d=projection*camspace;float bounds=1.2*pos2d.w;if (pos2d.z<-pos2d.w || pos2d.x<-bounds || pos2d.x>bounds
|| pos2d.y<-bounds || pos2d.y>bounds) {gl_Position=vec4(0.0,0.0,2.0,1.0);return;}
mat3 Vrk=mat3(
covA.x,covA.y,covA.z,
covA.y,covB.x,covB.y,
covA.z,covB.y,covB.z
);mat3 J=mat3(
focal.x/camspace.z,0.,-(focal.x*camspace.x)/(camspace.z*camspace.z),
0.,focal.y/camspace.z,-(focal.y*camspace.y)/(camspace.z*camspace.z),
0.,0.,0.
);mat3 invy=mat3(1,0,0,0,-1,0,0,0,1);mat3 T=invy*transpose(mat3(modelView))*J;mat3 cov2d=transpose(T)*Vrk*T;float mid=(cov2d[0][0]+cov2d[1][1])/2.0;float radius=length(vec2((cov2d[0][0]-cov2d[1][1])/2.0,cov2d[0][1]));float lambda1=mid+radius,lambda2=mid-radius;if (lambda2<0.0) return;vec2 diagonalVector=normalize(vec2(cov2d[0][1],lambda1-cov2d[0][0]));vec2 majorAxis=min(sqrt(2.0*lambda1),1024.0)*diagonalVector;vec2 minorAxis=min(sqrt(2.0*lambda2),1024.0)*vec2(diagonalVector.y,-diagonalVector.x);vColor=color;vPosition=position;vec2 vCenter=vec2(pos2d);gl_Position=vec4(
vCenter 
+ (position.x*majorAxis*1./viewport 
+ position.y*minorAxis*1./viewport)*pos2d.w,pos2d.zw);
#include<clipPlaneVertex>
#include<fogVertex>
#include<logDepthVertex>
}
`;Y.ShadersStore[AD]=MD;class PD extends is{constructor(){super(),this.FOG=!1,this.THIN_INSTANCES=!0,this.LOGARITHMICDEPTH=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.rebuild()}}class Pa extends qh{constructor(e,t){super(e,t),this.backFaceCulling=!1}get hasRenderTargetTextures(){return!1}needAlphaTesting(){return!1}needAlphaBlending(){return!0}isReadyForSubMesh(e,t){const i=t._drawWrapper;if(i.effect&&this.isFrozen&&i._wasPreviouslyReady&&i._wasPreviouslyUsingInstances===!0)return!0;t.materialDefines||(t.materialDefines=new PD);const r=this.getScene(),s=t.materialDefines;if(this._isReadyForSubMesh(t))return!0;const o=r.getEngine();if(xd(e,r,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,s),Cd(r,o,this,s,!0,null,!0),Rd(e,s,!1,!1),s.isDirty){s.markAsProcessed(),r.resetCachedMaterial();const a=[b.PositionKind,"splatIndex"];Td(a,s);const l=["world","view","projection","vFogInfos","vFogColor","logarithmicDepthConstant","viewport","dataTextureSize","focal"],h=["covariancesATexture","covariancesBTexture","centersTexture","colorsTexture"],c=["Scene","Mesh"];Sd({uniformsNames:l,uniformBuffersNames:c,samplers:h,defines:s}),Wh(l);const u=s.toString(),d=r.getEngine().createEffect("gaussianSplatting",{attributes:a,uniformsNames:l,uniformBuffersNames:c,samplers:h,defines:u,onCompiled:this.onCompiled,onError:this.onError},o);t.setEffect(d,s,this._materialContext)}return!t.effect||!t.effect.isReady()?!1:(s._renderId=r.getRenderId(),i._wasPreviouslyReady=!0,i._wasPreviouslyUsingInstances=!0,!0)}bindForSubMesh(e,t,i){const r=this.getScene(),s=i.materialDefines;if(!s)return;const o=i.effect;if(o){if(this._activeEffect=o,t.getMeshUniformBuffer().bindToEffect(o,"Mesh"),t.transferToEffect(e),this._mustRebind(r,o,i,t.visibility)){this.bindView(o),this.bindViewProjection(o);const a=r.getEngine(),l=this.getScene().activeCamera,h=a.getRenderWidth(),c=a.getRenderHeight();this._activeEffect.setFloat2("viewport",h,c);let u=1e3;l&&(l.fovMode==Je.FOVMODE_VERTICAL_FIXED?u=c/2/Math.tan(l.fov/2):u=h/2/Math.tan(l.fov/2)),this._activeEffect.setFloat2("focal",u,u);const d=t;if(d.covariancesATexture){const f=d.covariancesATexture.getSize();o.setFloat2("dataTextureSize",f.width,f.height),o.setTexture("covariancesATexture",d.covariancesATexture),o.setTexture("covariancesBTexture",d.covariancesBTexture),o.setTexture("centersTexture",d.centersTexture),o.setTexture("colorsTexture",d.colorsTexture)}Xh(o,this,r)}else r.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);Kh(r,t,o),this.useLogarithmicDepth&&Hh(s,o,r),this._afterBind(t,this._activeEffect,i)}}clone(e){return Le.Clone(()=>new Pa(e,this.getScene()),this)}serialize(){const e=super.serialize();return e.customType="BABYLON.GaussianSplattingMaterial",e}getClassName(){return"GaussianSplattingMaterial"}static Parse(e,t,i){return Le.Parse(()=>new Pa(e.name,t),e,t,i)}}ye("BABYLON.GaussianSplattingMaterial",Pa);class _h extends k{get covariancesATexture(){return this._covariancesATexture}get covariancesBTexture(){return this._covariancesBTexture}get centersTexture(){return this._centersTexture}get colorsTexture(){return this._colorsTexture}constructor(e,t=null,i=null){super(e,i),this._vertexCount=0,this._worker=null,this._frameIdLastUpdate=-1,this._modelViewMatrix=U.Identity(),this._material=null,this._canPostToWorker=!0,this._covariancesATexture=null,this._covariancesBTexture=null,this._centersTexture=null,this._colorsTexture=null;const r=new re;r.positions=[-2,-2,0,2,-2,0,2,2,0,-2,2,0],r.indices=[0,1,2,0,2,3],r.applyToMesh(this),this.subMeshes=[],new Pi(0,0,4,0,6,this),this.doNotSyncBoundingInfo=!0,this.setEnabled(!1),this._lastProj=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t&&this.loadFileAsync(t)}getClassName(){return"GaussianSplattingMesh"}getTotalVertices(){return this._vertexCount}render(e,t,i){this.material||(this._material=new Pa(this.name+"_material",this._scene),this.material=this._material);const r=this.getScene().getFrameId();if(r!==this._frameIdLastUpdate&&this._worker&&this._scene.activeCamera&&this._canPostToWorker){this.getWorldMatrix().multiplyToRef(this._scene.activeCamera.getViewMatrix(),this._modelViewMatrix);const s=this._lastProj[2]*this._modelViewMatrix.m[2]+this._lastProj[6]*this._modelViewMatrix.m[6]+this._lastProj[10]*this._modelViewMatrix.m[10];Math.abs(s-1)>=.01&&(this._frameIdLastUpdate=r,this._canPostToWorker=!1,this._lastProj=this._modelViewMatrix.m.slice(0),this._worker.postMessage({view:this._modelViewMatrix.m,depthMix:this._depthMix},[this._depthMix.buffer]))}return super.render(e,t,i)}static ConvertPLYToSplat(e){const t=new Uint8Array(e),i=new TextDecoder().decode(t.slice(0,1024*10)),r=`end_header
`,s=i.indexOf(r);if(s<0||!i)return e;const o=parseInt(/element vertex (\d+)\n/.exec(i)[1]);let a=0;const l={double:8,int:4,uint:4,float:4,short:2,ushort:2,uchar:1},h=[],c=i.slice(0,s).split(`
`).filter(m=>m.startsWith("property "));for(const m of c){const[,x,E]=m.split(" ");if(h.push({name:E,type:x,offset:a}),l[x])a+=l[x];else return oe.Error(`Unsupported property type: ${x}. Are you sure it's a valid Gaussian Splatting file?`),new ArrayBuffer(0)}const u=3*4+3*4+4+4,d=.28209479177387814,f=new DataView(e,s+r.length),p=new ArrayBuffer(u*o),g=new Re;for(let m=0;m<o;m++){const x=new Float32Array(p,m*u,3),E=new Float32Array(p,m*u+12,3),R=new Uint8ClampedArray(p,m*u+24,4),C=new Uint8ClampedArray(p,m*u+28,4);let _=255,T=0,y=0,P=0;for(let D=0;D<h.length;D++){const F=h[D];let N;switch(F.type){case"float":N=f.getFloat32(F.offset+m*a,!0);break;case"int":N=f.getInt32(F.offset+m*a,!0);break;default:throw new Error(`Unsupported property type: ${F.type}`)}switch(F.name){case"x":x[0]=N;break;case"y":x[1]=N;break;case"z":x[2]=N;break;case"scale_0":E[0]=Math.exp(N);break;case"scale_1":E[1]=Math.exp(N);break;case"scale_2":E[2]=Math.exp(N);break;case"red":R[0]=N;break;case"green":R[1]=N;break;case"blue":R[2]=N;break;case"f_dc_0":R[0]=(.5+d*N)*255;break;case"f_dc_1":R[1]=(.5+d*N)*255;break;case"f_dc_2":R[2]=(.5+d*N)*255;break;case"f_dc_3":R[3]=(.5+d*N)*255;break;case"opacity":R[3]=1/(1+Math.exp(-N))*255;break;case"rot_0":_=N;break;case"rot_1":T=N;break;case"rot_2":y=N;break;case"rot_3":P=N;break}}g.set(T,y,P,_),g.normalize(),C[0]=g.w*128+128,C[1]=g.x*128+128,C[2]=g.y*128+128,C[3]=g.z*128+128}return p}loadDataAsync(e){return Promise.resolve(this._loadData(e))}loadFileAsync(e){return ge.LoadFileAsync(e,!0).then(t=>{this._loadData(_h.ConvertPLYToSplat(t))})}dispose(e){var t,i,r,s,o,a;(t=this._covariancesATexture)==null||t.dispose(),(i=this._covariancesBTexture)==null||i.dispose(),(r=this._centersTexture)==null||r.dispose(),(s=this._colorsTexture)==null||s.dispose(),this._covariancesATexture=null,this._covariancesBTexture=null,this._centersTexture=null,this._colorsTexture=null,(o=this._material)==null||o.dispose(!1,!0),this._material=null,(a=this._worker)==null||a.terminate(),this._worker=null,super.dispose(e)}_loadData(e){var t;if(!e.byteLength)return;const i=new Uint8Array(e),r=new Float32Array(i.buffer),s=3*4+3*4+4+4,o=i.length/s;this._vertexCount=o;const a=this._getTextureSize(o),l=a.x*a.y,h=new Float32Array(3*l),c=new Float32Array(3*l),u=new Float32Array(3*l),d=W.Matrix[0],f=W.Matrix[1],p=W.Quaternion[0],g=new v(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),m=new v(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let T=0;T<o;T++){const y=r[8*T+0],P=-r[8*T+1],D=r[8*T+2];h[3*T+0]=y,h[3*T+1]=P,h[3*T+2]=D,g.minimizeInPlaceFromFloats(y,P,D),m.maximizeInPlaceFromFloats(y,P,D),p.set((i[32*T+28+1]-128)/128,(i[32*T+28+2]-128)/128,(i[32*T+28+3]-128)/128,-(i[32*T+28+0]-128)/128),p.toRotationMatrix(d),U.ScalingToRef(r[8*T+3+0]*2,r[8*T+3+1]*2,r[8*T+3+2]*2,f);const F=d.multiplyToRef(f,W.Matrix[0]).m;c[T*3+0]=F[0]*F[0]+F[1]*F[1]+F[2]*F[2],c[T*3+1]=F[0]*F[4]+F[1]*F[5]+F[2]*F[6],c[T*3+2]=F[0]*F[8]+F[1]*F[9]+F[2]*F[10],u[T*3+0]=F[4]*F[4]+F[5]*F[5]+F[6]*F[6],u[T*3+1]=F[4]*F[8]+F[5]*F[9]+F[6]*F[10],u[T*3+2]=F[8]*F[8]+F[9]*F[9]+F[10]*F[10]}const x=this.getBoundingInfo();x.reConstruct(g,m,this.getWorldMatrix()),x.isLocked=!0,this.forcedInstanceCount=this._vertexCount,this.setEnabled(!0);const E=new Float32Array(this._vertexCount*1);this.thinInstanceSetBuffer("splatIndex",E,1,!1);const R=(T,y,P,D)=>new lr(T,y,P,D,this._scene,!1,!1,2,1),C=T=>{const y=T.length/3,P=new Float32Array(y*4);for(let D=0;D<y;++D)P[D*4+0]=T[D*3+0],P[D*4+1]=T[D*3+1],P[D*4+2]=T[D*3+2],P[D*4+3]=1;return P},_=new Float32Array(a.x*a.y*4);for(let T=0;T<this._vertexCount;++T)_[T*4+0]=i[32*T+24+0]/255,_[T*4+1]=i[32*T+24+1]/255,_[T*4+2]=i[32*T+24+2]/255,_[T*4+3]=i[32*T+24+3]/255;this._covariancesATexture=R(C(c),a.x,a.y,5),this._covariancesBTexture=R(C(u),a.x,a.y,5),this._centersTexture=R(C(h),a.x,a.y,5),this._colorsTexture=R(_,a.x,a.y,5),(t=this._worker)==null||t.terminate(),this._worker=new Worker(URL.createObjectURL(new Blob(["(",_h._CreateWorker.toString(),")(self)"],{type:"application/javascript"}))),this._depthMix=new BigInt64Array(o),this._worker.postMessage({positions:h,vertexCount:o},[h.buffer]),this._worker.onmessage=T=>{this._depthMix=T.data.depthMix;const y=new Uint32Array(T.data.depthMix.buffer);for(let P=0;P<this._vertexCount;P++)E[P]=y[2*P];this.thinInstanceBufferUpdated("splatIndex"),this._canPostToWorker=!0}}_getTextureSize(e){const t=this._scene.getEngine(),i=t.getCaps().maxTextureSize;let r=1;if(t.webGLVersion===1&&!t.isWebGPU)for(;i*r<e;)r*=2;else r=Math.ceil(e/i);return r>i&&(oe.Error("GaussianSplatting texture size: ("+i+", "+r+"), maxTextureSize: "+i),r=i),new me(i,r)}}_h._CreateWorker=function(n){let e=0,t,i,r,s;n.onmessage=o=>{if(o.data.positions)t=o.data.positions,e=o.data.vertexCount;else{const a=o.data.view;if(!t||!a)throw new Error("positions or view is not defined!");i=o.data.depthMix,r=new Uint32Array(i.buffer),s=new Float32Array(i.buffer);for(let l=0;l<e;l++)r[2*l]=l;for(let l=0;l<e;l++)s[2*l+1]=1e4-(a[2]*t[3*l+0]+a[6]*t[3*l+1]+a[10]*t[3*l+2]);i.sort(),n.postMessage({depthMix:i},[i.buffer])}}};var OD=Array.isArray;const el=OD;var DD=typeof global=="object"&&global&&global.Object===Object&&global;const Rv=DD;var ND=typeof self=="object"&&self&&self.Object===Object&&self,FD=Rv||ND||Function("return this")();const jh=FD;var LD=jh.Symbol;const Vo=LD;var Sv=Object.prototype,wD=Sv.hasOwnProperty,UD=Sv.toString,oa=Vo?Vo.toStringTag:void 0;function VD(n){var e=wD.call(n,oa),t=n[oa];try{n[oa]=void 0;var i=!0}catch{}var r=UD.call(n);return i&&(e?n[oa]=t:delete n[oa]),r}var BD=Object.prototype,kD=BD.toString;function zD(n){return kD.call(n)}var GD="[object Null]",WD="[object Undefined]",Lg=Vo?Vo.toStringTag:void 0;function Qh(n){return n==null?n===void 0?WD:GD:Lg&&Lg in Object(n)?VD(n):zD(n)}function Jh(n){return n!=null&&typeof n=="object"}var XD="[object Symbol]";function Gd(n){return typeof n=="symbol"||Jh(n)&&Qh(n)==XD}var HD=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,KD=/^\w*$/;function qD(n,e){if(el(n))return!1;var t=typeof n;return t=="number"||t=="symbol"||t=="boolean"||n==null||Gd(n)?!0:KD.test(n)||!HD.test(n)||e!=null&&n in Object(e)}function Oa(n){var e=typeof n;return n!=null&&(e=="object"||e=="function")}var YD="[object AsyncFunction]",ZD="[object Function]",jD="[object GeneratorFunction]",QD="[object Proxy]";function yv(n){if(!Oa(n))return!1;var e=Qh(n);return e==ZD||e==jD||e==YD||e==QD}var JD=jh["__core-js_shared__"];const ru=JD;var wg=function(){var n=/[^.]+$/.exec(ru&&ru.keys&&ru.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""}();function $D(n){return!!wg&&wg in n}var eN=Function.prototype,tN=eN.toString;function iN(n){if(n!=null){try{return tN.call(n)}catch{}try{return n+""}catch{}}return""}var rN=/[\\^$.*+?()[\]{}|]/g,sN=/^\[object .+?Constructor\]$/,nN=Function.prototype,oN=Object.prototype,aN=nN.toString,lN=oN.hasOwnProperty,hN=RegExp("^"+aN.call(lN).replace(rN,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function cN(n){if(!Oa(n)||$D(n))return!1;var e=yv(n)?hN:sN;return e.test(iN(n))}function uN(n,e){return n==null?void 0:n[e]}function Wd(n,e){var t=uN(n,e);return cN(t)?t:void 0}var dN=Wd(Object,"create");const Da=dN;function fN(){this.__data__=Da?Da(null):{},this.size=0}function pN(n){var e=this.has(n)&&delete this.__data__[n];return this.size-=e?1:0,e}var gN="__lodash_hash_undefined__",mN=Object.prototype,_N=mN.hasOwnProperty;function vN(n){var e=this.__data__;if(Da){var t=e[n];return t===gN?void 0:t}return _N.call(e,n)?e[n]:void 0}var EN=Object.prototype,TN=EN.hasOwnProperty;function xN(n){var e=this.__data__;return Da?e[n]!==void 0:TN.call(e,n)}var CN="__lodash_hash_undefined__";function RN(n,e){var t=this.__data__;return this.size+=this.has(n)?0:1,t[n]=Da&&e===void 0?CN:e,this}function kn(n){var e=-1,t=n==null?0:n.length;for(this.clear();++e<t;){var i=n[e];this.set(i[0],i[1])}}kn.prototype.clear=fN;kn.prototype.delete=pN;kn.prototype.get=vN;kn.prototype.has=xN;kn.prototype.set=RN;function SN(){this.__data__=[],this.size=0}function Xd(n,e){return n===e||n!==n&&e!==e}function $h(n,e){for(var t=n.length;t--;)if(Xd(n[t][0],e))return t;return-1}var yN=Array.prototype,bN=yN.splice;function IN(n){var e=this.__data__,t=$h(e,n);if(t<0)return!1;var i=e.length-1;return t==i?e.pop():bN.call(e,t,1),--this.size,!0}function AN(n){var e=this.__data__,t=$h(e,n);return t<0?void 0:e[t][1]}function MN(n){return $h(this.__data__,n)>-1}function PN(n,e){var t=this.__data__,i=$h(t,n);return i<0?(++this.size,t.push([n,e])):t[i][1]=e,this}function Zo(n){var e=-1,t=n==null?0:n.length;for(this.clear();++e<t;){var i=n[e];this.set(i[0],i[1])}}Zo.prototype.clear=SN;Zo.prototype.delete=IN;Zo.prototype.get=AN;Zo.prototype.has=MN;Zo.prototype.set=PN;var ON=Wd(jh,"Map");const DN=ON;function NN(){this.size=0,this.__data__={hash:new kn,map:new(DN||Zo),string:new kn}}function FN(n){var e=typeof n;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?n!=="__proto__":n===null}function ec(n,e){var t=n.__data__;return FN(e)?t[typeof e=="string"?"string":"hash"]:t.map}function LN(n){var e=ec(this,n).delete(n);return this.size-=e?1:0,e}function wN(n){return ec(this,n).get(n)}function UN(n){return ec(this,n).has(n)}function VN(n,e){var t=ec(this,n),i=t.size;return t.set(n,e),this.size+=t.size==i?0:1,this}function Wn(n){var e=-1,t=n==null?0:n.length;for(this.clear();++e<t;){var i=n[e];this.set(i[0],i[1])}}Wn.prototype.clear=NN;Wn.prototype.delete=LN;Wn.prototype.get=wN;Wn.prototype.has=UN;Wn.prototype.set=VN;var BN="Expected a function";function Hd(n,e){if(typeof n!="function"||e!=null&&typeof e!="function")throw new TypeError(BN);var t=function(){var i=arguments,r=e?e.apply(this,i):i[0],s=t.cache;if(s.has(r))return s.get(r);var o=n.apply(this,i);return t.cache=s.set(r,o)||s,o};return t.cache=new(Hd.Cache||Wn),t}Hd.Cache=Wn;var kN=500;function zN(n){var e=Hd(n,function(i){return t.size===kN&&t.clear(),i}),t=e.cache;return e}var GN=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,WN=/\\(\\)?/g,XN=zN(function(n){var e=[];return n.charCodeAt(0)===46&&e.push(""),n.replace(GN,function(t,i,r,s){e.push(r?s.replace(WN,"$1"):i||t)}),e});const HN=XN;function KN(n,e){for(var t=-1,i=n==null?0:n.length,r=Array(i);++t<i;)r[t]=e(n[t],t,n);return r}var qN=1/0,Ug=Vo?Vo.prototype:void 0,Vg=Ug?Ug.toString:void 0;function bv(n){if(typeof n=="string")return n;if(el(n))return KN(n,bv)+"";if(Gd(n))return Vg?Vg.call(n):"";var e=n+"";return e=="0"&&1/n==-qN?"-0":e}function YN(n){return n==null?"":bv(n)}function Kd(n,e){return el(n)?n:qD(n,e)?[n]:HN(YN(n))}var ZN=1/0;function qd(n){if(typeof n=="string"||Gd(n))return n;var e=n+"";return e=="0"&&1/n==-ZN?"-0":e}function jN(n,e){e=Kd(e,n);for(var t=0,i=e.length;n!=null&&t<i;)n=n[qd(e[t++])];return t&&t==i?n:void 0}function Iv(n,e,t){var i=n==null?void 0:jN(n,e);return i===void 0?t:i}function QN(n){let e=[];return this.selected.forEach((t,i)=>{t instanceof He?e.push({node:t,value:Iv(t,n)}):console.log("Node not a mesh, skipping.")}),e}var Bg;(function(n){n[n.Clean=0]="Clean",n[n.Stop=1]="Stop",n[n.Sync=2]="Sync",n[n.NoSync=3]="NoSync"})(Bg||(Bg={}));new he;Oe.prototype._createDepthStencilCubeTexture=function(n,e){const t=new ur(this,Dt.DepthStencil);if(t.isCube=!0,this.webGLVersion===1)return oe.Error("Depth cube texture is not supported by WebGL 1."),t;const i={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...e},r=this._gl;this._bindTextureDirectly(r.TEXTURE_CUBE_MAP,t,!0),this._setupDepthStencilTexture(t,n,i.generateStencil,i.bilinearFiltering,i.comparisonFunction);for(let s=0;s<6;s++)i.generateStencil?r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,r.DEPTH24_STENCIL8,n,n,0,r.DEPTH_STENCIL,r.UNSIGNED_INT_24_8,null):r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,r.DEPTH_COMPONENT24,n,n,0,r.DEPTH_COMPONENT,r.UNSIGNED_INT,null);return this._bindTextureDirectly(r.TEXTURE_CUBE_MAP,null),this._internalTexturesCache.push(t),t};Oe.prototype._partialLoadFile=function(n,e,t,i,r=null){const s=a=>{t[e]=a,t._internalCount++,t._internalCount===6&&i(t)},o=(a,l)=>{r&&a&&r(a.status+" "+a.statusText,l)};this._loadFile(n,s,void 0,void 0,!0,o)};Oe.prototype._cascadeLoadFiles=function(n,e,t,i=null){const r=[];r._internalCount=0;for(let s=0;s<6;s++)this._partialLoadFile(t[s],s,r,e,i)};Oe.prototype._cascadeLoadImgs=function(n,e,t,i,r=null,s){const o=[];o._internalCount=0;for(let a=0;a<6;a++)this._partialLoadImg(i[a],a,o,n,e,t,r,s)};Oe.prototype._partialLoadImg=function(n,e,t,i,r,s,o=null,a){const l=pd();Ya(n,h=>{t[e]=h,t._internalCount++,i&&i.removePendingData(l),t._internalCount===6&&s&&s(r,t)},(h,c)=>{i&&i.removePendingData(l),o&&o(h,c)},i?i.offlineProvider:null,a),i&&i.addPendingData(l)};Oe.prototype._setCubeMapTextureParams=function(n,e,t){const i=this._gl;i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MIN_FILTER,e?i.LINEAR_MIPMAP_LINEAR:i.LINEAR),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),n.samplingMode=e?3:2,e&&this.getCaps().textureMaxLevel&&t!==void 0&&t>0&&(i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MAX_LEVEL,t),n._maxLodLevel=t),this._bindTextureDirectly(i.TEXTURE_CUBE_MAP,null)};Oe.prototype.createCubeTextureBase=function(n,e,t,i,r=null,s=null,o,a=null,l=!1,h=0,c=0,u=null,d=null,f=null,p=!1){const g=u||new ur(this,Dt.Cube);g.isCube=!0,g.url=n,g.generateMipMaps=!i,g._lodGenerationScale=h,g._lodGenerationOffset=c,g._useSRGBBuffer=!!p&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU||!!i),g!==u&&(g.label=n.substring(0,60)),this._doNotHandleContextLost||(g._extension=a,g._files=t);const m=n;this._transformTextureUrl&&!u&&(n=this._transformTextureUrl(n));const x=n.split("?")[0],E=x.lastIndexOf("."),R=a||(E>-1?x.substring(E).toLowerCase():"");let C=null;for(const T of Oe._TextureLoaders)if(T.canLoad(R)){C=T;break}const _=(T,y)=>{n===m?s&&T&&s(T.status+" "+T.statusText,y):(oe.Warn(`Failed to load ${n}, falling back to the ${m}`),this.createCubeTextureBase(m,e,t,!!i,r,s,o,a,l,h,c,g,d,f,p))};if(C){const T=y=>{d&&d(g,y),C.loadCubeData(y,g,l,r,s)};t&&t.length===6?C.supportCascades?this._cascadeLoadFiles(e,y=>T(y.map(P=>new Uint8Array(P))),t,s):s?s("Textures type does not support cascades."):oe.Warn("Texture loader does not support cascades."):this._loadFile(n,y=>T(new Uint8Array(y)),void 0,void 0,!0,_)}else{if(!t||t.length===0)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(e,g,(T,y)=>{f&&f(T,y)},t,s)}return this._internalTexturesCache.push(g),g};Oe.prototype.createCubeTexture=function(n,e,t,i,r=null,s=null,o,a=null,l=!1,h=0,c=0,u=null,d,f=!1){const p=this._gl;return this.createCubeTextureBase(n,e,t,!!i,r,s,o,a,l,h,c,u,g=>this._bindTextureDirectly(p.TEXTURE_CUBE_MAP,g,!0),(g,m)=>{const x=this.needPOTTextures?Oe.GetExponentOfTwo(m[0].width,this._caps.maxCubemapTextureSize):m[0].width,E=x,R=[p.TEXTURE_CUBE_MAP_POSITIVE_X,p.TEXTURE_CUBE_MAP_POSITIVE_Y,p.TEXTURE_CUBE_MAP_POSITIVE_Z,p.TEXTURE_CUBE_MAP_NEGATIVE_X,p.TEXTURE_CUBE_MAP_NEGATIVE_Y,p.TEXTURE_CUBE_MAP_NEGATIVE_Z];this._bindTextureDirectly(p.TEXTURE_CUBE_MAP,g,!0),this._unpackFlipY(!1);const C=o?this._getInternalFormat(o,g._useSRGBBuffer):g._useSRGBBuffer?this._glSRGBExtensionValues.SRGB8_ALPHA8:p.RGBA;let _=o?this._getInternalFormat(o):p.RGBA;g._useSRGBBuffer&&this.webGLVersion===1&&(_=C);for(let T=0;T<R.length;T++)if(m[T].width!==x||m[T].height!==E){if(this._prepareWorkingCanvas(),!this._workingCanvas||!this._workingContext){oe.Warn("Cannot create canvas to resize texture.");return}this._workingCanvas.width=x,this._workingCanvas.height=E,this._workingContext.drawImage(m[T],0,0,m[T].width,m[T].height,0,0,x,E),p.texImage2D(R[T],0,C,_,p.UNSIGNED_BYTE,this._workingCanvas)}else p.texImage2D(R[T],0,C,_,p.UNSIGNED_BYTE,m[T]);i||p.generateMipmap(p.TEXTURE_CUBE_MAP),this._setCubeMapTextureParams(g,!i),g.width=x,g.height=E,g.isReady=!0,o&&(g.format=o),g.onLoadedObservable.notifyObservers(g),g.onLoadedObservable.clear(),r&&r()},!!f)};class rr extends yt{set boundingBoxSize(e){if(this._boundingBoxSize&&this._boundingBoxSize.equals(e))return;this._boundingBoxSize=e;const t=this.getScene();t&&t.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(e){this._rotationY=e,this.setReflectionTextureMatrix(U.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(e,t,i){let r="";return e.forEach(s=>r+=s),new rr(r,t,null,i,e)}static CreateFromPrefilteredData(e,t,i=null,r=!0){const s=t.useDelayedTextureLoading;t.useDelayedTextureLoading=!1;const o=new rr(e,t,null,!1,null,null,null,void 0,!0,i,r);return t.useDelayedTextureLoading=s,o}constructor(e,t,i=null,r=!1,s=null,o=null,a=null,l=5,h=!1,c=null,u=!1,d=.8,f=0,p,g){var m;super(t),this._lodScale=.8,this._lodOffset=0,this.onLoadObservable=new he,this.boundingBoxPosition=v.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new U,this.name=e,this.url=e,this._noMipmap=r,this.hasAlpha=!1,this._format=l,this.isCube=!0,this._textureMatrix=U.Identity(),this._createPolynomials=u,this.coordinatesMode=le.CUBIC_MODE,this._extensions=i,this._files=s,this._forcedExtension=c,this._loaderOptions=p,this._useSRGBBuffer=g,this._lodScale=d,this._lodOffset=f,!(!e&&!s)&&this.updateURL(e,c,o,h,a,i,(m=this.getScene())==null?void 0:m.useDelayedTextureLoading,s)}getClassName(){return"CubeTexture"}updateURL(e,t,i=null,r=!1,s=null,o=null,a=!1,l=null){(!this.name||this.name.startsWith("data:"))&&(this.name=e),this.url=e,t&&(this._forcedExtension=t);const h=e.lastIndexOf("."),c=t||(h>-1?e.substring(h).toLowerCase():""),u=c.indexOf(".dds")===0,d=c.indexOf(".env")===0,f=c.indexOf(".basis")===0;if(d?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=r,r&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),l)this._files=l;else if(!f&&!d&&!u&&!o&&(o=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,o){for(let p=0;p<o.length;p++)this._files.push(e+o[p]);this._extensions=o}a?(this.delayLoadState=4,this._delayedOnLoad=i,this._delayedOnError=s):this._loadTexture(i,s)}delayLoad(e){this.delayLoadState===4&&(e&&(this._forcedExtension=e),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(e){var t,i;if(e.updateFlag===this._textureMatrix.updateFlag||(e.isIdentity()!==this._textureMatrix.isIdentity()&&((t=this.getScene())==null||t.markAllMaterialsAsDirty(1,a=>a.getActiveTextures().indexOf(this)!==-1)),this._textureMatrix=e,!((i=this.getScene())!=null&&i.useRightHandedSystem)))return;const r=W.Vector3[0],s=W.Quaternion[0],o=W.Vector3[1];this._textureMatrix.decompose(r,s,o),s.z*=-1,s.w*=-1,U.ComposeToRef(r,s,o,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var e;return(e=this.getScene())!=null&&e.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(e=null,t=null){var i;const r=this.getScene(),s=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const o=()=>{var l;this.onLoadObservable.notifyObservers(this),s&&(s.dispose(),(l=this.getScene())==null||l.markAllMaterialsAsDirty(1)),e&&e()},a=(l,h)=>{this._loadingError=!0,this._errorObject={message:l,exception:h},t&&t(l,h),le.OnTextureLoadErrorObservable.notifyObservers(this)};this._texture?this._texture.isReady?ge.SetImmediate(()=>o()):this._texture.onLoadedObservable.add(()=>o()):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,r,this._lodScale,this._lodOffset,e,a,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,r,this._files,this._noMipmap,e,a,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer),(i=this._texture)==null||i.onLoadedObservable.add(()=>this.onLoadObservable.notifyObservers(this)))}static Parse(e,t,i){const r=Le.Parse(()=>{let s=!1;return e.prefiltered&&(s=e.prefiltered),new rr(i+(e.url??e.name),t,e.extensions,!1,e.files||null,null,null,void 0,s,e.forcedExtension)},e,t);if(e.boundingBoxPosition&&(r.boundingBoxPosition=v.FromArray(e.boundingBoxPosition)),e.boundingBoxSize&&(r.boundingBoxSize=v.FromArray(e.boundingBoxSize)),e.animations)for(let s=0;s<e.animations.length;s++){const o=e.animations[s],a=Er("BABYLON.Animation");a&&r.animations.push(a.Parse(o))}return r}clone(){let e=0;const t=Le.Clone(()=>{const i=new rr(this.url,this.getScene()||this._getEngine(),this._extensions,this._noMipmap,this._files);return e=i.uniqueId,i},this);return t.uniqueId=e,t}}M([V()],rr.prototype,"url",void 0);M([mn()],rr.prototype,"boundingBoxPosition",void 0);M([mn()],rr.prototype,"boundingBoxSize",null);M([V("rotationY")],rr.prototype,"rotationY",null);M([V("files")],rr.prototype,"_files",void 0);M([V("forcedExtension")],rr.prototype,"_forcedExtension",void 0);M([V("extensions")],rr.prototype,"_extensions",void 0);M([h0("textureMatrix")],rr.prototype,"_textureMatrix",void 0);M([h0("textureMatrixRefraction")],rr.prototype,"_textureMatrixRefraction",void 0);le._CubeTextureParser=rr.Parse;ye("BABYLON.CubeTexture",rr);class vn{static ConvertPanoramaToCubemap(e,t,i,r,s=!1){if(!e)throw"ConvertPanoramaToCubemap: input cannot be null";if(e.length!=t*i*3)throw"ConvertPanoramaToCubemap: input size is wrong";const o=this.CreateCubemapTexture(r,this.FACE_FRONT,e,t,i,s),a=this.CreateCubemapTexture(r,this.FACE_BACK,e,t,i,s),l=this.CreateCubemapTexture(r,this.FACE_LEFT,e,t,i,s),h=this.CreateCubemapTexture(r,this.FACE_RIGHT,e,t,i,s),c=this.CreateCubemapTexture(r,this.FACE_UP,e,t,i,s),u=this.CreateCubemapTexture(r,this.FACE_DOWN,e,t,i,s);return{front:o,back:a,left:l,right:h,up:c,down:u,size:r,type:1,format:4,gammaSpace:!1}}static CreateCubemapTexture(e,t,i,r,s,o=!1){const a=new ArrayBuffer(e*e*4*3),l=new Float32Array(a),h=o?Math.max(1,Math.round(r/4/e)):1,c=1/h,u=c*c,d=t[1].subtract(t[0]).scale(c/e),f=t[3].subtract(t[2]).scale(c/e),p=1/e;let g=0;for(let m=0;m<e;m++)for(let x=0;x<h;x++){let E=t[0],R=t[2];for(let C=0;C<e;C++)for(let _=0;_<h;_++){const T=R.subtract(E).scale(g).add(E);T.normalize();const y=this.CalcProjectionSpherical(T,i,r,s);l[m*e*3+C*3+0]+=y.r*u,l[m*e*3+C*3+1]+=y.g*u,l[m*e*3+C*3+2]+=y.b*u,E=E.add(d),R=R.add(f)}g+=p*c}return l}static CalcProjectionSpherical(e,t,i,r){let s=Math.atan2(e.z,e.x);const o=Math.acos(e.y);for(;s<-Math.PI;)s+=2*Math.PI;for(;s>Math.PI;)s-=2*Math.PI;let a=s/Math.PI;const l=o/Math.PI;a=a*.5+.5;let h=Math.round(a*i);h<0?h=0:h>=i&&(h=i-1);let c=Math.round(l*r);c<0?c=0:c>=r&&(c=r-1);const u=r-c-1,d=t[u*i*3+h*3+0],f=t[u*i*3+h*3+1],p=t[u*i*3+h*3+2];return{r:d,g:f,b:p}}}vn.FACE_LEFT=[new v(-1,-1,-1),new v(1,-1,-1),new v(-1,1,-1),new v(1,1,-1)];vn.FACE_RIGHT=[new v(1,-1,1),new v(-1,-1,1),new v(1,1,1),new v(-1,1,1)];vn.FACE_FRONT=[new v(1,-1,-1),new v(1,-1,1),new v(1,1,-1),new v(1,1,1)];vn.FACE_BACK=[new v(-1,-1,1),new v(-1,-1,-1),new v(-1,1,1),new v(-1,1,-1)];vn.FACE_DOWN=[new v(1,1,-1),new v(1,1,1),new v(-1,1,-1),new v(-1,1,1)];vn.FACE_UP=[new v(-1,-1,-1),new v(-1,-1,1),new v(1,-1,-1),new v(1,-1,1)];class JN{static _Ldexp(e,t){return t>1023?e*Math.pow(2,1023)*Math.pow(2,t-1023):t<-1074?e*Math.pow(2,-1074)*Math.pow(2,t+1074):e*Math.pow(2,t)}static _Rgbe2float(e,t,i,r,s,o){s>0?(s=this._Ldexp(1,s-136),e[o+0]=t*s,e[o+1]=i*s,e[o+2]=r*s):(e[o+0]=0,e[o+1]=0,e[o+2]=0)}static _ReadStringLine(e,t){let i="",r="";for(let s=t;s<e.length-t&&(r=String.fromCharCode(e[s]),r!=`
`);s++)i+=r;return i}static RGBE_ReadHeader(e){let t=0,i=0,r=this._ReadStringLine(e,0);if(r[0]!="#"||r[1]!="?")throw"Bad HDR Format.";let s=!1,o=!1,a=0;do a+=r.length+1,r=this._ReadStringLine(e,a),r=="FORMAT=32-bit_rle_rgbe"?o=!0:r.length==0&&(s=!0);while(!s);if(!o)throw"HDR Bad header format, unsupported FORMAT";a+=r.length+1,r=this._ReadStringLine(e,a);const l=/^-Y (.*) \+X (.*)$/g.exec(r);if(!l||l.length<3)throw"HDR Bad header format, no size";if(i=parseInt(l[2]),t=parseInt(l[1]),i<8||i>32767)throw"HDR Bad header format, unsupported size";return a+=r.length+1,{height:t,width:i,dataPosition:a}}static GetCubeMapTextureData(e,t,i=!1){const r=new Uint8Array(e),s=this.RGBE_ReadHeader(r),o=this.RGBE_ReadPixels(r,s);return vn.ConvertPanoramaToCubemap(o,s.width,s.height,t,i)}static RGBE_ReadPixels(e,t){return this._RGBEReadPixelsRLE(e,t)}static _RGBEReadPixelsRLE(e,t){let i=t.height;const r=t.width;let s,o,a,l,h,c=t.dataPosition,u=0,d=0,f=0;const p=new ArrayBuffer(r*4),g=new Uint8Array(p),m=new ArrayBuffer(t.width*t.height*4*3),x=new Float32Array(m);for(;i>0;){if(s=e[c++],o=e[c++],a=e[c++],l=e[c++],s!=2||o!=2||a&128||t.width<8||t.width>32767)return this._RGBEReadPixelsNOTRLE(e,t);if((a<<8|l)!=r)throw"HDR Bad header format, wrong scan line width";for(u=0,f=0;f<4;f++)for(d=(f+1)*r;u<d;)if(s=e[c++],o=e[c++],s>128){if(h=s-128,h==0||h>d-u)throw"HDR Bad Format, bad scanline data (run)";for(;h-- >0;)g[u++]=o}else{if(h=s,h==0||h>d-u)throw"HDR Bad Format, bad scanline data (non-run)";if(g[u++]=o,--h>0)for(let E=0;E<h;E++)g[u++]=e[c++]}for(f=0;f<r;f++)s=g[f],o=g[f+r],a=g[f+2*r],l=g[f+3*r],this._Rgbe2float(x,s,o,a,l,(t.height-i)*r*3+f*3);i--}return x}static _RGBEReadPixelsNOTRLE(e,t){let i=t.height;const r=t.width;let s,o,a,l,h,c=t.dataPosition;const u=new ArrayBuffer(t.width*t.height*4*3),d=new Float32Array(u);for(;i>0;){for(h=0;h<t.width;h++)s=e[c++],o=e[c++],a=e[c++],l=e[c++],this._Rgbe2float(d,s,o,a,l,(t.height-i)*r*3+h*3);i--}return d}}const $N="hdrFilteringVertexShader",eF=`attribute vec2 position;varying vec3 direction;uniform vec3 up;uniform vec3 right;uniform vec3 front;
#define CUSTOM_VERTEX_DEFINITIONS
void main(void) {
#define CUSTOM_VERTEX_MAIN_BEGIN
mat3 view=mat3(up,right,front);direction=view*vec3(position,1.0);gl_Position=vec4(position,0.0,1.0);
#define CUSTOM_VERTEX_MAIN_END
}`;Y.ShadersStore[$N]=eF;const tF="hdrFilteringPixelShader",iF=`#include<helperFunctions>
#include<importanceSampling>
#include<pbrBRDFFunctions>
#include<hdrFilteringFunctions>
uniform float alphaG;uniform samplerCube inputTexture;uniform vec2 vFilteringInfo;uniform float hdrScale;varying vec3 direction;void main() {vec3 color=radiance(alphaG,inputTexture,direction,vFilteringInfo);gl_FragColor=vec4(color*hdrScale,1.0);}`;Y.ShadersStore[tF]=iF;class rF{constructor(e,t={}){this._lodGenerationOffset=0,this._lodGenerationScale=.8,this.quality=4096,this.hdrScale=1,this._engine=e,this.hdrScale=t.hdrScale||this.hdrScale,this.quality=t.quality||this.quality}_createRenderTarget(e){let t=0;this._engine.getCaps().textureHalfFloatRender?t=2:this._engine.getCaps().textureFloatRender&&(t=1);const i=this._engine.createRenderTargetCubeTexture(e,{format:5,type:t,createMipMaps:!0,generateMipMaps:!1,generateDepthBuffer:!1,generateStencilBuffer:!1,samplingMode:1});return this._engine.updateTextureWrappingMode(i.texture,0,0,0),this._engine.updateTextureSamplingMode(3,i.texture,!0),i}_prefilterInternal(e){const t=e.getSize().width,i=Ye.ILog2(t)+1,r=this._effectWrapper.effect,s=this._createRenderTarget(t);this._effectRenderer.saveStates(),this._effectRenderer.setViewport();const o=e.getInternalTexture();o&&this._engine.updateTextureSamplingMode(3,o,!0),this._effectRenderer.applyEffectWrapper(this._effectWrapper);const a=[[new v(0,0,-1),new v(0,-1,0),new v(1,0,0)],[new v(0,0,1),new v(0,-1,0),new v(-1,0,0)],[new v(1,0,0),new v(0,0,1),new v(0,1,0)],[new v(1,0,0),new v(0,0,-1),new v(0,-1,0)],[new v(1,0,0),new v(0,-1,0),new v(0,0,1)],[new v(-1,0,0),new v(0,-1,0),new v(0,0,-1)]];r.setFloat("hdrScale",this.hdrScale),r.setFloat2("vFilteringInfo",e.getSize().width,i),r.setTexture("inputTexture",e);for(let c=0;c<6;c++){r.setVector3("up",a[c][0]),r.setVector3("right",a[c][1]),r.setVector3("front",a[c][2]);for(let u=0;u<i;u++){this._engine.bindFramebuffer(s,c,void 0,void 0,!0,u),this._effectRenderer.applyEffectWrapper(this._effectWrapper);let d=Math.pow(2,(u-this._lodGenerationOffset)/this._lodGenerationScale)/t;u===0&&(d=0),r.setFloat("alphaG",d),this._effectRenderer.draw()}}this._effectRenderer.restoreStates(),this._engine.restoreDefaultFramebuffer(),this._engine._releaseTexture(e._texture);const l=s.texture.type,h=s.texture.format;return s._swapAndDie(e._texture),e._texture.type=l,e._texture.format=h,e.gammaSpace=!1,e.lodGenerationOffset=this._lodGenerationOffset,e.lodGenerationScale=this._lodGenerationScale,e._prefiltered=!0,e}_createEffect(e,t){const i=[];return e.gammaSpace&&i.push("#define GAMMA_INPUT"),i.push("#define NUM_SAMPLES "+this.quality+"u"),new I0({engine:this._engine,name:"hdrFiltering",vertexShader:"hdrFiltering",fragmentShader:"hdrFiltering",samplerNames:["inputTexture"],uniformNames:["vSampleDirections","vWeights","up","right","front","vFilteringInfo","hdrScale","alphaG"],useShaderStore:!0,defines:i,onCompiled:t})}isReady(e){return e.isReady()&&this._effectWrapper.effect.isReady()}prefilter(e,t=null){return this._engine._features.allowTexturePrefiltering?new Promise(i=>{this._effectRenderer=new b0(this._engine),this._effectWrapper=this._createEffect(e),this._effectWrapper.effect.executeWhenCompiled(()=>{this._prefilterInternal(e),this._effectRenderer.dispose(),this._effectWrapper.dispose(),i(),t&&t()})}):(oe.Warn("HDR prefiltering is not available in WebGL 1., you can use real time filtering instead."),Promise.reject("HDR prefiltering is not available in WebGL 1., you can use real time filtering instead."))}}class bo extends yt{set isBlocking(e){this._isBlocking=e}get isBlocking(){return this._isBlocking}set rotationY(e){this._rotationY=e,this.setReflectionTextureMatrix(U.RotationY(this._rotationY))}get rotationY(){return this._rotationY}set boundingBoxSize(e){if(this._boundingBoxSize&&this._boundingBoxSize.equals(e))return;this._boundingBoxSize=e;const t=this.getScene();t&&t.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}constructor(e,t,i,r=!1,s=!0,o=!1,a=!1,l=null,h=null,c=!1){var u;super(t),this._generateHarmonics=!0,this._onError=null,this._isBlocking=!0,this._rotationY=0,this.boundingBoxPosition=v.Zero(),this.onLoadObservable=new he,e&&(this._coordinatesMode=le.CUBIC_MODE,this.name=e,this.url=e,this.hasAlpha=!1,this.isCube=!0,this._textureMatrix=U.Identity(),this._prefilterOnLoad=a,this._onLoad=()=>{this.onLoadObservable.notifyObservers(this),l&&l()},this._onError=h,this.gammaSpace=o,this._noMipmap=r,this._size=i,this._supersample=c,this._generateHarmonics=s,this._texture=this._getFromCache(e,this._noMipmap,void 0,void 0,void 0,this.isCube),this._texture?this._texture.isReady?ge.SetImmediate(()=>this._onLoad()):this._texture.onLoadedObservable.add(this._onLoad):(u=this.getScene())!=null&&u.useDelayedTextureLoading?this.delayLoadState=4:this._loadTexture())}getClassName(){return"HDRCubeTexture"}_loadTexture(){const e=this._getEngine(),t=e.getCaps();let i=0;t.textureFloat&&t.textureFloatLinearFiltering?i=1:t.textureHalfFloat&&t.textureHalfFloatLinearFiltering&&(i=2);const r=s=>{this.lodGenerationOffset=0,this.lodGenerationScale=.8;const o=JN.GetCubeMapTextureData(s,this._size,this._supersample);if(this._generateHarmonics){const c=qo.ConvertCubeMapToSphericalPolynomial(o);this.sphericalPolynomial=c}const a=[];let l=null,h=null;for(let c=0;c<6;c++){i===2?h=new Uint16Array(this._size*this._size*3):i===0&&(l=new Uint8Array(this._size*this._size*3));const u=o[bo._FacesMapping[c]];if(this.gammaSpace||h||l){for(let d=0;d<this._size*this._size;d++)if(this.gammaSpace&&(u[d*3+0]=Math.pow(u[d*3+0],Yl),u[d*3+1]=Math.pow(u[d*3+1],Yl),u[d*3+2]=Math.pow(u[d*3+2],Yl)),h&&(h[d*3+0]=us(u[d*3+0]),h[d*3+1]=us(u[d*3+1]),h[d*3+2]=us(u[d*3+2])),l){let f=Math.max(u[d*3+0]*255,0),p=Math.max(u[d*3+1]*255,0),g=Math.max(u[d*3+2]*255,0);const m=Math.max(Math.max(f,p),g);if(m>255){const x=255/m;f*=x,p*=x,g*=x}l[d*3+0]=f,l[d*3+1]=p,l[d*3+2]=g}}h?a.push(h):l?a.push(l):a.push(u)}return a};if(e._features.allowTexturePrefiltering&&this._prefilterOnLoad){const s=this._onLoad,o=new rF(e);this._onLoad=()=>{o.prefilter(this,s)}}this._texture=e.createRawCubeTextureFromUrl(this.url,this.getScene(),this._size,4,i,this._noMipmap,r,null,this._onLoad,this._onError)}clone(){const e=new bo(this.url,this.getScene()||this._getEngine(),this._size,this._noMipmap,this._generateHarmonics,this.gammaSpace);return e.level=this.level,e.wrapU=this.wrapU,e.wrapV=this.wrapV,e.coordinatesIndex=this.coordinatesIndex,e.coordinatesMode=this.coordinatesMode,e}delayLoad(){this.delayLoadState===4&&(this.delayLoadState=1,this._texture=this._getFromCache(this.url,this._noMipmap),this._texture||this._loadTexture())}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(e){var t;this._textureMatrix=e,e.updateFlag!==this._textureMatrix.updateFlag&&e.isIdentity()!==this._textureMatrix.isIdentity()&&((t=this.getScene())==null||t.markAllMaterialsAsDirty(1,i=>i.getActiveTextures().indexOf(this)!==-1))}dispose(){this.onLoadObservable.clear(),super.dispose()}static Parse(e,t,i){let r=null;return e.name&&!e.isRenderTarget&&(r=new bo(i+e.name,t,e.size,e.noMipmap,e.generateHarmonics,e.useInGammaSpace),r.name=e.name,r.hasAlpha=e.hasAlpha,r.level=e.level,r.coordinatesMode=e.coordinatesMode,r.isBlocking=e.isBlocking),r&&(e.boundingBoxPosition&&(r.boundingBoxPosition=v.FromArray(e.boundingBoxPosition)),e.boundingBoxSize&&(r.boundingBoxSize=v.FromArray(e.boundingBoxSize)),e.rotationY&&(r.rotationY=e.rotationY)),r}serialize(){if(!this.name)return null;const e={};return e.name=this.name,e.hasAlpha=this.hasAlpha,e.isCube=!0,e.level=this.level,e.size=this._size,e.coordinatesMode=this.coordinatesMode,e.useInGammaSpace=this.gammaSpace,e.generateHarmonics=this._generateHarmonics,e.customType="BABYLON.HDRCubeTexture",e.noMipmap=this._noMipmap,e.isBlocking=this._isBlocking,e.rotationY=this._rotationY,e}}bo._FacesMapping=["right","left","up","down","front","back"];ye("BABYLON.HDRCubeTexture",bo);class vh extends yt{constructor(e,t,i,r=!1,s=!0,o=null,a=null,l=!1){if(super(t),this._onLoad=null,this._onError=null,!e)throw new Error("Image url is not set");this._coordinatesMode=le.CUBIC_MODE,this.name=e,this.url=e,this._size=i,this._supersample=l,this._noMipmap=r,this.gammaSpace=s,this._onLoad=o,this._onError=a,this.hasAlpha=!1,this.isCube=!0,this._texture=this._getFromCache(e,this._noMipmap,void 0,void 0,void 0,this.isCube),this._texture?o&&(this._texture.isReady?ge.SetImmediate(()=>o()):this._texture.onLoadedObservable.add(o)):t.useDelayedTextureLoading?this.delayLoadState=4:this._loadImage(()=>this._loadTexture(),this._onError)}_loadImage(e,t){const i=this.getScene();if(!i)return;const r=i.getEngine().createRawCubeTexture(null,this._size,4,i.getEngine().getCaps().textureFloat?1:7,this._noMipmap,!1,3);r.generateMipMaps=!this._noMipmap,i.addPendingData(r),r.url=this.url,r.isReady=!1,i.getEngine()._internalTexturesCache.push(r),this._texture=r;const s=document.createElement("canvas");Ya(this.url,o=>{this._width=o.width,this._height=o.height,s.width=this._width,s.height=this._height;const a=s.getContext("2d");a.drawImage(o,0,0);const l=a.getImageData(0,0,o.width,o.height);this._buffer=l.data.buffer,s.remove(),e()},(o,a)=>{i.removePendingData(r),t&&t(`${this.getClassName()} could not be loaded`,a)},i?i.offlineProvider:null)}_loadTexture(){const e=this.getScene(),t=()=>{const s=this._getFloat32ArrayFromArrayBuffer(this._buffer),o=vn.ConvertPanoramaToCubemap(s,this._width,this._height,this._size,this._supersample),a=[];for(let l=0;l<6;l++){const h=o[vh._FacesMapping[l]];a.push(h)}return a};if(!e)return;const i=t(),r=this._texture;e.getEngine().updateRawCubeTexture(r,i,r.format,r.type,r.invertY),r.isReady=!0,e.removePendingData(r),r.onLoadedObservable.notifyObservers(r),r.onLoadedObservable.clear(),this._onLoad&&this._onLoad()}_getFloat32ArrayFromArrayBuffer(e){const t=new DataView(e),i=new Float32Array(e.byteLength*3/4);let r=0;for(let s=0;s<e.byteLength;s++)(s+1)%4!==0&&(i[r++]=t.getUint8(s)/255);return i}getClassName(){return"EquiRectangularCubeTexture"}clone(){const e=this.getScene();if(!e)return this;const t=new vh(this.url,e,this._size,this._noMipmap,this.gammaSpace);return t.level=this.level,t.wrapU=this.wrapU,t.wrapV=this.wrapV,t.coordinatesIndex=this.coordinatesIndex,t.coordinatesMode=this.coordinatesMode,t}}vh._FacesMapping=["right","left","up","down","front","back"];var kg;(function(n){n[n.INIT=0]="INIT",n[n.RUNNING=1]="RUNNING",n[n.DONE=2]="DONE",n[n.ERROR=3]="ERROR"})(kg||(kg={}));var zg;(function(n){n[n.cTFETC1=0]="cTFETC1",n[n.cTFETC2=1]="cTFETC2",n[n.cTFBC1=2]="cTFBC1",n[n.cTFBC3=3]="cTFBC3",n[n.cTFBC4=4]="cTFBC4",n[n.cTFBC5=5]="cTFBC5",n[n.cTFBC7=6]="cTFBC7",n[n.cTFPVRTC1_4_RGB=8]="cTFPVRTC1_4_RGB",n[n.cTFPVRTC1_4_RGBA=9]="cTFPVRTC1_4_RGBA",n[n.cTFASTC_4x4=10]="cTFASTC_4x4",n[n.cTFATC_RGB=11]="cTFATC_RGB",n[n.cTFATC_RGBA_INTERPOLATED_ALPHA=12]="cTFATC_RGBA_INTERPOLATED_ALPHA",n[n.cTFRGBA32=13]="cTFRGBA32",n[n.cTFRGB565=14]="cTFRGB565",n[n.cTFBGR565=15]="cTFBGR565",n[n.cTFRGBA4444=16]="cTFRGBA4444",n[n.cTFFXT1_RGB=17]="cTFFXT1_RGB",n[n.cTFPVRTC2_4_RGB=18]="cTFPVRTC2_4_RGB",n[n.cTFPVRTC2_4_RGBA=19]="cTFPVRTC2_4_RGBA",n[n.cTFETC2_EAC_R11=20]="cTFETC2_EAC_R11",n[n.cTFETC2_EAC_RG11=21]="cTFETC2_EAC_RG11"})(zg||(zg={}));`${ge._DefaultCdnUrl}`,`${ge._DefaultCdnUrl}`;const sF=542327876,Gg=131072,Wg=512,Xg=4,Hg=64,Kg=131072;function tc(n){return n.charCodeAt(0)+(n.charCodeAt(1)<<8)+(n.charCodeAt(2)<<16)+(n.charCodeAt(3)<<24)}function nF(n){return String.fromCharCode(n&255,n>>8&255,n>>16&255,n>>24&255)}const qg=tc("DXT1"),Yg=tc("DXT3"),Zg=tc("DXT5"),su=tc("DX10"),jg=113,Qg=116,Jg=2,$g=10,oF=88,nu=31,aF=0,lF=1,em=2,tm=3,ou=4,im=7,au=20,rm=21,hF=22,cF=23,uF=24,dF=25,fF=26,pF=28,gF=32;class Lt{static GetDDSInfo(e){const t=new Int32Array(e.buffer,e.byteOffset,nu),i=new Int32Array(e.buffer,e.byteOffset,nu+4);let r=1;t[em]&Gg&&(r=Math.max(1,t[im]));const s=t[rm],o=s===su?i[gF]:0;let a=0;switch(s){case jg:a=2;break;case Qg:a=1;break;case su:if(o===$g){a=2;break}if(o===Jg){a=1;break}}return{width:t[ou],height:t[tm],mipmapCount:r,isFourCC:(t[au]&Xg)===Xg,isRGB:(t[au]&Hg)===Hg,isLuminance:(t[au]&Kg)===Kg,isCube:(t[pF]&Wg)===Wg,isCompressed:s===qg||s===Yg||s===Zg,dxgiFormat:o,textureType:a}}static _GetHalfFloatAsFloatRGBAArrayBuffer(e,t,i,r,s,o){const a=new Float32Array(r),l=new Uint16Array(s,i);let h=0;for(let c=0;c<t;c++)for(let u=0;u<e;u++){const d=(u+c*e)*4;a[h]=Ns(l[d]),a[h+1]=Ns(l[d+1]),a[h+2]=Ns(l[d+2]),Lt.StoreLODInAlphaChannel?a[h+3]=o:a[h+3]=Ns(l[d+3]),h+=4}return a}static _GetHalfFloatRGBAArrayBuffer(e,t,i,r,s,o){if(Lt.StoreLODInAlphaChannel){const a=new Uint16Array(r),l=new Uint16Array(s,i);let h=0;for(let c=0;c<t;c++)for(let u=0;u<e;u++){const d=(u+c*e)*4;a[h]=l[d],a[h+1]=l[d+1],a[h+2]=l[d+2],a[h+3]=us(o),h+=4}return a}return new Uint16Array(s,i,r)}static _GetFloatRGBAArrayBuffer(e,t,i,r,s,o){if(Lt.StoreLODInAlphaChannel){const a=new Float32Array(r),l=new Float32Array(s,i);let h=0;for(let c=0;c<t;c++)for(let u=0;u<e;u++){const d=(u+c*e)*4;a[h]=l[d],a[h+1]=l[d+1],a[h+2]=l[d+2],a[h+3]=o,h+=4}return a}return new Float32Array(s,i,r)}static _GetFloatAsHalfFloatRGBAArrayBuffer(e,t,i,r,s,o){const a=new Uint16Array(r),l=new Float32Array(s,i);let h=0;for(let c=0;c<t;c++)for(let u=0;u<e;u++)a[h]=us(l[h]),a[h+1]=us(l[h+1]),a[h+2]=us(l[h+2]),Lt.StoreLODInAlphaChannel?a[h+3]=us(o):a[h+3]=us(l[h+3]),h+=4;return a}static _GetFloatAsUIntRGBAArrayBuffer(e,t,i,r,s,o){const a=new Uint8Array(r),l=new Float32Array(s,i);let h=0;for(let c=0;c<t;c++)for(let u=0;u<e;u++){const d=(u+c*e)*4;a[h]=Ye.Clamp(l[d])*255,a[h+1]=Ye.Clamp(l[d+1])*255,a[h+2]=Ye.Clamp(l[d+2])*255,Lt.StoreLODInAlphaChannel?a[h+3]=o:a[h+3]=Ye.Clamp(l[d+3])*255,h+=4}return a}static _GetHalfFloatAsUIntRGBAArrayBuffer(e,t,i,r,s,o){const a=new Uint8Array(r),l=new Uint16Array(s,i);let h=0;for(let c=0;c<t;c++)for(let u=0;u<e;u++){const d=(u+c*e)*4;a[h]=Ye.Clamp(Ns(l[d]))*255,a[h+1]=Ye.Clamp(Ns(l[d+1]))*255,a[h+2]=Ye.Clamp(Ns(l[d+2]))*255,Lt.StoreLODInAlphaChannel?a[h+3]=o:a[h+3]=Ye.Clamp(Ns(l[d+3]))*255,h+=4}return a}static _GetRGBAArrayBuffer(e,t,i,r,s,o,a,l,h){const c=new Uint8Array(r),u=new Uint8Array(s,i);let d=0;for(let f=0;f<t;f++)for(let p=0;p<e;p++){const g=(p+f*e)*4;c[d]=u[g+o],c[d+1]=u[g+a],c[d+2]=u[g+l],c[d+3]=u[g+h],d+=4}return c}static _ExtractLongWordOrder(e){return e===0||e===255||e===-16777216?0:1+Lt._ExtractLongWordOrder(e>>8)}static _GetRGBArrayBuffer(e,t,i,r,s,o,a,l){const h=new Uint8Array(r),c=new Uint8Array(s,i);let u=0;for(let d=0;d<t;d++)for(let f=0;f<e;f++){const p=(f+d*e)*3;h[u]=c[p+o],h[u+1]=c[p+a],h[u+2]=c[p+l],u+=3}return h}static _GetLuminanceArrayBuffer(e,t,i,r,s){const o=new Uint8Array(r),a=new Uint8Array(s,i);let l=0;for(let h=0;h<t;h++)for(let c=0;c<e;c++){const u=c+h*e;o[l]=a[u],l++}return o}static UploadDDSLevels(e,t,i,r,s,o,a=-1,l,h=!0){let c=null;r.sphericalPolynomial&&(c=[]);const u=!!e.getCaps().s3tc;t.generateMipMaps=s;const d=new Int32Array(i.buffer,i.byteOffset,nu);let f,p,g,m=0,x,E,R,C,_=0,T=1;if(d[aF]!==sF){oe.Error("Invalid magic number in DDS header");return}if(!r.isFourCC&&!r.isRGB&&!r.isLuminance){oe.Error("Unsupported format, must contain a FourCC, RGB or LUMINANCE code");return}if(r.isCompressed&&!u){oe.Error("Compressed textures are not supported on this platform.");return}let y=d[hF];x=d[lF]+4;let P=!1;if(r.isFourCC)switch(f=d[rm],f){case qg:T=8,_=33777;break;case Yg:T=16,_=33778;break;case Zg:T=16,_=33779;break;case jg:P=!0,y=64;break;case Qg:P=!0,y=128;break;case su:{x+=5*4;let z=!1;switch(r.dxgiFormat){case $g:P=!0,y=64,z=!0;break;case Jg:P=!0,y=128,z=!0;break;case oF:r.isRGB=!0,r.isFourCC=!1,y=32,z=!0;break}if(z)break}default:oe.Error(["Unsupported FourCC code:",nF(f)]);return}const D=Lt._ExtractLongWordOrder(d[cF]),F=Lt._ExtractLongWordOrder(d[uF]),N=Lt._ExtractLongWordOrder(d[dF]),G=Lt._ExtractLongWordOrder(d[fF]);P&&(_=e._getRGBABufferInternalSizedFormat(r.textureType)),R=1,d[em]&Gg&&s!==!1&&(R=Math.max(1,d[im]));const J=l||0,j=e.getCaps();for(let z=J;z<o;z++){for(p=d[ou],g=d[tm],C=0;C<R;++C){if(a===-1||a===C){const $=a===-1?C:0;if(!r.isCompressed&&r.isFourCC){t.format=5,m=p*g*4;let te=null;if(e._badOS||e._badDesktopOS||!j.textureHalfFloat&&!j.textureFloat)y===128?(te=Lt._GetFloatAsUIntRGBAArrayBuffer(p,g,i.byteOffset+x,m,i.buffer,$),c&&$==0&&c.push(Lt._GetFloatRGBAArrayBuffer(p,g,i.byteOffset+x,m,i.buffer,$))):y===64&&(te=Lt._GetHalfFloatAsUIntRGBAArrayBuffer(p,g,i.byteOffset+x,m,i.buffer,$),c&&$==0&&c.push(Lt._GetHalfFloatAsFloatRGBAArrayBuffer(p,g,i.byteOffset+x,m,i.buffer,$))),t.type=0;else{const fe=j.textureFloat&&(h&&j.textureFloatLinearFiltering||!h),Z=j.textureHalfFloat&&(h&&j.textureHalfFloatLinearFiltering||!h),L=(y===128||y===64&&!Z)&&fe?1:(y===64||y===128&&!fe)&&Z?2:0;let w,H=null;switch(y){case 128:{switch(L){case 1:w=Lt._GetFloatRGBAArrayBuffer,H=null;break;case 2:w=Lt._GetFloatAsHalfFloatRGBAArrayBuffer,H=Lt._GetFloatRGBAArrayBuffer;break;case 0:w=Lt._GetFloatAsUIntRGBAArrayBuffer,H=Lt._GetFloatRGBAArrayBuffer;break}break}default:{switch(L){case 1:w=Lt._GetHalfFloatAsFloatRGBAArrayBuffer,H=null;break;case 2:w=Lt._GetHalfFloatRGBAArrayBuffer,H=Lt._GetHalfFloatAsFloatRGBAArrayBuffer;break;case 0:w=Lt._GetHalfFloatAsUIntRGBAArrayBuffer,H=Lt._GetHalfFloatAsFloatRGBAArrayBuffer;break}break}}t.type=L,te=w(p,g,i.byteOffset+x,m,i.buffer,$),c&&$==0&&c.push(H?H(p,g,i.byteOffset+x,m,i.buffer,$):te)}te&&e._uploadDataToTextureDirectly(t,te,z,$)}else if(r.isRGB)t.type=0,y===24?(t.format=4,m=p*g*3,E=Lt._GetRGBArrayBuffer(p,g,i.byteOffset+x,m,i.buffer,D,F,N),e._uploadDataToTextureDirectly(t,E,z,$)):(t.format=5,m=p*g*4,E=Lt._GetRGBAArrayBuffer(p,g,i.byteOffset+x,m,i.buffer,D,F,N,G),e._uploadDataToTextureDirectly(t,E,z,$));else if(r.isLuminance){const te=e._getUnpackAlignement(),fe=p;m=Math.floor((p+te-1)/te)*te*(g-1)+fe,E=Lt._GetLuminanceArrayBuffer(p,g,i.byteOffset+x,m,i.buffer),t.format=1,t.type=0,e._uploadDataToTextureDirectly(t,E,z,$)}else m=Math.max(4,p)/4*Math.max(4,g)/4*T,E=new Uint8Array(i.buffer,i.byteOffset+x,m),t.type=0,e._uploadCompressedDataToTextureDirectly(t,_,p,g,E,z,$)}x+=y?p*g*(y/8):m,p*=.5,g*=.5,p=Math.max(1,p),g=Math.max(1,g)}if(l!==void 0)break}c&&c.length>0?r.sphericalPolynomial=qo.ConvertCubeMapToSphericalPolynomial({size:d[ou],right:c[0],left:c[1],up:c[2],down:c[3],front:c[4],back:c[5],format:5,type:1,gammaSpace:!1}):r.sphericalPolynomial=void 0}}Lt.StoreLODInAlphaChannel=!1;Oe.prototype.createPrefilteredCubeTexture=function(n,e,t,i,r=null,s=null,o,a=null,l=!0){const h=c=>{if(!c){r&&r(null);return}const u=c.texture;if(l?c.info.sphericalPolynomial&&(u._sphericalPolynomial=c.info.sphericalPolynomial):u._sphericalPolynomial=new Aa,u._source=Dt.CubePrefiltered,this.getCaps().textureLOD){r&&r(u);return}const d=3,f=this._gl,p=c.width;if(!p)return;const g=[];for(let m=0;m<d;m++){const x=1-m/(d-1),E=i,R=Ye.Log2(p)*t+i,C=E+(R-E)*x,_=Math.round(Math.min(Math.max(C,0),R)),T=new ur(this,Dt.Temp);if(T.type=u.type,T.format=u.format,T.width=Math.pow(2,Math.max(Ye.Log2(p)-_,0)),T.height=T.width,T.isCube=!0,T._cachedWrapU=0,T._cachedWrapV=0,this._bindTextureDirectly(f.TEXTURE_CUBE_MAP,T,!0),T.samplingMode=2,f.texParameteri(f.TEXTURE_CUBE_MAP,f.TEXTURE_MAG_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_CUBE_MAP,f.TEXTURE_MIN_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_CUBE_MAP,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_CUBE_MAP,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE),c.isDDS){const P=c.info,D=c.data;this._unpackFlipY(P.isCompressed),Lt.UploadDDSLevels(this,T,D,P,!0,6,_)}else oe.Warn("DDS is the only prefiltered cube map supported so far.");this._bindTextureDirectly(f.TEXTURE_CUBE_MAP,null);const y=new yt(e);y._isCube=!0,y._texture=T,T.isReady=!0,g.push(y)}u._lodTextureHigh=g[2],u._lodTextureMid=g[1],u._lodTextureLow=g[0],r&&r(u)};return this.createCubeTexture(n,e,null,!1,h,s,o,a,l,t,i)};const mF="rgbdEncodePixelShader",_F=`varying vec2 vUV;uniform sampler2D textureSampler;
#include<helperFunctions>
#define CUSTOM_FRAGMENT_DEFINITIONS
void main(void) 
{gl_FragColor=toRGBD(texture2D(textureSampler,vUV).rgb);}`;Y.ShadersStore[mF]=_F;he.prototype.notifyObserversWithPromise=async function(n,e=-1,t,i,r){let s=Promise.resolve(n);if(!this.observers.length)return s;const o=this._eventState;return o.mask=e,o.target=t,o.currentTarget=i,o.skipNextObservers=!1,o.userInfo=r,this.observers.forEach(a=>{o.skipNextObservers||a._willBeUnregistered||a.mask&e&&(a.scope?s=s.then(l=>(o.lastReturnValue=l,a.callback.apply(a.scope,[n,o]))):s=s.then(l=>(o.lastReturnValue=l,a.callback(n,o))),a.unregisterOnNextCall&&this._deferUnregister(a))}),await s,n};var sm;(function(n){n[n.X=0]="X",n[n.Y=1]="Y",n[n.Z=2]="Z"})(sm||(sm={}));const vF="fxaaPixelShader",EF=`#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)
#define TEXTUREFUNC(s,c,l) texture2DLodEXT(s,c,l)
#else
#define TEXTUREFUNC(s,c,b) texture2D(s,c,b)
#endif
uniform sampler2D textureSampler;uniform vec2 texelSize;varying vec2 vUV;varying vec2 sampleCoordS;varying vec2 sampleCoordE;varying vec2 sampleCoordN;varying vec2 sampleCoordW;varying vec2 sampleCoordNW;varying vec2 sampleCoordSE;varying vec2 sampleCoordNE;varying vec2 sampleCoordSW;const float fxaaQualitySubpix=1.0;const float fxaaQualityEdgeThreshold=0.166;const float fxaaQualityEdgeThresholdMin=0.0833;const vec3 kLumaCoefficients=vec3(0.2126,0.7152,0.0722);
#define FxaaLuma(rgba) dot(rgba.rgb,kLumaCoefficients)
void main(){vec2 posM;posM.x=vUV.x;posM.y=vUV.y;vec4 rgbyM=TEXTUREFUNC(textureSampler,vUV,0.0);float lumaM=FxaaLuma(rgbyM);float lumaS=FxaaLuma(TEXTUREFUNC(textureSampler,sampleCoordS,0.0));float lumaE=FxaaLuma(TEXTUREFUNC(textureSampler,sampleCoordE,0.0));float lumaN=FxaaLuma(TEXTUREFUNC(textureSampler,sampleCoordN,0.0));float lumaW=FxaaLuma(TEXTUREFUNC(textureSampler,sampleCoordW,0.0));float maxSM=max(lumaS,lumaM);float minSM=min(lumaS,lumaM);float maxESM=max(lumaE,maxSM);float minESM=min(lumaE,minSM);float maxWN=max(lumaN,lumaW);float minWN=min(lumaN,lumaW);float rangeMax=max(maxWN,maxESM);float rangeMin=min(minWN,minESM);float rangeMaxScaled=rangeMax*fxaaQualityEdgeThreshold;float range=rangeMax-rangeMin;float rangeMaxClamped=max(fxaaQualityEdgeThresholdMin,rangeMaxScaled);
#ifndef MALI
if(range<rangeMaxClamped) 
{gl_FragColor=rgbyM;return;}
#endif
float lumaNW=FxaaLuma(TEXTUREFUNC(textureSampler,sampleCoordNW,0.0));float lumaSE=FxaaLuma(TEXTUREFUNC(textureSampler,sampleCoordSE,0.0));float lumaNE=FxaaLuma(TEXTUREFUNC(textureSampler,sampleCoordNE,0.0));float lumaSW=FxaaLuma(TEXTUREFUNC(textureSampler,sampleCoordSW,0.0));float lumaNS=lumaN+lumaS;float lumaWE=lumaW+lumaE;float subpixRcpRange=1.0/range;float subpixNSWE=lumaNS+lumaWE;float edgeHorz1=(-2.0*lumaM)+lumaNS;float edgeVert1=(-2.0*lumaM)+lumaWE;float lumaNESE=lumaNE+lumaSE;float lumaNWNE=lumaNW+lumaNE;float edgeHorz2=(-2.0*lumaE)+lumaNESE;float edgeVert2=(-2.0*lumaN)+lumaNWNE;float lumaNWSW=lumaNW+lumaSW;float lumaSWSE=lumaSW+lumaSE;float edgeHorz4=(abs(edgeHorz1)*2.0)+abs(edgeHorz2);float edgeVert4=(abs(edgeVert1)*2.0)+abs(edgeVert2);float edgeHorz3=(-2.0*lumaW)+lumaNWSW;float edgeVert3=(-2.0*lumaS)+lumaSWSE;float edgeHorz=abs(edgeHorz3)+edgeHorz4;float edgeVert=abs(edgeVert3)+edgeVert4;float subpixNWSWNESE=lumaNWSW+lumaNESE;float lengthSign=texelSize.x;bool horzSpan=edgeHorz>=edgeVert;float subpixA=subpixNSWE*2.0+subpixNWSWNESE;if (!horzSpan)
{lumaN=lumaW;}
if (!horzSpan) 
{lumaS=lumaE;}
if (horzSpan) 
{lengthSign=texelSize.y;}
float subpixB=(subpixA*(1.0/12.0))-lumaM;float gradientN=lumaN-lumaM;float gradientS=lumaS-lumaM;float lumaNN=lumaN+lumaM;float lumaSS=lumaS+lumaM;bool pairN=abs(gradientN)>=abs(gradientS);float gradient=max(abs(gradientN),abs(gradientS));if (pairN)
{lengthSign=-lengthSign;}
float subpixC=clamp(abs(subpixB)*subpixRcpRange,0.0,1.0);vec2 posB;posB.x=posM.x;posB.y=posM.y;vec2 offNP;offNP.x=(!horzSpan) ? 0.0 : texelSize.x;offNP.y=(horzSpan) ? 0.0 : texelSize.y;if (!horzSpan) 
{posB.x+=lengthSign*0.5;}
if (horzSpan)
{posB.y+=lengthSign*0.5;}
vec2 posN;posN.x=posB.x-offNP.x*1.5;posN.y=posB.y-offNP.y*1.5;vec2 posP;posP.x=posB.x+offNP.x*1.5;posP.y=posB.y+offNP.y*1.5;float subpixD=((-2.0)*subpixC)+3.0;float lumaEndN=FxaaLuma(TEXTUREFUNC(textureSampler,posN,0.0));float subpixE=subpixC*subpixC;float lumaEndP=FxaaLuma(TEXTUREFUNC(textureSampler,posP,0.0));if (!pairN) 
{lumaNN=lumaSS;}
float gradientScaled=gradient*1.0/4.0;float lumaMM=lumaM-lumaNN*0.5;float subpixF=subpixD*subpixE;bool lumaMLTZero=lumaMM<0.0;lumaEndN-=lumaNN*0.5;lumaEndP-=lumaNN*0.5;bool doneN=abs(lumaEndN)>=gradientScaled;bool doneP=abs(lumaEndP)>=gradientScaled;if (!doneN) 
{posN.x-=offNP.x*3.0;}
if (!doneN) 
{posN.y-=offNP.y*3.0;}
bool doneNP=(!doneN) || (!doneP);if (!doneP) 
{posP.x+=offNP.x*3.0;}
if (!doneP)
{posP.y+=offNP.y*3.0;}
if (doneNP)
{if (!doneN) lumaEndN=FxaaLuma(TEXTUREFUNC(textureSampler,posN.xy,0.0));if (!doneP) lumaEndP=FxaaLuma(TEXTUREFUNC(textureSampler,posP.xy,0.0));if (!doneN) lumaEndN=lumaEndN-lumaNN*0.5;if (!doneP) lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if (!doneN) posN.x-=offNP.x*12.0;if (!doneN) posN.y-=offNP.y*12.0;doneNP=(!doneN) || (!doneP);if (!doneP) posP.x+=offNP.x*12.0;if (!doneP) posP.y+=offNP.y*12.0;}
float dstN=posM.x-posN.x;float dstP=posP.x-posM.x;if (!horzSpan)
{dstN=posM.y-posN.y;}
if (!horzSpan) 
{dstP=posP.y-posM.y;}
bool goodSpanN=(lumaEndN<0.0) != lumaMLTZero;float spanLength=(dstP+dstN);bool goodSpanP=(lumaEndP<0.0) != lumaMLTZero;float spanLengthRcp=1.0/spanLength;bool directionN=dstN<dstP;float dst=min(dstN,dstP);bool goodSpan=directionN ? goodSpanN : goodSpanP;float subpixG=subpixF*subpixF;float pixelOffset=(dst*(-spanLengthRcp))+0.5;float subpixH=subpixG*fxaaQualitySubpix;float pixelOffsetGood=goodSpan ? pixelOffset : 0.0;float pixelOffsetSubpix=max(pixelOffsetGood,subpixH);if (!horzSpan)
{posM.x+=pixelOffsetSubpix*lengthSign;}
if (horzSpan)
{posM.y+=pixelOffsetSubpix*lengthSign;}
#ifdef MALI
if(range<rangeMaxClamped) 
{gl_FragColor=rgbyM;}
else
{gl_FragColor=TEXTUREFUNC(textureSampler,posM,0.0);}
#else
gl_FragColor=TEXTUREFUNC(textureSampler,posM,0.0);
#endif
}`;Y.ShadersStore[vF]=EF;const TF="fxaaVertexShader",xF=`attribute vec2 position;uniform vec2 texelSize;varying vec2 vUV;varying vec2 sampleCoordS;varying vec2 sampleCoordE;varying vec2 sampleCoordN;varying vec2 sampleCoordW;varying vec2 sampleCoordNW;varying vec2 sampleCoordSE;varying vec2 sampleCoordNE;varying vec2 sampleCoordSW;const vec2 madd=vec2(0.5,0.5);
#define CUSTOM_VERTEX_DEFINITIONS
void main(void) {
#define CUSTOM_VERTEX_MAIN_BEGIN
vUV=(position*madd+madd);sampleCoordS=vUV+vec2( 0.0,1.0)*texelSize;sampleCoordE=vUV+vec2( 1.0,0.0)*texelSize;sampleCoordN=vUV+vec2( 0.0,-1.0)*texelSize;sampleCoordW=vUV+vec2(-1.0,0.0)*texelSize;sampleCoordNW=vUV+vec2(-1.0,-1.0)*texelSize;sampleCoordSE=vUV+vec2( 1.0,1.0)*texelSize;sampleCoordNE=vUV+vec2( 1.0,-1.0)*texelSize;sampleCoordSW=vUV+vec2(-1.0,1.0)*texelSize;gl_Position=vec4(position,0.0,1.0);
#define CUSTOM_VERTEX_MAIN_END
}`;Y.ShadersStore[TF]=xF;class ic extends Mt{getClassName(){return"FxaaPostProcess"}constructor(e,t,i=null,r,s,o,a=0){super(e,"fxaa",["texelSize"],null,t,i,r||le.BILINEAR_SAMPLINGMODE,s,o,null,a,"fxaa",void 0,!0);const l=this._getDefines();this.updateEffect(l),this.onApplyObservable.add(h=>{const c=this.texelSize;h.setFloat2("texelSize",c.x,c.y)})}_getDefines(){const e=this.getEngine();if(!e)return null;const t=e.getGlInfo();return t&&t.renderer&&t.renderer.toLowerCase().indexOf("mali")>-1?`#define MALI 1
`:null}static _Parse(e,t,i,r){return Le.Parse(()=>new ic(e.name,e.options,t,e.renderTargetSamplingMode,i.getEngine(),e.reusable),e,i,r)}}ye("BABYLON.FxaaPostProcess",ic);let en=null;function Av(n,e,t,i,r="image/png",s=!1,o){const{height:a,width:l}=Mv(n,e,t);if(!(a&&l)){oe.Error("Invalid 'size' parameter !");return}en||(en=document.createElement("canvas")),en.width=l,en.height=a;const h=en.getContext("2d"),c=n.getRenderWidth()/n.getRenderHeight();let u=l,d=u/c;d>a&&(d=a,u=d*c);const f=Math.max(0,l-u)/2,p=Math.max(0,a-d)/2;e.getScene().activeCamera!==e?Yd(n,e,t,g=>{if(s){const m=new Blob([g]);ge.DownloadBlob(m),i&&i("")}else i&&i(g)},r,1,n.getCreationOptions().antialias,void 0,void 0,void 0,void 0,o):n.onEndFrameObservable.addOnce(()=>{const g=n.getRenderingCanvas();h&&g&&h.drawImage(g,f,p,u,d),en&&(s?(ge.EncodeScreenshotCanvasData(en,void 0,r,void 0,o),i&&i("")):ge.EncodeScreenshotCanvasData(en,i,r,void 0,o))})}function CF(n,e,t,i="image/png",r){return new Promise((s,o)=>{Av(n,e,t,a=>{typeof a<"u"?s(a):o(new Error("Data is undefined"))},i,void 0,r)})}function Yd(n,e,t,i,r="image/png",s=1,o=!1,a,l=!1,h=!1,c=!0,u,d){const{height:f,width:p,finalWidth:g,finalHeight:m}=Mv(n,e,t),x={width:p,height:f};if(!(f&&p)){oe.Error("Invalid 'size' parameter !");return}const E={width:n.getRenderWidth(),height:n.getRenderHeight()};n.setSize(p,f);const R=e.getScene(),C=new vr("screenShot",x,R,!1,!1,0,!1,le.BILINEAR_SAMPLINGMODE,void 0,h,void 0,void 0,void 0,s);C.renderList=R.meshes.slice(),C.samples=s,C.renderSprites=l,C.activeCamera=e,C.forceLayerMaskCheck=c,d==null||d(C);const _=()=>{C.isReadyForRendering()&&e.isReady(!0)?(n.onEndFrameObservable.addOnce(()=>{g===p&&m===f?C.readPixels(void 0,void 0,void 0,!1).then(y=>{wi.DumpData(p,f,y,i,r,a,!0,void 0,u),C.dispose()}):Ld("pass",C.getInternalTexture(),R,void 0,void 0,void 0,g,m).then(y=>{n._readTexturePixels(y,g,m,-1,0,null,!0,!1,0,0).then(P=>{wi.DumpData(g,m,P,i,r,a,!0,void 0,u),y.dispose()})})}),C.render(!0),R.incrementRenderId(),R.resetCachedMaterial(),n.setSize(E.width,E.height),e.getProjectionMatrix(!0),R.render()):setTimeout(_,16)},T=()=>{R.incrementRenderId(),R.resetCachedMaterial(),_()};if(o){const y=new ic("antialiasing",1,R.activeCamera);C.addPostProcess(y),y.getEffect().isReady()?T():y.getEffect().onCompiled=()=>{T()}}else T()}function RF(n,e,t,i="image/png",r=1,s=!1,o,a=!1,l=!1,h=!0,c){return new Promise((u,d)=>{Yd(n,e,t,f=>{typeof f<"u"?u(f):d(new Error("Data is undefined"))},i,r,s,o,a,l,h,c)})}function Mv(n,e,t){let i=0,r=0,s=0,o=0;if(typeof t=="object"){const a=t.precision?Math.abs(t.precision):1;t.width&&t.height?(i=t.height*a,r=t.width*a):t.width&&!t.height?(r=t.width*a,i=Math.round(r/n.getAspectRatio(e))):t.height&&!t.width?(i=t.height*a,r=Math.round(i*n.getAspectRatio(e))):(r=Math.round(n.getRenderWidth()*a),i=Math.round(r/n.getAspectRatio(e))),t.finalWidth&&t.finalHeight?(o=t.finalHeight,s=t.finalWidth):t.finalWidth&&!t.finalHeight?(s=t.finalWidth,o=Math.round(s/n.getAspectRatio(e))):t.finalHeight&&!t.finalWidth?(o=t.finalHeight,s=Math.round(o*n.getAspectRatio(e))):(s=r,o=i)}else isNaN(t)||(i=t,r=t,s=t,o=t);return r&&(r=Math.floor(r)),i&&(i=Math.floor(i)),s&&(s=Math.floor(s)),o&&(o=Math.floor(o)),{height:i|0,width:r|0,finalWidth:s|0,finalHeight:o|0}}const SF=()=>{ge.CreateScreenshot=Av,ge.CreateScreenshotAsync=CF,ge.CreateScreenshotUsingRenderTarget=Yd,ge.CreateScreenshotUsingRenderTargetAsync=RF};SF();var nm;(function(n){n[n.Checkbox=0]="Checkbox",n[n.Slider=1]="Slider",n[n.Vector3=2]="Vector3",n[n.Quaternion=3]="Quaternion",n[n.Color3=4]="Color3",n[n.String=5]="String",n[n.Button=6]="Button",n[n.Options=7]="Options",n[n.Tab=8]="Tab",n[n.FileButton=9]="FileButton",n[n.Vector2=10]="Vector2"})(nm||(nm={}));const yF="minmaxReduxPixelShader",bF=`varying vec2 vUV;uniform sampler2D textureSampler;
#if defined(INITIAL)
uniform sampler2D sourceTexture;uniform vec2 texSize;void main(void)
{ivec2 coord=ivec2(vUV*(texSize-1.0));float f1=texelFetch(sourceTexture,coord,0).r;float f2=texelFetch(sourceTexture,coord+ivec2(1,0),0).r;float f3=texelFetch(sourceTexture,coord+ivec2(1,1),0).r;float f4=texelFetch(sourceTexture,coord+ivec2(0,1),0).r;float minz=min(min(min(f1,f2),f3),f4);
#ifdef DEPTH_REDUX
float maxz=max(max(max(sign(1.0-f1)*f1,sign(1.0-f2)*f2),sign(1.0-f3)*f3),sign(1.0-f4)*f4);
#else
float maxz=max(max(max(f1,f2),f3),f4);
#endif
glFragColor=vec4(minz,maxz,0.,0.);}
#elif defined(MAIN)
uniform vec2 texSize;void main(void)
{ivec2 coord=ivec2(vUV*(texSize-1.0));vec2 f1=texelFetch(textureSampler,coord,0).rg;vec2 f2=texelFetch(textureSampler,coord+ivec2(1,0),0).rg;vec2 f3=texelFetch(textureSampler,coord+ivec2(1,1),0).rg;vec2 f4=texelFetch(textureSampler,coord+ivec2(0,1),0).rg;float minz=min(min(min(f1.x,f2.x),f3.x),f4.x);float maxz=max(max(max(f1.y,f2.y),f3.y),f4.y);glFragColor=vec4(minz,maxz,0.,0.);}
#elif defined(ONEBEFORELAST)
uniform ivec2 texSize;void main(void)
{ivec2 coord=ivec2(vUV*vec2(texSize-1));vec2 f1=texelFetch(textureSampler,coord % texSize,0).rg;vec2 f2=texelFetch(textureSampler,(coord+ivec2(1,0)) % texSize,0).rg;vec2 f3=texelFetch(textureSampler,(coord+ivec2(1,1)) % texSize,0).rg;vec2 f4=texelFetch(textureSampler,(coord+ivec2(0,1)) % texSize,0).rg;float minz=min(f1.x,f2.x);float maxz=max(f1.y,f2.y);glFragColor=vec4(minz,maxz,0.,0.);}
#elif defined(LAST)
void main(void)
{glFragColor=vec4(0.);if (true) { 
discard;}}
#endif
`;Y.ShadersStore[yF]=bF;const IF="packingFunctions",AF=`vec4 pack(float depth)
{const vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const vec4 bit_mask=vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
float unpack(vec4 color)
{const vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(color,bit_shift);}`;Y.IncludesShadersStore[IF]=AF;const MF="depthPixelShader",PF=`#ifdef ALPHATEST
varying vec2 vUV;uniform sampler2D diffuseSampler;
#endif
#include<clipPlaneFragmentDeclaration>
varying float vDepthMetric;
#ifdef PACKED
#include<packingFunctions>
#endif
#ifdef STORE_CAMERASPACE_Z
varying vec4 vViewPos;
#endif
#define CUSTOM_FRAGMENT_DEFINITIONS
void main(void)
{
#include<clipPlaneFragment>
#ifdef ALPHATEST
if (texture2D(diffuseSampler,vUV).a<0.4)
discard;
#endif
#ifdef STORE_CAMERASPACE_Z
#ifdef PACKED
gl_FragColor=pack(vViewPos.z);
#else
gl_FragColor=vec4(vViewPos.z,0.0,0.0,1.0);
#endif
#else
#ifdef NONLINEARDEPTH
#ifdef PACKED
gl_FragColor=pack(gl_FragCoord.z);
#else
gl_FragColor=vec4(gl_FragCoord.z,0.0,0.0,0.0);
#endif
#else
#ifdef PACKED
gl_FragColor=pack(vDepthMetric);
#else
gl_FragColor=vec4(vDepthMetric,0.0,0.0,1.0);
#endif
#endif
#endif
}`;Y.ShadersStore[MF]=PF;const OF="pointCloudVertexDeclaration",DF=`#ifdef POINTSIZE
uniform float pointSize;
#endif
`;Y.IncludesShadersStore[OF]=DF;const NF="depthVertexShader",FF=`attribute vec3 position;
#include<bonesDeclaration>
#include<bakedVertexAnimationDeclaration>
#include<morphTargetsVertexGlobalDeclaration>
#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]
#include<clipPlaneVertexDeclaration>
#include<instancesDeclaration>
uniform mat4 viewProjection;uniform vec2 depthValues;
#if defined(ALPHATEST) || defined(NEED_UV)
varying vec2 vUV;uniform mat4 diffuseMatrix;
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#endif
#ifdef STORE_CAMERASPACE_Z
uniform mat4 view;varying vec4 vViewPos;
#endif
#include<pointCloudVertexDeclaration>
varying float vDepthMetric;
#define CUSTOM_VERTEX_DEFINITIONS
void main(void)
{vec3 positionUpdated=position;
#ifdef UV1
vec2 uvUpdated=uv;
#endif
#include<morphTargetsVertexGlobal>
#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]
#include<instancesVertex>
#include<bonesVertex>
#include<bakedVertexAnimation>
vec4 worldPos=finalWorld*vec4(positionUpdated,1.0);
#include<clipPlaneVertex>
gl_Position=viewProjection*worldPos;
#ifdef STORE_CAMERASPACE_Z
vViewPos=view*worldPos;
#else
#ifdef USE_REVERSE_DEPTHBUFFER
vDepthMetric=((-gl_Position.z+depthValues.x)/(depthValues.y));
#else
vDepthMetric=((gl_Position.z+depthValues.x)/(depthValues.y));
#endif
#endif
#if defined(ALPHATEST) || defined(BASIC_RENDER)
#ifdef UV1
vUV=vec2(diffuseMatrix*vec4(uvUpdated,1.0,0.0));
#endif
#ifdef UV2
vUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));
#endif
#endif
#include<pointCloudVertex>
}
`;Y.ShadersStore[NF]=FF;class om{static _GetStorage(){try{return localStorage.setItem("test",""),localStorage.removeItem("test"),localStorage}catch{const e={};return{getItem:t=>{const i=e[t];return i===void 0?null:i},setItem:(t,i)=>{e[t]=i}}}}static ReadString(e,t){const i=this._Storage.getItem(e);return i!==null?i:t}static WriteString(e,t){this._Storage.setItem(e,t)}static ReadBoolean(e,t){const i=this._Storage.getItem(e);return i!==null?i==="true":t}static WriteBoolean(e,t){this._Storage.setItem(e,t?"true":"false")}static ReadNumber(e,t){const i=this._Storage.getItem(e);return i!==null?parseFloat(i):t}static WriteNumber(e,t){this._Storage.setItem(e,t.toString())}}om._Storage=om._GetStorage();class et extends Oi{get range(){return this._range}set range(e){this._range=e,this._inverseSquaredRange=1/(this.range*this.range)}get intensityMode(){return this._intensityMode}set intensityMode(e){this._intensityMode=e,this._computePhotometricScale()}get radius(){return this._radius}set radius(e){this._radius=e,this._computePhotometricScale()}get shadowEnabled(){return this._shadowEnabled}set shadowEnabled(e){this._shadowEnabled!==e&&(this._shadowEnabled=e,this._markMeshesAsLightDirty())}get includedOnlyMeshes(){return this._includedOnlyMeshes}set includedOnlyMeshes(e){this._includedOnlyMeshes=e,this._hookArrayForIncludedOnly(e)}get excludedMeshes(){return this._excludedMeshes}set excludedMeshes(e){this._excludedMeshes=e,this._hookArrayForExcluded(e)}get excludeWithLayerMask(){return this._excludeWithLayerMask}set excludeWithLayerMask(e){this._excludeWithLayerMask=e,this._resyncMeshes()}get includeOnlyWithLayerMask(){return this._includeOnlyWithLayerMask}set includeOnlyWithLayerMask(e){this._includeOnlyWithLayerMask=e,this._resyncMeshes()}get lightmapMode(){return this._lightmapMode}set lightmapMode(e){this._lightmapMode!==e&&(this._lightmapMode=e,this._markMeshesAsLightDirty())}getViewMatrix(e){return null}getProjectionMatrix(e,t){return null}constructor(e,t){super(e,t),this.diffuse=new De(1,1,1),this.specular=new De(1,1,1),this.falloffType=et.FALLOFF_DEFAULT,this.intensity=1,this._range=Number.MAX_VALUE,this._inverseSquaredRange=0,this._photometricScale=1,this._intensityMode=et.INTENSITYMODE_AUTOMATIC,this._radius=1e-5,this.renderPriority=0,this._shadowEnabled=!0,this._excludeWithLayerMask=0,this._includeOnlyWithLayerMask=0,this._lightmapMode=0,this._shadowGenerators=null,this._excludedMeshesIds=new Array,this._includedOnlyMeshesIds=new Array,this._isLight=!0,this.getScene().addLight(this),this._uniformBuffer=new Ie(this.getScene().getEngine(),void 0,void 0,e),this._buildUniformLayout(),this.includedOnlyMeshes=[],this.excludedMeshes=[],this._resyncMeshes()}transferTexturesToEffect(e,t){return this}_bindLight(e,t,i,r,s=!0){const o=e.toString();let a=!1;if(this._uniformBuffer.bindToEffect(i,"Light"+o),this._renderId!==t.getRenderId()||this._lastUseSpecular!==r||!this._uniformBuffer.useUbo){this._renderId=t.getRenderId(),this._lastUseSpecular=r;const l=this.getScaledIntensity();this.transferToEffect(i,o),this.diffuse.scaleToRef(l,Qr.Color3[0]),this._uniformBuffer.updateColor4("vLightDiffuse",Qr.Color3[0],this.range,o),r&&(this.specular.scaleToRef(l,Qr.Color3[1]),this._uniformBuffer.updateColor4("vLightSpecular",Qr.Color3[1],this.radius,o)),a=!0}if(this.transferTexturesToEffect(i,o),t.shadowsEnabled&&this.shadowEnabled&&s){const l=this.getShadowGenerator(t.activeCamera)??this.getShadowGenerator();l&&(l.bindShadowLight(o,i),a=!0)}a?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()}getClassName(){return"Light"}toString(e){let t="Name: "+this.name;if(t+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(let i=0;i<this.animations.length;i++)t+=", animation[0]: "+this.animations[i].toString(e);return t}_syncParentEnabledState(){super._syncParentEnabledState(),this.isDisposed()||this._resyncMeshes()}setEnabled(e){super.setEnabled(e),this._resyncMeshes()}getShadowGenerator(e=null){return this._shadowGenerators===null?null:this._shadowGenerators.get(e)??null}getShadowGenerators(){return this._shadowGenerators}getAbsolutePosition(){return v.Zero()}canAffectMesh(e){return e?!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&this.includedOnlyMeshes.indexOf(e)===-1||this.excludedMeshes&&this.excludedMeshes.length>0&&this.excludedMeshes.indexOf(e)!==-1||this.includeOnlyWithLayerMask!==0&&!(this.includeOnlyWithLayerMask&e.layerMask)||this.excludeWithLayerMask!==0&&this.excludeWithLayerMask&e.layerMask):!0}dispose(e,t=!1){if(this._shadowGenerators){const i=this._shadowGenerators.values();for(let r=i.next();r.done!==!0;r=i.next())r.value.dispose();this._shadowGenerators=null}if(this.getScene().stopAnimation(this),this._parentContainer){const i=this._parentContainer.lights.indexOf(this);i>-1&&this._parentContainer.lights.splice(i,1),this._parentContainer=null}for(const i of this.getScene().meshes)i._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.getScene().removeLight(this),super.dispose(e,t)}getTypeID(){return 0}getScaledIntensity(){return this._photometricScale*this.intensity}clone(e,t=null){const i=et.GetConstructorFromName(this.getTypeID(),e,this.getScene());if(!i)return null;const r=Le.Clone(i,this);return e&&(r.name=e),t&&(r.parent=t),r.setEnabled(this.isEnabled()),this.onClonedObservable.notifyObservers(r),r}serialize(){const e=Le.Serialize(this);return e.uniqueId=this.uniqueId,e.type=this.getTypeID(),this.parent&&this.parent._serializeAsParent(e),this.excludedMeshes.length>0&&(e.excludedMeshesIds=[],this.excludedMeshes.forEach(t=>{e.excludedMeshesIds.push(t.id)})),this.includedOnlyMeshes.length>0&&(e.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach(t=>{e.includedOnlyMeshesIds.push(t.id)})),Le.AppendSerializedAnimations(this,e),e.ranges=this.serializeAnimationRanges(),e.isEnabled=this.isEnabled(),e}static GetConstructorFromName(e,t,i){return Oi.Construct("Light_Type_"+e,t,i)||null}static Parse(e,t){const i=et.GetConstructorFromName(e.type,e.name,t);if(!i)return null;const r=Le.Parse(i,e,t);if(e.excludedMeshesIds&&(r._excludedMeshesIds=e.excludedMeshesIds),e.includedOnlyMeshesIds&&(r._includedOnlyMeshesIds=e.includedOnlyMeshesIds),e.parentId!==void 0&&(r._waitingParentId=e.parentId),e.parentInstanceIndex!==void 0&&(r._waitingParentInstanceIndex=e.parentInstanceIndex),e.falloffType!==void 0&&(r.falloffType=e.falloffType),e.lightmapMode!==void 0&&(r.lightmapMode=e.lightmapMode),e.animations){for(let s=0;s<e.animations.length;s++){const o=e.animations[s],a=Er("BABYLON.Animation");a&&r.animations.push(a.Parse(o))}Oi.ParseAnimationRanges(r,e,t)}return e.autoAnimate&&t.beginAnimation(r,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),e.isEnabled!==void 0&&r.setEnabled(e.isEnabled),r}_hookArrayForExcluded(e){const t=e.push;e.push=(...r)=>{const s=t.apply(e,r);for(const o of r)o._resyncLightSource(this);return s};const i=e.splice;e.splice=(r,s)=>{const o=i.apply(e,[r,s]);for(const a of o)a._resyncLightSource(this);return o};for(const r of e)r._resyncLightSource(this)}_hookArrayForIncludedOnly(e){const t=e.push;e.push=(...r)=>{const s=t.apply(e,r);return this._resyncMeshes(),s};const i=e.splice;e.splice=(r,s)=>{const o=i.apply(e,[r,s]);return this._resyncMeshes(),o},this._resyncMeshes()}_resyncMeshes(){for(const e of this.getScene().meshes)e._resyncLightSource(this)}_markMeshesAsLightDirty(){for(const e of this.getScene().meshes)e.lightSources.indexOf(this)!==-1&&e._markSubMeshesAsLightDirty()}_computePhotometricScale(){this._photometricScale=this._getPhotometricScale(),this.getScene().resetCachedMaterial()}_getPhotometricScale(){let e=0;const t=this.getTypeID();let i=this.intensityMode;switch(i===et.INTENSITYMODE_AUTOMATIC&&(t===et.LIGHTTYPEID_DIRECTIONALLIGHT?i=et.INTENSITYMODE_ILLUMINANCE:i=et.INTENSITYMODE_LUMINOUSINTENSITY),t){case et.LIGHTTYPEID_POINTLIGHT:case et.LIGHTTYPEID_SPOTLIGHT:switch(i){case et.INTENSITYMODE_LUMINOUSPOWER:e=1/(4*Math.PI);break;case et.INTENSITYMODE_LUMINOUSINTENSITY:e=1;break;case et.INTENSITYMODE_LUMINANCE:e=this.radius*this.radius;break}break;case et.LIGHTTYPEID_DIRECTIONALLIGHT:switch(i){case et.INTENSITYMODE_ILLUMINANCE:e=1;break;case et.INTENSITYMODE_LUMINANCE:{let r=this.radius;r=Math.max(r,.001),e=2*Math.PI*(1-Math.cos(r));break}}break;case et.LIGHTTYPEID_HEMISPHERICLIGHT:e=1;break}return e}_reorderLightsInScene(){const e=this.getScene();this._renderPriority!=0&&(e.requireLightSorting=!0),this.getScene().sortLightsByPriority()}}et.FALLOFF_DEFAULT=mt.FALLOFF_DEFAULT;et.FALLOFF_PHYSICAL=mt.FALLOFF_PHYSICAL;et.FALLOFF_GLTF=mt.FALLOFF_GLTF;et.FALLOFF_STANDARD=mt.FALLOFF_STANDARD;et.LIGHTMAP_DEFAULT=mt.LIGHTMAP_DEFAULT;et.LIGHTMAP_SPECULAR=mt.LIGHTMAP_SPECULAR;et.LIGHTMAP_SHADOWSONLY=mt.LIGHTMAP_SHADOWSONLY;et.INTENSITYMODE_AUTOMATIC=mt.INTENSITYMODE_AUTOMATIC;et.INTENSITYMODE_LUMINOUSPOWER=mt.INTENSITYMODE_LUMINOUSPOWER;et.INTENSITYMODE_LUMINOUSINTENSITY=mt.INTENSITYMODE_LUMINOUSINTENSITY;et.INTENSITYMODE_ILLUMINANCE=mt.INTENSITYMODE_ILLUMINANCE;et.INTENSITYMODE_LUMINANCE=mt.INTENSITYMODE_LUMINANCE;et.LIGHTTYPEID_POINTLIGHT=mt.LIGHTTYPEID_POINTLIGHT;et.LIGHTTYPEID_DIRECTIONALLIGHT=mt.LIGHTTYPEID_DIRECTIONALLIGHT;et.LIGHTTYPEID_SPOTLIGHT=mt.LIGHTTYPEID_SPOTLIGHT;et.LIGHTTYPEID_HEMISPHERICLIGHT=mt.LIGHTTYPEID_HEMISPHERICLIGHT;M([sr()],et.prototype,"diffuse",void 0);M([sr()],et.prototype,"specular",void 0);M([V()],et.prototype,"falloffType",void 0);M([V()],et.prototype,"intensity",void 0);M([V()],et.prototype,"range",null);M([V()],et.prototype,"intensityMode",null);M([V()],et.prototype,"radius",null);M([V()],et.prototype,"_renderPriority",void 0);M([ae("_reorderLightsInScene")],et.prototype,"renderPriority",void 0);M([V("shadowEnabled")],et.prototype,"_shadowEnabled",void 0);M([V("excludeWithLayerMask")],et.prototype,"_excludeWithLayerMask",void 0);M([V("includeOnlyWithLayerMask")],et.prototype,"_includeOnlyWithLayerMask",void 0);M([V("lightmapMode")],et.prototype,"_lightmapMode",void 0);class Gt extends Oi{get _matrix(){return this._compose(),this._localMatrix}set _matrix(e){e.updateFlag===this._localMatrix.updateFlag&&!this._needToCompose||(this._needToCompose=!1,this._localMatrix.copyFrom(e),this._markAsDirtyAndDecompose())}constructor(e,t,i=null,r=null,s=null,o=null,a=null){super(e,t.getScene()),this.name=e,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=t,this._localMatrix=(r==null?void 0:r.clone())??U.Identity(),this._restMatrix=s??this._localMatrix.clone(),this._bindMatrix=o??this._localMatrix.clone(),this._index=a,this._absoluteMatrix=new U,this._absoluteBindMatrix=new U,this._absoluteInverseBindMatrix=new U,this._finalMatrix=new U,t.bones.push(this),this.setParent(i,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return this._index===null?this.getSkeleton().bones.indexOf(this):this._index}set parent(e){this.setParent(e)}setParent(e,t=!0){if(this.parent!==e){if(this.parent){const i=this.parent.children.indexOf(this);i!==-1&&this.parent.children.splice(i,1)}this._parentNode=e,this.parent&&this.parent.children.push(this),t&&this._updateAbsoluteBindMatrices(),this.markAsDirty()}}getLocalMatrix(){return this._compose(),this._localMatrix}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(e){this._restMatrix.copyFrom(e)}setRestPose(e){this.setRestMatrix(e)}getBindPose(){return this.getBindMatrix()}setBindMatrix(e){this.updateMatrix(e)}setBindPose(e){this.setBindMatrix(e)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const e=W.Vector3[0],t=W.Quaternion[0],i=W.Vector3[1];this.getRestMatrix().decompose(e,t,i),this._linkedTransformNode.position.copyFrom(i),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??Re.Identity(),this._linkedTransformNode.rotationQuaternion.copyFrom(t),this._linkedTransformNode.scaling.copyFrom(e)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(e){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=e,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this._localPosition}set position(e){this._decompose(),this._localPosition.copyFrom(e),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(e){this.setRotation(e)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(e){this.setRotationQuaternion(e)}get scaling(){return this.getScale()}set scaling(e){this.setScale(e)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=v.Zero(),this._localRotation=Re.Zero(),this._localPosition=v.Zero()),this._localMatrix.decompose(this._localScaling,this._localRotation,this._localPosition))}_compose(){if(this._needToCompose){if(!this._localScaling){this._needToCompose=!1;return}this._needToCompose=!1,U.ComposeToRef(this._localScaling,this._localRotation,this._localPosition,this._localMatrix)}}updateMatrix(e,t=!0,i=!0){this._bindMatrix.copyFrom(e),t&&this._updateAbsoluteBindMatrices(),i?this._matrix=e:this.markAsDirty()}_updateAbsoluteBindMatrices(e,t=!0){if(e||(e=this._bindMatrix),this.parent?e.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.copyFrom(e),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),t)for(let i=0;i<this.children.length;i++)this.children[i]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}markAsDirty(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.markAsDirty(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.markAsDirty(),this._needToDecompose=!0}_updatePosition(e,t=ht.LOCAL,i,r=!0){const s=this.getLocalMatrix();if(t==ht.LOCAL)r?(s.addAtIndex(12,e.x),s.addAtIndex(13,e.y),s.addAtIndex(14,e.z)):s.setTranslationFromFloats(e.x,e.y,e.z);else{let o=null;i&&(o=i.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const a=Gt._TmpMats[0],l=Gt._TmpVecs[0];this.parent?i&&o?(a.copyFrom(this.parent.getAbsoluteMatrix()),a.multiplyToRef(o,a)):a.copyFrom(this.parent.getAbsoluteMatrix()):U.IdentityToRef(a),r&&a.setTranslationFromFloats(0,0,0),a.invert(),v.TransformCoordinatesToRef(e,a,l),r?(s.addAtIndex(12,l.x),s.addAtIndex(13,l.y),s.addAtIndex(14,l.z)):s.setTranslationFromFloats(l.x,l.y,l.z)}this._markAsDirtyAndDecompose()}translate(e,t=ht.LOCAL,i){this._updatePosition(e,t,i,!0)}setPosition(e,t=ht.LOCAL,i){this._updatePosition(e,t,i,!1)}setAbsolutePosition(e,t){this.setPosition(e,ht.WORLD,t)}scale(e,t,i,r=!1){const s=this.getLocalMatrix(),o=Gt._TmpMats[0];U.ScalingToRef(e,t,i,o),o.multiplyToRef(s,s),o.invert();for(const a of this.children){const l=a.getLocalMatrix();l.multiplyToRef(o,l),l.multiplyAtIndex(12,e),l.multiplyAtIndex(13,t),l.multiplyAtIndex(14,i),a._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),r)for(const a of this.children)a.scale(e,t,i,r)}setScale(e){this._decompose(),this._localScaling.copyFrom(e),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(e){this._decompose(),e.copyFrom(this._localScaling)}setYawPitchRoll(e,t,i,r=ht.LOCAL,s){if(r===ht.LOCAL){const l=Gt._TmpQuat;Re.RotationYawPitchRollToRef(e,t,i,l),this.setRotationQuaternion(l,r,s);return}const o=Gt._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(o,s))return;const a=Gt._TmpMats[1];U.RotationYawPitchRollToRef(e,t,i,a),o.multiplyToRef(a,a),this._rotateWithMatrix(a,r,s)}rotate(e,t,i=ht.LOCAL,r){const s=Gt._TmpMats[0];s.setTranslationFromFloats(0,0,0),U.RotationAxisToRef(e,t,s),this._rotateWithMatrix(s,i,r)}setAxisAngle(e,t,i=ht.LOCAL,r){if(i===ht.LOCAL){const a=Gt._TmpQuat;Re.RotationAxisToRef(e,t,a),this.setRotationQuaternion(a,i,r);return}const s=Gt._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(s,r))return;const o=Gt._TmpMats[1];U.RotationAxisToRef(e,t,o),s.multiplyToRef(o,o),this._rotateWithMatrix(o,i,r)}setRotation(e,t=ht.LOCAL,i){this.setYawPitchRoll(e.y,e.x,e.z,t,i)}setRotationQuaternion(e,t=ht.LOCAL,i){if(t===ht.LOCAL){this._decompose(),this._localRotation.copyFrom(e),this._markAsDirtyAndCompose();return}const r=Gt._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(r,i))return;const s=Gt._TmpMats[1];U.FromQuaternionToRef(e,s),r.multiplyToRef(s,s),this._rotateWithMatrix(s,t,i)}setRotationMatrix(e,t=ht.LOCAL,i){if(t===ht.LOCAL){const o=Gt._TmpQuat;Re.FromRotationMatrixToRef(e,o),this.setRotationQuaternion(o,t,i);return}const r=Gt._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(r,i))return;const s=Gt._TmpMats[1];s.copyFrom(e),r.multiplyToRef(e,s),this._rotateWithMatrix(s,t,i)}_rotateWithMatrix(e,t=ht.LOCAL,i){const r=this.getLocalMatrix(),s=r.m[12],o=r.m[13],a=r.m[14],l=this.getParent(),h=Gt._TmpMats[3],c=Gt._TmpMats[4];l&&t==ht.WORLD?(i?(h.copyFrom(i.getWorldMatrix()),l.getAbsoluteMatrix().multiplyToRef(h,h)):h.copyFrom(l.getAbsoluteMatrix()),c.copyFrom(h),c.invert(),r.multiplyToRef(h,r),r.multiplyToRef(e,r),r.multiplyToRef(c,r)):t==ht.WORLD&&i?(h.copyFrom(i.getWorldMatrix()),c.copyFrom(h),c.invert(),r.multiplyToRef(h,r),r.multiplyToRef(e,r),r.multiplyToRef(c,r)):r.multiplyToRef(e,r),r.setTranslationFromFloats(s,o,a),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(e,t){const i=Gt._TmpMats[2];return e.copyFrom(this.getAbsoluteMatrix()),t?(e.multiplyToRef(t.getWorldMatrix(),e),U.ScalingToRef(t.scaling.x,t.scaling.y,t.scaling.z,i)):U.IdentityToRef(i),e.invert(),isNaN(e.m[0])?!1:(i.multiplyAtIndex(0,this._scalingDeterminant),e.multiplyToRef(i,e),!0)}getPosition(e=ht.LOCAL,t=null){const i=v.Zero();return this.getPositionToRef(e,t,i),i}getPositionToRef(e=ht.LOCAL,t,i){if(e==ht.LOCAL){const r=this.getLocalMatrix();i.x=r.m[12],i.y=r.m[13],i.z=r.m[14]}else{let r=null;t&&(r=t.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let s=Gt._TmpMats[0];t&&r?(s.copyFrom(this.getAbsoluteMatrix()),s.multiplyToRef(r,s)):s=this.getAbsoluteMatrix(),i.x=s.m[12],i.y=s.m[13],i.z=s.m[14]}}getAbsolutePosition(e=null){const t=v.Zero();return this.getPositionToRef(ht.WORLD,e,t),t}getAbsolutePositionToRef(e,t){this.getPositionToRef(ht.WORLD,e,t)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this._localMatrix.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.copyFrom(this._localMatrix);const i=this._skeleton.getPoseMatrix();i&&this._absoluteMatrix.multiplyToRef(i,this._absoluteMatrix)}const e=this.children,t=e.length;for(let i=0;i<t;i++)e[i].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}getDirection(e,t=null){const i=v.Zero();return this.getDirectionToRef(e,t,i),i}getDirectionToRef(e,t=null,i){let r=null;t&&(r=t.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const s=Gt._TmpMats[0];s.copyFrom(this.getAbsoluteMatrix()),t&&r&&s.multiplyToRef(r,s),v.TransformNormalToRef(e,s,i),i.normalize()}getRotation(e=ht.LOCAL,t=null){const i=v.Zero();return this.getRotationToRef(e,t,i),i}getRotationToRef(e=ht.LOCAL,t=null,i){const r=Gt._TmpQuat;this.getRotationQuaternionToRef(e,t,r),r.toEulerAnglesToRef(i)}getRotationQuaternion(e=ht.LOCAL,t=null){const i=Re.Identity();return this.getRotationQuaternionToRef(e,t,i),i}getRotationQuaternionToRef(e=ht.LOCAL,t=null,i){if(e==ht.LOCAL)this._decompose(),i.copyFrom(this._localRotation);else{const r=Gt._TmpMats[0],s=this.getAbsoluteMatrix();t?s.multiplyToRef(t.getWorldMatrix(),r):r.copyFrom(s),r.multiplyAtIndex(0,this._scalingDeterminant),r.multiplyAtIndex(1,this._scalingDeterminant),r.multiplyAtIndex(2,this._scalingDeterminant),r.decompose(void 0,i,void 0)}}getRotationMatrix(e=ht.LOCAL,t){const i=U.Identity();return this.getRotationMatrixToRef(e,t,i),i}getRotationMatrixToRef(e=ht.LOCAL,t,i){if(e==ht.LOCAL)this.getLocalMatrix().getRotationMatrixToRef(i);else{const r=Gt._TmpMats[0],s=this.getAbsoluteMatrix();t?s.multiplyToRef(t.getWorldMatrix(),r):r.copyFrom(s),r.multiplyAtIndex(0,this._scalingDeterminant),r.multiplyAtIndex(1,this._scalingDeterminant),r.multiplyAtIndex(2,this._scalingDeterminant),r.getRotationMatrixToRef(i)}}getAbsolutePositionFromLocal(e,t=null){const i=v.Zero();return this.getAbsolutePositionFromLocalToRef(e,t,i),i}getAbsolutePositionFromLocalToRef(e,t=null,i){let r=null;t&&(r=t.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const s=Gt._TmpMats[0];s.copyFrom(this.getAbsoluteMatrix()),t&&r&&s.multiplyToRef(r,s),v.TransformCoordinatesToRef(e,s,i)}getLocalPositionFromAbsolute(e,t=null){const i=v.Zero();return this.getLocalPositionFromAbsoluteToRef(e,t,i),i}getLocalPositionFromAbsoluteToRef(e,t=null,i){let r=null;t&&(r=t.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const s=Gt._TmpMats[0];s.copyFrom(this.getAbsoluteMatrix()),t&&r&&s.multiplyToRef(r,s),s.invert(),v.TransformCoordinatesToRef(e,s,i)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}}Gt._TmpVecs=Ci.BuildArray(2,v.Zero);Gt._TmpQuat=Re.Identity();Gt._TmpMats=Ci.BuildArray(5,U.Identity);var Nu;(function(n){n[n.NONE=0]="NONE",n[n.STEP=1]="STEP"})(Nu||(Nu={}));class rc{constructor(e,t,i){this.name=e,this.from=t,this.to=i}clone(){return new rc(this.name,this.from,this.to)}}const LF=Object.freeze(new Re(0,0,0,0)),wF=Object.freeze(v.Zero()),UF=Object.freeze(me.Zero()),VF=Object.freeze(Rr.Zero()),BF=Object.freeze(De.Black()),kF=Object.freeze(new $e(0,0,0,0)),Xr={key:0,repeatCount:0,loopMode:2};class xe{static _PrepareAnimation(e,t,i,r,s,o,a,l){let h;if(!isNaN(parseFloat(s))&&isFinite(s)?h=xe.ANIMATIONTYPE_FLOAT:s instanceof Re?h=xe.ANIMATIONTYPE_QUATERNION:s instanceof v?h=xe.ANIMATIONTYPE_VECTOR3:s instanceof me?h=xe.ANIMATIONTYPE_VECTOR2:s instanceof De?h=xe.ANIMATIONTYPE_COLOR3:s instanceof $e?h=xe.ANIMATIONTYPE_COLOR4:s instanceof Rr&&(h=xe.ANIMATIONTYPE_SIZE),h==null)return null;const c=new xe(e,t,i,h,a),u=[{frame:0,value:s},{frame:r,value:o}];return c.setKeys(u),l!==void 0&&c.setEasingFunction(l),c}static CreateAnimation(e,t,i,r){const s=new xe(e+"Animation",e,i,t,xe.ANIMATIONLOOPMODE_CONSTANT);return s.setEasingFunction(r),s}static CreateAndStartAnimation(e,t,i,r,s,o,a,l,h,c,u){const d=xe._PrepareAnimation(e,i,r,s,o,a,l,h);return!d||(t.getScene&&(u=t.getScene()),!u)?null:u.beginDirectAnimation(t,[d],0,s,d.loopMode===1,1,c)}static CreateAndStartHierarchyAnimation(e,t,i,r,s,o,a,l,h,c,u){const d=xe._PrepareAnimation(e,r,s,o,a,l,h,c);return d?t.getScene().beginDirectHierarchyAnimation(t,i,[d],0,o,d.loopMode===1,1,u):null}static CreateMergeAndStartAnimation(e,t,i,r,s,o,a,l,h,c){const u=xe._PrepareAnimation(e,i,r,s,o,a,l,h);return u?(t.animations.push(u),t.getScene().beginAnimation(t,0,s,u.loopMode===1,1,c)):null}static MakeAnimationAdditive(e,t,i,r=!1,s){let o;typeof t=="object"?o=t:o={referenceFrame:t??0,range:i,cloneOriginalAnimation:r,clonedAnimationName:s};let a=e;if(o.cloneOriginalAnimation&&(a=e.clone(),a.name=o.clonedAnimationName||a.name),!a._keys.length)return a;const l=o.referenceFrame&&o.referenceFrame>=0?o.referenceFrame:0;let h=0;const c=a._keys[0];let u=a._keys.length-1;const d=a._keys[u],f={referenceValue:c.value,referencePosition:W.Vector3[0],referenceQuaternion:W.Quaternion[0],referenceScaling:W.Vector3[1],keyPosition:W.Vector3[2],keyQuaternion:W.Quaternion[1],keyScaling:W.Vector3[3]};let p=c.frame,g=d.frame;if(o.range){const E=a.getRange(o.range);E&&(p=E.from,g=E.to)}else p=o.fromFrame??p,g=o.toFrame??g;if(p!==c.frame&&(h=a.createKeyForFrame(p)),g!==d.frame&&(u=a.createKeyForFrame(g)),a._keys.length===1){const E=a._getKeyValue(a._keys[0]);f.referenceValue=E.clone?E.clone():E}else if(l<=c.frame){const E=a._getKeyValue(c.value);f.referenceValue=E.clone?E.clone():E}else if(l>=d.frame){const E=a._getKeyValue(d.value);f.referenceValue=E.clone?E.clone():E}else{Xr.key=0;const E=a._interpolate(l,Xr);f.referenceValue=E.clone?E.clone():E}a.dataType===xe.ANIMATIONTYPE_QUATERNION?f.referenceValue.normalize().conjugateInPlace():a.dataType===xe.ANIMATIONTYPE_MATRIX&&(f.referenceValue.decompose(f.referenceScaling,f.referenceQuaternion,f.referencePosition),f.referenceQuaternion.normalize().conjugateInPlace());let m=Number.MAX_VALUE;const x=o.clipKeys?[]:null;for(let E=h;E<=u;E++){let R=a._keys[E];if(x&&(R={frame:R.frame,value:R.value.clone?R.value.clone():R.value,inTangent:R.inTangent,outTangent:R.outTangent,interpolation:R.interpolation,lockedTangent:R.lockedTangent},m===Number.MAX_VALUE&&(m=R.frame),R.frame-=m,x.push(R)),!(E&&a.dataType!==xe.ANIMATIONTYPE_FLOAT&&R.value===c.value))switch(a.dataType){case xe.ANIMATIONTYPE_MATRIX:R.value.decompose(f.keyScaling,f.keyQuaternion,f.keyPosition),f.keyPosition.subtractInPlace(f.referencePosition),f.keyScaling.divideInPlace(f.referenceScaling),f.referenceQuaternion.multiplyToRef(f.keyQuaternion,f.keyQuaternion),U.ComposeToRef(f.keyScaling,f.keyQuaternion,f.keyPosition,R.value);break;case xe.ANIMATIONTYPE_QUATERNION:f.referenceValue.multiplyToRef(R.value,R.value);break;case xe.ANIMATIONTYPE_VECTOR2:case xe.ANIMATIONTYPE_VECTOR3:case xe.ANIMATIONTYPE_COLOR3:case xe.ANIMATIONTYPE_COLOR4:R.value.subtractToRef(f.referenceValue,R.value);break;case xe.ANIMATIONTYPE_SIZE:R.value.width-=f.referenceValue.width,R.value.height-=f.referenceValue.height;break;default:R.value-=f.referenceValue}}return x&&a.setKeys(x,!0),a}static TransitionTo(e,t,i,r,s,o,a,l=null){if(a<=0)return i[e]=t,l&&l(),null;const h=s*(a/1e3);o.setKeys([{frame:0,value:i[e].clone?i[e].clone():i[e]},{frame:h,value:t}]),i.animations||(i.animations=[]),i.animations.push(o);const c=r.beginAnimation(i,0,h,!1);return c.onAnimationEnd=l,c}get runtimeAnimations(){return this._runtimeAnimations}get hasRunningRuntimeAnimations(){for(const e of this._runtimeAnimations)if(!e.isStopped())return!0;return!1}constructor(e,t,i,r,s,o){this.name=e,this.targetProperty=t,this.framePerSecond=i,this.dataType=r,this.loopMode=s,this.enableBlending=o,this._easingFunction=null,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=t.split("."),this.dataType=r,this.loopMode=s===void 0?xe.ANIMATIONLOOPMODE_CYCLE:s,this.uniqueId=xe._UniqueIdGenerator++}toString(e){let t="Name: "+this.name+", property: "+this.targetProperty;if(t+=", datatype: "+["Float","Vector3","Quaternion","Matrix","Color3","Vector2"][this.dataType],t+=", nKeys: "+(this._keys?this._keys.length:"none"),t+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),e){t+=", Ranges: {";let i=!0;for(const r in this._ranges)i&&(t+=", ",i=!1),t+=r;t+="}"}return t}addEvent(e){this._events.push(e),this._events.sort((t,i)=>t.frame-i.frame)}removeEvents(e){for(let t=0;t<this._events.length;t++)this._events[t].frame===e&&(this._events.splice(t,1),t--)}getEvents(){return this._events}createRange(e,t,i){this._ranges[e]||(this._ranges[e]=new rc(e,t,i))}deleteRange(e,t=!0){const i=this._ranges[e];if(i){if(t){const r=i.from,s=i.to;for(let o=this._keys.length-1;o>=0;o--)this._keys[o].frame>=r&&this._keys[o].frame<=s&&this._keys.splice(o,1)}this._ranges[e]=null}}getRange(e){return this._ranges[e]}getKeys(){return this._keys}getHighestFrame(){let e=0;for(let t=0,i=this._keys.length;t<i;t++)e<this._keys[t].frame&&(e=this._keys[t].frame);return e}getEasingFunction(){return this._easingFunction}setEasingFunction(e){this._easingFunction=e}floatInterpolateFunction(e,t,i){return Ye.Lerp(e,t,i)}floatInterpolateFunctionWithTangents(e,t,i,r,s){return Ye.Hermite(e,t,i,r,s)}quaternionInterpolateFunction(e,t,i){return Re.Slerp(e,t,i)}quaternionInterpolateFunctionWithTangents(e,t,i,r,s){return Re.Hermite(e,t,i,r,s).normalize()}vector3InterpolateFunction(e,t,i){return v.Lerp(e,t,i)}vector3InterpolateFunctionWithTangents(e,t,i,r,s){return v.Hermite(e,t,i,r,s)}vector2InterpolateFunction(e,t,i){return me.Lerp(e,t,i)}vector2InterpolateFunctionWithTangents(e,t,i,r,s){return me.Hermite(e,t,i,r,s)}sizeInterpolateFunction(e,t,i){return Rr.Lerp(e,t,i)}color3InterpolateFunction(e,t,i){return De.Lerp(e,t,i)}color3InterpolateFunctionWithTangents(e,t,i,r,s){return De.Hermite(e,t,i,r,s)}color4InterpolateFunction(e,t,i){return $e.Lerp(e,t,i)}color4InterpolateFunctionWithTangents(e,t,i,r,s){return $e.Hermite(e,t,i,r,s)}_getKeyValue(e){return typeof e=="function"?e():e}evaluate(e){return Xr.key=0,this._interpolate(e,Xr)}_interpolate(e,t,i=!1){if(t.loopMode===xe.ANIMATIONLOOPMODE_CONSTANT&&t.repeatCount>0)return t.highLimitValue.clone?t.highLimitValue.clone():t.highLimitValue;const r=this._keys,s=r.length;let o=t.key;for(;o>=0&&e<r[o].frame;)--o;for(;o+1<=s-1&&e>=r[o+1].frame;)++o;if(t.key=o,o<0)return i?void 0:this._getKeyValue(r[0].value);if(o+1>s-1)return i?void 0:this._getKeyValue(r[s-1].value);const a=r[o],l=r[o+1];if(i&&(e===a.frame||e===l.frame))return;const h=this._getKeyValue(a.value),c=this._getKeyValue(l.value);if(a.interpolation===Nu.STEP)return l.frame>e?h:c;const u=a.outTangent!==void 0&&l.inTangent!==void 0,d=l.frame-a.frame;let f=(e-a.frame)/d;const p=a.easingFunction||this.getEasingFunction();switch(p!==null&&(f=p.ease(f)),this.dataType){case xe.ANIMATIONTYPE_FLOAT:{const g=u?this.floatInterpolateFunctionWithTangents(h,a.outTangent*d,c,l.inTangent*d,f):this.floatInterpolateFunction(h,c,f);switch(t.loopMode){case xe.ANIMATIONLOOPMODE_CYCLE:case xe.ANIMATIONLOOPMODE_CONSTANT:case xe.ANIMATIONLOOPMODE_YOYO:return g;case xe.ANIMATIONLOOPMODE_RELATIVE:case xe.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return(t.offsetValue??0)*t.repeatCount+g}break}case xe.ANIMATIONTYPE_QUATERNION:{const g=u?this.quaternionInterpolateFunctionWithTangents(h,a.outTangent.scale(d),c,l.inTangent.scale(d),f):this.quaternionInterpolateFunction(h,c,f);switch(t.loopMode){case xe.ANIMATIONLOOPMODE_CYCLE:case xe.ANIMATIONLOOPMODE_CONSTANT:case xe.ANIMATIONLOOPMODE_YOYO:return g;case xe.ANIMATIONLOOPMODE_RELATIVE:case xe.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return g.addInPlace((t.offsetValue||LF).scale(t.repeatCount))}return g}case xe.ANIMATIONTYPE_VECTOR3:{const g=u?this.vector3InterpolateFunctionWithTangents(h,a.outTangent.scale(d),c,l.inTangent.scale(d),f):this.vector3InterpolateFunction(h,c,f);switch(t.loopMode){case xe.ANIMATIONLOOPMODE_CYCLE:case xe.ANIMATIONLOOPMODE_CONSTANT:case xe.ANIMATIONLOOPMODE_YOYO:return g;case xe.ANIMATIONLOOPMODE_RELATIVE:case xe.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return g.add((t.offsetValue||wF).scale(t.repeatCount))}break}case xe.ANIMATIONTYPE_VECTOR2:{const g=u?this.vector2InterpolateFunctionWithTangents(h,a.outTangent.scale(d),c,l.inTangent.scale(d),f):this.vector2InterpolateFunction(h,c,f);switch(t.loopMode){case xe.ANIMATIONLOOPMODE_CYCLE:case xe.ANIMATIONLOOPMODE_CONSTANT:case xe.ANIMATIONLOOPMODE_YOYO:return g;case xe.ANIMATIONLOOPMODE_RELATIVE:case xe.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return g.add((t.offsetValue||UF).scale(t.repeatCount))}break}case xe.ANIMATIONTYPE_SIZE:{switch(t.loopMode){case xe.ANIMATIONLOOPMODE_CYCLE:case xe.ANIMATIONLOOPMODE_CONSTANT:case xe.ANIMATIONLOOPMODE_YOYO:return this.sizeInterpolateFunction(h,c,f);case xe.ANIMATIONLOOPMODE_RELATIVE:case xe.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return this.sizeInterpolateFunction(h,c,f).add((t.offsetValue||VF).scale(t.repeatCount))}break}case xe.ANIMATIONTYPE_COLOR3:{const g=u?this.color3InterpolateFunctionWithTangents(h,a.outTangent.scale(d),c,l.inTangent.scale(d),f):this.color3InterpolateFunction(h,c,f);switch(t.loopMode){case xe.ANIMATIONLOOPMODE_CYCLE:case xe.ANIMATIONLOOPMODE_CONSTANT:case xe.ANIMATIONLOOPMODE_YOYO:return g;case xe.ANIMATIONLOOPMODE_RELATIVE:case xe.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return g.add((t.offsetValue||BF).scale(t.repeatCount))}break}case xe.ANIMATIONTYPE_COLOR4:{const g=u?this.color4InterpolateFunctionWithTangents(h,a.outTangent.scale(d),c,l.inTangent.scale(d),f):this.color4InterpolateFunction(h,c,f);switch(t.loopMode){case xe.ANIMATIONLOOPMODE_CYCLE:case xe.ANIMATIONLOOPMODE_CONSTANT:case xe.ANIMATIONLOOPMODE_YOYO:return g;case xe.ANIMATIONLOOPMODE_RELATIVE:case xe.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return g.add((t.offsetValue||kF).scale(t.repeatCount))}break}case xe.ANIMATIONTYPE_MATRIX:{switch(t.loopMode){case xe.ANIMATIONLOOPMODE_CYCLE:case xe.ANIMATIONLOOPMODE_CONSTANT:case xe.ANIMATIONLOOPMODE_YOYO:return xe.AllowMatricesInterpolation?this.matrixInterpolateFunction(h,c,f,t.workValue):h;case xe.ANIMATIONLOOPMODE_RELATIVE:case xe.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return h}break}}return 0}matrixInterpolateFunction(e,t,i,r){return xe.AllowMatrixDecomposeForInterpolation?r?(U.DecomposeLerpToRef(e,t,i,r),r):U.DecomposeLerp(e,t,i):r?(U.LerpToRef(e,t,i,r),r):U.Lerp(e,t,i)}clone(){const e=new xe(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(e.enableBlending=this.enableBlending,e.blendingSpeed=this.blendingSpeed,this._keys&&e.setKeys(this._keys),this._ranges){e._ranges={};for(const t in this._ranges){const i=this._ranges[t];i&&(e._ranges[t]=i.clone())}}return e}setKeys(e,t=!1){this._keys=t?e:e.slice(0)}createKeyForFrame(e){Xr.key=0;const t=this._interpolate(e,Xr,!0);if(!t)return this._keys[Xr.key].frame===e?Xr.key:Xr.key+1;const i={frame:e,value:t.clone?t.clone():t};return this._keys.splice(Xr.key+1,0,i),Xr.key+1}serialize(){const e={};e.name=this.name,e.property=this.targetProperty,e.framePerSecond=this.framePerSecond,e.dataType=this.dataType,e.loopBehavior=this.loopMode,e.enableBlending=this.enableBlending,e.blendingSpeed=this.blendingSpeed;const t=this.dataType;e.keys=[];const i=this.getKeys();for(let r=0;r<i.length;r++){const s=i[r],o={};switch(o.frame=s.frame,t){case xe.ANIMATIONTYPE_FLOAT:o.values=[s.value],s.inTangent!==void 0&&o.values.push(s.inTangent),s.outTangent!==void 0&&(s.inTangent===void 0&&o.values.push(void 0),o.values.push(s.outTangent)),s.interpolation!==void 0&&(s.inTangent===void 0&&o.values.push(void 0),s.outTangent===void 0&&o.values.push(void 0),o.values.push(s.interpolation));break;case xe.ANIMATIONTYPE_QUATERNION:case xe.ANIMATIONTYPE_MATRIX:case xe.ANIMATIONTYPE_VECTOR3:case xe.ANIMATIONTYPE_COLOR3:case xe.ANIMATIONTYPE_COLOR4:o.values=s.value.asArray(),s.inTangent!=null&&o.values.push(s.inTangent.asArray()),s.outTangent!=null&&(s.inTangent===void 0&&o.values.push(void 0),o.values.push(s.outTangent.asArray())),s.interpolation!==void 0&&(s.inTangent===void 0&&o.values.push(void 0),s.outTangent===void 0&&o.values.push(void 0),o.values.push(s.interpolation));break}e.keys.push(o)}e.ranges=[];for(const r in this._ranges){const s=this._ranges[r];if(!s)continue;const o={};o.name=r,o.from=s.from,o.to=s.to,e.ranges.push(o)}return e}static _UniversalLerp(e,t,i){const r=e.constructor;return r.Lerp?r.Lerp(e,t,i):r.Slerp?r.Slerp(e,t,i):e.toFixed?e*(1-i)+i*t:t}static Parse(e){const t=new xe(e.name,e.property,e.framePerSecond,e.dataType,e.loopBehavior),i=e.dataType,r=[];let s,o;for(e.enableBlending&&(t.enableBlending=e.enableBlending),e.blendingSpeed&&(t.blendingSpeed=e.blendingSpeed),o=0;o<e.keys.length;o++){const a=e.keys[o];let l,h,c;switch(i){case xe.ANIMATIONTYPE_FLOAT:s=a.values[0],a.values.length>=2&&(l=a.values[1]),a.values.length>=3&&(h=a.values[2]),a.values.length>=4&&(c=a.values[3]);break;case xe.ANIMATIONTYPE_QUATERNION:if(s=Re.FromArray(a.values),a.values.length>=8){const d=Re.FromArray(a.values.slice(4,8));d.equals(Re.Zero())||(l=d)}if(a.values.length>=12){const d=Re.FromArray(a.values.slice(8,12));d.equals(Re.Zero())||(h=d)}a.values.length>=13&&(c=a.values[12]);break;case xe.ANIMATIONTYPE_MATRIX:s=U.FromArray(a.values),a.values.length>=17&&(c=a.values[16]);break;case xe.ANIMATIONTYPE_COLOR3:s=De.FromArray(a.values),a.values[3]&&(l=De.FromArray(a.values[3])),a.values[4]&&(h=De.FromArray(a.values[4])),a.values[5]&&(c=a.values[5]);break;case xe.ANIMATIONTYPE_COLOR4:s=$e.FromArray(a.values),a.values[4]&&(l=$e.FromArray(a.values[4])),a.values[5]&&(h=$e.FromArray(a.values[5])),a.values[6]&&(c=$e.FromArray(a.values[6]));break;case xe.ANIMATIONTYPE_VECTOR3:default:s=v.FromArray(a.values),a.values[3]&&(l=v.FromArray(a.values[3])),a.values[4]&&(h=v.FromArray(a.values[4])),a.values[5]&&(c=a.values[5]);break}const u={};u.frame=a.frame,u.value=s,l!=null&&(u.inTangent=l),h!=null&&(u.outTangent=h),c!=null&&(u.interpolation=c),r.push(u)}if(t.setKeys(r),e.ranges)for(o=0;o<e.ranges.length;o++)s=e.ranges[o],t.createRange(s.name,s.from,s.to);return t}static AppendSerializedAnimations(e,t){Le.AppendSerializedAnimations(e,t)}static ParseFromFileAsync(e,t){return new Promise((i,r)=>{const s=new Ei;s.addEventListener("readystatechange",()=>{if(s.readyState==4)if(s.status==200){let o=JSON.parse(s.responseText);if(o.animations&&(o=o.animations),o.length){const a=[];for(const l of o)a.push(this.Parse(l));i(a)}else{const a=this.Parse(o);e&&(a.name=e),i(a)}}else r("Unable to load the animation")}),s.open("GET",t),s.send()})}static ParseFromSnippetAsync(e){return new Promise((t,i)=>{const r=new Ei;r.addEventListener("readystatechange",()=>{if(r.readyState==4)if(r.status==200){const s=JSON.parse(JSON.parse(r.responseText).jsonPayload);if(s.animations){const o=JSON.parse(s.animations),a=[];for(const l of o.animations){const h=this.Parse(l);h.snippetId=e,a.push(h)}t(a)}else{const o=JSON.parse(s.animation),a=this.Parse(o);a.snippetId=e,t(a)}}else i("Unable to load the snippet "+e)}),r.open("GET",this.SnippetUrl+"/"+e.replace(/#/g,"/")),r.send()})}}xe._UniqueIdGenerator=0;xe.AllowMatricesInterpolation=!1;xe.AllowMatrixDecomposeForInterpolation=!0;xe.SnippetUrl="https://snippet.babylonjs.com";xe.ANIMATIONTYPE_FLOAT=0;xe.ANIMATIONTYPE_VECTOR3=1;xe.ANIMATIONTYPE_QUATERNION=2;xe.ANIMATIONTYPE_MATRIX=3;xe.ANIMATIONTYPE_COLOR3=4;xe.ANIMATIONTYPE_COLOR4=7;xe.ANIMATIONTYPE_VECTOR2=5;xe.ANIMATIONTYPE_SIZE=6;xe.ANIMATIONLOOPMODE_RELATIVE=0;xe.ANIMATIONLOOPMODE_CYCLE=1;xe.ANIMATIONLOOPMODE_CONSTANT=2;xe.ANIMATIONLOOPMODE_YOYO=4;xe.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT=5;xe.CreateFromSnippetAsync=xe.ParseFromSnippetAsync;ye("BABYLON.Animation",xe);Oi._AnimationRangeFactory=(n,e,t)=>new rc(n,e,t);const zF="particlesPixelShader",GF=`#ifdef LOGARITHMICDEPTH
#extension GL_EXT_frag_depth : enable
#endif
varying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;
#include<clipPlaneFragmentDeclaration>
#include<imageProcessingDeclaration>
#include<logDepthDeclaration>
#include<helperFunctions>
#include<imageProcessingFunctions>
#ifdef RAMPGRADIENT
varying vec4 remapRanges;uniform sampler2D rampSampler;
#endif
#include<fogFragmentDeclaration>
#define CUSTOM_FRAGMENT_DEFINITIONS
void main(void) {
#define CUSTOM_FRAGMENT_MAIN_BEGIN
#include<clipPlaneFragment>
vec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;
#ifdef RAMPGRADIENT
float alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);
#endif
#ifdef BLENDMULTIPLYMODE
float sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);
#endif
#include<logDepthFragment>
#include<fogFragment>(color,baseColor)
#ifdef IMAGEPROCESSINGPOSTPROCESS
baseColor.rgb=toLinearSpace(baseColor.rgb);
#else
#ifdef IMAGEPROCESSING
baseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);
#endif
#endif
gl_FragColor=baseColor;
#define CUSTOM_FRAGMENT_MAIN_END
}`;Y.ShadersStore[zF]=GF;const WF="particlesVertexShader",XF=`attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;
#ifdef ANIMATESHEET
attribute float cellIndex;
#endif
#ifndef BILLBOARD
attribute vec3 direction;
#endif
#ifdef BILLBOARDSTRETCHED
attribute vec3 direction;
#endif
#ifdef RAMPGRADIENT
attribute vec4 remapData;
#endif
attribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;
#ifdef ANIMATESHEET
uniform vec3 particlesInfos; 
#endif
varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;
#ifdef RAMPGRADIENT
varying vec4 remapRanges;
#endif
#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)
uniform mat4 invView;
#endif
#include<clipPlaneVertexDeclaration>
#include<fogVertexDeclaration>
#include<logDepthDeclaration>
#ifdef BILLBOARD
uniform vec3 eyePosition;
#endif
vec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}
#ifdef BILLBOARDSTRETCHED
vec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);
#ifdef BILLBOARDSTRETCHED_LOCAL
vec3 row1=direction;
#else
vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);
#endif
mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}
#endif
#define CUSTOM_VERTEX_DEFINITIONS
void main(void) {
#define CUSTOM_VERTEX_MAIN_BEGIN
vec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;
#ifdef BILLBOARD
vec3 rotatedCorner;
#ifdef BILLBOARDY
rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;
#elif defined(BILLBOARDSTRETCHED)
rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;
#else
rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;
#endif
#ifdef RAMPGRADIENT
remapRanges=remapData;
#endif
gl_Position=projection*vec4(viewPos,1.0);
#else
vec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);
#endif
vColor=color;
#ifdef ANIMATESHEET
float rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;
#else
vUV=offset;
#endif
#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)
vec4 worldPos=vec4(vPositionW,1.0);
#endif
#include<clipPlaneVertex>
#include<fogVertex>
#include<logDepthVertex>
#define CUSTOM_VERTEX_MAIN_END
}`;Y.ShadersStore[WF]=XF;var am;(function(n){n[n.ATTACHED=0]="ATTACHED",n[n.END=1]="END"})(am||(am={}));class _a{get influence(){return this._influence}set influence(e){if(this._influence===e)return;const t=this._influence;this._influence=e,this.onInfluenceChanged.hasObservers()&&this.onInfluenceChanged.notifyObservers(t===0||e===0)}get animationPropertiesOverride(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride}set animationPropertiesOverride(e){this._animationPropertiesOverride=e}constructor(e,t=0,i=null){this.name=e,this.animations=[],this._positions=null,this._normals=null,this._tangents=null,this._uvs=null,this._uniqueId=0,this.onInfluenceChanged=new he,this._onDataLayoutChanged=new he,this._animationPropertiesOverride=null,this._scene=i||rt.LastCreatedScene,this.influence=t,this._scene&&(this._uniqueId=this._scene.getUniqueId())}get uniqueId(){return this._uniqueId}get hasPositions(){return!!this._positions}get hasNormals(){return!!this._normals}get hasTangents(){return!!this._tangents}get hasUVs(){return!!this._uvs}setPositions(e){const t=this.hasPositions;this._positions=e,t!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)}getPositions(){return this._positions}setNormals(e){const t=this.hasNormals;this._normals=e,t!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)}getNormals(){return this._normals}setTangents(e){const t=this.hasTangents;this._tangents=e,t!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)}getTangents(){return this._tangents}setUVs(e){const t=this.hasUVs;this._uvs=e,t!==this.hasUVs&&this._onDataLayoutChanged.notifyObservers(void 0)}getUVs(){return this._uvs}clone(){const e=Le.Clone(()=>new _a(this.name,this.influence,this._scene),this);return e._positions=this._positions,e._normals=this._normals,e._tangents=this._tangents,e._uvs=this._uvs,e}serialize(){const e={};return e.name=this.name,e.influence=this.influence,e.positions=Array.prototype.slice.call(this.getPositions()),this.id!=null&&(e.id=this.id),this.hasNormals&&(e.normals=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(e.tangents=Array.prototype.slice.call(this.getTangents())),this.hasUVs&&(e.uvs=Array.prototype.slice.call(this.getUVs())),Le.AppendSerializedAnimations(this,e),e}getClassName(){return"MorphTarget"}static Parse(e,t){const i=new _a(e.name,e.influence);if(i.setPositions(e.positions),e.id!=null&&(i.id=e.id),e.normals&&i.setNormals(e.normals),e.tangents&&i.setTangents(e.tangents),e.uvs&&i.setUVs(e.uvs),e.animations){for(let r=0;r<e.animations.length;r++){const s=e.animations[r],o=Er("BABYLON.Animation");o&&i.animations.push(o.Parse(s))}e.autoAnimate&&t&&t.beginAnimation(i,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1)}return i}static FromMesh(e,t,i){t||(t=e.name);const r=new _a(t,i,e.getScene());return r.setPositions(e.getVerticesData(b.PositionKind)),e.isVerticesDataPresent(b.NormalKind)&&r.setNormals(e.getVerticesData(b.NormalKind)),e.isVerticesDataPresent(b.TangentKind)&&r.setTangents(e.getVerticesData(b.TangentKind)),e.isVerticesDataPresent(b.UVKind)&&r.setUVs(e.getVerticesData(b.UVKind)),r}}M([V()],_a.prototype,"id",void 0);const HF="kernelBlurVaryingDeclaration",KF="varying vec2 sampleCoord{X};";Y.IncludesShadersStore[HF]=KF;const qF="kernelBlurFragment",YF=`#ifdef DOF
factor=sampleCoC(sampleCoord{X}); 
computedWeight=KERNEL_WEIGHT{X}*factor;sumOfWeights+=computedWeight;
#else
computedWeight=KERNEL_WEIGHT{X};
#endif
#ifdef PACKEDFLOAT
blend+=unpack(texture2D(textureSampler,sampleCoord{X}))*computedWeight;
#else
blend+=texture2D(textureSampler,sampleCoord{X})*computedWeight;
#endif
`;Y.IncludesShadersStore[qF]=YF;const ZF="kernelBlurFragment2",jF=`#ifdef DOF
factor=sampleCoC(sampleCenter+delta*KERNEL_DEP_OFFSET{X});computedWeight=KERNEL_DEP_WEIGHT{X}*factor;sumOfWeights+=computedWeight;
#else
computedWeight=KERNEL_DEP_WEIGHT{X};
#endif
#ifdef PACKEDFLOAT
blend+=unpack(texture2D(textureSampler,sampleCenter+delta*KERNEL_DEP_OFFSET{X}))*computedWeight;
#else
blend+=texture2D(textureSampler,sampleCenter+delta*KERNEL_DEP_OFFSET{X})*computedWeight;
#endif
`;Y.IncludesShadersStore[ZF]=jF;const QF="kernelBlurPixelShader",JF=`uniform sampler2D textureSampler;uniform vec2 delta;varying vec2 sampleCenter;
#ifdef DOF
uniform sampler2D circleOfConfusionSampler;float sampleCoC(in vec2 offset) {float coc=texture2D(circleOfConfusionSampler,offset).r;return coc; }
#endif
#include<kernelBlurVaryingDeclaration>[0..varyingCount]
#ifdef PACKEDFLOAT
#include<packingFunctions>
#endif
#define CUSTOM_FRAGMENT_DEFINITIONS
void main(void)
{float computedWeight=0.0;
#ifdef PACKEDFLOAT
float blend=0.;
#else
vec4 blend=vec4(0.);
#endif
#ifdef DOF
float sumOfWeights=CENTER_WEIGHT; 
float factor=0.0;
#ifdef PACKEDFLOAT
blend+=unpack(texture2D(textureSampler,sampleCenter))*CENTER_WEIGHT;
#else
blend+=texture2D(textureSampler,sampleCenter)*CENTER_WEIGHT;
#endif
#endif
#include<kernelBlurFragment>[0..varyingCount]
#include<kernelBlurFragment2>[0..depCount]
#ifdef PACKEDFLOAT
gl_FragColor=pack(blend);
#else
gl_FragColor=blend;
#endif
#ifdef DOF
gl_FragColor/=sumOfWeights;
#endif
}`;Y.ShadersStore[QF]=JF;const $F="kernelBlurVertex",eL="sampleCoord{X}=sampleCenter+delta*KERNEL_OFFSET{X};";Y.IncludesShadersStore[$F]=eL;const tL="kernelBlurVertexShader",iL=`attribute vec2 position;uniform vec2 delta;varying vec2 sampleCenter;
#include<kernelBlurVaryingDeclaration>[0..varyingCount]
const vec2 madd=vec2(0.5,0.5);
#define CUSTOM_VERTEX_DEFINITIONS
void main(void) {
#define CUSTOM_VERTEX_MAIN_BEGIN
sampleCenter=(position*madd+madd);
#include<kernelBlurVertex>[0..varyingCount]
gl_Position=vec4(position,0.0,1.0);
#define CUSTOM_VERTEX_MAIN_END
}`;Y.ShadersStore[tL]=iL;class jo extends Mt{set kernel(e){this._idealKernel!==e&&(e=Math.max(e,1),this._idealKernel=e,this._kernel=this._nearestBestKernel(e),this._blockCompilation||this._updateParameters())}get kernel(){return this._idealKernel}set packedFloat(e){this._packedFloat!==e&&(this._packedFloat=e,this._blockCompilation||this._updateParameters())}get packedFloat(){return this._packedFloat}getClassName(){return"BlurPostProcess"}constructor(e,t,i,r,s,o=le.BILINEAR_SAMPLINGMODE,a,l,h=0,c="",u=!1,d=5){super(e,"kernelBlur",["delta","direction"],["circleOfConfusionSampler"],r,s,o,a,l,null,h,"kernelBlur",{varyingCount:0,depCount:0},!0,d),this._blockCompilation=u,this._packedFloat=!1,this._staticDefines="",this._staticDefines=c,this.direction=t,this.onApplyObservable.add(f=>{this._outputTexture?f.setFloat2("delta",1/this._outputTexture.width*this.direction.x,1/this._outputTexture.height*this.direction.y):f.setFloat2("delta",1/this.width*this.direction.x,1/this.height*this.direction.y)}),this.kernel=i}updateEffect(e=null,t=null,i=null,r,s,o){this._updateParameters(s,o)}_updateParameters(e,t){const i=this._kernel,r=(i-1)/2;let s=[],o=[],a=0;for(let m=0;m<i;m++){const x=m/(i-1),E=this._gaussianWeight(x*2-1);s[m]=m-r,o[m]=E,a+=E}for(let m=0;m<o.length;m++)o[m]/=a;const l=[],h=[],c=[];for(let m=0;m<=r;m+=2){const x=Math.min(m+1,Math.floor(r));if(m===x)c.push({o:s[m],w:o[m]});else{const E=x===r,R=o[m]+o[x]*(E?.5:1),C=s[m]+1/(1+o[m]/o[x]);C===0?(c.push({o:s[m],w:o[m]}),c.push({o:s[m+1],w:o[m+1]})):(c.push({o:C,w:R}),c.push({o:-C,w:R}))}}for(let m=0;m<c.length;m++)h[m]=c[m].o,l[m]=c[m].w;s=h,o=l;const u=this.getEngine().getCaps().maxVaryingVectors,d=Math.max(u,0)-1;let f=Math.min(s.length,d),p="";p+=this._staticDefines,this._staticDefines.indexOf("DOF")!=-1&&(p+=`#define CENTER_WEIGHT ${this._glslFloat(o[f-1])}
`,f--);for(let m=0;m<f;m++)p+=`#define KERNEL_OFFSET${m} ${this._glslFloat(s[m])}
`,p+=`#define KERNEL_WEIGHT${m} ${this._glslFloat(o[m])}
`;let g=0;for(let m=d;m<s.length;m++)p+=`#define KERNEL_DEP_OFFSET${g} ${this._glslFloat(s[m])}
`,p+=`#define KERNEL_DEP_WEIGHT${g} ${this._glslFloat(o[m])}
`,g++;this.packedFloat&&(p+="#define PACKEDFLOAT 1"),this._blockCompilation=!1,super.updateEffect(p,null,null,{varyingCount:f,depCount:g},e,t)}_nearestBestKernel(e){const t=Math.round(e);for(const i of[t,t-1,t+1,t-2,t+2])if(i%2!==0&&Math.floor(i/2)%2===0&&i>0)return Math.max(i,3);return Math.max(t,3)}_gaussianWeight(e){const t=.3333333333333333,i=Math.sqrt(2*Math.PI)*t,r=-(e*e/(2*t*t));return 1/i*Math.exp(r)}_glslFloat(e,t=8){return e.toFixed(t).replace(/0+$/,"")}static _Parse(e,t,i,r){return Le.Parse(()=>new jo(e.name,e.direction,e.kernel,e.options,t,e.renderTargetSamplingMode,i.getEngine(),e.reusable,e.textureType,void 0,!1),e,i,r)}}M([V("kernel")],jo.prototype,"_kernel",void 0);M([V("packedFloat")],jo.prototype,"_packedFloat",void 0);M([a0()],jo.prototype,"direction",void 0);ye("BABYLON.BlurPostProcess",jo);const rL="bayerDitherFunctions",sL=`float bayerDither2(vec2 _P) {return mod(2.0*_P.y+_P.x+1.0,4.0);}
float bayerDither4(vec2 _P) {vec2 P1=mod(_P,2.0); 
vec2 P2=floor(0.5*mod(_P,4.0)); 
return 4.0*bayerDither2(P1)+bayerDither2(P2);}
float bayerDither8(vec2 _P) {vec2 P1=mod(_P,2.0); 
vec2 P2=floor(0.5 *mod(_P,4.0)); 
vec2 P4=floor(0.25*mod(_P,8.0)); 
return 4.0*(4.0*bayerDither2(P1)+bayerDither2(P2))+bayerDither2(P4);}
`;Y.IncludesShadersStore[rL]=sL;const nL="shadowMapFragmentExtraDeclaration",oL=`#if SM_FLOAT==0
#include<packingFunctions>
#endif
#if SM_SOFTTRANSPARENTSHADOW==1
#include<bayerDitherFunctions>
uniform float softTransparentShadowSM;
#endif
varying float vDepthMetricSM;
#if SM_USEDISTANCE==1
uniform vec3 lightDataSM;varying vec3 vPositionWSM;
#endif
uniform vec3 biasAndScaleSM;uniform vec2 depthValuesSM;
#if defined(SM_DEPTHCLAMP) && SM_DEPTHCLAMP==1
varying float zSM;
#endif
`;Y.IncludesShadersStore[nL]=oL;const aL="shadowMapFragment",lL=`float depthSM=vDepthMetricSM;
#if defined(SM_DEPTHCLAMP) && SM_DEPTHCLAMP==1
#if SM_USEDISTANCE==1
depthSM=(length(vPositionWSM-lightDataSM)+depthValuesSM.x)/depthValuesSM.y+biasAndScaleSM.x;
#else
#ifdef USE_REVERSE_DEPTHBUFFER
depthSM=(-zSM+depthValuesSM.x)/depthValuesSM.y+biasAndScaleSM.x;
#else
depthSM=(zSM+depthValuesSM.x)/depthValuesSM.y+biasAndScaleSM.x;
#endif
#endif
#ifdef USE_REVERSE_DEPTHBUFFER
gl_FragDepth=clamp(1.0-depthSM,0.0,1.0);
#else
gl_FragDepth=clamp(depthSM,0.0,1.0); 
#endif
#elif SM_USEDISTANCE==1
depthSM=(length(vPositionWSM-lightDataSM)+depthValuesSM.x)/depthValuesSM.y+biasAndScaleSM.x;
#endif
#if SM_ESM==1
depthSM=clamp(exp(-min(87.,biasAndScaleSM.z*depthSM)),0.,1.);
#endif
#if SM_FLOAT==1
gl_FragColor=vec4(depthSM,1.0,1.0,1.0);
#else
gl_FragColor=pack(depthSM);
#endif
return;`;Y.IncludesShadersStore[aL]=lL;const hL="shadowMapPixelShader",cL=`#include<shadowMapFragmentExtraDeclaration>
#ifdef ALPHATEXTURE
varying vec2 vUV;uniform sampler2D diffuseSampler;
#endif
#include<clipPlaneFragmentDeclaration>
#define CUSTOM_FRAGMENT_DEFINITIONS
void main(void)
{
#include<clipPlaneFragment>
#ifdef ALPHATEXTURE
float alphaFromAlphaTexture=texture2D(diffuseSampler,vUV).a;
#ifdef ALPHATESTVALUE
if (alphaFromAlphaTexture<ALPHATESTVALUE)
discard;
#endif
#endif
#if SM_SOFTTRANSPARENTSHADOW==1
#ifdef ALPHATEXTURE
if ((bayerDither8(floor(mod(gl_FragCoord.xy,8.0))))/64.0>=softTransparentShadowSM*alphaFromAlphaTexture) discard;
#else
if ((bayerDither8(floor(mod(gl_FragCoord.xy,8.0))))/64.0>=softTransparentShadowSM) discard;
#endif
#endif
#include<shadowMapFragment>
}`;Y.ShadersStore[hL]=cL;const uL="sceneVertexDeclaration",dL=`uniform mat4 viewProjection;
#ifdef MULTIVIEW
uniform mat4 viewProjectionR;
#endif
uniform mat4 view;uniform mat4 projection;uniform vec4 vEyePosition;
`;Y.IncludesShadersStore[uL]=dL;const fL="meshVertexDeclaration",pL=`uniform mat4 world;uniform float visibility;
`;Y.IncludesShadersStore[fL]=pL;const gL="shadowMapVertexDeclaration",mL=`#include<sceneVertexDeclaration>
#include<meshVertexDeclaration>
`;Y.IncludesShadersStore[gL]=mL;const _L="shadowMapUboDeclaration",vL=`layout(std140,column_major) uniform;
#include<sceneUboDeclaration>
#include<meshUboDeclaration>
`;Y.IncludesShadersStore[_L]=vL;const EL="shadowMapVertexExtraDeclaration",TL=`#if SM_NORMALBIAS==1
uniform vec3 lightDataSM;
#endif
uniform vec3 biasAndScaleSM;uniform vec2 depthValuesSM;varying float vDepthMetricSM;
#if SM_USEDISTANCE==1
varying vec3 vPositionWSM;
#endif
#if defined(SM_DEPTHCLAMP) && SM_DEPTHCLAMP==1
varying float zSM;
#endif
`;Y.IncludesShadersStore[EL]=TL;const xL="shadowMapVertexNormalBias",CL=`#if SM_NORMALBIAS==1
#if SM_DIRECTIONINLIGHTDATA==1
vec3 worldLightDirSM=normalize(-lightDataSM.xyz);
#else
vec3 directionToLightSM=lightDataSM.xyz-worldPos.xyz;vec3 worldLightDirSM=normalize(directionToLightSM);
#endif
float ndlSM=dot(vNormalW,worldLightDirSM);float sinNLSM=sqrt(1.0-ndlSM*ndlSM);float normalBiasSM=biasAndScaleSM.y*sinNLSM;worldPos.xyz-=vNormalW*normalBiasSM;
#endif
`;Y.IncludesShadersStore[xL]=CL;const RL="shadowMapVertexMetric",SL=`#if SM_USEDISTANCE==1
vPositionWSM=worldPos.xyz;
#endif
#if SM_DEPTHTEXTURE==1
#ifdef IS_NDC_HALF_ZRANGE
#define BIASFACTOR 0.5
#else
#define BIASFACTOR 1.0
#endif
#ifdef USE_REVERSE_DEPTHBUFFER
gl_Position.z-=biasAndScaleSM.x*gl_Position.w*BIASFACTOR;
#else
gl_Position.z+=biasAndScaleSM.x*gl_Position.w*BIASFACTOR;
#endif
#endif
#if defined(SM_DEPTHCLAMP) && SM_DEPTHCLAMP==1
zSM=gl_Position.z;gl_Position.z=0.0;
#elif SM_USEDISTANCE==0
#ifdef USE_REVERSE_DEPTHBUFFER
vDepthMetricSM=(-gl_Position.z+depthValuesSM.x)/depthValuesSM.y+biasAndScaleSM.x;
#else
vDepthMetricSM=(gl_Position.z+depthValuesSM.x)/depthValuesSM.y+biasAndScaleSM.x;
#endif
#endif
`;Y.IncludesShadersStore[RL]=SL;const yL="shadowMapVertexShader",bL=`attribute vec3 position;
#ifdef NORMAL
attribute vec3 normal;
#endif
#include<bonesDeclaration>
#include<bakedVertexAnimationDeclaration>
#include<morphTargetsVertexGlobalDeclaration>
#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]
#ifdef INSTANCES
attribute vec4 world0;attribute vec4 world1;attribute vec4 world2;attribute vec4 world3;
#endif
#include<helperFunctions>
#include<__decl__shadowMapVertex>
#ifdef ALPHATEXTURE
varying vec2 vUV;uniform mat4 diffuseMatrix;
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#endif
#include<shadowMapVertexExtraDeclaration>
#include<clipPlaneVertexDeclaration>
#define CUSTOM_VERTEX_DEFINITIONS
void main(void)
{vec3 positionUpdated=position;
#ifdef UV1
vec2 uvUpdated=uv;
#endif
#ifdef NORMAL
vec3 normalUpdated=normal;
#endif
#include<morphTargetsVertexGlobal>
#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]
#include<instancesVertex>
#include<bonesVertex>
#include<bakedVertexAnimation>
vec4 worldPos=finalWorld*vec4(positionUpdated,1.0);
#ifdef NORMAL
mat3 normWorldSM=mat3(finalWorld);
#if defined(INSTANCES) && defined(THIN_INSTANCES)
vec3 vNormalW=normalUpdated/vec3(dot(normWorldSM[0],normWorldSM[0]),dot(normWorldSM[1],normWorldSM[1]),dot(normWorldSM[2],normWorldSM[2]));vNormalW=normalize(normWorldSM*vNormalW);
#else
#ifdef NONUNIFORMSCALING
normWorldSM=transposeMat3(inverseMat3(normWorldSM));
#endif
vec3 vNormalW=normalize(normWorldSM*normalUpdated);
#endif
#endif
#include<shadowMapVertexNormalBias>
gl_Position=viewProjection*worldPos;
#include<shadowMapVertexMetric>
#ifdef ALPHATEXTURE
#ifdef UV1
vUV=vec2(diffuseMatrix*vec4(uvUpdated,1.0,0.0));
#endif
#ifdef UV2
vUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));
#endif
#endif
#include<clipPlaneVertex>
}`;Y.ShadersStore[yL]=bL;const IL="depthBoxBlurPixelShader",AL=`varying vec2 vUV;uniform sampler2D textureSampler;uniform vec2 screenSize;
#define CUSTOM_FRAGMENT_DEFINITIONS
void main(void)
{vec4 colorDepth=vec4(0.0);for (int x=-OFFSET; x<=OFFSET; x++)
for (int y=-OFFSET; y<=OFFSET; y++)
colorDepth+=texture2D(textureSampler,vUV+vec2(x,y)/screenSize);gl_FragColor=(colorDepth/float((OFFSET*2+1)*(OFFSET*2+1)));}`;Y.ShadersStore[IL]=AL;const ML="shadowMapFragmentSoftTransparentShadow",PL=`#if SM_SOFTTRANSPARENTSHADOW==1
if ((bayerDither8(floor(mod(gl_FragCoord.xy,8.0))))/64.0>=softTransparentShadowSM*alpha) discard;
#endif
`;Y.IncludesShadersStore[ML]=PL;var lm;(function(n){n[n.ETC1S=0]="ETC1S",n[n.UASTC4x4=1]="UASTC4x4"})(lm||(lm={}));var hm;(function(n){n[n.ASTC_4X4_RGBA=0]="ASTC_4X4_RGBA",n[n.BC7_RGBA=1]="BC7_RGBA",n[n.BC3_RGBA=2]="BC3_RGBA",n[n.BC1_RGB=3]="BC1_RGB",n[n.PVRTC1_4_RGBA=4]="PVRTC1_4_RGBA",n[n.PVRTC1_4_RGB=5]="PVRTC1_4_RGB",n[n.ETC2_RGBA=6]="ETC2_RGBA",n[n.ETC1_RGB=7]="ETC1_RGB",n[n.RGBA32=8]="RGBA32",n[n.R8=9]="R8",n[n.RG8=10]="RG8"})(hm||(hm={}));var cm;(function(n){n[n.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",n[n.COMPRESSED_RGBA_ASTC_4X4_KHR=37808]="COMPRESSED_RGBA_ASTC_4X4_KHR",n[n.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",n[n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",n[n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",n[n.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",n[n.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",n[n.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",n[n.RGBA8Format=32856]="RGBA8Format",n[n.R8Format=33321]="R8Format",n[n.RG8Format=33323]="RG8Format"})(cm||(cm={}));var um;(function(n){class e{serialize(){const r={},s=new Array(this._characterToIdx.size);return this._characterToIdx.forEach((o,a)=>{s[o]=a}),r.characters=s,r.insertionCosts=this._insertionCosts,r.deletionCosts=this._deletionCosts,r.substitutionCosts=this._substitutionCosts,JSON.stringify(r)}static Deserialize(r){const s=JSON.parse(r),o=new e(s.characters);return o._insertionCosts=s.insertionCosts,o._deletionCosts=s.deletionCosts,o._substitutionCosts=s.substitutionCosts,o}constructor(r,s=null,o=null,a=null){s=s??(()=>1),o=o??(()=>1),a=a??((h,c)=>h===c?0:1),this._characterToIdx=new Map,this._insertionCosts=new Array(r.length),this._deletionCosts=new Array(r.length),this._substitutionCosts=new Array(r.length);let l;for(let h=0;h<r.length;++h){l=r[h],this._characterToIdx.set(l,h),this._insertionCosts[h]=s(l),this._deletionCosts[h]=o(l),this._substitutionCosts[h]=new Array(r.length);for(let c=h;c<r.length;++c)this._substitutionCosts[h][c]=a(l,r[c])}}getCharacterIdx(r){return this._characterToIdx.get(r)}getInsertionCost(r){return this._insertionCosts[r]}getDeletionCost(r){return this._deletionCosts[r]}getSubstitutionCost(r,s){const o=Math.min(r,s),a=Math.max(r,s);return this._substitutionCosts[o][a]}}n.Alphabet=e;class t{serialize(){return JSON.stringify(this._characters)}static Deserialize(r,s){const o=new t([],s);return o._characters=JSON.parse(r),o}constructor(r,s){if(r.length>t._MAX_SEQUENCE_LENGTH)throw new Error("Sequences longer than "+t._MAX_SEQUENCE_LENGTH+" not supported.");this._alphabet=s,this._characters=r.map(o=>this._alphabet.getCharacterIdx(o))}distance(r){return t._Distance(this,r)}static _Distance(r,s){const o=r._alphabet;if(o!==s._alphabet)throw new Error("Cannot Levenshtein compare Sequences built from different alphabets.");const a=r._characters,l=s._characters,h=a.length,c=l.length,u=t._CostMatrix;u[0][0]=0;for(let d=0;d<h;++d)u[d+1][0]=u[d][0]+o.getInsertionCost(a[d]);for(let d=0;d<c;++d)u[0][d+1]=u[0][d]+o.getInsertionCost(l[d]);for(let d=0;d<h;++d)for(let f=0;f<c;++f)t._InsertionCost=u[d+1][f]+o.getInsertionCost(l[f]),t._DeletionCost=u[d][f+1]+o.getDeletionCost(a[d]),t._SubstitutionCost=u[d][f]+o.getSubstitutionCost(a[d],l[f]),u[d+1][f+1]=Math.min(t._InsertionCost,t._DeletionCost,t._SubstitutionCost);return u[h][c]}}t._MAX_SEQUENCE_LENGTH=256,t._CostMatrix=[...Array(t._MAX_SEQUENCE_LENGTH+1)].map(()=>new Array(t._MAX_SEQUENCE_LENGTH+1)),n.Sequence=t})(um||(um={}));new U;var dm;(function(n){n[n.INIT=0]="INIT",n[n.STARTED=1]="STARTED",n[n.ENDED=2]="ENDED"})(dm||(dm={}));const OL=1.5;class tn{constructor(e){this._view=new Float32Array(e),this._itemLength=0}get itemLength(){return this._itemLength}at(e){return e<0||e>=this._itemLength?NaN:this._view[e]}subarray(e,t){return e>=t||e<0?new Float32Array(0):(t>this._itemLength&&(t=this._itemLength),this._view.subarray(e,t))}push(e){this._view[this._itemLength]=e,this._itemLength++,this._itemLength>=this._view.length&&this._growArray()}_growArray(){const e=Math.floor(this._view.length*OL),t=new Float32Array(e);t.set(this._view),this._view=t}}const rn=1800,DL=24,NL="0",fm="timestamp",pm="numPoints",FL=/\r/g,lu="@";class Kr{static get SliceDataOffset(){return 2}static get NumberOfPointsOffset(){return 1}constructor(e,t){this._scene=e,this._collectDataAtFrame=()=>{const i=hr.Now-this._startingTimestamp,r=this.datasets.ids.length,s=this.datasets.startingIndices.itemLength;let o=0;if(s>0){const a=this.datasets.startingIndices.at(s-1);o=a+this.datasets.data.at(a+Kr.NumberOfPointsOffset)+Kr.SliceDataOffset}if(this.datasets.startingIndices.push(o),this.datasets.data.push(i),this.datasets.data.push(r),this.datasets.ids.forEach(a=>{const l=this._strategies.get(a);l&&this.datasets.data.push(l.getData())}),this.datasetObservable.hasObservers()){const a=[i,r];for(let l=0;l<r;l++)a.push(this.datasets.data.at(o+Kr.SliceDataOffset+l));this.datasetObservable.notifyObservers(a)}},this.datasets={ids:[],data:new tn(rn),startingIndices:new tn(rn)},this._strategies=new Map,this._datasetMeta=new Map,this._eventRestoreSet=new Set,this._customEventObservable=new he,this.datasetObservable=new he,this.metadataObservable=new he(i=>i.callback(this._datasetMeta,new q_(0))),t&&this.addCollectionStrategies(...t)}registerEvent(e,t,i){var r;if(this._strategies.has(e)&&!t)return;this._strategies.has(e)&&t&&((r=this._strategies.get(e))==null||r.dispose(),this._strategies.delete(e));const s=a=>{let l=0,h=0;const c=a.onAfterRenderObservable.add(()=>{h=l,l=0}),u=this._customEventObservable.add(d=>{e===d.name&&(d.value!==void 0?l=d.value:l++)});return{id:e,getData:()=>h,dispose:()=>{a.onAfterRenderObservable.remove(c),this._customEventObservable.remove(u)}}},o={name:e};return this._eventRestoreSet.add(e),this.addCollectionStrategies({strategyCallback:s,category:i}),o}sendEvent(e){this._customEventObservable.notifyObservers(e)}_restoreStringEvents(){this._eventRestoreSet.size!==this._customEventObservable.observers.length&&this._eventRestoreSet.forEach(e=>{this.registerEvent(e,!0)})}addCollectionStrategies(...e){for(let{strategyCallback:t,category:i,hidden:r}of e){const s=t(this._scene);if(this._strategies.has(s.id)){s.dispose();continue}this.datasets.ids.push(s.id),i&&(i=i.replace(new RegExp(lu,"g"),"")),this._datasetMeta.set(s.id,{color:this._getHexColorFromId(s.id),category:i,hidden:r}),this._strategies.set(s.id,s)}this.metadataObservable.notifyObservers(this._datasetMeta)}_getHexColorFromId(e){let t=0;for(let r=0;r<e.length;r++)t=e.charCodeAt(r)+((t<<5)-t);let i="#";for(let r=0;r<DL;r+=8){const s=t>>r&255;i+=(NL+s.toString(16)).substr(-2)}return i}getCurrentSlice(){const e=hr.Now-this._startingTimestamp,t=this.datasets.ids.length,i=[e,t];this.datasets.ids.forEach(r=>{const s=this._strategies.get(r);s&&this.datasetObservable.hasObservers()&&i.push(s.getData())}),this.datasetObservable.hasObservers()&&this.datasetObservable.notifyObservers(i)}updateMetadata(e,t,i){const r=this._datasetMeta.get(e);r&&(r[t]=i,this.metadataObservable.notifyObservers(this._datasetMeta))}clear(e){this.datasets.data=new tn(rn),this.datasets.ids.length=0,this.datasets.startingIndices=new tn(rn),this._datasetMeta.clear(),this._strategies.forEach(t=>t.dispose()),this._strategies.clear(),e||this._eventRestoreSet.clear(),this._hasLoadedData=!1}get hasLoadedData(){return this._hasLoadedData}loadFromFileData(e,t){const i=e.replace(FL,"").split(`
`).map(u=>u.split(",").filter(d=>d.length>0)).filter(u=>u.length>0),r=0,s=Kr.NumberOfPointsOffset;if(i.length<2)return!1;const o={ids:[],data:new tn(rn),startingIndices:new tn(rn)},[a,...l]=i;if(a.length<2||a[r]!==fm||a[s]!==pm)return!1;const h=new Map;for(let u=Kr.SliceDataOffset;u<a.length;u++){const[d,f]=a[u].split(lu);o.ids.push(d),h.set(d,f)}let c=0;for(const u of l){if(u.length<2)return!1;const d=parseFloat(u[r]),f=parseInt(u[s]);if(isNaN(f)||isNaN(d)||(o.data.push(d),o.data.push(f),f+Kr.SliceDataOffset!==u.length))return!1;for(let p=Kr.SliceDataOffset;p<u.length;p++){const g=parseFloat(u[p]);if(isNaN(g))return!1;o.data.push(g)}o.startingIndices.push(c),c+=u.length}if(this.datasets.ids=o.ids,this.datasets.data=o.data,this.datasets.startingIndices=o.startingIndices,t||this._datasetMeta.clear(),this._strategies.forEach(u=>u.dispose()),this._strategies.clear(),!t)for(const u of this.datasets.ids){const d=h.get(u);this._datasetMeta.set(u,{category:d,color:this._getHexColorFromId(u)})}return this.metadataObservable.notifyObservers(this._datasetMeta),this._hasLoadedData=!0,!0}exportDataToCsv(){let e="";e+=`${fm},${pm}`;for(let i=0;i<this.datasets.ids.length;i++)if(e+=`,${this.datasets.ids[i]}`,this._datasetMeta){const r=this._datasetMeta.get(this.datasets.ids[i]);r!=null&&r.category&&(e+=`${lu}${r.category}`)}e+=`
`;for(let i=0;i<this.datasets.startingIndices.itemLength;i++){const r=this.datasets.startingIndices.at(i),s=this.datasets.data.at(r),o=this.datasets.data.at(r+Kr.NumberOfPointsOffset);e+=`${s},${o}`;for(let a=0;a<o;a++)e+=`,${this.datasets.data.at(r+Kr.SliceDataOffset+a)}`;for(let a=0;a<this.datasets.ids.length-o;a++)e+=",";e+=`
`}const t=`${new Date().toISOString()}-perfdata.csv`;ge.Download(new Blob([e],{type:"text/csv"}),t)}start(e){e?this._startingTimestamp===void 0&&(this._startingTimestamp=hr.Now):(this.datasets.data=new tn(rn),this.datasets.startingIndices=new tn(rn),this._startingTimestamp=hr.Now),this._scene.onAfterRenderObservable.add(this._collectDataAtFrame),this._restoreStringEvents(),this._isStarted=!0}stop(){this._scene.onAfterRenderObservable.removeCallback(this._collectDataAtFrame),this._isStarted=!1}get isStarted(){return this._isStarted}dispose(){this._scene.onAfterRenderObservable.removeCallback(this._collectDataAtFrame),this._datasetMeta.clear(),this._strategies.forEach(e=>{e.dispose()}),this.datasetObservable.clear(),this.metadataObservable.clear(),this._isStarted=!1,this.datasets=null}}Pt.prototype.getPerfCollector=function(){return this._perfCollector||(this._perfCollector=new Kr(this)),this._perfCollector};function LL(n){const e=new Array,t=new Array,i=new Array,r=n.add(()=>{const s=e.length;for(let o=0;o<s;o++)dh(e.shift(),t.shift(),i.shift())});return{scheduler:(s,o,a)=>{e.push(s),t.push(o),i.push(a)},dispose:()=>{n.remove(r)}}}he.prototype.runCoroutineAsync=function(n){if(!this._coroutineScheduler){const e=LL(this);this._coroutineScheduler=e.scheduler,this._coroutineSchedulerDispose=e.dispose}return f0(n,this._coroutineScheduler)};he.prototype.cancelAllCoroutines=function(){this._coroutineSchedulerDispose&&this._coroutineSchedulerDispose(),this._coroutineScheduler=void 0,this._coroutineSchedulerDispose=void 0};const wL="copyTextureToTexturePixelShader",UL=`uniform float conversion;uniform sampler2D textureSampler;varying vec2 vUV;
#include<helperFunctions>
void main(void) 
{vec4 color=texture2D(textureSampler,vUV);
#ifdef DEPTH_TEXTURE
gl_FragDepth=color.r;
#else
if (conversion==1.) {color=toLinearSpace(color);} else if (conversion==2.) {color=toGammaSpace(color);}
gl_FragColor=color;
#endif
}
`;Y.ShadersStore[wL]=UL;var gm;(function(n){n[n.None=0]="None",n[n.ToLinearSpace=1]="ToLinearSpace",n[n.ToGammaSpace=2]="ToGammaSpace"})(gm||(gm={}));Za.prototype.removeReflectionProbe=function(n){if(!this.reflectionProbes)return-1;const e=this.reflectionProbes.indexOf(n);return e!==-1&&this.reflectionProbes.splice(e,1),e};Za.prototype.addReflectionProbe=function(n){this.reflectionProbes||(this.reflectionProbes=[]),this.reflectionProbes.push(n)};class sc{constructor(e,t,i,r=!0,s=!1,o=!1){if(this.name=e,this._viewMatrix=U.Identity(),this._target=v.Zero(),this._add=v.Zero(),this._invertYAxis=!1,this.position=v.Zero(),this.metadata=null,this._parentContainer=null,this._scene=i,i.getEngine().supportsUniformBuffers){this._sceneUBOs=[];for(let c=0;c<6;++c)this._sceneUBOs.push(i.createSceneUniformBuffer(`Scene for Reflection Probe (name "${e}") face #${c}`))}this._scene.reflectionProbes||(this._scene.reflectionProbes=[]),this._scene.reflectionProbes.push(this);let a=0;if(s){const c=this._scene.getEngine().getCaps();c.textureHalfFloatRender?a=2:c.textureFloatRender&&(a=1)}this._renderTargetTexture=new vr(e,t,i,r,!0,a,!0),this._renderTargetTexture.gammaSpace=!o,this._renderTargetTexture.invertZ=i.useRightHandedSystem;const l=i.getEngine().useReverseDepthBuffer;this._renderTargetTexture.onBeforeRenderObservable.add(c=>{switch(this._sceneUBOs&&(i.setSceneUniformBuffer(this._sceneUBOs[c]),i.getSceneUniformBuffer().unbindEffect()),c){case 0:this._add.copyFromFloats(1,0,0);break;case 1:this._add.copyFromFloats(-1,0,0);break;case 2:this._add.copyFromFloats(0,this._invertYAxis?1:-1,0);break;case 3:this._add.copyFromFloats(0,this._invertYAxis?-1:1,0);break;case 4:this._add.copyFromFloats(0,0,i.useRightHandedSystem?-1:1);break;case 5:this._add.copyFromFloats(0,0,i.useRightHandedSystem?1:-1);break}this._attachedMesh&&this.position.copyFrom(this._attachedMesh.getAbsolutePosition()),this.position.addToRef(this._add,this._target);const u=i.useRightHandedSystem?U.LookAtRHToRef:U.LookAtLHToRef,d=i.useRightHandedSystem?U.PerspectiveFovRH:U.PerspectiveFovLH;u(this.position,this._target,v.Up(),this._viewMatrix),i.activeCamera&&(this._projectionMatrix=d(Math.PI/2,1,l?i.activeCamera.maxZ:i.activeCamera.minZ,l?i.activeCamera.minZ:i.activeCamera.maxZ,this._scene.getEngine().isNDCHalfZRange),i.setTransformMatrix(this._viewMatrix,this._projectionMatrix),i.activeCamera.isRigCamera&&!this._renderTargetTexture.activeCamera&&(this._renderTargetTexture.activeCamera=i.activeCamera.rigParent||null)),i._forcedViewPosition=this.position});let h;this._renderTargetTexture.onBeforeBindObservable.add(()=>{var c,u;this._currentSceneUBO=i.getSceneUniformBuffer(),(u=(c=i.getEngine())._debugPushGroup)==null||u.call(c,`reflection probe generation for ${e}`,1),h=this._scene.imageProcessingConfiguration.applyByPostProcess,o&&(i.imageProcessingConfiguration.applyByPostProcess=!0)}),this._renderTargetTexture.onAfterUnbindObservable.add(()=>{var c,u;i.imageProcessingConfiguration.applyByPostProcess=h,i._forcedViewPosition=null,this._sceneUBOs&&i.setSceneUniformBuffer(this._currentSceneUBO),i.updateTransformMatrix(!0),(u=(c=i.getEngine())._debugPopGroup)==null||u.call(c,1)})}get samples(){return this._renderTargetTexture.samples}set samples(e){this._renderTargetTexture.samples=e}get refreshRate(){return this._renderTargetTexture.refreshRate}set refreshRate(e){this._renderTargetTexture.refreshRate=e}getScene(){return this._scene}get cubeTexture(){return this._renderTargetTexture}get renderList(){return this._renderTargetTexture.renderList}set renderList(e){this._renderTargetTexture.renderList=e}attachToMesh(e){this._attachedMesh=e}setRenderingAutoClearDepthStencil(e,t){this._renderTargetTexture.setRenderingAutoClearDepthStencil(e,t)}dispose(){const e=this._scene.reflectionProbes.indexOf(this);if(e!==-1&&this._scene.reflectionProbes.splice(e,1),this._parentContainer){const t=this._parentContainer.reflectionProbes.indexOf(this);t>-1&&this._parentContainer.reflectionProbes.splice(t,1),this._parentContainer=null}if(this._renderTargetTexture&&(this._renderTargetTexture.dispose(),this._renderTargetTexture=null),this._sceneUBOs){for(const t of this._sceneUBOs)t.dispose();this._sceneUBOs=[]}}toString(e){let t="Name: "+this.name;return e&&(t+=", position: "+this.position.toString(),this._attachedMesh&&(t+=", attached mesh: "+this._attachedMesh.name)),t}getClassName(){return"ReflectionProbe"}serialize(){const e=Le.Serialize(this,this._renderTargetTexture.serialize());return e.isReflectionProbe=!0,e.metadata=this.metadata,e}static Parse(e,t,i){let r=null;if(t.reflectionProbes)for(let s=0;s<t.reflectionProbes.length;s++){const o=t.reflectionProbes[s];if(o.name===e.name){r=o;break}}return r=Le.Parse(()=>r||new sc(e.name,e.renderTargetSize,t,e._generateMipMaps),e,t,i),r.cubeTexture._waitingRenderList=e.renderList,e._attachedMesh&&r.attachToMesh(t.getMeshById(e._attachedMesh)),e.metadata&&(r.metadata=e.metadata),r}}M([Ty()],sc.prototype,"_attachedMesh",void 0);M([mn()],sc.prototype,"position",void 0);class VL{constructor(e){this.name=ze.NAME_PROCEDURALTEXTURE,this.scene=e,this.scene.proceduralTextures=[]}register(){this.scene._beforeClearStage.registerStep(ze.STEP_BEFORECLEAR_PROCEDURALTEXTURE,this,this._beforeClear)}rebuild(){}dispose(){}_beforeClear(){if(this.scene.proceduralTexturesEnabled){ge.StartPerformanceCounter("Procedural textures",this.scene.proceduralTextures.length>0);for(let e=0;e<this.scene.proceduralTextures.length;e++){const t=this.scene.proceduralTextures[e];t._shouldRender()&&t.render()}ge.EndPerformanceCounter("Procedural textures",this.scene.proceduralTextures.length>0)}}}const BL="proceduralVertexShader",kL=`attribute vec2 position;varying vec2 vPosition;varying vec2 vUV;const vec2 madd=vec2(0.5,0.5);
#define CUSTOM_VERTEX_DEFINITIONS
void main(void) {
#define CUSTOM_VERTEX_MAIN_BEGIN
vPosition=position;vUV=position*madd+madd;gl_Position=vec4(position,0.0,1.0);
#define CUSTOM_VERTEX_MAIN_END
}`;Y.ShadersStore[BL]=kL;class En extends le{constructor(e,t,i,r,s=null,o=!0,a=!1,l=0){super(null,r,!o),this.isEnabled=!0,this.autoClear=!0,this.onGeneratedObservable=new he,this.onBeforeGenerationObservable=new he,this.nodeMaterialSource=null,this._textures={},this._currentRefreshId=-1,this._frameId=-1,this._refreshRate=1,this._vertexBuffers={},this._uniforms=new Array,this._samplers=new Array,this._floats={},this._ints={},this._floatsArrays={},this._colors3={},this._colors4={},this._vectors2={},this._vectors3={},this._matrices={},this._fallbackTextureUsed=!1,this._cachedDefines=null,this._contentUpdateId=-1,this._rtWrapper=null,s!==null&&!(s instanceof le)?(this._options=s,this._fallbackTexture=s.fallbackTexture??null):(this._options={},this._fallbackTexture=s),r=this.getScene()||rt.LastCreatedScene;let h=r._getComponent(ze.NAME_PROCEDURALTEXTURE);h||(h=new VL(r),r._addComponent(h)),r.proceduralTextures.push(this),this._fullEngine=r.getEngine(),this.name=e,this.isRenderTarget=!0,this._size=t,this._textureType=l,this._generateMipMaps=o,this._drawWrapper=new Ko(this._fullEngine),this.setFragment(i);const c=this._createRtWrapper(a,t,o,l);this._texture=c.texture;const u=[];u.push(1,1),u.push(-1,1),u.push(-1,-1),u.push(1,-1),this._vertexBuffers[b.PositionKind]=new b(this._fullEngine,u,b.PositionKind,!1,!1,2),this._createIndexBuffer()}_createRtWrapper(e,t,i,r){return e?(this._rtWrapper=this._fullEngine.createRenderTargetCubeTexture(t,{generateMipMaps:i,generateDepthBuffer:!1,generateStencilBuffer:!1,type:r,...this._options}),this.setFloat("face",0)):this._rtWrapper=this._fullEngine.createRenderTargetTexture(t,{generateMipMaps:i,generateDepthBuffer:!1,generateStencilBuffer:!1,type:r,...this._options}),this._rtWrapper}getEffect(){return this._drawWrapper.effect}_setEffect(e){this._drawWrapper.effect=e}getContent(){return this._contentData&&this._frameId===this._contentUpdateId?this._contentData:(this._contentData?this._contentData.then(e=>{this._contentData=this.readPixels(0,0,e),this._contentUpdateId=this._frameId}):(this._contentData=this.readPixels(0,0),this._contentUpdateId=this._frameId),this._contentData)}_createIndexBuffer(){const e=this._fullEngine,t=[];t.push(0),t.push(1),t.push(2),t.push(0),t.push(2),t.push(3),this._indexBuffer=e.createIndexBuffer(t)}_rebuild(){const e=this._vertexBuffers[b.PositionKind];e&&e._rebuild(),this._createIndexBuffer(),this.refreshRate===vr.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=vr.REFRESHRATE_RENDER_ONCE)}reset(){var e;(e=this._drawWrapper.effect)==null||e.dispose(),this._drawWrapper.effect=null,this._cachedDefines=null}_getDefines(){return""}executeWhenReady(e){if(this.isReady()){e(this);return}const t=this.getEffect();t&&t.executeWhenCompiled(()=>{e(this)})}isReady(){const e=this._fullEngine;if(this.nodeMaterialSource)return this._drawWrapper.effect.isReady();if(!this._fragment)return!1;if(this._fallbackTextureUsed)return!0;if(!this._texture)return!1;const t=this._getDefines();if(this._drawWrapper.effect&&t===this._cachedDefines&&this._drawWrapper.effect.isReady())return!0;const i={vertex:"procedural",fragmentElement:this._fragment.fragmentElement,fragmentSource:this._fragment.fragmentSource,fragment:typeof this._fragment=="string"?this._fragment:void 0};return this._cachedDefines!==t&&(this._cachedDefines=t,this._drawWrapper.effect=e.createEffect(i,[b.PositionKind],this._uniforms,this._samplers,t,void 0,void 0,()=>{var r;(r=this._rtWrapper)==null||r.dispose(),this._rtWrapper=this._texture=null,this._fallbackTexture&&(this._texture=this._fallbackTexture._texture,this._texture&&this._texture.incrementReferences()),this._fallbackTextureUsed=!0})),this._drawWrapper.effect.isReady()}resetRefreshCounter(){this._currentRefreshId=-1}setFragment(e){this._fragment=e}get refreshRate(){return this._refreshRate}set refreshRate(e){this._refreshRate=e,this.resetRefreshCounter()}_shouldRender(){return!this.isEnabled||!this.isReady()||!this._texture?(this._texture&&(this._texture.isReady=!1),!1):this._fallbackTextureUsed?!1:this._currentRefreshId===-1?(this._currentRefreshId=1,this._frameId++,!0):this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,this._frameId++,!0):(this._currentRefreshId++,!1)}getRenderSize(){return this._size}resize(e,t){if(this._fallbackTextureUsed||!this._rtWrapper||!this._texture)return;const i=this._texture.isCube;this._rtWrapper.dispose();const r=this._createRtWrapper(i,e,t,this._textureType);this._texture=r.texture,this._size=e,this._generateMipMaps=t}_checkUniform(e){this._uniforms.indexOf(e)===-1&&this._uniforms.push(e)}setTexture(e,t){return this._samplers.indexOf(e)===-1&&this._samplers.push(e),this._textures[e]=t,this}setFloat(e,t){return this._checkUniform(e),this._floats[e]=t,this}setInt(e,t){return this._checkUniform(e),this._ints[e]=t,this}setFloats(e,t){return this._checkUniform(e),this._floatsArrays[e]=t,this}setColor3(e,t){return this._checkUniform(e),this._colors3[e]=t,this}setColor4(e,t){return this._checkUniform(e),this._colors4[e]=t,this}setVector2(e,t){return this._checkUniform(e),this._vectors2[e]=t,this}setVector3(e,t){return this._checkUniform(e),this._vectors3[e]=t,this}setMatrix(e,t){return this._checkUniform(e),this._matrices[e]=t,this}render(e){var t,i;const r=this.getScene();if(!r)return;const s=this._fullEngine;if(s.enableEffect(this._drawWrapper),this.onBeforeGenerationObservable.notifyObservers(this),s.setState(!1),!this.nodeMaterialSource){for(const a in this._textures)this._drawWrapper.effect.setTexture(a,this._textures[a]);for(const a in this._ints)this._drawWrapper.effect.setInt(a,this._ints[a]);for(const a in this._floats)this._drawWrapper.effect.setFloat(a,this._floats[a]);for(const a in this._floatsArrays)this._drawWrapper.effect.setArray(a,this._floatsArrays[a]);for(const a in this._colors3)this._drawWrapper.effect.setColor3(a,this._colors3[a]);for(const a in this._colors4){const l=this._colors4[a];this._drawWrapper.effect.setFloat4(a,l.r,l.g,l.b,l.a)}for(const a in this._vectors2)this._drawWrapper.effect.setVector2(a,this._vectors2[a]);for(const a in this._vectors3)this._drawWrapper.effect.setVector3(a,this._vectors3[a]);for(const a in this._matrices)this._drawWrapper.effect.setMatrix(a,this._matrices[a])}if(!this._texture||!this._rtWrapper)return;(t=s._debugPushGroup)==null||t.call(s,`procedural texture generation for ${this.name}`,1);const o=s.currentViewport;if(this.isCube)for(let a=0;a<6;a++)s.bindFramebuffer(this._rtWrapper,a,void 0,void 0,!0),s.bindBuffers(this._vertexBuffers,this._indexBuffer,this._drawWrapper.effect),this._drawWrapper.effect.setFloat("face",a),this.autoClear&&s.clear(r.clearColor,!0,!1,!1),s.drawElementsType(ie.TriangleFillMode,0,6);else s.bindFramebuffer(this._rtWrapper,0,void 0,void 0,!0),s.bindBuffers(this._vertexBuffers,this._indexBuffer,this._drawWrapper.effect),this.autoClear&&s.clear(r.clearColor,!0,!1,!1),s.drawElementsType(ie.TriangleFillMode,0,6);s.unBindFramebuffer(this._rtWrapper,this.isCube),o&&s.setViewport(o),this.isCube&&s.generateMipMapsForCubemap(this._texture),(i=s._debugPopGroup)==null||i.call(s,1),this.onGenerated&&this.onGenerated(),this.onGeneratedObservable.notifyObservers(this)}clone(){const e=this.getSize(),t=new En(this.name,e.width,this._fragment,this.getScene(),this._fallbackTexture,this._generateMipMaps);return t.hasAlpha=this.hasAlpha,t.level=this.level,t.coordinatesMode=this.coordinatesMode,t}dispose(){const e=this.getScene();if(!e)return;const t=e.proceduralTextures.indexOf(this);t>=0&&e.proceduralTextures.splice(t,1);const i=this._vertexBuffers[b.PositionKind];i&&(i.dispose(),this._vertexBuffers[b.PositionKind]=null),this._indexBuffer&&this._fullEngine._releaseBuffer(this._indexBuffer)&&(this._indexBuffer=null),this.onGeneratedObservable.clear(),this.onBeforeGenerationObservable.clear(),super.dispose()}}M([V()],En.prototype,"isEnabled",void 0);M([V()],En.prototype,"autoClear",void 0);M([V()],En.prototype,"_generateMipMaps",void 0);M([V()],En.prototype,"_size",void 0);M([V()],En.prototype,"refreshRate",null);ye("BABYLON.ProceduralTexture",En);const zL="equirectangularPanoramaPixelShader",GL=`#ifdef GL_ES
precision highp float;
#endif
#define M_PI 3.1415926535897932384626433832795
varying vec2 vUV;uniform samplerCube cubeMap;void main(void) {vec2 uv=vUV;float longitude=uv.x*2.*M_PI-M_PI+M_PI/2.;float latitude=(1.-uv.y)*M_PI;vec3 dir=vec3(
- sin( longitude )*sin( latitude ),
cos( latitude ),
- cos( longitude )*sin( latitude )
);normalize( dir );gl_FragColor=textureCube( cubeMap,dir );}`;Y.ShadersStore[zL]=GL;function WL(n){return this.selected.forEach((e,t)=>{let i=n instanceof Function?n(e.metadata.data,t):n;it.AddTagsTo(e,i)}),this}function XL(n){return this.selected.forEach(e=>it.RemoveTagsFrom(e,n)),this}function HL(n){let e=[];return this.selected.forEach(t=>{n===void 0?e.push({node:t,value:it.HasTags(t)}):e.push({node:t,value:it.MatchesQuery(t,n)})}),e}function KL(n){return this.selected.forEach((e,t)=>{var i,r,s;e instanceof Hl?n instanceof Function?(r=e.actionManager)==null||r.registerAction(n((i=e.metadata).data??(i.data={}),e,t)):(s=e.actionManager)==null||s.registerAction(n):console.log("Node not a mesh, skipping.")}),this}function qL(n){return this.prop("material",n),this}function YL(n){return this.prop("material.diffuseColor",n),this}function ZL(n){return this.prop("material.specularColor",n),this}function jL(n){return this.prop("material.emissiveColor",n),this}function QL(n){return this.prop("material.ambientColor",n),this}function JL(n){return this.prop("material.diffuseTexture",n),this}function $L(n){return this.prop("material.specularTexture",n),this}function e2(n){return this.prop("material.emissiveTexture",n),this}function t2(n){return this.prop("material.ambientTexture",n),this}function i2(n,e){return this.selected.forEach((t,i)=>{t instanceof ji?t.registerInstancedBuffer(n,e):console.log("Node not a mesh skipping")}),this}function r2(n,e){return this.selected.forEach((t,i)=>{t instanceof V_?t.instancedBuffers[n]=e instanceof Function?e(t.metadata.data,i):e:console.log("Node not a mesh, skipping.")}),this}var s2=function(){try{var n=Wd(Object,"defineProperty");return n({},"",{}),n}catch{}}();const Eh=s2;function Pv(n,e,t){e=="__proto__"&&Eh?Eh(n,e,{configurable:!0,enumerable:!0,value:t,writable:!0}):n[e]=t}var n2=Object.prototype,o2=n2.hasOwnProperty;function Zd(n,e,t){var i=n[e];(!(o2.call(n,e)&&Xd(i,t))||t===void 0&&!(e in n))&&Pv(n,e,t)}var a2=9007199254740991,l2=/^(?:0|[1-9]\d*)$/;function nc(n,e){var t=typeof n;return e=e??a2,!!e&&(t=="number"||t!="symbol"&&l2.test(n))&&n>-1&&n%1==0&&n<e}function h2(n,e,t,i){if(!Oa(n))return n;e=Kd(e,n);for(var r=-1,s=e.length,o=s-1,a=n;a!=null&&++r<s;){var l=qd(e[r]),h=t;if(l==="__proto__"||l==="constructor"||l==="prototype")return n;if(r!=o){var c=a[l];h=i?i(c,l,a):void 0,h===void 0&&(h=Oa(c)?c:nc(e[r+1])?[]:{})}Zd(a,l,h),a=a[l]}return n}function oc(n,e,t){return n==null?n:h2(n,e,t)}function c2(n,e){return n!=null&&e in Object(n)}var u2="[object Arguments]";function mm(n){return Jh(n)&&Qh(n)==u2}var Ov=Object.prototype,d2=Ov.hasOwnProperty,f2=Ov.propertyIsEnumerable,p2=mm(function(){return arguments}())?mm:function(n){return Jh(n)&&d2.call(n,"callee")&&!f2.call(n,"callee")};const Dv=p2;var g2=9007199254740991;function jd(n){return typeof n=="number"&&n>-1&&n%1==0&&n<=g2}function m2(n,e,t){e=Kd(e,n);for(var i=-1,r=e.length,s=!1;++i<r;){var o=qd(e[i]);if(!(s=n!=null&&t(n,o)))break;n=n[o]}return s||++i!=r?s:(r=n==null?0:n.length,!!r&&jd(r)&&nc(o,r)&&(el(n)||Dv(n)))}function Qd(n,e){return n!=null&&m2(n,e,c2)}function _2(n,e){return this.selected.forEach((t,i)=>{t instanceof dn?Iv(t,n)!=null?oc(t,n,e instanceof Function?e(t.metadata.data,i):e):console.error(n+" not a property of "+t):console.warn("Node not a mesh, skipping.")}),this}function v2(n,e){return this.selected.forEach((t,i)=>{var r;Qd(t,n)?oc(t,n,e instanceof Function?e((r=t.metadata).data??(r.data={}),t,i):e):console.error(n+" not a property of "+t)}),this}function E2(n){return this.selected.forEach((e,t)=>{var i;for(let r in n)Qd(e,r)?oc(e,r,n[r]instanceof Function?n[r]((i=e.metadata).data??(i.data={}),e,t):n[r]):console.log(r+" not property of "+e)}),this}function T2(n){return this.selected.forEach((e,t)=>{var i;n((i=e.metadata).data??(i.data={}),e,t)}),this}function x2(n){return this.selected.forEach((e,t)=>{n!=null?n(e,t)&&e.dispose():e.dispose()}),this}function _m(n){return this.selected.forEach((e,t)=>{if(e instanceof ji&&e.material!==null){let i=e.material.diffuseTexture;i instanceof Uh?i.scale(n instanceof Function?n(e,t):n):console.log("Not a dynamic texture, skipping")}}),this}function C2(n,e,t=null,i=null,r=null,s=null){return this.selected.forEach((o,a)=>{if(o instanceof ji&&o.material!==null){let l=o.material.diffuseTexture;l instanceof Uh?l.drawText(n instanceof Function?n(o,a):n,t instanceof Function?t(o,a):t,i instanceof Function?i(o,a):i,e instanceof Function?e(o,a):e,r instanceof Function?r(o,a):r,s instanceof Function?s(o,a):s):console.log("Not a dynamic texture, skipping")}}),this}function R2(n=""){let e=this.selected[0],t=e instanceof ji?e.getBoundingInfo().boundingBox.minimumWorld:e instanceof dn?this.selected[0].position:new _e,i=e instanceof ji?e.getBoundingInfo().boundingBox.maximumWorld:e instanceof dn?this.selected[0].position:new _e;return this.selected.forEach((r,s)=>{r.computeWorldMatrix(!0),(r.getChildMeshes().length>0?r.getChildMeshes():[r]).forEach((o,a)=>{if(o.computeWorldMatrix(!0),o instanceof ji&&!Ur.MatchesQuery(Ur.HasTags(o)?Ur.GetTags(o):"",n)){let l=o.getBoundingInfo().boundingBox.minimumWorld,h=o.getBoundingInfo().boundingBox.maximumWorld;t=_e.Minimize(t,l),i=_e.Maximize(i,h)}else t=_e.Minimize(t,o.position),i=_e.Maximize(i,o.position)})}),new Un(t,i)}function S2(n){let e=[];return this.selected.forEach((t,i)=>{var r;n((r=t.metadata).data??(r.data={}),t,i)&&e.push(t)}),new ai(e,this.scene)}function y2(n){return this.prop("name",n),this}function b2(n){return this.prop("id",n),this}function I2(n,e){return this.selected.forEach((t,i)=>{Qd(t,"metadata")?oc(t,"metadata",e instanceof Function?{...t.metadata,key:e(t.metadata.data,t,i)}:{...t.metadata,key:e}):console.error("metadata not a property of "+t)}),this}function A2(n={}){return this.selected.forEach(e=>{let{min:t,max:i}=e.getHierarchyBoundingVectors(!0,g=>!Ur.MatchesQuery(g,"exclude")),r=new Un(t,i),s=n.name||e.name+"PositionUI",o=n.width||r.boundingBox.extendSize.x*.5,a=n.radius||o*.05,l=n.position||new _e(0,-r.boundingBox.extendSize.y,-Math.hypot(r.boundingBox.extendSize.x,r.boundingBox.extendSize.z)),h=n.offset||new _e(0,-a*2.5,0),c=n.billboard||0,u;n.material===void 0?(u=new Ws("PositionUIMat",this.scene),u.diffuseColor=n.diffuseColor||_i.White()):u=n.material;let d=n.visibility||1,f;n.behavior===void 0?(f=new DR,f.faceCameraOnDragStart=!0,f.rotateAroundYOnly=!0,f.zDragFactor=100):f=n.behavior;let p=Ka("container",s+"Container",{calculateBounds:!1},this.scene);p.setParent(e),p.setBoundingInfo(r),p.isPickable=!1,p.billboardMode=c,new ai([p],this.scene).bind("capsule",{height:o,radius:a}).name(s).position(l.addInPlace(h)).rotation(new _e(0,0,1.57)).material(u).prop("visibility",d).action((g,m,x)=>new Xs(es.OnPickDownTrigger,()=>{e.addBehavior(f)})).action((g,m,x)=>new Xs(es.OnPickOutTrigger,()=>{e.removeBehavior(f)})).action((g,m,x)=>new Xs(es.OnPickUpTrigger,()=>{e.removeBehavior(f)})).addTags("exclude")}),this}function M2(n={}){return this.selected.forEach(e=>{let{min:t,max:i}=e.getHierarchyBoundingVectors(!0,m=>!Ur.MatchesQuery(m,"exclude")),r=new Un(t,i),s=n.name||e.name+"ScaleUI",o=n.diameter||r.boundingBox.extendSize.x*.5*.05*2,a=n.position||new _e(0,-r.boundingBox.extendSize.y,-Math.hypot(r.boundingBox.extendSize.x,r.boundingBox.extendSize.z)),l=n.offset||new _e(r.boundingBox.extendSize.x*.5*1.5/2,-o/2*2.5,0),h=n.billboard||0,c;n.material===void 0?(c=new Ws("PositionUIMat",this.scene),c.diffuseColor=n.diffuseColor||_i.White()):c=n.material;let u=n.visibility||1,d;n.behavior===void 0?(d=new ql({dragAxis:new _e(0,1,0)}),d.moveAttached=!1):d=n.behavior;let f=n.minimum||-1/0,p=n.maximum||1/0,g=Ka("container",s+"Container",{calculateBounds:!1},this.scene);g.setParent(e),g.setBoundingInfo(r),g.isPickable=!1,g.billboardMode=h,new ai([g],this.scene).bind("sphere",{diameter:o}).name(s).position(a.addInPlace(l)).rotation(new _e(0,0,1.57)).material(c).prop("visibility",u).addTags("exclude").action((m,x,E)=>new Xs(es.OnPickDownTrigger,()=>{x.addBehavior(d)})).action((m,x,E)=>new Xs(es.OnPickOutTrigger,()=>{x.removeBehavior(d)})).action((m,x,E)=>new Xs(es.OnPickUpTrigger,()=>{x.removeBehavior(d)})),d.onDragObservable.add(m=>{let x=-m.dragDistance,E=e.scaling.add(new _e(x,x,x));if(!(E.x<f)){if(E.x>p)return;e.scaling=E}})}),this}function P2(n={}){return this.selected.forEach(e=>{let{min:t,max:i}=e.getHierarchyBoundingVectors(!0,x=>!Ur.MatchesQuery(x,"exclude")),r=new Un(t,i),s=n.name||e.name+"ScaleUI",o=n.billboard||0,a=n.axis||{x:!0,y:!0,z:!0},l=n.diameter||r.boundingBox.extendSize.x*.5*.05*2,h=n.thickness||l/2,c=n.position||new _e(0,-r.boundingBox.extendSize.y,-Math.hypot(r.boundingBox.extendSize.x,r.boundingBox.extendSize.z)),u=n.offset||new _e(0,-l*2.5,0),d;n.material===void 0?(d=new Ws("PositionUIMat",this.scene),d.diffuseColor=n.diffuseColor||_i.White()):d=n.material;let f=n.visibility||1,p;p={x:new ql({dragAxis:new _e(1,0,0)}),y:new ql({dragAxis:new _e(1,0,0)}),z:new ql({dragAxis:new _e(1,0,0)})},p.x.moveAttached=!1,p.y.moveAttached=!1,p.z.moveAttached=!1;let g=[];Object.keys(a).forEach(x=>{a[x]==!0&&g.push({axis:x})});let m=Ka("container",s+"Container",{calculateBounds:!1},this.scene);m.setParent(e),m.setBoundingInfo(r),m.isPickable=!1,m.billboardMode=o,new ai([m],this.scene).bind("torus",{diameter:l,thickness:h},g).name((x,E,R)=>n.name??(n.name=E.name+"_scaleUI")).position(x=>x.axis=="x"?new _e(0,0,0).addInPlace(c).addInPlace(u):x.axis=="y"?new _e(l*1.5,0,0).addInPlace(c).addInPlace(u):x.axis=="z"?new _e(-l*1.5,0,0).addInPlace(c).addInPlace(u):new _e(0,0,0)).rotation(x=>x.axis=="x"?new _e(0,0,1.57):x.axis=="y"?new _e(0,0,0):x.axis=="z"?new _e(1.57,0,0):new _e(0,0,0)).material(d).prop("visibility",f).addTags("exclude").action((x,E,R)=>new Xs(es.OnPickDownTrigger,()=>{E.addBehavior(p[x.axis])})).action((x,E,R)=>new Xs(es.OnPickOutTrigger,()=>{E.removeBehavior(p[x.axis])})).action((x,E,R)=>new Xs(es.OnPickUpTrigger,()=>{E.removeBehavior(p[x.axis])})),p.x.onDragObservable.add(x=>{e.rotate(new _e(1,0,0),x.dragDistance,Fn.LOCAL)}),p.y.onDragObservable.add(x=>{e.rotate(new _e(0,-1,0),x.dragDistance,Fn.LOCAL)}),p.z.onDragObservable.add(x=>{e.rotate(new _e(0,0,-1),x.dragDistance,Fn.LOCAL)})}),this}class ai{constructor(e,t){this.select=wR,this.selectName=UR,this.selectId=VR,this.selectTag=BR,this.bind=AS,this.run=T2,this.bindInstance=MS,this.position=PS,this.positionX=OS,this.positionY=DS,this.positionZ=NS,this.translate=FS,this.rotation=LS,this.rotationX=wS,this.rotationY=US,this.rotationZ=VS,this.scaling=BS,this.scalingX=kS,this.scalingY=zS,this.scalingZ=GS,this.get=QN,this.attr=_2,this.addTags=WL,this.removeTags=XL,this.hasTags=HL,this.action=KL,this.material=qL,this.diffuseColor=YL,this.specularColor=ZL,this.emissiveColor=jL,this.ambientColor=QL,this.registerInstancedBuffer=i2,this.setInstancedBuffer=r2,this.dispose=x2,this.diffuseTexture=JL,this.specularTexture=$L,this.emissiveTexture=e2,this.ambientTexture=t2,this.scaleDT=_m,this.scaleToDT=_m,this.drawTextDT=C2,this.boundingBox=R2,this.filter=S2,this.props=E2,this.prop=v2,this.name=y2,this.id=b2,this.metadata=I2,this.positionUI=A2,this.scaleUI=M2,this.rotateUI=P2,this.selected=e,this.scene=t}}function bG(n,e){let t=n[0],i=n.slice(1),r=[];return t==="."?(r=e.getNodes().filter(s=>s.name==i),new ai(r,e)):t==="#"?(r=e.getNodes().filter(s=>s.id==i),new ai(r,e)):t==="$"?(r=e.getNodes().filter(s=>Ur.MatchesQuery(s,i)==!0),new ai(r,e)):new ai([],e)}function IG(n,e){let t=[];return Array.isArray(n)?n.forEach((i,r)=>t=[...t,...e.getNodes().filter(s=>s.name==i)]):t=e.getNodes().filter(i=>i.name==n),new ai(t,e)}function AG(n,e){let t=[];return Array.isArray(n)?n.forEach((i,r)=>t=[...t,...e.getNodes().filter(s=>s.name==i)]):t=e.getNodes().filter(i=>i.id==n),new ai(t,e)}function MG(n,e,t=[{}],i){let r=[];return t.forEach((s,o)=>{var a=Ka(n,n,e,s,i);r.push(a)}),new ai(r,r[0].getScene())}function O2(n,e,t,i){var r=!t;t||(t={});for(var s=-1,o=e.length;++s<o;){var a=e[s],l=i?i(t[a],n[a],a,t,n):void 0;l===void 0&&(l=n[a]),r?Pv(t,a,l):Zd(t,a,l)}return t}function Nv(n){return n}function D2(n,e,t){switch(t.length){case 0:return n.call(e);case 1:return n.call(e,t[0]);case 2:return n.call(e,t[0],t[1]);case 3:return n.call(e,t[0],t[1],t[2])}return n.apply(e,t)}var vm=Math.max;function N2(n,e,t){return e=vm(e===void 0?n.length-1:e,0),function(){for(var i=arguments,r=-1,s=vm(i.length-e,0),o=Array(s);++r<s;)o[r]=i[e+r];r=-1;for(var a=Array(e+1);++r<e;)a[r]=i[r];return a[e]=t(o),D2(n,this,a)}}function F2(n){return function(){return n}}var L2=Eh?function(n,e){return Eh(n,"toString",{configurable:!0,enumerable:!1,value:F2(e),writable:!0})}:Nv;const w2=L2;var U2=800,V2=16,B2=Date.now;function k2(n){var e=0,t=0;return function(){var i=B2(),r=V2-(i-t);if(t=i,r>0){if(++e>=U2)return arguments[0]}else e=0;return n.apply(void 0,arguments)}}var z2=k2(w2);const G2=z2;function W2(n,e){return G2(N2(n,e,Nv),n+"")}function Jd(n){return n!=null&&jd(n.length)&&!yv(n)}function X2(n,e,t){if(!Oa(t))return!1;var i=typeof e;return(i=="number"?Jd(t)&&nc(e,t.length):i=="string"&&e in t)?Xd(t[e],n):!1}function H2(n){return W2(function(e,t){var i=-1,r=t.length,s=r>1?t[r-1]:void 0,o=r>2?t[2]:void 0;for(s=n.length>3&&typeof s=="function"?(r--,s):void 0,o&&X2(t[0],t[1],o)&&(s=r<3?void 0:s,r=1),e=Object(e);++i<r;){var a=t[i];a&&n(e,a,i,s)}return e})}var K2=Object.prototype;function Fv(n){var e=n&&n.constructor,t=typeof e=="function"&&e.prototype||K2;return n===t}function q2(n,e){for(var t=-1,i=Array(n);++t<n;)i[t]=e(t);return i}function Y2(){return!1}var Lv=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Em=Lv&&typeof module=="object"&&module&&!module.nodeType&&module,Z2=Em&&Em.exports===Lv,Tm=Z2?jh.Buffer:void 0,j2=Tm?Tm.isBuffer:void 0,Q2=j2||Y2;const J2=Q2;var $2="[object Arguments]",ew="[object Array]",tw="[object Boolean]",iw="[object Date]",rw="[object Error]",sw="[object Function]",nw="[object Map]",ow="[object Number]",aw="[object Object]",lw="[object RegExp]",hw="[object Set]",cw="[object String]",uw="[object WeakMap]",dw="[object ArrayBuffer]",fw="[object DataView]",pw="[object Float32Array]",gw="[object Float64Array]",mw="[object Int8Array]",_w="[object Int16Array]",vw="[object Int32Array]",Ew="[object Uint8Array]",Tw="[object Uint8ClampedArray]",xw="[object Uint16Array]",Cw="[object Uint32Array]",ni={};ni[pw]=ni[gw]=ni[mw]=ni[_w]=ni[vw]=ni[Ew]=ni[Tw]=ni[xw]=ni[Cw]=!0;ni[$2]=ni[ew]=ni[dw]=ni[tw]=ni[fw]=ni[iw]=ni[rw]=ni[sw]=ni[nw]=ni[ow]=ni[aw]=ni[lw]=ni[hw]=ni[cw]=ni[uw]=!1;function Rw(n){return Jh(n)&&jd(n.length)&&!!ni[Qh(n)]}function Sw(n){return function(e){return n(e)}}var wv=typeof exports=="object"&&exports&&!exports.nodeType&&exports,va=wv&&typeof module=="object"&&module&&!module.nodeType&&module,yw=va&&va.exports===wv,hu=yw&&Rv.process,bw=function(){try{var n=va&&va.require&&va.require("util").types;return n||hu&&hu.binding&&hu.binding("util")}catch{}}();const xm=bw;var Cm=xm&&xm.isTypedArray,Iw=Cm?Sw(Cm):Rw;const Aw=Iw;var Mw=Object.prototype,Pw=Mw.hasOwnProperty;function Ow(n,e){var t=el(n),i=!t&&Dv(n),r=!t&&!i&&J2(n),s=!t&&!i&&!r&&Aw(n),o=t||i||r||s,a=o?q2(n.length,String):[],l=a.length;for(var h in n)(e||Pw.call(n,h))&&!(o&&(h=="length"||r&&(h=="offset"||h=="parent")||s&&(h=="buffer"||h=="byteLength"||h=="byteOffset")||nc(h,l)))&&a.push(h);return a}function Dw(n,e){return function(t){return n(e(t))}}var Nw=Dw(Object.keys,Object);const Fw=Nw;var Lw=Object.prototype,ww=Lw.hasOwnProperty;function Uw(n){if(!Fv(n))return Fw(n);var e=[];for(var t in Object(n))ww.call(n,t)&&t!="constructor"&&e.push(t);return e}function Vw(n){return Jd(n)?Ow(n):Uw(n)}var Bw=Object.prototype,kw=Bw.hasOwnProperty,zw=H2(function(n,e){if(Fv(e)||Jd(e)){O2(e,Vw(e),n);return}for(var t in e)kw.call(e,t)&&Zd(n,t,e[t])});const tr=zw;function Gw(){var n,e,t,i,r,s,o,a,l;let h=this.scales.x.scale,c=this.scales.x.range,u=this.scales.x.domain,d=this.scales.y.scale,f=this.scales.y.range,p=this.scales.y.domain,g=this.scales.z.scale,m=this.scales.z.range,x=this.scales.z.domain,E={},R=.02;if(((n=this.options.scale)==null?void 0:n.x)!=null){let C;if(((e=this.options.labelTicks)==null?void 0:e.x)!=null)C=this.options.labelTicks.x;else try{C=h.ticks()}catch{C=u}let _;((t=this.options.labelFormat)==null?void 0:t.x)!=null?_={text:P=>{var D;return(D=this.options.labelFormat)==null?void 0:D.x(P.text)},size:this.scales.size*R,atlas:this.options.atlas}:_={text:P=>P.text,size:this.scales.size*R,atlas:this.options.atlas};let T={},y=this.CoT.bind("planeText",tr({},_,this.options.labelOptions),C.map(P=>({text:P}))).prop("name",this.name+"_labelX").position((P,D,F)=>{let N=D.getChildMeshes()[0].getBoundingInfo().boundingBox;return new _e(h(P.text),f[0]-N.center.y*1.5,m[0]-N.center.y*1.5)}).props(tr({},T,this.options.labelProperties));E.x=y}if(((i=this.options.scale)==null?void 0:i.y)!=null){let C;if(((r=this.options.labelTicks)==null?void 0:r.y)!=null)C=this.options.labelTicks.y;else try{C=d.ticks()}catch{C=p}let _;((s=this.options.labelFormat)==null?void 0:s.y)!=null?_={text:P=>{var D;return(D=this.options.labelFormat)==null?void 0:D.y(P.text)},size:this.scales.size*R,atlas:this.options.atlas}:_={text:P=>P.text,size:this.scales.size*R,atlas:this.options.atlas};let T={},y=this.CoT.bind("planeText",tr({},_,this.options.labelOptions),C.map(P=>({text:P}))).prop("name",this.name+"_labelY").position((P,D,F)=>{let N=D.getChildMeshes()[0].getBoundingInfo().boundingBox;return new _e(c[0]-N.center._x-N.center.y*1.5,d(P.text),m[0]-N.center.y*1.5)}).props(tr({},T,this.options.labelProperties));E.y=y}if(((o=this.options.scale)==null?void 0:o.z)!=null){let C;if(((a=this.options.labelTicks)==null?void 0:a.z)!=null)C=this.options.labelTicks.z;else try{C=g.ticks()}catch{C=x}let _;((l=this.options.labelFormat)==null?void 0:l.z)!=null?_={text:P=>{var D;return(D=this.options.labelFormat)==null?void 0:D.z(P.text)},size:this.scales.size*R,atlas:this.options.atlas}:_={text:P=>P.text,size:this.scales.size*R,atlas:this.options.atlas};let T={"rotation.y":-Math.PI/2},y=this.CoT.bind("planeText",tr({},_,this.options.labelOptions),C.map(P=>({text:P}))).prop("name",this.name+"_labelZ").position((P,D,F)=>{let N=D.getChildMeshes()[0].getBoundingInfo().boundingBox;return new _e(c[1]+N.center.y*1.5,f[0]-N.center.y*1.5,g(P.text))}).props(tr({},T,this.options.labelProperties));E.z=y}return E}function Ww(){var n,e,t,i,r,s;this.scales.x.scale;let o=this.scales.x.range;this.scales.x.domain,this.scales.y.scale;let a=this.scales.y.range;this.scales.y.domain,this.scales.z.scale;let l=this.scales.z.range;this.scales.z.domain;let h={};if(((n=this.options.scale)==null?void 0:n.x)!=null&&((e=this.options.scale)==null?void 0:e.y)!=null){let c=new _e(0,0,0),u=0,d=0;u=Math.abs(o[0]-o[1]),d=Math.abs(a[0]-a[1]),c=new _e((o[0]+o[1])/2,(a[0]+a[1])/2,l[1]);let f={height:d,width:u,sideOrientation:ji.DOUBLESIDE},p={"material.diffuseColor":_i.White,"material.alpha":.2},g=this.CoT.bind("plane",tr({},f,this.options.backgroundOptions)).attr("name",this.name+"_backgroundX").position(c).material(new Ws(this.name+"_backgroundX_material",this.scene)).props(tr({},p,this.options.backgroundProperties));h.x=g}if(((t=this.options.scale)==null?void 0:t.y)!=null&&((i=this.options.scale)==null?void 0:i.z)!=null){let c=new _e(0,0,0),u=new _e(0,0,0),d=0,f=0;d=Math.abs(l[0]-l[1]),f=Math.abs(a[0]-a[1]),c=new _e(o[0],(a[0]+a[1])/2,(l[0]+l[1])/2),u=new _e(0,1.5708,0);let p={height:f,width:d,sideOrientation:ji.DOUBLESIDE},g={"material.diffuseColor":_i.White,"material.alpha":.2},m=this.CoT.bind("plane",tr({},p,this.options.backgroundOptions)).attr("name",this.name+"_backgroundY").position(c).rotation(u).material(new Ws(this.name+"_backgroundY_material",this.scene)).props(tr({},g,this.options.backgroundProperties));h.y=m}if(((r=this.options.scale)==null?void 0:r.z)!=null&&((s=this.options.scale)==null?void 0:s.x)!=null){let c=new _e(0,0,0),u=new _e(0,0,0),d=0,f=0;c=new _e((o[0]+o[1])/2,a[0],(l[0]+l[1])/2),u=new _e(1.5708,0,0),d=Math.abs(o[0]-o[1]),f=Math.abs(l[0]-l[1]);let p={height:f,width:d,sideOrientation:ji.DOUBLESIDE},g={"material.diffuseColor":_i.White,"material.alpha":.2},m=this.CoT.bind("plane",tr({},p,this.options.backgroundOptions)).attr("name",this.name+"_backgroundZ").position(c).rotation(u).material(new Ws(this.name+"_backgroundZ_material",this.scene)).props(tr({},g,this.options.backgroundProperties));h.z=m}return h}function Xw(){var n,e,t,i,r,s;let o=this.scales.x.scale,a=this.scales.x.range,l=this.scales.x.domain,h=this.scales.y.scale,c=this.scales.y.range,u=this.scales.y.domain,d=this.scales.z.scale,f=this.scales.z.range,p=this.scales.z.domain,g=[];if(((n=this.options.scale)==null?void 0:n.x)!=null){let R;if(((e=this.options.gridTicks)==null?void 0:e.x)!=null)R=this.options.gridTicks.x;else try{R=o.ticks()}catch{R=l}let C=[new _e(0,0,0)];C=_=>[new _e(o(_),c[0],f[0]),new _e(o(_),c[0],f[1]),new _e(o(_),c[1],f[1])];for(var m of R)g.push(C(m))}if(((t=this.options.scale)==null?void 0:t.y)!=null){let R;if(((i=this.options.gridTicks)==null?void 0:i.y)!=null)R=this.options.gridTicks.y;else try{R=h.ticks()}catch{R=u}let C=[new _e(0,0,0)];C=_=>[new _e(a[0],h(_),f[0]),new _e(a[0],h(_),f[1]),new _e(a[1],h(_),f[1])];for(var m of R)g.push(C(m))}if(((r=this.options.scale)==null?void 0:r.z)!=null){let R;if(((s=this.options.gridTicks)==null?void 0:s.z)!=null)R=this.options.gridTicks.z;else try{R=d.ticks()}catch{R=p}let C=[new _e(0,0,0)];C=_=>[new _e(a[1],c[0],d(_)),new _e(a[0],c[0],d(_)),new _e(a[0],c[1],d(_))];for(var m of R)g.push(C(m))}let x={lines:g},E={name:this.name+"_grid",alpha:.3,color:_i.White()};return this.CoT.bind("lineSystem",tr({},x,this.options.gridOptions)).props(tr({},E,this.options.gridProperties))}function Hw(){var n,e,t;this.scales.x.scale;let i=this.scales.x.range;this.scales.x.domain,this.scales.y.scale;let r=this.scales.y.range;this.scales.y.domain,this.scales.z.scale;let s=this.scales.z.range;this.scales.z.domain;let o=[];((n=this.options.scale)==null?void 0:n.y)!=null&&o.push(new _e(i[0],r[1],s[0])),((e=this.options.scale)==null?void 0:e.x)!=null&&o.push(new _e(i[0],r[0],s[0]),new _e(i[1],r[0],s[0])),((t=this.options.scale)==null?void 0:t.z)!=null&&o.push(new _e(i[1],r[0],s[0]),new _e(i[1],r[0],s[1]));let a={points:o,updatable:!1},l={createAndAssignMaterial:!0,width:5,sizeAttenuation:!0,materialType:0,color:_i.White(),colorMode:0,useColors:!1,useDash:!1,visibility:1},h=B_("greasedLine",tr({},a,this.options.domainOptions),tr({},l,this.options.domainMaterialOptions),this.scene);h.parent=this.CoT.selected[0];let c=new ai([h],this.scene);return c.prop("name",this.name+"_domain"),c}class Kw{constructor(e,t,i={}){this.setDomain=Hw,this.setBackground=Ww,this.setGrid=Xw,this.setLabel=Gw,this.name=e,this.options=i,this.scene=t,this.CoT=this.setCoT(),this.scales=this.setScales(),this.domain=this.options.domain?this.setDomain():new ai([],t),this.background=this.options.background?this.setBackground():{},this.grid=this.options.grid?this.setGrid():new ai([],t),this.label=this.options.label?this.setLabel():{}}setCoT(){let e;if(this.options.parent===void 0){let t=new dn(this.name+"CoT",this.scene);e=new ai([t],this.scene)}else e=this.options.parent.bind("cot").prop("name",this.name+"CoT");return e}setScales(){var e,t,i;let r,s=[0,0],o,a,l=[0,0],h,c,u=[0,0],d;if(((e=this.options.scale)==null?void 0:e.x)!=null){r=this.options.scale.x,o=r.domain();let p=r.range();s=[p[0],p.slice(-1)[0]]}if(((t=this.options.scale)==null?void 0:t.y)!=null){a=this.options.scale.y,h=a.domain();let p=a.range();l=[p[0],p.slice(-1)[0]]}if(((i=this.options.scale)==null?void 0:i.z)!=null){c=this.options.scale.z,d=c.domain();let p=c.range();u=[p[0],p.slice(-1)[0]]}let f=[s,l,u].flat().sort();return{size:Math.abs(f.slice(-1)[0]-f[0]),x:{scale:r,range:s,domain:o},y:{scale:a,range:l,domain:h},z:{scale:c,range:u,domain:d}}}}function PG(n,e,t){const i={scale:t.scale,parent:t.parent||void 0,domain:t.domain||!0,domainOptions:t.domainOptions||{},domainMaterialOptions:t.domainMaterialOptions||{},background:t.background||!0,backgroundOptions:t.backgroundOptions||{},backgroundProperties:t.backgroundProperties||{},grid:t.grid||!0,gridOptions:t.gridOptions||{},gridProperties:t.gridProperties||{},gridTicks:t.gridTicks||{},label:t.label||!0,labelOptions:t.labelOptions||{},labelProperties:t.labelProperties||{},labelTicks:t.labelTicks||{},labelFormat:t.labelFormat||{},atlas:t.atlas||new Kl(z_,e)};return new Kw(n,e,i)}function eh(n,e){return n==null||e==null?NaN:n<e?-1:n>e?1:n>=e?0:NaN}function qw(n,e){return n==null||e==null?NaN:e<n?-1:e>n?1:e>=n?0:NaN}function Uv(n){let e,t,i;n.length!==2?(e=eh,t=(a,l)=>eh(n(a),l),i=(a,l)=>n(a)-l):(e=n===eh||n===qw?n:Yw,t=n,i=n);function r(a,l,h=0,c=a.length){if(h<c){if(e(l,l)!==0)return c;do{const u=h+c>>>1;t(a[u],l)<0?h=u+1:c=u}while(h<c)}return h}function s(a,l,h=0,c=a.length){if(h<c){if(e(l,l)!==0)return c;do{const u=h+c>>>1;t(a[u],l)<=0?h=u+1:c=u}while(h<c)}return h}function o(a,l,h=0,c=a.length){const u=r(a,l,h,c-1);return u>h&&i(a[u-1],l)>-i(a[u],l)?u-1:u}return{left:r,center:o,right:s}}function Yw(){return 0}function Zw(n){return n===null?NaN:+n}const jw=Uv(eh),Qw=jw.right;Uv(Zw).center;const Jw=Qw;class $w{constructor(){this._partials=new Float64Array(32),this._n=0}add(e){const t=this._partials;let i=0;for(let r=0;r<this._n&&r<32;r++){const s=t[r],o=e+s,a=Math.abs(e)<Math.abs(s)?e-(o-s):s-(o-e);a&&(t[i++]=a),e=o}return t[i]=e,this._n=i+1,this}valueOf(){const e=this._partials;let t=this._n,i,r,s,o=0;if(t>0){for(o=e[--t];t>0&&(i=o,r=e[--t],o=i+r,s=r-(o-i),!s););t>0&&(s<0&&e[t-1]<0||s>0&&e[t-1]>0)&&(r=s*2,i=o+r,r==i-o&&(o=i))}return o}}const eU=Math.sqrt(50),tU=Math.sqrt(10),iU=Math.sqrt(2);function Th(n,e,t){const i=(e-n)/Math.max(0,t),r=Math.floor(Math.log10(i)),s=i/Math.pow(10,r),o=s>=eU?10:s>=tU?5:s>=iU?2:1;let a,l,h;return r<0?(h=Math.pow(10,-r)/o,a=Math.round(n*h),l=Math.round(e*h),a/h<n&&++a,l/h>e&&--l,h=-h):(h=Math.pow(10,r)*o,a=Math.round(n/h),l=Math.round(e/h),a*h<n&&++a,l*h>e&&--l),l<a&&.5<=t&&t<2?Th(n,e,t*2):[a,l,h]}function rU(n,e,t){if(e=+e,n=+n,t=+t,!(t>0))return[];if(n===e)return[n];const i=e<n,[r,s,o]=i?Th(e,n,t):Th(n,e,t);if(!(s>=r))return[];const a=s-r+1,l=new Array(a);if(i)if(o<0)for(let h=0;h<a;++h)l[h]=(s-h)/-o;else for(let h=0;h<a;++h)l[h]=(s-h)*o;else if(o<0)for(let h=0;h<a;++h)l[h]=(r+h)/-o;else for(let h=0;h<a;++h)l[h]=(r+h)*o;return l}function Fu(n,e,t){return e=+e,n=+n,t=+t,Th(n,e,t)[2]}function sU(n,e,t){e=+e,n=+n,t=+t;const i=e<n,r=i?Fu(e,n,t):Fu(n,e,t);return(i?-1:1)*(r<0?1/-r:r)}function*nU(n){for(const e of n)yield*e}function Vv(n){return Array.from(nU(n))}function oU(n,e){switch(arguments.length){case 0:break;case 1:this.range(n);break;default:this.range(e).domain(n);break}return this}function $d(n,e,t){n.prototype=e.prototype=t,t.constructor=n}function Bv(n,e){var t=Object.create(n.prototype);for(var i in e)t[i]=e[i];return t}function tl(){}var Na=.7,xh=1/Na,Io="\\s*([+-]?\\d+)\\s*",Fa="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Es="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",aU=/^#([0-9a-f]{3,8})$/,lU=new RegExp(`^rgb\\(${Io},${Io},${Io}\\)$`),hU=new RegExp(`^rgb\\(${Es},${Es},${Es}\\)$`),cU=new RegExp(`^rgba\\(${Io},${Io},${Io},${Fa}\\)$`),uU=new RegExp(`^rgba\\(${Es},${Es},${Es},${Fa}\\)$`),dU=new RegExp(`^hsl\\(${Fa},${Es},${Es}\\)$`),fU=new RegExp(`^hsla\\(${Fa},${Es},${Es},${Fa}\\)$`),Rm={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};$d(tl,La,{copy(n){return Object.assign(new this.constructor,this,n)},displayable(){return this.rgb().displayable()},hex:Sm,formatHex:Sm,formatHex8:pU,formatHsl:gU,formatRgb:ym,toString:ym});function Sm(){return this.rgb().formatHex()}function pU(){return this.rgb().formatHex8()}function gU(){return kv(this).formatHsl()}function ym(){return this.rgb().formatRgb()}function La(n){var e,t;return n=(n+"").trim().toLowerCase(),(e=aU.exec(n))?(t=e[1].length,e=parseInt(e[1],16),t===6?bm(e):t===3?new _r(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):t===8?yl(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):t===4?yl(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=lU.exec(n))?new _r(e[1],e[2],e[3],1):(e=hU.exec(n))?new _r(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=cU.exec(n))?yl(e[1],e[2],e[3],e[4]):(e=uU.exec(n))?yl(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=dU.exec(n))?Mm(e[1],e[2]/100,e[3]/100,1):(e=fU.exec(n))?Mm(e[1],e[2]/100,e[3]/100,e[4]):Rm.hasOwnProperty(n)?bm(Rm[n]):n==="transparent"?new _r(NaN,NaN,NaN,0):null}function bm(n){return new _r(n>>16&255,n>>8&255,n&255,1)}function yl(n,e,t,i){return i<=0&&(n=e=t=NaN),new _r(n,e,t,i)}function mU(n){return n instanceof tl||(n=La(n)),n?(n=n.rgb(),new _r(n.r,n.g,n.b,n.opacity)):new _r}function Lu(n,e,t,i){return arguments.length===1?mU(n):new _r(n,e,t,i??1)}function _r(n,e,t,i){this.r=+n,this.g=+e,this.b=+t,this.opacity=+i}$d(_r,Lu,Bv(tl,{brighter(n){return n=n==null?xh:Math.pow(xh,n),new _r(this.r*n,this.g*n,this.b*n,this.opacity)},darker(n){return n=n==null?Na:Math.pow(Na,n),new _r(this.r*n,this.g*n,this.b*n,this.opacity)},rgb(){return this},clamp(){return new _r(wn(this.r),wn(this.g),wn(this.b),Ch(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Im,formatHex:Im,formatHex8:_U,formatRgb:Am,toString:Am}));function Im(){return`#${Dn(this.r)}${Dn(this.g)}${Dn(this.b)}`}function _U(){return`#${Dn(this.r)}${Dn(this.g)}${Dn(this.b)}${Dn((isNaN(this.opacity)?1:this.opacity)*255)}`}function Am(){const n=Ch(this.opacity);return`${n===1?"rgb(":"rgba("}${wn(this.r)}, ${wn(this.g)}, ${wn(this.b)}${n===1?")":`, ${n})`}`}function Ch(n){return isNaN(n)?1:Math.max(0,Math.min(1,n))}function wn(n){return Math.max(0,Math.min(255,Math.round(n)||0))}function Dn(n){return n=wn(n),(n<16?"0":"")+n.toString(16)}function Mm(n,e,t,i){return i<=0?n=e=t=NaN:t<=0||t>=1?n=e=NaN:e<=0&&(n=NaN),new Jr(n,e,t,i)}function kv(n){if(n instanceof Jr)return new Jr(n.h,n.s,n.l,n.opacity);if(n instanceof tl||(n=La(n)),!n)return new Jr;if(n instanceof Jr)return n;n=n.rgb();var e=n.r/255,t=n.g/255,i=n.b/255,r=Math.min(e,t,i),s=Math.max(e,t,i),o=NaN,a=s-r,l=(s+r)/2;return a?(e===s?o=(t-i)/a+(t<i)*6:t===s?o=(i-e)/a+2:o=(e-t)/a+4,a/=l<.5?s+r:2-s-r,o*=60):a=l>0&&l<1?0:o,new Jr(o,a,l,n.opacity)}function vU(n,e,t,i){return arguments.length===1?kv(n):new Jr(n,e,t,i??1)}function Jr(n,e,t,i){this.h=+n,this.s=+e,this.l=+t,this.opacity=+i}$d(Jr,vU,Bv(tl,{brighter(n){return n=n==null?xh:Math.pow(xh,n),new Jr(this.h,this.s,this.l*n,this.opacity)},darker(n){return n=n==null?Na:Math.pow(Na,n),new Jr(this.h,this.s,this.l*n,this.opacity)},rgb(){var n=this.h%360+(this.h<0)*360,e=isNaN(n)||isNaN(this.s)?0:this.s,t=this.l,i=t+(t<.5?t:1-t)*e,r=2*t-i;return new _r(cu(n>=240?n-240:n+120,r,i),cu(n,r,i),cu(n<120?n+240:n-120,r,i),this.opacity)},clamp(){return new Jr(Pm(this.h),bl(this.s),bl(this.l),Ch(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const n=Ch(this.opacity);return`${n===1?"hsl(":"hsla("}${Pm(this.h)}, ${bl(this.s)*100}%, ${bl(this.l)*100}%${n===1?")":`, ${n})`}`}}));function Pm(n){return n=(n||0)%360,n<0?n+360:n}function bl(n){return Math.max(0,Math.min(1,n||0))}function cu(n,e,t){return(n<60?e+(t-e)*n/60:n<180?t:n<240?e+(t-e)*(240-n)/60:e)*255}const ef=n=>()=>n;function EU(n,e){return function(t){return n+t*e}}function TU(n,e,t){return n=Math.pow(n,t),e=Math.pow(e,t)-n,t=1/t,function(i){return Math.pow(n+i*e,t)}}function xU(n){return(n=+n)==1?zv:function(e,t){return t-e?TU(e,t,n):ef(isNaN(e)?t:e)}}function zv(n,e){var t=e-n;return t?EU(n,t):ef(isNaN(n)?e:n)}const Om=function n(e){var t=xU(e);function i(r,s){var o=t((r=Lu(r)).r,(s=Lu(s)).r),a=t(r.g,s.g),l=t(r.b,s.b),h=zv(r.opacity,s.opacity);return function(c){return r.r=o(c),r.g=a(c),r.b=l(c),r.opacity=h(c),r+""}}return i.gamma=n,i}(1);function CU(n,e){e||(e=[]);var t=n?Math.min(e.length,n.length):0,i=e.slice(),r;return function(s){for(r=0;r<t;++r)i[r]=n[r]*(1-s)+e[r]*s;return i}}function RU(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function SU(n,e){var t=e?e.length:0,i=n?Math.min(t,n.length):0,r=new Array(i),s=new Array(t),o;for(o=0;o<i;++o)r[o]=tf(n[o],e[o]);for(;o<t;++o)s[o]=e[o];return function(a){for(o=0;o<i;++o)s[o]=r[o](a);return s}}function yU(n,e){var t=new Date;return n=+n,e=+e,function(i){return t.setTime(n*(1-i)+e*i),t}}function Rh(n,e){return n=+n,e=+e,function(t){return n*(1-t)+e*t}}function bU(n,e){var t={},i={},r;(n===null||typeof n!="object")&&(n={}),(e===null||typeof e!="object")&&(e={});for(r in e)r in n?t[r]=tf(n[r],e[r]):i[r]=e[r];return function(s){for(r in t)i[r]=t[r](s);return i}}var wu=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,uu=new RegExp(wu.source,"g");function IU(n){return function(){return n}}function AU(n){return function(e){return n(e)+""}}function MU(n,e){var t=wu.lastIndex=uu.lastIndex=0,i,r,s,o=-1,a=[],l=[];for(n=n+"",e=e+"";(i=wu.exec(n))&&(r=uu.exec(e));)(s=r.index)>t&&(s=e.slice(t,s),a[o]?a[o]+=s:a[++o]=s),(i=i[0])===(r=r[0])?a[o]?a[o]+=r:a[++o]=r:(a[++o]=null,l.push({i:o,x:Rh(i,r)})),t=uu.lastIndex;return t<e.length&&(s=e.slice(t),a[o]?a[o]+=s:a[++o]=s),a.length<2?l[0]?AU(l[0].x):IU(e):(e=l.length,function(h){for(var c=0,u;c<e;++c)a[(u=l[c]).i]=u.x(h);return a.join("")})}function tf(n,e){var t=typeof e,i;return e==null||t==="boolean"?ef(e):(t==="number"?Rh:t==="string"?(i=La(e))?(e=i,Om):MU:e instanceof La?Om:e instanceof Date?yU:RU(e)?CU:Array.isArray(e)?SU:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?bU:Rh)(n,e)}function PU(n,e){return n=+n,e=+e,function(t){return Math.round(n*(1-t)+e*t)}}function OU(n){return function(){return n}}function DU(n){return+n}var Dm=[0,1];function mo(n){return n}function Uu(n,e){return(e-=n=+n)?function(t){return(t-n)/e}:OU(isNaN(e)?NaN:.5)}function NU(n,e){var t;return n>e&&(t=n,n=e,e=t),function(i){return Math.max(n,Math.min(e,i))}}function FU(n,e,t){var i=n[0],r=n[1],s=e[0],o=e[1];return r<i?(i=Uu(r,i),s=t(o,s)):(i=Uu(i,r),s=t(s,o)),function(a){return s(i(a))}}function LU(n,e,t){var i=Math.min(n.length,e.length)-1,r=new Array(i),s=new Array(i),o=-1;for(n[i]<n[0]&&(n=n.slice().reverse(),e=e.slice().reverse());++o<i;)r[o]=Uu(n[o],n[o+1]),s[o]=t(e[o],e[o+1]);return function(a){var l=Jw(n,a,1,i)-1;return s[l](r[l](a))}}function wU(n,e){return e.domain(n.domain()).range(n.range()).interpolate(n.interpolate()).clamp(n.clamp()).unknown(n.unknown())}function UU(){var n=Dm,e=Dm,t=tf,i,r,s,o=mo,a,l,h;function c(){var d=Math.min(n.length,e.length);return o!==mo&&(o=NU(n[0],n[d-1])),a=d>2?LU:FU,l=h=null,u}function u(d){return d==null||isNaN(d=+d)?s:(l||(l=a(n.map(i),e,t)))(i(o(d)))}return u.invert=function(d){return o(r((h||(h=a(e,n.map(i),Rh)))(d)))},u.domain=function(d){return arguments.length?(n=Array.from(d,DU),c()):n.slice()},u.range=function(d){return arguments.length?(e=Array.from(d),c()):e.slice()},u.rangeRound=function(d){return e=Array.from(d),t=PU,c()},u.clamp=function(d){return arguments.length?(o=d?!0:mo,c()):o!==mo},u.interpolate=function(d){return arguments.length?(t=d,c()):t},u.unknown=function(d){return arguments.length?(s=d,u):s},function(d,f){return i=d,r=f,c()}}function VU(){return UU()(mo,mo)}function BU(n){return Math.abs(n=Math.round(n))>=1e21?n.toLocaleString("en").replace(/,/g,""):n.toString(10)}function Sh(n,e){if((t=(n=e?n.toExponential(e-1):n.toExponential()).indexOf("e"))<0)return null;var t,i=n.slice(0,t);return[i.length>1?i[0]+i.slice(2):i,+n.slice(t+1)]}function Bo(n){return n=Sh(Math.abs(n)),n?n[1]:NaN}function kU(n,e){return function(t,i){for(var r=t.length,s=[],o=0,a=n[0],l=0;r>0&&a>0&&(l+a+1>i&&(a=Math.max(1,i-l)),s.push(t.substring(r-=a,r+a)),!((l+=a+1)>i));)a=n[o=(o+1)%n.length];return s.reverse().join(e)}}function zU(n){return function(e){return e.replace(/[0-9]/g,function(t){return n[+t]})}}var GU=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function yh(n){if(!(e=GU.exec(n)))throw new Error("invalid format: "+n);var e;return new rf({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}yh.prototype=rf.prototype;function rf(n){this.fill=n.fill===void 0?" ":n.fill+"",this.align=n.align===void 0?">":n.align+"",this.sign=n.sign===void 0?"-":n.sign+"",this.symbol=n.symbol===void 0?"":n.symbol+"",this.zero=!!n.zero,this.width=n.width===void 0?void 0:+n.width,this.comma=!!n.comma,this.precision=n.precision===void 0?void 0:+n.precision,this.trim=!!n.trim,this.type=n.type===void 0?"":n.type+""}rf.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function WU(n){e:for(var e=n.length,t=1,i=-1,r;t<e;++t)switch(n[t]){case".":i=r=t;break;case"0":i===0&&(i=t),r=t;break;default:if(!+n[t])break e;i>0&&(i=0);break}return i>0?n.slice(0,i)+n.slice(r+1):n}var Gv;function XU(n,e){var t=Sh(n,e);if(!t)return n+"";var i=t[0],r=t[1],s=r-(Gv=Math.max(-8,Math.min(8,Math.floor(r/3)))*3)+1,o=i.length;return s===o?i:s>o?i+new Array(s-o+1).join("0"):s>0?i.slice(0,s)+"."+i.slice(s):"0."+new Array(1-s).join("0")+Sh(n,Math.max(0,e+s-1))[0]}function Nm(n,e){var t=Sh(n,e);if(!t)return n+"";var i=t[0],r=t[1];return r<0?"0."+new Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+new Array(r-i.length+2).join("0")}const Fm={"%":(n,e)=>(n*100).toFixed(e),b:n=>Math.round(n).toString(2),c:n=>n+"",d:BU,e:(n,e)=>n.toExponential(e),f:(n,e)=>n.toFixed(e),g:(n,e)=>n.toPrecision(e),o:n=>Math.round(n).toString(8),p:(n,e)=>Nm(n*100,e),r:Nm,s:XU,X:n=>Math.round(n).toString(16).toUpperCase(),x:n=>Math.round(n).toString(16)};function Lm(n){return n}var wm=Array.prototype.map,Um=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function HU(n){var e=n.grouping===void 0||n.thousands===void 0?Lm:kU(wm.call(n.grouping,Number),n.thousands+""),t=n.currency===void 0?"":n.currency[0]+"",i=n.currency===void 0?"":n.currency[1]+"",r=n.decimal===void 0?".":n.decimal+"",s=n.numerals===void 0?Lm:zU(wm.call(n.numerals,String)),o=n.percent===void 0?"%":n.percent+"",a=n.minus===void 0?"−":n.minus+"",l=n.nan===void 0?"NaN":n.nan+"";function h(u){u=yh(u);var d=u.fill,f=u.align,p=u.sign,g=u.symbol,m=u.zero,x=u.width,E=u.comma,R=u.precision,C=u.trim,_=u.type;_==="n"?(E=!0,_="g"):Fm[_]||(R===void 0&&(R=12),C=!0,_="g"),(m||d==="0"&&f==="=")&&(m=!0,d="0",f="=");var T=g==="$"?t:g==="#"&&/[boxX]/.test(_)?"0"+_.toLowerCase():"",y=g==="$"?i:/[%p]/.test(_)?o:"",P=Fm[_],D=/[defgprs%]/.test(_);R=R===void 0?6:/[gprs]/.test(_)?Math.max(1,Math.min(21,R)):Math.max(0,Math.min(20,R));function F(N){var G=T,J=y,j,z,$;if(_==="c")J=P(N)+J,N="";else{N=+N;var te=N<0||1/N<0;if(N=isNaN(N)?l:P(Math.abs(N),R),C&&(N=WU(N)),te&&+N==0&&p!=="+"&&(te=!1),G=(te?p==="("?p:a:p==="-"||p==="("?"":p)+G,J=(_==="s"?Um[8+Gv/3]:"")+J+(te&&p==="("?")":""),D){for(j=-1,z=N.length;++j<z;)if($=N.charCodeAt(j),48>$||$>57){J=($===46?r+N.slice(j+1):N.slice(j))+J,N=N.slice(0,j);break}}}E&&!m&&(N=e(N,1/0));var fe=G.length+N.length+J.length,Z=fe<x?new Array(x-fe+1).join(d):"";switch(E&&m&&(N=e(Z+N,Z.length?x-J.length:1/0),Z=""),f){case"<":N=G+N+J+Z;break;case"=":N=G+Z+N+J;break;case"^":N=Z.slice(0,fe=Z.length>>1)+G+N+J+Z.slice(fe);break;default:N=Z+G+N+J;break}return s(N)}return F.toString=function(){return u+""},F}function c(u,d){var f=h((u=yh(u),u.type="f",u)),p=Math.max(-8,Math.min(8,Math.floor(Bo(d)/3)))*3,g=Math.pow(10,-p),m=Um[8+p/3];return function(x){return f(g*x)+m}}return{format:h,formatPrefix:c}}var Il,Wv,Xv;KU({thousands:",",grouping:[3],currency:["$",""]});function KU(n){return Il=HU(n),Wv=Il.format,Xv=Il.formatPrefix,Il}function qU(n){return Math.max(0,-Bo(Math.abs(n)))}function YU(n,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Bo(e)/3)))*3-Bo(Math.abs(n)))}function ZU(n,e){return n=Math.abs(n),e=Math.abs(e)-n,Math.max(0,Bo(e)-Bo(n))+1}function jU(n,e,t,i){var r=sU(n,e,t),s;switch(i=yh(i??",f"),i.type){case"s":{var o=Math.max(Math.abs(n),Math.abs(e));return i.precision==null&&!isNaN(s=YU(r,o))&&(i.precision=s),Xv(i,o)}case"":case"e":case"g":case"p":case"r":{i.precision==null&&!isNaN(s=ZU(r,Math.max(Math.abs(n),Math.abs(e))))&&(i.precision=s-(i.type==="e"));break}case"f":case"%":{i.precision==null&&!isNaN(s=qU(r))&&(i.precision=s-(i.type==="%")*2);break}}return Wv(i)}function QU(n){var e=n.domain;return n.ticks=function(t){var i=e();return rU(i[0],i[i.length-1],t??10)},n.tickFormat=function(t,i){var r=e();return jU(r[0],r[r.length-1],t??10,i)},n.nice=function(t){t==null&&(t=10);var i=e(),r=0,s=i.length-1,o=i[r],a=i[s],l,h,c=10;for(a<o&&(h=o,o=a,a=h,h=r,r=s,s=h);c-- >0;){if(h=Fu(o,a,t),h===l)return i[r]=o,i[s]=a,e(i);if(h>0)o=Math.floor(o/h)*h,a=Math.ceil(a/h)*h;else if(h<0)o=Math.ceil(o*h)/h,a=Math.floor(a*h)/h;else break;l=h}return n},n}function Vu(){var n=VU();return n.copy=function(){return wU(n,Vu())},oU.apply(n,arguments),QU(n)}class JU{constructor(e){this.propagationStopped,this.defaultPrevented,this.type=e,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}const Tn=JU,wa={PROPERTYCHANGE:"propertychange"};class $U{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}const sf=$U;function nf(n,e){return n>e?1:n<e?-1:0}function of(n,e,t){if(n[0]<=e)return 0;const i=n.length;if(e<=n[i-1])return i-1;if(typeof t=="function"){for(let r=1;r<i;++r){const s=n[r];if(s===e)return r;if(s<e)return t(e,n[r-1],s)>0?r-1:r}return i-1}if(t>0){for(let r=1;r<i;++r)if(n[r]<e)return r-1;return i-1}if(t<0){for(let r=1;r<i;++r)if(n[r]<=e)return r;return i-1}for(let r=1;r<i;++r){if(n[r]==e)return r;if(n[r]<e)return n[r-1]-e<e-n[r]?r-1:r}return i-1}function e3(n,e){const t=Array.isArray(e)?e:[e],i=t.length;for(let r=0;r<i;r++)n[n.length]=t[r]}function ac(n,e){const t=n.length;if(t!==e.length)return!1;for(let i=0;i<t;i++)if(n[i]!==e[i])return!1;return!0}function t3(n,e,t){const i=e||nf;return n.every(function(r,s){if(s===0)return!0;const o=i(n[s-1],r);return!(o>0||t&&o===0)})}function bh(){return!0}function lc(){return!1}function Ih(){}function i3(n){let e=!1,t,i,r;return function(){const s=Array.prototype.slice.call(arguments);return(!e||this!==r||!ac(s,i))&&(e=!0,r=this,i=s,t=n.apply(this,arguments)),t}}function hc(n){for(const e in n)delete n[e]}function r3(n){let e;for(e in n)return!1;return!e}class s3 extends sf{constructor(e){super(),this.eventTarget_=e,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(e,t){if(!e||!t)return;const i=this.listeners_||(this.listeners_={}),r=i[e]||(i[e]=[]);r.includes(t)||r.push(t)}dispatchEvent(e){const t=typeof e=="string",i=t?e:e.type,r=this.listeners_&&this.listeners_[i];if(!r)return;const s=t?new Tn(e):e;s.target||(s.target=this.eventTarget_||this);const o=this.dispatching_||(this.dispatching_={}),a=this.pendingRemovals_||(this.pendingRemovals_={});i in o||(o[i]=0,a[i]=0),++o[i];let l;for(let h=0,c=r.length;h<c;++h)if("handleEvent"in r[h]?l=r[h].handleEvent(s):l=r[h].call(this,s),l===!1||s.propagationStopped){l=!1;break}if(--o[i]===0){let h=a[i];for(delete a[i];h--;)this.removeEventListener(i,Ih);delete o[i]}return l}disposeInternal(){this.listeners_&&hc(this.listeners_)}getListeners(e){return this.listeners_&&this.listeners_[e]||void 0}hasListener(e){return this.listeners_?e?e in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(e,t){const i=this.listeners_&&this.listeners_[e];if(i){const r=i.indexOf(t);r!==-1&&(this.pendingRemovals_&&e in this.pendingRemovals_?(i[r]=Ih,++this.pendingRemovals_[e]):(i.splice(r,1),i.length===0&&delete this.listeners_[e]))}}}const af=s3,Rt={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"};function Kt(n,e,t,i,r){if(i&&i!==n&&(t=t.bind(i)),r){const o=t;t=function(){n.removeEventListener(e,t),o.apply(this,arguments)}}const s={target:n,type:e,listener:t};return n.addEventListener(e,t),s}function Ah(n,e,t,i){return Kt(n,e,t,i,!0)}function xi(n){n&&n.target&&(n.target.removeEventListener(n.type,n.listener),hc(n))}class cc extends af{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(Rt.CHANGE)}getRevision(){return this.revision_}onInternal(e,t){if(Array.isArray(e)){const i=e.length,r=new Array(i);for(let s=0;s<i;++s)r[s]=Kt(this,e[s],t);return r}return Kt(this,e,t)}onceInternal(e,t){let i;if(Array.isArray(e)){const r=e.length;i=new Array(r);for(let s=0;s<r;++s)i[s]=Ah(this,e[s],t)}else i=Ah(this,e,t);return t.ol_key=i,i}unInternal(e,t){const i=t.ol_key;if(i)n3(i);else if(Array.isArray(e))for(let r=0,s=e.length;r<s;++r)this.removeEventListener(e[r],t);else this.removeEventListener(e,t)}}cc.prototype.on;cc.prototype.once;cc.prototype.un;function n3(n){if(Array.isArray(n))for(let e=0,t=n.length;e<t;++e)xi(n[e]);else xi(n)}const Hv=cc;function mi(){throw new Error("Unimplemented abstract method.")}let o3=0;function gr(n){return n.ol_uid||(n.ol_uid=String(++o3))}class Vm extends Tn{constructor(e,t,i){super(e),this.key=t,this.oldValue=i}}class a3 extends Hv{constructor(e){super(),this.on,this.once,this.un,gr(this),this.values_=null,e!==void 0&&this.setProperties(e)}get(e){let t;return this.values_&&this.values_.hasOwnProperty(e)&&(t=this.values_[e]),t}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}hasProperties(){return!!this.values_}notify(e,t){let i;i=`change:${e}`,this.hasListener(i)&&this.dispatchEvent(new Vm(i,e,t)),i=wa.PROPERTYCHANGE,this.hasListener(i)&&this.dispatchEvent(new Vm(i,e,t))}addChangeListener(e,t){this.addEventListener(`change:${e}`,t)}removeChangeListener(e,t){this.removeEventListener(`change:${e}`,t)}set(e,t,i){const r=this.values_||(this.values_={});if(i)r[e]=t;else{const s=r[e];r[e]=t,s!==t&&this.notify(e,s)}}setProperties(e,t){for(const i in e)this.set(i,e[i],t)}applyProperties(e){e.values_&&Object.assign(this.values_||(this.values_={}),e.values_)}unset(e,t){if(this.values_&&e in this.values_){const i=this.values_[e];delete this.values_[e],r3(this.values_)&&(this.values_=null),t||this.notify(e,i)}}}const qs=a3,l3={1:"The view center is not defined",2:"The view resolution is not defined",3:"The view rotation is not defined",4:"`image` and `src` cannot be provided at the same time",5:"`imgSize` must be set when `image` is provided",7:"`format` must be set when `url` is set",8:"Unknown `serverType` configured",9:"`url` must be configured or set using `#setUrl()`",10:"The default `geometryFunction` can only handle `Point` geometries",11:"`options.featureTypes` must be an Array",12:"`options.geometryName` must also be provided when `options.bbox` is set",13:"Invalid corner",14:"Invalid color",15:"Tried to get a value for a key that does not exist in the cache",16:"Tried to set a value for a key that is used already",17:"`resolutions` must be sorted in descending order",18:"Either `origin` or `origins` must be configured, never both",19:"Number of `tileSizes` and `resolutions` must be equal",20:"Number of `origins` and `resolutions` must be equal",22:"Either `tileSize` or `tileSizes` must be configured, never both",24:"Invalid extent or geometry provided as `geometry`",25:"Cannot fit empty extent provided as `geometry`",26:"Features must have an id set",27:"Features must have an id set",28:'`renderMode` must be `"hybrid"` or `"vector"`',30:"The passed `feature` was already added to the source",31:"Tried to enqueue an `element` that was already added to the queue",32:"Transformation matrix cannot be inverted",33:"Invalid units",34:"Invalid geometry layout",36:"Unknown SRS type",37:"Unknown geometry type found",38:"`styleMapValue` has an unknown type",39:"Unknown geometry type",40:"Expected `feature` to have a geometry",41:"Expected an `ol/style/Style` or an array of `ol/style/Style.js`",42:"Question unknown, the answer is 42",43:"Expected `layers` to be an array or a `Collection`",47:"Expected `controls` to be an array or an `ol/Collection`",48:"Expected `interactions` to be an array or an `ol/Collection`",49:"Expected `overlays` to be an array or an `ol/Collection`",50:"`options.featureTypes` should be an Array",51:"Either `url` or `tileJSON` options must be provided",52:"Unknown `serverType` configured",53:"Unknown `tierSizeCalculation` configured",55:"The {-y} placeholder requires a tile grid with extent",56:"mapBrowserEvent must originate from a pointer event",57:"At least 2 conditions are required",59:"Invalid command found in the PBF",60:"Missing or invalid `size`",61:"Cannot determine IIIF Image API version from provided image information JSON",62:"A `WebGLArrayBuffer` must either be of type `ELEMENT_ARRAY_BUFFER` or `ARRAY_BUFFER`",64:"Layer opacity must be a number",66:"`forEachFeatureAtCoordinate` cannot be used on a WebGL layer if the hit detection logic has not been enabled. This is done by providing adequate shaders using the `hitVertexShader` and `hitFragmentShader` properties of `WebGLPointsLayerRenderer`",67:"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both",68:"A VectorTile source can only be rendered if it has a projection compatible with the view projection",69:"`width` or `height` cannot be provided together with `scale`"};class h3 extends Error{constructor(e){const t=l3[e];super(t),this.code=e,this.name="AssertionError",this.message=t}}const Kv=h3,Lr={ADD:"add",REMOVE:"remove"},Bm={LENGTH:"length"};class Al extends Tn{constructor(e,t,i){super(e),this.element=t,this.index=i}}class c3 extends qs{constructor(e,t){if(super(),this.on,this.once,this.un,t=t||{},this.unique_=!!t.unique,this.array_=e||[],this.unique_)for(let i=0,r=this.array_.length;i<r;++i)this.assertUnique_(this.array_[i],i);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(e){for(let t=0,i=e.length;t<i;++t)this.push(e[t]);return this}forEach(e){const t=this.array_;for(let i=0,r=t.length;i<r;++i)e(t[i],i,t)}getArray(){return this.array_}item(e){return this.array_[e]}getLength(){return this.get(Bm.LENGTH)}insertAt(e,t){if(e<0||e>this.getLength())throw new Error("Index out of bounds: "+e);this.unique_&&this.assertUnique_(t),this.array_.splice(e,0,t),this.updateLength_(),this.dispatchEvent(new Al(Lr.ADD,t,e))}pop(){return this.removeAt(this.getLength()-1)}push(e){this.unique_&&this.assertUnique_(e);const t=this.getLength();return this.insertAt(t,e),this.getLength()}remove(e){const t=this.array_;for(let i=0,r=t.length;i<r;++i)if(t[i]===e)return this.removeAt(i)}removeAt(e){if(e<0||e>=this.getLength())return;const t=this.array_[e];return this.array_.splice(e,1),this.updateLength_(),this.dispatchEvent(new Al(Lr.REMOVE,t,e)),t}setAt(e,t){const i=this.getLength();if(e>=i){this.insertAt(e,t);return}if(e<0)throw new Error("Index out of bounds: "+e);this.unique_&&this.assertUnique_(t,e);const r=this.array_[e];this.array_[e]=t,this.dispatchEvent(new Al(Lr.REMOVE,r,e)),this.dispatchEvent(new Al(Lr.ADD,t,e))}updateLength_(){this.set(Bm.LENGTH,this.array_.length)}assertUnique_(e,t){for(let i=0,r=this.array_.length;i<r;++i)if(this.array_[i]===e&&i!==t)throw new Kv(58)}}const Gs=c3,gn=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",u3=gn.includes("firefox"),d3=gn.includes("safari")&&!gn.includes("chrom");d3&&(gn.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(gn));const f3=gn.includes("webkit")&&!gn.includes("edge"),qv=gn.includes("macintosh"),Yv=typeof devicePixelRatio<"u"?devicePixelRatio:1,Zv=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,p3=typeof Image<"u"&&Image.prototype.decode,jv=function(){let n=!1;try{const e=Object.defineProperty({},"passive",{get:function(){n=!0}});window.addEventListener("_",null,e),window.removeEventListener("_",null,e)}catch{}return n}();function qt(n,e){if(!n)throw new Kv(e)}new Array(6);function Ao(){return[1,0,0,1,0,0]}function Pr(n,e){const t=e[0],i=e[1];return e[0]=n[0]*t+n[2]*i+n[4],e[1]=n[1]*t+n[3]*i+n[5],e}function Ua(n,e,t,i,r,s,o,a){const l=Math.sin(s),h=Math.cos(s);return n[0]=i*h,n[1]=r*l,n[2]=-i*l,n[3]=r*h,n[4]=o*i*h-a*i*l+e,n[5]=o*r*l+a*r*h+t,n}function Qv(n,e){const t=g3(e);qt(t!==0,32);const i=e[0],r=e[1],s=e[2],o=e[3],a=e[4],l=e[5];return n[0]=o/t,n[1]=-r/t,n[2]=-s/t,n[3]=i/t,n[4]=(s*l-o*a)/t,n[5]=-(i*l-r*a)/t,n}function g3(n){return n[0]*n[3]-n[1]*n[2]}let km;function m3(n){const e="matrix("+n.join(", ")+")";if(Zv)return e;const t=km||(km=document.createElement("div"));return t.style.transform=e,t.style.transform}const qi={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function zm(n){const e=Xn();for(let t=0,i=n.length;t<i;++t)th(e,n[t]);return e}function _3(n,e,t){const i=Math.min.apply(null,n),r=Math.min.apply(null,e),s=Math.max.apply(null,n),o=Math.max.apply(null,e);return Qo(i,r,s,o,t)}function v3(n,e){return e?(e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e):n.slice()}function Jv(n,e,t){let i,r;return e<n[0]?i=n[0]-e:n[2]<e?i=e-n[2]:i=0,t<n[1]?r=n[1]-t:n[3]<t?r=t-n[3]:r=0,i*i+r*r}function lf(n,e){return $v(n,e[0],e[1])}function E3(n,e){return n[0]<=e[0]&&e[2]<=n[2]&&n[1]<=e[1]&&e[3]<=n[3]}function $v(n,e,t){return n[0]<=e&&e<=n[2]&&n[1]<=t&&t<=n[3]}function Gm(n,e){const t=n[0],i=n[1],r=n[2],s=n[3],o=e[0],a=e[1];let l=qi.UNKNOWN;return o<t?l=l|qi.LEFT:o>r&&(l=l|qi.RIGHT),a<i?l=l|qi.BELOW:a>s&&(l=l|qi.ABOVE),l===qi.UNKNOWN&&(l=qi.INTERSECTING),l}function Xn(){return[1/0,1/0,-1/0,-1/0]}function Qo(n,e,t,i,r){return r?(r[0]=n,r[1]=e,r[2]=t,r[3]=i,r):[n,e,t,i]}function il(n){return Qo(1/0,1/0,-1/0,-1/0,n)}function T3(n,e){const t=n[0],i=n[1];return Qo(t,i,t,i,e)}function x3(n,e,t,i,r){const s=il(r);return eE(s,n,e,t,i)}function Bu(n,e){return n[0]==e[0]&&n[2]==e[2]&&n[1]==e[1]&&n[3]==e[3]}function C3(n,e){return e[0]<n[0]&&(n[0]=e[0]),e[2]>n[2]&&(n[2]=e[2]),e[1]<n[1]&&(n[1]=e[1]),e[3]>n[3]&&(n[3]=e[3]),n}function th(n,e){e[0]<n[0]&&(n[0]=e[0]),e[0]>n[2]&&(n[2]=e[0]),e[1]<n[1]&&(n[1]=e[1]),e[1]>n[3]&&(n[3]=e[1])}function eE(n,e,t,i,r){for(;t<i;t+=r)R3(n,e[t],e[t+1]);return n}function R3(n,e,t){n[0]=Math.min(n[0],e),n[1]=Math.min(n[1],t),n[2]=Math.max(n[2],e),n[3]=Math.max(n[3],t)}function tE(n,e){let t;return t=e(uc(n)),t||(t=e(dc(n)),t)||(t=e(fc(n)),t)||(t=e(Hn(n)),t)?t:!1}function ku(n){let e=0;return sl(n)||(e=ki(n)*xs(n)),e}function uc(n){return[n[0],n[1]]}function dc(n){return[n[2],n[1]]}function Va(n){return[(n[0]+n[2])/2,(n[1]+n[3])/2]}function S3(n,e){let t;return e==="bottom-left"?t=uc(n):e==="bottom-right"?t=dc(n):e==="top-left"?t=Hn(n):e==="top-right"?t=fc(n):qt(!1,13),t}function zu(n,e,t,i,r){const[s,o,a,l,h,c,u,d]=Gu(n,e,t,i);return Qo(Math.min(s,a,h,u),Math.min(o,l,c,d),Math.max(s,a,h,u),Math.max(o,l,c,d),r)}function Gu(n,e,t,i){const r=e*i[0]/2,s=e*i[1]/2,o=Math.cos(t),a=Math.sin(t),l=r*o,h=r*a,c=s*o,u=s*a,d=n[0],f=n[1];return[d-l+u,f-h-c,d-l-u,f-h+c,d+l-u,f+h+c,d+l+u,f+h-c,d-l+u,f-h-c]}function xs(n){return n[3]-n[1]}function Ea(n,e,t){const i=t||Xn();return rl(n,e)?(n[0]>e[0]?i[0]=n[0]:i[0]=e[0],n[1]>e[1]?i[1]=n[1]:i[1]=e[1],n[2]<e[2]?i[2]=n[2]:i[2]=e[2],n[3]<e[3]?i[3]=n[3]:i[3]=e[3]):il(i),i}function Hn(n){return[n[0],n[3]]}function fc(n){return[n[2],n[3]]}function ki(n){return n[2]-n[0]}function rl(n,e){return n[0]<=e[2]&&n[2]>=e[0]&&n[1]<=e[3]&&n[3]>=e[1]}function sl(n){return n[2]<n[0]||n[3]<n[1]}function y3(n,e){return e?(e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e):n}function b3(n,e,t){let i=!1;const r=Gm(n,e),s=Gm(n,t);if(r===qi.INTERSECTING||s===qi.INTERSECTING)i=!0;else{const o=n[0],a=n[1],l=n[2],h=n[3],c=e[0],u=e[1],d=t[0],f=t[1],p=(f-u)/(d-c);let g,m;s&qi.ABOVE&&!(r&qi.ABOVE)&&(g=d-(f-h)/p,i=g>=o&&g<=l),!i&&s&qi.RIGHT&&!(r&qi.RIGHT)&&(m=f-(d-l)*p,i=m>=a&&m<=h),!i&&s&qi.BELOW&&!(r&qi.BELOW)&&(g=d-(f-a)/p,i=g>=o&&g<=l),!i&&s&qi.LEFT&&!(r&qi.LEFT)&&(m=f-(d-o)*p,i=m>=a&&m<=h)}return i}function I3(n,e,t,i){if(sl(n))return il(t);let r=[];if(i>1){const a=n[2]-n[0],l=n[3]-n[1];for(let h=0;h<i;++h)r.push(n[0]+a*h/i,n[1],n[2],n[1]+l*h/i,n[2]-a*h/i,n[3],n[0],n[3]-l*h/i)}else r=[n[0],n[1],n[2],n[1],n[2],n[3],n[0],n[3]];e(r,r,2);const s=[],o=[];for(let a=0,l=r.length;a<l;a+=2)s.push(r[a]),o.push(r[a+1]);return _3(s,o,t)}function zi(n,e,t){return Math.min(Math.max(n,e),t)}function A3(n,e,t,i,r,s){const o=r-t,a=s-i;if(o!==0||a!==0){const l=((n-t)*o+(e-i)*a)/(o*o+a*a);l>1?(t=r,i=s):l>0&&(t+=o*l,i+=a*l)}return Mo(n,e,t,i)}function Mo(n,e,t,i){const r=t-n,s=i-e;return r*r+s*s}function M3(n){const e=n.length;for(let i=0;i<e;i++){let r=i,s=Math.abs(n[i][i]);for(let a=i+1;a<e;a++){const l=Math.abs(n[a][i]);l>s&&(s=l,r=a)}if(s===0)return null;const o=n[r];n[r]=n[i],n[i]=o;for(let a=i+1;a<e;a++){const l=-n[a][i]/n[i][i];for(let h=i;h<e+1;h++)i==h?n[a][h]=0:n[a][h]+=l*n[i][h]}}const t=new Array(e);for(let i=e-1;i>=0;i--){t[i]=n[i][e]/n[i][i];for(let r=i-1;r>=0;r--)n[r][e]-=n[r][i]*t[i]}return t}function ih(n){return n*Math.PI/180}function Po(n,e){const t=n%e;return t*e<0?t+e:t}function P3(n,e,t){return n+t*(e-n)}function iE(n,e){const t=Math.pow(10,e);return Math.round(n*t)/t}function Ml(n,e){return Math.floor(iE(n,e))}function Pl(n,e){return Math.ceil(iE(n,e))}const O3=/^#([a-f0-9]{3}|[a-f0-9]{4}(?:[a-f0-9]{2}){0,2})$/i,D3=/^([a-z]*)$|^hsla?\(.*\)$/i;function N3(n){return typeof n=="string"?n:U3(n)}function F3(n){const e=document.createElement("div");if(e.style.color=n,e.style.color!==""){document.body.appendChild(e);const t=getComputedStyle(e).color;return document.body.removeChild(e),t}return""}const L3=function(){const n={};let e=0;return function(t){let i;if(n.hasOwnProperty(t))i=n[t];else{if(e>=1024){let r=0;for(const s in n)r++&3||(delete n[s],--e)}i=w3(t),n[t]=i,++e}return i}}();function Wm(n){return Array.isArray(n)?n:L3(n)}function w3(n){let e,t,i,r,s;if(D3.exec(n)&&(n=F3(n)),O3.exec(n)){const o=n.length-1;let a;o<=4?a=1:a=2;const l=o===4||o===8;e=parseInt(n.substr(1+0*a,a),16),t=parseInt(n.substr(1+1*a,a),16),i=parseInt(n.substr(1+2*a,a),16),l?r=parseInt(n.substr(1+3*a,a),16):r=255,a==1&&(e=(e<<4)+e,t=(t<<4)+t,i=(i<<4)+i,l&&(r=(r<<4)+r)),s=[e,t,i,r/255]}else n.startsWith("rgba(")?(s=n.slice(5,-1).split(",").map(Number),Xm(s)):n.startsWith("rgb(")?(s=n.slice(4,-1).split(",").map(Number),s.push(1),Xm(s)):qt(!1,14);return s}function Xm(n){return n[0]=zi(n[0]+.5|0,0,255),n[1]=zi(n[1]+.5|0,0,255),n[2]=zi(n[2]+.5|0,0,255),n[3]=zi(n[3],0,1),n}function U3(n){let e=n[0];e!=(e|0)&&(e=e+.5|0);let t=n[1];t!=(t|0)&&(t=t+.5|0);let i=n[2];i!=(i|0)&&(i=i+.5|0);const r=n[3]===void 0?1:Math.round(n[3]*100)/100;return"rgba("+e+","+t+","+i+","+r+")"}class V3{constructor(){this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32}clear(){this.cache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let e=0;for(const t in this.cache_){const i=this.cache_[t];!(e++&3)&&!i.hasListener()&&(delete this.cache_[t],--this.cacheSize_)}}}get(e,t,i){const r=Hm(e,t,i);return r in this.cache_?this.cache_[r]:null}set(e,t,i,r){const s=Hm(e,t,i);this.cache_[s]=r,++this.cacheSize_}setSize(e){this.maxCacheSize_=e,this.expire()}}function Hm(n,e,t){const i=t?N3(t):"null";return e+":"+n+":"+i}const rE=new V3,Wt={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};class B3 extends qs{constructor(e){super(),this.on,this.once,this.un,this.background_=e.background;const t=Object.assign({},e);typeof e.properties=="object"&&(delete t.properties,Object.assign(t,e.properties)),t[Wt.OPACITY]=e.opacity!==void 0?e.opacity:1,qt(typeof t[Wt.OPACITY]=="number",64),t[Wt.VISIBLE]=e.visible!==void 0?e.visible:!0,t[Wt.Z_INDEX]=e.zIndex,t[Wt.MAX_RESOLUTION]=e.maxResolution!==void 0?e.maxResolution:1/0,t[Wt.MIN_RESOLUTION]=e.minResolution!==void 0?e.minResolution:0,t[Wt.MIN_ZOOM]=e.minZoom!==void 0?e.minZoom:-1/0,t[Wt.MAX_ZOOM]=e.maxZoom!==void 0?e.maxZoom:1/0,this.className_=t.className!==void 0?t.className:"ol-layer",delete t.className,this.setProperties(t),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(e){const t=this.state_||{layer:this,managed:e===void 0?!0:e},i=this.getZIndex();return t.opacity=zi(Math.round(this.getOpacity()*100)/100,0,1),t.visible=this.getVisible(),t.extent=this.getExtent(),t.zIndex=i===void 0&&!t.managed?1/0:i,t.maxResolution=this.getMaxResolution(),t.minResolution=Math.max(this.getMinResolution(),0),t.minZoom=this.getMinZoom(),t.maxZoom=this.getMaxZoom(),this.state_=t,t}getLayersArray(e){return mi()}getLayerStatesArray(e){return mi()}getExtent(){return this.get(Wt.EXTENT)}getMaxResolution(){return this.get(Wt.MAX_RESOLUTION)}getMinResolution(){return this.get(Wt.MIN_RESOLUTION)}getMinZoom(){return this.get(Wt.MIN_ZOOM)}getMaxZoom(){return this.get(Wt.MAX_ZOOM)}getOpacity(){return this.get(Wt.OPACITY)}getSourceState(){return mi()}getVisible(){return this.get(Wt.VISIBLE)}getZIndex(){return this.get(Wt.Z_INDEX)}setBackground(e){this.background_=e,this.changed()}setExtent(e){this.set(Wt.EXTENT,e)}setMaxResolution(e){this.set(Wt.MAX_RESOLUTION,e)}setMinResolution(e){this.set(Wt.MIN_RESOLUTION,e)}setMaxZoom(e){this.set(Wt.MAX_ZOOM,e)}setMinZoom(e){this.set(Wt.MIN_ZOOM,e)}setOpacity(e){qt(typeof e=="number",64),this.set(Wt.OPACITY,e)}setVisible(e){this.set(Wt.VISIBLE,e)}setZIndex(e){this.set(Wt.Z_INDEX,e)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}const sE=B3,un={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"},Or={ANIMATING:0,INTERACTING:1},Hr={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"},k3=42,hf=256,Ba={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};class z3{constructor(e){this.code_=e.code,this.units_=e.units,this.extent_=e.extent!==void 0?e.extent:null,this.worldExtent_=e.worldExtent!==void 0?e.worldExtent:null,this.axisOrientation_=e.axisOrientation!==void 0?e.axisOrientation:"enu",this.global_=e.global!==void 0?e.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=e.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=e.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||Ba[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(e){this.global_=e,this.canWrapX_=!!(e&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(e){this.defaultTileGrid_=e}setExtent(e){this.extent_=e,this.canWrapX_=!!(this.global_&&e)}setWorldExtent(e){this.worldExtent_=e}setGetPointResolution(e){this.getPointResolutionFunc_=e}getPointResolutionFunc(){return this.getPointResolutionFunc_}}const nE=z3,nl=6378137,_o=Math.PI*nl,G3=[-_o,-_o,_o,_o],W3=[-180,-85,180,85],Ol=nl*Math.log(Math.tan(Math.PI/2));class oo extends nE{constructor(e){super({code:e,units:"m",extent:G3,global:!0,worldExtent:W3,getPointResolution:function(t,i){return t/Math.cosh(i[1]/nl)}})}}const Km=[new oo("EPSG:3857"),new oo("EPSG:102100"),new oo("EPSG:102113"),new oo("EPSG:900913"),new oo("http://www.opengis.net/def/crs/EPSG/0/3857"),new oo("http://www.opengis.net/gml/srs/epsg.xml#3857")];function X3(n,e,t){const i=n.length;t=t>1?t:2,e===void 0&&(t>2?e=n.slice():e=new Array(i));for(let r=0;r<i;r+=t){e[r]=_o*n[r]/180;let s=nl*Math.log(Math.tan(Math.PI*(+n[r+1]+90)/360));s>Ol?s=Ol:s<-Ol&&(s=-Ol),e[r+1]=s}return e}function H3(n,e,t){const i=n.length;t=t>1?t:2,e===void 0&&(t>2?e=n.slice():e=new Array(i));for(let r=0;r<i;r+=t)e[r]=180*n[r]/_o,e[r+1]=360*Math.atan(Math.exp(n[r+1]/nl))/Math.PI-90;return e}const K3=6378137,qm=[-180,-90,180,90],q3=Math.PI*K3/180;class yn extends nE{constructor(e,t){super({code:e,units:"degrees",extent:qm,axisOrientation:t,global:!0,metersPerUnit:q3,worldExtent:qm})}}const Ym=[new yn("CRS:84"),new yn("EPSG:4326","neu"),new yn("urn:ogc:def:crs:OGC:1.3:CRS84"),new yn("urn:ogc:def:crs:OGC:2:84"),new yn("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new yn("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new yn("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let Wu={};function Y3(n){return Wu[n]||Wu[n.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function Z3(n,e){Wu[n]=e}let Oo={};function Mh(n,e,t){const i=n.getCode(),r=e.getCode();i in Oo||(Oo[i]={}),Oo[i][r]=t}function j3(n,e){let t;return n in Oo&&e in Oo[n]&&(t=Oo[n][e]),t}function Q3(n,e){return n[0]+=+e[0],n[1]+=+e[1],n}function Ph(n,e){let t=!0;for(let i=n.length-1;i>=0;--i)if(n[i]!=e[i]){t=!1;break}return t}function cf(n,e){const t=Math.cos(e),i=Math.sin(e),r=n[0]*t-n[1]*i,s=n[1]*t+n[0]*i;return n[0]=r,n[1]=s,n}function J3(n,e){return n[0]*=e,n[1]*=e,n}function $3(n,e){if(e.canWrapX()){const t=ki(e.getExtent()),i=eV(n,e,t);i&&(n[0]-=i*t)}return n}function eV(n,e,t){const i=e.getExtent();let r=0;return e.canWrapX()&&(n[0]<i[0]||n[0]>i[2])&&(t=t||ki(i),r=Math.floor((n[0]-i[0])/t)),r}const tV=63710088e-1;function Zm(n,e,t){t=t||tV;const i=ih(n[1]),r=ih(e[1]),s=(r-i)/2,o=ih(e[0]-n[0])/2,a=Math.sin(s)*Math.sin(s)+Math.sin(o)*Math.sin(o)*Math.cos(i)*Math.cos(r);return 2*t*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))}function oE(...n){console.warn(...n)}let Xu=!0;function iV(n){Xu=!(n===void 0||n)}function uf(n,e){if(e!==void 0){for(let t=0,i=n.length;t<i;++t)e[t]=n[t];e=e}else e=n.slice();return e}function aE(n,e){if(e!==void 0&&n!==e){for(let t=0,i=n.length;t<i;++t)e[t]=n[t];n=e}return n}function rV(n){Z3(n.getCode(),n),Mh(n,n,uf)}function sV(n){n.forEach(rV)}function Vr(n){return typeof n=="string"?Y3(n):n||null}function jm(n,e,t,i){n=Vr(n);let r;const s=n.getPointResolutionFunc();if(s){if(r=s(e,t),i&&i!==n.getUnits()){const o=n.getMetersPerUnit();o&&(r=r*o/Ba[i])}}else{const o=n.getUnits();if(o=="degrees"&&!i||i=="degrees")r=e;else{const a=ff(n,Vr("EPSG:4326"));if(a===aE&&o!=="degrees")r=e*n.getMetersPerUnit();else{let h=[t[0]-e/2,t[1],t[0]+e/2,t[1],t[0],t[1]-e/2,t[0],t[1]+e/2];h=a(h,h,2);const c=Zm(h.slice(0,2),h.slice(2,4)),u=Zm(h.slice(4,6),h.slice(6,8));r=(c+u)/2}const l=i?Ba[i]:n.getMetersPerUnit();l!==void 0&&(r/=l)}}return r}function Qm(n){sV(n),n.forEach(function(e){n.forEach(function(t){e!==t&&Mh(e,t,uf)})})}function nV(n,e,t,i){n.forEach(function(r){e.forEach(function(s){Mh(r,s,t),Mh(s,r,i)})})}function df(n,e){return n?typeof n=="string"?Vr(n):n:Vr(e)}function fo(n,e){if(n===e)return!0;const t=n.getUnits()===e.getUnits();return(n.getCode()===e.getCode()||ff(n,e)===uf)&&t}function ff(n,e){const t=n.getCode(),i=e.getCode();let r=j3(t,i);return r||(r=aE),r}function ka(n,e){const t=Vr(n),i=Vr(e);return ff(t,i)}function pf(n,e,t){return ka(e,t)(n,void 0,n.length)}function lE(n,e,t,i){const r=ka(e,t);return I3(n,r,void 0,i)}let Cs=null;function oV(n){Cs=Vr(n)}function aV(){return Cs}function lV(){oV("EPSG:4326")}function Hu(n,e){return Cs?pf(n,e,Cs):n}function Fs(n,e){return Cs?pf(n,Cs,e):(Xu&&!Ph(n,[0,0])&&n[0]>=-180&&n[0]<=180&&n[1]>=-90&&n[1]<=90&&(Xu=!1,oE("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),n)}function hV(n,e){return Cs?lE(n,e,Cs):n}function vo(n,e){return Cs?lE(n,Cs,e):n}function cV(){Qm(Km),Qm(Ym),nV(Ym,Km,X3,H3)}cV();function Jm(n,e,t){return function(i,r,s,o,a){if(!i)return;if(!r&&!e)return i;const l=e?0:s[0]*r,h=e?0:s[1]*r,c=a?a[0]:0,u=a?a[1]:0;let d=n[0]+l/2+c,f=n[2]-l/2+c,p=n[1]+h/2+u,g=n[3]-h/2+u;d>f&&(d=(f+d)/2,f=d),p>g&&(p=(g+p)/2,g=p);let m=zi(i[0],d,f),x=zi(i[1],p,g);if(o&&t&&r){const E=30*r;m+=-E*Math.log(1+Math.max(0,d-i[0])/E)+E*Math.log(1+Math.max(0,i[0]-f)/E),x+=-E*Math.log(1+Math.max(0,p-i[1])/E)+E*Math.log(1+Math.max(0,i[1]-g)/E)}return[m,x]}}function uV(n){return n}function gf(n,e,t,i){const r=ki(e)/t[0],s=xs(e)/t[1];return i?Math.min(n,Math.max(r,s)):Math.min(n,Math.min(r,s))}function mf(n,e,t){let i=Math.min(n,e);const r=50;return i*=Math.log(1+r*Math.max(0,n/e-1))/r+1,t&&(i=Math.max(i,t),i/=Math.log(1+r*Math.max(0,t/n-1))/r+1),zi(i,t/2,e*2)}function dV(n,e,t,i){return e=e!==void 0?e:!0,function(r,s,o,a){if(r!==void 0){const l=n[0],h=n[n.length-1],c=t?gf(l,t,o,i):l;if(a)return e?mf(r,c,h):zi(r,h,c);const u=Math.min(c,r),d=Math.floor(of(n,u,s));return n[d]>c&&d<n.length-1?n[d+1]:n[d]}}}function fV(n,e,t,i,r,s){return i=i!==void 0?i:!0,t=t!==void 0?t:0,function(o,a,l,h){if(o!==void 0){const c=r?gf(e,r,l,s):e;if(h)return i?mf(o,c,t):zi(o,t,c);const u=1e-9,d=Math.ceil(Math.log(e/c)/Math.log(n)-u),f=-a*(.5-u)+.5,p=Math.min(c,o),g=Math.floor(Math.log(e/p)/Math.log(n)+f),m=Math.max(d,g),x=e/Math.pow(n,m);return zi(x,t,c)}}}function $m(n,e,t,i,r){return t=t!==void 0?t:!0,function(s,o,a,l){if(s!==void 0){const h=i?gf(n,i,a,r):n;return!t||!l?zi(s,e,h):mf(s,h,e)}}}function _f(n){if(n!==void 0)return 0}function e_(n){if(n!==void 0)return n}function pV(n){const e=2*Math.PI/n;return function(t,i){if(i)return t;if(t!==void 0)return t=Math.floor(t/e+.5)*e,t}}function gV(n){return n=n||ih(5),function(e,t){if(t)return e;if(e!==void 0)return Math.abs(e)<=n?0:e}}function hE(n){return Math.pow(n,3)}function Jo(n){return 1-hE(1-n)}function mV(n){return 3*n*n-2*n*n*n}function _V(n){return n}function vV(n,e,t,i,r,s){s=s||[];let o=0;for(let a=e;a<t;a+=i){const l=n[a],h=n[a+1];s[o++]=r[0]*l+r[2]*h+r[4],s[o++]=r[1]*l+r[3]*h+r[5]}return s&&s.length!=o&&(s.length=o),s}function EV(n,e,t,i,r,s,o){o=o||[];const a=Math.cos(r),l=Math.sin(r),h=s[0],c=s[1];let u=0;for(let d=e;d<t;d+=i){const f=n[d]-h,p=n[d+1]-c;o[u++]=h+f*a-p*l,o[u++]=c+f*l+p*a;for(let g=d+2;g<d+i;++g)o[u++]=n[g]}return o&&o.length!=u&&(o.length=u),o}function TV(n,e,t,i,r,s,o,a){a=a||[];const l=o[0],h=o[1];let c=0;for(let u=e;u<t;u+=i){const d=n[u]-l,f=n[u+1]-h;a[c++]=l+r*d,a[c++]=h+s*f;for(let p=u+2;p<u+i;++p)a[c++]=n[p]}return a&&a.length!=c&&(a.length=c),a}function xV(n,e,t,i,r,s,o){o=o||[];let a=0;for(let l=e;l<t;l+=i){o[a++]=n[l]+r,o[a++]=n[l+1]+s;for(let h=l+2;h<l+i;++h)o[a++]=n[h]}return o&&o.length!=a&&(o.length=a),o}const t_=Ao();class CV extends qs{constructor(){super(),this.extent_=Xn(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=i3(function(e,t,i){if(!i)return this.getSimplifiedGeometry(t);const r=this.clone();return r.applyTransform(i),r.getSimplifiedGeometry(t)})}simplifyTransformed(e,t){return this.simplifyTransformedInternal(this.getRevision(),e,t)}clone(){return mi()}closestPointXY(e,t,i,r){return mi()}containsXY(e,t){const i=this.getClosestPoint([e,t]);return i[0]===e&&i[1]===t}getClosestPoint(e,t){return t=t||[NaN,NaN],this.closestPointXY(e[0],e[1],t,1/0),t}intersectsCoordinate(e){return this.containsXY(e[0],e[1])}computeExtent(e){return mi()}getExtent(e){if(this.extentRevision_!=this.getRevision()){const t=this.computeExtent(this.extent_);(isNaN(t[0])||isNaN(t[1]))&&il(t),this.extentRevision_=this.getRevision()}return y3(this.extent_,e)}rotate(e,t){mi()}scale(e,t,i){mi()}simplify(e){return this.getSimplifiedGeometry(e*e)}getSimplifiedGeometry(e){return mi()}getType(){return mi()}applyTransform(e){mi()}intersectsExtent(e){return mi()}translate(e,t){mi()}transform(e,t){const i=Vr(e),r=i.getUnits()=="tile-pixels"?function(s,o,a){const l=i.getExtent(),h=i.getWorldExtent(),c=xs(h)/xs(l);return Ua(t_,h[0],h[3],c,-c,0,0,0),vV(s,0,s.length,a,t_,o),ka(i,t)(s,o,a)}:ka(i,t);return this.applyTransform(r),this}}const RV=CV;class SV extends RV{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates=null}computeExtent(e){return x3(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}getCoordinates(){return mi()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&e<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const t=this.getSimplifiedGeometryInternal(e);return t.getFlatCoordinates().length<this.flatCoordinates.length?t:(this.simplifiedGeometryMaxMinSquaredTolerance=e,this)}getSimplifiedGeometryInternal(e){return this}getStride(){return this.stride}setFlatCoordinates(e,t){this.stride=i_(e),this.layout=e,this.flatCoordinates=t}setCoordinates(e,t){mi()}setLayout(e,t,i){let r;if(e)r=i_(e);else{for(let s=0;s<i;++s){if(t.length===0){this.layout="XY",this.stride=2;return}t=t[0]}r=t.length,e=yV(r)}this.layout=e,this.stride=r}applyTransform(e){this.flatCoordinates&&(e(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())}rotate(e,t){const i=this.getFlatCoordinates();if(i){const r=this.getStride();EV(i,0,i.length,r,e,t,i),this.changed()}}scale(e,t,i){t===void 0&&(t=e),i||(i=Va(this.getExtent()));const r=this.getFlatCoordinates();if(r){const s=this.getStride();TV(r,0,r.length,s,e,t,i,r),this.changed()}}translate(e,t){const i=this.getFlatCoordinates();if(i){const r=this.getStride();xV(i,0,i.length,r,e,t,i),this.changed()}}}function yV(n){let e;return n==2?e="XY":n==3?e="XYZ":n==4&&(e="XYZM"),e}function i_(n){let e;return n=="XY"?e=2:n=="XYZ"||n=="XYM"?e=3:n=="XYZM"&&(e=4),e}const vf=SV;function r_(n,e,t,i,r,s,o){const a=n[e],l=n[e+1],h=n[t]-a,c=n[t+1]-l;let u;if(h===0&&c===0)u=e;else{const d=((r-a)*h+(s-l)*c)/(h*h+c*c);if(d>1)u=t;else if(d>0){for(let f=0;f<i;++f)o[f]=P3(n[e+f],n[t+f],d);o.length=i;return}else u=e}for(let d=0;d<i;++d)o[d]=n[u+d];o.length=i}function cE(n,e,t,i,r){let s=n[e],o=n[e+1];for(e+=i;e<t;e+=i){const a=n[e],l=n[e+1],h=Mo(s,o,a,l);h>r&&(r=h),s=a,o=l}return r}function bV(n,e,t,i,r){for(let s=0,o=t.length;s<o;++s){const a=t[s];r=cE(n,e,a,i,r),e=a}return r}function uE(n,e,t,i,r,s,o,a,l,h,c){if(e==t)return h;let u,d;if(r===0){if(d=Mo(o,a,n[e],n[e+1]),d<h){for(u=0;u<i;++u)l[u]=n[e+u];return l.length=i,d}return h}c=c||[NaN,NaN];let f=e+i;for(;f<t;)if(r_(n,f-i,f,i,o,a,c),d=Mo(o,a,c[0],c[1]),d<h){for(h=d,u=0;u<i;++u)l[u]=c[u];l.length=i,f+=i}else f+=i*Math.max((Math.sqrt(d)-Math.sqrt(h))/r|0,1);if(s&&(r_(n,t-i,e,i,o,a,c),d=Mo(o,a,c[0],c[1]),d<h)){for(h=d,u=0;u<i;++u)l[u]=c[u];l.length=i}return h}function IV(n,e,t,i,r,s,o,a,l,h,c){c=c||[NaN,NaN];for(let u=0,d=t.length;u<d;++u){const f=t[u];h=uE(n,e,f,i,r,s,o,a,l,h,c),e=f}return h}function AV(n,e,t,i){for(let r=0,s=t.length;r<s;++r)n[e++]=t[r];return e}function dE(n,e,t,i){for(let r=0,s=t.length;r<s;++r){const o=t[r];for(let a=0;a<i;++a)n[e++]=o[a]}return e}function MV(n,e,t,i,r){r=r||[];let s=0;for(let o=0,a=t.length;o<a;++o){const l=dE(n,e,t[o],i);r[s++]=l,e=l}return r.length=s,r}function PV(n,e,t,i,r,s,o){const a=(t-e)/i;if(a<3){for(;e<t;e+=i)s[o++]=n[e],s[o++]=n[e+1];return o}const l=new Array(a);l[0]=1,l[a-1]=1;const h=[e,t-i];let c=0;for(;h.length>0;){const u=h.pop(),d=h.pop();let f=0;const p=n[d],g=n[d+1],m=n[u],x=n[u+1];for(let E=d+i;E<u;E+=i){const R=n[E],C=n[E+1],_=A3(R,C,p,g,m,x);_>f&&(c=E,f=_)}f>r&&(l[(c-e)/i]=1,d+i<c&&h.push(d,c),c+i<u&&h.push(c,u))}for(let u=0;u<a;++u)l[u]&&(s[o++]=n[e+u*i],s[o++]=n[e+u*i+1]);return o}function ao(n,e){return e*Math.round(n/e)}function OV(n,e,t,i,r,s,o){if(e==t)return o;let a=ao(n[e],r),l=ao(n[e+1],r);e+=i,s[o++]=a,s[o++]=l;let h,c;do if(h=ao(n[e],r),c=ao(n[e+1],r),e+=i,e==t)return s[o++]=h,s[o++]=c,o;while(h==a&&c==l);for(;e<t;){const u=ao(n[e],r),d=ao(n[e+1],r);if(e+=i,u==h&&d==c)continue;const f=h-a,p=c-l,g=u-a,m=d-l;if(f*m==p*g&&(f<0&&g<f||f==g||f>0&&g>f)&&(p<0&&m<p||p==m||p>0&&m>p)){h=u,c=d;continue}s[o++]=h,s[o++]=c,a=h,l=c,h=u,c=d}return s[o++]=h,s[o++]=c,o}function DV(n,e,t,i,r,s,o,a){for(let l=0,h=t.length;l<h;++l){const c=t[l];o=OV(n,e,c,i,r,s,o),a.push(o),e=c}return o}function fE(n,e,t,i,r){r=r!==void 0?r:[];let s=0;for(let o=e;o<t;o+=i)r[s++]=n.slice(o,o+i);return r.length=s,r}function NV(n,e,t,i,r){r=r!==void 0?r:[];let s=0;for(let o=0,a=t.length;o<a;++o){const l=t[o];r[s++]=fE(n,e,l,i,r[s]),e=l}return r.length=s,r}function pE(n,e,t,i){let r=0,s=n[t-i],o=n[t-i+1];for(;e<t;e+=i){const a=n[e],l=n[e+1];r+=o*a-s*l,s=a,o=l}return r/2}function FV(n,e,t,i){let r=0;for(let s=0,o=t.length;s<o;++s){const a=t[s];r+=pE(n,e,a,i),e=a}return r}class Oh extends vf{constructor(e,t){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,t!==void 0&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}clone(){return new Oh(this.flatCoordinates.slice(),this.layout)}closestPointXY(e,t,i,r){return r<Jv(this.getExtent(),e,t)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(cE(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),uE(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,e,t,i,r))}getArea(){return pE(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return fE(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(e){const t=[];return t.length=PV(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,0),new Oh(t,"XY")}getType(){return"LinearRing"}intersectsExtent(e){return!1}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=dE(this.flatCoordinates,0,e,this.stride),this.changed()}}const s_=Oh;class Ef extends vf{constructor(e,t){super(),this.setCoordinates(e,t)}clone(){const e=new Ef(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,r){const s=this.flatCoordinates,o=Mo(e,t,s[0],s[1]);if(o<r){const a=this.stride;for(let l=0;l<a;++l)i[l]=s[l];return i.length=a,o}return r}getCoordinates(){return this.flatCoordinates?this.flatCoordinates.slice():[]}computeExtent(e){return T3(this.flatCoordinates,e)}getType(){return"Point"}intersectsExtent(e){return $v(e,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(e,t){this.setLayout(t,e,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=AV(this.flatCoordinates,0,e,this.stride),this.changed()}}const LV=Ef;function wV(n,e,t,i,r){return!tE(r,function(s){return!Nn(n,e,t,i,s[0],s[1])})}function Nn(n,e,t,i,r,s){let o=0,a=n[t-i],l=n[t-i+1];for(;e<t;e+=i){const h=n[e],c=n[e+1];l<=s?c>s&&(h-a)*(s-l)-(r-a)*(c-l)>0&&o++:c<=s&&(h-a)*(s-l)-(r-a)*(c-l)<0&&o--,a=h,l=c}return o!==0}function gE(n,e,t,i,r,s){if(t.length===0||!Nn(n,e,t[0],i,r,s))return!1;for(let o=1,a=t.length;o<a;++o)if(Nn(n,t[o-1],t[o],i,r,s))return!1;return!0}function UV(n,e,t,i,r,s,o){let a,l,h,c,u,d,f;const p=r[s+1],g=[];for(let E=0,R=t.length;E<R;++E){const C=t[E];for(c=n[C-i],d=n[C-i+1],a=e;a<C;a+=i)u=n[a],f=n[a+1],(p<=d&&f<=p||d<=p&&p<=f)&&(h=(p-d)/(f-d)*(u-c)+c,g.push(h)),c=u,d=f}let m=NaN,x=-1/0;for(g.sort(nf),c=g[0],a=1,l=g.length;a<l;++a){u=g[a];const E=Math.abs(u-c);E>x&&(h=(c+u)/2,gE(n,e,t,i,h,p)&&(m=h,x=E)),c=u}return isNaN(m)&&(m=r[s]),o?(o.push(m,p,x),o):[m,p,x]}function VV(n,e,t,i,r){let s;for(e+=i;e<t;e+=i)if(s=r(n.slice(e-i,e),n.slice(e,e+i)),s)return s;return!1}function mE(n,e,t,i,r){const s=eE(Xn(),n,e,t,i);return rl(r,s)?E3(r,s)||s[0]>=r[0]&&s[2]<=r[2]||s[1]>=r[1]&&s[3]<=r[3]?!0:VV(n,e,t,i,function(o,a){return b3(r,o,a)}):!1}function _E(n,e,t,i,r){return!!(mE(n,e,t,i,r)||Nn(n,e,t,i,r[0],r[1])||Nn(n,e,t,i,r[0],r[3])||Nn(n,e,t,i,r[2],r[1])||Nn(n,e,t,i,r[2],r[3]))}function BV(n,e,t,i,r){if(!_E(n,e,t[0],i,r))return!1;if(t.length===1)return!0;for(let s=1,o=t.length;s<o;++s)if(wV(n,t[s-1],t[s],i,r)&&!mE(n,t[s-1],t[s],i,r))return!1;return!0}function kV(n,e,t,i){for(;e<t-i;){for(let r=0;r<i;++r){const s=n[e+r];n[e+r]=n[t-i+r],n[t-i+r]=s}e+=i,t-=i}}function vE(n,e,t,i){let r=0,s=n[t-i],o=n[t-i+1];for(;e<t;e+=i){const a=n[e],l=n[e+1];r+=(a-s)*(l+o),s=a,o=l}return r===0?void 0:r>0}function zV(n,e,t,i,r){r=r!==void 0?r:!1;for(let s=0,o=t.length;s<o;++s){const a=t[s],l=vE(n,e,a,i);if(s===0){if(r&&l||!r&&!l)return!1}else if(r&&!l||!r&&l)return!1;e=a}return!0}function n_(n,e,t,i,r){r=r!==void 0?r:!1;for(let s=0,o=t.length;s<o;++s){const a=t[s],l=vE(n,e,a,i);(s===0?r&&l||!r&&!l:r&&!l||!r&&l)&&kV(n,e,a,i),e=a}return e}class za extends vf{constructor(e,t,i){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,t!==void 0&&i?(this.setFlatCoordinates(t,e),this.ends_=i):this.setCoordinates(e,t)}appendLinearRing(e){this.flatCoordinates?e3(this.flatCoordinates,e.getFlatCoordinates()):this.flatCoordinates=e.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const e=new za(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return e.applyProperties(this),e}closestPointXY(e,t,i,r){return r<Jv(this.getExtent(),e,t)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(bV(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),IV(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,e,t,i,r))}containsXY(e,t){return gE(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,t)}getArea(){return FV(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(e){let t;return e!==void 0?(t=this.getOrientedFlatCoordinates().slice(),n_(t,0,this.ends_,this.stride,e)):t=this.flatCoordinates,NV(t,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const e=Va(this.getExtent());this.flatInteriorPoint_=UV(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new LV(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(e){return e<0||this.ends_.length<=e?null:new s_(this.flatCoordinates.slice(e===0?0:this.ends_[e-1],this.ends_[e]),this.layout)}getLinearRings(){const e=this.layout,t=this.flatCoordinates,i=this.ends_,r=[];let s=0;for(let o=0,a=i.length;o<a;++o){const l=i[o],h=new s_(t.slice(s,l),e);r.push(h),s=l}return r}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const e=this.flatCoordinates;zV(e,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=e:(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=n_(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(e){const t=[],i=[];return t.length=DV(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(e),t,0,i),new za(t,"XY",i)}getType(){return"Polygon"}intersectsExtent(e){return BV(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=MV(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=i.length===0?0:i[i.length-1],this.changed()}}function o_(n){if(sl(n))throw new Error("Cannot create polygon from empty extent");const e=n[0],t=n[1],i=n[2],r=n[3],s=[e,t,e,r,i,r,i,t,e,t];return new za(s,"XY",[s.length])}const du=0;class GV extends qs{constructor(e){super(),this.on,this.once,this.un,e=Object.assign({},e),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=df(e.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,e.projection&&iV(),e.center&&(e.center=Fs(e.center,this.projection_)),e.extent&&(e.extent=vo(e.extent,this.projection_)),this.applyOptions_(e)}applyOptions_(e){const t=Object.assign({},e);for(const a in Hr)delete t[a];this.setProperties(t,!0);const i=XV(e);this.maxResolution_=i.maxResolution,this.minResolution_=i.minResolution,this.zoomFactor_=i.zoomFactor,this.resolutions_=e.resolutions,this.padding_=e.padding,this.minZoom_=i.minZoom;const r=WV(e),s=i.constraint,o=HV(e);this.constraints_={center:r,resolution:s,rotation:o},this.setRotation(e.rotation!==void 0?e.rotation:0),this.setCenterInternal(e.center!==void 0?e.center:null),e.resolution!==void 0?this.setResolution(e.resolution):e.zoom!==void 0&&this.setZoom(e.zoom)}get padding(){return this.padding_}set padding(e){let t=this.padding_;this.padding_=e;const i=this.getCenterInternal();if(i){const r=e||[0,0,0,0];t=t||[0,0,0,0];const s=this.getResolution(),o=s/2*(r[3]-t[3]+t[1]-r[1]),a=s/2*(r[0]-t[0]+t[2]-r[2]);this.setCenterInternal([i[0]+o,i[1]-a])}}getUpdatedOptions_(e){const t=this.getProperties();return t.resolution!==void 0?t.resolution=this.getResolution():t.zoom=this.getZoom(),t.center=this.getCenterInternal(),t.rotation=this.getRotation(),Object.assign({},t,e)}animate(e){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const t=new Array(arguments.length);for(let i=0;i<t.length;++i){let r=arguments[i];r.center&&(r=Object.assign({},r),r.center=Fs(r.center,this.getProjection())),r.anchor&&(r=Object.assign({},r),r.anchor=Fs(r.anchor,this.getProjection())),t[i]=r}this.animateInternal.apply(this,t)}animateInternal(e){let t=arguments.length,i;t>1&&typeof arguments[t-1]=="function"&&(i=arguments[t-1],--t);let r=0;for(;r<t&&!this.isDef();++r){const c=arguments[r];c.center&&this.setCenterInternal(c.center),c.zoom!==void 0?this.setZoom(c.zoom):c.resolution&&this.setResolution(c.resolution),c.rotation!==void 0&&this.setRotation(c.rotation)}if(r===t){i&&Dl(i,!0);return}let s=Date.now(),o=this.targetCenter_.slice(),a=this.targetResolution_,l=this.targetRotation_;const h=[];for(;r<t;++r){const c=arguments[r],u={start:s,complete:!1,anchor:c.anchor,duration:c.duration!==void 0?c.duration:1e3,easing:c.easing||mV,callback:i};if(c.center&&(u.sourceCenter=o,u.targetCenter=c.center.slice(),o=u.targetCenter),c.zoom!==void 0?(u.sourceResolution=a,u.targetResolution=this.getResolutionForZoom(c.zoom),a=u.targetResolution):c.resolution&&(u.sourceResolution=a,u.targetResolution=c.resolution,a=u.targetResolution),c.rotation!==void 0){u.sourceRotation=l;const d=Po(c.rotation-l+Math.PI,2*Math.PI)-Math.PI;u.targetRotation=l+d,l=u.targetRotation}KV(u)?u.complete=!0:s+=u.duration,h.push(u)}this.animations_.push(h),this.setHint(Or.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[Or.ANIMATING]>0}getInteracting(){return this.hints_[Or.INTERACTING]>0}cancelAnimations(){this.setHint(Or.ANIMATING,-this.hints_[Or.ANIMATING]);let e;for(let t=0,i=this.animations_.length;t<i;++t){const r=this.animations_[t];if(r[0].callback&&Dl(r[0].callback,!1),!e)for(let s=0,o=r.length;s<o;++s){const a=r[s];if(!a.complete){e=a.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=e,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const e=Date.now();let t=!1;for(let i=this.animations_.length-1;i>=0;--i){const r=this.animations_[i];let s=!0;for(let o=0,a=r.length;o<a;++o){const l=r[o];if(l.complete)continue;const h=e-l.start;let c=l.duration>0?h/l.duration:1;c>=1?(l.complete=!0,c=1):s=!1;const u=l.easing(c);if(l.sourceCenter){const d=l.sourceCenter[0],f=l.sourceCenter[1],p=l.targetCenter[0],g=l.targetCenter[1];this.nextCenter_=l.targetCenter;const m=d+u*(p-d),x=f+u*(g-f);this.targetCenter_=[m,x]}if(l.sourceResolution&&l.targetResolution){const d=u===1?l.targetResolution:l.sourceResolution+u*(l.targetResolution-l.sourceResolution);if(l.anchor){const f=this.getViewportSize_(this.getRotation()),p=this.constraints_.resolution(d,0,f,!0);this.targetCenter_=this.calculateCenterZoom(p,l.anchor)}this.nextResolution_=l.targetResolution,this.targetResolution_=d,this.applyTargetState_(!0)}if(l.sourceRotation!==void 0&&l.targetRotation!==void 0){const d=u===1?Po(l.targetRotation+Math.PI,2*Math.PI)-Math.PI:l.sourceRotation+u*(l.targetRotation-l.sourceRotation);if(l.anchor){const f=this.constraints_.rotation(d,!0);this.targetCenter_=this.calculateCenterRotate(f,l.anchor)}this.nextRotation_=l.targetRotation,this.targetRotation_=d}if(this.applyTargetState_(!0),t=!0,!l.complete)break}if(s){this.animations_[i]=null,this.setHint(Or.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const o=r[0].callback;o&&Dl(o,!0)}}this.animations_=this.animations_.filter(Boolean),t&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(e,t){let i;const r=this.getCenterInternal();return r!==void 0&&(i=[r[0]-t[0],r[1]-t[1]],cf(i,e-this.getRotation()),Q3(i,t)),i}calculateCenterZoom(e,t){let i;const r=this.getCenterInternal(),s=this.getResolution();if(r!==void 0&&s!==void 0){const o=t[0]-e*(t[0]-r[0])/s,a=t[1]-e*(t[1]-r[1])/s;i=[o,a]}return i}getViewportSize_(e){const t=this.viewportSize_;if(e){const i=t[0],r=t[1];return[Math.abs(i*Math.cos(e))+Math.abs(r*Math.sin(e)),Math.abs(i*Math.sin(e))+Math.abs(r*Math.cos(e))]}return t}setViewportSize(e){this.viewportSize_=Array.isArray(e)?e.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const e=this.getCenterInternal();return e&&Hu(e,this.getProjection())}getCenterInternal(){return this.get(Hr.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(e){return e!==void 0?(e[0]=this.hints_[0],e[1]=this.hints_[1],e):this.hints_.slice()}calculateExtent(e){const t=this.calculateExtentInternal(e);return hV(t,this.getProjection())}calculateExtentInternal(e){e=e||this.getViewportSizeMinusPadding_();const t=this.getCenterInternal();qt(t,1);const i=this.getResolution();qt(i!==void 0,2);const r=this.getRotation();return qt(r!==void 0,3),zu(t,i,r,e)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(e){this.applyOptions_(this.getUpdatedOptions_({maxZoom:e}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(e){this.applyOptions_(this.getUpdatedOptions_({minZoom:e}))}setConstrainResolution(e){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:e}))}getProjection(){return this.projection_}getResolution(){return this.get(Hr.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(e,t){return this.getResolutionForExtentInternal(vo(e,this.getProjection()),t)}getResolutionForExtentInternal(e,t){t=t||this.getViewportSizeMinusPadding_();const i=ki(e)/t[0],r=xs(e)/t[1];return Math.max(i,r)}getResolutionForValueFunction(e){e=e||2;const t=this.getConstrainedResolution(this.maxResolution_),i=this.minResolution_,r=Math.log(t/i)/Math.log(e);return function(s){return t/Math.pow(e,s*r)}}getRotation(){return this.get(Hr.ROTATION)}getValueForResolutionFunction(e){const t=Math.log(e||2),i=this.getConstrainedResolution(this.maxResolution_),r=this.minResolution_,s=Math.log(i/r)/t;return function(o){return Math.log(i/o)/t/s}}getViewportSizeMinusPadding_(e){let t=this.getViewportSize_(e);const i=this.padding_;return i&&(t=[t[0]-i[1]-i[3],t[1]-i[0]-i[2]]),t}getState(){const e=this.getProjection(),t=this.getResolution(),i=this.getRotation();let r=this.getCenterInternal();const s=this.padding_;if(s){const o=this.getViewportSizeMinusPadding_();r=fu(r,this.getViewportSize_(),[o[0]/2+s[3],o[1]/2+s[0]],t,i)}return{center:r.slice(0),projection:e!==void 0?e:null,resolution:t,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:i,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let e;const t=this.getResolution();return t!==void 0&&(e=this.getZoomForResolution(t)),e}getZoomForResolution(e){let t=this.minZoom_||0,i,r;if(this.resolutions_){const s=of(this.resolutions_,e,1);t=s,i=this.resolutions_[s],s==this.resolutions_.length-1?r=2:r=i/this.resolutions_[s+1]}else i=this.maxResolution_,r=this.zoomFactor_;return t+Math.log(i/e)/Math.log(r)}getResolutionForZoom(e){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;const t=zi(Math.floor(e),0,this.resolutions_.length-2),i=this.resolutions_[t]/this.resolutions_[t+1];return this.resolutions_[t]/Math.pow(i,zi(e-t,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,e-this.minZoom_)}fit(e,t){let i;if(qt(Array.isArray(e)||typeof e.getSimplifiedGeometry=="function",24),Array.isArray(e)){qt(!sl(e),25);const r=vo(e,this.getProjection());i=o_(r)}else if(e.getType()==="Circle"){const r=vo(e.getExtent(),this.getProjection());i=o_(r),i.rotate(this.getRotation(),Va(r))}else{const r=aV();r?i=e.clone().transform(r,this.getProjection()):i=e}this.fitInternal(i,t)}rotatedExtentForGeometry(e){const t=this.getRotation(),i=Math.cos(t),r=Math.sin(-t),s=e.getFlatCoordinates(),o=e.getStride();let a=1/0,l=1/0,h=-1/0,c=-1/0;for(let u=0,d=s.length;u<d;u+=o){const f=s[u]*i-s[u+1]*r,p=s[u]*r+s[u+1]*i;a=Math.min(a,f),l=Math.min(l,p),h=Math.max(h,f),c=Math.max(c,p)}return[a,l,h,c]}fitInternal(e,t){t=t||{};let i=t.size;i||(i=this.getViewportSizeMinusPadding_());const r=t.padding!==void 0?t.padding:[0,0,0,0],s=t.nearest!==void 0?t.nearest:!1;let o;t.minResolution!==void 0?o=t.minResolution:t.maxZoom!==void 0?o=this.getResolutionForZoom(t.maxZoom):o=0;const a=this.rotatedExtentForGeometry(e);let l=this.getResolutionForExtentInternal(a,[i[0]-r[1]-r[3],i[1]-r[0]-r[2]]);l=isNaN(l)?o:Math.max(l,o),l=this.getConstrainedResolution(l,s?0:1);const h=this.getRotation(),c=Math.sin(h),u=Math.cos(h),d=Va(a);d[0]+=(r[1]-r[3])/2*l,d[1]+=(r[0]-r[2])/2*l;const f=d[0]*u-d[1]*c,p=d[1]*u+d[0]*c,g=this.getConstrainedCenter([f,p],l),m=t.callback?t.callback:Ih;t.duration!==void 0?this.animateInternal({resolution:l,center:g,duration:t.duration,easing:t.easing},m):(this.targetResolution_=l,this.targetCenter_=g,this.applyTargetState_(!1,!0),Dl(m,!0))}centerOn(e,t,i){this.centerOnInternal(Fs(e,this.getProjection()),t,i)}centerOnInternal(e,t,i){this.setCenterInternal(fu(e,t,i,this.getResolution(),this.getRotation()))}calculateCenterShift(e,t,i,r){let s;const o=this.padding_;if(o&&e){const a=this.getViewportSizeMinusPadding_(-i),l=fu(e,r,[a[0]/2+o[3],a[1]/2+o[0]],t,i);s=[e[0]-l[0],e[1]-l[1]]}return s}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(e){const t=Hu(this.targetCenter_,this.getProjection());this.setCenter([t[0]+e[0],t[1]+e[1]])}adjustCenterInternal(e){const t=this.targetCenter_;this.setCenterInternal([t[0]+e[0],t[1]+e[1]])}adjustResolution(e,t){t=t&&Fs(t,this.getProjection()),this.adjustResolutionInternal(e,t)}adjustResolutionInternal(e,t){const i=this.getAnimating()||this.getInteracting(),r=this.getViewportSize_(this.getRotation()),s=this.constraints_.resolution(this.targetResolution_*e,0,r,i);t&&(this.targetCenter_=this.calculateCenterZoom(s,t)),this.targetResolution_*=e,this.applyTargetState_()}adjustZoom(e,t){this.adjustResolution(Math.pow(this.zoomFactor_,-e),t)}adjustRotation(e,t){t&&(t=Fs(t,this.getProjection())),this.adjustRotationInternal(e,t)}adjustRotationInternal(e,t){const i=this.getAnimating()||this.getInteracting(),r=this.constraints_.rotation(this.targetRotation_+e,i);t&&(this.targetCenter_=this.calculateCenterRotate(r,t)),this.targetRotation_+=e,this.applyTargetState_()}setCenter(e){this.setCenterInternal(e&&Fs(e,this.getProjection()))}setCenterInternal(e){this.targetCenter_=e,this.applyTargetState_()}setHint(e,t){return this.hints_[e]+=t,this.changed(),this.hints_[e]}setResolution(e){this.targetResolution_=e,this.applyTargetState_()}setRotation(e){this.targetRotation_=e,this.applyTargetState_()}setZoom(e){this.setResolution(this.getResolutionForZoom(e))}applyTargetState_(e,t){const i=this.getAnimating()||this.getInteracting()||t,r=this.constraints_.rotation(this.targetRotation_,i),s=this.getViewportSize_(r),o=this.constraints_.resolution(this.targetResolution_,0,s,i),a=this.constraints_.center(this.targetCenter_,o,s,i,this.calculateCenterShift(this.targetCenter_,o,r,s));this.get(Hr.ROTATION)!==r&&this.set(Hr.ROTATION,r),this.get(Hr.RESOLUTION)!==o&&(this.set(Hr.RESOLUTION,o),this.set("zoom",this.getZoom(),!0)),(!a||!this.get(Hr.CENTER)||!Ph(this.get(Hr.CENTER),a))&&this.set(Hr.CENTER,a),this.getAnimating()&&!e&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(e,t,i){e=e!==void 0?e:200;const r=t||0,s=this.constraints_.rotation(this.targetRotation_),o=this.getViewportSize_(s),a=this.constraints_.resolution(this.targetResolution_,r,o),l=this.constraints_.center(this.targetCenter_,a,o,!1,this.calculateCenterShift(this.targetCenter_,a,s,o));if(e===0&&!this.cancelAnchor_){this.targetResolution_=a,this.targetRotation_=s,this.targetCenter_=l,this.applyTargetState_();return}i=i||(e===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==a||this.getRotation()!==s||!this.getCenterInternal()||!Ph(this.getCenterInternal(),l))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:s,center:l,resolution:a,duration:e,easing:Jo,anchor:i}))}beginInteraction(){this.resolveConstraints(0),this.setHint(Or.INTERACTING,1)}endInteraction(e,t,i){i=i&&Fs(i,this.getProjection()),this.endInteractionInternal(e,t,i)}endInteractionInternal(e,t,i){this.getInteracting()&&(this.setHint(Or.INTERACTING,-1),this.resolveConstraints(e,t,i))}getConstrainedCenter(e,t){const i=this.getViewportSize_(this.getRotation());return this.constraints_.center(e,t||this.getResolution(),i)}getConstrainedZoom(e,t){const i=this.getResolutionForZoom(e);return this.getZoomForResolution(this.getConstrainedResolution(i,t))}getConstrainedResolution(e,t){t=t||0;const i=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(e,t,i)}}function Dl(n,e){setTimeout(function(){n(e)},0)}function WV(n){if(n.extent!==void 0){const t=n.smoothExtentConstraint!==void 0?n.smoothExtentConstraint:!0;return Jm(n.extent,n.constrainOnlyCenter,t)}const e=df(n.projection,"EPSG:3857");if(n.multiWorld!==!0&&e.isGlobal()){const t=e.getExtent().slice();return t[0]=-1/0,t[2]=1/0,Jm(t,!1,!1)}return uV}function XV(n){let e,t,i,r=n.minZoom!==void 0?n.minZoom:du,s=n.maxZoom!==void 0?n.maxZoom:28;const o=n.zoomFactor!==void 0?n.zoomFactor:2,a=n.multiWorld!==void 0?n.multiWorld:!1,l=n.smoothResolutionConstraint!==void 0?n.smoothResolutionConstraint:!0,h=n.showFullExtent!==void 0?n.showFullExtent:!1,c=df(n.projection,"EPSG:3857"),u=c.getExtent();let d=n.constrainOnlyCenter,f=n.extent;if(!a&&!f&&c.isGlobal()&&(d=!1,f=u),n.resolutions!==void 0){const p=n.resolutions;t=p[r],i=p[s]!==void 0?p[s]:p[p.length-1],n.constrainResolution?e=dV(p,l,!d&&f,h):e=$m(t,i,l,!d&&f,h)}else{const p=(u?Math.max(ki(u),xs(u)):360*Ba.degrees/c.getMetersPerUnit())/hf/Math.pow(2,du),g=p/Math.pow(2,28-du);t=n.maxResolution,t!==void 0?r=0:t=p/Math.pow(o,r),i=n.minResolution,i===void 0&&(n.maxZoom!==void 0?n.maxResolution!==void 0?i=t/Math.pow(o,s):i=p/Math.pow(o,s):i=g),s=r+Math.floor(Math.log(t/i)/Math.log(o)),i=t/Math.pow(o,s-r),n.constrainResolution?e=fV(o,t,i,l,!d&&f,h):e=$m(t,i,l,!d&&f,h)}return{constraint:e,maxResolution:t,minResolution:i,minZoom:r,zoomFactor:o}}function HV(n){if(n.enableRotation===void 0||n.enableRotation){const e=n.constrainRotation;return e===void 0||e===!0?gV():e===!1?e_:typeof e=="number"?pV(e):e_}return _f}function KV(n){return!(n.sourceCenter&&n.targetCenter&&!Ph(n.sourceCenter,n.targetCenter)||n.sourceResolution!==n.targetResolution||n.sourceRotation!==n.targetRotation)}function fu(n,e,t,i,r){const s=Math.cos(-r);let o=Math.sin(-r),a=n[0]*s-n[1]*o,l=n[1]*s+n[0]*o;a+=(e[0]/2-t[0])*i,l+=(t[1]-e[1]/2)*i,o=-o;const h=a*s-l*o,c=l*s+a*o;return[h,c]}const $r=GV;class qV extends sE{constructor(e){const t=Object.assign({},e);delete t.source,super(t),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,e.render&&(this.render=e.render),e.map&&this.setMap(e.map),this.addChangeListener(Wt.SOURCE,this.handleSourcePropertyChange_);const i=e.source?e.source:null;this.setSource(i)}getLayersArray(e){return e=e||[],e.push(this),e}getLayerStatesArray(e){return e=e||[],e.push(this.getLayerState()),e}getSource(){return this.get(Wt.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){const e=this.getSource();return e?e.getState():"undefined"}handleSourceChange_(){this.changed(),!(this.sourceReady_||this.getSource().getState()!=="ready")&&(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(xi(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const e=this.getSource();e&&(this.sourceChangeKey_=Kt(e,Rt.CHANGE,this.handleSourceChange_,this),e.getState()==="ready"&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0))),this.changed()}getFeatures(e){return this.renderer_?this.renderer_.getFeatures(e):Promise.resolve([])}getData(e){return!this.renderer_||!this.rendered?null:this.renderer_.getData(e)}isVisible(e){let t;const i=this.getMapInternal();!e&&i&&(e=i.getView()),e instanceof $r?t={viewState:e.getState(),extent:e.calculateExtent()}:t=e,!t.layerStatesArray&&i&&(t.layerStatesArray=i.getLayerGroup().getLayerStatesArray());let r;t.layerStatesArray?r=t.layerStatesArray.find(o=>o.layer===this):r=this.getLayerState();const s=this.getExtent();return Tf(r,t.viewState)&&(!s||rl(s,t.extent))}getAttributions(e){if(!this.isVisible(e))return[];let t;const i=this.getSource();if(i&&(t=i.getAttributions()),!t)return[];const r=e instanceof $r?e.getViewStateAndExtent():e;let s=t(r);return Array.isArray(s)||(s=[s]),s}render(e,t){const i=this.getRenderer();return i.prepareFrame(e)?(this.rendered=!0,i.renderFrame(e,t)):null}unrender(){this.rendered=!1}setMapInternal(e){e||this.unrender(),this.set(Wt.MAP,e)}getMapInternal(){return this.get(Wt.MAP)}setMap(e){this.mapPrecomposeKey_&&(xi(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),e||this.changed(),this.mapRenderKey_&&(xi(this.mapRenderKey_),this.mapRenderKey_=null),e&&(this.mapPrecomposeKey_=Kt(e,un.PRECOMPOSE,function(t){const i=t.frameState.layerStatesArray,r=this.getLayerState(!1);qt(!i.some(function(s){return s.layer===r.layer}),67),i.push(r)},this),this.mapRenderKey_=Kt(this,Rt.CHANGE,e.render,e),this.changed())}setSource(e){this.set(Wt.SOURCE,e)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}disposeInternal(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),super.disposeInternal()}}function Tf(n,e){if(!n.visible)return!1;const t=e.resolution;if(t<n.minResolution||t>=n.maxResolution)return!1;const i=e.zoom;return i>n.minZoom&&i<=n.maxZoom}const xf=qV;class YV extends sf{constructor(e){super(),this.map_=e}dispatchRenderEvent(e,t){mi()}calculateMatrices2D(e){const t=e.viewState,i=e.coordinateToPixelTransform,r=e.pixelToCoordinateTransform;Ua(i,e.size[0]/2,e.size[1]/2,1/t.resolution,-1/t.resolution,-t.rotation,-t.center[0],-t.center[1]),Qv(r,i)}forEachFeatureAtCoordinate(e,t,i,r,s,o,a,l){let h;const c=t.viewState;function u(C,_,T,y){return s.call(o,_,C?T:null,y)}const d=c.projection,f=$3(e.slice(),d),p=[[0,0]];if(d.canWrapX()&&r){const C=d.getExtent(),_=ki(C);p.push([-_,0],[_,0])}const g=t.layerStatesArray,m=g.length,x=[],E=[];for(let C=0;C<p.length;C++)for(let _=m-1;_>=0;--_){const T=g[_],y=T.layer;if(y.hasRenderer()&&Tf(T,c)&&a.call(l,y)){const P=y.getRenderer(),D=y.getSource();if(P&&D){const F=D.getWrapX()?f:e,N=u.bind(null,T.managed);E[0]=F[0]+p[C][0],E[1]=F[1]+p[C][1],h=P.forEachFeatureAtCoordinate(E,t,i,N,x)}if(h)return h}}if(x.length===0)return;const R=1/x.length;return x.forEach((C,_)=>C.distanceSq+=_*R),x.sort((C,_)=>C.distanceSq-_.distanceSq),x.some(C=>h=C.callback(C.feature,C.layer,C.geometry)),h}hasFeatureAtCoordinate(e,t,i,r,s,o){return this.forEachFeatureAtCoordinate(e,t,i,r,bh,this,s,o)!==void 0}getMap(){return this.map_}renderFrame(e){mi()}flushDeclutterItems(e){}scheduleExpireIconCache(e){rE.canExpireCache()&&e.postRenderFunctions.push(ZV)}}function ZV(n,e){rE.expire()}const jV=YV;class QV extends Tn{constructor(e,t,i,r){super(e),this.inversePixelTransform=t,this.frameState=i,this.context=r}}const EE=QV,Nl="ol-hidden",pc="ol-unselectable",Cf="ol-control",a_="ol-collapsed";function ko(n,e,t,i){let r;return t&&t.length?r=t.shift():Zv?r=new OffscreenCanvas(n||300,e||300):r=document.createElement("canvas"),n&&(r.width=n),e&&(r.height=e),r.getContext("2d",i)}function Rf(n){const e=n.canvas;e.width=1,e.height=1,n.clearRect(0,0,1,1)}function l_(n,e){const t=e.parentNode;t&&t.replaceChild(n,e)}function Ku(n){return n&&n.parentNode?n.parentNode.removeChild(n):null}function JV(n){for(;n.lastChild;)n.removeChild(n.lastChild)}function $V(n,e){const t=n.childNodes;for(let i=0;;++i){const r=t[i],s=e[i];if(!r&&!s)break;if(r!==s){if(!r){n.appendChild(s);continue}if(!s){n.removeChild(r),--i;continue}n.insertBefore(s,r)}}}const eB=new qs;class tB extends jV{constructor(e){super(e),this.fontChangeListenerKey_=Kt(eB,wa.PROPERTYCHANGE,e.redrawText.bind(e)),this.element_=document.createElement("div");const t=this.element_.style;t.position="absolute",t.width="100%",t.height="100%",t.zIndex="0",this.element_.className=pc+" ol-layers";const i=e.getViewport();i.insertBefore(this.element_,i.firstChild||null),this.children_=[],this.renderedVisible_=!0,this.declutterLayers_=[]}dispatchRenderEvent(e,t){const i=this.getMap();if(i.hasListener(e)){const r=new EE(e,void 0,t);i.dispatchEvent(r)}}disposeInternal(){xi(this.fontChangeListenerKey_),this.element_.parentNode.removeChild(this.element_),super.disposeInternal()}renderFrame(e){if(!e){this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1);return}this.calculateMatrices2D(e),this.dispatchRenderEvent(un.PRECOMPOSE,e);const t=e.layerStatesArray.sort(function(o,a){return o.zIndex-a.zIndex}),i=e.viewState;this.children_.length=0;const r=this.declutterLayers_;r.length=0;let s=null;for(let o=0,a=t.length;o<a;++o){const l=t[o];e.layerIndex=o;const h=l.layer,c=h.getSourceState();if(!Tf(l,i)||c!="ready"&&c!="undefined"){h.unrender();continue}const u=h.render(e,s);u&&(u!==s&&(this.children_.push(u),s=u),"getDeclutter"in h&&r.push(h))}this.flushDeclutterItems(e),$V(this.element_,this.children_),this.dispatchRenderEvent(un.POSTCOMPOSE,e),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(e)}flushDeclutterItems(e){const t=this.declutterLayers_;for(let i=t.length-1;i>=0;--i)t[i].renderDeclutter(e);t.length=0}}const iB=tB;class ln extends Tn{constructor(e,t){super(e),this.layer=t}}const pu={LAYERS:"layers"};class Sf extends sE{constructor(e){e=e||{};const t=Object.assign({},e);delete t.layers;let i=e.layers;super(t),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(pu.LAYERS,this.handleLayersChanged_),i?Array.isArray(i)?i=new Gs(i.slice(),{unique:!0}):qt(typeof i.getArray=="function",43):i=new Gs(void 0,{unique:!0}),this.setLayers(i)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(xi),this.layersListenerKeys_.length=0;const e=this.getLayers();this.layersListenerKeys_.push(Kt(e,Lr.ADD,this.handleLayersAdd_,this),Kt(e,Lr.REMOVE,this.handleLayersRemove_,this));for(const i in this.listenerKeys_)this.listenerKeys_[i].forEach(xi);hc(this.listenerKeys_);const t=e.getArray();for(let i=0,r=t.length;i<r;i++){const s=t[i];this.registerLayerListeners_(s),this.dispatchEvent(new ln("addlayer",s))}this.changed()}registerLayerListeners_(e){const t=[Kt(e,wa.PROPERTYCHANGE,this.handleLayerChange_,this),Kt(e,Rt.CHANGE,this.handleLayerChange_,this)];e instanceof Sf&&t.push(Kt(e,"addlayer",this.handleLayerGroupAdd_,this),Kt(e,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[gr(e)]=t}handleLayerGroupAdd_(e){this.dispatchEvent(new ln("addlayer",e.layer))}handleLayerGroupRemove_(e){this.dispatchEvent(new ln("removelayer",e.layer))}handleLayersAdd_(e){const t=e.element;this.registerLayerListeners_(t),this.dispatchEvent(new ln("addlayer",t)),this.changed()}handleLayersRemove_(e){const t=e.element,i=gr(t);this.listenerKeys_[i].forEach(xi),delete this.listenerKeys_[i],this.dispatchEvent(new ln("removelayer",t)),this.changed()}getLayers(){return this.get(pu.LAYERS)}setLayers(e){const t=this.getLayers();if(t){const i=t.getArray();for(let r=0,s=i.length;r<s;++r)this.dispatchEvent(new ln("removelayer",i[r]))}this.set(pu.LAYERS,e)}getLayersArray(e){return e=e!==void 0?e:[],this.getLayers().forEach(function(t){t.getLayersArray(e)}),e}getLayerStatesArray(e){const t=e!==void 0?e:[],i=t.length;this.getLayers().forEach(function(o){o.getLayerStatesArray(t)});const r=this.getLayerState();let s=r.zIndex;!e&&r.zIndex===void 0&&(s=0);for(let o=i,a=t.length;o<a;o++){const l=t[o];l.opacity*=r.opacity,l.visible=l.visible&&r.visible,l.maxResolution=Math.min(l.maxResolution,r.maxResolution),l.minResolution=Math.max(l.minResolution,r.minResolution),l.minZoom=Math.max(l.minZoom,r.minZoom),l.maxZoom=Math.min(l.maxZoom,r.maxZoom),r.extent!==void 0&&(l.extent!==void 0?l.extent=Ea(l.extent,r.extent):l.extent=r.extent),l.zIndex===void 0&&(l.zIndex=s)}return t}getSourceState(){return"ready"}}const gc=Sf;class rB extends Tn{constructor(e,t,i){super(e),this.map=t,this.frameState=i!==void 0?i:null}}const po=rB;class sB extends po{constructor(e,t,i,r,s,o){super(e,t,s),this.originalEvent=i,this.pixel_=null,this.coordinate_=null,this.dragging=r!==void 0?r:!1,this.activePointers=o}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(e){this.pixel_=e}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(e){this.coordinate_=e}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}}const nn=sB,pi={SINGLECLICK:"singleclick",CLICK:Rt.CLICK,DBLCLICK:Rt.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},qu={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"};class nB extends af{constructor(e,t){super(e),this.map_=e,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=t===void 0?1:t,this.down_=null;const i=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=i,this.pointerdownListenerKey_=Kt(i,qu.POINTERDOWN,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=Kt(i,qu.POINTERMOVE,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(Rt.TOUCHMOVE,this.boundHandleTouchMove_,jv?{passive:!1}:!1)}emulateClick_(e){let t=new nn(pi.CLICK,this.map_,e);this.dispatchEvent(t),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,t=new nn(pi.DBLCLICK,this.map_,e),this.dispatchEvent(t)):this.clickTimeoutId_=setTimeout(()=>{this.clickTimeoutId_=void 0;const i=new nn(pi.SINGLECLICK,this.map_,e);this.dispatchEvent(i)},250)}updateActivePointers_(e){const t=e,i=t.pointerId;if(t.type==pi.POINTERUP||t.type==pi.POINTERCANCEL){delete this.trackedTouches_[i];for(const r in this.trackedTouches_)if(this.trackedTouches_[r].target!==t.target){delete this.trackedTouches_[r];break}}else(t.type==pi.POINTERDOWN||t.type==pi.POINTERMOVE)&&(this.trackedTouches_[i]=t);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(e){this.updateActivePointers_(e);const t=new nn(pi.POINTERUP,this.map_,e,void 0,void 0,this.activePointers_);this.dispatchEvent(t),this.emulateClicks_&&!t.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(e)&&this.emulateClick_(this.down_),this.activePointers_.length===0&&(this.dragListenerKeys_.forEach(xi),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(e){return e.button===0}handlePointerDown_(e){this.emulateClicks_=this.activePointers_.length===0,this.updateActivePointers_(e);const t=new nn(pi.POINTERDOWN,this.map_,e,void 0,void 0,this.activePointers_);if(this.dispatchEvent(t),this.down_=new PointerEvent(e.type,e),Object.defineProperty(this.down_,"target",{writable:!1,value:e.target}),this.dragListenerKeys_.length===0){const i=this.map_.getOwnerDocument();this.dragListenerKeys_.push(Kt(i,pi.POINTERMOVE,this.handlePointerMove_,this),Kt(i,pi.POINTERUP,this.handlePointerUp_,this),Kt(this.element_,pi.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==i&&this.dragListenerKeys_.push(Kt(this.element_.getRootNode(),pi.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(e){if(this.isMoving_(e)){this.updateActivePointers_(e),this.dragging_=!0;const t=new nn(pi.POINTERDRAG,this.map_,e,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(t)}}relayMoveEvent_(e){this.originalPointerMoveEvent_=e;const t=!!(this.down_&&this.isMoving_(e));this.dispatchEvent(new nn(pi.POINTERMOVE,this.map_,e,t))}handleTouchMove_(e){const t=this.originalPointerMoveEvent_;(!t||t.defaultPrevented)&&(typeof e.cancelable!="boolean"||e.cancelable===!0)&&e.preventDefault()}isMoving_(e){return this.dragging_||Math.abs(e.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(e.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(xi(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(Rt.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(xi(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(xi),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}}const oB=nB,on={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"},Qi={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"},Yu=1/0;class aB{constructor(e,t){this.priorityFunction_=e,this.keyFunction_=t,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,hc(this.queuedElements_)}dequeue(){const e=this.elements_,t=this.priorities_,i=e[0];e.length==1?(e.length=0,t.length=0):(e[0]=e.pop(),t[0]=t.pop(),this.siftUp_(0));const r=this.keyFunction_(i);return delete this.queuedElements_[r],i}enqueue(e){qt(!(this.keyFunction_(e)in this.queuedElements_),31);const t=this.priorityFunction_(e);return t!=Yu?(this.elements_.push(e),this.priorities_.push(t),this.queuedElements_[this.keyFunction_(e)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1}getCount(){return this.elements_.length}getLeftChildIndex_(e){return e*2+1}getRightChildIndex_(e){return e*2+2}getParentIndex_(e){return e-1>>1}heapify_(){let e;for(e=(this.elements_.length>>1)-1;e>=0;e--)this.siftUp_(e)}isEmpty(){return this.elements_.length===0}isKeyQueued(e){return e in this.queuedElements_}isQueued(e){return this.isKeyQueued(this.keyFunction_(e))}siftUp_(e){const t=this.elements_,i=this.priorities_,r=t.length,s=t[e],o=i[e],a=e;for(;e<r>>1;){const l=this.getLeftChildIndex_(e),h=this.getRightChildIndex_(e),c=h<r&&i[h]<i[l]?h:l;t[e]=t[c],i[e]=i[c],e=c}t[e]=s,i[e]=o,this.siftDown_(a,e)}siftDown_(e,t){const i=this.elements_,r=this.priorities_,s=i[t],o=r[t];for(;t>e;){const a=this.getParentIndex_(t);if(r[a]>o)i[t]=i[a],r[t]=r[a],t=a;else break}i[t]=s,r[t]=o}reprioritize(){const e=this.priorityFunction_,t=this.elements_,i=this.priorities_;let r=0;const s=t.length;let o,a,l;for(a=0;a<s;++a)o=t[a],l=e(o),l==Yu?delete this.queuedElements_[this.keyFunction_(o)]:(i[r]=l,t[r++]=o);t.length=r,i.length=r,this.heapify_()}}const lB=aB,je={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};class hB extends lB{constructor(e,t){super(function(i){return e.apply(null,i)},function(i){return i[0].getKey()}),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=t,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(e){const t=super.enqueue(e);return t&&e[0].addEventListener(Rt.CHANGE,this.boundHandleTileChange_),t}getTilesLoading(){return this.tilesLoading_}handleTileChange(e){const t=e.target,i=t.getState();if(i===je.LOADED||i===je.ERROR||i===je.EMPTY){i!==je.ERROR&&t.removeEventListener(Rt.CHANGE,this.boundHandleTileChange_);const r=t.getKey();r in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[r],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(e,t){let i=0,r,s,o;for(;this.tilesLoading_<e&&i<t&&this.getCount()>0;)s=this.dequeue()[0],o=s.getKey(),r=s.getState(),r===je.IDLE&&!(o in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[o]=!0,++this.tilesLoading_,++i,s.load())}}const cB=hB;function uB(n,e,t,i,r){if(!n||!(t in n.wantedTiles)||!n.wantedTiles[t][e.getKey()])return Yu;const s=n.viewState.center,o=i[0]-s[0],a=i[1]-s[1];return 65536*Math.log(r)+Math.sqrt(o*o+a*a)/r}class dB extends qs{constructor(e){super();const t=e.element;t&&!e.target&&!t.style.pointerEvents&&(t.style.pointerEvents="auto"),this.element=t||null,this.target_=null,this.map_=null,this.listenerKeys=[],e.render&&(this.render=e.render),e.target&&this.setTarget(e.target)}disposeInternal(){Ku(this.element),super.disposeInternal()}getMap(){return this.map_}setMap(e){this.map_&&Ku(this.element);for(let t=0,i=this.listenerKeys.length;t<i;++t)xi(this.listenerKeys[t]);this.listenerKeys.length=0,this.map_=e,e&&((this.target_?this.target_:e.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==Ih&&this.listenerKeys.push(Kt(e,on.POSTRENDER,this.render,this)),e.render())}render(e){}setTarget(e){this.target_=typeof e=="string"?document.getElementById(e):e}}const yf=dB;class fB extends yf{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=e.collapsed!==void 0?e.collapsed:!0,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=e.collapsible!==void 0,this.collapsible_=e.collapsible!==void 0?e.collapsible:!0,this.collapsible_||(this.collapsed_=!1);const t=e.className!==void 0?e.className:"ol-attribution",i=e.tipLabel!==void 0?e.tipLabel:"Attributions",r=e.expandClassName!==void 0?e.expandClassName:t+"-expand",s=e.collapseLabel!==void 0?e.collapseLabel:"›",o=e.collapseClassName!==void 0?e.collapseClassName:t+"-collapse";typeof s=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=s,this.collapseLabel_.className=o):this.collapseLabel_=s;const a=e.label!==void 0?e.label:"i";typeof a=="string"?(this.label_=document.createElement("span"),this.label_.textContent=a,this.label_.className=r):this.label_=a;const l=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=i,this.toggleButton_.appendChild(l),this.toggleButton_.addEventListener(Rt.CLICK,this.handleClick_.bind(this),!1);const h=t+" "+pc+" "+Cf+(this.collapsed_&&this.collapsible_?" "+a_:"")+(this.collapsible_?"":" ol-uncollapsible"),c=this.element;c.className=h,c.appendChild(this.toggleButton_),c.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(e){const t=Array.from(new Set(this.getMap().getAllLayers().flatMap(r=>r.getAttributions(e)))),i=!this.getMap().getAllLayers().some(r=>r.getSource()&&r.getSource().getAttributionsCollapsible()===!1);return this.overrideCollapsible_||this.setCollapsible(i),t}updateElement_(e){if(!e){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const t=this.collectSourceAttributions_(e),i=t.length>0;if(this.renderedVisible_!=i&&(this.element.style.display=i?"":"none",this.renderedVisible_=i),!ac(t,this.renderedAttributions_)){JV(this.ulElement_);for(let r=0,s=t.length;r<s;++r){const o=document.createElement("li");o.innerHTML=t[r],this.ulElement_.appendChild(o)}this.renderedAttributions_=t}}handleClick_(e){e.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(a_),this.collapsed_?l_(this.collapseLabel_,this.label_):l_(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(e){this.userCollapsed_=e,!(!this.collapsible_||this.collapsed_===e)&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(e){this.updateElement_(e.frameState)}}const pB=fB;class gB extends yf{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target});const t=e.className!==void 0?e.className:"ol-rotate",i=e.label!==void 0?e.label:"⇧",r=e.compassClassName!==void 0?e.compassClassName:"ol-compass";this.label_=null,typeof i=="string"?(this.label_=document.createElement("span"),this.label_.className=r,this.label_.textContent=i):(this.label_=i,this.label_.classList.add(r));const s=e.tipLabel?e.tipLabel:"Reset rotation",o=document.createElement("button");o.className=t+"-reset",o.setAttribute("type","button"),o.title=s,o.appendChild(this.label_),o.addEventListener(Rt.CLICK,this.handleClick_.bind(this),!1);const a=t+" "+pc+" "+Cf,l=this.element;l.className=a,l.appendChild(o),this.callResetNorth_=e.resetNorth?e.resetNorth:void 0,this.duration_=e.duration!==void 0?e.duration:250,this.autoHide_=e.autoHide!==void 0?e.autoHide:!0,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(Nl)}handleClick_(e){e.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const e=this.getMap().getView();if(!e)return;const t=e.getRotation();t!==void 0&&(this.duration_>0&&t%(2*Math.PI)!==0?e.animate({rotation:0,duration:this.duration_,easing:Jo}):e.setRotation(0))}render(e){const t=e.frameState;if(!t)return;const i=t.viewState.rotation;if(i!=this.rotation_){const r="rotate("+i+"rad)";if(this.autoHide_){const s=this.element.classList.contains(Nl);!s&&i===0?this.element.classList.add(Nl):s&&i!==0&&this.element.classList.remove(Nl)}this.label_.style.transform=r}this.rotation_=i}}const mB=gB;class _B extends yf{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target});const t=e.className!==void 0?e.className:"ol-zoom",i=e.delta!==void 0?e.delta:1,r=e.zoomInClassName!==void 0?e.zoomInClassName:t+"-in",s=e.zoomOutClassName!==void 0?e.zoomOutClassName:t+"-out",o=e.zoomInLabel!==void 0?e.zoomInLabel:"+",a=e.zoomOutLabel!==void 0?e.zoomOutLabel:"–",l=e.zoomInTipLabel!==void 0?e.zoomInTipLabel:"Zoom in",h=e.zoomOutTipLabel!==void 0?e.zoomOutTipLabel:"Zoom out",c=document.createElement("button");c.className=r,c.setAttribute("type","button"),c.title=l,c.appendChild(typeof o=="string"?document.createTextNode(o):o),c.addEventListener(Rt.CLICK,this.handleClick_.bind(this,i),!1);const u=document.createElement("button");u.className=s,u.setAttribute("type","button"),u.title=h,u.appendChild(typeof a=="string"?document.createTextNode(a):a),u.addEventListener(Rt.CLICK,this.handleClick_.bind(this,-i),!1);const d=t+" "+pc+" "+Cf,f=this.element;f.className=d,f.appendChild(c),f.appendChild(u),this.duration_=e.duration!==void 0?e.duration:250}handleClick_(e,t){t.preventDefault(),this.zoomByDelta_(e)}zoomByDelta_(e){const t=this.getMap().getView();if(!t)return;const i=t.getZoom();if(i!==void 0){const r=t.getConstrainedZoom(i+e);this.duration_>0?(t.getAnimating()&&t.cancelAnimations(),t.animate({zoom:r,duration:this.duration_,easing:Jo})):t.setZoom(r)}}}const vB=_B;function EB(n){n=n||{};const e=new Gs;return(n.zoom===void 0||n.zoom)&&e.push(new vB(n.zoomOptions)),(n.rotate===void 0||n.rotate)&&e.push(new mB(n.rotateOptions)),(n.attribution===void 0||n.attribution)&&e.push(new pB(n.attributionOptions)),e}const h_={ACTIVE:"active"};class TB extends qs{constructor(e){super(),this.on,this.once,this.un,e&&e.handleEvent&&(this.handleEvent=e.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(h_.ACTIVE)}getMap(){return this.map_}handleEvent(e){return!0}setActive(e){this.set(h_.ACTIVE,e)}setMap(e){this.map_=e}}function xB(n,e,t){const i=n.getCenterInternal();if(i){const r=[i[0]+e[0],i[1]+e[1]];n.animateInternal({duration:t!==void 0?t:250,easing:_V,center:n.getConstrainedCenter(r)})}}function bf(n,e,t,i){const r=n.getZoom();if(r===void 0)return;const s=n.getConstrainedZoom(r+e),o=n.getResolutionForZoom(s);n.getAnimating()&&n.cancelAnimations(),n.animate({resolution:o,anchor:t,duration:i!==void 0?i:250,easing:Jo})}const ol=TB;class CB extends ol{constructor(e){super(),e=e||{},this.delta_=e.delta?e.delta:1,this.duration_=e.duration!==void 0?e.duration:250}handleEvent(e){let t=!1;if(e.type==pi.DBLCLICK){const i=e.originalEvent,r=e.map,s=e.coordinate,o=i.shiftKey?-this.delta_:this.delta_,a=r.getView();bf(a,o,s,this.duration_),i.preventDefault(),t=!0}return!t}}const RB=CB;class SB extends ol{constructor(e){e=e||{},super(e),e.handleDownEvent&&(this.handleDownEvent=e.handleDownEvent),e.handleDragEvent&&(this.handleDragEvent=e.handleDragEvent),e.handleMoveEvent&&(this.handleMoveEvent=e.handleMoveEvent),e.handleUpEvent&&(this.handleUpEvent=e.handleUpEvent),e.stopDown&&(this.stopDown=e.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(e){return!1}handleDragEvent(e){}handleEvent(e){if(!e.originalEvent)return!0;let t=!1;if(this.updateTrackedPointers_(e),this.handlingDownUpSequence){if(e.type==pi.POINTERDRAG)this.handleDragEvent(e),e.originalEvent.preventDefault();else if(e.type==pi.POINTERUP){const i=this.handleUpEvent(e);this.handlingDownUpSequence=i&&this.targetPointers.length>0}}else if(e.type==pi.POINTERDOWN){const i=this.handleDownEvent(e);this.handlingDownUpSequence=i,t=this.stopDown(i)}else e.type==pi.POINTERMOVE&&this.handleMoveEvent(e);return!t}handleMoveEvent(e){}handleUpEvent(e){return!1}stopDown(e){return e}updateTrackedPointers_(e){e.activePointers&&(this.targetPointers=e.activePointers)}}function If(n){const e=n.length;let t=0,i=0;for(let r=0;r<e;r++)t+=n[r].clientX,i+=n[r].clientY;return{clientX:t/e,clientY:i/e}}const al=SB;function Zu(n){const e=arguments;return function(t){let i=!0;for(let r=0,s=e.length;r<s&&(i=i&&e[r](t),!!i);++r);return i}}const yB=function(n){const e=n.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},bB=function(n){const e=n.map.getTargetElement(),t=n.map.getOwnerDocument().activeElement;return e.contains(t)},TE=function(n){return n.map.getTargetElement().hasAttribute("tabindex")?bB(n):!0},IB=bh,xE=function(n){const e=n.originalEvent;return e.button==0&&!(f3&&qv&&e.ctrlKey)},CE=function(n){const e=n.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},AB=function(n){const e=n.originalEvent;return qv?e.metaKey:e.ctrlKey},MB=function(n){const e=n.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},RE=function(n){const e=n.originalEvent,t=e.target.tagName;return t!=="INPUT"&&t!=="SELECT"&&t!=="TEXTAREA"&&!e.target.isContentEditable},gu=function(n){const e=n.originalEvent;return qt(e!==void 0,56),e.pointerType=="mouse"},PB=function(n){const e=n.originalEvent;return qt(e!==void 0,56),e.isPrimary&&e.button===0};class OB extends al{constructor(e){super({stopDown:lc}),e=e||{},this.kinetic_=e.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;const t=e.condition?e.condition:Zu(CE,PB);this.condition_=e.onFocusOnly?Zu(TE,t):t,this.noKinetic_=!1}handleDragEvent(e){const t=e.map;this.panning_||(this.panning_=!0,t.getView().beginInteraction());const i=this.targetPointers,r=t.getEventPixel(If(i));if(i.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(r[0],r[1]),this.lastCentroid){const s=[this.lastCentroid[0]-r[0],r[1]-this.lastCentroid[1]],o=e.map.getView();J3(s,o.getResolution()),cf(s,o.getRotation()),o.adjustCenterInternal(s)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=r,this.lastPointersCount_=i.length,e.originalEvent.preventDefault()}handleUpEvent(e){const t=e.map,i=t.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const r=this.kinetic_.getDistance(),s=this.kinetic_.getAngle(),o=i.getCenterInternal(),a=t.getPixelFromCoordinateInternal(o),l=t.getCoordinateFromPixelInternal([a[0]-r*Math.cos(s),a[1]-r*Math.sin(s)]);i.animateInternal({center:i.getConstrainedCenter(l),duration:500,easing:Jo})}return this.panning_&&(this.panning_=!1,i.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(e){if(this.targetPointers.length>0&&this.condition_(e)){const t=e.map.getView();return this.lastCentroid=null,t.getAnimating()&&t.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}}const DB=OB;class NB extends al{constructor(e){e=e||{},super({stopDown:lc}),this.condition_=e.condition?e.condition:yB,this.lastAngle_=void 0,this.duration_=e.duration!==void 0?e.duration:250}handleDragEvent(e){if(!gu(e))return;const t=e.map,i=t.getView();if(i.getConstraints().rotation===_f)return;const r=t.getSize(),s=e.pixel,o=Math.atan2(r[1]/2-s[1],s[0]-r[0]/2);if(this.lastAngle_!==void 0){const a=o-this.lastAngle_;i.adjustRotationInternal(-a)}this.lastAngle_=o}handleUpEvent(e){return gu(e)?(e.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(e){return gu(e)&&xE(e)&&this.condition_(e)?(e.map.getView().beginInteraction(),this.lastAngle_=void 0,!0):!1}}const FB=NB;class LB extends sf{constructor(e){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+e,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const e=this.startPixel_,t=this.endPixel_,i="px",r=this.element_.style;r.left=Math.min(e[0],t[0])+i,r.top=Math.min(e[1],t[1])+i,r.width=Math.abs(t[0]-e[0])+i,r.height=Math.abs(t[1]-e[1])+i}setMap(e){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const t=this.element_.style;t.left="inherit",t.top="inherit",t.width="inherit",t.height="inherit"}this.map_=e,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(e,t){this.startPixel_=e,this.endPixel_=t,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){const e=this.startPixel_,t=this.endPixel_,i=[e,[e[0],t[1]],t,[t[0],e[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);i[4]=i[0].slice(),this.geometry_?this.geometry_.setCoordinates([i]):this.geometry_=new za([i])}getGeometry(){return this.geometry_}}const wB=LB,Fl={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend",BOXCANCEL:"boxcancel"};class mu extends Tn{constructor(e,t,i){super(e),this.coordinate=t,this.mapBrowserEvent=i}}class UB extends al{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.box_=new wB(e.className||"ol-dragbox"),this.minArea_=e.minArea!==void 0?e.minArea:64,e.onBoxEnd&&(this.onBoxEnd=e.onBoxEnd),this.startPixel_=null,this.condition_=e.condition?e.condition:xE,this.boxEndCondition_=e.boxEndCondition?e.boxEndCondition:this.defaultBoxEndCondition}defaultBoxEndCondition(e,t,i){const r=i[0]-t[0],s=i[1]-t[1];return r*r+s*s>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(e){this.box_.setPixels(this.startPixel_,e.pixel),this.dispatchEvent(new mu(Fl.BOXDRAG,e.coordinate,e))}handleUpEvent(e){this.box_.setMap(null);const t=this.boxEndCondition_(e,this.startPixel_,e.pixel);return t&&this.onBoxEnd(e),this.dispatchEvent(new mu(t?Fl.BOXEND:Fl.BOXCANCEL,e.coordinate,e)),!1}handleDownEvent(e){return this.condition_(e)?(this.startPixel_=e.pixel,this.box_.setMap(e.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new mu(Fl.BOXSTART,e.coordinate,e)),!0):!1}onBoxEnd(e){}}const VB=UB;class BB extends VB{constructor(e){e=e||{};const t=e.condition?e.condition:MB;super({condition:t,className:e.className||"ol-dragzoom",minArea:e.minArea}),this.duration_=e.duration!==void 0?e.duration:200,this.out_=e.out!==void 0?e.out:!1}onBoxEnd(e){const t=this.getMap().getView();let i=this.getGeometry();if(this.out_){const r=t.rotatedExtentForGeometry(i),s=t.getResolutionForExtentInternal(r),o=t.getResolution()/s;i=i.clone(),i.scale(o*o)}t.fitInternal(i,{duration:this.duration_,easing:Jo})}}const kB=BB,bn={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",DOWN:"ArrowDown"};class zB extends ol{constructor(e){super(),e=e||{},this.defaultCondition_=function(t){return CE(t)&&RE(t)},this.condition_=e.condition!==void 0?e.condition:this.defaultCondition_,this.duration_=e.duration!==void 0?e.duration:100,this.pixelDelta_=e.pixelDelta!==void 0?e.pixelDelta:128}handleEvent(e){let t=!1;if(e.type==Rt.KEYDOWN){const i=e.originalEvent,r=i.key;if(this.condition_(e)&&(r==bn.DOWN||r==bn.LEFT||r==bn.RIGHT||r==bn.UP)){const s=e.map.getView(),o=s.getResolution()*this.pixelDelta_;let a=0,l=0;r==bn.DOWN?l=-o:r==bn.LEFT?a=-o:r==bn.RIGHT?a=o:l=o;const h=[a,l];cf(h,s.getRotation()),xB(s,h,this.duration_),i.preventDefault(),t=!0}}return!t}}const GB=zB;class WB extends ol{constructor(e){super(),e=e||{},this.condition_=e.condition?e.condition:function(t){return!AB(t)&&RE(t)},this.delta_=e.delta?e.delta:1,this.duration_=e.duration!==void 0?e.duration:100}handleEvent(e){let t=!1;if(e.type==Rt.KEYDOWN||e.type==Rt.KEYPRESS){const i=e.originalEvent,r=i.key;if(this.condition_(e)&&(r==="+"||r==="-")){const s=e.map,o=r==="+"?this.delta_:-this.delta_,a=s.getView();bf(a,o,void 0,this.duration_),i.preventDefault(),t=!0}}return!t}}const XB=WB;class HB{constructor(e,t,i){this.decay_=e,this.minVelocity_=t,this.delay_=i,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(e,t){this.points_.push(e,t,Date.now())}end(){if(this.points_.length<6)return!1;const e=Date.now()-this.delay_,t=this.points_.length-3;if(this.points_[t+2]<e)return!1;let i=t-3;for(;i>0&&this.points_[i+2]>e;)i-=3;const r=this.points_[t+2]-this.points_[i+2];if(r<1e3/60)return!1;const s=this.points_[t]-this.points_[i],o=this.points_[t+1]-this.points_[i+1];return this.angle_=Math.atan2(o,s),this.initialVelocity_=Math.sqrt(s*s+o*o)/r,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}}const KB=HB;class qB extends ol{constructor(e){e=e||{},super(e),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=e.maxDelta!==void 0?e.maxDelta:1,this.duration_=e.duration!==void 0?e.duration:250,this.timeout_=e.timeout!==void 0?e.timeout:80,this.useAnchor_=e.useAnchor!==void 0?e.useAnchor:!0,this.constrainResolution_=e.constrainResolution!==void 0?e.constrainResolution:!1;const t=e.condition?e.condition:IB;this.condition_=e.onFocusOnly?Zu(TE,t):t,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const e=this.getMap();e&&e.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_)}handleEvent(e){if(!this.condition_(e)||e.type!==Rt.WHEEL)return!0;const t=e.map,i=e.originalEvent;i.preventDefault(),this.useAnchor_&&(this.lastAnchor_=e.coordinate);let r;if(e.type==Rt.WHEEL&&(r=i.deltaY,u3&&i.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(r/=Yv),i.deltaMode===WheelEvent.DOM_DELTA_LINE&&(r*=40)),r===0)return!1;this.lastDelta_=r;const s=Date.now();this.startTime_===void 0&&(this.startTime_=s),(!this.mode_||s-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(r)<4?"trackpad":"wheel");const o=t.getView();if(this.mode_==="trackpad"&&!(o.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(o.getAnimating()&&o.cancelAnimations(),o.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),o.adjustZoom(-r/this.deltaPerZoom_,this.lastAnchor_),this.startTime_=s,!1;this.totalDelta_+=r;const a=Math.max(this.timeout_-(s-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,t),a),!1}handleWheelZoom_(e){const t=e.getView();t.getAnimating()&&t.cancelAnimations();let i=-zi(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(t.getConstrainResolution()||this.constrainResolution_)&&(i=i?i>0?1:-1:0),bf(t,i,this.lastAnchor_,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(e){this.useAnchor_=e,e||(this.lastAnchor_=null)}}const YB=qB;class ZB extends al{constructor(e){e=e||{};const t=e;t.stopDown||(t.stopDown=lc),super(t),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=e.threshold!==void 0?e.threshold:.3,this.duration_=e.duration!==void 0?e.duration:250}handleDragEvent(e){let t=0;const i=this.targetPointers[0],r=this.targetPointers[1],s=Math.atan2(r.clientY-i.clientY,r.clientX-i.clientX);if(this.lastAngle_!==void 0){const l=s-this.lastAngle_;this.rotationDelta_+=l,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),t=l}this.lastAngle_=s;const o=e.map,a=o.getView();a.getConstraints().rotation!==_f&&(this.anchor_=o.getCoordinateFromPixelInternal(o.getEventPixel(If(this.targetPointers))),this.rotating_&&(o.render(),a.adjustRotationInternal(t,this.anchor_)))}handleUpEvent(e){return this.targetPointers.length<2?(e.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(e){if(this.targetPointers.length>=2){const t=e.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}}const jB=ZB;class QB extends al{constructor(e){e=e||{};const t=e;t.stopDown||(t.stopDown=lc),super(t),this.anchor_=null,this.duration_=e.duration!==void 0?e.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(e){let t=1;const i=this.targetPointers[0],r=this.targetPointers[1],s=i.clientX-r.clientX,o=i.clientY-r.clientY,a=Math.sqrt(s*s+o*o);this.lastDistance_!==void 0&&(t=this.lastDistance_/a),this.lastDistance_=a;const l=e.map,h=l.getView();t!=1&&(this.lastScaleDelta_=t),this.anchor_=l.getCoordinateFromPixelInternal(l.getEventPixel(If(this.targetPointers))),l.render(),h.adjustResolutionInternal(t,this.anchor_)}handleUpEvent(e){if(this.targetPointers.length<2){const t=e.map.getView(),i=this.lastScaleDelta_>1?1:-1;return t.endInteraction(this.duration_,i),!1}return!0}handleDownEvent(e){if(this.targetPointers.length>=2){const t=e.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}}const JB=QB;function $B(n){n=n||{};const e=new Gs,t=new KB(-.005,.05,100);return(n.altShiftDragRotate===void 0||n.altShiftDragRotate)&&e.push(new FB),(n.doubleClickZoom===void 0||n.doubleClickZoom)&&e.push(new RB({delta:n.zoomDelta,duration:n.zoomDuration})),(n.dragPan===void 0||n.dragPan)&&e.push(new DB({onFocusOnly:n.onFocusOnly,kinetic:t})),(n.pinchRotate===void 0||n.pinchRotate)&&e.push(new jB),(n.pinchZoom===void 0||n.pinchZoom)&&e.push(new JB({duration:n.zoomDuration})),(n.keyboard===void 0||n.keyboard)&&(e.push(new GB),e.push(new XB({delta:n.zoomDelta,duration:n.zoomDuration}))),(n.mouseWheelZoom===void 0||n.mouseWheelZoom)&&e.push(new YB({onFocusOnly:n.onFocusOnly,duration:n.zoomDuration})),(n.shiftDragZoom===void 0||n.shiftDragZoom)&&e.push(new kB({duration:n.zoomDuration})),e}function c_(n){return n[0]>0&&n[1]>0}function ek(n,e,t){return t===void 0&&(t=[0,0]),t[0]=n[0]*e+.5|0,t[1]=n[1]*e+.5|0,t}function cn(n,e){return Array.isArray(n)?n:(e===void 0?e=[n,n]:(e[0]=n,e[1]=n),e)}function SE(n){if(n instanceof xf){n.setMapInternal(null);return}n instanceof gc&&n.getLayers().forEach(SE)}function yE(n,e){if(n instanceof xf){n.setMapInternal(e);return}if(n instanceof gc){const t=n.getLayers().getArray();for(let i=0,r=t.length;i<r;++i)yE(t[i],e)}}let tk=class extends qs{constructor(n){super(),n=n||{},this.on,this.once,this.un;const e=ik(n);this.renderComplete_,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=n.maxTilesLoading!==void 0?n.maxTilesLoading:16,this.pixelRatio_=n.pixelRatio!==void 0?n.pixelRatio:Yv,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=Ao(),this.pixelToCoordinateTransform_=Ao(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=n.moveTolerance,this.keyboardEventTarget_=e.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,this.resizeObserver_=new ResizeObserver(()=>this.updateSize()),this.controls=e.controls||EB(),this.interactions=e.interactions||$B({onFocusOnly:!0}),this.overlays_=e.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new cB(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(Qi.LAYERGROUP,this.handleLayerGroupChanged_),this.addChangeListener(Qi.VIEW,this.handleViewChanged_),this.addChangeListener(Qi.SIZE,this.handleSizeChanged_),this.addChangeListener(Qi.TARGET,this.handleTargetChanged_),this.setProperties(e.values);const t=this;n.view&&!(n.view instanceof $r)&&n.view.then(function(i){t.setView(new $r(i))}),this.controls.addEventListener(Lr.ADD,i=>{i.element.setMap(this)}),this.controls.addEventListener(Lr.REMOVE,i=>{i.element.setMap(null)}),this.interactions.addEventListener(Lr.ADD,i=>{i.element.setMap(this)}),this.interactions.addEventListener(Lr.REMOVE,i=>{i.element.setMap(null)}),this.overlays_.addEventListener(Lr.ADD,i=>{this.addOverlayInternal_(i.element)}),this.overlays_.addEventListener(Lr.REMOVE,i=>{const r=i.element.getId();r!==void 0&&delete this.overlayIdIndex_[r.toString()],i.element.setMap(null)}),this.controls.forEach(i=>{i.setMap(this)}),this.interactions.forEach(i=>{i.setMap(this)}),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(n){this.getControls().push(n)}addInteraction(n){this.getInteractions().push(n)}addLayer(n){this.getLayerGroup().getLayers().push(n)}handleLayerAdd_(n){yE(n.layer,this)}addOverlay(n){this.getOverlays().push(n)}addOverlayInternal_(n){const e=n.getId();e!==void 0&&(this.overlayIdIndex_[e.toString()]=n),n.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(n,e,t){if(!this.frameState_||!this.renderer_)return;const i=this.getCoordinateFromPixelInternal(n);t=t!==void 0?t:{};const r=t.hitTolerance!==void 0?t.hitTolerance:0,s=t.layerFilter!==void 0?t.layerFilter:bh,o=t.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(i,this.frameState_,r,o,e,null,s,null)}getFeaturesAtPixel(n,e){const t=[];return this.forEachFeatureAtPixel(n,function(i){t.push(i)},e),t}getAllLayers(){const n=[];function e(t){t.forEach(function(i){i instanceof gc?e(i.getLayers()):n.push(i)})}return e(this.getLayers()),n}hasFeatureAtPixel(n,e){if(!this.frameState_||!this.renderer_)return!1;const t=this.getCoordinateFromPixelInternal(n);e=e!==void 0?e:{};const i=e.layerFilter!==void 0?e.layerFilter:bh,r=e.hitTolerance!==void 0?e.hitTolerance:0,s=e.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(t,this.frameState_,r,s,i,null)}getEventCoordinate(n){return this.getCoordinateFromPixel(this.getEventPixel(n))}getEventCoordinateInternal(n){return this.getCoordinateFromPixelInternal(this.getEventPixel(n))}getEventPixel(n){const e=this.viewport_.getBoundingClientRect(),t=this.getSize(),i=e.width/t[0],r=e.height/t[1],s="changedTouches"in n?n.changedTouches[0]:n;return[(s.clientX-e.left)/i,(s.clientY-e.top)/r]}getTarget(){return this.get(Qi.TARGET)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(n){return Hu(this.getCoordinateFromPixelInternal(n),this.getView().getProjection())}getCoordinateFromPixelInternal(n){const e=this.frameState_;return e?Pr(e.pixelToCoordinateTransform,n.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(n){const e=this.overlayIdIndex_[n.toString()];return e!==void 0?e:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(Qi.LAYERGROUP)}setLayers(n){const e=this.getLayerGroup();if(n instanceof Gs){e.setLayers(n);return}const t=e.getLayers();t.clear(),t.extend(n)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const n=this.getLayerGroup().getLayerStatesArray();for(let e=0,t=n.length;e<t;++e){const i=n[e];if(!i.visible)continue;const r=i.layer.getRenderer();if(r&&!r.ready)return!0;const s=i.layer.getSource();if(s&&s.loading)return!0}return!1}getPixelFromCoordinate(n){const e=Fs(n,this.getView().getProjection());return this.getPixelFromCoordinateInternal(e)}getPixelFromCoordinateInternal(n){const e=this.frameState_;return e?Pr(e.coordinateToPixelTransform,n.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(Qi.SIZE)}getView(){return this.get(Qi.VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const n=this.getTargetElement();return n?n.ownerDocument:document}getTilePriority(n,e,t,i){return uB(this.frameState_,n,e,t,i)}handleBrowserEvent(n,e){e=e||n.type;const t=new nn(e,this,n);this.handleMapBrowserEvent(t)}handleMapBrowserEvent(n){if(!this.frameState_)return;const e=n.originalEvent,t=e.type;if(t===qu.POINTERDOWN||t===Rt.WHEEL||t===Rt.KEYDOWN){const i=this.getOwnerDocument(),r=this.viewport_.getRootNode?this.viewport_.getRootNode():i,s=e.target;if(this.overlayContainerStopEvent_.contains(s)||!(r===i?i.documentElement:r).contains(s))return}if(n.frameState=this.frameState_,this.dispatchEvent(n)!==!1){const i=this.getInteractions().getArray().slice();for(let r=i.length-1;r>=0;r--){const s=i[r];if(!(s.getMap()!==this||!s.getActive()||!this.getTargetElement())&&(!s.handleEvent(n)||n.propagationStopped))break}}}handlePostRender(){const n=this.frameState_,e=this.tileQueue_;if(!e.isEmpty()){let i=this.maxTilesLoading_,r=i;if(n){const s=n.viewHints;if(s[Or.ANIMATING]||s[Or.INTERACTING]){const o=Date.now()-n.time>8;i=o?0:8,r=o?0:2}}e.getTilesLoading()<i&&(e.reprioritize(),e.loadMoreTiles(i,r))}n&&this.renderer_&&!n.animate&&(this.renderComplete_===!0?(this.hasListener(un.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(un.RENDERCOMPLETE,n),this.loaded_===!1&&(this.loaded_=!0,this.dispatchEvent(new po(on.LOADEND,this,n)))):this.loaded_===!0&&(this.loaded_=!1,this.dispatchEvent(new po(on.LOADSTART,this,n))));const t=this.postRenderFunctions_;for(let i=0,r=t.length;i<r;++i)t[i](this,n);t.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let t=0,i=this.targetChangeHandlerKeys_.length;t<i;++t)xi(this.targetChangeHandlerKeys_[t]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(Rt.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(Rt.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,Ku(this.viewport_)}if(this.targetElement_){this.resizeObserver_.unobserve(this.targetElement_);const t=this.targetElement_.getRootNode();t instanceof ShadowRoot&&this.resizeObserver_.unobserve(t.host),this.setSize(void 0)}const n=this.getTarget(),e=typeof n=="string"?document.getElementById(n):n;if(this.targetElement_=e,!e)this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);else{e.appendChild(this.viewport_),this.renderer_||(this.renderer_=new iB(this)),this.mapBrowserEventHandler_=new oB(this,this.moveTolerance_);for(const r in pi)this.mapBrowserEventHandler_.addEventListener(pi[r],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(Rt.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(Rt.WHEEL,this.boundHandleBrowserEvent_,jv?{passive:!1}:!1);const t=this.keyboardEventTarget_?this.keyboardEventTarget_:e;this.targetChangeHandlerKeys_=[Kt(t,Rt.KEYDOWN,this.handleBrowserEvent,this),Kt(t,Rt.KEYPRESS,this.handleBrowserEvent,this)];const i=e.getRootNode();i instanceof ShadowRoot&&this.resizeObserver_.observe(i.host),this.resizeObserver_.observe(e)}this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(xi(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(xi(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const n=this.getView();n&&(this.updateViewportSize_(),this.viewPropertyListenerKey_=Kt(n,wa.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=Kt(n,Rt.CHANGE,this.handleViewPropertyChanged_,this),n.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(xi),this.layerGroupPropertyListenerKeys_=null);const n=this.getLayerGroup();n&&(this.handleLayerAdd_(new ln("addlayer",n)),this.layerGroupPropertyListenerKeys_=[Kt(n,wa.PROPERTYCHANGE,this.render,this),Kt(n,Rt.CHANGE,this.render,this),Kt(n,"addlayer",this.handleLayerAdd_,this),Kt(n,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){const n=this.getLayerGroup().getLayerStatesArray();for(let e=0,t=n.length;e<t;++e){const i=n[e].layer;i.hasRenderer()&&i.getRenderer().handleFontsChanged()}}render(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}flushDeclutterItems(){const n=this.frameState_;n&&this.renderer_.flushDeclutterItems(n)}removeControl(n){return this.getControls().remove(n)}removeInteraction(n){return this.getInteractions().remove(n)}removeLayer(n){return this.getLayerGroup().getLayers().remove(n)}handleLayerRemove_(n){SE(n.layer)}removeOverlay(n){return this.getOverlays().remove(n)}renderFrame_(n){const e=this.getSize(),t=this.getView(),i=this.frameState_;let r=null;if(e!==void 0&&c_(e)&&t&&t.isDef()){const s=t.getHints(this.frameState_?this.frameState_.viewHints:void 0),o=t.getState();if(r={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutterTree:null,extent:zu(o.center,o.resolution,o.rotation,e),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:e,tileQueue:this.tileQueue_,time:n,usedTiles:{},viewState:o,viewHints:s,wantedTiles:{},mapId:gr(this),renderTargets:{}},o.nextCenter&&o.nextResolution){const a=isNaN(o.nextRotation)?o.rotation:o.nextRotation;r.nextExtent=zu(o.nextCenter,o.nextResolution,a,e)}}this.frameState_=r,this.renderer_.renderFrame(r),r&&(r.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,r.postRenderFunctions),i&&(!this.previousExtent_||!sl(this.previousExtent_)&&!Bu(r.extent,this.previousExtent_))&&(this.dispatchEvent(new po(on.MOVESTART,this,i)),this.previousExtent_=il(this.previousExtent_)),this.previousExtent_&&!r.viewHints[Or.ANIMATING]&&!r.viewHints[Or.INTERACTING]&&!Bu(r.extent,this.previousExtent_)&&(this.dispatchEvent(new po(on.MOVEEND,this,r)),v3(r.extent,this.previousExtent_))),this.dispatchEvent(new po(on.POSTRENDER,this,r)),this.renderComplete_=this.hasListener(on.LOADSTART)||this.hasListener(on.LOADEND)||this.hasListener(un.RENDERCOMPLETE)?!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady():void 0,this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(n){const e=this.getLayerGroup();e&&this.handleLayerRemove_(new ln("removelayer",e)),this.set(Qi.LAYERGROUP,n)}setSize(n){this.set(Qi.SIZE,n)}setTarget(n){this.set(Qi.TARGET,n)}setView(n){if(!n||n instanceof $r){this.set(Qi.VIEW,n);return}this.set(Qi.VIEW,new $r);const e=this;n.then(function(t){e.setView(new $r(t))})}updateSize(){const n=this.getTargetElement();let e;if(n){const i=getComputedStyle(n),r=n.offsetWidth-parseFloat(i.borderLeftWidth)-parseFloat(i.paddingLeft)-parseFloat(i.paddingRight)-parseFloat(i.borderRightWidth),s=n.offsetHeight-parseFloat(i.borderTopWidth)-parseFloat(i.paddingTop)-parseFloat(i.paddingBottom)-parseFloat(i.borderBottomWidth);!isNaN(r)&&!isNaN(s)&&(e=[r,s],!c_(e)&&(n.offsetWidth||n.offsetHeight||n.getClientRects().length)&&oE("No map visible because the map container's width or height are 0."))}const t=this.getSize();e&&(!t||!ac(e,t))&&(this.setSize(e),this.updateViewportSize_())}updateViewportSize_(){const n=this.getView();if(n){let e;const t=getComputedStyle(this.viewport_);t.width&&t.height&&(e=[parseInt(t.width,10),parseInt(t.height,10)]),n.setViewportSize(e)}}};function ik(n){let e=null;n.keyboardEventTarget!==void 0&&(e=typeof n.keyboardEventTarget=="string"?document.getElementById(n.keyboardEventTarget):n.keyboardEventTarget);const t={},i=n.layers&&typeof n.layers.getLayers=="function"?n.layers:new gc({layers:n.layers});t[Qi.LAYERGROUP]=i,t[Qi.TARGET]=n.target,t[Qi.VIEW]=n.view instanceof $r?n.view:new $r;let r;n.controls!==void 0&&(Array.isArray(n.controls)?r=new Gs(n.controls.slice()):(qt(typeof n.controls.getArray=="function",47),r=n.controls));let s;n.interactions!==void 0&&(Array.isArray(n.interactions)?s=new Gs(n.interactions.slice()):(qt(typeof n.interactions.getArray=="function",48),s=n.interactions));let o;return n.overlays!==void 0?Array.isArray(n.overlays)?o=new Gs(n.overlays.slice()):(qt(typeof n.overlays.getArray=="function",49),o=n.overlays):o=new Gs,{controls:r,interactions:s,keyboardEventTarget:e,overlays:o,values:t}}const bE=tk,Ll={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};class rk extends xf{constructor(e){e=e||{};const t=Object.assign({},e);delete t.preload,delete t.useInterimTilesOnError,super(t),this.on,this.once,this.un,this.setPreload(e.preload!==void 0?e.preload:0),this.setUseInterimTilesOnError(e.useInterimTilesOnError!==void 0?e.useInterimTilesOnError:!0)}getPreload(){return this.get(Ll.PRELOAD)}setPreload(e){this.set(Ll.PRELOAD,e)}getUseInterimTilesOnError(){return this.get(Ll.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(e){this.set(Ll.USE_INTERIM_TILES_ON_ERROR,e)}getData(e){return super.getData(e)}}const sk=rk,lo={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};class nk extends Hv{constructor(e){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=e,this.declutterExecutorGroup=null}getFeatures(e){return mi()}getData(e){return null}prepareFrame(e){return mi()}renderFrame(e,t){return mi()}loadedTileCallback(e,t,i){e[t]||(e[t]={}),e[t][i.tileCoord.toString()]=i}createLoadedTileFinder(e,t,i){return(r,s)=>{const o=this.loadedTileCallback.bind(this,i,r);return e.forEachLoadedTile(t,r,s,o)}}forEachFeatureAtCoordinate(e,t,i,r,s){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(e){const t=e.target;(t.getState()===lo.LOADED||t.getState()===lo.ERROR)&&this.renderIfReadyAndVisible()}loadImage(e){let t=e.getState();return t!=lo.LOADED&&t!=lo.ERROR&&e.addEventListener(Rt.CHANGE,this.boundHandleImageChange_),t==lo.IDLE&&(e.load(),t=e.getState()),t==lo.LOADED}renderIfReadyAndVisible(){const e=this.getLayer();e&&e.getVisible()&&e.getSourceState()==="ready"&&e.changed()}disposeInternal(){delete this.layer_,super.disposeInternal()}}const ok=nk;let go=null;function ak(){go=ko(1,1,void 0,{willReadFrequently:!0})}class lk extends ok{constructor(e){super(e),this.container=null,this.renderedResolution,this.tempTransform=Ao(),this.pixelTransform=Ao(),this.inversePixelTransform=Ao(),this.context=null,this.containerReused=!1,this.pixelContext_=null,this.frameState=null}getImageData(e,t,i){go||ak(),go.clearRect(0,0,1,1);let r;try{go.drawImage(e,t,i,1,1,0,0,1,1),r=go.getImageData(0,0,1,1).data}catch{return go=null,null}return r}getBackground(e){let t=this.getLayer().getBackground();return typeof t=="function"&&(t=t(e.viewState.resolution)),t||void 0}useContainer(e,t,i){const r=this.getLayer().getClassName();let s,o;if(e&&e.className===r&&(!i||e&&e.style.backgroundColor&&ac(Wm(e.style.backgroundColor),Wm(i)))){const a=e.firstElementChild;a instanceof HTMLCanvasElement&&(o=a.getContext("2d"))}if(o&&o.canvas.style.transform===t?(this.container=e,this.context=o,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){s=document.createElement("div"),s.className=r;let a=s.style;a.position="absolute",a.width="100%",a.height="100%",o=ko();const l=o.canvas;s.appendChild(l),a=l.style,a.position="absolute",a.left="0",a.transformOrigin="top left",this.container=s,this.context=o}!this.containerReused&&i&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=i)}clipUnrotated(e,t,i){const r=Hn(i),s=fc(i),o=dc(i),a=uc(i);Pr(t.coordinateToPixelTransform,r),Pr(t.coordinateToPixelTransform,s),Pr(t.coordinateToPixelTransform,o),Pr(t.coordinateToPixelTransform,a);const l=this.inversePixelTransform;Pr(l,r),Pr(l,s),Pr(l,o),Pr(l,a),e.save(),e.beginPath(),e.moveTo(Math.round(r[0]),Math.round(r[1])),e.lineTo(Math.round(s[0]),Math.round(s[1])),e.lineTo(Math.round(o[0]),Math.round(o[1])),e.lineTo(Math.round(a[0]),Math.round(a[1])),e.clip()}dispatchRenderEvent_(e,t,i){const r=this.getLayer();if(r.hasListener(e)){const s=new EE(e,this.inversePixelTransform,i,t);r.dispatchEvent(s)}}preRender(e,t){this.frameState=t,this.dispatchRenderEvent_(un.PRERENDER,e,t)}postRender(e,t){this.dispatchRenderEvent_(un.POSTRENDER,e,t)}getRenderTransform(e,t,i,r,s,o,a){const l=s/2,h=o/2,c=r/t,u=-c,d=-e[0]+a,f=-e[1];return Ua(this.tempTransform,l,h,c,u,-i,d,f)}disposeInternal(){delete this.frameState,super.disposeInternal()}}const hk=lk;class ck extends af{constructor(e,t,i){super(),i=i||{},this.tileCoord=e,this.state=t,this.interimTile=null,this.key="",this.transition_=i.transition===void 0?250:i.transition,this.transitionStarts_={},this.interpolate=!!i.interpolate}changed(){this.dispatchEvent(Rt.CHANGE)}release(){this.state===je.ERROR&&this.setState(je.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getInterimTile(){if(!this.interimTile)return this;let e=this.interimTile;do{if(e.getState()==je.LOADED)return this.transition_=0,e;e=e.interimTile}while(e);return this}refreshInterimChain(){if(!this.interimTile)return;let e=this.interimTile,t=this;do{if(e.getState()==je.LOADED){e.interimTile=null;break}else e.getState()==je.LOADING?t=e:e.getState()==je.IDLE?t.interimTile=e.interimTile:t=e;e=t.interimTile}while(e)}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(e){if(this.state!==je.ERROR&&this.state>e)throw new Error("Tile load sequence violation");this.state=e,this.changed()}load(){mi()}getAlpha(e,t){if(!this.transition_)return 1;let i=this.transitionStarts_[e];if(!i)i=t,this.transitionStarts_[e]=i;else if(i===-1)return 1;const r=t-i+1e3/60;return r>=this.transition_?1:hE(r/this.transition_)}inTransition(e){return this.transition_?this.transitionStarts_[e]!==-1:!1}endTransition(e){this.transition_&&(this.transitionStarts_[e]=-1)}}const IE=ck;function uk(n,e,t){const i=n;let r=!0,s=!1,o=!1;const a=[Ah(i,Rt.LOAD,function(){o=!0,s||e()})];return i.src&&p3?(s=!0,i.decode().then(function(){r&&e()}).catch(function(l){r&&(o?e():t())})):a.push(Ah(i,Rt.ERROR,t)),function(){r=!1,a.forEach(xi)}}class dk extends IE{constructor(e,t,i,r,s,o){super(e,t,o),this.crossOrigin_=r,this.src_=i,this.key=i,this.image_=new Image,r!==null&&(this.image_.crossOrigin=r),this.unlisten_=null,this.tileLoadFunction_=s}getImage(){return this.image_}setImage(e){this.image_=e,this.state=je.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=je.ERROR,this.unlistenImage_(),this.image_=fk(),this.changed()}handleImageLoad_(){const e=this.image_;e.naturalWidth&&e.naturalHeight?this.state=je.LOADED:this.state=je.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==je.ERROR&&(this.state=je.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==je.IDLE&&(this.state=je.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=uk(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}function fk(){const n=ko(1,1);return n.fillStyle="rgba(0,0,0,0)",n.fillRect(0,0,1,1),n.canvas}const AE=dk,pk=.5,gk=10,u_=.25;class mk{constructor(e,t,i,r,s,o){this.sourceProj_=e,this.targetProj_=t;let a={};const l=ka(this.targetProj_,this.sourceProj_);this.transformInv_=function(E){const R=E[0]+"/"+E[1];return a[R]||(a[R]=l(E)),a[R]},this.maxSourceExtent_=r,this.errorThresholdSquared_=s*s,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!r&&!!this.sourceProj_.getExtent()&&ki(r)>=ki(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?ki(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?ki(this.targetProj_.getExtent()):null;const h=Hn(i),c=fc(i),u=dc(i),d=uc(i),f=this.transformInv_(h),p=this.transformInv_(c),g=this.transformInv_(u),m=this.transformInv_(d),x=gk+(o?Math.max(0,Math.ceil(Math.log2(ku(i)/(o*o*256*256)))):0);if(this.addQuad_(h,c,u,d,f,p,g,m,x),this.wrapsXInSource_){let E=1/0;this.triangles_.forEach(function(R,C,_){E=Math.min(E,R.source[0][0],R.source[1][0],R.source[2][0])}),this.triangles_.forEach(R=>{if(Math.max(R.source[0][0],R.source[1][0],R.source[2][0])-E>this.sourceWorldWidth_/2){const C=[[R.source[0][0],R.source[0][1]],[R.source[1][0],R.source[1][1]],[R.source[2][0],R.source[2][1]]];C[0][0]-E>this.sourceWorldWidth_/2&&(C[0][0]-=this.sourceWorldWidth_),C[1][0]-E>this.sourceWorldWidth_/2&&(C[1][0]-=this.sourceWorldWidth_),C[2][0]-E>this.sourceWorldWidth_/2&&(C[2][0]-=this.sourceWorldWidth_);const _=Math.min(C[0][0],C[1][0],C[2][0]);Math.max(C[0][0],C[1][0],C[2][0])-_<this.sourceWorldWidth_/2&&(R.source=C)}})}a={}}addTriangle_(e,t,i,r,s,o){this.triangles_.push({source:[r,s,o],target:[e,t,i]})}addQuad_(e,t,i,r,s,o,a,l,h){const c=zm([s,o,a,l]),u=this.sourceWorldWidth_?ki(c)/this.sourceWorldWidth_:null,d=this.sourceWorldWidth_,f=this.sourceProj_.canWrapX()&&u>.5&&u<1;let p=!1;if(h>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const m=zm([e,t,i,r]);p=ki(m)/this.targetWorldWidth_>u_||p}!f&&this.sourceProj_.isGlobal()&&u&&(p=u>u_||p)}if(!p&&this.maxSourceExtent_&&isFinite(c[0])&&isFinite(c[1])&&isFinite(c[2])&&isFinite(c[3])&&!rl(c,this.maxSourceExtent_))return;let g=0;if(!p&&(!isFinite(s[0])||!isFinite(s[1])||!isFinite(o[0])||!isFinite(o[1])||!isFinite(a[0])||!isFinite(a[1])||!isFinite(l[0])||!isFinite(l[1]))){if(h>0)p=!0;else if(g=(!isFinite(s[0])||!isFinite(s[1])?8:0)+(!isFinite(o[0])||!isFinite(o[1])?4:0)+(!isFinite(a[0])||!isFinite(a[1])?2:0)+(!isFinite(l[0])||!isFinite(l[1])?1:0),g!=1&&g!=2&&g!=4&&g!=8)return}if(h>0){if(!p){const m=[(e[0]+i[0])/2,(e[1]+i[1])/2],x=this.transformInv_(m);let E;f?E=(Po(s[0],d)+Po(a[0],d))/2-Po(x[0],d):E=(s[0]+a[0])/2-x[0];const R=(s[1]+a[1])/2-x[1];p=E*E+R*R>this.errorThresholdSquared_}if(p){if(Math.abs(e[0]-i[0])<=Math.abs(e[1]-i[1])){const m=[(t[0]+i[0])/2,(t[1]+i[1])/2],x=this.transformInv_(m),E=[(r[0]+e[0])/2,(r[1]+e[1])/2],R=this.transformInv_(E);this.addQuad_(e,t,m,E,s,o,x,R,h-1),this.addQuad_(E,m,i,r,R,x,a,l,h-1)}else{const m=[(e[0]+t[0])/2,(e[1]+t[1])/2],x=this.transformInv_(m),E=[(i[0]+r[0])/2,(i[1]+r[1])/2],R=this.transformInv_(E);this.addQuad_(e,m,E,r,s,x,R,l,h-1),this.addQuad_(m,t,i,E,x,o,a,R,h-1)}return}}if(f){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}g&11||this.addTriangle_(e,i,r,s,a,l),g&14||this.addTriangle_(e,i,t,s,a,o),g&&(g&13||this.addTriangle_(t,r,e,o,l,s),g&7||this.addTriangle_(t,r,i,o,l,a))}calculateSourceExtent(){const e=Xn();return this.triangles_.forEach(function(t,i,r){const s=t.source;th(e,s[0]),th(e,s[1]),th(e,s[2])}),e}getTriangles(){return this.triangles_}}const _k=mk;let _u;const Do=[];function d_(n,e,t,i,r){n.beginPath(),n.moveTo(0,0),n.lineTo(e,t),n.lineTo(i,r),n.closePath(),n.save(),n.clip(),n.fillRect(0,0,Math.max(e,i)+1,Math.max(t,r)),n.restore()}function vu(n,e){return Math.abs(n[e*4]-210)>2||Math.abs(n[e*4+3]-.75*255)>2}function vk(){if(_u===void 0){const n=ko(6,6,Do);n.globalCompositeOperation="lighter",n.fillStyle="rgba(210, 0, 0, 0.75)",d_(n,4,5,4,0),d_(n,4,5,0,5);const e=n.getImageData(0,0,3,3).data;_u=vu(e,0)||vu(e,4)||vu(e,8),Rf(n),Do.push(n.canvas)}return _u}function f_(n,e,t,i){const r=pf(t,e,n);let s=jm(e,i,t);const o=e.getMetersPerUnit();o!==void 0&&(s*=o);const a=n.getMetersPerUnit();a!==void 0&&(s/=a);const l=n.getExtent();if(!l||lf(l,r)){const h=jm(n,s,r)/s;isFinite(h)&&h>0&&(s/=h)}return s}function Ek(n,e,t,i){const r=Va(t);let s=f_(n,e,r,i);return(!isFinite(s)||s<=0)&&tE(t,function(o){return s=f_(n,e,o,i),isFinite(s)&&s>0}),s}function Tk(n,e,t,i,r,s,o,a,l,h,c,u){const d=ko(Math.round(t*n),Math.round(t*e),Do);if(u||(d.imageSmoothingEnabled=!1),l.length===0)return d.canvas;d.scale(t,t);function f(C){return Math.round(C*t)/t}d.globalCompositeOperation="lighter";const p=Xn();l.forEach(function(C,_,T){C3(p,C.extent)});const g=ki(p),m=xs(p),x=ko(Math.round(t*g/i),Math.round(t*m/i),Do);u||(x.imageSmoothingEnabled=!1);const E=t/i;l.forEach(function(C,_,T){const y=C.extent[0]-p[0],P=-(C.extent[3]-p[3]),D=ki(C.extent),F=xs(C.extent);C.image.width>0&&C.image.height>0&&x.drawImage(C.image,h,h,C.image.width-2*h,C.image.height-2*h,y*E,P*E,D*E,F*E)});const R=Hn(o);return a.getTriangles().forEach(function(C,_,T){const y=C.source,P=C.target;let D=y[0][0],F=y[0][1],N=y[1][0],G=y[1][1],J=y[2][0],j=y[2][1];const z=f((P[0][0]-R[0])/s),$=f(-(P[0][1]-R[1])/s),te=f((P[1][0]-R[0])/s),fe=f(-(P[1][1]-R[1])/s),Z=f((P[2][0]-R[0])/s),L=f(-(P[2][1]-R[1])/s),w=D,H=F;D=0,F=0,N-=w,G-=H,J-=w,j-=H;const de=[[N,G,0,0,te-z],[J,j,0,0,Z-z],[0,0,N,G,fe-$],[0,0,J,j,L-$]],Te=M3(de);if(Te){if(d.save(),d.beginPath(),vk()||!u){d.moveTo(te,fe);const Ne=4,Fe=z-te,ce=$-fe;for(let ve=0;ve<Ne;ve++)d.lineTo(te+f((ve+1)*Fe/Ne),fe+f(ve*ce/(Ne-1))),ve!=Ne-1&&d.lineTo(te+f((ve+1)*Fe/Ne),fe+f((ve+1)*ce/(Ne-1)));d.lineTo(Z,L)}else d.moveTo(te,fe),d.lineTo(z,$),d.lineTo(Z,L);d.clip(),d.transform(Te[0],Te[2],Te[1],Te[3],z,$),d.translate(p[0]-w,p[3]-H),d.scale(i/t,-i/t),d.drawImage(x.canvas,0,0),d.restore()}}),Rf(x),Do.push(x.canvas),c&&(d.save(),d.globalCompositeOperation="source-over",d.strokeStyle="black",d.lineWidth=1,a.getTriangles().forEach(function(C,_,T){const y=C.target,P=(y[0][0]-R[0])/s,D=-(y[0][1]-R[1])/s,F=(y[1][0]-R[0])/s,N=-(y[1][1]-R[1])/s,G=(y[2][0]-R[0])/s,J=-(y[2][1]-R[1])/s;d.beginPath(),d.moveTo(F,N),d.lineTo(P,D),d.lineTo(G,J),d.closePath(),d.stroke()}),d.restore()),d.canvas}class xk extends IE{constructor(e,t,i,r,s,o,a,l,h,c,u,d){super(s,je.IDLE,{interpolate:!!d}),this.renderEdges_=u!==void 0?u:!1,this.pixelRatio_=a,this.gutter_=l,this.canvas_=null,this.sourceTileGrid_=t,this.targetTileGrid_=r,this.wrappedTileCoord_=o||s,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const f=r.getTileCoordExtent(this.wrappedTileCoord_),p=this.targetTileGrid_.getExtent();let g=this.sourceTileGrid_.getExtent();const m=p?Ea(f,p):f;if(ku(m)===0){this.state=je.EMPTY;return}const x=e.getExtent();x&&(g?g=Ea(g,x):g=x);const E=r.getResolution(this.wrappedTileCoord_[0]),R=Ek(e,i,m,E);if(!isFinite(R)||R<=0){this.state=je.EMPTY;return}const C=c!==void 0?c:pk;if(this.triangulation_=new _k(e,i,m,g,R*C,E),this.triangulation_.getTriangles().length===0){this.state=je.EMPTY;return}this.sourceZ_=t.getZForResolution(R);let _=this.triangulation_.calculateSourceExtent();if(g&&(e.canWrapX()?(_[1]=zi(_[1],g[1],g[3]),_[3]=zi(_[3],g[1],g[3])):_=Ea(_,g)),!ku(_))this.state=je.EMPTY;else{const T=t.getTileRangeForExtentAndZ(_,this.sourceZ_);for(let y=T.minX;y<=T.maxX;y++)for(let P=T.minY;P<=T.maxY;P++){const D=h(this.sourceZ_,y,P,a);D&&this.sourceTiles_.push(D)}this.sourceTiles_.length===0&&(this.state=je.EMPTY)}}getImage(){return this.canvas_}reproject_(){const e=[];if(this.sourceTiles_.forEach(t=>{t&&t.getState()==je.LOADED&&e.push({extent:this.sourceTileGrid_.getTileCoordExtent(t.tileCoord),image:t.getImage()})}),this.sourceTiles_.length=0,e.length===0)this.state=je.ERROR;else{const t=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(t),r=typeof i=="number"?i:i[0],s=typeof i=="number"?i:i[1],o=this.targetTileGrid_.getResolution(t),a=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=Tk(r,s,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),o,l,this.triangulation_,e,this.gutter_,this.renderEdges_,this.interpolate),this.state=je.LOADED}this.changed()}load(){if(this.state==je.IDLE){this.state=je.LOADING,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(t=>{const i=t.getState();if(i==je.IDLE||i==je.LOADING){e++;const r=Kt(t,Rt.CHANGE,function(s){const o=t.getState();(o==je.LOADED||o==je.ERROR||o==je.EMPTY)&&(xi(r),e--,e===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(r)}}),e===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(t,i,r){t.getState()==je.IDLE&&t.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(xi),this.sourcesListenerKeys_=null}release(){this.canvas_&&(Rf(this.canvas_.getContext("2d")),Do.push(this.canvas_),this.canvas_=null),super.release()}}const ju=xk;class ME{constructor(e,t,i,r){this.minX=e,this.maxX=t,this.minY=i,this.maxY=r}contains(e){return this.containsXY(e[1],e[2])}containsTileRange(e){return this.minX<=e.minX&&e.maxX<=this.maxX&&this.minY<=e.minY&&e.maxY<=this.maxY}containsXY(e,t){return this.minX<=e&&e<=this.maxX&&this.minY<=t&&t<=this.maxY}equals(e){return this.minX==e.minX&&this.minY==e.minY&&this.maxX==e.maxX&&this.maxY==e.maxY}extend(e){e.minX<this.minX&&(this.minX=e.minX),e.maxX>this.maxX&&(this.maxX=e.maxX),e.minY<this.minY&&(this.minY=e.minY),e.maxY>this.maxY&&(this.maxY=e.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(e){return this.minX<=e.maxX&&this.maxX>=e.minX&&this.minY<=e.maxY&&this.maxY>=e.minY}}function ho(n,e,t,i,r){return r!==void 0?(r.minX=n,r.maxX=e,r.minY=t,r.maxY=i,r):new ME(n,e,t,i)}const PE=ME;class Ck extends hk{constructor(e){super(e),this.extentChanged=!0,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision,this.renderedTiles=[],this.newTiles_=!1,this.tmpExtent=Xn(),this.tmpTileRange_=new PE(0,0,0,0)}isDrawableTile(e){const t=this.getLayer(),i=e.getState(),r=t.getUseInterimTilesOnError();return i==je.LOADED||i==je.EMPTY||i==je.ERROR&&!r}getTile(e,t,i,r){const s=r.pixelRatio,o=r.viewState.projection,a=this.getLayer();let l=a.getSource().getTile(e,t,i,s,o);return l.getState()==je.ERROR&&a.getUseInterimTilesOnError()&&a.getPreload()>0&&(this.newTiles_=!0),this.isDrawableTile(l)||(l=l.getInterimTile()),l}getData(e){const t=this.frameState;if(!t)return null;const i=this.getLayer(),r=Pr(t.pixelToCoordinateTransform,e.slice()),s=i.getExtent();if(s&&!lf(s,r))return null;const o=t.pixelRatio,a=t.viewState.projection,l=t.viewState,h=i.getRenderSource(),c=h.getTileGridForProjection(l.projection),u=h.getTilePixelRatio(t.pixelRatio);for(let d=c.getZForResolution(l.resolution);d>=c.getMinZoom();--d){const f=c.getTileCoordForCoordAndZ(r,d),p=h.getTile(d,f[1],f[2],o,a);if(!(p instanceof AE||p instanceof ju)||p instanceof ju&&p.getState()===je.EMPTY)return null;if(p.getState()!==je.LOADED)continue;const g=c.getOrigin(d),m=cn(c.getTileSize(d)),x=c.getResolution(d),E=Math.floor(u*((r[0]-g[0])/x-f[1]*m[0])),R=Math.floor(u*((g[1]-r[1])/x-f[2]*m[1])),C=Math.round(u*h.getGutterForProjection(l.projection));return this.getImageData(p.getImage(),E+C,R+C)}return null}loadedTileCallback(e,t,i){return this.isDrawableTile(i)?super.loadedTileCallback(e,t,i):!1}prepareFrame(e){return!!this.getLayer().getSource()}renderFrame(e,t){const i=e.layerStatesArray[e.layerIndex],r=e.viewState,s=r.projection,o=r.resolution,a=r.center,l=r.rotation,h=e.pixelRatio,c=this.getLayer(),u=c.getSource(),d=u.getRevision(),f=u.getTileGridForProjection(s),p=f.getZForResolution(o,u.zDirection),g=f.getResolution(p);let m=e.extent;const x=e.viewState.resolution,E=u.getTilePixelRatio(h),R=Math.round(ki(m)/x*h),C=Math.round(xs(m)/x*h),_=i.extent&&vo(i.extent,s);_&&(m=Ea(m,vo(i.extent,s)));const T=g*R/2/E,y=g*C/2/E,P=[a[0]-T,a[1]-y,a[0]+T,a[1]+y],D=f.getTileRangeForExtentAndZ(m,p),F={};F[p]={};const N=this.createLoadedTileFinder(u,s,F),G=this.tmpExtent,J=this.tmpTileRange_;this.newTiles_=!1;const j=l?Gu(r.center,x,l,e.size):void 0;for(let de=D.minX;de<=D.maxX;++de)for(let Te=D.minY;Te<=D.maxY;++Te){if(l&&!f.tileCoordIntersectsViewport([p,de,Te],j))continue;const Ne=this.getTile(p,de,Te,e);if(this.isDrawableTile(Ne)){const ve=gr(this);if(Ne.getState()==je.LOADED){F[p][Ne.tileCoord.toString()]=Ne;let Ue=Ne.inTransition(ve);Ue&&i.opacity!==1&&(Ne.endTransition(ve),Ue=!1),!this.newTiles_&&(Ue||!this.renderedTiles.includes(Ne))&&(this.newTiles_=!0)}if(Ne.getAlpha(ve,e.time)===1)continue}const Fe=f.getTileCoordChildTileRange(Ne.tileCoord,J,G);let ce=!1;Fe&&(ce=N(p+1,Fe)),ce||f.forEachTileCoordParentTileRange(Ne.tileCoord,N,J,G)}const z=g/o*h/E;Ua(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/h,1/h,l,-R/2,-C/2);const $=m3(this.pixelTransform);this.useContainer(t,$,this.getBackground(e));const te=this.context,fe=te.canvas;Qv(this.inversePixelTransform,this.pixelTransform),Ua(this.tempTransform,R/2,C/2,z,z,0,-R/2,-C/2),fe.width!=R||fe.height!=C?(fe.width=R,fe.height=C):this.containerReused||te.clearRect(0,0,R,C),_&&this.clipUnrotated(te,e,_),u.getInterpolate()||(te.imageSmoothingEnabled=!1),this.preRender(te,e),this.renderedTiles.length=0;let Z=Object.keys(F).map(Number);Z.sort(nf);let L,w,H;i.opacity===1&&(!this.containerReused||u.getOpaque(e.viewState.projection))?Z=Z.reverse():(L=[],w=[]);for(let de=Z.length-1;de>=0;--de){const Te=Z[de],Ne=u.getTilePixelSize(Te,h,s),Fe=f.getResolution(Te)/g,ce=Ne[0]*Fe*z,ve=Ne[1]*Fe*z,Ue=f.getTileCoordForCoordAndZ(Hn(P),Te),Se=f.getTileCoordExtent(Ue),ue=Pr(this.tempTransform,[E*(Se[0]-P[0])/g,E*(P[3]-Se[3])/g]),Ze=E*u.getGutterForProjection(s),_t=F[Te];for(const vt in _t){const Ot=_t[vt],$t=Ot.tileCoord,Ii=Ue[1]-$t[1],Gi=Math.round(ue[0]-(Ii-1)*ce),rs=Ue[2]-$t[2],ss=Math.round(ue[1]-(rs-1)*ve),Wi=Math.round(ue[0]-Ii*ce),Xi=Math.round(ue[1]-rs*ve),ns=Gi-Wi,Ir=ss-Xi,Ss=p===Te,ys=Ss&&Ot.getAlpha(gr(this),e.time)!==1;let os=!1;if(!ys)if(L){H=[Wi,Xi,Wi+ns,Xi,Wi+ns,Xi+Ir,Wi,Xi+Ir];for(let Tr=0,Ys=L.length;Tr<Ys;++Tr)if(p!==Te&&Te<w[Tr]){const Di=L[Tr];rl([Wi,Xi,Wi+ns,Xi+Ir],[Di[0],Di[3],Di[4],Di[7]])&&(os||(te.save(),os=!0),te.beginPath(),te.moveTo(H[0],H[1]),te.lineTo(H[2],H[3]),te.lineTo(H[4],H[5]),te.lineTo(H[6],H[7]),te.moveTo(Di[6],Di[7]),te.lineTo(Di[4],Di[5]),te.lineTo(Di[2],Di[3]),te.lineTo(Di[0],Di[1]),te.clip())}L.push(H),w.push(Te)}else te.clearRect(Wi,Xi,ns,Ir);this.drawTileImage(Ot,e,Wi,Xi,ns,Ir,Ze,Ss),L&&!ys?(os&&te.restore(),this.renderedTiles.unshift(Ot)):this.renderedTiles.push(Ot),this.updateUsedTiles(e.usedTiles,u,Ot)}}return this.renderedRevision=d,this.renderedResolution=g,this.extentChanged=!this.renderedExtent_||!Bu(this.renderedExtent_,P),this.renderedExtent_=P,this.renderedPixelRatio=h,this.renderedProjection=s,this.manageTilePyramid(e,u,f,h,s,m,p,c.getPreload()),this.scheduleExpireCache(e,u),this.postRender(te,e),i.extent&&te.restore(),te.imageSmoothingEnabled=!0,$!==fe.style.transform&&(fe.style.transform=$),this.container}drawTileImage(e,t,i,r,s,o,a,l){const h=this.getTileImage(e);if(!h)return;const c=gr(this),u=t.layerStatesArray[t.layerIndex],d=u.opacity*(l?e.getAlpha(c,t.time):1),f=d!==this.context.globalAlpha;f&&(this.context.save(),this.context.globalAlpha=d),this.context.drawImage(h,a,a,h.width-2*a,h.height-2*a,i,r,s,o),f&&this.context.restore(),d!==u.opacity?t.animate=!0:l&&e.endTransition(c)}getImage(){const e=this.context;return e?e.canvas:null}getTileImage(e){return e.getImage()}scheduleExpireCache(e,t){if(t.canExpireCache()){const i=(function(r,s,o){const a=gr(r);a in o.usedTiles&&r.expireCache(o.viewState.projection,o.usedTiles[a])}).bind(null,t);e.postRenderFunctions.push(i)}}updateUsedTiles(e,t,i){const r=gr(t);r in e||(e[r]={}),e[r][i.getKey()]=!0}manageTilePyramid(e,t,i,r,s,o,a,l,h){const c=gr(t);c in e.wantedTiles||(e.wantedTiles[c]={});const u=e.wantedTiles[c],d=e.tileQueue,f=i.getMinZoom(),p=e.viewState.rotation,g=p?Gu(e.viewState.center,e.viewState.resolution,p,e.size):void 0;let m=0,x,E,R,C,_,T;for(T=f;T<=a;++T)for(E=i.getTileRangeForExtentAndZ(o,T,E),R=i.getResolution(T),C=E.minX;C<=E.maxX;++C)for(_=E.minY;_<=E.maxY;++_)p&&!i.tileCoordIntersectsViewport([T,C,_],g)||(a-T<=l?(++m,x=t.getTile(T,C,_,r,s),x.getState()==je.IDLE&&(u[x.getKey()]=!0,d.isKeyQueued(x.getKey())||d.enqueue([x,c,i.getTileCoordCenter(x.tileCoord),R])),h!==void 0&&h(x)):t.useTile(T,C,_,s));t.updateCacheSize(m,s)}}const Rk=Ck;class Sk extends sk{constructor(e){super(e)}createRenderer(){return new Rk(this)}}const OE=Sk;class yk{constructor(e){this.highWaterMark=e!==void 0?e:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(e){for(;this.canExpireCache();)this.pop()}clear(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}containsKey(e){return this.entries_.hasOwnProperty(e)}forEach(e){let t=this.oldest_;for(;t;)e(t.value_,t.key_,this),t=t.newer}get(e,t){const i=this.entries_[e];return qt(i!==void 0,15),i===this.newest_||(i===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(i.newer.older=i.older,i.older.newer=i.newer),i.newer=null,i.older=this.newest_,this.newest_.newer=i,this.newest_=i),i.value_}remove(e){const t=this.entries_[e];return qt(t!==void 0,15),t===this.newest_?(this.newest_=t.older,this.newest_&&(this.newest_.newer=null)):t===this.oldest_?(this.oldest_=t.newer,this.oldest_&&(this.oldest_.older=null)):(t.newer.older=t.older,t.older.newer=t.newer),delete this.entries_[e],--this.count_,t.value_}getCount(){return this.count_}getKeys(){const e=new Array(this.count_);let t=0,i;for(i=this.newest_;i;i=i.older)e[t++]=i.key_;return e}getValues(){const e=new Array(this.count_);let t=0,i;for(i=this.newest_;i;i=i.older)e[t++]=i.value_;return e}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(e){if(this.containsKey(e))return this.entries_[e].value_}pop(){const e=this.oldest_;return delete this.entries_[e.key_],e.newer&&(e.newer.older=null),this.oldest_=e.newer,this.oldest_||(this.newest_=null),--this.count_,e.value_}replace(e,t){this.get(e),this.entries_[e].value_=t}set(e,t){qt(!(e in this.entries_),16);const i={key_:e,newer:null,older:this.newest_,value_:t};this.newest_?this.newest_.newer=i:this.oldest_=i,this.newest_=i,this.entries_[e]=i,++this.count_}setSize(e){this.highWaterMark=e}}const bk=yk;function p_(n,e,t,i){return i!==void 0?(i[0]=n,i[1]=e,i[2]=t,i):[n,e,t]}function mc(n,e,t){return n+"/"+e+"/"+t}function DE(n){return mc(n[0],n[1],n[2])}function Ik(n){return n.split("/").map(Number)}function Ak(n){return(n[1]<<n[0])+n[2]}function Mk(n,e){const t=n[0],i=n[1],r=n[2];if(e.getMinZoom()>t||t>e.getMaxZoom())return!1;const s=e.getFullTileRange(t);return s?s.containsXY(i,r):!0}class Pk extends bk{clear(){for(;this.getCount()>0;)this.pop().release();super.clear()}expireCache(e){for(;this.canExpireCache()&&!(this.peekLast().getKey()in e);)this.pop().release()}pruneExceptNewestZ(){if(this.getCount()===0)return;const e=this.peekFirstKey(),t=Ik(e)[0];this.forEach(i=>{i.tileCoord[0]!==t&&(this.remove(DE(i.tileCoord)),i.release())})}}const NE=Pk,Eu={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"};class Ok extends qs{constructor(e){super(),this.projection=Vr(e.projection),this.attributions_=g_(e.attributions),this.attributionsCollapsible_=e.attributionsCollapsible!==void 0?e.attributionsCollapsible:!0,this.loading=!1,this.state_=e.state!==void 0?e.state:"ready",this.wrapX_=e.wrapX!==void 0?e.wrapX:!1,this.interpolate_=!!e.interpolate,this.viewResolver=null,this.viewRejector=null;const t=this;this.viewPromise_=new Promise(function(i,r){t.viewResolver=i,t.viewRejector=r})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(e){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(e){this.attributions_=g_(e),this.changed()}setState(e){this.state_=e,this.changed()}}function g_(n){return n?Array.isArray(n)?function(e){return n}:typeof n=="function"?n:function(e){return[n]}:null}const Dk=Ok,co=[0,0,0],sn=5;class Nk{constructor(e){this.minZoom=e.minZoom!==void 0?e.minZoom:0,this.resolutions_=e.resolutions,qt(t3(this.resolutions_,function(r,s){return s-r},!0),17);let t;if(!e.origins){for(let r=0,s=this.resolutions_.length-1;r<s;++r)if(!t)t=this.resolutions_[r]/this.resolutions_[r+1];else if(this.resolutions_[r]/this.resolutions_[r+1]!==t){t=void 0;break}}this.zoomFactor_=t,this.maxZoom=this.resolutions_.length-1,this.origin_=e.origin!==void 0?e.origin:null,this.origins_=null,e.origins!==void 0&&(this.origins_=e.origins,qt(this.origins_.length==this.resolutions_.length,20));const i=e.extent;i!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=Hn(i)),qt(!this.origin_&&this.origins_||this.origin_&&!this.origins_,18),this.tileSizes_=null,e.tileSizes!==void 0&&(this.tileSizes_=e.tileSizes,qt(this.tileSizes_.length==this.resolutions_.length,19)),this.tileSize_=e.tileSize!==void 0?e.tileSize:this.tileSizes_?null:hf,qt(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,22),this.extent_=i!==void 0?i:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],e.sizes!==void 0?this.fullTileRanges_=e.sizes.map(function(r,s){const o=new PE(Math.min(0,r[0]),Math.max(r[0]-1,-1),Math.min(0,r[1]),Math.max(r[1]-1,-1));if(i){const a=this.getTileRangeForExtentAndZ(i,s);o.minX=Math.max(a.minX,o.minX),o.maxX=Math.min(a.maxX,o.maxX),o.minY=Math.max(a.minY,o.minY),o.maxY=Math.min(a.maxY,o.maxY)}return o},this):i&&this.calculateTileRanges_(i)}forEachTileCoord(e,t,i){const r=this.getTileRangeForExtentAndZ(e,t);for(let s=r.minX,o=r.maxX;s<=o;++s)for(let a=r.minY,l=r.maxY;a<=l;++a)i([t,s,a])}forEachTileCoordParentTileRange(e,t,i,r){let s,o,a,l=null,h=e[0]-1;for(this.zoomFactor_===2?(o=e[1],a=e[2]):l=this.getTileCoordExtent(e,r);h>=this.minZoom;){if(this.zoomFactor_===2?(o=Math.floor(o/2),a=Math.floor(a/2),s=ho(o,o,a,a,i)):s=this.getTileRangeForExtentAndZ(l,h,i),t(h,s))return!0;--h}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(e){return this.origin_?this.origin_:this.origins_[e]}getResolution(e){return this.resolutions_[e]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(e,t,i){if(e[0]<this.maxZoom){if(this.zoomFactor_===2){const s=e[1]*2,o=e[2]*2;return ho(s,s+1,o,o+1,t)}const r=this.getTileCoordExtent(e,i||this.tmpExtent_);return this.getTileRangeForExtentAndZ(r,e[0]+1,t)}return null}getTileRangeForTileCoordAndZ(e,t,i){if(t>this.maxZoom||t<this.minZoom)return null;const r=e[0],s=e[1],o=e[2];if(t===r)return ho(s,o,s,o,i);if(this.zoomFactor_){const l=Math.pow(this.zoomFactor_,t-r),h=Math.floor(s*l),c=Math.floor(o*l);if(t<r)return ho(h,h,c,c,i);const u=Math.floor(l*(s+1))-1,d=Math.floor(l*(o+1))-1;return ho(h,u,c,d,i)}const a=this.getTileCoordExtent(e,this.tmpExtent_);return this.getTileRangeForExtentAndZ(a,t,i)}getTileRangeForExtentAndZ(e,t,i){this.getTileCoordForXYAndZ_(e[0],e[3],t,!1,co);const r=co[1],s=co[2];this.getTileCoordForXYAndZ_(e[2],e[1],t,!0,co);const o=co[1],a=co[2];return ho(r,o,s,a,i)}getTileCoordCenter(e){const t=this.getOrigin(e[0]),i=this.getResolution(e[0]),r=cn(this.getTileSize(e[0]),this.tmpSize_);return[t[0]+(e[1]+.5)*r[0]*i,t[1]-(e[2]+.5)*r[1]*i]}getTileCoordExtent(e,t){const i=this.getOrigin(e[0]),r=this.getResolution(e[0]),s=cn(this.getTileSize(e[0]),this.tmpSize_),o=i[0]+e[1]*s[0]*r,a=i[1]-(e[2]+1)*s[1]*r,l=o+s[0]*r,h=a+s[1]*r;return Qo(o,a,l,h,t)}getTileCoordForCoordAndResolution(e,t,i){return this.getTileCoordForXYAndResolution_(e[0],e[1],t,!1,i)}getTileCoordForXYAndResolution_(e,t,i,r,s){const o=this.getZForResolution(i),a=i/this.getResolution(o),l=this.getOrigin(o),h=cn(this.getTileSize(o),this.tmpSize_);let c=a*(e-l[0])/i/h[0],u=a*(l[1]-t)/i/h[1];return r?(c=Pl(c,sn)-1,u=Pl(u,sn)-1):(c=Ml(c,sn),u=Ml(u,sn)),p_(o,c,u,s)}getTileCoordForXYAndZ_(e,t,i,r,s){const o=this.getOrigin(i),a=this.getResolution(i),l=cn(this.getTileSize(i),this.tmpSize_);let h=(e-o[0])/a/l[0],c=(o[1]-t)/a/l[1];return r?(h=Pl(h,sn)-1,c=Pl(c,sn)-1):(h=Ml(h,sn),c=Ml(c,sn)),p_(i,h,c,s)}getTileCoordForCoordAndZ(e,t,i){return this.getTileCoordForXYAndZ_(e[0],e[1],t,!1,i)}getTileCoordResolution(e){return this.resolutions_[e[0]]}getTileSize(e){return this.tileSize_?this.tileSize_:this.tileSizes_[e]}getFullTileRange(e){return this.fullTileRanges_?this.fullTileRanges_[e]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,e):null}getZForResolution(e,t){const i=of(this.resolutions_,e,t||0);return zi(i,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(e,t){return _E(t,0,t.length,2,this.getTileCoordExtent(e))}calculateTileRanges_(e){const t=this.resolutions_.length,i=new Array(t);for(let r=this.minZoom;r<t;++r)i[r]=this.getTileRangeForExtentAndZ(e,r);this.fullTileRanges_=i}}const FE=Nk;function LE(n){let e=n.getDefaultTileGrid();return e||(e=Uk(n),n.setDefaultTileGrid(e)),e}function Fk(n,e,t){const i=e[0],r=n.getTileCoordCenter(e),s=Af(t);if(!lf(s,r)){const o=ki(s),a=Math.ceil((s[0]-r[0])/o);return r[0]+=o*a,n.getTileCoordForCoordAndZ(r,i)}return e}function Lk(n,e,t,i){i=i!==void 0?i:"top-left";const r=wE(n,e,t);return new FE({extent:n,origin:S3(n,i),resolutions:r,tileSize:t})}function wk(n){const e=n||{},t=e.extent||Vr("EPSG:3857").getExtent(),i={extent:t,minZoom:e.minZoom,tileSize:e.tileSize,resolutions:wE(t,e.maxZoom,e.tileSize,e.maxResolution)};return new FE(i)}function wE(n,e,t,i){e=e!==void 0?e:k3,t=cn(t!==void 0?t:hf);const r=xs(n),s=ki(n);i=i>0?i:Math.max(s/t[0],r/t[1]);const o=e+1,a=new Array(o);for(let l=0;l<o;++l)a[l]=i/Math.pow(2,l);return a}function Uk(n,e,t,i){const r=Af(n);return Lk(r,e,t,i)}function Af(n){n=Vr(n);let e=n.getExtent();if(!e){const t=180*Ba.degrees/n.getMetersPerUnit();e=Qo(-t,-t,t,t)}return e}class Vk extends Dk{constructor(e){super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:e.projection,state:e.state,wrapX:e.wrapX,interpolate:e.interpolate}),this.on,this.once,this.un,this.opaque_=e.opaque!==void 0?e.opaque:!1,this.tilePixelRatio_=e.tilePixelRatio!==void 0?e.tilePixelRatio:1,this.tileGrid=e.tileGrid!==void 0?e.tileGrid:null;const t=[256,256];this.tileGrid&&cn(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),t),this.tileCache=new NE(e.cacheSize||0),this.tmpSize=[0,0],this.key_=e.key||"",this.tileOptions={transition:e.transition,interpolate:e.interpolate},this.zDirection=e.zDirection?e.zDirection:0}canExpireCache(){return this.tileCache.canExpireCache()}expireCache(e,t){const i=this.getTileCacheForProjection(e);i&&i.expireCache(t)}forEachLoadedTile(e,t,i,r){const s=this.getTileCacheForProjection(e);if(!s)return!1;let o=!0,a,l,h;for(let c=i.minX;c<=i.maxX;++c)for(let u=i.minY;u<=i.maxY;++u)l=mc(t,c,u),h=!1,s.containsKey(l)&&(a=s.get(l),h=a.getState()===je.LOADED,h&&(h=r(a)!==!1)),h||(o=!1);return o}getGutterForProjection(e){return 0}getKey(){return this.key_}setKey(e){this.key_!==e&&(this.key_=e,this.changed())}getOpaque(e){return this.opaque_}getResolutions(e){const t=e?this.getTileGridForProjection(e):this.tileGrid;return t?t.getResolutions():null}getTile(e,t,i,r,s){return mi()}getTileGrid(){return this.tileGrid}getTileGridForProjection(e){return this.tileGrid?this.tileGrid:LE(e)}getTileCacheForProjection(e){const t=this.getProjection();return qt(t===null||fo(t,e),68),this.tileCache}getTilePixelRatio(e){return this.tilePixelRatio_}getTilePixelSize(e,t,i){const r=this.getTileGridForProjection(i),s=this.getTilePixelRatio(t),o=cn(r.getTileSize(e),this.tmpSize);return s==1?o:ek(o,s,this.tmpSize)}getTileCoordForTileUrlFunction(e,t){t=t!==void 0?t:this.getProjection();const i=this.getTileGridForProjection(t);return this.getWrapX()&&t.isGlobal()&&(e=Fk(i,e,t)),Mk(e,i)?e:null}clear(){this.tileCache.clear()}refresh(){this.clear(),super.refresh()}updateCacheSize(e,t){const i=this.getTileCacheForProjection(t);e>i.highWaterMark&&(i.highWaterMark=e)}useTile(e,t,i,r){}}class Bk extends Tn{constructor(e,t){super(e),this.tile=t}}const kk=Vk;function zk(n,e){const t=/\{z\}/g,i=/\{x\}/g,r=/\{y\}/g,s=/\{-y\}/g;return function(o,a,l){if(o)return n.replace(t,o[0].toString()).replace(i,o[1].toString()).replace(r,o[2].toString()).replace(s,function(){const h=o[0],c=e.getFullTileRange(h);return qt(c,55),(c.getHeight()-o[2]-1).toString()})}}function Gk(n,e){const t=n.length,i=new Array(t);for(let r=0;r<t;++r)i[r]=zk(n[r],e);return Wk(i)}function Wk(n){return n.length===1?n[0]:function(e,t,i){if(!e)return;const r=Ak(e),s=Po(r,n.length);return n[s](e,t,i)}}function Xk(n){const e=[];let t=/\{([a-z])-([a-z])\}/.exec(n);if(t){const i=t[1].charCodeAt(0),r=t[2].charCodeAt(0);let s;for(s=i;s<=r;++s)e.push(n.replace(t[0],String.fromCharCode(s)));return e}if(t=/\{(\d+)-(\d+)\}/.exec(n),t){const i=parseInt(t[2],10);for(let r=parseInt(t[1],10);r<=i;r++)e.push(n.replace(t[0],r.toString()));return e}return e.push(n),e}class Mf extends kk{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tilePixelRatio:e.tilePixelRatio,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===Mf.prototype.tileUrlFunction,this.tileLoadFunction=e.tileLoadFunction,e.tileUrlFunction&&(this.tileUrlFunction=e.tileUrlFunction),this.urls=null,e.urls?this.setUrls(e.urls):e.url&&this.setUrl(e.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(e){const t=e.target,i=gr(t),r=t.getState();let s;r==je.LOADING?(this.tileLoadingKeys_[i]=!0,s=Eu.TILELOADSTART):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],s=r==je.ERROR?Eu.TILELOADERROR:r==je.LOADED?Eu.TILELOADEND:void 0),s!=null&&this.dispatchEvent(new Bk(s,t))}setTileLoadFunction(e){this.tileCache.clear(),this.tileLoadFunction=e,this.changed()}setTileUrlFunction(e,t){this.tileUrlFunction=e,this.tileCache.pruneExceptNewestZ(),typeof t<"u"?this.setKey(t):this.changed()}setUrl(e){const t=Xk(e);this.urls=t,this.setUrls(t)}setUrls(e){this.urls=e;const t=e.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(Gk(e,this.tileGrid),t):this.setKey(t)}tileUrlFunction(e,t,i){}useTile(e,t,i){const r=mc(e,t,i);this.tileCache.containsKey(r)&&this.tileCache.get(r)}}const Hk=Mf;class Kk extends Hk{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:qk,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate!==void 0?e.interpolate:!0,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.crossOrigin=e.crossOrigin!==void 0?e.crossOrigin:null,this.tileClass=e.tileClass!==void 0?e.tileClass:AE,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=e.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}canExpireCache(){if(this.tileCache.canExpireCache())return!0;for(const e in this.tileCacheForProjection)if(this.tileCacheForProjection[e].canExpireCache())return!0;return!1}expireCache(e,t){const i=this.getTileCacheForProjection(e);this.tileCache.expireCache(this.tileCache==i?t:{});for(const r in this.tileCacheForProjection){const s=this.tileCacheForProjection[r];s.expireCache(s==i?t:{})}}getGutterForProjection(e){return this.getProjection()&&e&&!fo(this.getProjection(),e)?0:this.getGutter()}getGutter(){return 0}getKey(){let e=super.getKey();return this.getInterpolate()||(e+=":disable-interpolation"),e}getOpaque(e){return this.getProjection()&&e&&!fo(this.getProjection(),e)?!1:super.getOpaque(e)}getTileGridForProjection(e){const t=this.getProjection();if(this.tileGrid&&(!t||fo(t,e)))return this.tileGrid;const i=gr(e);return i in this.tileGridForProjection||(this.tileGridForProjection[i]=LE(e)),this.tileGridForProjection[i]}getTileCacheForProjection(e){const t=this.getProjection();if(!t||fo(t,e))return this.tileCache;const i=gr(e);return i in this.tileCacheForProjection||(this.tileCacheForProjection[i]=new NE(this.tileCache.highWaterMark)),this.tileCacheForProjection[i]}createTile_(e,t,i,r,s,o){const a=[e,t,i],l=this.getTileCoordForTileUrlFunction(a,s),h=l?this.tileUrlFunction(l,r,s):void 0,c=new this.tileClass(a,h!==void 0?je.IDLE:je.EMPTY,h!==void 0?h:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return c.key=o,c.addEventListener(Rt.CHANGE,this.handleTileChange.bind(this)),c}getTile(e,t,i,r,s){const o=this.getProjection();if(!o||!s||fo(o,s))return this.getTileInternal(e,t,i,r,o||s);const a=this.getTileCacheForProjection(s),l=[e,t,i];let h;const c=DE(l);a.containsKey(c)&&(h=a.get(c));const u=this.getKey();if(h&&h.key==u)return h;const d=this.getTileGridForProjection(o),f=this.getTileGridForProjection(s),p=this.getTileCoordForTileUrlFunction(l,s),g=new ju(o,d,s,f,l,p,this.getTilePixelRatio(r),this.getGutter(),(m,x,E,R)=>this.getTileInternal(m,x,E,R,o),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.getInterpolate());return g.key=u,h?(g.interimTile=h,g.refreshInterimChain(),a.replace(c,g)):a.set(c,g),g}getTileInternal(e,t,i,r,s){let o=null;const a=mc(e,t,i),l=this.getKey();if(!this.tileCache.containsKey(a))o=this.createTile_(e,t,i,r,s,l),this.tileCache.set(a,o);else if(o=this.tileCache.get(a),o.key!=l){const h=o;o=this.createTile_(e,t,i,r,s,l),h.getState()==je.IDLE?o.interimTile=h.interimTile:o.interimTile=h,o.refreshInterimChain(),this.tileCache.replace(a,o)}return o}setRenderReprojectionEdges(e){if(this.renderReprojectionEdges_!=e){this.renderReprojectionEdges_=e;for(const t in this.tileCacheForProjection)this.tileCacheForProjection[t].clear();this.changed()}}setTileGridForProjection(e,t){const i=Vr(e);if(i){const r=gr(i);r in this.tileGridForProjection||(this.tileGridForProjection[r]=t)}}clear(){super.clear();for(const e in this.tileCacheForProjection)this.tileCacheForProjection[e].clear()}}function qk(n,e){n.getImage().src=e}const Yk=Kk;class Zk extends Yk{constructor(e){e=e||{};const t=e.projection!==void 0?e.projection:"EPSG:3857",i=e.tileGrid!==void 0?e.tileGrid:wk({extent:Af(t),maxResolution:e.maxResolution,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize});super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,opaque:e.opaque,projection:t,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileGrid:i,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.gutter_=e.gutter!==void 0?e.gutter:0}getGutter(){return this.gutter_}}const jk=Zk;var Qk=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function UE(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}const Jk='&#169; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors.';class $k extends jk{constructor(e){e=e||{};let t;e.attributions!==void 0?t=e.attributions:t=[Jk];const i=e.crossOrigin!==void 0?e.crossOrigin:"anonymous",r=e.url!==void 0?e.url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png";super({attributions:t,attributionsCollapsible:!1,cacheSize:e.cacheSize,crossOrigin:i,interpolate:e.interpolate,maxZoom:e.maxZoom!==void 0?e.maxZoom:19,opaque:e.opaque!==void 0?e.opaque:!0,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileLoadFunction:e.tileLoadFunction,transition:e.transition,url:r,wrapX:e.wrapX,zDirection:e.zDirection})}}const VE=$k;class ez{constructor(e,t,i,r,s,o){this.name=e,this.scene=o,this.layers=t,this.target="map2D",this.view=i,this.resolution=r,this.size=s,this.container=this.createContainer(),this.map=this.createOLMap(),this.texture=this.createTexture(),this.context=this.texture.getContext(),this.mesh=this.createMesh();let a=this.createScales();this.scaleLon=l=>a[0](this.map.getPixelFromCoordinate(l)[0]),this.scaleLat=l=>a[1](this.map.getPixelFromCoordinate(l)[1])}createContainer(){let e=document.createElement("div");return e.style.position="fixed",e.style.visibility="hidden",e.style.width=this.resolution.width+"px",e.style.height=this.resolution.height+"px",e.setAttribute("id","map2D"),document.body.appendChild(e),e}createOLMap(){return new bE({pixelRatio:1,layers:this.layers,target:this.target,view:this.view})}createTexture(){let e=this.scene;this.mesh;let t=this.target;this.container;let i=new Uh("mapTexture",{width:this.resolution.width,height:this.resolution.height},e);return this.map.on("postrender",function(){var r=document.getElementById(t),s=r.getElementsByTagName("canvas")[0];i.getContext().drawImage(s,0,0),i.update()}),i}createMesh(){let e=this.resolution.width/this.resolution.height,t=Bt.CreateGround(this.name,{width:this.size*e,height:this.size,subdivisions:25},this.scene),i=new Ws(this.name+"_material",this.scene!=null?this.scene:void 0);return i.diffuseTexture=this.texture,i.specularColor=new _i(0,0,0),t.material=i,t}createScales(){lV();let e=this.resolution.width/this.resolution.height,t=this.size*e,i=this.size,r=Vu().domain([0,this.resolution.width]).range([-(t/2),t/2]),s=Vu().domain([this.resolution.height,0]).range([-(i/2),i/2]);return[r,s]}keyboardControls(e){return e.onKeyboardObservable.add(t=>{switch(t.type){case MR.KEYDOWN:switch(t.event.key){case"a":case"A":this.map.getView().setCenter([this.map.getView().getCenter()[0]-1,this.map.getView().getCenter()[1]]);break;case"d":case"D":this.map.getView().setCenter([this.map.getView().getCenter()[0]+1,this.map.getView().getCenter()[1]]);break;case"w":case"W":this.map.getView().setCenter([this.map.getView().getCenter()[0],this.map.getView().getCenter()[1]+1]);break;case"s":case"S":this.map.getView().setCenter([this.map.getView().getCenter()[0],this.map.getView().getCenter()[1]-1]);break;case"=":case"+":this.map.getView().animate({zoom:this.map.getView().getZoom()+1,duration:250});break;case"-":case"_":this.map.getView().animate({zoom:this.map.getView().getZoom()-1,duration:250});break}break}}),this}}function OG(n,e={},t){const i=e.layers||[new OE({source:new VE})],r=e.view||new $r({center:[0,0],zoom:1}),s=e.mapWidth||2e3,o=e.mapHeight||1e3,a=e.meshSize||50;return new ez(n,i,r,{width:s,height:o},a,t)}class tz{constructor(e,t,i,r,s,o){this.name=e,this.scene=o,this.layers=t,this.target="globe",this.view=i,this.resolution=r,this.diameter=s,this.container=this.createContainer(),this.map=this.createOLMap(),this.texture=this.createTexture(),this.context=this.texture.getContext(),this.mesh=this.createMesh(),this.lonLatToVector3=this.createScales}createContainer(){let e=document.createElement("div");return e.style.position="fixed",e.style.visibility="hidden",e.style.width=this.resolution.x+"px",e.style.height=this.resolution.y+"px",e.setAttribute("id","globe"),document.body.appendChild(e),e}createOLMap(){return new bE({pixelRatio:1,layers:this.layers,target:this.target,view:this.view})}createTexture(){let e=this.scene,t=this.target,i=new Uh("mapTexture",{width:this.resolution.x,height:this.resolution.y},e);return this.map.on("postrender",function(){var r=document.getElementById(t),s=r.getElementsByTagName("canvas")[0];i.getContext().drawImage(s,0,0),i.update()}),i}createMesh(){let e=Bt.CreateSphere(this.name,{diameter:this.diameter},this.scene);e.rotate(Qp.X,Math.PI,Fn.WORLD),e.rotate(Qp.Y,Math.PI,Fn.WORLD);let t=new Ws(this.name+"_material",this.scene);return e.bakeCurrentTransformIntoVertices(),t.diffuseTexture=this.texture,t.specularColor=new _i(0,0,0),e.material=t,e}createScales(e){let t=e[0]*Math.PI/180,i=e[1]*Math.PI/180,r=this.diameter/2,s=r*Math.cos(i)*Math.cos(t),o=r*Math.cos(i)*Math.sin(t),a=r*Math.sin(i);return new _e(s,a,o)}}function DG(n,e={},t){const i=e.layers||[new OE({source:new VE,extent:[-180,-90,180,90]})],r=e.view||new $r({projection:"EPSG:4326",extent:[-180,-90,180,90],center:[0,0],zoom:0}),s=e.resolution||new ua(1e3,500),o=e.diameter||1;return new tz(n,i,r,s,o,t)}class iz{constructor(e,t,i){this.currentLayout=0,this.name=e,this.options=t,this.scene=i,this.root=new ji(this.name,this.scene)}planeLayout(){this.currentLayout=1;let e=this.options.rows||1,t=this.options.margin||new ua(0,0),i=this.options.selection.selected.length,r=this.boundingBoxLocal(this.options.selection),s=r.boundingBox.maximumWorld.x-r.boundingBox.minimumWorld.x,o=r.boundingBox.maximumWorld.y-r.boundingBox.minimumWorld.y,a=this.options.columns||i;return a=i%e==0?i/e:Math.floor(i/e)+1,this.options.selection.selected.forEach((l,h)=>{l.parent=this.root,this.animatePosition(l,new _e(h%a*(s+t.x),Math.floor(h/a)*(o+t.y),0)),this.animateRotation(l,new _e(0,0,0))}),this}cylinderLayout(){this.currentLayout=2;let e=this.options.rows||1,t=this.options.margin||new ua(0,0),i=this.options.selection.selected.length,r=this.boundingBoxLocal(this.options.selection),s=this.options.radius||5,o=r.boundingBox.maximumWorld.x-r.boundingBox.minimumWorld.x,a=r.boundingBox.maximumWorld.y-r.boundingBox.minimumWorld.y,l=this.options.columns||i;l=i%e==0?i/e:Math.floor(i/e)+1;let h=Math.atan(o/2/s)*2,c=new _e(0,0,1);return this.options.selection.selected.forEach((u,d)=>{var f;u.parent=this.root,this.animateRotation(u,new _e(0,0,0));let p=new ji("vect",this.scene);p.position=new _e(0,0,0);let g=Math.floor(d/l),m=d%l;p.rotate(new _e(0,1,0),m*(h+t.x)*Math.PI/180);let x=p.getDirection(c).normalize().multiplyByFloats(s,s,s),E=new _e(x.x,g*(a+t.y),x.z);this.animatePosition(u,E);let R=((f=p.rotationQuaternion)==null?void 0:f.toEulerAngles())||new _e(0,0,0);this.animateRotation(u,R),p.dispose()}),this}sphereLayout(){this.currentLayout=3;let e=this.options.rows||1,t=this.options.margin||new ua(0,0),i=this.options.selection.selected.length,r=this.boundingBoxLocal(this.options.selection),s=this.options.radius||5,o=r.boundingBox.maximumWorld.x-r.boundingBox.minimumWorld.x,a=r.boundingBox.maximumWorld.y-r.boundingBox.minimumWorld.y,l=this.options.columns||i;l=i%e==0?i/e:Math.floor(i/e)+1;let h=Math.atan(o/2/s)*2*180/Math.PI,c=Math.atan(a/2/s)*2*180/Math.PI;return this.options.selection.selected.forEach((u,d)=>{u.parent=this.root;let f=Math.floor(d/l)-Math.floor(e/2),p=d%l-Math.floor(l/2),g=Math.min(f*(h+t.y),360)*Math.PI/180,m=Math.min(Math.abs(90-p*(c+t.x)),180)*Math.PI/180,x=new _e(s*Math.sin(m)*Math.cos(g),s*Math.sin(m)*Math.sin(g),s*Math.cos(m));this.animatePosition(u,x);let E=new _e(-g,m,0);this.animateRotation(u,E)}),this}attr(e,t){switch(e){case"row":this.options.rows=Number(t),this.currentLayout==1&&this.planeLayout(),this.currentLayout==2&&this.cylinderLayout(),this.currentLayout==3&&this.sphereLayout();break;case"margin":let i=t;this.options.margin=i,this.currentLayout==1&&this.planeLayout(),this.currentLayout==2&&this.cylinderLayout(),this.currentLayout==3&&this.sphereLayout();break;case"radius":this.options.radius=Number(t),this.currentLayout==2&&this.cylinderLayout(),this.currentLayout==3&&this.sphereLayout();break}return this}update(){return this.currentLayout==1&&this.planeLayout(),this.currentLayout==2&&this.cylinderLayout(),this.currentLayout==3&&this.sphereLayout(),this}animatePosition(e,t){var i=new As("animationBezierTorus","position",30,As.ANIMATIONTYPE_VECTOR3,As.ANIMATIONLOOPMODE_CONSTANT),r=[];r.push({frame:0,value:e.position}),r.push({frame:20,value:t}),i.setKeys(r);var s=new Yc(.73,0,.31,1);i.setEasingFunction(s),e.animations.length=Math.min(e.animations.length,2),e.animations.push(i),this.scene.beginDirectAnimation(e,[i],0,20,!1)}animateRotation(e,t){let i=[];i.push({frame:0,value:e.rotation}),i.push({frame:20,value:t});let r=new As("","rotation",20,As.ANIMATIONTYPE_VECTOR3,As.ANIMATIONLOOPMODE_CYCLE);r.setKeys(i);var s=new Yc(.73,0,.31,1);r.setEasingFunction(s),this.scene.beginDirectAnimation(e,[r],0,20,!1)}animateScale(e,t){var i=new As("animationBezierTorus","scaling",30,As.ANIMATIONTYPE_VECTOR3,As.ANIMATIONLOOPMODE_CONSTANT),r=[];r.push({frame:0,value:e.scaling}),r.push({frame:10,value:t}),i.setKeys(r);var s=new Yc(.73,0,.31,1);i.setEasingFunction(s),e.animations.length=Math.min(e.animations.length,2),e.animations.push(i),this.scene.beginDirectAnimation(e,[i],0,10,!0)}boundingBoxLocal(e){let t=new _e(0,0,0),i=new _e(0,0,0);return e.selected.forEach((r,s)=>{r.getChildMeshes().forEach((o,a)=>{o.computeWorldMatrix(!0);let l=o.getBoundingInfo().boundingBox.minimumWorld.subtract(r.getAbsolutePosition()),h=o.getBoundingInfo().boundingBox.maximumWorld.subtract(r.getAbsolutePosition());t=_e.Minimize(t,l),i=_e.Maximize(i,h)})}),new Un(t,i)}}function NG(n,e,t){const i={selection:e.selection,rows:e.rows||1,columns:e.columns||e.selection.selected.length,radius:e.radius||5,margin:e.margin||new ua(0,0),order:e.order||[]};return new iz(n,i,t).cylinderLayout()}var BE={exports:{}};/**
 * chroma.js - JavaScript library for color conversions
 *
 * Copyright (c) 2011-2019, Gregor Aisch
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice, this
 * list of conditions and the following disclaimer.
 *
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 * this list of conditions and the following disclaimer in the documentation
 * and/or other materials provided with the distribution.
 *
 * 3. The name Gregor Aisch may not be used to endorse or promote products
 * derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL GREGOR AISCH OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,
 * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
 * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,
 * EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * -------------------------------------------------------
 *
 * chroma.js includes colors from colorbrewer2.org, which are released under
 * the following license:
 *
 * Copyright (c) 2002 Cynthia Brewer, Mark Harrower,
 * and The Pennsylvania State University.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,
 * either express or implied. See the License for the specific
 * language governing permissions and limitations under the License.
 *
 * ------------------------------------------------------
 *
 * Named colors are taken from X11 Color Names.
 * http://www.w3.org/TR/css3-color/#svg-color
 *
 * @preserve
 */(function(n,e){(function(t,i){n.exports=i()})(Qk,function(){for(var t=function(S,A,O){return A===void 0&&(A=0),O===void 0&&(O=1),S<A?A:S>O?O:S},i=t,r=function(S){S._clipped=!1,S._unclipped=S.slice(0);for(var A=0;A<=3;A++)A<3?((S[A]<0||S[A]>255)&&(S._clipped=!0),S[A]=i(S[A],0,255)):A===3&&(S[A]=i(S[A],0,1));return S},s={},o=0,a=["Boolean","Number","String","Function","Array","Date","RegExp","Undefined","Null"];o<a.length;o+=1){var l=a[o];s["[object "+l+"]"]=l.toLowerCase()}var h=function(S){return s[Object.prototype.toString.call(S)]||"object"},c=h,u=function(S,A){return A===void 0&&(A=null),S.length>=3?Array.prototype.slice.call(S):c(S[0])=="object"&&A?A.split("").filter(function(O){return S[0][O]!==void 0}).map(function(O){return S[0][O]}):S[0]},d=h,f=function(S){if(S.length<2)return null;var A=S.length-1;return d(S[A])=="string"?S[A].toLowerCase():null},p=Math.PI,g={clip_rgb:r,limit:t,type:h,unpack:u,last:f,PI:p,TWOPI:p*2,PITHIRD:p/3,DEG2RAD:p/180,RAD2DEG:180/p},m={format:{},autodetect:[]},x=g.last,E=g.clip_rgb,R=g.type,C=m,_=function(){for(var S=[],A=arguments.length;A--;)S[A]=arguments[A];var O=this;if(R(S[0])==="object"&&S[0].constructor&&S[0].constructor===this.constructor)return S[0];var B=x(S),K=!1;if(!B){K=!0,C.sorted||(C.autodetect=C.autodetect.sort(function(pe,Ce){return Ce.p-pe.p}),C.sorted=!0);for(var q=0,X=C.autodetect;q<X.length;q+=1){var Q=X[q];if(B=Q.test.apply(Q,S),B)break}}if(C.format[B]){var ee=C.format[B].apply(null,K?S:S.slice(0,-1));O._rgb=E(ee)}else throw new Error("unknown format: "+S);O._rgb.length===3&&O._rgb.push(1)};_.prototype.toString=function(){return R(this.hex)=="function"?this.hex():"["+this._rgb.join(",")+"]"};var T=_,y=function(){for(var S=[],A=arguments.length;A--;)S[A]=arguments[A];return new(Function.prototype.bind.apply(y.Color,[null].concat(S)))};y.Color=T,y.version="2.4.2";var P=y,D=g.unpack,F=Math.max,N=function(){for(var S=[],A=arguments.length;A--;)S[A]=arguments[A];var O=D(S,"rgb"),B=O[0],K=O[1],q=O[2];B=B/255,K=K/255,q=q/255;var X=1-F(B,F(K,q)),Q=X<1?1/(1-X):0,ee=(1-B-X)*Q,pe=(1-K-X)*Q,Ce=(1-q-X)*Q;return[ee,pe,Ce,X]},G=N,J=g.unpack,j=function(){for(var S=[],A=arguments.length;A--;)S[A]=arguments[A];S=J(S,"cmyk");var O=S[0],B=S[1],K=S[2],q=S[3],X=S.length>4?S[4]:1;return q===1?[0,0,0,X]:[O>=1?0:255*(1-O)*(1-q),B>=1?0:255*(1-B)*(1-q),K>=1?0:255*(1-K)*(1-q),X]},z=j,$=P,te=T,fe=m,Z=g.unpack,L=g.type,w=G;te.prototype.cmyk=function(){return w(this._rgb)},$.cmyk=function(){for(var S=[],A=arguments.length;A--;)S[A]=arguments[A];return new(Function.prototype.bind.apply(te,[null].concat(S,["cmyk"])))},fe.format.cmyk=z,fe.autodetect.push({p:2,test:function(){for(var S=[],A=arguments.length;A--;)S[A]=arguments[A];if(S=Z(S,"cmyk"),L(S)==="array"&&S.length===4)return"cmyk"}});var H=g.unpack,de=g.last,Te=function(S){return Math.round(S*100)/100},Ne=function(){for(var S=[],A=arguments.length;A--;)S[A]=arguments[A];var O=H(S,"hsla"),B=de(S)||"lsa";return O[0]=Te(O[0]||0),O[1]=Te(O[1]*100)+"%",O[2]=Te(O[2]*100)+"%",B==="hsla"||O.length>3&&O[3]<1?(O[3]=O.length>3?O[3]:1,B="hsla"):O.length=3,B+"("+O.join(",")+")"},Fe=Ne,ce=g.unpack,ve=function(){for(var S=[],A=arguments.length;A--;)S[A]=arguments[A];S=ce(S,"rgba");var O=S[0],B=S[1],K=S[2];O/=255,B/=255,K/=255;var q=Math.min(O,B,K),X=Math.max(O,B,K),Q=(X+q)/2,ee,pe;return X===q?(ee=0,pe=Number.NaN):ee=Q<.5?(X-q)/(X+q):(X-q)/(2-X-q),O==X?pe=(B-K)/(X-q):B==X?pe=2+(K-O)/(X-q):K==X&&(pe=4+(O-B)/(X-q)),pe*=60,pe<0&&(pe+=360),S.length>3&&S[3]!==void 0?[pe,ee,Q,S[3]]:[pe,ee,Q]},Ue=ve,Se=g.unpack,ue=g.last,Ze=Fe,_t=Ue,vt=Math.round,Ot=function(){for(var S=[],A=arguments.length;A--;)S[A]=arguments[A];var O=Se(S,"rgba"),B=ue(S)||"rgb";return B.substr(0,3)=="hsl"?Ze(_t(O),B):(O[0]=vt(O[0]),O[1]=vt(O[1]),O[2]=vt(O[2]),(B==="rgba"||O.length>3&&O[3]<1)&&(O[3]=O.length>3?O[3]:1,B="rgba"),B+"("+O.slice(0,B==="rgb"?3:4).join(",")+")")},$t=Ot,Ii=g.unpack,Gi=Math.round,rs=function(){for(var S,A=[],O=arguments.length;O--;)A[O]=arguments[O];A=Ii(A,"hsl");var B=A[0],K=A[1],q=A[2],X,Q,ee;if(K===0)X=Q=ee=q*255;else{var pe=[0,0,0],Ce=[0,0,0],Be=q<.5?q*(1+K):q+K-q*K,be=2*q-Be,We=B/360;pe[0]=We+1/3,pe[1]=We,pe[2]=We-1/3;for(var Xe=0;Xe<3;Xe++)pe[Xe]<0&&(pe[Xe]+=1),pe[Xe]>1&&(pe[Xe]-=1),6*pe[Xe]<1?Ce[Xe]=be+(Be-be)*6*pe[Xe]:2*pe[Xe]<1?Ce[Xe]=Be:3*pe[Xe]<2?Ce[Xe]=be+(Be-be)*(2/3-pe[Xe])*6:Ce[Xe]=be;S=[Gi(Ce[0]*255),Gi(Ce[1]*255),Gi(Ce[2]*255)],X=S[0],Q=S[1],ee=S[2]}return A.length>3?[X,Q,ee,A[3]]:[X,Q,ee,1]},ss=rs,Wi=ss,Xi=m,ns=/^rgb\(\s*(-?\d+),\s*(-?\d+)\s*,\s*(-?\d+)\s*\)$/,Ir=/^rgba\(\s*(-?\d+),\s*(-?\d+)\s*,\s*(-?\d+)\s*,\s*([01]|[01]?\.\d+)\)$/,Ss=/^rgb\(\s*(-?\d+(?:\.\d+)?)%,\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*\)$/,ys=/^rgba\(\s*(-?\d+(?:\.\d+)?)%,\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)$/,os=/^hsl\(\s*(-?\d+(?:\.\d+)?),\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*\)$/,Tr=/^hsla\(\s*(-?\d+(?:\.\d+)?),\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)$/,Ys=Math.round,Di=function(S){S=S.toLowerCase().trim();var A;if(Xi.format.named)try{return Xi.format.named(S)}catch{}if(A=S.match(ns)){for(var O=A.slice(1,4),B=0;B<3;B++)O[B]=+O[B];return O[3]=1,O}if(A=S.match(Ir)){for(var K=A.slice(1,5),q=0;q<4;q++)K[q]=+K[q];return K}if(A=S.match(Ss)){for(var X=A.slice(1,4),Q=0;Q<3;Q++)X[Q]=Ys(X[Q]*2.55);return X[3]=1,X}if(A=S.match(ys)){for(var ee=A.slice(1,5),pe=0;pe<3;pe++)ee[pe]=Ys(ee[pe]*2.55);return ee[3]=+ee[3],ee}if(A=S.match(os)){var Ce=A.slice(1,4);Ce[1]*=.01,Ce[2]*=.01;var Be=Wi(Ce);return Be[3]=1,Be}if(A=S.match(Tr)){var be=A.slice(1,4);be[1]*=.01,be[2]*=.01;var We=Wi(be);return We[3]=+A[4],We}};Di.test=function(S){return ns.test(S)||Ir.test(S)||Ss.test(S)||ys.test(S)||os.test(S)||Tr.test(S)};var $o=Di,ll=P,ea=T,as=m,Kn=g.type,xr=$t,Zs=$o;ea.prototype.css=function(S){return xr(this._rgb,S)},ll.css=function(){for(var S=[],A=arguments.length;A--;)S[A]=arguments[A];return new(Function.prototype.bind.apply(ea,[null].concat(S,["css"])))},as.format.css=Zs,as.autodetect.push({p:5,test:function(S){for(var A=[],O=arguments.length-1;O-- >0;)A[O]=arguments[O+1];if(!A.length&&Kn(S)==="string"&&Zs.test(S))return"css"}});var wf=T,iT=P,rT=m,sT=g.unpack;rT.format.gl=function(){for(var S=[],A=arguments.length;A--;)S[A]=arguments[A];var O=sT(S,"rgba");return O[0]*=255,O[1]*=255,O[2]*=255,O},iT.gl=function(){for(var S=[],A=arguments.length;A--;)S[A]=arguments[A];return new(Function.prototype.bind.apply(wf,[null].concat(S,["gl"])))},wf.prototype.gl=function(){var S=this._rgb;return[S[0]/255,S[1]/255,S[2]/255,S[3]]};var nT=g.unpack,oT=function(){for(var S=[],A=arguments.length;A--;)S[A]=arguments[A];var O=nT(S,"rgb"),B=O[0],K=O[1],q=O[2],X=Math.min(B,K,q),Q=Math.max(B,K,q),ee=Q-X,pe=ee*100/255,Ce=X/(255-ee)*100,Be;return ee===0?Be=Number.NaN:(B===Q&&(Be=(K-q)/ee),K===Q&&(Be=2+(q-B)/ee),q===Q&&(Be=4+(B-K)/ee),Be*=60,Be<0&&(Be+=360)),[Be,pe,Ce]},aT=oT,lT=g.unpack,hT=Math.floor,cT=function(){for(var S,A,O,B,K,q,X=[],Q=arguments.length;Q--;)X[Q]=arguments[Q];X=lT(X,"hcg");var ee=X[0],pe=X[1],Ce=X[2],Be,be,We;Ce=Ce*255;var Xe=pe*255;if(pe===0)Be=be=We=Ce;else{ee===360&&(ee=0),ee>360&&(ee-=360),ee<0&&(ee+=360),ee/=60;var ct=hT(ee),Et=ee-ct,bt=Ce*(1-pe),Ft=bt+Xe*(1-Et),Hi=bt+Xe*Et,Fi=bt+Xe;switch(ct){case 0:S=[Fi,Hi,bt],Be=S[0],be=S[1],We=S[2];break;case 1:A=[Ft,Fi,bt],Be=A[0],be=A[1],We=A[2];break;case 2:O=[bt,Fi,Hi],Be=O[0],be=O[1],We=O[2];break;case 3:B=[bt,Ft,Fi],Be=B[0],be=B[1],We=B[2];break;case 4:K=[Hi,bt,Fi],Be=K[0],be=K[1],We=K[2];break;case 5:q=[Fi,bt,Ft],Be=q[0],be=q[1],We=q[2];break}}return[Be,be,We,X.length>3?X[3]:1]},uT=cT,dT=g.unpack,fT=g.type,pT=P,Uf=T,Vf=m,gT=aT;Uf.prototype.hcg=function(){return gT(this._rgb)},pT.hcg=function(){for(var S=[],A=arguments.length;A--;)S[A]=arguments[A];return new(Function.prototype.bind.apply(Uf,[null].concat(S,["hcg"])))},Vf.format.hcg=uT,Vf.autodetect.push({p:1,test:function(){for(var S=[],A=arguments.length;A--;)S[A]=arguments[A];if(S=dT(S,"hcg"),fT(S)==="array"&&S.length===3)return"hcg"}});var mT=g.unpack,_T=g.last,hl=Math.round,vT=function(){for(var S=[],A=arguments.length;A--;)S[A]=arguments[A];var O=mT(S,"rgba"),B=O[0],K=O[1],q=O[2],X=O[3],Q=_T(S)||"auto";X===void 0&&(X=1),Q==="auto"&&(Q=X<1?"rgba":"rgb"),B=hl(B),K=hl(K),q=hl(q);var ee=B<<16|K<<8|q,pe="000000"+ee.toString(16);pe=pe.substr(pe.length-6);var Ce="0"+hl(X*255).toString(16);switch(Ce=Ce.substr(Ce.length-2),Q.toLowerCase()){case"rgba":return"#"+pe+Ce;case"argb":return"#"+Ce+pe;default:return"#"+pe}},Bf=vT,ET=/^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/,TT=/^#?([A-Fa-f0-9]{8}|[A-Fa-f0-9]{4})$/,xT=function(S){if(S.match(ET)){(S.length===4||S.length===7)&&(S=S.substr(1)),S.length===3&&(S=S.split(""),S=S[0]+S[0]+S[1]+S[1]+S[2]+S[2]);var A=parseInt(S,16),O=A>>16,B=A>>8&255,K=A&255;return[O,B,K,1]}if(S.match(TT)){(S.length===5||S.length===9)&&(S=S.substr(1)),S.length===4&&(S=S.split(""),S=S[0]+S[0]+S[1]+S[1]+S[2]+S[2]+S[3]+S[3]);var q=parseInt(S,16),X=q>>24&255,Q=q>>16&255,ee=q>>8&255,pe=Math.round((q&255)/255*100)/100;return[X,Q,ee,pe]}throw new Error("unknown hex color: "+S)},kf=xT,CT=P,zf=T,RT=g.type,Gf=m,ST=Bf;zf.prototype.hex=function(S){return ST(this._rgb,S)},CT.hex=function(){for(var S=[],A=arguments.length;A--;)S[A]=arguments[A];return new(Function.prototype.bind.apply(zf,[null].concat(S,["hex"])))},Gf.format.hex=kf,Gf.autodetect.push({p:4,test:function(S){for(var A=[],O=arguments.length-1;O-- >0;)A[O]=arguments[O+1];if(!A.length&&RT(S)==="string"&&[3,4,5,6,7,8,9].indexOf(S.length)>=0)return"hex"}});var yT=g.unpack,Wf=g.TWOPI,bT=Math.min,IT=Math.sqrt,AT=Math.acos,MT=function(){for(var S=[],A=arguments.length;A--;)S[A]=arguments[A];var O=yT(S,"rgb"),B=O[0],K=O[1],q=O[2];B/=255,K/=255,q/=255;var X,Q=bT(B,K,q),ee=(B+K+q)/3,pe=ee>0?1-Q/ee:0;return pe===0?X=NaN:(X=(B-K+(B-q))/2,X/=IT((B-K)*(B-K)+(B-q)*(K-q)),X=AT(X),q>K&&(X=Wf-X),X/=Wf),[X*360,pe,ee]},PT=MT,OT=g.unpack,xc=g.limit,qn=g.TWOPI,Cc=g.PITHIRD,Yn=Math.cos,DT=function(){for(var S=[],A=arguments.length;A--;)S[A]=arguments[A];S=OT(S,"hsi");var O=S[0],B=S[1],K=S[2],q,X,Q;return isNaN(O)&&(O=0),isNaN(B)&&(B=0),O>360&&(O-=360),O<0&&(O+=360),O/=360,O<1/3?(Q=(1-B)/3,q=(1+B*Yn(qn*O)/Yn(Cc-qn*O))/3,X=1-(Q+q)):O<2/3?(O-=1/3,q=(1-B)/3,X=(1+B*Yn(qn*O)/Yn(Cc-qn*O))/3,Q=1-(q+X)):(O-=2/3,X=(1-B)/3,Q=(1+B*Yn(qn*O)/Yn(Cc-qn*O))/3,q=1-(X+Q)),q=xc(K*q*3),X=xc(K*X*3),Q=xc(K*Q*3),[q*255,X*255,Q*255,S.length>3?S[3]:1]},NT=DT,FT=g.unpack,LT=g.type,wT=P,Xf=T,Hf=m,UT=PT;Xf.prototype.hsi=function(){return UT(this._rgb)},wT.hsi=function(){for(var S=[],A=arguments.length;A--;)S[A]=arguments[A];return new(Function.prototype.bind.apply(Xf,[null].concat(S,["hsi"])))},Hf.format.hsi=NT,Hf.autodetect.push({p:2,test:function(){for(var S=[],A=arguments.length;A--;)S[A]=arguments[A];if(S=FT(S,"hsi"),LT(S)==="array"&&S.length===3)return"hsi"}});var VT=g.unpack,BT=g.type,kT=P,Kf=T,qf=m,zT=Ue;Kf.prototype.hsl=function(){return zT(this._rgb)},kT.hsl=function(){for(var S=[],A=arguments.length;A--;)S[A]=arguments[A];return new(Function.prototype.bind.apply(Kf,[null].concat(S,["hsl"])))},qf.format.hsl=ss,qf.autodetect.push({p:2,test:function(){for(var S=[],A=arguments.length;A--;)S[A]=arguments[A];if(S=VT(S,"hsl"),BT(S)==="array"&&S.length===3)return"hsl"}});var GT=g.unpack,WT=Math.min,XT=Math.max,HT=function(){for(var S=[],A=arguments.length;A--;)S[A]=arguments[A];S=GT(S,"rgb");var O=S[0],B=S[1],K=S[2],q=WT(O,B,K),X=XT(O,B,K),Q=X-q,ee,pe,Ce;return Ce=X/255,X===0?(ee=Number.NaN,pe=0):(pe=Q/X,O===X&&(ee=(B-K)/Q),B===X&&(ee=2+(K-O)/Q),K===X&&(ee=4+(O-B)/Q),ee*=60,ee<0&&(ee+=360)),[ee,pe,Ce]},KT=HT,qT=g.unpack,YT=Math.floor,ZT=function(){for(var S,A,O,B,K,q,X=[],Q=arguments.length;Q--;)X[Q]=arguments[Q];X=qT(X,"hsv");var ee=X[0],pe=X[1],Ce=X[2],Be,be,We;if(Ce*=255,pe===0)Be=be=We=Ce;else{ee===360&&(ee=0),ee>360&&(ee-=360),ee<0&&(ee+=360),ee/=60;var Xe=YT(ee),ct=ee-Xe,Et=Ce*(1-pe),bt=Ce*(1-pe*ct),Ft=Ce*(1-pe*(1-ct));switch(Xe){case 0:S=[Ce,Ft,Et],Be=S[0],be=S[1],We=S[2];break;case 1:A=[bt,Ce,Et],Be=A[0],be=A[1],We=A[2];break;case 2:O=[Et,Ce,Ft],Be=O[0],be=O[1],We=O[2];break;case 3:B=[Et,bt,Ce],Be=B[0],be=B[1],We=B[2];break;case 4:K=[Ft,Et,Ce],Be=K[0],be=K[1],We=K[2];break;case 5:q=[Ce,Et,bt],Be=q[0],be=q[1],We=q[2];break}}return[Be,be,We,X.length>3?X[3]:1]},jT=ZT,QT=g.unpack,JT=g.type,$T=P,Yf=T,Zf=m,ex=KT;Yf.prototype.hsv=function(){return ex(this._rgb)},$T.hsv=function(){for(var S=[],A=arguments.length;A--;)S[A]=arguments[A];return new(Function.prototype.bind.apply(Yf,[null].concat(S,["hsv"])))},Zf.format.hsv=jT,Zf.autodetect.push({p:2,test:function(){for(var S=[],A=arguments.length;A--;)S[A]=arguments[A];if(S=QT(S,"hsv"),JT(S)==="array"&&S.length===3)return"hsv"}});var cl={Kn:18,Xn:.95047,Yn:1,Zn:1.08883,t0:.137931034,t1:.206896552,t2:.12841855,t3:.008856452},Zn=cl,tx=g.unpack,jf=Math.pow,ix=function(){for(var S=[],A=arguments.length;A--;)S[A]=arguments[A];var O=tx(S,"rgb"),B=O[0],K=O[1],q=O[2],X=rx(B,K,q),Q=X[0],ee=X[1],pe=X[2],Ce=116*ee-16;return[Ce<0?0:Ce,500*(Q-ee),200*(ee-pe)]},Rc=function(S){return(S/=255)<=.04045?S/12.92:jf((S+.055)/1.055,2.4)},Sc=function(S){return S>Zn.t3?jf(S,1/3):S/Zn.t2+Zn.t0},rx=function(S,A,O){S=Rc(S),A=Rc(A),O=Rc(O);var B=Sc((.4124564*S+.3575761*A+.1804375*O)/Zn.Xn),K=Sc((.2126729*S+.7151522*A+.072175*O)/Zn.Yn),q=Sc((.0193339*S+.119192*A+.9503041*O)/Zn.Zn);return[B,K,q]},Qf=ix,jn=cl,sx=g.unpack,nx=Math.pow,ox=function(){for(var S=[],A=arguments.length;A--;)S[A]=arguments[A];S=sx(S,"lab");var O=S[0],B=S[1],K=S[2],q,X,Q,ee,pe,Ce;return X=(O+16)/116,q=isNaN(B)?X:X+B/500,Q=isNaN(K)?X:X-K/200,X=jn.Yn*bc(X),q=jn.Xn*bc(q),Q=jn.Zn*bc(Q),ee=yc(3.2404542*q-1.5371385*X-.4985314*Q),pe=yc(-.969266*q+1.8760108*X+.041556*Q),Ce=yc(.0556434*q-.2040259*X+1.0572252*Q),[ee,pe,Ce,S.length>3?S[3]:1]},yc=function(S){return 255*(S<=.00304?12.92*S:1.055*nx(S,1/2.4)-.055)},bc=function(S){return S>jn.t1?S*S*S:jn.t2*(S-jn.t0)},Jf=ox,ax=g.unpack,lx=g.type,hx=P,$f=T,ep=m,cx=Qf;$f.prototype.lab=function(){return cx(this._rgb)},hx.lab=function(){for(var S=[],A=arguments.length;A--;)S[A]=arguments[A];return new(Function.prototype.bind.apply($f,[null].concat(S,["lab"])))},ep.format.lab=Jf,ep.autodetect.push({p:2,test:function(){for(var S=[],A=arguments.length;A--;)S[A]=arguments[A];if(S=ax(S,"lab"),lx(S)==="array"&&S.length===3)return"lab"}});var ux=g.unpack,dx=g.RAD2DEG,fx=Math.sqrt,px=Math.atan2,gx=Math.round,mx=function(){for(var S=[],A=arguments.length;A--;)S[A]=arguments[A];var O=ux(S,"lab"),B=O[0],K=O[1],q=O[2],X=fx(K*K+q*q),Q=(px(q,K)*dx+360)%360;return gx(X*1e4)===0&&(Q=Number.NaN),[B,X,Q]},tp=mx,_x=g.unpack,vx=Qf,Ex=tp,Tx=function(){for(var S=[],A=arguments.length;A--;)S[A]=arguments[A];var O=_x(S,"rgb"),B=O[0],K=O[1],q=O[2],X=vx(B,K,q),Q=X[0],ee=X[1],pe=X[2];return Ex(Q,ee,pe)},xx=Tx,Cx=g.unpack,Rx=g.DEG2RAD,Sx=Math.sin,yx=Math.cos,bx=function(){for(var S=[],A=arguments.length;A--;)S[A]=arguments[A];var O=Cx(S,"lch"),B=O[0],K=O[1],q=O[2];return isNaN(q)&&(q=0),q=q*Rx,[B,yx(q)*K,Sx(q)*K]},ip=bx,Ix=g.unpack,Ax=ip,Mx=Jf,Px=function(){for(var S=[],A=arguments.length;A--;)S[A]=arguments[A];S=Ix(S,"lch");var O=S[0],B=S[1],K=S[2],q=Ax(O,B,K),X=q[0],Q=q[1],ee=q[2],pe=Mx(X,Q,ee),Ce=pe[0],Be=pe[1],be=pe[2];return[Ce,Be,be,S.length>3?S[3]:1]},rp=Px,Ox=g.unpack,Dx=rp,Nx=function(){for(var S=[],A=arguments.length;A--;)S[A]=arguments[A];var O=Ox(S,"hcl").reverse();return Dx.apply(void 0,O)},Fx=Nx,Lx=g.unpack,wx=g.type,sp=P,ul=T,Ic=m,np=xx;ul.prototype.lch=function(){return np(this._rgb)},ul.prototype.hcl=function(){return np(this._rgb).reverse()},sp.lch=function(){for(var S=[],A=arguments.length;A--;)S[A]=arguments[A];return new(Function.prototype.bind.apply(ul,[null].concat(S,["lch"])))},sp.hcl=function(){for(var S=[],A=arguments.length;A--;)S[A]=arguments[A];return new(Function.prototype.bind.apply(ul,[null].concat(S,["hcl"])))},Ic.format.lch=rp,Ic.format.hcl=Fx,["lch","hcl"].forEach(function(S){return Ic.autodetect.push({p:2,test:function(){for(var A=[],O=arguments.length;O--;)A[O]=arguments[O];if(A=Lx(A,S),wx(A)==="array"&&A.length===3)return S}})});var Ux={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflower:"#6495ed",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",laserlemon:"#ffff54",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrod:"#fafad2",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",maroon2:"#7f0000",maroon3:"#b03060",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",purple2:"#7f007f",purple3:"#a020f0",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},op=Ux,Vx=T,ap=m,Bx=g.type,ta=op,kx=kf,zx=Bf;Vx.prototype.name=function(){for(var S=zx(this._rgb,"rgb"),A=0,O=Object.keys(ta);A<O.length;A+=1){var B=O[A];if(ta[B]===S)return B.toLowerCase()}return S},ap.format.named=function(S){if(S=S.toLowerCase(),ta[S])return kx(ta[S]);throw new Error("unknown color name: "+S)},ap.autodetect.push({p:5,test:function(S){for(var A=[],O=arguments.length-1;O-- >0;)A[O]=arguments[O+1];if(!A.length&&Bx(S)==="string"&&ta[S.toLowerCase()])return"named"}});var Gx=g.unpack,Wx=function(){for(var S=[],A=arguments.length;A--;)S[A]=arguments[A];var O=Gx(S,"rgb"),B=O[0],K=O[1],q=O[2];return(B<<16)+(K<<8)+q},Xx=Wx,Hx=g.type,Kx=function(S){if(Hx(S)=="number"&&S>=0&&S<=16777215){var A=S>>16,O=S>>8&255,B=S&255;return[A,O,B,1]}throw new Error("unknown num color: "+S)},qx=Kx,Yx=P,lp=T,hp=m,Zx=g.type,jx=Xx;lp.prototype.num=function(){return jx(this._rgb)},Yx.num=function(){for(var S=[],A=arguments.length;A--;)S[A]=arguments[A];return new(Function.prototype.bind.apply(lp,[null].concat(S,["num"])))},hp.format.num=qx,hp.autodetect.push({p:5,test:function(){for(var S=[],A=arguments.length;A--;)S[A]=arguments[A];if(S.length===1&&Zx(S[0])==="number"&&S[0]>=0&&S[0]<=16777215)return"num"}});var Qx=P,Ac=T,cp=m,up=g.unpack,dp=g.type,fp=Math.round;Ac.prototype.rgb=function(S){return S===void 0&&(S=!0),S===!1?this._rgb.slice(0,3):this._rgb.slice(0,3).map(fp)},Ac.prototype.rgba=function(S){return S===void 0&&(S=!0),this._rgb.slice(0,4).map(function(A,O){return O<3?S===!1?A:fp(A):A})},Qx.rgb=function(){for(var S=[],A=arguments.length;A--;)S[A]=arguments[A];return new(Function.prototype.bind.apply(Ac,[null].concat(S,["rgb"])))},cp.format.rgb=function(){for(var S=[],A=arguments.length;A--;)S[A]=arguments[A];var O=up(S,"rgba");return O[3]===void 0&&(O[3]=1),O},cp.autodetect.push({p:3,test:function(){for(var S=[],A=arguments.length;A--;)S[A]=arguments[A];if(S=up(S,"rgba"),dp(S)==="array"&&(S.length===3||S.length===4&&dp(S[3])=="number"&&S[3]>=0&&S[3]<=1))return"rgb"}});var dl=Math.log,Jx=function(S){var A=S/100,O,B,K;return A<66?(O=255,B=A<6?0:-155.25485562709179-.44596950469579133*(B=A-2)+104.49216199393888*dl(B),K=A<20?0:-254.76935184120902+.8274096064007395*(K=A-10)+115.67994401066147*dl(K)):(O=351.97690566805693+.114206453784165*(O=A-55)-40.25366309332127*dl(O),B=325.4494125711974+.07943456536662342*(B=A-50)-28.0852963507957*dl(B),K=255),[O,B,K,1]},pp=Jx,$x=pp,e1=g.unpack,t1=Math.round,i1=function(){for(var S=[],A=arguments.length;A--;)S[A]=arguments[A];for(var O=e1(S,"rgb"),B=O[0],K=O[2],q=1e3,X=4e4,Q=.4,ee;X-q>Q;){ee=(X+q)*.5;var pe=$x(ee);pe[2]/pe[0]>=K/B?X=ee:q=ee}return t1(ee)},r1=i1,Mc=P,fl=T,Pc=m,s1=r1;fl.prototype.temp=fl.prototype.kelvin=fl.prototype.temperature=function(){return s1(this._rgb)},Mc.temp=Mc.kelvin=Mc.temperature=function(){for(var S=[],A=arguments.length;A--;)S[A]=arguments[A];return new(Function.prototype.bind.apply(fl,[null].concat(S,["temp"])))},Pc.format.temp=Pc.format.kelvin=Pc.format.temperature=pp;var n1=g.unpack,Oc=Math.cbrt,o1=Math.pow,a1=Math.sign,l1=function(){for(var S=[],A=arguments.length;A--;)S[A]=arguments[A];var O=n1(S,"rgb"),B=O[0],K=O[1],q=O[2],X=[Dc(B/255),Dc(K/255),Dc(q/255)],Q=X[0],ee=X[1],pe=X[2],Ce=Oc(.4122214708*Q+.5363325363*ee+.0514459929*pe),Be=Oc(.2119034982*Q+.6806995451*ee+.1073969566*pe),be=Oc(.0883024619*Q+.2817188376*ee+.6299787005*pe);return[.2104542553*Ce+.793617785*Be-.0040720468*be,1.9779984951*Ce-2.428592205*Be+.4505937099*be,.0259040371*Ce+.7827717662*Be-.808675766*be]},gp=l1;function Dc(S){var A=Math.abs(S);return A<.04045?S/12.92:(a1(S)||1)*o1((A+.055)/1.055,2.4)}var h1=g.unpack,pl=Math.pow,c1=Math.sign,u1=function(){for(var S=[],A=arguments.length;A--;)S[A]=arguments[A];S=h1(S,"lab");var O=S[0],B=S[1],K=S[2],q=pl(O+.3963377774*B+.2158037573*K,3),X=pl(O-.1055613458*B-.0638541728*K,3),Q=pl(O-.0894841775*B-1.291485548*K,3);return[255*Nc(4.0767416621*q-3.3077115913*X+.2309699292*Q),255*Nc(-1.2684380046*q+2.6097574011*X-.3413193965*Q),255*Nc(-.0041960863*q-.7034186147*X+1.707614701*Q),S.length>3?S[3]:1]},mp=u1;function Nc(S){var A=Math.abs(S);return A>.0031308?(c1(S)||1)*(1.055*pl(A,1/2.4)-.055):S*12.92}var d1=g.unpack,f1=g.type,p1=P,_p=T,vp=m,g1=gp;_p.prototype.oklab=function(){return g1(this._rgb)},p1.oklab=function(){for(var S=[],A=arguments.length;A--;)S[A]=arguments[A];return new(Function.prototype.bind.apply(_p,[null].concat(S,["oklab"])))},vp.format.oklab=mp,vp.autodetect.push({p:3,test:function(){for(var S=[],A=arguments.length;A--;)S[A]=arguments[A];if(S=d1(S,"oklab"),f1(S)==="array"&&S.length===3)return"oklab"}});var m1=g.unpack,_1=gp,v1=tp,E1=function(){for(var S=[],A=arguments.length;A--;)S[A]=arguments[A];var O=m1(S,"rgb"),B=O[0],K=O[1],q=O[2],X=_1(B,K,q),Q=X[0],ee=X[1],pe=X[2];return v1(Q,ee,pe)},T1=E1,x1=g.unpack,C1=ip,R1=mp,S1=function(){for(var S=[],A=arguments.length;A--;)S[A]=arguments[A];S=x1(S,"lch");var O=S[0],B=S[1],K=S[2],q=C1(O,B,K),X=q[0],Q=q[1],ee=q[2],pe=R1(X,Q,ee),Ce=pe[0],Be=pe[1],be=pe[2];return[Ce,Be,be,S.length>3?S[3]:1]},y1=S1,b1=g.unpack,I1=g.type,A1=P,Ep=T,Tp=m,M1=T1;Ep.prototype.oklch=function(){return M1(this._rgb)},A1.oklch=function(){for(var S=[],A=arguments.length;A--;)S[A]=arguments[A];return new(Function.prototype.bind.apply(Ep,[null].concat(S,["oklch"])))},Tp.format.oklch=y1,Tp.autodetect.push({p:3,test:function(){for(var S=[],A=arguments.length;A--;)S[A]=arguments[A];if(S=b1(S,"oklch"),I1(S)==="array"&&S.length===3)return"oklch"}});var xp=T,P1=g.type;xp.prototype.alpha=function(S,A){return A===void 0&&(A=!1),S!==void 0&&P1(S)==="number"?A?(this._rgb[3]=S,this):new xp([this._rgb[0],this._rgb[1],this._rgb[2],S],"rgb"):this._rgb[3]};var O1=T;O1.prototype.clipped=function(){return this._rgb._clipped||!1};var xn=T,D1=cl;xn.prototype.darken=function(S){S===void 0&&(S=1);var A=this,O=A.lab();return O[0]-=D1.Kn*S,new xn(O,"lab").alpha(A.alpha(),!0)},xn.prototype.brighten=function(S){return S===void 0&&(S=1),this.darken(-S)},xn.prototype.darker=xn.prototype.darken,xn.prototype.brighter=xn.prototype.brighten;var N1=T;N1.prototype.get=function(S){var A=S.split("."),O=A[0],B=A[1],K=this[O]();if(B){var q=O.indexOf(B)-(O.substr(0,2)==="ok"?2:0);if(q>-1)return K[q];throw new Error("unknown channel "+B+" in mode "+O)}else return K};var Qn=T,F1=g.type,L1=Math.pow,w1=1e-7,U1=20;Qn.prototype.luminance=function(S){if(S!==void 0&&F1(S)==="number"){if(S===0)return new Qn([0,0,0,this._rgb[3]],"rgb");if(S===1)return new Qn([255,255,255,this._rgb[3]],"rgb");var A=this.luminance(),O="rgb",B=U1,K=function(X,Q){var ee=X.interpolate(Q,.5,O),pe=ee.luminance();return Math.abs(S-pe)<w1||!B--?ee:pe>S?K(X,ee):K(ee,Q)},q=(A>S?K(new Qn([0,0,0]),this):K(this,new Qn([255,255,255]))).rgb();return new Qn(q.concat([this._rgb[3]]))}return V1.apply(void 0,this._rgb.slice(0,3))};var V1=function(S,A,O){return S=Fc(S),A=Fc(A),O=Fc(O),.2126*S+.7152*A+.0722*O},Fc=function(S){return S/=255,S<=.03928?S/12.92:L1((S+.055)/1.055,2.4)},Cr={},Cp=T,Rp=g.type,gl=Cr,Sp=function(S,A,O){O===void 0&&(O=.5);for(var B=[],K=arguments.length-3;K-- >0;)B[K]=arguments[K+3];var q=B[0]||"lrgb";if(!gl[q]&&!B.length&&(q=Object.keys(gl)[0]),!gl[q])throw new Error("interpolation mode "+q+" is not defined");return Rp(S)!=="object"&&(S=new Cp(S)),Rp(A)!=="object"&&(A=new Cp(A)),gl[q](S,A,O).alpha(S.alpha()+O*(A.alpha()-S.alpha()))},yp=T,B1=Sp;yp.prototype.mix=yp.prototype.interpolate=function(S,A){A===void 0&&(A=.5);for(var O=[],B=arguments.length-2;B-- >0;)O[B]=arguments[B+2];return B1.apply(void 0,[this,S,A].concat(O))};var bp=T;bp.prototype.premultiply=function(S){S===void 0&&(S=!1);var A=this._rgb,O=A[3];return S?(this._rgb=[A[0]*O,A[1]*O,A[2]*O,O],this):new bp([A[0]*O,A[1]*O,A[2]*O,O],"rgb")};var Lc=T,k1=cl;Lc.prototype.saturate=function(S){S===void 0&&(S=1);var A=this,O=A.lch();return O[1]+=k1.Kn*S,O[1]<0&&(O[1]=0),new Lc(O,"lch").alpha(A.alpha(),!0)},Lc.prototype.desaturate=function(S){return S===void 0&&(S=1),this.saturate(-S)};var Ip=T,Ap=g.type;Ip.prototype.set=function(S,A,O){O===void 0&&(O=!1);var B=S.split("."),K=B[0],q=B[1],X=this[K]();if(q){var Q=K.indexOf(q)-(K.substr(0,2)==="ok"?2:0);if(Q>-1){if(Ap(A)=="string")switch(A.charAt(0)){case"+":X[Q]+=+A;break;case"-":X[Q]+=+A;break;case"*":X[Q]*=+A.substr(1);break;case"/":X[Q]/=+A.substr(1);break;default:X[Q]=+A}else if(Ap(A)==="number")X[Q]=A;else throw new Error("unsupported value for Color.set");var ee=new Ip(X,K);return O?(this._rgb=ee._rgb,this):ee}throw new Error("unknown channel "+q+" in mode "+K)}else return X};var z1=T,G1=function(S,A,O){var B=S._rgb,K=A._rgb;return new z1(B[0]+O*(K[0]-B[0]),B[1]+O*(K[1]-B[1]),B[2]+O*(K[2]-B[2]),"rgb")};Cr.rgb=G1;var W1=T,wc=Math.sqrt,Jn=Math.pow,X1=function(S,A,O){var B=S._rgb,K=B[0],q=B[1],X=B[2],Q=A._rgb,ee=Q[0],pe=Q[1],Ce=Q[2];return new W1(wc(Jn(K,2)*(1-O)+Jn(ee,2)*O),wc(Jn(q,2)*(1-O)+Jn(pe,2)*O),wc(Jn(X,2)*(1-O)+Jn(Ce,2)*O),"rgb")};Cr.lrgb=X1;var H1=T,K1=function(S,A,O){var B=S.lab(),K=A.lab();return new H1(B[0]+O*(K[0]-B[0]),B[1]+O*(K[1]-B[1]),B[2]+O*(K[2]-B[2]),"lab")};Cr.lab=K1;var Mp=T,$n=function(S,A,O,B){var K,q,X,Q;B==="hsl"?(X=S.hsl(),Q=A.hsl()):B==="hsv"?(X=S.hsv(),Q=A.hsv()):B==="hcg"?(X=S.hcg(),Q=A.hcg()):B==="hsi"?(X=S.hsi(),Q=A.hsi()):B==="lch"||B==="hcl"?(B="hcl",X=S.hcl(),Q=A.hcl()):B==="oklch"&&(X=S.oklch().reverse(),Q=A.oklch().reverse());var ee,pe,Ce,Be,be,We;(B.substr(0,1)==="h"||B==="oklch")&&(K=X,ee=K[0],Ce=K[1],be=K[2],q=Q,pe=q[0],Be=q[1],We=q[2]);var Xe,ct,Et,bt;return!isNaN(ee)&&!isNaN(pe)?(pe>ee&&pe-ee>180?bt=pe-(ee+360):pe<ee&&ee-pe>180?bt=pe+360-ee:bt=pe-ee,ct=ee+O*bt):isNaN(ee)?isNaN(pe)?ct=Number.NaN:(ct=pe,(be==1||be==0)&&B!="hsv"&&(Xe=Be)):(ct=ee,(We==1||We==0)&&B!="hsv"&&(Xe=Ce)),Xe===void 0&&(Xe=Ce+O*(Be-Ce)),Et=be+O*(We-be),B==="oklch"?new Mp([Et,Xe,ct],B):new Mp([ct,Xe,Et],B)},q1=$n,Pp=function(S,A,O){return q1(S,A,O,"lch")};Cr.lch=Pp,Cr.hcl=Pp;var Y1=T,Z1=function(S,A,O){var B=S.num(),K=A.num();return new Y1(B+O*(K-B),"num")};Cr.num=Z1;var j1=$n,Q1=function(S,A,O){return j1(S,A,O,"hcg")};Cr.hcg=Q1;var J1=$n,$1=function(S,A,O){return J1(S,A,O,"hsi")};Cr.hsi=$1;var eC=$n,tC=function(S,A,O){return eC(S,A,O,"hsl")};Cr.hsl=tC;var iC=$n,rC=function(S,A,O){return iC(S,A,O,"hsv")};Cr.hsv=rC;var sC=T,nC=function(S,A,O){var B=S.oklab(),K=A.oklab();return new sC(B[0]+O*(K[0]-B[0]),B[1]+O*(K[1]-B[1]),B[2]+O*(K[2]-B[2]),"oklab")};Cr.oklab=nC;var oC=$n,aC=function(S,A,O){return oC(S,A,O,"oklch")};Cr.oklch=aC;var Uc=T,lC=g.clip_rgb,Vc=Math.pow,Bc=Math.sqrt,kc=Math.PI,Op=Math.cos,Dp=Math.sin,hC=Math.atan2,cC=function(S,A,O){A===void 0&&(A="lrgb"),O===void 0&&(O=null);var B=S.length;O||(O=Array.from(new Array(B)).map(function(){return 1}));var K=B/O.reduce(function(ct,Et){return ct+Et});if(O.forEach(function(ct,Et){O[Et]*=K}),S=S.map(function(ct){return new Uc(ct)}),A==="lrgb")return uC(S,O);for(var q=S.shift(),X=q.get(A),Q=[],ee=0,pe=0,Ce=0;Ce<X.length;Ce++)if(X[Ce]=(X[Ce]||0)*O[0],Q.push(isNaN(X[Ce])?0:O[0]),A.charAt(Ce)==="h"&&!isNaN(X[Ce])){var Be=X[Ce]/180*kc;ee+=Op(Be)*O[0],pe+=Dp(Be)*O[0]}var be=q.alpha()*O[0];S.forEach(function(ct,Et){var bt=ct.get(A);be+=ct.alpha()*O[Et+1];for(var Ft=0;Ft<X.length;Ft++)if(!isNaN(bt[Ft]))if(Q[Ft]+=O[Et+1],A.charAt(Ft)==="h"){var Hi=bt[Ft]/180*kc;ee+=Op(Hi)*O[Et+1],pe+=Dp(Hi)*O[Et+1]}else X[Ft]+=bt[Ft]*O[Et+1]});for(var We=0;We<X.length;We++)if(A.charAt(We)==="h"){for(var Xe=hC(pe/Q[We],ee/Q[We])/kc*180;Xe<0;)Xe+=360;for(;Xe>=360;)Xe-=360;X[We]=Xe}else X[We]=X[We]/Q[We];return be/=B,new Uc(X,A).alpha(be>.99999?1:be,!0)},uC=function(S,A){for(var O=S.length,B=[0,0,0,0],K=0;K<S.length;K++){var q=S[K],X=A[K]/O,Q=q._rgb;B[0]+=Vc(Q[0],2)*X,B[1]+=Vc(Q[1],2)*X,B[2]+=Vc(Q[2],2)*X,B[3]+=Q[3]*X}return B[0]=Bc(B[0]),B[1]=Bc(B[1]),B[2]=Bc(B[2]),B[3]>.9999999&&(B[3]=1),new Uc(lC(B))},zr=P,eo=g.type,dC=Math.pow,zc=function(S){var A="rgb",O=zr("#ccc"),B=0,K=[0,1],q=[],X=[0,0],Q=!1,ee=[],pe=!1,Ce=0,Be=1,be=!1,We={},Xe=!0,ct=1,Et=function(Me){if(Me=Me||["#fff","#000"],Me&&eo(Me)==="string"&&zr.brewer&&zr.brewer[Me.toLowerCase()]&&(Me=zr.brewer[Me.toLowerCase()]),eo(Me)==="array"){Me.length===1&&(Me=[Me[0],Me[0]]),Me=Me.slice(0);for(var Qe=0;Qe<Me.length;Qe++)Me[Qe]=zr(Me[Qe]);q.length=0;for(var gt=0;gt<Me.length;gt++)q.push(gt/(Me.length-1))}return fr(),ee=Me},bt=function(Me){if(Q!=null){for(var Qe=Q.length-1,gt=0;gt<Qe&&Me>=Q[gt];)gt++;return gt-1}return 0},Ft=function(Me){return Me},Hi=function(Me){return Me},Fi=function(Me,Qe){var gt,ut;if(Qe==null&&(Qe=!1),isNaN(Me)||Me===null)return O;if(Qe)ut=Me;else if(Q&&Q.length>2){var Ki=bt(Me);ut=Ki/(Q.length-2)}else Be!==Ce?ut=(Me-Ce)/(Be-Ce):ut=1;ut=Hi(ut),Qe||(ut=Ft(ut)),ct!==1&&(ut=dC(ut,ct)),ut=X[0]+ut*(1-X[0]-X[1]),ut=Math.min(1,Math.max(0,ut));var ei=Math.floor(ut*1e4);if(Xe&&We[ei])gt=We[ei];else{if(eo(ee)==="array")for(var It=0;It<q.length;It++){var Ut=q[It];if(ut<=Ut){gt=ee[It];break}if(ut>=Ut&&It===q.length-1){gt=ee[It];break}if(ut>Ut&&ut<q[It+1]){ut=(ut-Ut)/(q[It+1]-Ut),gt=zr.interpolate(ee[It],ee[It+1],ut,A);break}}else eo(ee)==="function"&&(gt=ee(ut));Xe&&(We[ei]=gt)}return gt},fr=function(){return We={}};Et(S);var Ct=function(Me){var Qe=zr(Fi(Me));return pe&&Qe[pe]?Qe[pe]():Qe};return Ct.classes=function(Me){if(Me!=null){if(eo(Me)==="array")Q=Me,K=[Me[0],Me[Me.length-1]];else{var Qe=zr.analyze(K);Me===0?Q=[Qe.min,Qe.max]:Q=zr.limits(Qe,"e",Me)}return Ct}return Q},Ct.domain=function(Me){if(!arguments.length)return K;Ce=Me[0],Be=Me[Me.length-1],q=[];var Qe=ee.length;if(Me.length===Qe&&Ce!==Be)for(var gt=0,ut=Array.from(Me);gt<ut.length;gt+=1){var Ki=ut[gt];q.push((Ki-Ce)/(Be-Ce))}else{for(var ei=0;ei<Qe;ei++)q.push(ei/(Qe-1));if(Me.length>2){var It=Me.map(function(Vt,kt){return kt/(Me.length-1)}),Ut=Me.map(function(Vt){return(Vt-Ce)/(Be-Ce)});Ut.every(function(Vt,kt){return It[kt]===Vt})||(Hi=function(Vt){if(Vt<=0||Vt>=1)return Vt;for(var kt=0;Vt>=Ut[kt+1];)kt++;var Wr=(Vt-Ut[kt])/(Ut[kt+1]-Ut[kt]),Js=It[kt]+Wr*(It[kt+1]-It[kt]);return Js})}}return K=[Ce,Be],Ct},Ct.mode=function(Me){return arguments.length?(A=Me,fr(),Ct):A},Ct.range=function(Me,Qe){return Et(Me),Ct},Ct.out=function(Me){return pe=Me,Ct},Ct.spread=function(Me){return arguments.length?(B=Me,Ct):B},Ct.correctLightness=function(Me){return Me==null&&(Me=!0),be=Me,fr(),be?Ft=function(Qe){for(var gt=Fi(0,!0).lab()[0],ut=Fi(1,!0).lab()[0],Ki=gt>ut,ei=Fi(Qe,!0).lab()[0],It=gt+(ut-gt)*Qe,Ut=ei-It,Vt=0,kt=1,Wr=20;Math.abs(Ut)>.01&&Wr-- >0;)(function(){return Ki&&(Ut*=-1),Ut<0?(Vt=Qe,Qe+=(kt-Qe)*.5):(kt=Qe,Qe+=(Vt-Qe)*.5),ei=Fi(Qe,!0).lab()[0],Ut=ei-It})();return Qe}:Ft=function(Qe){return Qe},Ct},Ct.padding=function(Me){return Me!=null?(eo(Me)==="number"&&(Me=[Me,Me]),X=Me,Ct):X},Ct.colors=function(Me,Qe){arguments.length<2&&(Qe="hex");var gt=[];if(arguments.length===0)gt=ee.slice(0);else if(Me===1)gt=[Ct(.5)];else if(Me>1){var ut=K[0],Ki=K[1]-ut;gt=fC(0,Me,!1).map(function(kt){return Ct(ut+kt/(Me-1)*Ki)})}else{S=[];var ei=[];if(Q&&Q.length>2)for(var It=1,Ut=Q.length,Vt=1<=Ut;Vt?It<Ut:It>Ut;Vt?It++:It--)ei.push((Q[It-1]+Q[It])*.5);else ei=K;gt=ei.map(function(kt){return Ct(kt)})}return zr[Qe]&&(gt=gt.map(function(kt){return kt[Qe]()})),gt},Ct.cache=function(Me){return Me!=null?(Xe=Me,Ct):Xe},Ct.gamma=function(Me){return Me!=null?(ct=Me,Ct):ct},Ct.nodata=function(Me){return Me!=null?(O=zr(Me),Ct):O},Ct};function fC(S,A,O){for(var B=[],K=S<A,q=O?K?A+1:A-1:A,X=S;K?X<q:X>q;K?X++:X--)B.push(X);return B}var ia=T,pC=zc,gC=function(S){for(var A=[1,1],O=1;O<S;O++){for(var B=[1],K=1;K<=A.length;K++)B[K]=(A[K]||0)+A[K-1];A=B}return A},mC=function(S){var A,O,B,K,q,X,Q;if(S=S.map(function(be){return new ia(be)}),S.length===2)A=S.map(function(be){return be.lab()}),q=A[0],X=A[1],K=function(be){var We=[0,1,2].map(function(Xe){return q[Xe]+be*(X[Xe]-q[Xe])});return new ia(We,"lab")};else if(S.length===3)O=S.map(function(be){return be.lab()}),q=O[0],X=O[1],Q=O[2],K=function(be){var We=[0,1,2].map(function(Xe){return(1-be)*(1-be)*q[Xe]+2*(1-be)*be*X[Xe]+be*be*Q[Xe]});return new ia(We,"lab")};else if(S.length===4){var ee;B=S.map(function(be){return be.lab()}),q=B[0],X=B[1],Q=B[2],ee=B[3],K=function(be){var We=[0,1,2].map(function(Xe){return(1-be)*(1-be)*(1-be)*q[Xe]+3*(1-be)*(1-be)*be*X[Xe]+3*(1-be)*be*be*Q[Xe]+be*be*be*ee[Xe]});return new ia(We,"lab")}}else if(S.length>=5){var pe,Ce,Be;pe=S.map(function(be){return be.lab()}),Be=S.length-1,Ce=gC(Be),K=function(be){var We=1-be,Xe=[0,1,2].map(function(ct){return pe.reduce(function(Et,bt,Ft){return Et+Ce[Ft]*Math.pow(We,Be-Ft)*Math.pow(be,Ft)*bt[ct]},0)});return new ia(Xe,"lab")}}else throw new RangeError("No point in running bezier with only one color.");return K},_C=function(S){var A=mC(S);return A.scale=function(){return pC(A)},A},Gc=P,Gr=function(S,A,O){if(!Gr[O])throw new Error("unknown blend mode "+O);return Gr[O](S,A)},js=function(S){return function(A,O){var B=Gc(O).rgb(),K=Gc(A).rgb();return Gc.rgb(S(B,K))}},Qs=function(S){return function(A,O){var B=[];return B[0]=S(A[0],O[0]),B[1]=S(A[1],O[1]),B[2]=S(A[2],O[2]),B}},vC=function(S){return S},EC=function(S,A){return S*A/255},TC=function(S,A){return S>A?A:S},xC=function(S,A){return S>A?S:A},CC=function(S,A){return 255*(1-(1-S/255)*(1-A/255))},RC=function(S,A){return A<128?2*S*A/255:255*(1-2*(1-S/255)*(1-A/255))},SC=function(S,A){return 255*(1-(1-A/255)/(S/255))},yC=function(S,A){return S===255?255:(S=255*(A/255)/(1-S/255),S>255?255:S)};Gr.normal=js(Qs(vC)),Gr.multiply=js(Qs(EC)),Gr.screen=js(Qs(CC)),Gr.overlay=js(Qs(RC)),Gr.darken=js(Qs(TC)),Gr.lighten=js(Qs(xC)),Gr.dodge=js(Qs(yC)),Gr.burn=js(Qs(SC));for(var bC=Gr,Wc=g.type,IC=g.clip_rgb,AC=g.TWOPI,MC=Math.pow,PC=Math.sin,OC=Math.cos,Np=P,DC=function(S,A,O,B,K){S===void 0&&(S=300),A===void 0&&(A=-1.5),O===void 0&&(O=1),B===void 0&&(B=1),K===void 0&&(K=[0,1]);var q=0,X;Wc(K)==="array"?X=K[1]-K[0]:(X=0,K=[K,K]);var Q=function(ee){var pe=AC*((S+120)/360+A*ee),Ce=MC(K[0]+X*ee,B),Be=q!==0?O[0]+ee*q:O,be=Be*Ce*(1-Ce)/2,We=OC(pe),Xe=PC(pe),ct=Ce+be*(-.14861*We+1.78277*Xe),Et=Ce+be*(-.29227*We-.90649*Xe),bt=Ce+be*(1.97294*We);return Np(IC([ct*255,Et*255,bt*255,1]))};return Q.start=function(ee){return ee==null?S:(S=ee,Q)},Q.rotations=function(ee){return ee==null?A:(A=ee,Q)},Q.gamma=function(ee){return ee==null?B:(B=ee,Q)},Q.hue=function(ee){return ee==null?O:(O=ee,Wc(O)==="array"?(q=O[1]-O[0],q===0&&(O=O[1])):q=0,Q)},Q.lightness=function(ee){return ee==null?K:(Wc(ee)==="array"?(K=ee,X=ee[1]-ee[0]):(K=[ee,ee],X=0),Q)},Q.scale=function(){return Np.scale(Q)},Q.hue(O),Q},NC=T,FC="0123456789abcdef",LC=Math.floor,wC=Math.random,UC=function(){for(var S="#",A=0;A<6;A++)S+=FC.charAt(LC(wC()*16));return new NC(S,"hex")},Xc=h,Fp=Math.log,VC=Math.pow,BC=Math.floor,kC=Math.abs,Lp=function(S,A){A===void 0&&(A=null);var O={min:Number.MAX_VALUE,max:Number.MAX_VALUE*-1,sum:0,values:[],count:0};return Xc(S)==="object"&&(S=Object.values(S)),S.forEach(function(B){A&&Xc(B)==="object"&&(B=B[A]),B!=null&&!isNaN(B)&&(O.values.push(B),O.sum+=B,B<O.min&&(O.min=B),B>O.max&&(O.max=B),O.count+=1)}),O.domain=[O.min,O.max],O.limits=function(B,K){return wp(O,B,K)},O},wp=function(S,A,O){A===void 0&&(A="equal"),O===void 0&&(O=7),Xc(S)=="array"&&(S=Lp(S));var B=S.min,K=S.max,q=S.values.sort(function(Kc,qc){return Kc-qc});if(O===1)return[B,K];var X=[];if(A.substr(0,1)==="c"&&(X.push(B),X.push(K)),A.substr(0,1)==="e"){X.push(B);for(var Q=1;Q<O;Q++)X.push(B+Q/O*(K-B));X.push(K)}else if(A.substr(0,1)==="l"){if(B<=0)throw new Error("Logarithmic scales are only possible for values > 0");var ee=Math.LOG10E*Fp(B),pe=Math.LOG10E*Fp(K);X.push(B);for(var Ce=1;Ce<O;Ce++)X.push(VC(10,ee+Ce/O*(pe-ee)));X.push(K)}else if(A.substr(0,1)==="q"){X.push(B);for(var Be=1;Be<O;Be++){var be=(q.length-1)*Be/O,We=BC(be);if(We===be)X.push(q[We]);else{var Xe=be-We;X.push(q[We]*(1-Xe)+q[We+1]*Xe)}}X.push(K)}else if(A.substr(0,1)==="k"){var ct,Et=q.length,bt=new Array(Et),Ft=new Array(O),Hi=!0,Fi=0,fr=null;fr=[],fr.push(B);for(var Ct=1;Ct<O;Ct++)fr.push(B+Ct/O*(K-B));for(fr.push(K);Hi;){for(var Me=0;Me<O;Me++)Ft[Me]=0;for(var Qe=0;Qe<Et;Qe++)for(var gt=q[Qe],ut=Number.MAX_VALUE,Ki=void 0,ei=0;ei<O;ei++){var It=kC(fr[ei]-gt);It<ut&&(ut=It,Ki=ei),Ft[Ki]++,bt[Qe]=Ki}for(var Ut=new Array(O),Vt=0;Vt<O;Vt++)Ut[Vt]=null;for(var kt=0;kt<Et;kt++)ct=bt[kt],Ut[ct]===null?Ut[ct]=q[kt]:Ut[ct]+=q[kt];for(var Wr=0;Wr<O;Wr++)Ut[Wr]*=1/Ft[Wr];Hi=!1;for(var Js=0;Js<O;Js++)if(Ut[Js]!==fr[Js]){Hi=!0;break}fr=Ut,Fi++,Fi>200&&(Hi=!1)}for(var $s={},to=0;to<O;to++)$s[to]=[];for(var io=0;io<Et;io++)ct=bt[io],$s[ct].push(q[io]);for(var Is=[],Cn=0;Cn<O;Cn++)Is.push($s[Cn][0]),Is.push($s[Cn][$s[Cn].length-1]);Is=Is.sort(function(Kc,qc){return Kc-qc}),X.push(Is[0]);for(var ra=1;ra<Is.length;ra+=2){var Rn=Is[ra];!isNaN(Rn)&&X.indexOf(Rn)===-1&&X.push(Rn)}}return X},Up={analyze:Lp,limits:wp},Vp=T,zC=function(S,A){S=new Vp(S),A=new Vp(A);var O=S.luminance(),B=A.luminance();return O>B?(O+.05)/(B+.05):(B+.05)/(O+.05)},Bp=T,bs=Math.sqrt,Ri=Math.pow,GC=Math.min,WC=Math.max,kp=Math.atan2,zp=Math.abs,ml=Math.cos,Gp=Math.sin,XC=Math.exp,Wp=Math.PI,HC=function(S,A,O,B,K){O===void 0&&(O=1),B===void 0&&(B=1),K===void 0&&(K=1);var q=function(Rn){return 360*Rn/(2*Wp)},X=function(Rn){return 2*Wp*Rn/360};S=new Bp(S),A=new Bp(A);var Q=Array.from(S.lab()),ee=Q[0],pe=Q[1],Ce=Q[2],Be=Array.from(A.lab()),be=Be[0],We=Be[1],Xe=Be[2],ct=(ee+be)/2,Et=bs(Ri(pe,2)+Ri(Ce,2)),bt=bs(Ri(We,2)+Ri(Xe,2)),Ft=(Et+bt)/2,Hi=.5*(1-bs(Ri(Ft,7)/(Ri(Ft,7)+Ri(25,7)))),Fi=pe*(1+Hi),fr=We*(1+Hi),Ct=bs(Ri(Fi,2)+Ri(Ce,2)),Me=bs(Ri(fr,2)+Ri(Xe,2)),Qe=(Ct+Me)/2,gt=q(kp(Ce,Fi)),ut=q(kp(Xe,fr)),Ki=gt>=0?gt:gt+360,ei=ut>=0?ut:ut+360,It=zp(Ki-ei)>180?(Ki+ei+360)/2:(Ki+ei)/2,Ut=1-.17*ml(X(It-30))+.24*ml(X(2*It))+.32*ml(X(3*It+6))-.2*ml(X(4*It-63)),Vt=ei-Ki;Vt=zp(Vt)<=180?Vt:ei<=Ki?Vt+360:Vt-360,Vt=2*bs(Ct*Me)*Gp(X(Vt)/2);var kt=be-ee,Wr=Me-Ct,Js=1+.015*Ri(ct-50,2)/bs(20+Ri(ct-50,2)),$s=1+.045*Qe,to=1+.015*Qe*Ut,io=30*XC(-Ri((It-275)/25,2)),Is=2*bs(Ri(Qe,7)/(Ri(Qe,7)+Ri(25,7))),Cn=-Is*Gp(2*X(io)),ra=bs(Ri(kt/(O*Js),2)+Ri(Wr/(B*$s),2)+Ri(Vt/(K*to),2)+Cn*(Wr/(B*$s))*(Vt/(K*to)));return WC(0,GC(100,ra))},Xp=T,KC=function(S,A,O){O===void 0&&(O="lab"),S=new Xp(S),A=new Xp(A);var B=S.get(O),K=A.get(O),q=0;for(var X in B){var Q=(B[X]||0)-(K[X]||0);q+=Q*Q}return Math.sqrt(q)},qC=T,YC=function(){for(var S=[],A=arguments.length;A--;)S[A]=arguments[A];try{return new(Function.prototype.bind.apply(qC,[null].concat(S))),!0}catch{return!1}},Hp=P,Kp=zc,ZC={cool:function(){return Kp([Hp.hsl(180,1,.9),Hp.hsl(250,.7,.4)])},hot:function(){return Kp(["#000","#f00","#ff0","#fff"]).mode("rgb")}},_l={OrRd:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],PuBu:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],BuPu:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],Oranges:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],BuGn:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],YlOrBr:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],YlGn:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],Reds:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],RdPu:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],Greens:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],YlGnBu:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],Purples:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],GnBu:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],Greys:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],YlOrRd:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],PuRd:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],Blues:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],PuBuGn:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],Viridis:["#440154","#482777","#3f4a8a","#31678e","#26838f","#1f9d8a","#6cce5a","#b6de2b","#fee825"],Spectral:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],RdYlGn:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],RdBu:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],PiYG:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],PRGn:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],RdYlBu:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],BrBG:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],RdGy:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],PuOr:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],Set2:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],Accent:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"],Set1:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],Set3:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"],Dark2:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],Paired:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],Pastel2:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"],Pastel1:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},Hc=0,qp=Object.keys(_l);Hc<qp.length;Hc+=1){var Yp=qp[Hc];_l[Yp.toLowerCase()]=_l[Yp]}var jC=_l,Ni=P;Ni.average=cC,Ni.bezier=_C,Ni.blend=bC,Ni.cubehelix=DC,Ni.mix=Ni.interpolate=Sp,Ni.random=UC,Ni.scale=zc,Ni.analyze=Up.analyze,Ni.contrast=zC,Ni.deltaE=HC,Ni.distance=KC,Ni.limits=Up.limits,Ni.valid=YC,Ni.scales=ZC,Ni.colors=op,Ni.brewer=jC;var QC=Ni;return QC})})(BE);var rz=BE.exports;const Yi=UE(rz);class sz{constructor(e){this.scheme=typeof e=="string"?kE[e]:e}toColor3(e=this.scheme.length){return Yi.scale(this.scheme).colors(e).map(t=>_i.FromHexString(t))}toColor4(e=this.scheme.length){return Yi.scale(this.scheme).colors(e).map(t=>oh.FromHexString(t))}toStandardMaterial(e=this.scheme.length){return Yi.scale(this.scheme).colors(e).map(t=>Qu(t))}toPBRMaterialRough(e=this.scheme.length){return Yi.scale(this.scheme).colors(e).map(t=>Ju(t))}toPBRMaterialGlossy(e=this.scheme.length){return Yi.scale(this.scheme).colors(e).map(t=>$u(t))}}class nz{constructor(e){this.scheme=typeof e=="string"?kE[e]:e}toColor3(e=void 0){return e===void 0?t=>_i.FromHexString(Yi.scale(this.scheme)(t).hex()):t=>_i.FromHexString(Yi.scale(this.scheme).classes(e)(t).hex())}toColor4(e=void 0){return e===void 0?t=>oh.FromHexString(Yi.scale(this.scheme)(t).hex()):t=>oh.FromHexString(Yi.scale(this.scheme).classes(e)(t).hex())}toStandardMaterial(e=void 0){return e===void 0?t=>Qu(Yi.scale(this.scheme)(t).hex()):t=>Qu(Yi.scale(this.scheme).classes(e)(t).hex())}toPBRMaterialRough(e=void 0){return e===void 0?t=>Ju(Yi.scale(this.scheme)(t).hex()):t=>Ju(Yi.scale(this.scheme).classes(e)(t).hex())}toPBRMaterialGlossy(e=void 0){return e===void 0?t=>$u(Yi.scale(this.scheme)(t).hex()):t=>$u(Yi.scale(this.scheme).classes(e)(t).hex())}}function FG(n){return new sz(n)}function LG(n){return new nz(n)}let kE={...Yi.brewer,d310:["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"]};({...Yi.brewer});function Qu(n){let e=new Ws(n);return e.diffuseColor=_i.FromHexString(n),e}function Ju(n){let e=new IR(n);return e.baseColor=_i.FromHexString(n),e}function $u(n){let e=new AR(n);return e.diffuseColor=_i.FromHexString(n),e.specularColor=_i.FromHexString(n),e}var Jt=1e-6,oz=1e-12,St=Math.PI,wr=St/2,m_=St/4,ts=St*2,Mr=180/St,$i=St/180,ui=Math.abs,az=Math.atan,zo=Math.atan2,ci=Math.cos,Qt=Math.sin,rh=Math.sign||function(n){return n>0?1:n<0?-1:0},Go=Math.sqrt;function lz(n){return n>1?0:n<-1?St:Math.acos(n)}function zn(n){return n>1?wr:n<-1?-wr:Math.asin(n)}function la(){}function Dh(n,e){n&&v_.hasOwnProperty(n.type)&&v_[n.type](n,e)}var __={Feature:function(n,e){Dh(n.geometry,e)},FeatureCollection:function(n,e){for(var t=n.features,i=-1,r=t.length;++i<r;)Dh(t[i].geometry,e)}},v_={Sphere:function(n,e){e.sphere()},Point:function(n,e){n=n.coordinates,e.point(n[0],n[1],n[2])},MultiPoint:function(n,e){for(var t=n.coordinates,i=-1,r=t.length;++i<r;)n=t[i],e.point(n[0],n[1],n[2])},LineString:function(n,e){ed(n.coordinates,e,0)},MultiLineString:function(n,e){for(var t=n.coordinates,i=-1,r=t.length;++i<r;)ed(t[i],e,0)},Polygon:function(n,e){E_(n.coordinates,e)},MultiPolygon:function(n,e){for(var t=n.coordinates,i=-1,r=t.length;++i<r;)E_(t[i],e)},GeometryCollection:function(n,e){for(var t=n.geometries,i=-1,r=t.length;++i<r;)Dh(t[i],e)}};function ed(n,e,t){var i=-1,r=n.length-t,s;for(e.lineStart();++i<r;)s=n[i],e.point(s[0],s[1],s[2]);e.lineEnd()}function E_(n,e){var t=-1,i=n.length;for(e.polygonStart();++t<i;)ed(n[t],e,1);e.polygonEnd()}function zE(n,e){n&&__.hasOwnProperty(n.type)?__[n.type](n,e):Dh(n,e)}function td(n){return[zo(n[1],n[0]),zn(n[2])]}function Wo(n){var e=n[0],t=n[1],i=ci(t);return[i*ci(e),i*Qt(e),Qt(t)]}function wl(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function Nh(n,e){return[n[1]*e[2]-n[2]*e[1],n[2]*e[0]-n[0]*e[2],n[0]*e[1]-n[1]*e[0]]}function Tu(n,e){n[0]+=e[0],n[1]+=e[1],n[2]+=e[2]}function Ul(n,e){return[n[0]*e,n[1]*e,n[2]*e]}function id(n){var e=Go(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);n[0]/=e,n[1]/=e,n[2]/=e}function rd(n,e){function t(i,r){return i=n(i,r),e(i[0],i[1])}return n.invert&&e.invert&&(t.invert=function(i,r){return i=e.invert(i,r),i&&n.invert(i[0],i[1])}),t}function sd(n,e){return ui(n)>St&&(n-=Math.round(n/ts)*ts),[n,e]}sd.invert=sd;function hz(n,e,t){return(n%=ts)?e||t?rd(x_(n),C_(e,t)):x_(n):e||t?C_(e,t):sd}function T_(n){return function(e,t){return e+=n,ui(e)>St&&(e-=Math.round(e/ts)*ts),[e,t]}}function x_(n){var e=T_(n);return e.invert=T_(-n),e}function C_(n,e){var t=ci(n),i=Qt(n),r=ci(e),s=Qt(e);function o(a,l){var h=ci(l),c=ci(a)*h,u=Qt(a)*h,d=Qt(l),f=d*t+c*i;return[zo(u*r-f*s,c*t-d*i),zn(f*r+u*s)]}return o.invert=function(a,l){var h=ci(l),c=ci(a)*h,u=Qt(a)*h,d=Qt(l),f=d*r-u*s;return[zo(u*r+d*s,c*t+f*i),zn(f*t-c*i)]},o}function cz(n,e,t,i,r,s){if(t){var o=ci(e),a=Qt(e),l=i*t;r==null?(r=e+i*ts,s=e-l/2):(r=R_(o,r),s=R_(o,s),(i>0?r<s:r>s)&&(r+=i*ts));for(var h,c=r;i>0?c>s:c<s;c-=l)h=td([o,-a*ci(c),-a*Qt(c)]),n.point(h[0],h[1])}}function R_(n,e){e=Wo(e),e[0]-=n,id(e);var t=lz(-e[1]);return((-e[2]<0?-t:t)+ts-Jt)%ts}function GE(){var n=[],e;return{point:function(t,i,r){e.push([t,i,r])},lineStart:function(){n.push(e=[])},lineEnd:la,rejoin:function(){n.length>1&&n.push(n.pop().concat(n.shift()))},result:function(){var t=n;return n=[],e=null,t}}}function sh(n,e){return ui(n[0]-e[0])<Jt&&ui(n[1]-e[1])<Jt}function Vl(n,e,t,i){this.x=n,this.z=e,this.o=t,this.e=i,this.v=!1,this.n=this.p=null}function WE(n,e,t,i,r){var s=[],o=[],a,l;if(n.forEach(function(p){if(!((g=p.length-1)<=0)){var g,m=p[0],x=p[g],E;if(sh(m,x)){if(!m[2]&&!x[2]){for(r.lineStart(),a=0;a<g;++a)r.point((m=p[a])[0],m[1]);r.lineEnd();return}x[0]+=2*Jt}s.push(E=new Vl(m,p,null,!0)),o.push(E.o=new Vl(m,null,E,!1)),s.push(E=new Vl(x,p,null,!1)),o.push(E.o=new Vl(x,null,E,!0))}}),!!s.length){for(o.sort(e),S_(s),S_(o),a=0,l=o.length;a<l;++a)o[a].e=t=!t;for(var h=s[0],c,u;;){for(var d=h,f=!0;d.v;)if((d=d.n)===h)return;c=d.z,r.lineStart();do{if(d.v=d.o.v=!0,d.e){if(f)for(a=0,l=c.length;a<l;++a)r.point((u=c[a])[0],u[1]);else i(d.x,d.n.x,1,r);d=d.n}else{if(f)for(c=d.p.z,a=c.length-1;a>=0;--a)r.point((u=c[a])[0],u[1]);else i(d.x,d.p.x,-1,r);d=d.p}d=d.o,c=d.z,f=!f}while(!d.v);r.lineEnd()}}}function S_(n){if(e=n.length){for(var e,t=0,i=n[0],r;++t<e;)i.n=r=n[t],r.p=i,i=r;i.n=r=n[0],r.p=i}}function xu(n){return ui(n[0])<=St?n[0]:rh(n[0])*((ui(n[0])+St)%ts-St)}function uz(n,e){var t=xu(e),i=e[1],r=Qt(i),s=[Qt(t),-ci(t),0],o=0,a=0,l=new $w;r===1?i=wr+Jt:r===-1&&(i=-wr-Jt);for(var h=0,c=n.length;h<c;++h)if(d=(u=n[h]).length)for(var u,d,f=u[d-1],p=xu(f),g=f[1]/2+m_,m=Qt(g),x=ci(g),E=0;E<d;++E,p=C,m=T,x=y,f=R){var R=u[E],C=xu(R),_=R[1]/2+m_,T=Qt(_),y=ci(_),P=C-p,D=P>=0?1:-1,F=D*P,N=F>St,G=m*T;if(l.add(zo(G*D*Qt(F),x*y+G*ci(F))),o+=N?P+D*ts:P,N^p>=t^C>=t){var J=Nh(Wo(f),Wo(R));id(J);var j=Nh(s,J);id(j);var z=(N^P>=0?-1:1)*zn(j[2]);(i>z||i===z&&(J[0]||J[1]))&&(a+=N^P>=0?1:-1)}}return(o<-Jt||o<Jt&&l<-oz)^a&1}function XE(n,e,t,i){return function(r){var s=e(r),o=GE(),a=e(o),l=!1,h,c,u,d={point:f,lineStart:g,lineEnd:m,polygonStart:function(){d.point=x,d.lineStart=E,d.lineEnd=R,c=[],h=[]},polygonEnd:function(){d.point=f,d.lineStart=g,d.lineEnd=m,c=Vv(c);var C=uz(h,i);c.length?(l||(r.polygonStart(),l=!0),WE(c,fz,C,t,r)):C&&(l||(r.polygonStart(),l=!0),r.lineStart(),t(null,null,1,r),r.lineEnd()),l&&(r.polygonEnd(),l=!1),c=h=null},sphere:function(){r.polygonStart(),r.lineStart(),t(null,null,1,r),r.lineEnd(),r.polygonEnd()}};function f(C,_){n(C,_)&&r.point(C,_)}function p(C,_){s.point(C,_)}function g(){d.point=p,s.lineStart()}function m(){d.point=f,s.lineEnd()}function x(C,_){u.push([C,_]),a.point(C,_)}function E(){a.lineStart(),u=[]}function R(){x(u[0][0],u[0][1]),a.lineEnd();var C=a.clean(),_=o.result(),T,y=_.length,P,D,F;if(u.pop(),h.push(u),u=null,!!y){if(C&1){if(D=_[0],(P=D.length-1)>0){for(l||(r.polygonStart(),l=!0),r.lineStart(),T=0;T<P;++T)r.point((F=D[T])[0],F[1]);r.lineEnd()}return}y>1&&C&2&&_.push(_.pop().concat(_.shift())),c.push(_.filter(dz))}}return d}}function dz(n){return n.length>1}function fz(n,e){return((n=n.x)[0]<0?n[1]-wr-Jt:wr-n[1])-((e=e.x)[0]<0?e[1]-wr-Jt:wr-e[1])}const y_=XE(function(){return!0},pz,mz,[-St,-wr]);function pz(n){var e=NaN,t=NaN,i=NaN,r;return{lineStart:function(){n.lineStart(),r=1},point:function(s,o){var a=s>0?St:-St,l=ui(s-e);ui(l-St)<Jt?(n.point(e,t=(t+o)/2>0?wr:-wr),n.point(i,t),n.lineEnd(),n.lineStart(),n.point(a,t),n.point(s,t),r=0):i!==a&&l>=St&&(ui(e-i)<Jt&&(e-=i*Jt),ui(s-a)<Jt&&(s-=a*Jt),t=gz(e,t,s,o),n.point(i,t),n.lineEnd(),n.lineStart(),n.point(a,t),r=0),n.point(e=s,t=o),i=a},lineEnd:function(){n.lineEnd(),e=t=NaN},clean:function(){return 2-r}}}function gz(n,e,t,i){var r,s,o=Qt(n-t);return ui(o)>Jt?az((Qt(e)*(s=ci(i))*Qt(t)-Qt(i)*(r=ci(e))*Qt(n))/(r*s*o)):(e+i)/2}function mz(n,e,t,i){var r;if(n==null)r=t*wr,i.point(-St,r),i.point(0,r),i.point(St,r),i.point(St,0),i.point(St,-r),i.point(0,-r),i.point(-St,-r),i.point(-St,0),i.point(-St,r);else if(ui(n[0]-e[0])>Jt){var s=n[0]<e[0]?St:-St;r=t*s/2,i.point(-s,r),i.point(0,r),i.point(s,r)}else i.point(e[0],e[1])}function _z(n){var e=ci(n),t=2*$i,i=e>0,r=ui(e)>Jt;function s(c,u,d,f){cz(f,n,t,d,c,u)}function o(c,u){return ci(c)*ci(u)>e}function a(c){var u,d,f,p,g;return{lineStart:function(){p=f=!1,g=1},point:function(m,x){var E=[m,x],R,C=o(m,x),_=i?C?0:h(m,x):C?h(m+(m<0?St:-St),x):0;if(!u&&(p=f=C)&&c.lineStart(),C!==f&&(R=l(u,E),(!R||sh(u,R)||sh(E,R))&&(E[2]=1)),C!==f)g=0,C?(c.lineStart(),R=l(E,u),c.point(R[0],R[1])):(R=l(u,E),c.point(R[0],R[1],2),c.lineEnd()),u=R;else if(r&&u&&i^C){var T;!(_&d)&&(T=l(E,u,!0))&&(g=0,i?(c.lineStart(),c.point(T[0][0],T[0][1]),c.point(T[1][0],T[1][1]),c.lineEnd()):(c.point(T[1][0],T[1][1]),c.lineEnd(),c.lineStart(),c.point(T[0][0],T[0][1],3)))}C&&(!u||!sh(u,E))&&c.point(E[0],E[1]),u=E,f=C,d=_},lineEnd:function(){f&&c.lineEnd(),u=null},clean:function(){return g|(p&&f)<<1}}}function l(c,u,d){var f=Wo(c),p=Wo(u),g=[1,0,0],m=Nh(f,p),x=wl(m,m),E=m[0],R=x-E*E;if(!R)return!d&&c;var C=e*x/R,_=-e*E/R,T=Nh(g,m),y=Ul(g,C),P=Ul(m,_);Tu(y,P);var D=T,F=wl(y,D),N=wl(D,D),G=F*F-N*(wl(y,y)-1);if(!(G<0)){var J=Go(G),j=Ul(D,(-F-J)/N);if(Tu(j,y),j=td(j),!d)return j;var z=c[0],$=u[0],te=c[1],fe=u[1],Z;$<z&&(Z=z,z=$,$=Z);var L=$-z,w=ui(L-St)<Jt,H=w||L<Jt;if(!w&&fe<te&&(Z=te,te=fe,fe=Z),H?w?te+fe>0^j[1]<(ui(j[0]-z)<Jt?te:fe):te<=j[1]&&j[1]<=fe:L>St^(z<=j[0]&&j[0]<=$)){var de=Ul(D,(-F+J)/N);return Tu(de,y),[j,td(de)]}}}function h(c,u){var d=i?n:St-n,f=0;return c<-d?f|=1:c>d&&(f|=2),u<-d?f|=4:u>d&&(f|=8),f}return XE(o,a,s,i?[0,-n]:[-St,n-St])}function vz(n,e,t,i,r,s){var o=n[0],a=n[1],l=e[0],h=e[1],c=0,u=1,d=l-o,f=h-a,p;if(p=t-o,!(!d&&p>0)){if(p/=d,d<0){if(p<c)return;p<u&&(u=p)}else if(d>0){if(p>u)return;p>c&&(c=p)}if(p=r-o,!(!d&&p<0)){if(p/=d,d<0){if(p>u)return;p>c&&(c=p)}else if(d>0){if(p<c)return;p<u&&(u=p)}if(p=i-a,!(!f&&p>0)){if(p/=f,f<0){if(p<c)return;p<u&&(u=p)}else if(f>0){if(p>u)return;p>c&&(c=p)}if(p=s-a,!(!f&&p<0)){if(p/=f,f<0){if(p>u)return;p>c&&(c=p)}else if(f>0){if(p<c)return;p<u&&(u=p)}return c>0&&(n[0]=o+c*d,n[1]=a+c*f),u<1&&(e[0]=o+u*d,e[1]=a+u*f),!0}}}}}var ha=1e9,Bl=-ha;function HE(n,e,t,i){function r(h,c){return n<=h&&h<=t&&e<=c&&c<=i}function s(h,c,u,d){var f=0,p=0;if(h==null||(f=o(h,u))!==(p=o(c,u))||l(h,c)<0^u>0)do d.point(f===0||f===3?n:t,f>1?i:e);while((f=(f+u+4)%4)!==p);else d.point(c[0],c[1])}function o(h,c){return ui(h[0]-n)<Jt?c>0?0:3:ui(h[0]-t)<Jt?c>0?2:1:ui(h[1]-e)<Jt?c>0?1:0:c>0?3:2}function a(h,c){return l(h.x,c.x)}function l(h,c){var u=o(h,1),d=o(c,1);return u!==d?u-d:u===0?c[1]-h[1]:u===1?h[0]-c[0]:u===2?h[1]-c[1]:c[0]-h[0]}return function(h){var c=h,u=GE(),d,f,p,g,m,x,E,R,C,_,T,y={point:P,lineStart:G,lineEnd:J,polygonStart:F,polygonEnd:N};function P(z,$){r(z,$)&&c.point(z,$)}function D(){for(var z=0,$=0,te=f.length;$<te;++$)for(var fe=f[$],Z=1,L=fe.length,w=fe[0],H,de,Te=w[0],Ne=w[1];Z<L;++Z)H=Te,de=Ne,w=fe[Z],Te=w[0],Ne=w[1],de<=i?Ne>i&&(Te-H)*(i-de)>(Ne-de)*(n-H)&&++z:Ne<=i&&(Te-H)*(i-de)<(Ne-de)*(n-H)&&--z;return z}function F(){c=u,d=[],f=[],T=!0}function N(){var z=D(),$=T&&z,te=(d=Vv(d)).length;($||te)&&(h.polygonStart(),$&&(h.lineStart(),s(null,null,1,h),h.lineEnd()),te&&WE(d,a,z,s,h),h.polygonEnd()),c=h,d=f=p=null}function G(){y.point=j,f&&f.push(p=[]),_=!0,C=!1,E=R=NaN}function J(){d&&(j(g,m),x&&C&&u.rejoin(),d.push(u.result())),y.point=P,C&&c.lineEnd()}function j(z,$){var te=r(z,$);if(f&&p.push([z,$]),_)g=z,m=$,x=te,_=!1,te&&(c.lineStart(),c.point(z,$));else if(te&&C)c.point(z,$);else{var fe=[E=Math.max(Bl,Math.min(ha,E)),R=Math.max(Bl,Math.min(ha,R))],Z=[z=Math.max(Bl,Math.min(ha,z)),$=Math.max(Bl,Math.min(ha,$))];vz(fe,Z,n,e,t,i)?(C||(c.lineStart(),c.point(fe[0],fe[1])),c.point(Z[0],Z[1]),te||c.lineEnd(),T=!1):te&&(c.lineStart(),c.point(z,$),T=!1)}E=z,R=$,C=te}return y}}const Fh=n=>n;var Xo=1/0,Lh=Xo,Ga=-Xo,wh=Ga,Ez={point:Tz,lineStart:la,lineEnd:la,polygonStart:la,polygonEnd:la,result:function(){var n=[[Xo,Lh],[Ga,wh]];return Ga=wh=-(Lh=Xo=1/0),n}};function Tz(n,e){n<Xo&&(Xo=n),n>Ga&&(Ga=n),e<Lh&&(Lh=e),e>wh&&(wh=e)}const b_=Ez;function _c(n){return function(e){var t=new nd;for(var i in n)t[i]=n[i];return t.stream=e,t}}function nd(){}nd.prototype={constructor:nd,point:function(n,e){this.stream.point(n,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function Pf(n,e,t){var i=n.clipExtent&&n.clipExtent();return n.scale(150).translate([0,0]),i!=null&&n.clipExtent(null),zE(t,n.stream(b_)),e(b_.result()),i!=null&&n.clipExtent(i),n}function Of(n,e,t){return Pf(n,function(i){var r=e[1][0]-e[0][0],s=e[1][1]-e[0][1],o=Math.min(r/(i[1][0]-i[0][0]),s/(i[1][1]-i[0][1])),a=+e[0][0]+(r-o*(i[1][0]+i[0][0]))/2,l=+e[0][1]+(s-o*(i[1][1]+i[0][1]))/2;n.scale(150*o).translate([a,l])},t)}function KE(n,e,t){return Of(n,[[0,0],e],t)}function qE(n,e,t){return Pf(n,function(i){var r=+e,s=r/(i[1][0]-i[0][0]),o=(r-s*(i[1][0]+i[0][0]))/2,a=-s*i[0][1];n.scale(150*s).translate([o,a])},t)}function YE(n,e,t){return Pf(n,function(i){var r=+e,s=r/(i[1][1]-i[0][1]),o=-s*i[0][0],a=(r-s*(i[1][1]+i[0][1]))/2;n.scale(150*s).translate([o,a])},t)}var I_=16,xz=ci(30*$i);function A_(n,e){return+e?Rz(n,e):Cz(n)}function Cz(n){return _c({point:function(e,t){e=n(e,t),this.stream.point(e[0],e[1])}})}function Rz(n,e){function t(i,r,s,o,a,l,h,c,u,d,f,p,g,m){var x=h-i,E=c-r,R=x*x+E*E;if(R>4*e&&g--){var C=o+d,_=a+f,T=l+p,y=Go(C*C+_*_+T*T),P=zn(T/=y),D=ui(ui(T)-1)<Jt||ui(s-u)<Jt?(s+u)/2:zo(_,C),F=n(D,P),N=F[0],G=F[1],J=N-i,j=G-r,z=E*J-x*j;(z*z/R>e||ui((x*J+E*j)/R-.5)>.3||o*d+a*f+l*p<xz)&&(t(i,r,s,o,a,l,N,G,D,C/=y,_/=y,T,g,m),m.point(N,G),t(N,G,D,C,_,T,h,c,u,d,f,p,g,m))}}return function(i){var r,s,o,a,l,h,c,u,d,f,p,g,m={point:x,lineStart:E,lineEnd:C,polygonStart:function(){i.polygonStart(),m.lineStart=_},polygonEnd:function(){i.polygonEnd(),m.lineStart=E}};function x(P,D){P=n(P,D),i.point(P[0],P[1])}function E(){u=NaN,m.point=R,i.lineStart()}function R(P,D){var F=Wo([P,D]),N=n(P,D);t(u,d,c,f,p,g,u=N[0],d=N[1],c=P,f=F[0],p=F[1],g=F[2],I_,i),i.point(u,d)}function C(){m.point=x,i.lineEnd()}function _(){E(),m.point=T,m.lineEnd=y}function T(P,D){R(r=P,D),s=u,o=d,a=f,l=p,h=g,m.point=R}function y(){t(u,d,c,f,p,g,s,o,r,a,l,h,I_,i),m.lineEnd=C,C()}return m}}var Sz=_c({point:function(n,e){this.stream.point(n*$i,e*$i)}});function yz(n){return _c({point:function(e,t){var i=n(e,t);return this.stream.point(i[0],i[1])}})}function bz(n,e,t,i,r){function s(o,a){return o*=i,a*=r,[e+n*o,t-n*a]}return s.invert=function(o,a){return[(o-e)/n*i,(t-a)/n*r]},s}function M_(n,e,t,i,r,s){if(!s)return bz(n,e,t,i,r);var o=ci(s),a=Qt(s),l=o*n,h=a*n,c=o/n,u=a/n,d=(a*t-o*e)/n,f=(a*e+o*t)/n;function p(g,m){return g*=i,m*=r,[l*g-h*m+e,t-h*g-l*m]}return p.invert=function(g,m){return[i*(c*g-u*m+d),r*(f-u*g-c*m)]},p}function Iz(n){var e,t=150,i=480,r=250,s=0,o=0,a=0,l=0,h=0,c,u=0,d=1,f=1,p=null,g=y_,m=null,x,E,R,C=Fh,_=.5,T,y,P,D,F;function N(z){return P(z[0]*$i,z[1]*$i)}function G(z){return z=P.invert(z[0],z[1]),z&&[z[0]*Mr,z[1]*Mr]}N.stream=function(z){return D&&F===z?D:D=Sz(yz(c)(g(T(C(F=z)))))},N.preclip=function(z){return arguments.length?(g=z,p=void 0,j()):g},N.postclip=function(z){return arguments.length?(C=z,m=x=E=R=null,j()):C},N.clipAngle=function(z){return arguments.length?(g=+z?_z(p=z*$i):(p=null,y_),j()):p*Mr},N.clipExtent=function(z){return arguments.length?(C=z==null?(m=x=E=R=null,Fh):HE(m=+z[0][0],x=+z[0][1],E=+z[1][0],R=+z[1][1]),j()):m==null?null:[[m,x],[E,R]]},N.scale=function(z){return arguments.length?(t=+z,J()):t},N.translate=function(z){return arguments.length?(i=+z[0],r=+z[1],J()):[i,r]},N.center=function(z){return arguments.length?(s=z[0]%360*$i,o=z[1]%360*$i,J()):[s*Mr,o*Mr]},N.rotate=function(z){return arguments.length?(a=z[0]%360*$i,l=z[1]%360*$i,h=z.length>2?z[2]%360*$i:0,J()):[a*Mr,l*Mr,h*Mr]},N.angle=function(z){return arguments.length?(u=z%360*$i,J()):u*Mr},N.reflectX=function(z){return arguments.length?(d=z?-1:1,J()):d<0},N.reflectY=function(z){return arguments.length?(f=z?-1:1,J()):f<0},N.precision=function(z){return arguments.length?(T=A_(y,_=z*z),j()):Go(_)},N.fitExtent=function(z,$){return Of(N,z,$)},N.fitSize=function(z,$){return KE(N,z,$)},N.fitWidth=function(z,$){return qE(N,z,$)},N.fitHeight=function(z,$){return YE(N,z,$)};function J(){var z=M_(t,0,0,d,f,u).apply(null,e(s,o)),$=M_(t,i-z[0],r-z[1],d,f,u);return c=hz(a,l,h),y=rd(e,$),P=rd(c,y),T=A_(y,_),j()}function j(){return D=F=null,N}return function(){return e=n.apply(this,arguments),N.invert=e.invert&&G,J()}}function Az(n){var e=0,t=St/3,i=Iz(n),r=i(e,t);return r.parallels=function(s){return arguments.length?i(e=s[0]*$i,t=s[1]*$i):[e*Mr,t*Mr]},r}function Mz(n){var e=ci(n);function t(i,r){return[i*e,Qt(r)/e]}return t.invert=function(i,r){return[i/e,zn(r*e)]},t}function Pz(n,e){var t=Qt(n),i=(t+Qt(e))/2;if(ui(i)<Jt)return Mz(n);var r=1+t*(2*i-t),s=Go(r)/i;function o(a,l){var h=Go(r-2*i*Qt(l))/i;return[h*Qt(a*=i),s-h*ci(a)]}return o.invert=function(a,l){var h=s-l,c=zo(a,ui(h))*rh(h);return h*i<0&&(c-=St*rh(a)*rh(h)),[c/i,zn((r-(a*a+h*h)*i*i)/(2*i))]},o}function Oz(){return Az(Pz).scale(155.424).center([0,33.6442])}function Dz(){return Oz().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])}function Nz(){var n=1,e=0,t=0,i=1,r=1,s=0,o,a,l=null,h,c,u,d=1,f=1,p=_c({point:function(C,_){var T=R([C,_]);this.stream.point(T[0],T[1])}}),g=Fh,m,x;function E(){return d=n*i,f=n*r,m=x=null,R}function R(C){var _=C[0]*d,T=C[1]*f;if(s){var y=T*o-_*a;_=_*o+T*a,T=y}return[_+e,T+t]}return R.invert=function(C){var _=C[0]-e,T=C[1]-t;if(s){var y=T*o+_*a;_=_*o-T*a,T=y}return[_/d,T/f]},R.stream=function(C){return m&&x===C?m:m=p(g(x=C))},R.postclip=function(C){return arguments.length?(g=C,l=h=c=u=null,E()):g},R.clipExtent=function(C){return arguments.length?(g=C==null?(l=h=c=u=null,Fh):HE(l=+C[0][0],h=+C[0][1],c=+C[1][0],u=+C[1][1]),E()):l==null?null:[[l,h],[c,u]]},R.scale=function(C){return arguments.length?(n=+C,E()):n},R.translate=function(C){return arguments.length?(e=+C[0],t=+C[1],E()):[e,t]},R.angle=function(C){return arguments.length?(s=C%360*$i,a=Qt(s),o=ci(s),E()):s*Mr},R.reflectX=function(C){return arguments.length?(i=C?-1:1,E()):i<0},R.reflectY=function(C){return arguments.length?(r=C?-1:1,E()):r<0},R.fitExtent=function(C,_){return Of(R,C,_)},R.fitSize=function(C,_){return KE(R,C,_)},R.fitWidth=function(C,_){return qE(R,C,_)},R.fitHeight=function(C,_){return YE(R,C,_)},R}function Fz(n){return n}function ZE(n){if(n==null)return Fz;var e,t,i=n.scale[0],r=n.scale[1],s=n.translate[0],o=n.translate[1];return function(a,l){l||(e=t=0);var h=2,c=a.length,u=new Array(c);for(u[0]=(e+=a[0])*i+s,u[1]=(t+=a[1])*r+o;h<c;)u[h]=a[h],++h;return u}}function Lz(n,e){for(var t,i=n.length,r=i-e;r<--i;)t=n[r],n[r++]=n[i],n[i]=t}function wz(n,e){return typeof e=="string"&&(e=n.objects[e]),e.type==="GeometryCollection"?{type:"FeatureCollection",features:e.geometries.map(function(t){return P_(n,t)})}:P_(n,e)}function P_(n,e){var t=e.id,i=e.bbox,r=e.properties==null?{}:e.properties,s=Uz(n,e);return t==null&&i==null?{type:"Feature",properties:r,geometry:s}:i==null?{type:"Feature",id:t,properties:r,geometry:s}:{type:"Feature",id:t,bbox:i,properties:r,geometry:s}}function Uz(n,e){var t=ZE(n.transform),i=n.arcs;function r(c,u){u.length&&u.pop();for(var d=i[c<0?~c:c],f=0,p=d.length;f<p;++f)u.push(t(d[f],f));c<0&&Lz(u,p)}function s(c){return t(c)}function o(c){for(var u=[],d=0,f=c.length;d<f;++d)r(c[d],u);return u.length<2&&u.push(u[0]),u}function a(c){for(var u=o(c);u.length<4;)u.push(u[0]);return u}function l(c){return c.map(a)}function h(c){var u=c.type,d;switch(u){case"GeometryCollection":return{type:u,geometries:c.geometries.map(h)};case"Point":d=s(c.coordinates);break;case"MultiPoint":d=c.coordinates.map(s);break;case"LineString":d=o(c.arcs);break;case"MultiLineString":d=c.arcs.map(o);break;case"Polygon":d=l(c.arcs);break;case"MultiPolygon":d=c.arcs.map(l);break;default:return null}return{type:u,coordinates:d}}return h(e)}function Vz(n){var e=n[0],t=n[1],i=n[2];return Math.abs((e[0]-i[0])*(t[1]-e[1])-(e[0]-t[0])*(i[1]-e[1]))/2}function kl(n,e){return n[1][2]-e[1][2]}function Bz(){var n={},e=[],t=0;n.push=function(s){return i(e[s._=t]=s,t++),t},n.pop=function(){if(!(t<=0)){var s=e[0],o;return--t>0&&(o=e[t],r(e[o._=0]=o,0)),s}},n.remove=function(s){var o=s._,a;if(e[o]===s)return o!==--t&&(a=e[t],(kl(a,s)<0?i:r)(e[a._=o]=a,o)),o};function i(s,o){for(;o>0;){var a=(o+1>>1)-1,l=e[a];if(kl(s,l)>=0)break;e[l._=o]=l,e[s._=o=a]=s}}function r(s,o){for(;;){var a=o+1<<1,l=a-1,h=o,c=e[h];if(l<t&&kl(e[l],c)<0&&(c=e[h=l]),a<t&&kl(e[a],c)<0&&(c=e[h=a]),h===o)break;e[c._=o]=c,e[s._=o=h]=s}}return n}function kz(n){return[n[0],n[1],0]}function zz(n,e){var t=n.transform?ZE(n.transform):kz,i=Bz();e==null&&(e=Vz);var r=n.arcs.map(function(o){var a=[],l=0,h,c,u;for(o=o.map(t),c=1,u=o.length-1;c<u;++c)h=[o[c-1],o[c],o[c+1]],h[1][2]=e(h),a.push(h),i.push(h);for(o[0][2]=o[u][2]=1/0,c=0,u=a.length;c<u;++c)h=a[c],h.previous=a[c-1],h.next=a[c+1];for(;h=i.pop();){var d=h.previous,f=h.next;h[1][2]<l?h[1][2]=l:l=h[1][2],d&&(d.next=f,d[2]=h[2],s(d)),f&&(f.previous=d,f[0]=h[0],s(f))}return o});function s(o){i.remove(o),o[1][2]=e(o),i.push(o)}return{type:"Topology",bbox:n.bbox,objects:n.objects,arcs:r}}function Gz(n,e){e=e==null?Number.MIN_VALUE:+e;var t=n.arcs.map(function(i){for(var r=-1,s=0,o=i.length,a=new Array(o),l;++r<o;)(l=i[r])[2]>=e&&(a[s++]=[l[0],l[1]]);return a.length=s,a});return{type:"Topology",transform:n.transform,bbox:n.bbox,objects:n.objects,arcs:t}}var vc=Object.prototype.hasOwnProperty;function Wz(n){var e=1/0,t=1/0,i=-1/0,r=-1/0;function s(u){u!=null&&vc.call(o,u.type)&&o[u.type](u)}var o={GeometryCollection:function(u){u.geometries.forEach(s)},Point:function(u){a(u.coordinates)},MultiPoint:function(u){u.coordinates.forEach(a)},LineString:function(u){l(u.arcs)},MultiLineString:function(u){u.arcs.forEach(l)},Polygon:function(u){u.arcs.forEach(l)},MultiPolygon:function(u){u.arcs.forEach(h)}};function a(u){var d=u[0],f=u[1];d<e&&(e=d),d>i&&(i=d),f<t&&(t=f),f>r&&(r=f)}function l(u){u.forEach(a)}function h(u){u.forEach(l)}for(var c in n)s(n[c]);return i>=e&&r>=t?[e,t,i,r]:void 0}function Xz(n,e,t,i,r){arguments.length===3&&(i=Array,r=null);for(var s=new i(n=1<<Math.max(4,Math.ceil(Math.log(n)/Math.LN2))),o=n-1,a=0;a<n;++a)s[a]=r;function l(u){for(var d=e(u)&o,f=s[d],p=0;f!=r;){if(t(f,u))return!0;if(++p>=n)throw new Error("full hashset");f=s[d=d+1&o]}return s[d]=u,!0}function h(u){for(var d=e(u)&o,f=s[d],p=0;f!=r;){if(t(f,u))return!0;if(++p>=n)break;f=s[d=d+1&o]}return!1}function c(){for(var u=[],d=0,f=s.length;d<f;++d){var p=s[d];p!=r&&u.push(p)}return u}return{add:l,has:h,values:c}}function Df(n,e,t,i,r,s){arguments.length===3&&(i=s=Array,r=null);for(var o=new i(n=1<<Math.max(4,Math.ceil(Math.log(n)/Math.LN2))),a=new s(n),l=n-1,h=0;h<n;++h)o[h]=r;function c(p,g){for(var m=e(p)&l,x=o[m],E=0;x!=r;){if(t(x,p))return a[m]=g;if(++E>=n)throw new Error("full hashmap");x=o[m=m+1&l]}return o[m]=p,a[m]=g,g}function u(p,g){for(var m=e(p)&l,x=o[m],E=0;x!=r;){if(t(x,p))return a[m];if(++E>=n)throw new Error("full hashmap");x=o[m=m+1&l]}return o[m]=p,a[m]=g,g}function d(p,g){for(var m=e(p)&l,x=o[m],E=0;x!=r;){if(t(x,p))return a[m];if(++E>=n)break;x=o[m=m+1&l]}return g}function f(){for(var p=[],g=0,m=o.length;g<m;++g){var x=o[g];x!=r&&p.push(x)}return p}return{set:c,maybeSet:u,get:d,keys:f}}function Pn(n,e){return n[0]===e[0]&&n[1]===e[1]}var jE=new ArrayBuffer(16),O_=new Float64Array(jE),zl=new Uint32Array(jE);function od(n){O_[0]=n[0],O_[1]=n[1];var e=zl[0]^zl[1];return e=e<<5^e>>7^zl[2]^zl[3],e&2147483647}function Hz(n){var e=n.coordinates,t=n.lines,i=n.rings,r=T(),s=new Int32Array(e.length),o=new Int32Array(e.length),a=new Int32Array(e.length),l=new Int8Array(e.length),h=0,c,u,d,f,p;for(c=0,u=e.length;c<u;++c)s[c]=o[c]=a[c]=-1;for(c=0,u=t.length;c<u;++c){var g=t[c],m=g[0],x=g[1];for(f=r[m],p=r[++m],++h,l[f]=1;++m<=x;)_(c,d=f,f=p,p=r[m]);++h,l[p]=1}for(c=0,u=e.length;c<u;++c)s[c]=-1;for(c=0,u=i.length;c<u;++c){var E=i[c],R=E[0]+1,C=E[1];for(d=r[C-1],f=r[R-1],p=r[R],_(c,d,f,p);++R<=C;)_(c,d=f,f=p,p=r[R])}function _(N,G,J,j){if(s[J]!==N){s[J]=N;var z=o[J];if(z>=0){var $=a[J];(z!==G||$!==j)&&(z!==j||$!==G)&&(++h,l[J]=1)}else o[J]=G,a[J]=j}}function T(){for(var N=Df(e.length*1.4,y,P,Int32Array,-1,Int32Array),G=new Int32Array(e.length),J=0,j=e.length;J<j;++J)G[J]=N.maybeSet(J,J);return G}function y(N){return od(e[N])}function P(N,G){return Pn(e[N],e[G])}s=o=a=null;var D=Xz(h*1.4,od,Pn),F;for(c=0,u=e.length;c<u;++c)l[F=r[c]]&&D.add(e[F]);return D}function Kz(n){var e=Hz(n),t=n.coordinates,i=n.lines,r=n.rings,s,o,a;for(o=0,a=i.length;o<a;++o)for(var l=i[o],h=l[0],c=l[1];++h<c;)e.has(t[h])&&(s={0:h,1:l[1]},l[1]=h,l=l.next=s);for(o=0,a=r.length;o<a;++o)for(var u=r[o],d=u[0],f=d,p=u[1],g=e.has(t[d]);++f<p;)e.has(t[f])&&(g?(s={0:f,1:u[1]},u[1]=f,u=u.next=s):(qz(t,d,p,p-f),t[p]=t[d],g=!0,f=d));return n}function qz(n,e,t,i){Cu(n,e,t),Cu(n,e,e+i),Cu(n,e+i,t)}function Cu(n,e,t){for(var i=e+(t---e>>1),r;e<i;++e,--t)r=n[e],n[e]=n[t],n[t]=r}function Yz(n){var e=n.coordinates,t=n.lines,i,r=n.rings,s,o=t.length+r.length,a,l;for(delete n.lines,delete n.rings,a=0,l=t.length;a<l;++a)for(i=t[a];i=i.next;)++o;for(a=0,l=r.length;a<l;++a)for(s=r[a];s=s.next;)++o;var h=Df(o*2*1.4,od,Pn),c=n.arcs=[];for(a=0,l=t.length;a<l;++a){i=t[a];do u(i);while(i=i.next)}for(a=0,l=r.length;a<l;++a)if(s=r[a],s.next)do u(s);while(s=s.next);else d(s);function u(E){var R,C,_,T,y,P,D,F;if(_=h.get(R=e[E[0]])){for(D=0,F=_.length;D<F;++D)if(T=_[D],f(T,E)){E[0]=T[0],E[1]=T[1];return}}if(y=h.get(C=e[E[1]])){for(D=0,F=y.length;D<F;++D)if(P=y[D],p(P,E)){E[1]=P[0],E[0]=P[1];return}}_?_.push(E):h.set(R,[E]),y?y.push(E):h.set(C,[E]),c.push(E)}function d(E){var R,C,_,T,y;if(C=h.get(R=e[E[0]]))for(T=0,y=C.length;T<y;++T){if(_=C[T],g(_,E)){E[0]=_[0],E[1]=_[1];return}if(m(_,E)){E[0]=_[1],E[1]=_[0];return}}if(C=h.get(R=e[E[0]+x(E)]))for(T=0,y=C.length;T<y;++T){if(_=C[T],g(_,E)){E[0]=_[0],E[1]=_[1];return}if(m(_,E)){E[0]=_[1],E[1]=_[0];return}}C?C.push(E):h.set(R,[E]),c.push(E)}function f(E,R){var C=E[0],_=R[0],T=E[1],y=R[1];if(C-T!==_-y)return!1;for(;C<=T;++C,++_)if(!Pn(e[C],e[_]))return!1;return!0}function p(E,R){var C=E[0],_=R[0],T=E[1],y=R[1];if(C-T!==_-y)return!1;for(;C<=T;++C,--y)if(!Pn(e[C],e[y]))return!1;return!0}function g(E,R){var C=E[0],_=R[0],T=E[1],y=R[1],P=T-C;if(P!==y-_)return!1;for(var D=x(E),F=x(R),N=0;N<P;++N)if(!Pn(e[C+(N+D)%P],e[_+(N+F)%P]))return!1;return!0}function m(E,R){var C=E[0],_=R[0],T=E[1],y=R[1],P=T-C;if(P!==y-_)return!1;for(var D=x(E),F=P-x(R),N=0;N<P;++N)if(!Pn(e[C+(N+D)%P],e[y-(N+F)%P]))return!1;return!0}function x(E){for(var R=E[0],C=E[1],_=R,T=_,y=e[_];++_<C;){var P=e[_];(P[0]<y[0]||P[0]===y[0]&&P[1]<y[1])&&(T=_,y=P)}return T-R}return n}function Zz(n){for(var e=-1,t=n.length;++e<t;){for(var i=n[e],r=0,s=1,o=i.length,a=i[0],l=a[0],h=a[1],c,u;++r<o;)a=i[r],c=a[0],u=a[1],(c!==l||u!==h)&&(i[s++]=[c-l,u-h],l=c,h=u);s===1&&(i[s++]=[0,0]),i.length=s}return n}function jz(n){var e=-1,t=[],i=[],r=[];function s(u){u&&vc.call(o,u.type)&&o[u.type](u)}var o={GeometryCollection:function(u){u.geometries.forEach(s)},LineString:function(u){u.arcs=a(u.arcs)},MultiLineString:function(u){u.arcs=u.arcs.map(a)},Polygon:function(u){u.arcs=u.arcs.map(l)},MultiPolygon:function(u){u.arcs=u.arcs.map(h)}};function a(u){for(var d=0,f=u.length;d<f;++d)r[++e]=u[d];var p={0:e-f+1,1:e};return t.push(p),p}function l(u){for(var d=0,f=u.length;d<f;++d)r[++e]=u[d];var p={0:e-f+1,1:e};return i.push(p),p}function h(u){return u.map(l)}for(var c in n)s(n[c]);return{type:"Topology",coordinates:r,lines:t,rings:i,objects:n}}function Qz(n){var e={},t;for(t in n)e[t]=Jz(n[t]);return e}function Jz(n){return n==null?{type:null}:(n.type==="FeatureCollection"?$z:n.type==="Feature"?QE:Nf)(n)}function $z(n){var e={type:"GeometryCollection",geometries:n.features.map(QE)};return n.bbox!=null&&(e.bbox=n.bbox),e}function QE(n){var e=Nf(n.geometry),t;n.id!=null&&(e.id=n.id),n.bbox!=null&&(e.bbox=n.bbox);for(t in n.properties){e.properties=n.properties;break}return e}function Nf(n){if(n==null)return{type:null};var e=n.type==="GeometryCollection"?{type:"GeometryCollection",geometries:n.geometries.map(Nf)}:n.type==="Point"||n.type==="MultiPoint"?{type:n.type,coordinates:n.coordinates}:{type:n.type,arcs:n.coordinates};return n.bbox!=null&&(e.bbox=n.bbox),e}function eG(n,e,t){var i=e[0],r=e[1],s=e[2],o=e[3],a=s-i?(t-1)/(s-i):1,l=o-r?(t-1)/(o-r):1;function h(x){return[Math.round((x[0]-i)*a),Math.round((x[1]-r)*l)]}function c(x,E){for(var R=-1,C=0,_=x.length,T=new Array(_),y,P,D,F,N;++R<_;)y=x[R],F=Math.round((y[0]-i)*a),N=Math.round((y[1]-r)*l),(F!==P||N!==D)&&(T[C++]=[P=F,D=N]);for(T.length=C;C<E;)C=T.push([T[0][0],T[0][1]]);return T}function u(x){return c(x,2)}function d(x){return c(x,4)}function f(x){return x.map(d)}function p(x){x!=null&&vc.call(g,x.type)&&g[x.type](x)}var g={GeometryCollection:function(x){x.geometries.forEach(p)},Point:function(x){x.coordinates=h(x.coordinates)},MultiPoint:function(x){x.coordinates=x.coordinates.map(h)},LineString:function(x){x.arcs=u(x.arcs)},MultiLineString:function(x){x.arcs=x.arcs.map(u)},Polygon:function(x){x.arcs=f(x.arcs)},MultiPolygon:function(x){x.arcs=x.arcs.map(f)}};for(var m in n)p(n[m]);return{scale:[1/a,1/l],translate:[i,r]}}function tG(n,e){var t=Wz(n=Qz(n)),i=e>0&&t&&eG(n,t,e),r=Yz(Kz(jz(n))),s=r.coordinates,o=Df(r.arcs.length*1.4,iG,rG);n=r.objects,r.bbox=t,r.arcs=r.arcs.map(function(d,f){return o.set(d,f),s.slice(d[0],d[1]+1)}),delete r.coordinates,s=null;function a(d){d&&vc.call(l,d.type)&&l[d.type](d)}var l={GeometryCollection:function(d){d.geometries.forEach(a)},LineString:function(d){d.arcs=h(d.arcs)},MultiLineString:function(d){d.arcs=d.arcs.map(h)},Polygon:function(d){d.arcs=d.arcs.map(h)},MultiPolygon:function(d){d.arcs=d.arcs.map(c)}};function h(d){var f=[];do{var p=o.get(d);f.push(d[0]<d[1]?p:~p)}while(d=d.next);return f}function c(d){return d.map(h)}for(var u in n)a(n[u]);return i&&(r.transform=i,r.arcs=Zz(r.arcs)),r}function iG(n){var e=n[0],t=n[1],i;return t<e&&(i=e,e=t,t=i),e+31*t}function rG(n,e){var t=n[0],i=n[1],r=e[0],s=e[1],o;return i<t&&(o=t,t=i,i=o),s<r&&(o=r,r=s,s=o),t===r&&i===s}var Ff={exports:{}};Ff.exports=Ec;Ff.exports.default=Ec;function Ec(n,e,t){t=t||2;var i=e&&e.length,r=i?e[0]*t:n.length,s=JE(n,0,r,t,!0),o=[];if(!s||s.next===s.prev)return o;var a,l,h,c,u,d,f;if(i&&(s=lG(n,e,s,t)),n.length>80*t){a=h=n[0],l=c=n[1];for(var p=t;p<r;p+=t)u=n[p],d=n[p+1],u<a&&(a=u),d<l&&(l=d),u>h&&(h=u),d>c&&(c=d);f=Math.max(h-a,c-l),f=f!==0?32767/f:0}return Wa(s,o,t,a,l,f,0),o}function JE(n,e,t,i,r){var s,o;if(r===hd(n,e,t,i)>0)for(s=e;s<t;s+=i)o=D_(s,n[s],n[s+1],o);else for(s=t-i;s>=e;s-=i)o=D_(s,n[s],n[s+1],o);return o&&Tc(o,o.next)&&(Ha(o),o=o.next),o}function Gn(n,e){if(!n)return n;e||(e=n);var t=n,i;do if(i=!1,!t.steiner&&(Tc(t,t.next)||fi(t.prev,t,t.next)===0)){if(Ha(t),t=e=t.prev,t===t.next)break;i=!0}else t=t.next;while(i||t!==e);return e}function Wa(n,e,t,i,r,s,o){if(n){!o&&s&&fG(n,i,r,s);for(var a=n,l,h;n.prev!==n.next;){if(l=n.prev,h=n.next,s?nG(n,i,r,s):sG(n)){e.push(l.i/t|0),e.push(n.i/t|0),e.push(h.i/t|0),Ha(n),n=h.next,a=h.next;continue}if(n=h,n===a){o?o===1?(n=oG(Gn(n),e,t),Wa(n,e,t,i,r,s,2)):o===2&&aG(n,e,t,i,r,s):Wa(Gn(n),e,t,i,r,s,1);break}}}}function sG(n){var e=n.prev,t=n,i=n.next;if(fi(e,t,i)>=0)return!1;for(var r=e.x,s=t.x,o=i.x,a=e.y,l=t.y,h=i.y,c=r<s?r<o?r:o:s<o?s:o,u=a<l?a<h?a:h:l<h?l:h,d=r>s?r>o?r:o:s>o?s:o,f=a>l?a>h?a:h:l>h?l:h,p=i.next;p!==e;){if(p.x>=c&&p.x<=d&&p.y>=u&&p.y<=f&&Eo(r,a,s,l,o,h,p.x,p.y)&&fi(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function nG(n,e,t,i){var r=n.prev,s=n,o=n.next;if(fi(r,s,o)>=0)return!1;for(var a=r.x,l=s.x,h=o.x,c=r.y,u=s.y,d=o.y,f=a<l?a<h?a:h:l<h?l:h,p=c<u?c<d?c:d:u<d?u:d,g=a>l?a>h?a:h:l>h?l:h,m=c>u?c>d?c:d:u>d?u:d,x=ad(f,p,e,t,i),E=ad(g,m,e,t,i),R=n.prevZ,C=n.nextZ;R&&R.z>=x&&C&&C.z<=E;){if(R.x>=f&&R.x<=g&&R.y>=p&&R.y<=m&&R!==r&&R!==o&&Eo(a,c,l,u,h,d,R.x,R.y)&&fi(R.prev,R,R.next)>=0||(R=R.prevZ,C.x>=f&&C.x<=g&&C.y>=p&&C.y<=m&&C!==r&&C!==o&&Eo(a,c,l,u,h,d,C.x,C.y)&&fi(C.prev,C,C.next)>=0))return!1;C=C.nextZ}for(;R&&R.z>=x;){if(R.x>=f&&R.x<=g&&R.y>=p&&R.y<=m&&R!==r&&R!==o&&Eo(a,c,l,u,h,d,R.x,R.y)&&fi(R.prev,R,R.next)>=0)return!1;R=R.prevZ}for(;C&&C.z<=E;){if(C.x>=f&&C.x<=g&&C.y>=p&&C.y<=m&&C!==r&&C!==o&&Eo(a,c,l,u,h,d,C.x,C.y)&&fi(C.prev,C,C.next)>=0)return!1;C=C.nextZ}return!0}function oG(n,e,t){var i=n;do{var r=i.prev,s=i.next.next;!Tc(r,s)&&$E(r,i,i.next,s)&&Xa(r,s)&&Xa(s,r)&&(e.push(r.i/t|0),e.push(i.i/t|0),e.push(s.i/t|0),Ha(i),Ha(i.next),i=n=s),i=i.next}while(i!==n);return Gn(i)}function aG(n,e,t,i,r,s){var o=n;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&mG(o,a)){var l=eT(o,a);o=Gn(o,o.next),l=Gn(l,l.next),Wa(o,e,t,i,r,s,0),Wa(l,e,t,i,r,s,0);return}a=a.next}o=o.next}while(o!==n)}function lG(n,e,t,i){var r=[],s,o,a,l,h;for(s=0,o=e.length;s<o;s++)a=e[s]*i,l=s<o-1?e[s+1]*i:n.length,h=JE(n,a,l,i,!1),h===h.next&&(h.steiner=!0),r.push(gG(h));for(r.sort(hG),s=0;s<r.length;s++)t=cG(r[s],t);return t}function hG(n,e){return n.x-e.x}function cG(n,e){var t=uG(n,e);if(!t)return e;var i=eT(t,n);return Gn(i,i.next),Gn(t,t.next)}function uG(n,e){var t=e,i=n.x,r=n.y,s=-1/0,o;do{if(r<=t.y&&r>=t.next.y&&t.next.y!==t.y){var a=t.x+(r-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(a<=i&&a>s&&(s=a,o=t.x<t.next.x?t:t.next,a===i))return o}t=t.next}while(t!==e);if(!o)return null;var l=o,h=o.x,c=o.y,u=1/0,d;t=o;do i>=t.x&&t.x>=h&&i!==t.x&&Eo(r<c?i:s,r,h,c,r<c?s:i,r,t.x,t.y)&&(d=Math.abs(r-t.y)/(i-t.x),Xa(t,n)&&(d<u||d===u&&(t.x>o.x||t.x===o.x&&dG(o,t)))&&(o=t,u=d)),t=t.next;while(t!==l);return o}function dG(n,e){return fi(n.prev,n,e.prev)<0&&fi(e.next,n,n.next)<0}function fG(n,e,t,i){var r=n;do r.z===0&&(r.z=ad(r.x,r.y,e,t,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==n);r.prevZ.nextZ=null,r.prevZ=null,pG(r)}function pG(n){var e,t,i,r,s,o,a,l,h=1;do{for(t=n,n=null,s=null,o=0;t;){for(o++,i=t,a=0,e=0;e<h&&(a++,i=i.nextZ,!!i);e++);for(l=h;a>0||l>0&&i;)a!==0&&(l===0||!i||t.z<=i.z)?(r=t,t=t.nextZ,a--):(r=i,i=i.nextZ,l--),s?s.nextZ=r:n=r,r.prevZ=s,s=r;t=i}s.nextZ=null,h*=2}while(o>1);return n}function ad(n,e,t,i,r){return n=(n-t)*r|0,e=(e-i)*r|0,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,n|e<<1}function gG(n){var e=n,t=n;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==n);return t}function Eo(n,e,t,i,r,s,o,a){return(r-o)*(e-a)>=(n-o)*(s-a)&&(n-o)*(i-a)>=(t-o)*(e-a)&&(t-o)*(s-a)>=(r-o)*(i-a)}function mG(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!_G(n,e)&&(Xa(n,e)&&Xa(e,n)&&vG(n,e)&&(fi(n.prev,n,e.prev)||fi(n,e.prev,e))||Tc(n,e)&&fi(n.prev,n,n.next)>0&&fi(e.prev,e,e.next)>0)}function fi(n,e,t){return(e.y-n.y)*(t.x-e.x)-(e.x-n.x)*(t.y-e.y)}function Tc(n,e){return n.x===e.x&&n.y===e.y}function $E(n,e,t,i){var r=Wl(fi(n,e,t)),s=Wl(fi(n,e,i)),o=Wl(fi(t,i,n)),a=Wl(fi(t,i,e));return!!(r!==s&&o!==a||r===0&&Gl(n,t,e)||s===0&&Gl(n,i,e)||o===0&&Gl(t,n,i)||a===0&&Gl(t,e,i))}function Gl(n,e,t){return e.x<=Math.max(n.x,t.x)&&e.x>=Math.min(n.x,t.x)&&e.y<=Math.max(n.y,t.y)&&e.y>=Math.min(n.y,t.y)}function Wl(n){return n>0?1:n<0?-1:0}function _G(n,e){var t=n;do{if(t.i!==n.i&&t.next.i!==n.i&&t.i!==e.i&&t.next.i!==e.i&&$E(t,t.next,n,e))return!0;t=t.next}while(t!==n);return!1}function Xa(n,e){return fi(n.prev,n,n.next)<0?fi(n,e,n.next)>=0&&fi(n,n.prev,e)>=0:fi(n,e,n.prev)<0||fi(n,n.next,e)<0}function vG(n,e){var t=n,i=!1,r=(n.x+e.x)/2,s=(n.y+e.y)/2;do t.y>s!=t.next.y>s&&t.next.y!==t.y&&r<(t.next.x-t.x)*(s-t.y)/(t.next.y-t.y)+t.x&&(i=!i),t=t.next;while(t!==n);return i}function eT(n,e){var t=new ld(n.i,n.x,n.y),i=new ld(e.i,e.x,e.y),r=n.next,s=e.prev;return n.next=e,e.prev=n,t.next=r,r.prev=t,i.next=t,t.prev=i,s.next=i,i.prev=s,i}function D_(n,e,t,i){var r=new ld(n,e,t);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function Ha(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function ld(n,e,t){this.i=n,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Ec.deviation=function(n,e,t,i){var r=e&&e.length,s=r?e[0]*t:n.length,o=Math.abs(hd(n,0,s,t));if(r)for(var a=0,l=e.length;a<l;a++){var h=e[a]*t,c=a<l-1?e[a+1]*t:n.length;o-=Math.abs(hd(n,h,c,t))}var u=0;for(a=0;a<i.length;a+=3){var d=i[a]*t,f=i[a+1]*t,p=i[a+2]*t;u+=Math.abs((n[d]-n[p])*(n[f+1]-n[d+1])-(n[d]-n[f])*(n[p+1]-n[d+1]))}return o===0&&u===0?0:Math.abs((u-o)/o)};function hd(n,e,t,i){for(var r=0,s=e,o=t-i;s<t;s+=i)r+=(n[o]-n[s])*(n[s+1]+n[o+1]),o=s;return r}Ec.flatten=function(n){for(var e=n[0][0].length,t={vertices:[],holes:[],dimensions:e},i=0,r=0;r<n.length;r++){for(var s=0;s<n[r].length;s++)for(var o=0;o<e;o++)t.vertices.push(n[r][s][o]);r>0&&(i+=n[r-1].length,t.holes.push(i))}return t};var EG=Ff.exports;const N_=UE(EG),nh=()=>{};function TG(n){if((t=n.length)<4)return!1;for(var e=0,t,i=n[t-1][1]*n[0][0]-n[t-1][0]*n[0][1];++e<t;)i+=n[e-1][1]*n[e][0]-n[e-1][0]*n[e][1];return i<=0}function xG(n,e){for(var t=e[0],i=e[1],r=!1,s=0,o=n.length,a=o-1;s<o;a=s++){var l=n[s],h=l[0],c=l[1],u=n[a],d=u[0],f=u[1];c>i^f>i&&t<(d-h)*(i-c)/(f-c)+h&&(r=!r)}return r}function F_(n,e){var t=e.stream,i;if(!t)throw new Error("invalid projection");switch(n&&n.type){case"Feature":i=tT;break;case"FeatureCollection":i=CG;break;default:i=Lf;break}return i(n,t)}function CG(n,e){return{type:"FeatureCollection",features:n.features.map(function(t){return tT(t,e)})}}function tT(n,e){return{type:"Feature",id:n.id,properties:n.properties,geometry:Lf(n.geometry,e)}}function RG(n,e){return{type:"GeometryCollection",geometries:n.geometries.map(function(t){return Lf(t,e)})}}function Lf(n,e){if(!n)return null;if(n.type==="GeometryCollection")return RG(n,e);var t;switch(n.type){case"Point":t=L_;break;case"MultiPoint":t=L_;break;case"LineString":t=w_;break;case"MultiLineString":t=w_;break;case"Polygon":t=Ru;break;case"MultiPolygon":t=Ru;break;case"Sphere":t=Ru;break;default:return null}return zE(n,e(t)),t.result()}var ir=[],ds=[],L_={point:function(n,e){ir.push([n,e])},result:function(){var n=ir.length?ir.length<2?{type:"Point",coordinates:ir[0]}:{type:"MultiPoint",coordinates:ir}:null;return ir=[],n}},w_={lineStart:nh,point:function(n,e){ir.push([n,e])},lineEnd:function(){ir.length&&(ds.push(ir),ir=[])},result:function(){var n=ds.length?ds.length<2?{type:"LineString",coordinates:ds[0]}:{type:"MultiLineString",coordinates:ds}:null;return ds=[],n}},Ru={polygonStart:nh,lineStart:nh,point:function(n,e){ir.push([n,e])},lineEnd:function(){var n=ir.length;if(n){do ir.push(ir[0].slice());while(++n<4);ds.push(ir),ir=[]}},polygonEnd:nh,result:function(){if(!ds.length)return null;var n=[],e=[];return ds.forEach(function(t){TG(t)?n.push([t]):e.push(t)}),e.forEach(function(t){var i=t[0];n.some(function(r){if(xG(r[0],i))return r.push(t),!0})||n.push([t])}),ds=[],n.length?n.length>1?{type:"MultiPolygon",coordinates:n}:{type:"Polygon",coordinates:n[0]}:null}};class SG{constructor(e,t,i,r,s,o,a,l,h){this.name=e,this.scene=h,this.geoJson=t,this.projection=i,this.size=r,this.transform=s,this.simplification=o,this.cot=l,this.depth=a,this.selection=this.createMap()}createMap(){let e=F_(this.geoJson,this.projection.fitSize(this.size,this.geoJson).translate(this.transform)),t=F_(e,Nz()),i=tG({features:t}),r=zz(i),s=Gz(r,this.simplification),o=wz(s,s.objects.features),a,l=[];return o.features.forEach(h=>{if(h.geometry!=null){if(h.geometry.type==="Polygon"){let c=[];h.geometry.coordinates[0].forEach(u=>c.push(new _e(u[0],0,u[1]))),a=Bt.ExtrudePolygon("polygon",{shape:c,depth:this.depth,wrap:!1,sideOrientation:2},this.scene,N_),a.name="polygon",a.parent=this.cot,a.metadata={...a.metadata,data:h.properties!=null?h.properties:null},l.push(a)}else if(h.geometry.type==="MultiPolygon"){let c=[];h.geometry.coordinates.forEach(u=>{u.forEach(d=>{let f=[];d.forEach(p=>f.push(new _e(p[0],0,p[1]))),c.push(Bt.ExtrudePolygon("polygon",{shape:f,depth:this.depth,wrap:!1,sideOrientation:2},this.scene,N_))})}),a=ji.MergeMeshes(c,!0,!0),a.name="polygon",a.parent=this.cot,a.metadata={...a.metadata,data:h.properties!=null?h.properties:null},l.push(a)}}}),new ai(l,this.scene)}}function wG(n,e,t){const i=e.geoJson,r=e.projection||Dz(),s=e.size||[10,10],o=e.transform||[0,0],a=e.simplification||0,l=e.depth||1,h=e.cot||new dn("meshMapCOT",t);return new SG(n,i,r,s,o,a,l,h,t)}export{Ka as B,RS as D,PG as G,OG as H,kE as I,DG as K,wG as Q,IG as U,AG as V,NG as Y,FG as Z,LG as j,bG as w,MG as z};
